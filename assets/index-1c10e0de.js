function jG(i,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in i)){const a=Object.getOwnPropertyDescriptor(r,s);a&&Object.defineProperty(i,s,a.get?a:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();var qf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hd(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function YG(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var s=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return i[r]}})}),n}var nP={exports:{}},s$={},iP={exports:{}},Vn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dE=Symbol.for("react.element"),KG=Symbol.for("react.portal"),JG=Symbol.for("react.fragment"),ZG=Symbol.for("react.strict_mode"),qG=Symbol.for("react.profiler"),QG=Symbol.for("react.provider"),eH=Symbol.for("react.context"),tH=Symbol.for("react.forward_ref"),nH=Symbol.for("react.suspense"),iH=Symbol.for("react.memo"),rH=Symbol.for("react.lazy"),hO=Symbol.iterator;function sH(i){return i===null||typeof i!="object"?null:(i=hO&&i[hO]||i["@@iterator"],typeof i=="function"?i:null)}var rP={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},sP=Object.assign,oP={};function Kg(i,e,n){this.props=i,this.context=e,this.refs=oP,this.updater=n||rP}Kg.prototype.isReactComponent={};Kg.prototype.setState=function(i,e){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,e,"setState")};Kg.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function aP(){}aP.prototype=Kg.prototype;function sw(i,e,n){this.props=i,this.context=e,this.refs=oP,this.updater=n||rP}var ow=sw.prototype=new aP;ow.constructor=sw;sP(ow,Kg.prototype);ow.isPureReactComponent=!0;var dO=Array.isArray,lP=Object.prototype.hasOwnProperty,aw={current:null},cP={key:!0,ref:!0,__self:!0,__source:!0};function uP(i,e,n){var r,s={},a=null,l=null;if(e!=null)for(r in e.ref!==void 0&&(l=e.ref),e.key!==void 0&&(a=""+e.key),e)lP.call(e,r)&&!cP.hasOwnProperty(r)&&(s[r]=e[r]);var u=arguments.length-2;if(u===1)s.children=n;else if(1<u){for(var d=Array(u),h=0;h<u;h++)d[h]=arguments[h+2];s.children=d}if(i&&i.defaultProps)for(r in u=i.defaultProps,u)s[r]===void 0&&(s[r]=u[r]);return{$$typeof:dE,type:i,key:a,ref:l,props:s,_owner:aw.current}}function oH(i,e){return{$$typeof:dE,type:i.type,key:e,ref:i.ref,props:i.props,_owner:i._owner}}function lw(i){return typeof i=="object"&&i!==null&&i.$$typeof===dE}function aH(i){var e={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(n){return e[n]})}var fO=/\/+/g;function MA(i,e){return typeof i=="object"&&i!==null&&i.key!=null?aH(""+i.key):e.toString(36)}function Z0(i,e,n,r,s){var a=typeof i;(a==="undefined"||a==="boolean")&&(i=null);var l=!1;if(i===null)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(i.$$typeof){case dE:case KG:l=!0}}if(l)return l=i,s=s(l),i=r===""?"."+MA(l,0):r,dO(s)?(n="",i!=null&&(n=i.replace(fO,"$&/")+"/"),Z0(s,e,n,"",function(h){return h})):s!=null&&(lw(s)&&(s=oH(s,n+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(fO,"$&/")+"/")+i)),e.push(s)),1;if(l=0,r=r===""?".":r+":",dO(i))for(var u=0;u<i.length;u++){a=i[u];var d=r+MA(a,u);l+=Z0(a,e,n,d,s)}else if(d=sH(i),typeof d=="function")for(i=d.call(i),u=0;!(a=i.next()).done;)a=a.value,d=r+MA(a,u++),l+=Z0(a,e,n,d,s);else if(a==="object")throw e=String(i),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function My(i,e,n){if(i==null)return i;var r=[],s=0;return Z0(i,r,"","",function(a){return e.call(n,a,s++)}),r}function lH(i){if(i._status===-1){var e=i._result;e=e(),e.then(function(n){(i._status===0||i._status===-1)&&(i._status=1,i._result=n)},function(n){(i._status===0||i._status===-1)&&(i._status=2,i._result=n)}),i._status===-1&&(i._status=0,i._result=e)}if(i._status===1)return i._result.default;throw i._result}var uo={current:null},q0={transition:null},cH={ReactCurrentDispatcher:uo,ReactCurrentBatchConfig:q0,ReactCurrentOwner:aw};function hP(){throw Error("act(...) is not supported in production builds of React.")}Vn.Children={map:My,forEach:function(i,e,n){My(i,function(){e.apply(this,arguments)},n)},count:function(i){var e=0;return My(i,function(){e++}),e},toArray:function(i){return My(i,function(e){return e})||[]},only:function(i){if(!lw(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};Vn.Component=Kg;Vn.Fragment=JG;Vn.Profiler=qG;Vn.PureComponent=sw;Vn.StrictMode=ZG;Vn.Suspense=nH;Vn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cH;Vn.act=hP;Vn.cloneElement=function(i,e,n){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var r=sP({},i.props),s=i.key,a=i.ref,l=i._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,l=aw.current),e.key!==void 0&&(s=""+e.key),i.type&&i.type.defaultProps)var u=i.type.defaultProps;for(d in e)lP.call(e,d)&&!cP.hasOwnProperty(d)&&(r[d]=e[d]===void 0&&u!==void 0?u[d]:e[d])}var d=arguments.length-2;if(d===1)r.children=n;else if(1<d){u=Array(d);for(var h=0;h<d;h++)u[h]=arguments[h+2];r.children=u}return{$$typeof:dE,type:i.type,key:s,ref:a,props:r,_owner:l}};Vn.createContext=function(i){return i={$$typeof:eH,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:QG,_context:i},i.Consumer=i};Vn.createElement=uP;Vn.createFactory=function(i){var e=uP.bind(null,i);return e.type=i,e};Vn.createRef=function(){return{current:null}};Vn.forwardRef=function(i){return{$$typeof:tH,render:i}};Vn.isValidElement=lw;Vn.lazy=function(i){return{$$typeof:rH,_payload:{_status:-1,_result:i},_init:lH}};Vn.memo=function(i,e){return{$$typeof:iH,type:i,compare:e===void 0?null:e}};Vn.startTransition=function(i){var e=q0.transition;q0.transition={};try{i()}finally{q0.transition=e}};Vn.unstable_act=hP;Vn.useCallback=function(i,e){return uo.current.useCallback(i,e)};Vn.useContext=function(i){return uo.current.useContext(i)};Vn.useDebugValue=function(){};Vn.useDeferredValue=function(i){return uo.current.useDeferredValue(i)};Vn.useEffect=function(i,e){return uo.current.useEffect(i,e)};Vn.useId=function(){return uo.current.useId()};Vn.useImperativeHandle=function(i,e,n){return uo.current.useImperativeHandle(i,e,n)};Vn.useInsertionEffect=function(i,e){return uo.current.useInsertionEffect(i,e)};Vn.useLayoutEffect=function(i,e){return uo.current.useLayoutEffect(i,e)};Vn.useMemo=function(i,e){return uo.current.useMemo(i,e)};Vn.useReducer=function(i,e,n){return uo.current.useReducer(i,e,n)};Vn.useRef=function(i){return uo.current.useRef(i)};Vn.useState=function(i){return uo.current.useState(i)};Vn.useSyncExternalStore=function(i,e,n){return uo.current.useSyncExternalStore(i,e,n)};Vn.useTransition=function(){return uo.current.useTransition()};Vn.version="18.3.1";iP.exports=Vn;var q=iP.exports;const cw=hd(q),uH=jG({__proto__:null,default:cw},[q]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hH=q,dH=Symbol.for("react.element"),fH=Symbol.for("react.fragment"),pH=Object.prototype.hasOwnProperty,mH=hH.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gH={key:!0,ref:!0,__self:!0,__source:!0};function dP(i,e,n){var r,s={},a=null,l=null;n!==void 0&&(a=""+n),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(l=e.ref);for(r in e)pH.call(e,r)&&!gH.hasOwnProperty(r)&&(s[r]=e[r]);if(i&&i.defaultProps)for(r in e=i.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:dH,type:i,key:a,ref:l,props:s,_owner:mH.current}}s$.Fragment=fH;s$.jsx=dP;s$.jsxs=dP;nP.exports=s$;var G=nP.exports,fP={exports:{}},fa={},pP={exports:{}},mP={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(H,J){var K=H.length;H.push(J);e:for(;0<K;){var se=K-1>>>1,Y=H[se];if(0<s(Y,J))H[se]=J,H[K]=Y,K=se;else break e}}function n(H){return H.length===0?null:H[0]}function r(H){if(H.length===0)return null;var J=H[0],K=H.pop();if(K!==J){H[0]=K;e:for(var se=0,Y=H.length,he=Y>>>1;se<he;){var ue=2*(se+1)-1,Te=H[ue],_e=ue+1,Re=H[_e];if(0>s(Te,K))_e<Y&&0>s(Re,Te)?(H[se]=Re,H[_e]=K,se=_e):(H[se]=Te,H[ue]=K,se=ue);else if(_e<Y&&0>s(Re,K))H[se]=Re,H[_e]=K,se=_e;else break e}}return J}function s(H,J){var K=H.sortIndex-J.sortIndex;return K!==0?K:H.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;i.unstable_now=function(){return a.now()}}else{var l=Date,u=l.now();i.unstable_now=function(){return l.now()-u}}var d=[],h=[],f=1,p=null,m=3,T=!1,E=!1,b=!1,y=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(H){for(var J=n(h);J!==null;){if(J.callback===null)r(h);else if(J.startTime<=H)r(h),J.sortIndex=J.expirationTime,e(d,J);else break;J=n(h)}}function R(H){if(b=!1,C(H),!E)if(n(d)!==null)E=!0,de(I);else{var J=n(h);J!==null&&xe(R,J.startTime-H)}}function I(H,J){E=!1,b&&(b=!1,S(k),k=-1),T=!0;var K=m;try{for(C(J),p=n(d);p!==null&&(!(p.expirationTime>J)||H&&!ce());){var se=p.callback;if(typeof se=="function"){p.callback=null,m=p.priorityLevel;var Y=se(p.expirationTime<=J);J=i.unstable_now(),typeof Y=="function"?p.callback=Y:p===n(d)&&r(d),C(J)}else r(d);p=n(d)}if(p!==null)var he=!0;else{var ue=n(h);ue!==null&&xe(R,ue.startTime-J),he=!1}return he}finally{p=null,m=K,T=!1}}var O=!1,F=null,k=-1,D=5,U=-1;function ce(){return!(i.unstable_now()-U<D)}function ie(){if(F!==null){var H=i.unstable_now();U=H;var J=!0;try{J=F(!0,H)}finally{J?ae():(O=!1,F=null)}}else O=!1}var ae;if(typeof A=="function")ae=function(){A(ie)};else if(typeof MessageChannel<"u"){var ne=new MessageChannel,pe=ne.port2;ne.port1.onmessage=ie,ae=function(){pe.postMessage(null)}}else ae=function(){y(ie,0)};function de(H){F=H,O||(O=!0,ae())}function xe(H,J){k=y(function(){H(i.unstable_now())},J)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(H){H.callback=null},i.unstable_continueExecution=function(){E||T||(E=!0,de(I))},i.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<H?Math.floor(1e3/H):5},i.unstable_getCurrentPriorityLevel=function(){return m},i.unstable_getFirstCallbackNode=function(){return n(d)},i.unstable_next=function(H){switch(m){case 1:case 2:case 3:var J=3;break;default:J=m}var K=m;m=J;try{return H()}finally{m=K}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(H,J){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var K=m;m=H;try{return J()}finally{m=K}},i.unstable_scheduleCallback=function(H,J,K){var se=i.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?se+K:se):K=se,H){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=K+Y,H={id:f++,callback:J,priorityLevel:H,startTime:K,expirationTime:Y,sortIndex:-1},K>se?(H.sortIndex=K,e(h,H),n(d)===null&&H===n(h)&&(b?(S(k),k=-1):b=!0,xe(R,K-se))):(H.sortIndex=Y,e(d,H),E||T||(E=!0,de(I))),H},i.unstable_shouldYield=ce,i.unstable_wrapCallback=function(H){var J=m;return function(){var K=m;m=J;try{return H.apply(this,arguments)}finally{m=K}}}})(mP);pP.exports=mP;var _H=pP.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vH=q,ha=_H;function Mt(i){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+i,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var gP=new Set,NT={};function xp(i,e){Pg(i,e),Pg(i+"Capture",e)}function Pg(i,e){for(NT[i]=e,i=0;i<e.length;i++)gP.add(e[i])}var Ru=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ux=Object.prototype.hasOwnProperty,TH=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,pO={},mO={};function EH(i){return ux.call(mO,i)?!0:ux.call(pO,i)?!1:TH.test(i)?mO[i]=!0:(pO[i]=!0,!1)}function yH(i,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function SH(i,e,n,r){if(e===null||typeof e>"u"||yH(i,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ho(i,e,n,r,s,a,l){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=i,this.type=e,this.sanitizeURL=a,this.removeEmptyString=l}var bs={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){bs[i]=new ho(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var e=i[0];bs[e]=new ho(e,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){bs[i]=new ho(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){bs[i]=new ho(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){bs[i]=new ho(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){bs[i]=new ho(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){bs[i]=new ho(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){bs[i]=new ho(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){bs[i]=new ho(i,5,!1,i.toLowerCase(),null,!1,!1)});var uw=/[\-:]([a-z])/g;function hw(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var e=i.replace(uw,hw);bs[e]=new ho(e,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var e=i.replace(uw,hw);bs[e]=new ho(e,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var e=i.replace(uw,hw);bs[e]=new ho(e,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){bs[i]=new ho(i,1,!1,i.toLowerCase(),null,!1,!1)});bs.xlinkHref=new ho("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){bs[i]=new ho(i,1,!1,i.toLowerCase(),null,!0,!0)});function dw(i,e,n,r){var s=bs.hasOwnProperty(e)?bs[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(SH(e,n,s,r)&&(n=null),r||s===null?EH(e)&&(n===null?i.removeAttribute(e):i.setAttribute(e,""+n)):s.mustUseProperty?i[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?i.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?i.setAttributeNS(r,e,n):i.setAttribute(e,n))))}var ku=vH.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Iy=Symbol.for("react.element"),cg=Symbol.for("react.portal"),ug=Symbol.for("react.fragment"),fw=Symbol.for("react.strict_mode"),hx=Symbol.for("react.profiler"),_P=Symbol.for("react.provider"),vP=Symbol.for("react.context"),pw=Symbol.for("react.forward_ref"),dx=Symbol.for("react.suspense"),fx=Symbol.for("react.suspense_list"),mw=Symbol.for("react.memo"),Bh=Symbol.for("react.lazy"),TP=Symbol.for("react.offscreen"),gO=Symbol.iterator;function xv(i){return i===null||typeof i!="object"?null:(i=gO&&i[gO]||i["@@iterator"],typeof i=="function"?i:null)}var sr=Object.assign,IA;function hT(i){if(IA===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);IA=e&&e[1]||""}return`
`+IA+i}var OA=!1;function LA(i,e){if(!i||OA)return"";OA=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(h){var r=h}Reflect.construct(i,[],e)}else{try{e.call()}catch(h){r=h}i.call(e.prototype)}else{try{throw Error()}catch(h){r=h}i()}}catch(h){if(h&&r&&typeof h.stack=="string"){for(var s=h.stack.split(`
`),a=r.stack.split(`
`),l=s.length-1,u=a.length-1;1<=l&&0<=u&&s[l]!==a[u];)u--;for(;1<=l&&0<=u;l--,u--)if(s[l]!==a[u]){if(l!==1||u!==1)do if(l--,u--,0>u||s[l]!==a[u]){var d=`
`+s[l].replace(" at new "," at ");return i.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",i.displayName)),d}while(1<=l&&0<=u);break}}}finally{OA=!1,Error.prepareStackTrace=n}return(i=i?i.displayName||i.name:"")?hT(i):""}function $H(i){switch(i.tag){case 5:return hT(i.type);case 16:return hT("Lazy");case 13:return hT("Suspense");case 19:return hT("SuspenseList");case 0:case 2:case 15:return i=LA(i.type,!1),i;case 11:return i=LA(i.type.render,!1),i;case 1:return i=LA(i.type,!0),i;default:return""}}function px(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case ug:return"Fragment";case cg:return"Portal";case hx:return"Profiler";case fw:return"StrictMode";case dx:return"Suspense";case fx:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case vP:return(i.displayName||"Context")+".Consumer";case _P:return(i._context.displayName||"Context")+".Provider";case pw:var e=i.render;return i=i.displayName,i||(i=e.displayName||e.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case mw:return e=i.displayName||null,e!==null?e:px(i.type)||"Memo";case Bh:e=i._payload,i=i._init;try{return px(i(e))}catch{}}return null}function bH(i){var e=i.type;switch(i.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=e.render,i=i.displayName||i.name||"",e.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return px(e);case 8:return e===fw?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function rd(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function EP(i){var e=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function AH(i){var e=EP(i)?"checked":"value",n=Object.getOwnPropertyDescriptor(i.constructor.prototype,e),r=""+i[e];if(!i.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,a=n.set;return Object.defineProperty(i,e,{configurable:!0,get:function(){return s.call(this)},set:function(l){r=""+l,a.call(this,l)}}),Object.defineProperty(i,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(l){r=""+l},stopTracking:function(){i._valueTracker=null,delete i[e]}}}}function Oy(i){i._valueTracker||(i._valueTracker=AH(i))}function yP(i){if(!i)return!1;var e=i._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return i&&(r=EP(i)?i.checked?"true":"false":i.value),i=r,i!==n?(e.setValue(i),!0):!1}function TS(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function mx(i,e){var n=e.checked;return sr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??i._wrapperState.initialChecked})}function _O(i,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=rd(e.value!=null?e.value:n),i._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function SP(i,e){e=e.checked,e!=null&&dw(i,"checked",e,!1)}function gx(i,e){SP(i,e);var n=rd(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&i.value===""||i.value!=n)&&(i.value=""+n):i.value!==""+n&&(i.value=""+n);else if(r==="submit"||r==="reset"){i.removeAttribute("value");return}e.hasOwnProperty("value")?_x(i,e.type,n):e.hasOwnProperty("defaultValue")&&_x(i,e.type,rd(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(i.defaultChecked=!!e.defaultChecked)}function vO(i,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+i._wrapperState.initialValue,n||e===i.value||(i.value=e),i.defaultValue=e}n=i.name,n!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,n!==""&&(i.name=n)}function _x(i,e,n){(e!=="number"||TS(i.ownerDocument)!==i)&&(n==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+n&&(i.defaultValue=""+n))}var dT=Array.isArray;function Cg(i,e,n,r){if(i=i.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<i.length;n++)s=e.hasOwnProperty("$"+i[n].value),i[n].selected!==s&&(i[n].selected=s),s&&r&&(i[n].defaultSelected=!0)}else{for(n=""+rd(n),e=null,s=0;s<i.length;s++){if(i[s].value===n){i[s].selected=!0,r&&(i[s].defaultSelected=!0);return}e!==null||i[s].disabled||(e=i[s])}e!==null&&(e.selected=!0)}}function vx(i,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Mt(91));return sr({},e,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function TO(i,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Mt(92));if(dT(n)){if(1<n.length)throw Error(Mt(93));n=n[0]}e=n}e==null&&(e=""),n=e}i._wrapperState={initialValue:rd(n)}}function $P(i,e){var n=rd(e.value),r=rd(e.defaultValue);n!=null&&(n=""+n,n!==i.value&&(i.value=n),e.defaultValue==null&&i.defaultValue!==n&&(i.defaultValue=n)),r!=null&&(i.defaultValue=""+r)}function EO(i){var e=i.textContent;e===i._wrapperState.initialValue&&e!==""&&e!==null&&(i.value=e)}function bP(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Tx(i,e){return i==null||i==="http://www.w3.org/1999/xhtml"?bP(e):i==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var Ly,AP=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return i(e,n,r,s)})}:i}(function(i,e){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=e;else{for(Ly=Ly||document.createElement("div"),Ly.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ly.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;e.firstChild;)i.appendChild(e.firstChild)}});function kT(i,e){if(e){var n=i.firstChild;if(n&&n===i.lastChild&&n.nodeType===3){n.nodeValue=e;return}}i.textContent=e}var _T={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},CH=["Webkit","ms","Moz","O"];Object.keys(_T).forEach(function(i){CH.forEach(function(e){e=e+i.charAt(0).toUpperCase()+i.substring(1),_T[e]=_T[i]})});function CP(i,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||_T.hasOwnProperty(i)&&_T[i]?(""+e).trim():e+"px"}function xP(i,e){i=i.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=CP(n,e[n],r);n==="float"&&(n="cssFloat"),r?i.setProperty(n,s):i[n]=s}}var xH=sr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ex(i,e){if(e){if(xH[i]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Mt(137,i));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Mt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Mt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Mt(62))}}function yx(i,e){if(i.indexOf("-")===-1)return typeof e.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sx=null;function gw(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var $x=null,xg=null,Rg=null;function yO(i){if(i=mE(i)){if(typeof $x!="function")throw Error(Mt(280));var e=i.stateNode;e&&(e=u$(e),$x(i.stateNode,i.type,e))}}function RP(i){xg?Rg?Rg.push(i):Rg=[i]:xg=i}function wP(){if(xg){var i=xg,e=Rg;if(Rg=xg=null,yO(i),e)for(i=0;i<e.length;i++)yO(e[i])}}function MP(i,e){return i(e)}function IP(){}var NA=!1;function OP(i,e,n){if(NA)return i(e,n);NA=!0;try{return MP(i,e,n)}finally{NA=!1,(xg!==null||Rg!==null)&&(IP(),wP())}}function PT(i,e){var n=i.stateNode;if(n===null)return null;var r=u$(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(i=i.type,r=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!r;break e;default:i=!1}if(i)return null;if(n&&typeof n!="function")throw Error(Mt(231,e,typeof n));return n}var bx=!1;if(Ru)try{var Rv={};Object.defineProperty(Rv,"passive",{get:function(){bx=!0}}),window.addEventListener("test",Rv,Rv),window.removeEventListener("test",Rv,Rv)}catch{bx=!1}function RH(i,e,n,r,s,a,l,u,d){var h=Array.prototype.slice.call(arguments,3);try{e.apply(n,h)}catch(f){this.onError(f)}}var vT=!1,ES=null,yS=!1,Ax=null,wH={onError:function(i){vT=!0,ES=i}};function MH(i,e,n,r,s,a,l,u,d){vT=!1,ES=null,RH.apply(wH,arguments)}function IH(i,e,n,r,s,a,l,u,d){if(MH.apply(this,arguments),vT){if(vT){var h=ES;vT=!1,ES=null}else throw Error(Mt(198));yS||(yS=!0,Ax=h)}}function Rp(i){var e=i,n=i;if(i.alternate)for(;e.return;)e=e.return;else{i=e;do e=i,e.flags&4098&&(n=e.return),i=e.return;while(i)}return e.tag===3?n:null}function LP(i){if(i.tag===13){var e=i.memoizedState;if(e===null&&(i=i.alternate,i!==null&&(e=i.memoizedState)),e!==null)return e.dehydrated}return null}function SO(i){if(Rp(i)!==i)throw Error(Mt(188))}function OH(i){var e=i.alternate;if(!e){if(e=Rp(i),e===null)throw Error(Mt(188));return e!==i?null:i}for(var n=i,r=e;;){var s=n.return;if(s===null)break;var a=s.alternate;if(a===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===n)return SO(s),i;if(a===r)return SO(s),e;a=a.sibling}throw Error(Mt(188))}if(n.return!==r.return)n=s,r=a;else{for(var l=!1,u=s.child;u;){if(u===n){l=!0,n=s,r=a;break}if(u===r){l=!0,r=s,n=a;break}u=u.sibling}if(!l){for(u=a.child;u;){if(u===n){l=!0,n=a,r=s;break}if(u===r){l=!0,r=a,n=s;break}u=u.sibling}if(!l)throw Error(Mt(189))}}if(n.alternate!==r)throw Error(Mt(190))}if(n.tag!==3)throw Error(Mt(188));return n.stateNode.current===n?i:e}function NP(i){return i=OH(i),i!==null?kP(i):null}function kP(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var e=kP(i);if(e!==null)return e;i=i.sibling}return null}var PP=ha.unstable_scheduleCallback,$O=ha.unstable_cancelCallback,LH=ha.unstable_shouldYield,NH=ha.unstable_requestPaint,Tr=ha.unstable_now,kH=ha.unstable_getCurrentPriorityLevel,_w=ha.unstable_ImmediatePriority,DP=ha.unstable_UserBlockingPriority,SS=ha.unstable_NormalPriority,PH=ha.unstable_LowPriority,BP=ha.unstable_IdlePriority,o$=null,bc=null;function DH(i){if(bc&&typeof bc.onCommitFiberRoot=="function")try{bc.onCommitFiberRoot(o$,i,void 0,(i.current.flags&128)===128)}catch{}}var Il=Math.clz32?Math.clz32:UH,BH=Math.log,FH=Math.LN2;function UH(i){return i>>>=0,i===0?32:31-(BH(i)/FH|0)|0}var Ny=64,ky=4194304;function fT(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function $S(i,e){var n=i.pendingLanes;if(n===0)return 0;var r=0,s=i.suspendedLanes,a=i.pingedLanes,l=n&268435455;if(l!==0){var u=l&~s;u!==0?r=fT(u):(a&=l,a!==0&&(r=fT(a)))}else l=n&~s,l!==0?r=fT(l):a!==0&&(r=fT(a));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,a=e&-e,s>=a||s===16&&(a&4194240)!==0))return e;if(r&4&&(r|=n&16),e=i.entangledLanes,e!==0)for(i=i.entanglements,e&=r;0<e;)n=31-Il(e),s=1<<n,r|=i[n],e&=~s;return r}function GH(i,e){switch(i){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function HH(i,e){for(var n=i.suspendedLanes,r=i.pingedLanes,s=i.expirationTimes,a=i.pendingLanes;0<a;){var l=31-Il(a),u=1<<l,d=s[l];d===-1?(!(u&n)||u&r)&&(s[l]=GH(u,e)):d<=e&&(i.expiredLanes|=u),a&=~u}}function Cx(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function FP(){var i=Ny;return Ny<<=1,!(Ny&4194240)&&(Ny=64),i}function kA(i){for(var e=[],n=0;31>n;n++)e.push(i);return e}function fE(i,e,n){i.pendingLanes|=e,e!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,e=31-Il(e),i[e]=n}function VH(i,e){var n=i.pendingLanes&~e;i.pendingLanes=e,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=e,i.mutableReadLanes&=e,i.entangledLanes&=e,e=i.entanglements;var r=i.eventTimes;for(i=i.expirationTimes;0<n;){var s=31-Il(n),a=1<<s;e[s]=0,r[s]=-1,i[s]=-1,n&=~a}}function vw(i,e){var n=i.entangledLanes|=e;for(i=i.entanglements;n;){var r=31-Il(n),s=1<<r;s&e|i[r]&e&&(i[r]|=e),n&=~s}}var Ai=0;function UP(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var GP,Tw,HP,VP,zP,xx=!1,Py=[],jh=null,Yh=null,Kh=null,DT=new Map,BT=new Map,Gh=[],zH="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function bO(i,e){switch(i){case"focusin":case"focusout":jh=null;break;case"dragenter":case"dragleave":Yh=null;break;case"mouseover":case"mouseout":Kh=null;break;case"pointerover":case"pointerout":DT.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":BT.delete(e.pointerId)}}function wv(i,e,n,r,s,a){return i===null||i.nativeEvent!==a?(i={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[s]},e!==null&&(e=mE(e),e!==null&&Tw(e)),i):(i.eventSystemFlags|=r,e=i.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),i)}function WH(i,e,n,r,s){switch(e){case"focusin":return jh=wv(jh,i,e,n,r,s),!0;case"dragenter":return Yh=wv(Yh,i,e,n,r,s),!0;case"mouseover":return Kh=wv(Kh,i,e,n,r,s),!0;case"pointerover":var a=s.pointerId;return DT.set(a,wv(DT.get(a)||null,i,e,n,r,s)),!0;case"gotpointercapture":return a=s.pointerId,BT.set(a,wv(BT.get(a)||null,i,e,n,r,s)),!0}return!1}function WP(i){var e=Vf(i.target);if(e!==null){var n=Rp(e);if(n!==null){if(e=n.tag,e===13){if(e=LP(n),e!==null){i.blockedOn=e,zP(i.priority,function(){HP(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){i.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Q0(i){if(i.blockedOn!==null)return!1;for(var e=i.targetContainers;0<e.length;){var n=Rx(i.domEventName,i.eventSystemFlags,e[0],i.nativeEvent);if(n===null){n=i.nativeEvent;var r=new n.constructor(n.type,n);Sx=r,n.target.dispatchEvent(r),Sx=null}else return e=mE(n),e!==null&&Tw(e),i.blockedOn=n,!1;e.shift()}return!0}function AO(i,e,n){Q0(i)&&n.delete(e)}function XH(){xx=!1,jh!==null&&Q0(jh)&&(jh=null),Yh!==null&&Q0(Yh)&&(Yh=null),Kh!==null&&Q0(Kh)&&(Kh=null),DT.forEach(AO),BT.forEach(AO)}function Mv(i,e){i.blockedOn===e&&(i.blockedOn=null,xx||(xx=!0,ha.unstable_scheduleCallback(ha.unstable_NormalPriority,XH)))}function FT(i){function e(s){return Mv(s,i)}if(0<Py.length){Mv(Py[0],i);for(var n=1;n<Py.length;n++){var r=Py[n];r.blockedOn===i&&(r.blockedOn=null)}}for(jh!==null&&Mv(jh,i),Yh!==null&&Mv(Yh,i),Kh!==null&&Mv(Kh,i),DT.forEach(e),BT.forEach(e),n=0;n<Gh.length;n++)r=Gh[n],r.blockedOn===i&&(r.blockedOn=null);for(;0<Gh.length&&(n=Gh[0],n.blockedOn===null);)WP(n),n.blockedOn===null&&Gh.shift()}var wg=ku.ReactCurrentBatchConfig,bS=!0;function jH(i,e,n,r){var s=Ai,a=wg.transition;wg.transition=null;try{Ai=1,Ew(i,e,n,r)}finally{Ai=s,wg.transition=a}}function YH(i,e,n,r){var s=Ai,a=wg.transition;wg.transition=null;try{Ai=4,Ew(i,e,n,r)}finally{Ai=s,wg.transition=a}}function Ew(i,e,n,r){if(bS){var s=Rx(i,e,n,r);if(s===null)WA(i,e,r,AS,n),bO(i,r);else if(WH(s,i,e,n,r))r.stopPropagation();else if(bO(i,r),e&4&&-1<zH.indexOf(i)){for(;s!==null;){var a=mE(s);if(a!==null&&GP(a),a=Rx(i,e,n,r),a===null&&WA(i,e,r,AS,n),a===s)break;s=a}s!==null&&r.stopPropagation()}else WA(i,e,r,null,n)}}var AS=null;function Rx(i,e,n,r){if(AS=null,i=gw(r),i=Vf(i),i!==null)if(e=Rp(i),e===null)i=null;else if(n=e.tag,n===13){if(i=LP(e),i!==null)return i;i=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;i=null}else e!==i&&(i=null);return AS=i,null}function XP(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(kH()){case _w:return 1;case DP:return 4;case SS:case PH:return 16;case BP:return 536870912;default:return 16}default:return 16}}var Vh=null,yw=null,eS=null;function jP(){if(eS)return eS;var i,e=yw,n=e.length,r,s="value"in Vh?Vh.value:Vh.textContent,a=s.length;for(i=0;i<n&&e[i]===s[i];i++);var l=n-i;for(r=1;r<=l&&e[n-r]===s[a-r];r++);return eS=s.slice(i,1<r?1-r:void 0)}function tS(i){var e=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&e===13&&(i=13)):i=e,i===10&&(i=13),32<=i||i===13?i:0}function Dy(){return!0}function CO(){return!1}function pa(i){function e(n,r,s,a,l){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=a,this.target=l,this.currentTarget=null;for(var u in i)i.hasOwnProperty(u)&&(n=i[u],this[u]=n?n(a):a[u]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?Dy:CO,this.isPropagationStopped=CO,this}return sr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Dy)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Dy)},persist:function(){},isPersistent:Dy}),e}var Jg={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Sw=pa(Jg),pE=sr({},Jg,{view:0,detail:0}),KH=pa(pE),PA,DA,Iv,a$=sr({},pE,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$w,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Iv&&(Iv&&i.type==="mousemove"?(PA=i.screenX-Iv.screenX,DA=i.screenY-Iv.screenY):DA=PA=0,Iv=i),PA)},movementY:function(i){return"movementY"in i?i.movementY:DA}}),xO=pa(a$),JH=sr({},a$,{dataTransfer:0}),ZH=pa(JH),qH=sr({},pE,{relatedTarget:0}),BA=pa(qH),QH=sr({},Jg,{animationName:0,elapsedTime:0,pseudoElement:0}),e3=pa(QH),t3=sr({},Jg,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),n3=pa(t3),i3=sr({},Jg,{data:0}),RO=pa(i3),r3={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},s3={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},o3={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function a3(i){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(i):(i=o3[i])?!!e[i]:!1}function $w(){return a3}var l3=sr({},pE,{key:function(i){if(i.key){var e=r3[i.key]||i.key;if(e!=="Unidentified")return e}return i.type==="keypress"?(i=tS(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?s3[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$w,charCode:function(i){return i.type==="keypress"?tS(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?tS(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),c3=pa(l3),u3=sr({},a$,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wO=pa(u3),h3=sr({},pE,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$w}),d3=pa(h3),f3=sr({},Jg,{propertyName:0,elapsedTime:0,pseudoElement:0}),p3=pa(f3),m3=sr({},a$,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),g3=pa(m3),_3=[9,13,27,32],bw=Ru&&"CompositionEvent"in window,TT=null;Ru&&"documentMode"in document&&(TT=document.documentMode);var v3=Ru&&"TextEvent"in window&&!TT,YP=Ru&&(!bw||TT&&8<TT&&11>=TT),MO=String.fromCharCode(32),IO=!1;function KP(i,e){switch(i){case"keyup":return _3.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function JP(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var hg=!1;function T3(i,e){switch(i){case"compositionend":return JP(e);case"keypress":return e.which!==32?null:(IO=!0,MO);case"textInput":return i=e.data,i===MO&&IO?null:i;default:return null}}function E3(i,e){if(hg)return i==="compositionend"||!bw&&KP(i,e)?(i=jP(),eS=yw=Vh=null,hg=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return YP&&e.locale!=="ko"?null:e.data;default:return null}}var y3={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function OO(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e==="input"?!!y3[i.type]:e==="textarea"}function ZP(i,e,n,r){RP(r),e=CS(e,"onChange"),0<e.length&&(n=new Sw("onChange","change",null,n,r),i.push({event:n,listeners:e}))}var ET=null,UT=null;function S3(i){lD(i,0)}function l$(i){var e=pg(i);if(yP(e))return i}function $3(i,e){if(i==="change")return e}var qP=!1;if(Ru){var FA;if(Ru){var UA="oninput"in document;if(!UA){var LO=document.createElement("div");LO.setAttribute("oninput","return;"),UA=typeof LO.oninput=="function"}FA=UA}else FA=!1;qP=FA&&(!document.documentMode||9<document.documentMode)}function NO(){ET&&(ET.detachEvent("onpropertychange",QP),UT=ET=null)}function QP(i){if(i.propertyName==="value"&&l$(UT)){var e=[];ZP(e,UT,i,gw(i)),OP(S3,e)}}function b3(i,e,n){i==="focusin"?(NO(),ET=e,UT=n,ET.attachEvent("onpropertychange",QP)):i==="focusout"&&NO()}function A3(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return l$(UT)}function C3(i,e){if(i==="click")return l$(e)}function x3(i,e){if(i==="input"||i==="change")return l$(e)}function R3(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var kl=typeof Object.is=="function"?Object.is:R3;function GT(i,e){if(kl(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;var n=Object.keys(i),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!ux.call(e,s)||!kl(i[s],e[s]))return!1}return!0}function kO(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function PO(i,e){var n=kO(i);i=0;for(var r;n;){if(n.nodeType===3){if(r=i+n.textContent.length,i<=e&&r>=e)return{node:n,offset:e-i};i=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=kO(n)}}function eD(i,e){return i&&e?i===e?!0:i&&i.nodeType===3?!1:e&&e.nodeType===3?eD(i,e.parentNode):"contains"in i?i.contains(e):i.compareDocumentPosition?!!(i.compareDocumentPosition(e)&16):!1:!1}function tD(){for(var i=window,e=TS();e instanceof i.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)i=e.contentWindow;else break;e=TS(i.document)}return e}function Aw(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e&&(e==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||e==="textarea"||i.contentEditable==="true")}function w3(i){var e=tD(),n=i.focusedElem,r=i.selectionRange;if(e!==n&&n&&n.ownerDocument&&eD(n.ownerDocument.documentElement,n)){if(r!==null&&Aw(n)){if(e=r.start,i=r.end,i===void 0&&(i=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(i,n.value.length);else if(i=(e=n.ownerDocument||document)&&e.defaultView||window,i.getSelection){i=i.getSelection();var s=n.textContent.length,a=Math.min(r.start,s);r=r.end===void 0?a:Math.min(r.end,s),!i.extend&&a>r&&(s=r,r=a,a=s),s=PO(n,a);var l=PO(n,r);s&&l&&(i.rangeCount!==1||i.anchorNode!==s.node||i.anchorOffset!==s.offset||i.focusNode!==l.node||i.focusOffset!==l.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),i.removeAllRanges(),a>r?(i.addRange(e),i.extend(l.node,l.offset)):(e.setEnd(l.node,l.offset),i.addRange(e)))}}for(e=[],i=n;i=i.parentNode;)i.nodeType===1&&e.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)i=e[n],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var M3=Ru&&"documentMode"in document&&11>=document.documentMode,dg=null,wx=null,yT=null,Mx=!1;function DO(i,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Mx||dg==null||dg!==TS(r)||(r=dg,"selectionStart"in r&&Aw(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),yT&&GT(yT,r)||(yT=r,r=CS(wx,"onSelect"),0<r.length&&(e=new Sw("onSelect","select",null,e,n),i.push({event:e,listeners:r}),e.target=dg)))}function By(i,e){var n={};return n[i.toLowerCase()]=e.toLowerCase(),n["Webkit"+i]="webkit"+e,n["Moz"+i]="moz"+e,n}var fg={animationend:By("Animation","AnimationEnd"),animationiteration:By("Animation","AnimationIteration"),animationstart:By("Animation","AnimationStart"),transitionend:By("Transition","TransitionEnd")},GA={},nD={};Ru&&(nD=document.createElement("div").style,"AnimationEvent"in window||(delete fg.animationend.animation,delete fg.animationiteration.animation,delete fg.animationstart.animation),"TransitionEvent"in window||delete fg.transitionend.transition);function c$(i){if(GA[i])return GA[i];if(!fg[i])return i;var e=fg[i],n;for(n in e)if(e.hasOwnProperty(n)&&n in nD)return GA[i]=e[n];return i}var iD=c$("animationend"),rD=c$("animationiteration"),sD=c$("animationstart"),oD=c$("transitionend"),aD=new Map,BO="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function dd(i,e){aD.set(i,e),xp(e,[i])}for(var HA=0;HA<BO.length;HA++){var VA=BO[HA],I3=VA.toLowerCase(),O3=VA[0].toUpperCase()+VA.slice(1);dd(I3,"on"+O3)}dd(iD,"onAnimationEnd");dd(rD,"onAnimationIteration");dd(sD,"onAnimationStart");dd("dblclick","onDoubleClick");dd("focusin","onFocus");dd("focusout","onBlur");dd(oD,"onTransitionEnd");Pg("onMouseEnter",["mouseout","mouseover"]);Pg("onMouseLeave",["mouseout","mouseover"]);Pg("onPointerEnter",["pointerout","pointerover"]);Pg("onPointerLeave",["pointerout","pointerover"]);xp("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));xp("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));xp("onBeforeInput",["compositionend","keypress","textInput","paste"]);xp("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));xp("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));xp("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var pT="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),L3=new Set("cancel close invalid load scroll toggle".split(" ").concat(pT));function FO(i,e,n){var r=i.type||"unknown-event";i.currentTarget=n,IH(r,e,void 0,i),i.currentTarget=null}function lD(i,e){e=(e&4)!==0;for(var n=0;n<i.length;n++){var r=i[n],s=r.event;r=r.listeners;e:{var a=void 0;if(e)for(var l=r.length-1;0<=l;l--){var u=r[l],d=u.instance,h=u.currentTarget;if(u=u.listener,d!==a&&s.isPropagationStopped())break e;FO(s,u,h),a=d}else for(l=0;l<r.length;l++){if(u=r[l],d=u.instance,h=u.currentTarget,u=u.listener,d!==a&&s.isPropagationStopped())break e;FO(s,u,h),a=d}}}if(yS)throw i=Ax,yS=!1,Ax=null,i}function Bi(i,e){var n=e[kx];n===void 0&&(n=e[kx]=new Set);var r=i+"__bubble";n.has(r)||(cD(e,i,2,!1),n.add(r))}function zA(i,e,n){var r=0;e&&(r|=4),cD(n,i,r,e)}var Fy="_reactListening"+Math.random().toString(36).slice(2);function HT(i){if(!i[Fy]){i[Fy]=!0,gP.forEach(function(n){n!=="selectionchange"&&(L3.has(n)||zA(n,!1,i),zA(n,!0,i))});var e=i.nodeType===9?i:i.ownerDocument;e===null||e[Fy]||(e[Fy]=!0,zA("selectionchange",!1,e))}}function cD(i,e,n,r){switch(XP(e)){case 1:var s=jH;break;case 4:s=YH;break;default:s=Ew}n=s.bind(null,e,n,i),s=void 0,!bx||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?i.addEventListener(e,n,{capture:!0,passive:s}):i.addEventListener(e,n,!0):s!==void 0?i.addEventListener(e,n,{passive:s}):i.addEventListener(e,n,!1)}function WA(i,e,n,r,s){var a=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var l=r.tag;if(l===3||l===4){var u=r.stateNode.containerInfo;if(u===s||u.nodeType===8&&u.parentNode===s)break;if(l===4)for(l=r.return;l!==null;){var d=l.tag;if((d===3||d===4)&&(d=l.stateNode.containerInfo,d===s||d.nodeType===8&&d.parentNode===s))return;l=l.return}for(;u!==null;){if(l=Vf(u),l===null)return;if(d=l.tag,d===5||d===6){r=a=l;continue e}u=u.parentNode}}r=r.return}OP(function(){var h=a,f=gw(n),p=[];e:{var m=aD.get(i);if(m!==void 0){var T=Sw,E=i;switch(i){case"keypress":if(tS(n)===0)break e;case"keydown":case"keyup":T=c3;break;case"focusin":E="focus",T=BA;break;case"focusout":E="blur",T=BA;break;case"beforeblur":case"afterblur":T=BA;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":T=xO;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":T=ZH;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":T=d3;break;case iD:case rD:case sD:T=e3;break;case oD:T=p3;break;case"scroll":T=KH;break;case"wheel":T=g3;break;case"copy":case"cut":case"paste":T=n3;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":T=wO}var b=(e&4)!==0,y=!b&&i==="scroll",S=b?m!==null?m+"Capture":null:m;b=[];for(var A=h,C;A!==null;){C=A;var R=C.stateNode;if(C.tag===5&&R!==null&&(C=R,S!==null&&(R=PT(A,S),R!=null&&b.push(VT(A,R,C)))),y)break;A=A.return}0<b.length&&(m=new T(m,E,null,n,f),p.push({event:m,listeners:b}))}}if(!(e&7)){e:{if(m=i==="mouseover"||i==="pointerover",T=i==="mouseout"||i==="pointerout",m&&n!==Sx&&(E=n.relatedTarget||n.fromElement)&&(Vf(E)||E[wu]))break e;if((T||m)&&(m=f.window===f?f:(m=f.ownerDocument)?m.defaultView||m.parentWindow:window,T?(E=n.relatedTarget||n.toElement,T=h,E=E?Vf(E):null,E!==null&&(y=Rp(E),E!==y||E.tag!==5&&E.tag!==6)&&(E=null)):(T=null,E=h),T!==E)){if(b=xO,R="onMouseLeave",S="onMouseEnter",A="mouse",(i==="pointerout"||i==="pointerover")&&(b=wO,R="onPointerLeave",S="onPointerEnter",A="pointer"),y=T==null?m:pg(T),C=E==null?m:pg(E),m=new b(R,A+"leave",T,n,f),m.target=y,m.relatedTarget=C,R=null,Vf(f)===h&&(b=new b(S,A+"enter",E,n,f),b.target=C,b.relatedTarget=y,R=b),y=R,T&&E)t:{for(b=T,S=E,A=0,C=b;C;C=Nm(C))A++;for(C=0,R=S;R;R=Nm(R))C++;for(;0<A-C;)b=Nm(b),A--;for(;0<C-A;)S=Nm(S),C--;for(;A--;){if(b===S||S!==null&&b===S.alternate)break t;b=Nm(b),S=Nm(S)}b=null}else b=null;T!==null&&UO(p,m,T,b,!1),E!==null&&y!==null&&UO(p,y,E,b,!0)}}e:{if(m=h?pg(h):window,T=m.nodeName&&m.nodeName.toLowerCase(),T==="select"||T==="input"&&m.type==="file")var I=$3;else if(OO(m))if(qP)I=x3;else{I=A3;var O=b3}else(T=m.nodeName)&&T.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(I=C3);if(I&&(I=I(i,h))){ZP(p,I,n,f);break e}O&&O(i,m,h),i==="focusout"&&(O=m._wrapperState)&&O.controlled&&m.type==="number"&&_x(m,"number",m.value)}switch(O=h?pg(h):window,i){case"focusin":(OO(O)||O.contentEditable==="true")&&(dg=O,wx=h,yT=null);break;case"focusout":yT=wx=dg=null;break;case"mousedown":Mx=!0;break;case"contextmenu":case"mouseup":case"dragend":Mx=!1,DO(p,n,f);break;case"selectionchange":if(M3)break;case"keydown":case"keyup":DO(p,n,f)}var F;if(bw)e:{switch(i){case"compositionstart":var k="onCompositionStart";break e;case"compositionend":k="onCompositionEnd";break e;case"compositionupdate":k="onCompositionUpdate";break e}k=void 0}else hg?KP(i,n)&&(k="onCompositionEnd"):i==="keydown"&&n.keyCode===229&&(k="onCompositionStart");k&&(YP&&n.locale!=="ko"&&(hg||k!=="onCompositionStart"?k==="onCompositionEnd"&&hg&&(F=jP()):(Vh=f,yw="value"in Vh?Vh.value:Vh.textContent,hg=!0)),O=CS(h,k),0<O.length&&(k=new RO(k,i,null,n,f),p.push({event:k,listeners:O}),F?k.data=F:(F=JP(n),F!==null&&(k.data=F)))),(F=v3?T3(i,n):E3(i,n))&&(h=CS(h,"onBeforeInput"),0<h.length&&(f=new RO("onBeforeInput","beforeinput",null,n,f),p.push({event:f,listeners:h}),f.data=F))}lD(p,e)})}function VT(i,e,n){return{instance:i,listener:e,currentTarget:n}}function CS(i,e){for(var n=e+"Capture",r=[];i!==null;){var s=i,a=s.stateNode;s.tag===5&&a!==null&&(s=a,a=PT(i,n),a!=null&&r.unshift(VT(i,a,s)),a=PT(i,e),a!=null&&r.push(VT(i,a,s))),i=i.return}return r}function Nm(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function UO(i,e,n,r,s){for(var a=e._reactName,l=[];n!==null&&n!==r;){var u=n,d=u.alternate,h=u.stateNode;if(d!==null&&d===r)break;u.tag===5&&h!==null&&(u=h,s?(d=PT(n,a),d!=null&&l.unshift(VT(n,d,u))):s||(d=PT(n,a),d!=null&&l.push(VT(n,d,u)))),n=n.return}l.length!==0&&i.push({event:e,listeners:l})}var N3=/\r\n?/g,k3=/\u0000|\uFFFD/g;function GO(i){return(typeof i=="string"?i:""+i).replace(N3,`
`).replace(k3,"")}function Uy(i,e,n){if(e=GO(e),GO(i)!==e&&n)throw Error(Mt(425))}function xS(){}var Ix=null,Ox=null;function Lx(i,e){return i==="textarea"||i==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Nx=typeof setTimeout=="function"?setTimeout:void 0,P3=typeof clearTimeout=="function"?clearTimeout:void 0,HO=typeof Promise=="function"?Promise:void 0,D3=typeof queueMicrotask=="function"?queueMicrotask:typeof HO<"u"?function(i){return HO.resolve(null).then(i).catch(B3)}:Nx;function B3(i){setTimeout(function(){throw i})}function XA(i,e){var n=e,r=0;do{var s=n.nextSibling;if(i.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){i.removeChild(s),FT(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);FT(e)}function Jh(i){for(;i!=null;i=i.nextSibling){var e=i.nodeType;if(e===1||e===3)break;if(e===8){if(e=i.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return i}function VO(i){i=i.previousSibling;for(var e=0;i;){if(i.nodeType===8){var n=i.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return i;e--}else n==="/$"&&e++}i=i.previousSibling}return null}var Zg=Math.random().toString(36).slice(2),Ec="__reactFiber$"+Zg,zT="__reactProps$"+Zg,wu="__reactContainer$"+Zg,kx="__reactEvents$"+Zg,F3="__reactListeners$"+Zg,U3="__reactHandles$"+Zg;function Vf(i){var e=i[Ec];if(e)return e;for(var n=i.parentNode;n;){if(e=n[wu]||n[Ec]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(i=VO(i);i!==null;){if(n=i[Ec])return n;i=VO(i)}return e}i=n,n=i.parentNode}return null}function mE(i){return i=i[Ec]||i[wu],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function pg(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Mt(33))}function u$(i){return i[zT]||null}var Px=[],mg=-1;function fd(i){return{current:i}}function Hi(i){0>mg||(i.current=Px[mg],Px[mg]=null,mg--)}function ki(i,e){mg++,Px[mg]=i.current,i.current=e}var sd={},Ws=fd(sd),Ro=fd(!1),mp=sd;function Dg(i,e){var n=i.type.contextTypes;if(!n)return sd;var r=i.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},a;for(a in n)s[a]=e[a];return r&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=e,i.__reactInternalMemoizedMaskedChildContext=s),s}function wo(i){return i=i.childContextTypes,i!=null}function RS(){Hi(Ro),Hi(Ws)}function zO(i,e,n){if(Ws.current!==sd)throw Error(Mt(168));ki(Ws,e),ki(Ro,n)}function uD(i,e,n){var r=i.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Mt(108,bH(i)||"Unknown",s));return sr({},n,r)}function wS(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||sd,mp=Ws.current,ki(Ws,i),ki(Ro,Ro.current),!0}function WO(i,e,n){var r=i.stateNode;if(!r)throw Error(Mt(169));n?(i=uD(i,e,mp),r.__reactInternalMemoizedMergedChildContext=i,Hi(Ro),Hi(Ws),ki(Ws,i)):Hi(Ro),ki(Ro,n)}var Tu=null,h$=!1,jA=!1;function hD(i){Tu===null?Tu=[i]:Tu.push(i)}function G3(i){h$=!0,hD(i)}function pd(){if(!jA&&Tu!==null){jA=!0;var i=0,e=Ai;try{var n=Tu;for(Ai=1;i<n.length;i++){var r=n[i];do r=r(!0);while(r!==null)}Tu=null,h$=!1}catch(s){throw Tu!==null&&(Tu=Tu.slice(i+1)),PP(_w,pd),s}finally{Ai=e,jA=!1}}return null}var gg=[],_g=0,MS=null,IS=0,Ua=[],Ga=0,gp=null,bu=1,Au="";function kf(i,e){gg[_g++]=IS,gg[_g++]=MS,MS=i,IS=e}function dD(i,e,n){Ua[Ga++]=bu,Ua[Ga++]=Au,Ua[Ga++]=gp,gp=i;var r=bu;i=Au;var s=32-Il(r)-1;r&=~(1<<s),n+=1;var a=32-Il(e)+s;if(30<a){var l=s-s%5;a=(r&(1<<l)-1).toString(32),r>>=l,s-=l,bu=1<<32-Il(e)+s|n<<s|r,Au=a+i}else bu=1<<a|n<<s|r,Au=i}function Cw(i){i.return!==null&&(kf(i,1),dD(i,1,0))}function xw(i){for(;i===MS;)MS=gg[--_g],gg[_g]=null,IS=gg[--_g],gg[_g]=null;for(;i===gp;)gp=Ua[--Ga],Ua[Ga]=null,Au=Ua[--Ga],Ua[Ga]=null,bu=Ua[--Ga],Ua[Ga]=null}var aa=null,sa=null,Yi=!1,wl=null;function fD(i,e){var n=Va(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=i,e=i.deletions,e===null?(i.deletions=[n],i.flags|=16):e.push(n)}function XO(i,e){switch(i.tag){case 5:var n=i.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(i.stateNode=e,aa=i,sa=Jh(e.firstChild),!0):!1;case 6:return e=i.pendingProps===""||e.nodeType!==3?null:e,e!==null?(i.stateNode=e,aa=i,sa=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=gp!==null?{id:bu,overflow:Au}:null,i.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Va(18,null,null,0),n.stateNode=e,n.return=i,i.child=n,aa=i,sa=null,!0):!1;default:return!1}}function Dx(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Bx(i){if(Yi){var e=sa;if(e){var n=e;if(!XO(i,e)){if(Dx(i))throw Error(Mt(418));e=Jh(n.nextSibling);var r=aa;e&&XO(i,e)?fD(r,n):(i.flags=i.flags&-4097|2,Yi=!1,aa=i)}}else{if(Dx(i))throw Error(Mt(418));i.flags=i.flags&-4097|2,Yi=!1,aa=i}}}function jO(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;aa=i}function Gy(i){if(i!==aa)return!1;if(!Yi)return jO(i),Yi=!0,!1;var e;if((e=i.tag!==3)&&!(e=i.tag!==5)&&(e=i.type,e=e!=="head"&&e!=="body"&&!Lx(i.type,i.memoizedProps)),e&&(e=sa)){if(Dx(i))throw pD(),Error(Mt(418));for(;e;)fD(i,e),e=Jh(e.nextSibling)}if(jO(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Mt(317));e:{for(i=i.nextSibling,e=0;i;){if(i.nodeType===8){var n=i.data;if(n==="/$"){if(e===0){sa=Jh(i.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}i=i.nextSibling}sa=null}}else sa=aa?Jh(i.stateNode.nextSibling):null;return!0}function pD(){for(var i=sa;i;)i=Jh(i.nextSibling)}function Bg(){sa=aa=null,Yi=!1}function Rw(i){wl===null?wl=[i]:wl.push(i)}var H3=ku.ReactCurrentBatchConfig;function Ov(i,e,n){if(i=n.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Mt(309));var r=n.stateNode}if(!r)throw Error(Mt(147,i));var s=r,a=""+i;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(l){var u=s.refs;l===null?delete u[a]:u[a]=l},e._stringRef=a,e)}if(typeof i!="string")throw Error(Mt(284));if(!n._owner)throw Error(Mt(290,i))}return i}function Hy(i,e){throw i=Object.prototype.toString.call(e),Error(Mt(31,i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i))}function YO(i){var e=i._init;return e(i._payload)}function mD(i){function e(S,A){if(i){var C=S.deletions;C===null?(S.deletions=[A],S.flags|=16):C.push(A)}}function n(S,A){if(!i)return null;for(;A!==null;)e(S,A),A=A.sibling;return null}function r(S,A){for(S=new Map;A!==null;)A.key!==null?S.set(A.key,A):S.set(A.index,A),A=A.sibling;return S}function s(S,A){return S=ed(S,A),S.index=0,S.sibling=null,S}function a(S,A,C){return S.index=C,i?(C=S.alternate,C!==null?(C=C.index,C<A?(S.flags|=2,A):C):(S.flags|=2,A)):(S.flags|=1048576,A)}function l(S){return i&&S.alternate===null&&(S.flags|=2),S}function u(S,A,C,R){return A===null||A.tag!==6?(A=eC(C,S.mode,R),A.return=S,A):(A=s(A,C),A.return=S,A)}function d(S,A,C,R){var I=C.type;return I===ug?f(S,A,C.props.children,R,C.key):A!==null&&(A.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===Bh&&YO(I)===A.type)?(R=s(A,C.props),R.ref=Ov(S,A,C),R.return=S,R):(R=lS(C.type,C.key,C.props,null,S.mode,R),R.ref=Ov(S,A,C),R.return=S,R)}function h(S,A,C,R){return A===null||A.tag!==4||A.stateNode.containerInfo!==C.containerInfo||A.stateNode.implementation!==C.implementation?(A=tC(C,S.mode,R),A.return=S,A):(A=s(A,C.children||[]),A.return=S,A)}function f(S,A,C,R,I){return A===null||A.tag!==7?(A=ep(C,S.mode,R,I),A.return=S,A):(A=s(A,C),A.return=S,A)}function p(S,A,C){if(typeof A=="string"&&A!==""||typeof A=="number")return A=eC(""+A,S.mode,C),A.return=S,A;if(typeof A=="object"&&A!==null){switch(A.$$typeof){case Iy:return C=lS(A.type,A.key,A.props,null,S.mode,C),C.ref=Ov(S,null,A),C.return=S,C;case cg:return A=tC(A,S.mode,C),A.return=S,A;case Bh:var R=A._init;return p(S,R(A._payload),C)}if(dT(A)||xv(A))return A=ep(A,S.mode,C,null),A.return=S,A;Hy(S,A)}return null}function m(S,A,C,R){var I=A!==null?A.key:null;if(typeof C=="string"&&C!==""||typeof C=="number")return I!==null?null:u(S,A,""+C,R);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Iy:return C.key===I?d(S,A,C,R):null;case cg:return C.key===I?h(S,A,C,R):null;case Bh:return I=C._init,m(S,A,I(C._payload),R)}if(dT(C)||xv(C))return I!==null?null:f(S,A,C,R,null);Hy(S,C)}return null}function T(S,A,C,R,I){if(typeof R=="string"&&R!==""||typeof R=="number")return S=S.get(C)||null,u(A,S,""+R,I);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case Iy:return S=S.get(R.key===null?C:R.key)||null,d(A,S,R,I);case cg:return S=S.get(R.key===null?C:R.key)||null,h(A,S,R,I);case Bh:var O=R._init;return T(S,A,C,O(R._payload),I)}if(dT(R)||xv(R))return S=S.get(C)||null,f(A,S,R,I,null);Hy(A,R)}return null}function E(S,A,C,R){for(var I=null,O=null,F=A,k=A=0,D=null;F!==null&&k<C.length;k++){F.index>k?(D=F,F=null):D=F.sibling;var U=m(S,F,C[k],R);if(U===null){F===null&&(F=D);break}i&&F&&U.alternate===null&&e(S,F),A=a(U,A,k),O===null?I=U:O.sibling=U,O=U,F=D}if(k===C.length)return n(S,F),Yi&&kf(S,k),I;if(F===null){for(;k<C.length;k++)F=p(S,C[k],R),F!==null&&(A=a(F,A,k),O===null?I=F:O.sibling=F,O=F);return Yi&&kf(S,k),I}for(F=r(S,F);k<C.length;k++)D=T(F,S,k,C[k],R),D!==null&&(i&&D.alternate!==null&&F.delete(D.key===null?k:D.key),A=a(D,A,k),O===null?I=D:O.sibling=D,O=D);return i&&F.forEach(function(ce){return e(S,ce)}),Yi&&kf(S,k),I}function b(S,A,C,R){var I=xv(C);if(typeof I!="function")throw Error(Mt(150));if(C=I.call(C),C==null)throw Error(Mt(151));for(var O=I=null,F=A,k=A=0,D=null,U=C.next();F!==null&&!U.done;k++,U=C.next()){F.index>k?(D=F,F=null):D=F.sibling;var ce=m(S,F,U.value,R);if(ce===null){F===null&&(F=D);break}i&&F&&ce.alternate===null&&e(S,F),A=a(ce,A,k),O===null?I=ce:O.sibling=ce,O=ce,F=D}if(U.done)return n(S,F),Yi&&kf(S,k),I;if(F===null){for(;!U.done;k++,U=C.next())U=p(S,U.value,R),U!==null&&(A=a(U,A,k),O===null?I=U:O.sibling=U,O=U);return Yi&&kf(S,k),I}for(F=r(S,F);!U.done;k++,U=C.next())U=T(F,S,k,U.value,R),U!==null&&(i&&U.alternate!==null&&F.delete(U.key===null?k:U.key),A=a(U,A,k),O===null?I=U:O.sibling=U,O=U);return i&&F.forEach(function(ie){return e(S,ie)}),Yi&&kf(S,k),I}function y(S,A,C,R){if(typeof C=="object"&&C!==null&&C.type===ug&&C.key===null&&(C=C.props.children),typeof C=="object"&&C!==null){switch(C.$$typeof){case Iy:e:{for(var I=C.key,O=A;O!==null;){if(O.key===I){if(I=C.type,I===ug){if(O.tag===7){n(S,O.sibling),A=s(O,C.props.children),A.return=S,S=A;break e}}else if(O.elementType===I||typeof I=="object"&&I!==null&&I.$$typeof===Bh&&YO(I)===O.type){n(S,O.sibling),A=s(O,C.props),A.ref=Ov(S,O,C),A.return=S,S=A;break e}n(S,O);break}else e(S,O);O=O.sibling}C.type===ug?(A=ep(C.props.children,S.mode,R,C.key),A.return=S,S=A):(R=lS(C.type,C.key,C.props,null,S.mode,R),R.ref=Ov(S,A,C),R.return=S,S=R)}return l(S);case cg:e:{for(O=C.key;A!==null;){if(A.key===O)if(A.tag===4&&A.stateNode.containerInfo===C.containerInfo&&A.stateNode.implementation===C.implementation){n(S,A.sibling),A=s(A,C.children||[]),A.return=S,S=A;break e}else{n(S,A);break}else e(S,A);A=A.sibling}A=tC(C,S.mode,R),A.return=S,S=A}return l(S);case Bh:return O=C._init,y(S,A,O(C._payload),R)}if(dT(C))return E(S,A,C,R);if(xv(C))return b(S,A,C,R);Hy(S,C)}return typeof C=="string"&&C!==""||typeof C=="number"?(C=""+C,A!==null&&A.tag===6?(n(S,A.sibling),A=s(A,C),A.return=S,S=A):(n(S,A),A=eC(C,S.mode,R),A.return=S,S=A),l(S)):n(S,A)}return y}var Fg=mD(!0),gD=mD(!1),OS=fd(null),LS=null,vg=null,ww=null;function Mw(){ww=vg=LS=null}function Iw(i){var e=OS.current;Hi(OS),i._currentValue=e}function Fx(i,e,n){for(;i!==null;){var r=i.alternate;if((i.childLanes&e)!==e?(i.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),i===n)break;i=i.return}}function Mg(i,e){LS=i,ww=vg=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&e&&(xo=!0),i.firstContext=null)}function Xa(i){var e=i._currentValue;if(ww!==i)if(i={context:i,memoizedValue:e,next:null},vg===null){if(LS===null)throw Error(Mt(308));vg=i,LS.dependencies={lanes:0,firstContext:i}}else vg=vg.next=i;return e}var zf=null;function Ow(i){zf===null?zf=[i]:zf.push(i)}function _D(i,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Ow(e)):(n.next=s.next,s.next=n),e.interleaved=n,Mu(i,r)}function Mu(i,e){i.lanes|=e;var n=i.alternate;for(n!==null&&(n.lanes|=e),n=i,i=i.return;i!==null;)i.childLanes|=e,n=i.alternate,n!==null&&(n.childLanes|=e),n=i,i=i.return;return n.tag===3?n.stateNode:null}var Fh=!1;function Lw(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vD(i,e){i=i.updateQueue,e.updateQueue===i&&(e.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Cu(i,e){return{eventTime:i,lane:e,tag:0,payload:null,callback:null,next:null}}function Zh(i,e,n){var r=i.updateQueue;if(r===null)return null;if(r=r.shared,oi&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Mu(i,n)}return s=r.interleaved,s===null?(e.next=e,Ow(r)):(e.next=s.next,s.next=e),r.interleaved=e,Mu(i,n)}function nS(i,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=i.pendingLanes,n|=r,e.lanes=n,vw(i,n)}}function KO(i,e){var n=i.updateQueue,r=i.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var l={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?s=a=l:a=a.next=l,n=n.next}while(n!==null);a===null?s=a=e:a=a.next=e}else s=a=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:a,shared:r.shared,effects:r.effects},i.updateQueue=n;return}i=n.lastBaseUpdate,i===null?n.firstBaseUpdate=e:i.next=e,n.lastBaseUpdate=e}function NS(i,e,n,r){var s=i.updateQueue;Fh=!1;var a=s.firstBaseUpdate,l=s.lastBaseUpdate,u=s.shared.pending;if(u!==null){s.shared.pending=null;var d=u,h=d.next;d.next=null,l===null?a=h:l.next=h,l=d;var f=i.alternate;f!==null&&(f=f.updateQueue,u=f.lastBaseUpdate,u!==l&&(u===null?f.firstBaseUpdate=h:u.next=h,f.lastBaseUpdate=d))}if(a!==null){var p=s.baseState;l=0,f=h=d=null,u=a;do{var m=u.lane,T=u.eventTime;if((r&m)===m){f!==null&&(f=f.next={eventTime:T,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var E=i,b=u;switch(m=e,T=n,b.tag){case 1:if(E=b.payload,typeof E=="function"){p=E.call(T,p,m);break e}p=E;break e;case 3:E.flags=E.flags&-65537|128;case 0:if(E=b.payload,m=typeof E=="function"?E.call(T,p,m):E,m==null)break e;p=sr({},p,m);break e;case 2:Fh=!0}}u.callback!==null&&u.lane!==0&&(i.flags|=64,m=s.effects,m===null?s.effects=[u]:m.push(u))}else T={eventTime:T,lane:m,tag:u.tag,payload:u.payload,callback:u.callback,next:null},f===null?(h=f=T,d=p):f=f.next=T,l|=m;if(u=u.next,u===null){if(u=s.shared.pending,u===null)break;m=u,u=m.next,m.next=null,s.lastBaseUpdate=m,s.shared.pending=null}}while(1);if(f===null&&(d=p),s.baseState=d,s.firstBaseUpdate=h,s.lastBaseUpdate=f,e=s.shared.interleaved,e!==null){s=e;do l|=s.lane,s=s.next;while(s!==e)}else a===null&&(s.shared.lanes=0);vp|=l,i.lanes=l,i.memoizedState=p}}function JO(i,e,n){if(i=e.effects,e.effects=null,i!==null)for(e=0;e<i.length;e++){var r=i[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(Mt(191,s));s.call(r)}}}var gE={},Ac=fd(gE),WT=fd(gE),XT=fd(gE);function Wf(i){if(i===gE)throw Error(Mt(174));return i}function Nw(i,e){switch(ki(XT,e),ki(WT,i),ki(Ac,gE),i=e.nodeType,i){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Tx(null,"");break;default:i=i===8?e.parentNode:e,e=i.namespaceURI||null,i=i.tagName,e=Tx(e,i)}Hi(Ac),ki(Ac,e)}function Ug(){Hi(Ac),Hi(WT),Hi(XT)}function TD(i){Wf(XT.current);var e=Wf(Ac.current),n=Tx(e,i.type);e!==n&&(ki(WT,i),ki(Ac,n))}function kw(i){WT.current===i&&(Hi(Ac),Hi(WT))}var er=fd(0);function kS(i){for(var e=i;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var YA=[];function Pw(){for(var i=0;i<YA.length;i++)YA[i]._workInProgressVersionPrimary=null;YA.length=0}var iS=ku.ReactCurrentDispatcher,KA=ku.ReactCurrentBatchConfig,_p=0,ir=null,Xr=null,rs=null,PS=!1,ST=!1,jT=0,V3=0;function Bs(){throw Error(Mt(321))}function Dw(i,e){if(e===null)return!1;for(var n=0;n<e.length&&n<i.length;n++)if(!kl(i[n],e[n]))return!1;return!0}function Bw(i,e,n,r,s,a){if(_p=a,ir=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,iS.current=i===null||i.memoizedState===null?j3:Y3,i=n(r,s),ST){a=0;do{if(ST=!1,jT=0,25<=a)throw Error(Mt(301));a+=1,rs=Xr=null,e.updateQueue=null,iS.current=K3,i=n(r,s)}while(ST)}if(iS.current=DS,e=Xr!==null&&Xr.next!==null,_p=0,rs=Xr=ir=null,PS=!1,e)throw Error(Mt(300));return i}function Fw(){var i=jT!==0;return jT=0,i}function Tc(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rs===null?ir.memoizedState=rs=i:rs=rs.next=i,rs}function ja(){if(Xr===null){var i=ir.alternate;i=i!==null?i.memoizedState:null}else i=Xr.next;var e=rs===null?ir.memoizedState:rs.next;if(e!==null)rs=e,Xr=i;else{if(i===null)throw Error(Mt(310));Xr=i,i={memoizedState:Xr.memoizedState,baseState:Xr.baseState,baseQueue:Xr.baseQueue,queue:Xr.queue,next:null},rs===null?ir.memoizedState=rs=i:rs=rs.next=i}return rs}function YT(i,e){return typeof e=="function"?e(i):e}function JA(i){var e=ja(),n=e.queue;if(n===null)throw Error(Mt(311));n.lastRenderedReducer=i;var r=Xr,s=r.baseQueue,a=n.pending;if(a!==null){if(s!==null){var l=s.next;s.next=a.next,a.next=l}r.baseQueue=s=a,n.pending=null}if(s!==null){a=s.next,r=r.baseState;var u=l=null,d=null,h=a;do{var f=h.lane;if((_p&f)===f)d!==null&&(d=d.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),r=h.hasEagerState?h.eagerState:i(r,h.action);else{var p={lane:f,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};d===null?(u=d=p,l=r):d=d.next=p,ir.lanes|=f,vp|=f}h=h.next}while(h!==null&&h!==a);d===null?l=r:d.next=u,kl(r,e.memoizedState)||(xo=!0),e.memoizedState=r,e.baseState=l,e.baseQueue=d,n.lastRenderedState=r}if(i=n.interleaved,i!==null){s=i;do a=s.lane,ir.lanes|=a,vp|=a,s=s.next;while(s!==i)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function ZA(i){var e=ja(),n=e.queue;if(n===null)throw Error(Mt(311));n.lastRenderedReducer=i;var r=n.dispatch,s=n.pending,a=e.memoizedState;if(s!==null){n.pending=null;var l=s=s.next;do a=i(a,l.action),l=l.next;while(l!==s);kl(a,e.memoizedState)||(xo=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),n.lastRenderedState=a}return[a,r]}function ED(){}function yD(i,e){var n=ir,r=ja(),s=e(),a=!kl(r.memoizedState,s);if(a&&(r.memoizedState=s,xo=!0),r=r.queue,Uw(bD.bind(null,n,r,i),[i]),r.getSnapshot!==e||a||rs!==null&&rs.memoizedState.tag&1){if(n.flags|=2048,KT(9,$D.bind(null,n,r,s,e),void 0,null),os===null)throw Error(Mt(349));_p&30||SD(n,e,s)}return s}function SD(i,e,n){i.flags|=16384,i={getSnapshot:e,value:n},e=ir.updateQueue,e===null?(e={lastEffect:null,stores:null},ir.updateQueue=e,e.stores=[i]):(n=e.stores,n===null?e.stores=[i]:n.push(i))}function $D(i,e,n,r){e.value=n,e.getSnapshot=r,AD(e)&&CD(i)}function bD(i,e,n){return n(function(){AD(e)&&CD(i)})}function AD(i){var e=i.getSnapshot;i=i.value;try{var n=e();return!kl(i,n)}catch{return!0}}function CD(i){var e=Mu(i,1);e!==null&&Ol(e,i,1,-1)}function ZO(i){var e=Tc();return typeof i=="function"&&(i=i()),e.memoizedState=e.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:YT,lastRenderedState:i},e.queue=i,i=i.dispatch=X3.bind(null,ir,i),[e.memoizedState,i]}function KT(i,e,n,r){return i={tag:i,create:e,destroy:n,deps:r,next:null},e=ir.updateQueue,e===null?(e={lastEffect:null,stores:null},ir.updateQueue=e,e.lastEffect=i.next=i):(n=e.lastEffect,n===null?e.lastEffect=i.next=i:(r=n.next,n.next=i,i.next=r,e.lastEffect=i)),i}function xD(){return ja().memoizedState}function rS(i,e,n,r){var s=Tc();ir.flags|=i,s.memoizedState=KT(1|e,n,void 0,r===void 0?null:r)}function d$(i,e,n,r){var s=ja();r=r===void 0?null:r;var a=void 0;if(Xr!==null){var l=Xr.memoizedState;if(a=l.destroy,r!==null&&Dw(r,l.deps)){s.memoizedState=KT(e,n,a,r);return}}ir.flags|=i,s.memoizedState=KT(1|e,n,a,r)}function qO(i,e){return rS(8390656,8,i,e)}function Uw(i,e){return d$(2048,8,i,e)}function RD(i,e){return d$(4,2,i,e)}function wD(i,e){return d$(4,4,i,e)}function MD(i,e){if(typeof e=="function")return i=i(),e(i),function(){e(null)};if(e!=null)return i=i(),e.current=i,function(){e.current=null}}function ID(i,e,n){return n=n!=null?n.concat([i]):null,d$(4,4,MD.bind(null,e,i),n)}function Gw(){}function OD(i,e){var n=ja();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Dw(e,r[1])?r[0]:(n.memoizedState=[i,e],i)}function LD(i,e){var n=ja();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Dw(e,r[1])?r[0]:(i=i(),n.memoizedState=[i,e],i)}function ND(i,e,n){return _p&21?(kl(n,e)||(n=FP(),ir.lanes|=n,vp|=n,i.baseState=!0),e):(i.baseState&&(i.baseState=!1,xo=!0),i.memoizedState=n)}function z3(i,e){var n=Ai;Ai=n!==0&&4>n?n:4,i(!0);var r=KA.transition;KA.transition={};try{i(!1),e()}finally{Ai=n,KA.transition=r}}function kD(){return ja().memoizedState}function W3(i,e,n){var r=Qh(i);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},PD(i))DD(e,n);else if(n=_D(i,e,n,r),n!==null){var s=co();Ol(n,i,r,s),BD(n,e,r)}}function X3(i,e,n){var r=Qh(i),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(PD(i))DD(e,s);else{var a=i.alternate;if(i.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var l=e.lastRenderedState,u=a(l,n);if(s.hasEagerState=!0,s.eagerState=u,kl(u,l)){var d=e.interleaved;d===null?(s.next=s,Ow(e)):(s.next=d.next,d.next=s),e.interleaved=s;return}}catch{}finally{}n=_D(i,e,s,r),n!==null&&(s=co(),Ol(n,i,r,s),BD(n,e,r))}}function PD(i){var e=i.alternate;return i===ir||e!==null&&e===ir}function DD(i,e){ST=PS=!0;var n=i.pending;n===null?e.next=e:(e.next=n.next,n.next=e),i.pending=e}function BD(i,e,n){if(n&4194240){var r=e.lanes;r&=i.pendingLanes,n|=r,e.lanes=n,vw(i,n)}}var DS={readContext:Xa,useCallback:Bs,useContext:Bs,useEffect:Bs,useImperativeHandle:Bs,useInsertionEffect:Bs,useLayoutEffect:Bs,useMemo:Bs,useReducer:Bs,useRef:Bs,useState:Bs,useDebugValue:Bs,useDeferredValue:Bs,useTransition:Bs,useMutableSource:Bs,useSyncExternalStore:Bs,useId:Bs,unstable_isNewReconciler:!1},j3={readContext:Xa,useCallback:function(i,e){return Tc().memoizedState=[i,e===void 0?null:e],i},useContext:Xa,useEffect:qO,useImperativeHandle:function(i,e,n){return n=n!=null?n.concat([i]):null,rS(4194308,4,MD.bind(null,e,i),n)},useLayoutEffect:function(i,e){return rS(4194308,4,i,e)},useInsertionEffect:function(i,e){return rS(4,2,i,e)},useMemo:function(i,e){var n=Tc();return e=e===void 0?null:e,i=i(),n.memoizedState=[i,e],i},useReducer:function(i,e,n){var r=Tc();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:e},r.queue=i,i=i.dispatch=W3.bind(null,ir,i),[r.memoizedState,i]},useRef:function(i){var e=Tc();return i={current:i},e.memoizedState=i},useState:ZO,useDebugValue:Gw,useDeferredValue:function(i){return Tc().memoizedState=i},useTransition:function(){var i=ZO(!1),e=i[0];return i=z3.bind(null,i[1]),Tc().memoizedState=i,[e,i]},useMutableSource:function(){},useSyncExternalStore:function(i,e,n){var r=ir,s=Tc();if(Yi){if(n===void 0)throw Error(Mt(407));n=n()}else{if(n=e(),os===null)throw Error(Mt(349));_p&30||SD(r,e,n)}s.memoizedState=n;var a={value:n,getSnapshot:e};return s.queue=a,qO(bD.bind(null,r,a,i),[i]),r.flags|=2048,KT(9,$D.bind(null,r,a,n,e),void 0,null),n},useId:function(){var i=Tc(),e=os.identifierPrefix;if(Yi){var n=Au,r=bu;n=(r&~(1<<32-Il(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=jT++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=V3++,e=":"+e+"r"+n.toString(32)+":";return i.memoizedState=e},unstable_isNewReconciler:!1},Y3={readContext:Xa,useCallback:OD,useContext:Xa,useEffect:Uw,useImperativeHandle:ID,useInsertionEffect:RD,useLayoutEffect:wD,useMemo:LD,useReducer:JA,useRef:xD,useState:function(){return JA(YT)},useDebugValue:Gw,useDeferredValue:function(i){var e=ja();return ND(e,Xr.memoizedState,i)},useTransition:function(){var i=JA(YT)[0],e=ja().memoizedState;return[i,e]},useMutableSource:ED,useSyncExternalStore:yD,useId:kD,unstable_isNewReconciler:!1},K3={readContext:Xa,useCallback:OD,useContext:Xa,useEffect:Uw,useImperativeHandle:ID,useInsertionEffect:RD,useLayoutEffect:wD,useMemo:LD,useReducer:ZA,useRef:xD,useState:function(){return ZA(YT)},useDebugValue:Gw,useDeferredValue:function(i){var e=ja();return Xr===null?e.memoizedState=i:ND(e,Xr.memoizedState,i)},useTransition:function(){var i=ZA(YT)[0],e=ja().memoizedState;return[i,e]},useMutableSource:ED,useSyncExternalStore:yD,useId:kD,unstable_isNewReconciler:!1};function Cl(i,e){if(i&&i.defaultProps){e=sr({},e),i=i.defaultProps;for(var n in i)e[n]===void 0&&(e[n]=i[n]);return e}return e}function Ux(i,e,n,r){e=i.memoizedState,n=n(r,e),n=n==null?e:sr({},e,n),i.memoizedState=n,i.lanes===0&&(i.updateQueue.baseState=n)}var f$={isMounted:function(i){return(i=i._reactInternals)?Rp(i)===i:!1},enqueueSetState:function(i,e,n){i=i._reactInternals;var r=co(),s=Qh(i),a=Cu(r,s);a.payload=e,n!=null&&(a.callback=n),e=Zh(i,a,s),e!==null&&(Ol(e,i,s,r),nS(e,i,s))},enqueueReplaceState:function(i,e,n){i=i._reactInternals;var r=co(),s=Qh(i),a=Cu(r,s);a.tag=1,a.payload=e,n!=null&&(a.callback=n),e=Zh(i,a,s),e!==null&&(Ol(e,i,s,r),nS(e,i,s))},enqueueForceUpdate:function(i,e){i=i._reactInternals;var n=co(),r=Qh(i),s=Cu(n,r);s.tag=2,e!=null&&(s.callback=e),e=Zh(i,s,r),e!==null&&(Ol(e,i,r,n),nS(e,i,r))}};function QO(i,e,n,r,s,a,l){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(r,a,l):e.prototype&&e.prototype.isPureReactComponent?!GT(n,r)||!GT(s,a):!0}function FD(i,e,n){var r=!1,s=sd,a=e.contextType;return typeof a=="object"&&a!==null?a=Xa(a):(s=wo(e)?mp:Ws.current,r=e.contextTypes,a=(r=r!=null)?Dg(i,s):sd),e=new e(n,a),i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=f$,i.stateNode=e,e._reactInternals=i,r&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=s,i.__reactInternalMemoizedMaskedChildContext=a),e}function eL(i,e,n,r){i=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==i&&f$.enqueueReplaceState(e,e.state,null)}function Gx(i,e,n,r){var s=i.stateNode;s.props=n,s.state=i.memoizedState,s.refs={},Lw(i);var a=e.contextType;typeof a=="object"&&a!==null?s.context=Xa(a):(a=wo(e)?mp:Ws.current,s.context=Dg(i,a)),s.state=i.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(Ux(i,e,a,n),s.state=i.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&f$.enqueueReplaceState(s,s.state,null),NS(i,n,s,r),s.state=i.memoizedState),typeof s.componentDidMount=="function"&&(i.flags|=4194308)}function Gg(i,e){try{var n="",r=e;do n+=$H(r),r=r.return;while(r);var s=n}catch(a){s=`
Error generating stack: `+a.message+`
`+a.stack}return{value:i,source:e,stack:s,digest:null}}function qA(i,e,n){return{value:i,source:null,stack:n??null,digest:e??null}}function Hx(i,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var J3=typeof WeakMap=="function"?WeakMap:Map;function UD(i,e,n){n=Cu(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){FS||(FS=!0,qx=r),Hx(i,e)},n}function GD(i,e,n){n=Cu(-1,n),n.tag=3;var r=i.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Hx(i,e)}}var a=i.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){Hx(i,e),typeof r!="function"&&(qh===null?qh=new Set([this]):qh.add(this));var l=e.stack;this.componentDidCatch(e.value,{componentStack:l!==null?l:""})}),n}function tL(i,e,n){var r=i.pingCache;if(r===null){r=i.pingCache=new J3;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),i=uV.bind(null,i,e,n),e.then(i,i))}function nL(i){do{var e;if((e=i.tag===13)&&(e=i.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return i;i=i.return}while(i!==null);return null}function iL(i,e,n,r,s){return i.mode&1?(i.flags|=65536,i.lanes=s,i):(i===e?i.flags|=65536:(i.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Cu(-1,1),e.tag=2,Zh(n,e,1))),n.lanes|=1),i)}var Z3=ku.ReactCurrentOwner,xo=!1;function ao(i,e,n,r){e.child=i===null?gD(e,null,n,r):Fg(e,i.child,n,r)}function rL(i,e,n,r,s){n=n.render;var a=e.ref;return Mg(e,s),r=Bw(i,e,n,r,a,s),n=Fw(),i!==null&&!xo?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~s,Iu(i,e,s)):(Yi&&n&&Cw(e),e.flags|=1,ao(i,e,r,s),e.child)}function sL(i,e,n,r,s){if(i===null){var a=n.type;return typeof a=="function"&&!Kw(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=a,HD(i,e,a,r,s)):(i=lS(n.type,null,r,e,e.mode,s),i.ref=e.ref,i.return=e,e.child=i)}if(a=i.child,!(i.lanes&s)){var l=a.memoizedProps;if(n=n.compare,n=n!==null?n:GT,n(l,r)&&i.ref===e.ref)return Iu(i,e,s)}return e.flags|=1,i=ed(a,r),i.ref=e.ref,i.return=e,e.child=i}function HD(i,e,n,r,s){if(i!==null){var a=i.memoizedProps;if(GT(a,r)&&i.ref===e.ref)if(xo=!1,e.pendingProps=r=a,(i.lanes&s)!==0)i.flags&131072&&(xo=!0);else return e.lanes=i.lanes,Iu(i,e,s)}return Vx(i,e,n,r,s)}function VD(i,e,n){var r=e.pendingProps,s=r.children,a=i!==null?i.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ki(Eg,ra),ra|=n;else{if(!(n&1073741824))return i=a!==null?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:i,cachePool:null,transitions:null},e.updateQueue=null,ki(Eg,ra),ra|=i,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,ki(Eg,ra),ra|=r}else a!==null?(r=a.baseLanes|n,e.memoizedState=null):r=n,ki(Eg,ra),ra|=r;return ao(i,e,s,n),e.child}function zD(i,e){var n=e.ref;(i===null&&n!==null||i!==null&&i.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Vx(i,e,n,r,s){var a=wo(n)?mp:Ws.current;return a=Dg(e,a),Mg(e,s),n=Bw(i,e,n,r,a,s),r=Fw(),i!==null&&!xo?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~s,Iu(i,e,s)):(Yi&&r&&Cw(e),e.flags|=1,ao(i,e,n,s),e.child)}function oL(i,e,n,r,s){if(wo(n)){var a=!0;wS(e)}else a=!1;if(Mg(e,s),e.stateNode===null)sS(i,e),FD(e,n,r),Gx(e,n,r,s),r=!0;else if(i===null){var l=e.stateNode,u=e.memoizedProps;l.props=u;var d=l.context,h=n.contextType;typeof h=="object"&&h!==null?h=Xa(h):(h=wo(n)?mp:Ws.current,h=Dg(e,h));var f=n.getDerivedStateFromProps,p=typeof f=="function"||typeof l.getSnapshotBeforeUpdate=="function";p||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(u!==r||d!==h)&&eL(e,l,r,h),Fh=!1;var m=e.memoizedState;l.state=m,NS(e,r,l,s),d=e.memoizedState,u!==r||m!==d||Ro.current||Fh?(typeof f=="function"&&(Ux(e,n,f,r),d=e.memoizedState),(u=Fh||QO(e,n,u,r,m,d,h))?(p||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(e.flags|=4194308)):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=d),l.props=r,l.state=d,l.context=h,r=u):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{l=e.stateNode,vD(i,e),u=e.memoizedProps,h=e.type===e.elementType?u:Cl(e.type,u),l.props=h,p=e.pendingProps,m=l.context,d=n.contextType,typeof d=="object"&&d!==null?d=Xa(d):(d=wo(n)?mp:Ws.current,d=Dg(e,d));var T=n.getDerivedStateFromProps;(f=typeof T=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(u!==p||m!==d)&&eL(e,l,r,d),Fh=!1,m=e.memoizedState,l.state=m,NS(e,r,l,s);var E=e.memoizedState;u!==p||m!==E||Ro.current||Fh?(typeof T=="function"&&(Ux(e,n,T,r),E=e.memoizedState),(h=Fh||QO(e,n,h,r,m,E,d)||!1)?(f||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(r,E,d),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(r,E,d)),typeof l.componentDidUpdate=="function"&&(e.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof l.componentDidUpdate!="function"||u===i.memoizedProps&&m===i.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||u===i.memoizedProps&&m===i.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=E),l.props=r,l.state=E,l.context=d,r=h):(typeof l.componentDidUpdate!="function"||u===i.memoizedProps&&m===i.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||u===i.memoizedProps&&m===i.memoizedState||(e.flags|=1024),r=!1)}return zx(i,e,n,r,a,s)}function zx(i,e,n,r,s,a){zD(i,e);var l=(e.flags&128)!==0;if(!r&&!l)return s&&WO(e,n,!1),Iu(i,e,a);r=e.stateNode,Z3.current=e;var u=l&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,i!==null&&l?(e.child=Fg(e,i.child,null,a),e.child=Fg(e,null,u,a)):ao(i,e,u,a),e.memoizedState=r.state,s&&WO(e,n,!0),e.child}function WD(i){var e=i.stateNode;e.pendingContext?zO(i,e.pendingContext,e.pendingContext!==e.context):e.context&&zO(i,e.context,!1),Nw(i,e.containerInfo)}function aL(i,e,n,r,s){return Bg(),Rw(s),e.flags|=256,ao(i,e,n,r),e.child}var Wx={dehydrated:null,treeContext:null,retryLane:0};function Xx(i){return{baseLanes:i,cachePool:null,transitions:null}}function XD(i,e,n){var r=e.pendingProps,s=er.current,a=!1,l=(e.flags&128)!==0,u;if((u=l)||(u=i!==null&&i.memoizedState===null?!1:(s&2)!==0),u?(a=!0,e.flags&=-129):(i===null||i.memoizedState!==null)&&(s|=1),ki(er,s&1),i===null)return Bx(e),i=e.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(e.mode&1?i.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(l=r.children,i=r.fallback,a?(r=e.mode,a=e.child,l={mode:"hidden",children:l},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=l):a=g$(l,r,0,null),i=ep(i,r,n,null),a.return=e,i.return=e,a.sibling=i,e.child=a,e.child.memoizedState=Xx(n),e.memoizedState=Wx,i):Hw(e,l));if(s=i.memoizedState,s!==null&&(u=s.dehydrated,u!==null))return q3(i,e,l,r,u,s,n);if(a){a=r.fallback,l=e.mode,s=i.child,u=s.sibling;var d={mode:"hidden",children:r.children};return!(l&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=d,e.deletions=null):(r=ed(s,d),r.subtreeFlags=s.subtreeFlags&14680064),u!==null?a=ed(u,a):(a=ep(a,l,n,null),a.flags|=2),a.return=e,r.return=e,r.sibling=a,e.child=r,r=a,a=e.child,l=i.child.memoizedState,l=l===null?Xx(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=i.childLanes&~n,e.memoizedState=Wx,r}return a=i.child,i=a.sibling,r=ed(a,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,i!==null&&(n=e.deletions,n===null?(e.deletions=[i],e.flags|=16):n.push(i)),e.child=r,e.memoizedState=null,r}function Hw(i,e){return e=g$({mode:"visible",children:e},i.mode,0,null),e.return=i,i.child=e}function Vy(i,e,n,r){return r!==null&&Rw(r),Fg(e,i.child,null,n),i=Hw(e,e.pendingProps.children),i.flags|=2,e.memoizedState=null,i}function q3(i,e,n,r,s,a,l){if(n)return e.flags&256?(e.flags&=-257,r=qA(Error(Mt(422))),Vy(i,e,l,r)):e.memoizedState!==null?(e.child=i.child,e.flags|=128,null):(a=r.fallback,s=e.mode,r=g$({mode:"visible",children:r.children},s,0,null),a=ep(a,s,l,null),a.flags|=2,r.return=e,a.return=e,r.sibling=a,e.child=r,e.mode&1&&Fg(e,i.child,null,l),e.child.memoizedState=Xx(l),e.memoizedState=Wx,a);if(!(e.mode&1))return Vy(i,e,l,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var u=r.dgst;return r=u,a=Error(Mt(419)),r=qA(a,r,void 0),Vy(i,e,l,r)}if(u=(l&i.childLanes)!==0,xo||u){if(r=os,r!==null){switch(l&-l){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|l)?0:s,s!==0&&s!==a.retryLane&&(a.retryLane=s,Mu(i,s),Ol(r,i,s,-1))}return Yw(),r=qA(Error(Mt(421))),Vy(i,e,l,r)}return s.data==="$?"?(e.flags|=128,e.child=i.child,e=hV.bind(null,i),s._reactRetry=e,null):(i=a.treeContext,sa=Jh(s.nextSibling),aa=e,Yi=!0,wl=null,i!==null&&(Ua[Ga++]=bu,Ua[Ga++]=Au,Ua[Ga++]=gp,bu=i.id,Au=i.overflow,gp=e),e=Hw(e,r.children),e.flags|=4096,e)}function lL(i,e,n){i.lanes|=e;var r=i.alternate;r!==null&&(r.lanes|=e),Fx(i.return,e,n)}function QA(i,e,n,r,s){var a=i.memoizedState;a===null?i.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=s)}function jD(i,e,n){var r=e.pendingProps,s=r.revealOrder,a=r.tail;if(ao(i,e,r.children,n),r=er.current,r&2)r=r&1|2,e.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=e.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&lL(i,n,e);else if(i.tag===19)lL(i,n,e);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}r&=1}if(ki(er,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)i=n.alternate,i!==null&&kS(i)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),QA(e,!1,s,n,a);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(i=s.alternate,i!==null&&kS(i)===null){e.child=s;break}i=s.sibling,s.sibling=n,n=s,s=i}QA(e,!0,n,null,a);break;case"together":QA(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function sS(i,e){!(e.mode&1)&&i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2)}function Iu(i,e,n){if(i!==null&&(e.dependencies=i.dependencies),vp|=e.lanes,!(n&e.childLanes))return null;if(i!==null&&e.child!==i.child)throw Error(Mt(153));if(e.child!==null){for(i=e.child,n=ed(i,i.pendingProps),e.child=n,n.return=e;i.sibling!==null;)i=i.sibling,n=n.sibling=ed(i,i.pendingProps),n.return=e;n.sibling=null}return e.child}function Q3(i,e,n){switch(e.tag){case 3:WD(e),Bg();break;case 5:TD(e);break;case 1:wo(e.type)&&wS(e);break;case 4:Nw(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;ki(OS,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ki(er,er.current&1),e.flags|=128,null):n&e.child.childLanes?XD(i,e,n):(ki(er,er.current&1),i=Iu(i,e,n),i!==null?i.sibling:null);ki(er,er.current&1);break;case 19:if(r=(n&e.childLanes)!==0,i.flags&128){if(r)return jD(i,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),ki(er,er.current),r)break;return null;case 22:case 23:return e.lanes=0,VD(i,e,n)}return Iu(i,e,n)}var YD,jx,KD,JD;YD=function(i,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)i.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};jx=function(){};KD=function(i,e,n,r){var s=i.memoizedProps;if(s!==r){i=e.stateNode,Wf(Ac.current);var a=null;switch(n){case"input":s=mx(i,s),r=mx(i,r),a=[];break;case"select":s=sr({},s,{value:void 0}),r=sr({},r,{value:void 0}),a=[];break;case"textarea":s=vx(i,s),r=vx(i,r),a=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(i.onclick=xS)}Ex(n,r);var l;n=null;for(h in s)if(!r.hasOwnProperty(h)&&s.hasOwnProperty(h)&&s[h]!=null)if(h==="style"){var u=s[h];for(l in u)u.hasOwnProperty(l)&&(n||(n={}),n[l]="")}else h!=="dangerouslySetInnerHTML"&&h!=="children"&&h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(NT.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in r){var d=r[h];if(u=s!=null?s[h]:void 0,r.hasOwnProperty(h)&&d!==u&&(d!=null||u!=null))if(h==="style")if(u){for(l in u)!u.hasOwnProperty(l)||d&&d.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in d)d.hasOwnProperty(l)&&u[l]!==d[l]&&(n||(n={}),n[l]=d[l])}else n||(a||(a=[]),a.push(h,n)),n=d;else h==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,u=u?u.__html:void 0,d!=null&&u!==d&&(a=a||[]).push(h,d)):h==="children"?typeof d!="string"&&typeof d!="number"||(a=a||[]).push(h,""+d):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&(NT.hasOwnProperty(h)?(d!=null&&h==="onScroll"&&Bi("scroll",i),a||u===d||(a=[])):(a=a||[]).push(h,d))}n&&(a=a||[]).push("style",n);var h=a;(e.updateQueue=h)&&(e.flags|=4)}};JD=function(i,e,n,r){n!==r&&(e.flags|=4)};function Lv(i,e){if(!Yi)switch(i.tailMode){case"hidden":e=i.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?i.tail=null:n.sibling=null;break;case"collapsed":n=i.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||i.tail===null?i.tail=null:i.tail.sibling=null:r.sibling=null}}function Fs(i){var e=i.alternate!==null&&i.alternate.child===i.child,n=0,r=0;if(e)for(var s=i.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=i,s=s.sibling;else for(s=i.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=i,s=s.sibling;return i.subtreeFlags|=r,i.childLanes=n,e}function eV(i,e,n){var r=e.pendingProps;switch(xw(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Fs(e),null;case 1:return wo(e.type)&&RS(),Fs(e),null;case 3:return r=e.stateNode,Ug(),Hi(Ro),Hi(Ws),Pw(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(i===null||i.child===null)&&(Gy(e)?e.flags|=4:i===null||i.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,wl!==null&&(tR(wl),wl=null))),jx(i,e),Fs(e),null;case 5:kw(e);var s=Wf(XT.current);if(n=e.type,i!==null&&e.stateNode!=null)KD(i,e,n,r,s),i.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Mt(166));return Fs(e),null}if(i=Wf(Ac.current),Gy(e)){r=e.stateNode,n=e.type;var a=e.memoizedProps;switch(r[Ec]=e,r[zT]=a,i=(e.mode&1)!==0,n){case"dialog":Bi("cancel",r),Bi("close",r);break;case"iframe":case"object":case"embed":Bi("load",r);break;case"video":case"audio":for(s=0;s<pT.length;s++)Bi(pT[s],r);break;case"source":Bi("error",r);break;case"img":case"image":case"link":Bi("error",r),Bi("load",r);break;case"details":Bi("toggle",r);break;case"input":_O(r,a),Bi("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Bi("invalid",r);break;case"textarea":TO(r,a),Bi("invalid",r)}Ex(n,a),s=null;for(var l in a)if(a.hasOwnProperty(l)){var u=a[l];l==="children"?typeof u=="string"?r.textContent!==u&&(a.suppressHydrationWarning!==!0&&Uy(r.textContent,u,i),s=["children",u]):typeof u=="number"&&r.textContent!==""+u&&(a.suppressHydrationWarning!==!0&&Uy(r.textContent,u,i),s=["children",""+u]):NT.hasOwnProperty(l)&&u!=null&&l==="onScroll"&&Bi("scroll",r)}switch(n){case"input":Oy(r),vO(r,a,!0);break;case"textarea":Oy(r),EO(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=xS)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{l=s.nodeType===9?s:s.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=bP(n)),i==="http://www.w3.org/1999/xhtml"?n==="script"?(i=l.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof r.is=="string"?i=l.createElement(n,{is:r.is}):(i=l.createElement(n),n==="select"&&(l=i,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):i=l.createElementNS(i,n),i[Ec]=e,i[zT]=r,YD(i,e,!1,!1),e.stateNode=i;e:{switch(l=yx(n,r),n){case"dialog":Bi("cancel",i),Bi("close",i),s=r;break;case"iframe":case"object":case"embed":Bi("load",i),s=r;break;case"video":case"audio":for(s=0;s<pT.length;s++)Bi(pT[s],i);s=r;break;case"source":Bi("error",i),s=r;break;case"img":case"image":case"link":Bi("error",i),Bi("load",i),s=r;break;case"details":Bi("toggle",i),s=r;break;case"input":_O(i,r),s=mx(i,r),Bi("invalid",i);break;case"option":s=r;break;case"select":i._wrapperState={wasMultiple:!!r.multiple},s=sr({},r,{value:void 0}),Bi("invalid",i);break;case"textarea":TO(i,r),s=vx(i,r),Bi("invalid",i);break;default:s=r}Ex(n,s),u=s;for(a in u)if(u.hasOwnProperty(a)){var d=u[a];a==="style"?xP(i,d):a==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&AP(i,d)):a==="children"?typeof d=="string"?(n!=="textarea"||d!=="")&&kT(i,d):typeof d=="number"&&kT(i,""+d):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(NT.hasOwnProperty(a)?d!=null&&a==="onScroll"&&Bi("scroll",i):d!=null&&dw(i,a,d,l))}switch(n){case"input":Oy(i),vO(i,r,!1);break;case"textarea":Oy(i),EO(i);break;case"option":r.value!=null&&i.setAttribute("value",""+rd(r.value));break;case"select":i.multiple=!!r.multiple,a=r.value,a!=null?Cg(i,!!r.multiple,a,!1):r.defaultValue!=null&&Cg(i,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(i.onclick=xS)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Fs(e),null;case 6:if(i&&e.stateNode!=null)JD(i,e,i.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Mt(166));if(n=Wf(XT.current),Wf(Ac.current),Gy(e)){if(r=e.stateNode,n=e.memoizedProps,r[Ec]=e,(a=r.nodeValue!==n)&&(i=aa,i!==null))switch(i.tag){case 3:Uy(r.nodeValue,n,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&Uy(r.nodeValue,n,(i.mode&1)!==0)}a&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Ec]=e,e.stateNode=r}return Fs(e),null;case 13:if(Hi(er),r=e.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(Yi&&sa!==null&&e.mode&1&&!(e.flags&128))pD(),Bg(),e.flags|=98560,a=!1;else if(a=Gy(e),r!==null&&r.dehydrated!==null){if(i===null){if(!a)throw Error(Mt(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Mt(317));a[Ec]=e}else Bg(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Fs(e),a=!1}else wl!==null&&(tR(wl),wl=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(i!==null&&i.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(i===null||er.current&1?Yr===0&&(Yr=3):Yw())),e.updateQueue!==null&&(e.flags|=4),Fs(e),null);case 4:return Ug(),jx(i,e),i===null&&HT(e.stateNode.containerInfo),Fs(e),null;case 10:return Iw(e.type._context),Fs(e),null;case 17:return wo(e.type)&&RS(),Fs(e),null;case 19:if(Hi(er),a=e.memoizedState,a===null)return Fs(e),null;if(r=(e.flags&128)!==0,l=a.rendering,l===null)if(r)Lv(a,!1);else{if(Yr!==0||i!==null&&i.flags&128)for(i=e.child;i!==null;){if(l=kS(i),l!==null){for(e.flags|=128,Lv(a,!1),r=l.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)a=n,i=r,a.flags&=14680066,l=a.alternate,l===null?(a.childLanes=0,a.lanes=i,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,i=l.dependencies,a.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),n=n.sibling;return ki(er,er.current&1|2),e.child}i=i.sibling}a.tail!==null&&Tr()>Hg&&(e.flags|=128,r=!0,Lv(a,!1),e.lanes=4194304)}else{if(!r)if(i=kS(l),i!==null){if(e.flags|=128,r=!0,n=i.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Lv(a,!0),a.tail===null&&a.tailMode==="hidden"&&!l.alternate&&!Yi)return Fs(e),null}else 2*Tr()-a.renderingStartTime>Hg&&n!==1073741824&&(e.flags|=128,r=!0,Lv(a,!1),e.lanes=4194304);a.isBackwards?(l.sibling=e.child,e.child=l):(n=a.last,n!==null?n.sibling=l:e.child=l,a.last=l)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=Tr(),e.sibling=null,n=er.current,ki(er,r?n&1|2:n&1),e):(Fs(e),null);case 22:case 23:return jw(),r=e.memoizedState!==null,i!==null&&i.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ra&1073741824&&(Fs(e),e.subtreeFlags&6&&(e.flags|=8192)):Fs(e),null;case 24:return null;case 25:return null}throw Error(Mt(156,e.tag))}function tV(i,e){switch(xw(e),e.tag){case 1:return wo(e.type)&&RS(),i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 3:return Ug(),Hi(Ro),Hi(Ws),Pw(),i=e.flags,i&65536&&!(i&128)?(e.flags=i&-65537|128,e):null;case 5:return kw(e),null;case 13:if(Hi(er),i=e.memoizedState,i!==null&&i.dehydrated!==null){if(e.alternate===null)throw Error(Mt(340));Bg()}return i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 19:return Hi(er),null;case 4:return Ug(),null;case 10:return Iw(e.type._context),null;case 22:case 23:return jw(),null;case 24:return null;default:return null}}var zy=!1,Vs=!1,nV=typeof WeakSet=="function"?WeakSet:Set,Wt=null;function Tg(i,e){var n=i.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){fr(i,e,r)}else n.current=null}function Yx(i,e,n){try{n()}catch(r){fr(i,e,r)}}var cL=!1;function iV(i,e){if(Ix=bS,i=tD(),Aw(i)){if("selectionStart"in i)var n={start:i.selectionStart,end:i.selectionEnd};else e:{n=(n=i.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var l=0,u=-1,d=-1,h=0,f=0,p=i,m=null;t:for(;;){for(var T;p!==n||s!==0&&p.nodeType!==3||(u=l+s),p!==a||r!==0&&p.nodeType!==3||(d=l+r),p.nodeType===3&&(l+=p.nodeValue.length),(T=p.firstChild)!==null;)m=p,p=T;for(;;){if(p===i)break t;if(m===n&&++h===s&&(u=l),m===a&&++f===r&&(d=l),(T=p.nextSibling)!==null)break;p=m,m=p.parentNode}p=T}n=u===-1||d===-1?null:{start:u,end:d}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ox={focusedElem:i,selectionRange:n},bS=!1,Wt=e;Wt!==null;)if(e=Wt,i=e.child,(e.subtreeFlags&1028)!==0&&i!==null)i.return=e,Wt=i;else for(;Wt!==null;){e=Wt;try{var E=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(E!==null){var b=E.memoizedProps,y=E.memoizedState,S=e.stateNode,A=S.getSnapshotBeforeUpdate(e.elementType===e.type?b:Cl(e.type,b),y);S.__reactInternalSnapshotBeforeUpdate=A}break;case 3:var C=e.stateNode.containerInfo;C.nodeType===1?C.textContent="":C.nodeType===9&&C.documentElement&&C.removeChild(C.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Mt(163))}}catch(R){fr(e,e.return,R)}if(i=e.sibling,i!==null){i.return=e.return,Wt=i;break}Wt=e.return}return E=cL,cL=!1,E}function $T(i,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&i)===i){var a=s.destroy;s.destroy=void 0,a!==void 0&&Yx(e,n,a)}s=s.next}while(s!==r)}}function p$(i,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&i)===i){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Kx(i){var e=i.ref;if(e!==null){var n=i.stateNode;switch(i.tag){case 5:i=n;break;default:i=n}typeof e=="function"?e(i):e.current=i}}function ZD(i){var e=i.alternate;e!==null&&(i.alternate=null,ZD(e)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(e=i.stateNode,e!==null&&(delete e[Ec],delete e[zT],delete e[kx],delete e[F3],delete e[U3])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function qD(i){return i.tag===5||i.tag===3||i.tag===4}function uL(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||qD(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Jx(i,e,n){var r=i.tag;if(r===5||r===6)i=i.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(i,e):n.insertBefore(i,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(i,n)):(e=n,e.appendChild(i)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=xS));else if(r!==4&&(i=i.child,i!==null))for(Jx(i,e,n),i=i.sibling;i!==null;)Jx(i,e,n),i=i.sibling}function Zx(i,e,n){var r=i.tag;if(r===5||r===6)i=i.stateNode,e?n.insertBefore(i,e):n.appendChild(i);else if(r!==4&&(i=i.child,i!==null))for(Zx(i,e,n),i=i.sibling;i!==null;)Zx(i,e,n),i=i.sibling}var Es=null,Rl=!1;function wh(i,e,n){for(n=n.child;n!==null;)QD(i,e,n),n=n.sibling}function QD(i,e,n){if(bc&&typeof bc.onCommitFiberUnmount=="function")try{bc.onCommitFiberUnmount(o$,n)}catch{}switch(n.tag){case 5:Vs||Tg(n,e);case 6:var r=Es,s=Rl;Es=null,wh(i,e,n),Es=r,Rl=s,Es!==null&&(Rl?(i=Es,n=n.stateNode,i.nodeType===8?i.parentNode.removeChild(n):i.removeChild(n)):Es.removeChild(n.stateNode));break;case 18:Es!==null&&(Rl?(i=Es,n=n.stateNode,i.nodeType===8?XA(i.parentNode,n):i.nodeType===1&&XA(i,n),FT(i)):XA(Es,n.stateNode));break;case 4:r=Es,s=Rl,Es=n.stateNode.containerInfo,Rl=!0,wh(i,e,n),Es=r,Rl=s;break;case 0:case 11:case 14:case 15:if(!Vs&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var a=s,l=a.destroy;a=a.tag,l!==void 0&&(a&2||a&4)&&Yx(n,e,l),s=s.next}while(s!==r)}wh(i,e,n);break;case 1:if(!Vs&&(Tg(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(u){fr(n,e,u)}wh(i,e,n);break;case 21:wh(i,e,n);break;case 22:n.mode&1?(Vs=(r=Vs)||n.memoizedState!==null,wh(i,e,n),Vs=r):wh(i,e,n);break;default:wh(i,e,n)}}function hL(i){var e=i.updateQueue;if(e!==null){i.updateQueue=null;var n=i.stateNode;n===null&&(n=i.stateNode=new nV),e.forEach(function(r){var s=dV.bind(null,i,r);n.has(r)||(n.add(r),r.then(s,s))})}}function El(i,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var a=i,l=e,u=l;e:for(;u!==null;){switch(u.tag){case 5:Es=u.stateNode,Rl=!1;break e;case 3:Es=u.stateNode.containerInfo,Rl=!0;break e;case 4:Es=u.stateNode.containerInfo,Rl=!0;break e}u=u.return}if(Es===null)throw Error(Mt(160));QD(a,l,s),Es=null,Rl=!1;var d=s.alternate;d!==null&&(d.return=null),s.return=null}catch(h){fr(s,e,h)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)eB(e,i),e=e.sibling}function eB(i,e){var n=i.alternate,r=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(El(e,i),gc(i),r&4){try{$T(3,i,i.return),p$(3,i)}catch(b){fr(i,i.return,b)}try{$T(5,i,i.return)}catch(b){fr(i,i.return,b)}}break;case 1:El(e,i),gc(i),r&512&&n!==null&&Tg(n,n.return);break;case 5:if(El(e,i),gc(i),r&512&&n!==null&&Tg(n,n.return),i.flags&32){var s=i.stateNode;try{kT(s,"")}catch(b){fr(i,i.return,b)}}if(r&4&&(s=i.stateNode,s!=null)){var a=i.memoizedProps,l=n!==null?n.memoizedProps:a,u=i.type,d=i.updateQueue;if(i.updateQueue=null,d!==null)try{u==="input"&&a.type==="radio"&&a.name!=null&&SP(s,a),yx(u,l);var h=yx(u,a);for(l=0;l<d.length;l+=2){var f=d[l],p=d[l+1];f==="style"?xP(s,p):f==="dangerouslySetInnerHTML"?AP(s,p):f==="children"?kT(s,p):dw(s,f,p,h)}switch(u){case"input":gx(s,a);break;case"textarea":$P(s,a);break;case"select":var m=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var T=a.value;T!=null?Cg(s,!!a.multiple,T,!1):m!==!!a.multiple&&(a.defaultValue!=null?Cg(s,!!a.multiple,a.defaultValue,!0):Cg(s,!!a.multiple,a.multiple?[]:"",!1))}s[zT]=a}catch(b){fr(i,i.return,b)}}break;case 6:if(El(e,i),gc(i),r&4){if(i.stateNode===null)throw Error(Mt(162));s=i.stateNode,a=i.memoizedProps;try{s.nodeValue=a}catch(b){fr(i,i.return,b)}}break;case 3:if(El(e,i),gc(i),r&4&&n!==null&&n.memoizedState.isDehydrated)try{FT(e.containerInfo)}catch(b){fr(i,i.return,b)}break;case 4:El(e,i),gc(i);break;case 13:El(e,i),gc(i),s=i.child,s.flags&8192&&(a=s.memoizedState!==null,s.stateNode.isHidden=a,!a||s.alternate!==null&&s.alternate.memoizedState!==null||(Ww=Tr())),r&4&&hL(i);break;case 22:if(f=n!==null&&n.memoizedState!==null,i.mode&1?(Vs=(h=Vs)||f,El(e,i),Vs=h):El(e,i),gc(i),r&8192){if(h=i.memoizedState!==null,(i.stateNode.isHidden=h)&&!f&&i.mode&1)for(Wt=i,f=i.child;f!==null;){for(p=Wt=f;Wt!==null;){switch(m=Wt,T=m.child,m.tag){case 0:case 11:case 14:case 15:$T(4,m,m.return);break;case 1:Tg(m,m.return);var E=m.stateNode;if(typeof E.componentWillUnmount=="function"){r=m,n=m.return;try{e=r,E.props=e.memoizedProps,E.state=e.memoizedState,E.componentWillUnmount()}catch(b){fr(r,n,b)}}break;case 5:Tg(m,m.return);break;case 22:if(m.memoizedState!==null){fL(p);continue}}T!==null?(T.return=m,Wt=T):fL(p)}f=f.sibling}e:for(f=null,p=i;;){if(p.tag===5){if(f===null){f=p;try{s=p.stateNode,h?(a=s.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(u=p.stateNode,d=p.memoizedProps.style,l=d!=null&&d.hasOwnProperty("display")?d.display:null,u.style.display=CP("display",l))}catch(b){fr(i,i.return,b)}}}else if(p.tag===6){if(f===null)try{p.stateNode.nodeValue=h?"":p.memoizedProps}catch(b){fr(i,i.return,b)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===i)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===i)break e;for(;p.sibling===null;){if(p.return===null||p.return===i)break e;f===p&&(f=null),p=p.return}f===p&&(f=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:El(e,i),gc(i),r&4&&hL(i);break;case 21:break;default:El(e,i),gc(i)}}function gc(i){var e=i.flags;if(e&2){try{e:{for(var n=i.return;n!==null;){if(qD(n)){var r=n;break e}n=n.return}throw Error(Mt(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(kT(s,""),r.flags&=-33);var a=uL(i);Zx(i,a,s);break;case 3:case 4:var l=r.stateNode.containerInfo,u=uL(i);Jx(i,u,l);break;default:throw Error(Mt(161))}}catch(d){fr(i,i.return,d)}i.flags&=-3}e&4096&&(i.flags&=-4097)}function rV(i,e,n){Wt=i,tB(i)}function tB(i,e,n){for(var r=(i.mode&1)!==0;Wt!==null;){var s=Wt,a=s.child;if(s.tag===22&&r){var l=s.memoizedState!==null||zy;if(!l){var u=s.alternate,d=u!==null&&u.memoizedState!==null||Vs;u=zy;var h=Vs;if(zy=l,(Vs=d)&&!h)for(Wt=s;Wt!==null;)l=Wt,d=l.child,l.tag===22&&l.memoizedState!==null?pL(s):d!==null?(d.return=l,Wt=d):pL(s);for(;a!==null;)Wt=a,tB(a),a=a.sibling;Wt=s,zy=u,Vs=h}dL(i)}else s.subtreeFlags&8772&&a!==null?(a.return=s,Wt=a):dL(i)}}function dL(i){for(;Wt!==null;){var e=Wt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Vs||p$(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Vs)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Cl(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&JO(e,a,r);break;case 3:var l=e.updateQueue;if(l!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}JO(e,l,n)}break;case 5:var u=e.stateNode;if(n===null&&e.flags&4){n=u;var d=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&n.focus();break;case"img":d.src&&(n.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var h=e.alternate;if(h!==null){var f=h.memoizedState;if(f!==null){var p=f.dehydrated;p!==null&&FT(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Mt(163))}Vs||e.flags&512&&Kx(e)}catch(m){fr(e,e.return,m)}}if(e===i){Wt=null;break}if(n=e.sibling,n!==null){n.return=e.return,Wt=n;break}Wt=e.return}}function fL(i){for(;Wt!==null;){var e=Wt;if(e===i){Wt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Wt=n;break}Wt=e.return}}function pL(i){for(;Wt!==null;){var e=Wt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{p$(4,e)}catch(d){fr(e,n,d)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(d){fr(e,s,d)}}var a=e.return;try{Kx(e)}catch(d){fr(e,a,d)}break;case 5:var l=e.return;try{Kx(e)}catch(d){fr(e,l,d)}}}catch(d){fr(e,e.return,d)}if(e===i){Wt=null;break}var u=e.sibling;if(u!==null){u.return=e.return,Wt=u;break}Wt=e.return}}var sV=Math.ceil,BS=ku.ReactCurrentDispatcher,Vw=ku.ReactCurrentOwner,Wa=ku.ReactCurrentBatchConfig,oi=0,os=null,Or=null,$s=0,ra=0,Eg=fd(0),Yr=0,JT=null,vp=0,m$=0,zw=0,bT=null,Ao=null,Ww=0,Hg=1/0,_u=null,FS=!1,qx=null,qh=null,Wy=!1,zh=null,US=0,AT=0,Qx=null,oS=-1,aS=0;function co(){return oi&6?Tr():oS!==-1?oS:oS=Tr()}function Qh(i){return i.mode&1?oi&2&&$s!==0?$s&-$s:H3.transition!==null?(aS===0&&(aS=FP()),aS):(i=Ai,i!==0||(i=window.event,i=i===void 0?16:XP(i.type)),i):1}function Ol(i,e,n,r){if(50<AT)throw AT=0,Qx=null,Error(Mt(185));fE(i,n,r),(!(oi&2)||i!==os)&&(i===os&&(!(oi&2)&&(m$|=n),Yr===4&&Hh(i,$s)),Mo(i,r),n===1&&oi===0&&!(e.mode&1)&&(Hg=Tr()+500,h$&&pd()))}function Mo(i,e){var n=i.callbackNode;HH(i,e);var r=$S(i,i===os?$s:0);if(r===0)n!==null&&$O(n),i.callbackNode=null,i.callbackPriority=0;else if(e=r&-r,i.callbackPriority!==e){if(n!=null&&$O(n),e===1)i.tag===0?G3(mL.bind(null,i)):hD(mL.bind(null,i)),D3(function(){!(oi&6)&&pd()}),n=null;else{switch(UP(r)){case 1:n=_w;break;case 4:n=DP;break;case 16:n=SS;break;case 536870912:n=BP;break;default:n=SS}n=cB(n,nB.bind(null,i))}i.callbackPriority=e,i.callbackNode=n}}function nB(i,e){if(oS=-1,aS=0,oi&6)throw Error(Mt(327));var n=i.callbackNode;if(Ig()&&i.callbackNode!==n)return null;var r=$S(i,i===os?$s:0);if(r===0)return null;if(r&30||r&i.expiredLanes||e)e=GS(i,r);else{e=r;var s=oi;oi|=2;var a=rB();(os!==i||$s!==e)&&(_u=null,Hg=Tr()+500,Qf(i,e));do try{lV();break}catch(u){iB(i,u)}while(1);Mw(),BS.current=a,oi=s,Or!==null?e=0:(os=null,$s=0,e=Yr)}if(e!==0){if(e===2&&(s=Cx(i),s!==0&&(r=s,e=eR(i,s))),e===1)throw n=JT,Qf(i,0),Hh(i,r),Mo(i,Tr()),n;if(e===6)Hh(i,r);else{if(s=i.current.alternate,!(r&30)&&!oV(s)&&(e=GS(i,r),e===2&&(a=Cx(i),a!==0&&(r=a,e=eR(i,a))),e===1))throw n=JT,Qf(i,0),Hh(i,r),Mo(i,Tr()),n;switch(i.finishedWork=s,i.finishedLanes=r,e){case 0:case 1:throw Error(Mt(345));case 2:Pf(i,Ao,_u);break;case 3:if(Hh(i,r),(r&130023424)===r&&(e=Ww+500-Tr(),10<e)){if($S(i,0)!==0)break;if(s=i.suspendedLanes,(s&r)!==r){co(),i.pingedLanes|=i.suspendedLanes&s;break}i.timeoutHandle=Nx(Pf.bind(null,i,Ao,_u),e);break}Pf(i,Ao,_u);break;case 4:if(Hh(i,r),(r&4194240)===r)break;for(e=i.eventTimes,s=-1;0<r;){var l=31-Il(r);a=1<<l,l=e[l],l>s&&(s=l),r&=~a}if(r=s,r=Tr()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*sV(r/1960))-r,10<r){i.timeoutHandle=Nx(Pf.bind(null,i,Ao,_u),r);break}Pf(i,Ao,_u);break;case 5:Pf(i,Ao,_u);break;default:throw Error(Mt(329))}}}return Mo(i,Tr()),i.callbackNode===n?nB.bind(null,i):null}function eR(i,e){var n=bT;return i.current.memoizedState.isDehydrated&&(Qf(i,e).flags|=256),i=GS(i,e),i!==2&&(e=Ao,Ao=n,e!==null&&tR(e)),i}function tR(i){Ao===null?Ao=i:Ao.push.apply(Ao,i)}function oV(i){for(var e=i;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],a=s.getSnapshot;s=s.value;try{if(!kl(a(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Hh(i,e){for(e&=~zw,e&=~m$,i.suspendedLanes|=e,i.pingedLanes&=~e,i=i.expirationTimes;0<e;){var n=31-Il(e),r=1<<n;i[n]=-1,e&=~r}}function mL(i){if(oi&6)throw Error(Mt(327));Ig();var e=$S(i,0);if(!(e&1))return Mo(i,Tr()),null;var n=GS(i,e);if(i.tag!==0&&n===2){var r=Cx(i);r!==0&&(e=r,n=eR(i,r))}if(n===1)throw n=JT,Qf(i,0),Hh(i,e),Mo(i,Tr()),n;if(n===6)throw Error(Mt(345));return i.finishedWork=i.current.alternate,i.finishedLanes=e,Pf(i,Ao,_u),Mo(i,Tr()),null}function Xw(i,e){var n=oi;oi|=1;try{return i(e)}finally{oi=n,oi===0&&(Hg=Tr()+500,h$&&pd())}}function Tp(i){zh!==null&&zh.tag===0&&!(oi&6)&&Ig();var e=oi;oi|=1;var n=Wa.transition,r=Ai;try{if(Wa.transition=null,Ai=1,i)return i()}finally{Ai=r,Wa.transition=n,oi=e,!(oi&6)&&pd()}}function jw(){ra=Eg.current,Hi(Eg)}function Qf(i,e){i.finishedWork=null,i.finishedLanes=0;var n=i.timeoutHandle;if(n!==-1&&(i.timeoutHandle=-1,P3(n)),Or!==null)for(n=Or.return;n!==null;){var r=n;switch(xw(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&RS();break;case 3:Ug(),Hi(Ro),Hi(Ws),Pw();break;case 5:kw(r);break;case 4:Ug();break;case 13:Hi(er);break;case 19:Hi(er);break;case 10:Iw(r.type._context);break;case 22:case 23:jw()}n=n.return}if(os=i,Or=i=ed(i.current,null),$s=ra=e,Yr=0,JT=null,zw=m$=vp=0,Ao=bT=null,zf!==null){for(e=0;e<zf.length;e++)if(n=zf[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,a=n.pending;if(a!==null){var l=a.next;a.next=s,r.next=l}n.pending=r}zf=null}return i}function iB(i,e){do{var n=Or;try{if(Mw(),iS.current=DS,PS){for(var r=ir.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}PS=!1}if(_p=0,rs=Xr=ir=null,ST=!1,jT=0,Vw.current=null,n===null||n.return===null){Yr=1,JT=e,Or=null;break}e:{var a=i,l=n.return,u=n,d=e;if(e=$s,u.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var h=d,f=u,p=f.tag;if(!(f.mode&1)&&(p===0||p===11||p===15)){var m=f.alternate;m?(f.updateQueue=m.updateQueue,f.memoizedState=m.memoizedState,f.lanes=m.lanes):(f.updateQueue=null,f.memoizedState=null)}var T=nL(l);if(T!==null){T.flags&=-257,iL(T,l,u,a,e),T.mode&1&&tL(a,h,e),e=T,d=h;var E=e.updateQueue;if(E===null){var b=new Set;b.add(d),e.updateQueue=b}else E.add(d);break e}else{if(!(e&1)){tL(a,h,e),Yw();break e}d=Error(Mt(426))}}else if(Yi&&u.mode&1){var y=nL(l);if(y!==null){!(y.flags&65536)&&(y.flags|=256),iL(y,l,u,a,e),Rw(Gg(d,u));break e}}a=d=Gg(d,u),Yr!==4&&(Yr=2),bT===null?bT=[a]:bT.push(a),a=l;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var S=UD(a,d,e);KO(a,S);break e;case 1:u=d;var A=a.type,C=a.stateNode;if(!(a.flags&128)&&(typeof A.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(qh===null||!qh.has(C)))){a.flags|=65536,e&=-e,a.lanes|=e;var R=GD(a,u,e);KO(a,R);break e}}a=a.return}while(a!==null)}oB(n)}catch(I){e=I,Or===n&&n!==null&&(Or=n=n.return);continue}break}while(1)}function rB(){var i=BS.current;return BS.current=DS,i===null?DS:i}function Yw(){(Yr===0||Yr===3||Yr===2)&&(Yr=4),os===null||!(vp&268435455)&&!(m$&268435455)||Hh(os,$s)}function GS(i,e){var n=oi;oi|=2;var r=rB();(os!==i||$s!==e)&&(_u=null,Qf(i,e));do try{aV();break}catch(s){iB(i,s)}while(1);if(Mw(),oi=n,BS.current=r,Or!==null)throw Error(Mt(261));return os=null,$s=0,Yr}function aV(){for(;Or!==null;)sB(Or)}function lV(){for(;Or!==null&&!LH();)sB(Or)}function sB(i){var e=lB(i.alternate,i,ra);i.memoizedProps=i.pendingProps,e===null?oB(i):Or=e,Vw.current=null}function oB(i){var e=i;do{var n=e.alternate;if(i=e.return,e.flags&32768){if(n=tV(n,e),n!==null){n.flags&=32767,Or=n;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Yr=6,Or=null;return}}else if(n=eV(n,e,ra),n!==null){Or=n;return}if(e=e.sibling,e!==null){Or=e;return}Or=e=i}while(e!==null);Yr===0&&(Yr=5)}function Pf(i,e,n){var r=Ai,s=Wa.transition;try{Wa.transition=null,Ai=1,cV(i,e,n,r)}finally{Wa.transition=s,Ai=r}return null}function cV(i,e,n,r){do Ig();while(zh!==null);if(oi&6)throw Error(Mt(327));n=i.finishedWork;var s=i.finishedLanes;if(n===null)return null;if(i.finishedWork=null,i.finishedLanes=0,n===i.current)throw Error(Mt(177));i.callbackNode=null,i.callbackPriority=0;var a=n.lanes|n.childLanes;if(VH(i,a),i===os&&(Or=os=null,$s=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Wy||(Wy=!0,cB(SS,function(){return Ig(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=Wa.transition,Wa.transition=null;var l=Ai;Ai=1;var u=oi;oi|=4,Vw.current=null,iV(i,n),eB(n,i),w3(Ox),bS=!!Ix,Ox=Ix=null,i.current=n,rV(n),NH(),oi=u,Ai=l,Wa.transition=a}else i.current=n;if(Wy&&(Wy=!1,zh=i,US=s),a=i.pendingLanes,a===0&&(qh=null),DH(n.stateNode),Mo(i,Tr()),e!==null)for(r=i.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(FS)throw FS=!1,i=qx,qx=null,i;return US&1&&i.tag!==0&&Ig(),a=i.pendingLanes,a&1?i===Qx?AT++:(AT=0,Qx=i):AT=0,pd(),null}function Ig(){if(zh!==null){var i=UP(US),e=Wa.transition,n=Ai;try{if(Wa.transition=null,Ai=16>i?16:i,zh===null)var r=!1;else{if(i=zh,zh=null,US=0,oi&6)throw Error(Mt(331));var s=oi;for(oi|=4,Wt=i.current;Wt!==null;){var a=Wt,l=a.child;if(Wt.flags&16){var u=a.deletions;if(u!==null){for(var d=0;d<u.length;d++){var h=u[d];for(Wt=h;Wt!==null;){var f=Wt;switch(f.tag){case 0:case 11:case 15:$T(8,f,a)}var p=f.child;if(p!==null)p.return=f,Wt=p;else for(;Wt!==null;){f=Wt;var m=f.sibling,T=f.return;if(ZD(f),f===h){Wt=null;break}if(m!==null){m.return=T,Wt=m;break}Wt=T}}}var E=a.alternate;if(E!==null){var b=E.child;if(b!==null){E.child=null;do{var y=b.sibling;b.sibling=null,b=y}while(b!==null)}}Wt=a}}if(a.subtreeFlags&2064&&l!==null)l.return=a,Wt=l;else e:for(;Wt!==null;){if(a=Wt,a.flags&2048)switch(a.tag){case 0:case 11:case 15:$T(9,a,a.return)}var S=a.sibling;if(S!==null){S.return=a.return,Wt=S;break e}Wt=a.return}}var A=i.current;for(Wt=A;Wt!==null;){l=Wt;var C=l.child;if(l.subtreeFlags&2064&&C!==null)C.return=l,Wt=C;else e:for(l=A;Wt!==null;){if(u=Wt,u.flags&2048)try{switch(u.tag){case 0:case 11:case 15:p$(9,u)}}catch(I){fr(u,u.return,I)}if(u===l){Wt=null;break e}var R=u.sibling;if(R!==null){R.return=u.return,Wt=R;break e}Wt=u.return}}if(oi=s,pd(),bc&&typeof bc.onPostCommitFiberRoot=="function")try{bc.onPostCommitFiberRoot(o$,i)}catch{}r=!0}return r}finally{Ai=n,Wa.transition=e}}return!1}function gL(i,e,n){e=Gg(n,e),e=UD(i,e,1),i=Zh(i,e,1),e=co(),i!==null&&(fE(i,1,e),Mo(i,e))}function fr(i,e,n){if(i.tag===3)gL(i,i,n);else for(;e!==null;){if(e.tag===3){gL(e,i,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(qh===null||!qh.has(r))){i=Gg(n,i),i=GD(e,i,1),e=Zh(e,i,1),i=co(),e!==null&&(fE(e,1,i),Mo(e,i));break}}e=e.return}}function uV(i,e,n){var r=i.pingCache;r!==null&&r.delete(e),e=co(),i.pingedLanes|=i.suspendedLanes&n,os===i&&($s&n)===n&&(Yr===4||Yr===3&&($s&130023424)===$s&&500>Tr()-Ww?Qf(i,0):zw|=n),Mo(i,e)}function aB(i,e){e===0&&(i.mode&1?(e=ky,ky<<=1,!(ky&130023424)&&(ky=4194304)):e=1);var n=co();i=Mu(i,e),i!==null&&(fE(i,e,n),Mo(i,n))}function hV(i){var e=i.memoizedState,n=0;e!==null&&(n=e.retryLane),aB(i,n)}function dV(i,e){var n=0;switch(i.tag){case 13:var r=i.stateNode,s=i.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=i.stateNode;break;default:throw Error(Mt(314))}r!==null&&r.delete(e),aB(i,n)}var lB;lB=function(i,e,n){if(i!==null)if(i.memoizedProps!==e.pendingProps||Ro.current)xo=!0;else{if(!(i.lanes&n)&&!(e.flags&128))return xo=!1,Q3(i,e,n);xo=!!(i.flags&131072)}else xo=!1,Yi&&e.flags&1048576&&dD(e,IS,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;sS(i,e),i=e.pendingProps;var s=Dg(e,Ws.current);Mg(e,n),s=Bw(null,e,r,i,s,n);var a=Fw();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,wo(r)?(a=!0,wS(e)):a=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Lw(e),s.updater=f$,e.stateNode=s,s._reactInternals=e,Gx(e,r,i,n),e=zx(null,e,r,!0,a,n)):(e.tag=0,Yi&&a&&Cw(e),ao(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(sS(i,e),i=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=pV(r),i=Cl(r,i),s){case 0:e=Vx(null,e,r,i,n);break e;case 1:e=oL(null,e,r,i,n);break e;case 11:e=rL(null,e,r,i,n);break e;case 14:e=sL(null,e,r,Cl(r.type,i),n);break e}throw Error(Mt(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Cl(r,s),Vx(i,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Cl(r,s),oL(i,e,r,s,n);case 3:e:{if(WD(e),i===null)throw Error(Mt(387));r=e.pendingProps,a=e.memoizedState,s=a.element,vD(i,e),NS(e,r,null,n);var l=e.memoizedState;if(r=l.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){s=Gg(Error(Mt(423)),e),e=aL(i,e,r,n,s);break e}else if(r!==s){s=Gg(Error(Mt(424)),e),e=aL(i,e,r,n,s);break e}else for(sa=Jh(e.stateNode.containerInfo.firstChild),aa=e,Yi=!0,wl=null,n=gD(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Bg(),r===s){e=Iu(i,e,n);break e}ao(i,e,r,n)}e=e.child}return e;case 5:return TD(e),i===null&&Bx(e),r=e.type,s=e.pendingProps,a=i!==null?i.memoizedProps:null,l=s.children,Lx(r,s)?l=null:a!==null&&Lx(r,a)&&(e.flags|=32),zD(i,e),ao(i,e,l,n),e.child;case 6:return i===null&&Bx(e),null;case 13:return XD(i,e,n);case 4:return Nw(e,e.stateNode.containerInfo),r=e.pendingProps,i===null?e.child=Fg(e,null,r,n):ao(i,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Cl(r,s),rL(i,e,r,s,n);case 7:return ao(i,e,e.pendingProps,n),e.child;case 8:return ao(i,e,e.pendingProps.children,n),e.child;case 12:return ao(i,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,a=e.memoizedProps,l=s.value,ki(OS,r._currentValue),r._currentValue=l,a!==null)if(kl(a.value,l)){if(a.children===s.children&&!Ro.current){e=Iu(i,e,n);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var u=a.dependencies;if(u!==null){l=a.child;for(var d=u.firstContext;d!==null;){if(d.context===r){if(a.tag===1){d=Cu(-1,n&-n),d.tag=2;var h=a.updateQueue;if(h!==null){h=h.shared;var f=h.pending;f===null?d.next=d:(d.next=f.next,f.next=d),h.pending=d}}a.lanes|=n,d=a.alternate,d!==null&&(d.lanes|=n),Fx(a.return,n,e),u.lanes|=n;break}d=d.next}}else if(a.tag===10)l=a.type===e.type?null:a.child;else if(a.tag===18){if(l=a.return,l===null)throw Error(Mt(341));l.lanes|=n,u=l.alternate,u!==null&&(u.lanes|=n),Fx(l,n,e),l=a.sibling}else l=a.child;if(l!==null)l.return=a;else for(l=a;l!==null;){if(l===e){l=null;break}if(a=l.sibling,a!==null){a.return=l.return,l=a;break}l=l.return}a=l}ao(i,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Mg(e,n),s=Xa(s),r=r(s),e.flags|=1,ao(i,e,r,n),e.child;case 14:return r=e.type,s=Cl(r,e.pendingProps),s=Cl(r.type,s),sL(i,e,r,s,n);case 15:return HD(i,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Cl(r,s),sS(i,e),e.tag=1,wo(r)?(i=!0,wS(e)):i=!1,Mg(e,n),FD(e,r,s),Gx(e,r,s,n),zx(null,e,r,!0,i,n);case 19:return jD(i,e,n);case 22:return VD(i,e,n)}throw Error(Mt(156,e.tag))};function cB(i,e){return PP(i,e)}function fV(i,e,n,r){this.tag=i,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Va(i,e,n,r){return new fV(i,e,n,r)}function Kw(i){return i=i.prototype,!(!i||!i.isReactComponent)}function pV(i){if(typeof i=="function")return Kw(i)?1:0;if(i!=null){if(i=i.$$typeof,i===pw)return 11;if(i===mw)return 14}return 2}function ed(i,e){var n=i.alternate;return n===null?(n=Va(i.tag,e,i.key,i.mode),n.elementType=i.elementType,n.type=i.type,n.stateNode=i.stateNode,n.alternate=i,i.alternate=n):(n.pendingProps=e,n.type=i.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=i.flags&14680064,n.childLanes=i.childLanes,n.lanes=i.lanes,n.child=i.child,n.memoizedProps=i.memoizedProps,n.memoizedState=i.memoizedState,n.updateQueue=i.updateQueue,e=i.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=i.sibling,n.index=i.index,n.ref=i.ref,n}function lS(i,e,n,r,s,a){var l=2;if(r=i,typeof i=="function")Kw(i)&&(l=1);else if(typeof i=="string")l=5;else e:switch(i){case ug:return ep(n.children,s,a,e);case fw:l=8,s|=8;break;case hx:return i=Va(12,n,e,s|2),i.elementType=hx,i.lanes=a,i;case dx:return i=Va(13,n,e,s),i.elementType=dx,i.lanes=a,i;case fx:return i=Va(19,n,e,s),i.elementType=fx,i.lanes=a,i;case TP:return g$(n,s,a,e);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case _P:l=10;break e;case vP:l=9;break e;case pw:l=11;break e;case mw:l=14;break e;case Bh:l=16,r=null;break e}throw Error(Mt(130,i==null?i:typeof i,""))}return e=Va(l,n,e,s),e.elementType=i,e.type=r,e.lanes=a,e}function ep(i,e,n,r){return i=Va(7,i,r,e),i.lanes=n,i}function g$(i,e,n,r){return i=Va(22,i,r,e),i.elementType=TP,i.lanes=n,i.stateNode={isHidden:!1},i}function eC(i,e,n){return i=Va(6,i,null,e),i.lanes=n,i}function tC(i,e,n){return e=Va(4,i.children!==null?i.children:[],i.key,e),e.lanes=n,e.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},e}function mV(i,e,n,r,s){this.tag=e,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=kA(0),this.expirationTimes=kA(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kA(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Jw(i,e,n,r,s,a,l,u,d){return i=new mV(i,e,n,u,d),e===1?(e=1,a===!0&&(e|=8)):e=0,a=Va(3,null,null,e),i.current=a,a.stateNode=i,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Lw(a),i}function gV(i,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:cg,key:r==null?null:""+r,children:i,containerInfo:e,implementation:n}}function uB(i){if(!i)return sd;i=i._reactInternals;e:{if(Rp(i)!==i||i.tag!==1)throw Error(Mt(170));var e=i;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(wo(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Mt(171))}if(i.tag===1){var n=i.type;if(wo(n))return uD(i,n,e)}return e}function hB(i,e,n,r,s,a,l,u,d){return i=Jw(n,r,!0,i,s,a,l,u,d),i.context=uB(null),n=i.current,r=co(),s=Qh(n),a=Cu(r,s),a.callback=e??null,Zh(n,a,s),i.current.lanes=s,fE(i,s,r),Mo(i,r),i}function _$(i,e,n,r){var s=e.current,a=co(),l=Qh(s);return n=uB(n),e.context===null?e.context=n:e.pendingContext=n,e=Cu(a,l),e.payload={element:i},r=r===void 0?null:r,r!==null&&(e.callback=r),i=Zh(s,e,l),i!==null&&(Ol(i,s,l,a),nS(i,s,l)),l}function HS(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function _L(i,e){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var n=i.retryLane;i.retryLane=n!==0&&n<e?n:e}}function Zw(i,e){_L(i,e),(i=i.alternate)&&_L(i,e)}function _V(){return null}var dB=typeof reportError=="function"?reportError:function(i){console.error(i)};function qw(i){this._internalRoot=i}v$.prototype.render=qw.prototype.render=function(i){var e=this._internalRoot;if(e===null)throw Error(Mt(409));_$(i,e,null,null)};v$.prototype.unmount=qw.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var e=i.containerInfo;Tp(function(){_$(null,i,null,null)}),e[wu]=null}};function v$(i){this._internalRoot=i}v$.prototype.unstable_scheduleHydration=function(i){if(i){var e=VP();i={blockedOn:null,target:i,priority:e};for(var n=0;n<Gh.length&&e!==0&&e<Gh[n].priority;n++);Gh.splice(n,0,i),n===0&&WP(i)}};function Qw(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function T$(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function vL(){}function vV(i,e,n,r,s){if(s){if(typeof r=="function"){var a=r;r=function(){var h=HS(l);a.call(h)}}var l=hB(e,r,i,0,null,!1,!1,"",vL);return i._reactRootContainer=l,i[wu]=l.current,HT(i.nodeType===8?i.parentNode:i),Tp(),l}for(;s=i.lastChild;)i.removeChild(s);if(typeof r=="function"){var u=r;r=function(){var h=HS(d);u.call(h)}}var d=Jw(i,0,!1,null,null,!1,!1,"",vL);return i._reactRootContainer=d,i[wu]=d.current,HT(i.nodeType===8?i.parentNode:i),Tp(function(){_$(e,d,n,r)}),d}function E$(i,e,n,r,s){var a=n._reactRootContainer;if(a){var l=a;if(typeof s=="function"){var u=s;s=function(){var d=HS(l);u.call(d)}}_$(e,l,i,s)}else l=vV(n,e,i,s,r);return HS(l)}GP=function(i){switch(i.tag){case 3:var e=i.stateNode;if(e.current.memoizedState.isDehydrated){var n=fT(e.pendingLanes);n!==0&&(vw(e,n|1),Mo(e,Tr()),!(oi&6)&&(Hg=Tr()+500,pd()))}break;case 13:Tp(function(){var r=Mu(i,1);if(r!==null){var s=co();Ol(r,i,1,s)}}),Zw(i,1)}};Tw=function(i){if(i.tag===13){var e=Mu(i,134217728);if(e!==null){var n=co();Ol(e,i,134217728,n)}Zw(i,134217728)}};HP=function(i){if(i.tag===13){var e=Qh(i),n=Mu(i,e);if(n!==null){var r=co();Ol(n,i,e,r)}Zw(i,e)}};VP=function(){return Ai};zP=function(i,e){var n=Ai;try{return Ai=i,e()}finally{Ai=n}};$x=function(i,e,n){switch(e){case"input":if(gx(i,n),e=n.name,n.type==="radio"&&e!=null){for(n=i;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==i&&r.form===i.form){var s=u$(r);if(!s)throw Error(Mt(90));yP(r),gx(r,s)}}}break;case"textarea":$P(i,n);break;case"select":e=n.value,e!=null&&Cg(i,!!n.multiple,e,!1)}};MP=Xw;IP=Tp;var TV={usingClientEntryPoint:!1,Events:[mE,pg,u$,RP,wP,Xw]},Nv={findFiberByHostInstance:Vf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},EV={bundleType:Nv.bundleType,version:Nv.version,rendererPackageName:Nv.rendererPackageName,rendererConfig:Nv.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ku.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=NP(i),i===null?null:i.stateNode},findFiberByHostInstance:Nv.findFiberByHostInstance||_V,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Xy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xy.isDisabled&&Xy.supportsFiber)try{o$=Xy.inject(EV),bc=Xy}catch{}}fa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=TV;fa.createPortal=function(i,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Qw(e))throw Error(Mt(200));return gV(i,e,null,n)};fa.createRoot=function(i,e){if(!Qw(i))throw Error(Mt(299));var n=!1,r="",s=dB;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Jw(i,1,!1,null,null,n,!1,r,s),i[wu]=e.current,HT(i.nodeType===8?i.parentNode:i),new qw(e)};fa.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var e=i._reactInternals;if(e===void 0)throw typeof i.render=="function"?Error(Mt(188)):(i=Object.keys(i).join(","),Error(Mt(268,i)));return i=NP(e),i=i===null?null:i.stateNode,i};fa.flushSync=function(i){return Tp(i)};fa.hydrate=function(i,e,n){if(!T$(e))throw Error(Mt(200));return E$(null,i,e,!0,n)};fa.hydrateRoot=function(i,e,n){if(!Qw(i))throw Error(Mt(405));var r=n!=null&&n.hydratedSources||null,s=!1,a="",l=dB;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(l=n.onRecoverableError)),e=hB(e,null,i,1,n??null,s,!1,a,l),i[wu]=e.current,HT(i),r)for(i=0;i<r.length;i++)n=r[i],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new v$(e)};fa.render=function(i,e,n){if(!T$(e))throw Error(Mt(200));return E$(null,i,e,!1,n)};fa.unmountComponentAtNode=function(i){if(!T$(i))throw Error(Mt(40));return i._reactRootContainer?(Tp(function(){E$(null,null,i,!1,function(){i._reactRootContainer=null,i[wu]=null})}),!0):!1};fa.unstable_batchedUpdates=Xw;fa.unstable_renderSubtreeIntoContainer=function(i,e,n,r){if(!T$(n))throw Error(Mt(200));if(i==null||i._reactInternals===void 0)throw Error(Mt(38));return E$(i,e,n,!1,r)};fa.version="18.3.1-next-f1338f8080-20240426";function fB(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(fB)}catch(i){console.error(i)}}fB(),fP.exports=fa;var yV=fP.exports;/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ZT(){return ZT=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])}return i},ZT.apply(this,arguments)}var Wh;(function(i){i.Pop="POP",i.Push="PUSH",i.Replace="REPLACE"})(Wh||(Wh={}));const TL="popstate";function SV(i){i===void 0&&(i={});function e(s,a){let{pathname:l="/",search:u="",hash:d=""}=wp(s.location.hash.substr(1));return!l.startsWith("/")&&!l.startsWith(".")&&(l="/"+l),nR("",{pathname:l,search:u,hash:d},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(s,a){let l=s.document.querySelector("base"),u="";if(l&&l.getAttribute("href")){let d=s.location.href,h=d.indexOf("#");u=h===-1?d:d.slice(0,h)}return u+"#"+(typeof a=="string"?a:pB(a))}function r(s,a){eM(s.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(a)+")")}return bV(e,n,r,i)}function Jr(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function eM(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function $V(){return Math.random().toString(36).substr(2,8)}function EL(i,e){return{usr:i.state,key:i.key,idx:e}}function nR(i,e,n,r){return n===void 0&&(n=null),ZT({pathname:typeof i=="string"?i:i.pathname,search:"",hash:""},typeof e=="string"?wp(e):e,{state:n,key:e&&e.key||r||$V()})}function pB(i){let{pathname:e="/",search:n="",hash:r=""}=i;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function wp(i){let e={};if(i){let n=i.indexOf("#");n>=0&&(e.hash=i.substr(n),i=i.substr(0,n));let r=i.indexOf("?");r>=0&&(e.search=i.substr(r),i=i.substr(0,r)),i&&(e.pathname=i)}return e}function bV(i,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:a=!1}=r,l=s.history,u=Wh.Pop,d=null,h=f();h==null&&(h=0,l.replaceState(ZT({},l.state,{idx:h}),""));function f(){return(l.state||{idx:null}).idx}function p(){u=Wh.Pop;let y=f(),S=y==null?null:y-h;h=y,d&&d({action:u,location:b.location,delta:S})}function m(y,S){u=Wh.Push;let A=nR(b.location,y,S);n&&n(A,y),h=f()+1;let C=EL(A,h),R=b.createHref(A);try{l.pushState(C,"",R)}catch(I){if(I instanceof DOMException&&I.name==="DataCloneError")throw I;s.location.assign(R)}a&&d&&d({action:u,location:b.location,delta:1})}function T(y,S){u=Wh.Replace;let A=nR(b.location,y,S);n&&n(A,y),h=f();let C=EL(A,h),R=b.createHref(A);l.replaceState(C,"",R),a&&d&&d({action:u,location:b.location,delta:0})}function E(y){let S=s.location.origin!=="null"?s.location.origin:s.location.href,A=typeof y=="string"?y:pB(y);return A=A.replace(/ $/,"%20"),Jr(S,"No window.location.(origin|href) available to create URL for href: "+A),new URL(A,S)}let b={get action(){return u},get location(){return i(s,l)},listen(y){if(d)throw new Error("A history only accepts one active listener");return s.addEventListener(TL,p),d=y,()=>{s.removeEventListener(TL,p),d=null}},createHref(y){return e(s,y)},createURL:E,encodeLocation(y){let S=E(y);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:m,replace:T,go(y){return l.go(y)}};return b}var yL;(function(i){i.data="data",i.deferred="deferred",i.redirect="redirect",i.error="error"})(yL||(yL={}));function AV(i,e,n){return n===void 0&&(n="/"),CV(i,e,n,!1)}function CV(i,e,n,r){let s=typeof e=="string"?wp(e):e,a=_B(s.pathname||"/",n);if(a==null)return null;let l=mB(i);xV(l);let u=null;for(let d=0;u==null&&d<l.length;++d){let h=BV(a);u=PV(l[d],h,r)}return u}function mB(i,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(a,l,u)=>{let d={relativePath:u===void 0?a.path||"":u,caseSensitive:a.caseSensitive===!0,childrenIndex:l,route:a};d.relativePath.startsWith("/")&&(Jr(d.relativePath.startsWith(r),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(r.length));let h=tp([r,d.relativePath]),f=n.concat(d);a.children&&a.children.length>0&&(Jr(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+h+'".')),mB(a.children,e,f,h)),!(a.path==null&&!a.index)&&e.push({path:h,score:NV(h,a.index),routesMeta:f})};return i.forEach((a,l)=>{var u;if(a.path===""||!((u=a.path)!=null&&u.includes("?")))s(a,l);else for(let d of gB(a.path))s(a,l,d)}),e}function gB(i){let e=i.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),a=n.replace(/\?$/,"");if(r.length===0)return s?[a,""]:[a];let l=gB(r.join("/")),u=[];return u.push(...l.map(d=>d===""?a:[a,d].join("/"))),s&&u.push(...l),u.map(d=>i.startsWith("/")&&d===""?"/":d)}function xV(i){i.sort((e,n)=>e.score!==n.score?n.score-e.score:kV(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const RV=/^:[\w-]+$/,wV=3,MV=2,IV=1,OV=10,LV=-2,SL=i=>i==="*";function NV(i,e){let n=i.split("/"),r=n.length;return n.some(SL)&&(r+=LV),e&&(r+=MV),n.filter(s=>!SL(s)).reduce((s,a)=>s+(RV.test(a)?wV:a===""?IV:OV),r)}function kV(i,e){return i.length===e.length&&i.slice(0,-1).every((r,s)=>r===e[s])?i[i.length-1]-e[e.length-1]:0}function PV(i,e,n){n===void 0&&(n=!1);let{routesMeta:r}=i,s={},a="/",l=[];for(let u=0;u<r.length;++u){let d=r[u],h=u===r.length-1,f=a==="/"?e:e.slice(a.length)||"/",p=$L({path:d.relativePath,caseSensitive:d.caseSensitive,end:h},f),m=d.route;if(!p&&h&&n&&!r[r.length-1].route.index&&(p=$L({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},f)),!p)return null;Object.assign(s,p.params),l.push({params:s,pathname:tp([a,p.pathname]),pathnameBase:zV(tp([a,p.pathnameBase])),route:m}),p.pathnameBase!=="/"&&(a=tp([a,p.pathnameBase]))}return l}function $L(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[n,r]=DV(i.path,i.caseSensitive,i.end),s=e.match(n);if(!s)return null;let a=s[0],l=a.replace(/(.)\/+$/,"$1"),u=s.slice(1);return{params:r.reduce((h,f,p)=>{let{paramName:m,isOptional:T}=f;if(m==="*"){let b=u[p]||"";l=a.slice(0,a.length-b.length).replace(/(.)\/+$/,"$1")}const E=u[p];return T&&!E?h[m]=void 0:h[m]=(E||"").replace(/%2F/g,"/"),h},{}),pathname:a,pathnameBase:l,pattern:i}}function DV(i,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),eM(i==="*"||!i.endsWith("*")||i.endsWith("/*"),'Route path "'+i+'" will be treated as if it were '+('"'+i.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+i.replace(/\*$/,"/*")+'".'));let r=[],s="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,u,d)=>(r.push({paramName:u,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(r.push({paramName:"*"}),s+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":i!==""&&i!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function BV(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return eM(!1,'The URL path "'+i+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),i}}function _B(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=i.charAt(n);return r&&r!=="/"?null:i.slice(n)||"/"}function FV(i,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof i=="string"?wp(i):i;return{pathname:n?n.startsWith("/")?n:UV(n,e):e,search:WV(r),hash:XV(s)}}function UV(i,e){let n=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function nC(i,e,n,r){return"Cannot include a '"+i+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function GV(i){return i.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function HV(i,e){let n=GV(i);return e?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function VV(i,e,n,r){r===void 0&&(r=!1);let s;typeof i=="string"?s=wp(i):(s=ZT({},i),Jr(!s.pathname||!s.pathname.includes("?"),nC("?","pathname","search",s)),Jr(!s.pathname||!s.pathname.includes("#"),nC("#","pathname","hash",s)),Jr(!s.search||!s.search.includes("#"),nC("#","search","hash",s)));let a=i===""||s.pathname==="",l=a?"/":s.pathname,u;if(l==null)u=n;else{let p=e.length-1;if(!r&&l.startsWith("..")){let m=l.split("/");for(;m[0]==="..";)m.shift(),p-=1;s.pathname=m.join("/")}u=p>=0?e[p]:"/"}let d=FV(s,u),h=l&&l!=="/"&&l.endsWith("/"),f=(a||l===".")&&n.endsWith("/");return!d.pathname.endsWith("/")&&(h||f)&&(d.pathname+="/"),d}const tp=i=>i.join("/").replace(/\/\/+/g,"/"),zV=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),WV=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,XV=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function jV(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}const vB=["post","put","patch","delete"];new Set(vB);const YV=["get",...vB];new Set(YV);/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function qT(){return qT=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])}return i},qT.apply(this,arguments)}const tM=q.createContext(null),KV=q.createContext(null),y$=q.createContext(null),S$=q.createContext(null),qg=q.createContext({outlet:null,matches:[],isDataRoute:!1}),TB=q.createContext(null);function $$(){return q.useContext(S$)!=null}function EB(){return $$()||Jr(!1),q.useContext(S$).location}function yB(i){q.useContext(y$).static||q.useLayoutEffect(i)}function JV(){let{isDataRoute:i}=q.useContext(qg);return i?cz():ZV()}function ZV(){$$()||Jr(!1);let i=q.useContext(tM),{basename:e,future:n,navigator:r}=q.useContext(y$),{matches:s}=q.useContext(qg),{pathname:a}=EB(),l=JSON.stringify(HV(s,n.v7_relativeSplatPath)),u=q.useRef(!1);return yB(()=>{u.current=!0}),q.useCallback(function(h,f){if(f===void 0&&(f={}),!u.current)return;if(typeof h=="number"){r.go(h);return}let p=VV(h,JSON.parse(l),a,f.relative==="path");i==null&&e!=="/"&&(p.pathname=p.pathname==="/"?e:tp([e,p.pathname])),(f.replace?r.replace:r.push)(p,f.state,f)},[e,r,l,a,i])}function qV(i,e){return QV(i,e)}function QV(i,e,n,r){$$()||Jr(!1);let{navigator:s}=q.useContext(y$),{matches:a}=q.useContext(qg),l=a[a.length-1],u=l?l.params:{};l&&l.pathname;let d=l?l.pathnameBase:"/";l&&l.route;let h=EB(),f;if(e){var p;let y=typeof e=="string"?wp(e):e;d==="/"||(p=y.pathname)!=null&&p.startsWith(d)||Jr(!1),f=y}else f=h;let m=f.pathname||"/",T=m;if(d!=="/"){let y=d.replace(/^\//,"").split("/");T="/"+m.replace(/^\//,"").split("/").slice(y.length).join("/")}let E=AV(i,{pathname:T}),b=rz(E&&E.map(y=>Object.assign({},y,{params:Object.assign({},u,y.params),pathname:tp([d,s.encodeLocation?s.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?d:tp([d,s.encodeLocation?s.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),a,n,r);return e&&b?q.createElement(S$.Provider,{value:{location:qT({pathname:"/",search:"",hash:"",state:null,key:"default"},f),navigationType:Wh.Pop}},b):b}function ez(){let i=lz(),e=jV(i)?i.status+" "+i.statusText:i instanceof Error?i.message:JSON.stringify(i),n=i instanceof Error?i.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},a=null;return q.createElement(q.Fragment,null,q.createElement("h2",null,"Unexpected Application Error!"),q.createElement("h3",{style:{fontStyle:"italic"}},e),n?q.createElement("pre",{style:s},n):null,a)}const tz=q.createElement(ez,null);class nz extends q.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?q.createElement(qg.Provider,{value:this.props.routeContext},q.createElement(TB.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function iz(i){let{routeContext:e,match:n,children:r}=i,s=q.useContext(tM);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),q.createElement(qg.Provider,{value:e},r)}function rz(i,e,n,r){var s;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),i==null){var a;if(!n)return null;if(n.errors)i=n.matches;else if((a=r)!=null&&a.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)i=n.matches;else return null}let l=i,u=(s=n)==null?void 0:s.errors;if(u!=null){let f=l.findIndex(p=>p.route.id&&(u==null?void 0:u[p.route.id])!==void 0);f>=0||Jr(!1),l=l.slice(0,Math.min(l.length,f+1))}let d=!1,h=-1;if(n&&r&&r.v7_partialHydration)for(let f=0;f<l.length;f++){let p=l[f];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(h=f),p.route.id){let{loaderData:m,errors:T}=n,E=p.route.loader&&m[p.route.id]===void 0&&(!T||T[p.route.id]===void 0);if(p.route.lazy||E){d=!0,h>=0?l=l.slice(0,h+1):l=[l[0]];break}}}return l.reduceRight((f,p,m)=>{let T,E=!1,b=null,y=null;n&&(T=u&&p.route.id?u[p.route.id]:void 0,b=p.route.errorElement||tz,d&&(h<0&&m===0?(uz("route-fallback",!1),E=!0,y=null):h===m&&(E=!0,y=p.route.hydrateFallbackElement||null)));let S=e.concat(l.slice(0,m+1)),A=()=>{let C;return T?C=b:E?C=y:p.route.Component?C=q.createElement(p.route.Component,null):p.route.element?C=p.route.element:C=f,q.createElement(iz,{match:p,routeContext:{outlet:f,matches:S,isDataRoute:n!=null},children:C})};return n&&(p.route.ErrorBoundary||p.route.errorElement||m===0)?q.createElement(nz,{location:n.location,revalidation:n.revalidation,component:b,error:T,children:A(),routeContext:{outlet:null,matches:S,isDataRoute:!0}}):A()},null)}var SB=function(i){return i.UseBlocker="useBlocker",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i}(SB||{}),VS=function(i){return i.UseBlocker="useBlocker",i.UseLoaderData="useLoaderData",i.UseActionData="useActionData",i.UseRouteError="useRouteError",i.UseNavigation="useNavigation",i.UseRouteLoaderData="useRouteLoaderData",i.UseMatches="useMatches",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i.UseRouteId="useRouteId",i}(VS||{});function sz(i){let e=q.useContext(tM);return e||Jr(!1),e}function oz(i){let e=q.useContext(KV);return e||Jr(!1),e}function az(i){let e=q.useContext(qg);return e||Jr(!1),e}function $B(i){let e=az(),n=e.matches[e.matches.length-1];return n.route.id||Jr(!1),n.route.id}function lz(){var i;let e=q.useContext(TB),n=oz(VS.UseRouteError),r=$B(VS.UseRouteError);return e!==void 0?e:(i=n.errors)==null?void 0:i[r]}function cz(){let{router:i}=sz(SB.UseNavigateStable),e=$B(VS.UseNavigateStable),n=q.useRef(!1);return yB(()=>{n.current=!0}),q.useCallback(function(s,a){a===void 0&&(a={}),n.current&&(typeof s=="number"?i.navigate(s):i.navigate(s,qT({fromRouteId:e},a)))},[i,e])}const bL={};function uz(i,e,n){!e&&!bL[i]&&(bL[i]=!0)}function Hs(i){Jr(!1)}function hz(i){let{basename:e="/",children:n=null,location:r,navigationType:s=Wh.Pop,navigator:a,static:l=!1,future:u}=i;$$()&&Jr(!1);let d=e.replace(/^\/*/,"/"),h=q.useMemo(()=>({basename:d,navigator:a,static:l,future:qT({v7_relativeSplatPath:!1},u)}),[d,u,a,l]);typeof r=="string"&&(r=wp(r));let{pathname:f="/",search:p="",hash:m="",state:T=null,key:E="default"}=r,b=q.useMemo(()=>{let y=_B(f,d);return y==null?null:{location:{pathname:y,search:p,hash:m,state:T,key:E},navigationType:s}},[d,f,p,m,T,E,s]);return b==null?null:q.createElement(y$.Provider,{value:h},q.createElement(S$.Provider,{children:n,value:b}))}function dz(i){let{children:e,location:n}=i;return qV(iR(e),n)}new Promise(()=>{});function iR(i,e){e===void 0&&(e=[]);let n=[];return q.Children.forEach(i,(r,s)=>{if(!q.isValidElement(r))return;let a=[...e,s];if(r.type===q.Fragment){n.push.apply(n,iR(r.props.children,a));return}r.type!==Hs&&Jr(!1),!r.props.index||!r.props.children||Jr(!1);let l={id:r.props.id||a.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=iR(r.props.children,a)),n.push(l)}),n}/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const fz="6";try{window.__reactRouterVersion=fz}catch{}const pz="startTransition",AL=uH[pz];function mz(i){let{basename:e,children:n,future:r,window:s}=i,a=q.useRef();a.current==null&&(a.current=SV({window:s,v5Compat:!0}));let l=a.current,[u,d]=q.useState({action:l.action,location:l.location}),{v7_startTransition:h}=r||{},f=q.useCallback(p=>{h&&AL?AL(()=>d(p)):d(p)},[d,h]);return q.useLayoutEffect(()=>l.listen(f),[l,f]),q.createElement(hz,{basename:e,children:n,location:u.location,navigationType:u.action,navigator:l,future:r})}var CL;(function(i){i.UseScrollRestoration="useScrollRestoration",i.UseSubmit="useSubmit",i.UseSubmitFetcher="useSubmitFetcher",i.UseFetcher="useFetcher",i.useViewTransitionState="useViewTransitionState"})(CL||(CL={}));var xL;(function(i){i.UseFetcher="useFetcher",i.UseFetchers="useFetchers",i.UseScrollRestoration="useScrollRestoration"})(xL||(xL={}));var rR={},bB,RL=yV;bB=rR.createRoot=RL.createRoot,rR.hydrateRoot=RL.hydrateRoot;var AB={exports:{}},gz="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",_z=gz,vz=_z;function CB(){}function xB(){}xB.resetWarningCache=CB;var Tz=function(){function i(r,s,a,l,u,d){if(d!==vz){var h=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw h.name="Invariant Violation",h}}i.isRequired=i;function e(){return i}var n={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:e,element:i,elementType:i,instanceOf:e,node:i,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:xB,resetWarningCache:CB};return n.PropTypes=n,n};AB.exports=Tz();var Ez=AB.exports;const Xt=hd(Ez),yz=()=>window.location.hostname.includes("localhost")?"assets/fixtures/nws_banner.png":"/drone-simulation-cte-alpha/assets/fixtures/nws_banner.png";const yg=({onClick:i,title:e,green:n,small:r,medium:s,right:a,disableButton:l})=>{const u={backgroundColor:n?"#28a745":"#007bff",width:r?"100px":s?"200px":"100%",cursor:"pointer",marginLeft:a?"auto":"0",disable:l};return G.jsxs("button",{className:"action-button",onClick:i,style:u,children:[" ",e]})};yg.propTypes={onClick:Xt.func,title:Xt.string,green:Xt.bool,small:Xt.bool,right:Xt.bool,medium:Xt.bool,disableButton:Xt.bool};const fo=({children:i})=>{const e=JV(),[n,r]=q.useState(!1),s=()=>{window.open("https://nextwavestem.github.io/drone-simulation/")};return q.useEffect(()=>{(l=>{const u=document.cookie.match(new RegExp("(^| )"+l+"=([^;]+)"));return u?decodeURIComponent(u[2]):null})("session_active")},[e]),G.jsxs("div",{className:"application-container",children:[G.jsxs("div",{className:"header-container",children:[G.jsx("div",{className:"nws-logo",onClick:s,children:G.jsx("img",{src:yz(),alt:"Logo"})}),G.jsx("div",{className:"nws-home",onClick:s,children:G.jsx(yg,{right:!0,small:!0,green:!0,title:"Home"})})]}),n&&G.jsxs("div",{className:"note-box",children:[G.jsxs("p",{children:["⚠️ ",G.jsx("strong",{children:"Note:"})," Enabling mouse control disables the default camera perspective of the drone."]}),G.jsx("button",{className:"close-btn",onClick:()=>r(!1),children:"✖"})]}),G.jsx("div",{className:"application-content",children:i})]})};fo.propTypes={children:Xt.node};/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Mp="153",Df={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Bf={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},RB=0,sR=1,wB=2,Sz=3,MB=0,b$=1,CT=2,xl=3,Ya=0,zs=1,Ss=2,$z=2,Cc=0,np=1,oR=2,aR=3,lR=4,IB=5,Uf=100,OB=101,LB=102,cR=103,uR=104,NB=200,kB=201,PB=202,DB=203,nM=204,iM=205,BB=206,FB=207,UB=208,GB=209,HB=210,VB=0,zB=1,WB=2,zS=3,XB=4,jB=5,YB=6,KB=7,_E=0,JB=1,ZB=2,Ll=0,qB=1,QB=2,eF=3,rM=4,tF=5,od=300,Ou=301,ad=302,Vg=303,QT=304,Qg=306,Pl=1e3,Pi=1001,Ep=1002,tr=1003,zg=1004,bz=1004,ip=1005,Az=1005,Gn=1006,vE=1007,Cz=1007,Ka=1008,hR=1008,la=1009,sM=1010,oM=1011,A$=1012,C$=1013,Sc=1014,Kr=1015,ss=1016,aM=1017,lM=1018,td=1020,nF=1021,jr=1023,iF=1024,rF=1025,nd=1026,yp=1027,cM=1028,uM=1029,sF=1030,hM=1031,dM=1033,cS=33776,uS=33777,hS=33778,dS=33779,dR=35840,fR=35841,pR=35842,mR=35843,oF=36196,gR=37492,_R=37496,vR=37808,TR=37809,ER=37810,yR=37811,SR=37812,$R=37813,bR=37814,AR=37815,CR=37816,xR=37817,RR=37818,wR=37819,MR=37820,IR=37821,fS=36492,aF=36283,OR=36284,LR=36285,NR=36286,lF=2200,cF=2201,uF=2202,Sp=2300,Lu=2301,pS=2302,Xf=2400,jf=2401,eE=2402,x$=2500,fM=2501,pM=0,TE=1,$p=2,R$=3e3,xc=3001,hF=3200,mM=3201,md=0,dF=1,id="",Tn="srgb",Io="srgb-linear",gM="display-p3",xz=0,mS=7680,Rz=7681,wz=7682,Mz=7683,Iz=34055,Oz=34056,Lz=5386,Nz=512,kz=513,Pz=514,Dz=515,Bz=516,Fz=517,Uz=518,fF=519,pF=512,mF=513,gF=514,_F=515,vF=516,TF=517,EF=518,yF=519,tE=35044,Gz=35048,Hz=35040,Vz=35045,zz=35049,Wz=35041,Xz=35046,jz=35050,Yz=35042,Kz="100",kR="300 es",WS=1035,$c=2e3,nE=2001;class Mc{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(n)===-1&&r[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const a=s.indexOf(n);a!==-1&&s.splice(a,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const s=r.slice(0);for(let a=0,l=s.length;a<l;a++)s[a].call(this,e);e.target=null}}}const Us=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let wL=1234567;const rp=Math.PI/180,Wg=180/Math.PI;function ca(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Us[i&255]+Us[i>>8&255]+Us[i>>16&255]+Us[i>>24&255]+"-"+Us[e&255]+Us[e>>8&255]+"-"+Us[e>>16&15|64]+Us[e>>24&255]+"-"+Us[n&63|128]+Us[n>>8&255]+"-"+Us[n>>16&255]+Us[n>>24&255]+Us[r&255]+Us[r>>8&255]+Us[r>>16&255]+Us[r>>24&255]).toLowerCase()}function pr(i,e,n){return Math.max(e,Math.min(n,i))}function _M(i,e){return(i%e+e)%e}function Jz(i,e,n,r,s){return r+(i-e)*(s-r)/(n-e)}function Zz(i,e,n){return i!==e?(n-i)/(e-i):0}function xT(i,e,n){return(1-n)*i+n*e}function qz(i,e,n,r){return xT(i,e,1-Math.exp(-n*r))}function Qz(i,e=1){return e-Math.abs(_M(i,e*2)-e)}function e4(i,e,n){return i<=e?0:i>=n?1:(i=(i-e)/(n-e),i*i*(3-2*i))}function t4(i,e,n){return i<=e?0:i>=n?1:(i=(i-e)/(n-e),i*i*i*(i*(i*6-15)+10))}function n4(i,e){return i+Math.floor(Math.random()*(e-i+1))}function i4(i,e){return i+Math.random()*(e-i)}function r4(i){return i*(.5-Math.random())}function s4(i){i!==void 0&&(wL=i);let e=wL+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function o4(i){return i*rp}function a4(i){return i*Wg}function PR(i){return(i&i-1)===0&&i!==0}function SF(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function XS(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function l4(i,e,n,r,s){const a=Math.cos,l=Math.sin,u=a(n/2),d=l(n/2),h=a((e+r)/2),f=l((e+r)/2),p=a((e-r)/2),m=l((e-r)/2),T=a((r-e)/2),E=l((r-e)/2);switch(s){case"XYX":i.set(u*f,d*p,d*m,u*h);break;case"YZY":i.set(d*m,u*f,d*p,u*h);break;case"ZXZ":i.set(d*p,d*m,u*f,u*h);break;case"XZX":i.set(u*f,d*E,d*T,u*h);break;case"YXY":i.set(d*T,u*f,d*E,u*h);break;case"ZYZ":i.set(d*E,d*T,u*f,u*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function oa(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function kn(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const sp={DEG2RAD:rp,RAD2DEG:Wg,generateUUID:ca,clamp:pr,euclideanModulo:_M,mapLinear:Jz,inverseLerp:Zz,lerp:xT,damp:qz,pingpong:Qz,smoothstep:e4,smootherstep:t4,randInt:n4,randFloat:i4,randFloatSpread:r4,seededRandom:s4,degToRad:o4,radToDeg:a4,isPowerOfTwo:PR,ceilPowerOfTwo:SF,floorPowerOfTwo:XS,setQuaternionFromProperEuler:l4,normalize:kn,denormalize:oa};class mt{constructor(e=0,n=0){mt.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,s=e.elements;return this.x=s[0]*n+s[3]*r+s[6],this.y=s[1]*n+s[4]*r+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(pr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),s=Math.sin(n),a=this.x-e.x,l=this.y-e.y;return this.x=a*r-l*s+e.x,this.y=a*s+l*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ln{constructor(e,n,r,s,a,l,u,d,h){Ln.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,s,a,l,u,d,h)}set(e,n,r,s,a,l,u,d,h){const f=this.elements;return f[0]=e,f[1]=s,f[2]=u,f[3]=n,f[4]=a,f[5]=d,f[6]=r,f[7]=l,f[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,s=n.elements,a=this.elements,l=r[0],u=r[3],d=r[6],h=r[1],f=r[4],p=r[7],m=r[2],T=r[5],E=r[8],b=s[0],y=s[3],S=s[6],A=s[1],C=s[4],R=s[7],I=s[2],O=s[5],F=s[8];return a[0]=l*b+u*A+d*I,a[3]=l*y+u*C+d*O,a[6]=l*S+u*R+d*F,a[1]=h*b+f*A+p*I,a[4]=h*y+f*C+p*O,a[7]=h*S+f*R+p*F,a[2]=m*b+T*A+E*I,a[5]=m*y+T*C+E*O,a[8]=m*S+T*R+E*F,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],s=e[2],a=e[3],l=e[4],u=e[5],d=e[6],h=e[7],f=e[8];return n*l*f-n*u*h-r*a*f+r*u*d+s*a*h-s*l*d}invert(){const e=this.elements,n=e[0],r=e[1],s=e[2],a=e[3],l=e[4],u=e[5],d=e[6],h=e[7],f=e[8],p=f*l-u*h,m=u*d-f*a,T=h*a-l*d,E=n*p+r*m+s*T;if(E===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/E;return e[0]=p*b,e[1]=(s*h-f*r)*b,e[2]=(u*r-s*l)*b,e[3]=m*b,e[4]=(f*n-s*d)*b,e[5]=(s*a-u*n)*b,e[6]=T*b,e[7]=(r*d-h*n)*b,e[8]=(l*n-r*a)*b,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,s,a,l,u){const d=Math.cos(a),h=Math.sin(a);return this.set(r*d,r*h,-r*(d*l+h*u)+l+e,-s*h,s*d,-s*(-h*l+d*u)+u+n,0,0,1),this}scale(e,n){return this.premultiply(iC.makeScale(e,n)),this}rotate(e){return this.premultiply(iC.makeRotation(-e)),this}translate(e,n){return this.premultiply(iC.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let s=0;s<9;s++)if(n[s]!==r[s])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const iC=new Ln;function $F(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}const c4={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Sg(i,e){return new c4[i](e)}function iE(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}const ML={};function RT(i){i in ML||(ML[i]=!0,console.warn(i))}function Og(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function rC(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}const u4=new Ln().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),h4=new Ln().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function d4(i){return i.convertSRGBToLinear().applyMatrix3(h4)}function f4(i){return i.applyMatrix3(u4).convertLinearToSRGB()}const p4={[Io]:i=>i,[Tn]:i=>i.convertSRGBToLinear(),[gM]:d4},m4={[Io]:i=>i,[Tn]:i=>i.convertLinearToSRGB(),[gM]:f4},Pa={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(i){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!i},get workingColorSpace(){return Io},set workingColorSpace(i){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(i,e,n){if(this.enabled===!1||e===n||!e||!n)return i;const r=p4[e],s=m4[n];if(r===void 0||s===void 0)throw new Error(`Unsupported color space conversion, "${e}" to "${n}".`);return s(r(i))},fromWorkingColorSpace:function(i,e){return this.convert(i,this.workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this.workingColorSpace)}};let km;class vM{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{km===void 0&&(km=iE("canvas")),km.width=e.width,km.height=e.height;const r=km.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),n=km}return n.width>2048||n.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=iE("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const s=r.getImageData(0,0,e.width,e.height),a=s.data;for(let l=0;l<a.length;l++)a[l]=Og(a[l]/255)*255;return r.putImageData(s,0,0),n}else if(e.data){const n=e.data.slice(0);for(let r=0;r<n.length;r++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[r]=Math.floor(Og(n[r]/255)*255):n[r]=Og(n[r]);return{data:n,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let g4=0;class Yf{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:g4++}),this.uuid=ca(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},s=this.data;if(s!==null){let a;if(Array.isArray(s)){a=[];for(let l=0,u=s.length;l<u;l++)s[l].isDataTexture?a.push(sC(s[l].image)):a.push(sC(s[l]))}else a=sC(s);r.url=a}return n||(e.images[this.uuid]=r),r}}function sC(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?vM.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _4=0;class ni extends Mc{constructor(e=ni.DEFAULT_IMAGE,n=ni.DEFAULT_MAPPING,r=Pi,s=Pi,a=Gn,l=Ka,u=jr,d=la,h=ni.DEFAULT_ANISOTROPY,f=id){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_4++}),this.uuid=ca(),this.name="",this.source=new Yf(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=r,this.wrapT=s,this.magFilter=a,this.minFilter=l,this.anisotropy=h,this.format=u,this.internalFormat=null,this.type=d,this.offset=new mt(0,0),this.repeat=new mt(1,1),this.center=new mt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ln,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof f=="string"?this.colorSpace=f:(RT("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=f===xc?Tn:id),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),n||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==od)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Pl:e.x=e.x-Math.floor(e.x);break;case Pi:e.x=e.x<0?0:1;break;case Ep:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Pl:e.y=e.y-Math.floor(e.y);break;case Pi:e.y=e.y<0?0:1;break;case Ep:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return RT("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Tn?xc:R$}set encoding(e){RT("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===xc?Tn:id}}ni.DEFAULT_IMAGE=null;ni.DEFAULT_MAPPING=od;ni.DEFAULT_ANISOTROPY=1;class Hn{constructor(e=0,n=0,r=0,s=1){Hn.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,r,s){return this.x=e,this.y=n,this.z=r,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,r=this.y,s=this.z,a=this.w,l=e.elements;return this.x=l[0]*n+l[4]*r+l[8]*s+l[12]*a,this.y=l[1]*n+l[5]*r+l[9]*s+l[13]*a,this.z=l[2]*n+l[6]*r+l[10]*s+l[14]*a,this.w=l[3]*n+l[7]*r+l[11]*s+l[15]*a,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,r,s,a;const d=e.elements,h=d[0],f=d[4],p=d[8],m=d[1],T=d[5],E=d[9],b=d[2],y=d[6],S=d[10];if(Math.abs(f-m)<.01&&Math.abs(p-b)<.01&&Math.abs(E-y)<.01){if(Math.abs(f+m)<.1&&Math.abs(p+b)<.1&&Math.abs(E+y)<.1&&Math.abs(h+T+S-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const C=(h+1)/2,R=(T+1)/2,I=(S+1)/2,O=(f+m)/4,F=(p+b)/4,k=(E+y)/4;return C>R&&C>I?C<.01?(r=0,s=.707106781,a=.707106781):(r=Math.sqrt(C),s=O/r,a=F/r):R>I?R<.01?(r=.707106781,s=0,a=.707106781):(s=Math.sqrt(R),r=O/s,a=k/s):I<.01?(r=.707106781,s=.707106781,a=0):(a=Math.sqrt(I),r=F/a,s=k/a),this.set(r,s,a,n),this}let A=Math.sqrt((y-E)*(y-E)+(p-b)*(p-b)+(m-f)*(m-f));return Math.abs(A)<.001&&(A=1),this.x=(y-E)/A,this.y=(p-b)/A,this.z=(m-f)/A,this.w=Math.acos((h+T+S-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this.w=Math.max(e.w,Math.min(n.w,this.w)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this.w=Math.max(e,Math.min(n,this.w)),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this.w=e.w+(n.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class da extends Mc{constructor(e=1,n=1,r={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=n,this.depth=1,this.scissor=new Hn(0,0,e,n),this.scissorTest=!1,this.viewport=new Hn(0,0,e,n);const s={width:e,height:n,depth:1};r.encoding!==void 0&&(RT("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),r.colorSpace=r.encoding===xc?Tn:id),this.texture=new ni(s,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps!==void 0?r.generateMipmaps:!1,this.texture.internalFormat=r.internalFormat!==void 0?r.internalFormat:null,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:Gn,this.depthBuffer=r.depthBuffer!==void 0?r.depthBuffer:!0,this.stencilBuffer=r.stencilBuffer!==void 0?r.stencilBuffer:!1,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null,this.samples=r.samples!==void 0?r.samples:0}setSize(e,n,r=1){(this.width!==e||this.height!==n||this.depth!==r)&&(this.width=e,this.height=n,this.depth=r,this.texture.image.width=e,this.texture.image.height=n,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const n=Object.assign({},e.texture.image);return this.texture.source=new Yf(n),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class w$ extends ni{constructor(e=null,n=1,r=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:r,depth:s},this.magFilter=tr,this.minFilter=tr,this.wrapR=Pi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class v4 extends da{constructor(e=1,n=1,r=1){super(e,n),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new w$(null,e,n,r),this.texture.isRenderTargetTexture=!0}}class TM extends ni{constructor(e=null,n=1,r=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:r,depth:s},this.magFilter=tr,this.minFilter=tr,this.wrapR=Pi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class T4 extends da{constructor(e=1,n=1,r=1){super(e,n),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new TM(null,e,n,r),this.texture.isRenderTargetTexture=!0}}class E4 extends da{constructor(e=1,n=1,r=1,s={}){super(e,n,s),this.isWebGLMultipleRenderTargets=!0;const a=this.texture;this.texture=[];for(let l=0;l<r;l++)this.texture[l]=a.clone(),this.texture[l].isRenderTargetTexture=!0}setSize(e,n,r=1){if(this.width!==e||this.height!==n||this.depth!==r){this.width=e,this.height=n,this.depth=r;for(let s=0,a=this.texture.length;s<a;s++)this.texture[s].image.width=e,this.texture[s].image.height=n,this.texture[s].image.depth=r;this.dispose()}return this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let n=0,r=e.texture.length;n<r;n++)this.texture[n]=e.texture[n].clone(),this.texture[n].isRenderTargetTexture=!0;return this}}class Er{constructor(e=0,n=0,r=0,s=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=r,this._w=s}static slerpFlat(e,n,r,s,a,l,u){let d=r[s+0],h=r[s+1],f=r[s+2],p=r[s+3];const m=a[l+0],T=a[l+1],E=a[l+2],b=a[l+3];if(u===0){e[n+0]=d,e[n+1]=h,e[n+2]=f,e[n+3]=p;return}if(u===1){e[n+0]=m,e[n+1]=T,e[n+2]=E,e[n+3]=b;return}if(p!==b||d!==m||h!==T||f!==E){let y=1-u;const S=d*m+h*T+f*E+p*b,A=S>=0?1:-1,C=1-S*S;if(C>Number.EPSILON){const I=Math.sqrt(C),O=Math.atan2(I,S*A);y=Math.sin(y*O)/I,u=Math.sin(u*O)/I}const R=u*A;if(d=d*y+m*R,h=h*y+T*R,f=f*y+E*R,p=p*y+b*R,y===1-u){const I=1/Math.sqrt(d*d+h*h+f*f+p*p);d*=I,h*=I,f*=I,p*=I}}e[n]=d,e[n+1]=h,e[n+2]=f,e[n+3]=p}static multiplyQuaternionsFlat(e,n,r,s,a,l){const u=r[s],d=r[s+1],h=r[s+2],f=r[s+3],p=a[l],m=a[l+1],T=a[l+2],E=a[l+3];return e[n]=u*E+f*p+d*T-h*m,e[n+1]=d*E+f*m+h*p-u*T,e[n+2]=h*E+f*T+u*m-d*p,e[n+3]=f*E-u*p-d*m-h*T,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,r,s){return this._x=e,this._y=n,this._z=r,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n){const r=e._x,s=e._y,a=e._z,l=e._order,u=Math.cos,d=Math.sin,h=u(r/2),f=u(s/2),p=u(a/2),m=d(r/2),T=d(s/2),E=d(a/2);switch(l){case"XYZ":this._x=m*f*p+h*T*E,this._y=h*T*p-m*f*E,this._z=h*f*E+m*T*p,this._w=h*f*p-m*T*E;break;case"YXZ":this._x=m*f*p+h*T*E,this._y=h*T*p-m*f*E,this._z=h*f*E-m*T*p,this._w=h*f*p+m*T*E;break;case"ZXY":this._x=m*f*p-h*T*E,this._y=h*T*p+m*f*E,this._z=h*f*E+m*T*p,this._w=h*f*p-m*T*E;break;case"ZYX":this._x=m*f*p-h*T*E,this._y=h*T*p+m*f*E,this._z=h*f*E-m*T*p,this._w=h*f*p+m*T*E;break;case"YZX":this._x=m*f*p+h*T*E,this._y=h*T*p+m*f*E,this._z=h*f*E-m*T*p,this._w=h*f*p-m*T*E;break;case"XZY":this._x=m*f*p-h*T*E,this._y=h*T*p-m*f*E,this._z=h*f*E+m*T*p,this._w=h*f*p+m*T*E;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+l)}return n!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const r=n/2,s=Math.sin(r);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,r=n[0],s=n[4],a=n[8],l=n[1],u=n[5],d=n[9],h=n[2],f=n[6],p=n[10],m=r+u+p;if(m>0){const T=.5/Math.sqrt(m+1);this._w=.25/T,this._x=(f-d)*T,this._y=(a-h)*T,this._z=(l-s)*T}else if(r>u&&r>p){const T=2*Math.sqrt(1+r-u-p);this._w=(f-d)/T,this._x=.25*T,this._y=(s+l)/T,this._z=(a+h)/T}else if(u>p){const T=2*Math.sqrt(1+u-r-p);this._w=(a-h)/T,this._x=(s+l)/T,this._y=.25*T,this._z=(d+f)/T}else{const T=2*Math.sqrt(1+p-r-u);this._w=(l-s)/T,this._x=(a+h)/T,this._y=(d+f)/T,this._z=.25*T}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let r=e.dot(n)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(pr(this.dot(e),-1,1)))}rotateTowards(e,n){const r=this.angleTo(e);if(r===0)return this;const s=Math.min(1,n/r);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const r=e._x,s=e._y,a=e._z,l=e._w,u=n._x,d=n._y,h=n._z,f=n._w;return this._x=r*f+l*u+s*h-a*d,this._y=s*f+l*d+a*u-r*h,this._z=a*f+l*h+r*d-s*u,this._w=l*f-r*u-s*d-a*h,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const r=this._x,s=this._y,a=this._z,l=this._w;let u=l*e._w+r*e._x+s*e._y+a*e._z;if(u<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,u=-u):this.copy(e),u>=1)return this._w=l,this._x=r,this._y=s,this._z=a,this;const d=1-u*u;if(d<=Number.EPSILON){const T=1-n;return this._w=T*l+n*this._w,this._x=T*r+n*this._x,this._y=T*s+n*this._y,this._z=T*a+n*this._z,this.normalize(),this._onChangeCallback(),this}const h=Math.sqrt(d),f=Math.atan2(h,u),p=Math.sin((1-n)*f)/h,m=Math.sin(n*f)/h;return this._w=l*p+this._w*m,this._x=r*p+this._x*m,this._y=s*p+this._y*m,this._z=a*p+this._z*m,this._onChangeCallback(),this}slerpQuaternions(e,n,r){return this.copy(e).slerp(n,r)}random(){const e=Math.random(),n=Math.sqrt(1-e),r=Math.sqrt(e),s=2*Math.PI*Math.random(),a=2*Math.PI*Math.random();return this.set(n*Math.cos(s),r*Math.sin(a),r*Math.cos(a),n*Math.sin(s))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class te{constructor(e=0,n=0,r=0){te.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}set(e,n,r){return r===void 0&&(r=this.z),this.x=e,this.y=n,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(IL.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(IL.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,r=this.y,s=this.z,a=e.elements;return this.x=a[0]*n+a[3]*r+a[6]*s,this.y=a[1]*n+a[4]*r+a[7]*s,this.z=a[2]*n+a[5]*r+a[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,r=this.y,s=this.z,a=e.elements,l=1/(a[3]*n+a[7]*r+a[11]*s+a[15]);return this.x=(a[0]*n+a[4]*r+a[8]*s+a[12])*l,this.y=(a[1]*n+a[5]*r+a[9]*s+a[13])*l,this.z=(a[2]*n+a[6]*r+a[10]*s+a[14])*l,this}applyQuaternion(e){const n=this.x,r=this.y,s=this.z,a=e.x,l=e.y,u=e.z,d=e.w,h=d*n+l*s-u*r,f=d*r+u*n-a*s,p=d*s+a*r-l*n,m=-a*n-l*r-u*s;return this.x=h*d+m*-a+f*-u-p*-l,this.y=f*d+m*-l+p*-a-h*-u,this.z=p*d+m*-u+h*-l-f*-a,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,r=this.y,s=this.z,a=e.elements;return this.x=a[0]*n+a[4]*r+a[8]*s,this.y=a[1]*n+a[5]*r+a[9]*s,this.z=a[2]*n+a[6]*r+a[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const r=e.x,s=e.y,a=e.z,l=n.x,u=n.y,d=n.z;return this.x=s*d-a*u,this.y=a*l-r*d,this.z=r*u-s*l,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const r=e.dot(this)/n;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return oC.copy(this).projectOnVector(e),this.sub(oC)}reflect(e){return this.sub(oC.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(pr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y,s=this.z-e.z;return n*n+r*r+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,r){const s=Math.sin(n)*e;return this.x=s*Math.sin(r),this.y=Math.cos(n)*e,this.z=s*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,r){return this.x=e*Math.sin(n),this.y=r,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=r,this.z=s,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,n=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(n),this.y=r*Math.sin(n),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const oC=new te,IL=new Er;class Xs{constructor(e=new te(1/0,1/0,1/0),n=new te(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n+=3)this.expandByPoint(hu.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,r=e.count;n<r;n++)this.expandByPoint(hu.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=hu.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){if(e.updateWorldMatrix(!1,!1),e.boundingBox!==void 0)e.boundingBox===null&&e.computeBoundingBox(),Pm.copy(e.boundingBox),Pm.applyMatrix4(e.matrixWorld),this.union(Pm);else{const s=e.geometry;if(s!==void 0)if(n&&s.attributes!==void 0&&s.attributes.position!==void 0){const a=s.attributes.position;for(let l=0,u=a.count;l<u;l++)hu.fromBufferAttribute(a,l).applyMatrix4(e.matrixWorld),this.expandByPoint(hu)}else s.boundingBox===null&&s.computeBoundingBox(),Pm.copy(s.boundingBox),Pm.applyMatrix4(e.matrixWorld),this.union(Pm)}const r=e.children;for(let s=0,a=r.length;s<a;s++)this.expandByObject(r[s],n);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,hu),hu.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,r;return e.normal.x>0?(n=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),n<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(kv),jy.subVectors(this.max,kv),Dm.subVectors(e.a,kv),Bm.subVectors(e.b,kv),Fm.subVectors(e.c,kv),Mh.subVectors(Bm,Dm),Ih.subVectors(Fm,Bm),$f.subVectors(Dm,Fm);let n=[0,-Mh.z,Mh.y,0,-Ih.z,Ih.y,0,-$f.z,$f.y,Mh.z,0,-Mh.x,Ih.z,0,-Ih.x,$f.z,0,-$f.x,-Mh.y,Mh.x,0,-Ih.y,Ih.x,0,-$f.y,$f.x,0];return!aC(n,Dm,Bm,Fm,jy)||(n=[1,0,0,0,1,0,0,0,1],!aC(n,Dm,Bm,Fm,jy))?!1:(Yy.crossVectors(Mh,Ih),n=[Yy.x,Yy.y,Yy.z],aC(n,Dm,Bm,Fm,jy))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,hu).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(hu).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(uu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),uu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),uu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),uu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),uu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),uu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),uu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),uu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(uu),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const uu=[new te,new te,new te,new te,new te,new te,new te,new te],hu=new te,Pm=new Xs,Dm=new te,Bm=new te,Fm=new te,Mh=new te,Ih=new te,$f=new te,kv=new te,jy=new te,Yy=new te,bf=new te;function aC(i,e,n,r,s){for(let a=0,l=i.length-3;a<=l;a+=3){bf.fromArray(i,a);const u=s.x*Math.abs(bf.x)+s.y*Math.abs(bf.y)+s.z*Math.abs(bf.z),d=e.dot(bf),h=n.dot(bf),f=r.dot(bf);if(Math.max(-Math.max(d,h,f),Math.min(d,h,f))>u)return!1}return!0}const y4=new Xs,Pv=new te,lC=new te;class js{constructor(e=new te,n=-1){this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const r=this.center;n!==void 0?r.copy(n):y4.setFromPoints(e).getCenter(r);let s=0;for(let a=0,l=e.length;a<l;a++)s=Math.max(s,r.distanceToSquared(e[a]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const r=this.center.distanceToSquared(e);return n.copy(e),r>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Pv.subVectors(e,this.center);const n=Pv.lengthSq();if(n>this.radius*this.radius){const r=Math.sqrt(n),s=(r-this.radius)*.5;this.center.addScaledVector(Pv,s/r),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(lC.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Pv.copy(e.center).add(lC)),this.expandByPoint(Pv.copy(e.center).sub(lC))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const du=new te,cC=new te,Ky=new te,Oh=new te,uC=new te,Jy=new te,hC=new te;class Ip{constructor(e=new te,n=new te(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,du)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const r=n.dot(this.direction);return r<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=du.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(du.copy(this.origin).addScaledVector(this.direction,n),du.distanceToSquared(e))}distanceSqToSegment(e,n,r,s){cC.copy(e).add(n).multiplyScalar(.5),Ky.copy(n).sub(e).normalize(),Oh.copy(this.origin).sub(cC);const a=e.distanceTo(n)*.5,l=-this.direction.dot(Ky),u=Oh.dot(this.direction),d=-Oh.dot(Ky),h=Oh.lengthSq(),f=Math.abs(1-l*l);let p,m,T,E;if(f>0)if(p=l*d-u,m=l*u-d,E=a*f,p>=0)if(m>=-E)if(m<=E){const b=1/f;p*=b,m*=b,T=p*(p+l*m+2*u)+m*(l*p+m+2*d)+h}else m=a,p=Math.max(0,-(l*m+u)),T=-p*p+m*(m+2*d)+h;else m=-a,p=Math.max(0,-(l*m+u)),T=-p*p+m*(m+2*d)+h;else m<=-E?(p=Math.max(0,-(-l*a+u)),m=p>0?-a:Math.min(Math.max(-a,-d),a),T=-p*p+m*(m+2*d)+h):m<=E?(p=0,m=Math.min(Math.max(-a,-d),a),T=m*(m+2*d)+h):(p=Math.max(0,-(l*a+u)),m=p>0?a:Math.min(Math.max(-a,-d),a),T=-p*p+m*(m+2*d)+h);else m=l>0?-a:a,p=Math.max(0,-(l*m+u)),T=-p*p+m*(m+2*d)+h;return r&&r.copy(this.origin).addScaledVector(this.direction,p),s&&s.copy(cC).addScaledVector(Ky,m),T}intersectSphere(e,n){du.subVectors(e.center,this.origin);const r=du.dot(this.direction),s=du.dot(du)-r*r,a=e.radius*e.radius;if(s>a)return null;const l=Math.sqrt(a-s),u=r-l,d=r+l;return d<0?null:u<0?this.at(d,n):this.at(u,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/n;return r>=0?r:null}intersectPlane(e,n){const r=this.distanceToPlane(e);return r===null?null:this.at(r,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let r,s,a,l,u,d;const h=1/this.direction.x,f=1/this.direction.y,p=1/this.direction.z,m=this.origin;return h>=0?(r=(e.min.x-m.x)*h,s=(e.max.x-m.x)*h):(r=(e.max.x-m.x)*h,s=(e.min.x-m.x)*h),f>=0?(a=(e.min.y-m.y)*f,l=(e.max.y-m.y)*f):(a=(e.max.y-m.y)*f,l=(e.min.y-m.y)*f),r>l||a>s||((a>r||isNaN(r))&&(r=a),(l<s||isNaN(s))&&(s=l),p>=0?(u=(e.min.z-m.z)*p,d=(e.max.z-m.z)*p):(u=(e.max.z-m.z)*p,d=(e.min.z-m.z)*p),r>d||u>s)||((u>r||r!==r)&&(r=u),(d<s||s!==s)&&(s=d),s<0)?null:this.at(r>=0?r:s,n)}intersectsBox(e){return this.intersectBox(e,du)!==null}intersectTriangle(e,n,r,s,a){uC.subVectors(n,e),Jy.subVectors(r,e),hC.crossVectors(uC,Jy);let l=this.direction.dot(hC),u;if(l>0){if(s)return null;u=1}else if(l<0)u=-1,l=-l;else return null;Oh.subVectors(this.origin,e);const d=u*this.direction.dot(Jy.crossVectors(Oh,Jy));if(d<0)return null;const h=u*this.direction.dot(uC.cross(Oh));if(h<0||d+h>l)return null;const f=-u*Oh.dot(hC);return f<0?null:this.at(f/l,a)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class pn{constructor(e,n,r,s,a,l,u,d,h,f,p,m,T,E,b,y){pn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,r,s,a,l,u,d,h,f,p,m,T,E,b,y)}set(e,n,r,s,a,l,u,d,h,f,p,m,T,E,b,y){const S=this.elements;return S[0]=e,S[4]=n,S[8]=r,S[12]=s,S[1]=a,S[5]=l,S[9]=u,S[13]=d,S[2]=h,S[6]=f,S[10]=p,S[14]=m,S[3]=T,S[7]=E,S[11]=b,S[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new pn().fromArray(this.elements)}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this}copyPosition(e){const n=this.elements,r=e.elements;return n[12]=r[12],n[13]=r[13],n[14]=r[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,r){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,n,r){return this.set(e.x,n.x,r.x,0,e.y,n.y,r.y,0,e.z,n.z,r.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,r=e.elements,s=1/Um.setFromMatrixColumn(e,0).length(),a=1/Um.setFromMatrixColumn(e,1).length(),l=1/Um.setFromMatrixColumn(e,2).length();return n[0]=r[0]*s,n[1]=r[1]*s,n[2]=r[2]*s,n[3]=0,n[4]=r[4]*a,n[5]=r[5]*a,n[6]=r[6]*a,n[7]=0,n[8]=r[8]*l,n[9]=r[9]*l,n[10]=r[10]*l,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,r=e.x,s=e.y,a=e.z,l=Math.cos(r),u=Math.sin(r),d=Math.cos(s),h=Math.sin(s),f=Math.cos(a),p=Math.sin(a);if(e.order==="XYZ"){const m=l*f,T=l*p,E=u*f,b=u*p;n[0]=d*f,n[4]=-d*p,n[8]=h,n[1]=T+E*h,n[5]=m-b*h,n[9]=-u*d,n[2]=b-m*h,n[6]=E+T*h,n[10]=l*d}else if(e.order==="YXZ"){const m=d*f,T=d*p,E=h*f,b=h*p;n[0]=m+b*u,n[4]=E*u-T,n[8]=l*h,n[1]=l*p,n[5]=l*f,n[9]=-u,n[2]=T*u-E,n[6]=b+m*u,n[10]=l*d}else if(e.order==="ZXY"){const m=d*f,T=d*p,E=h*f,b=h*p;n[0]=m-b*u,n[4]=-l*p,n[8]=E+T*u,n[1]=T+E*u,n[5]=l*f,n[9]=b-m*u,n[2]=-l*h,n[6]=u,n[10]=l*d}else if(e.order==="ZYX"){const m=l*f,T=l*p,E=u*f,b=u*p;n[0]=d*f,n[4]=E*h-T,n[8]=m*h+b,n[1]=d*p,n[5]=b*h+m,n[9]=T*h-E,n[2]=-h,n[6]=u*d,n[10]=l*d}else if(e.order==="YZX"){const m=l*d,T=l*h,E=u*d,b=u*h;n[0]=d*f,n[4]=b-m*p,n[8]=E*p+T,n[1]=p,n[5]=l*f,n[9]=-u*f,n[2]=-h*f,n[6]=T*p+E,n[10]=m-b*p}else if(e.order==="XZY"){const m=l*d,T=l*h,E=u*d,b=u*h;n[0]=d*f,n[4]=-p,n[8]=h*f,n[1]=m*p+b,n[5]=l*f,n[9]=T*p-E,n[2]=E*p-T,n[6]=u*f,n[10]=b*p+m}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(S4,e,$4)}lookAt(e,n,r){const s=this.elements;return na.subVectors(e,n),na.lengthSq()===0&&(na.z=1),na.normalize(),Lh.crossVectors(r,na),Lh.lengthSq()===0&&(Math.abs(r.z)===1?na.x+=1e-4:na.z+=1e-4,na.normalize(),Lh.crossVectors(r,na)),Lh.normalize(),Zy.crossVectors(na,Lh),s[0]=Lh.x,s[4]=Zy.x,s[8]=na.x,s[1]=Lh.y,s[5]=Zy.y,s[9]=na.y,s[2]=Lh.z,s[6]=Zy.z,s[10]=na.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,s=n.elements,a=this.elements,l=r[0],u=r[4],d=r[8],h=r[12],f=r[1],p=r[5],m=r[9],T=r[13],E=r[2],b=r[6],y=r[10],S=r[14],A=r[3],C=r[7],R=r[11],I=r[15],O=s[0],F=s[4],k=s[8],D=s[12],U=s[1],ce=s[5],ie=s[9],ae=s[13],ne=s[2],pe=s[6],de=s[10],xe=s[14],H=s[3],J=s[7],K=s[11],se=s[15];return a[0]=l*O+u*U+d*ne+h*H,a[4]=l*F+u*ce+d*pe+h*J,a[8]=l*k+u*ie+d*de+h*K,a[12]=l*D+u*ae+d*xe+h*se,a[1]=f*O+p*U+m*ne+T*H,a[5]=f*F+p*ce+m*pe+T*J,a[9]=f*k+p*ie+m*de+T*K,a[13]=f*D+p*ae+m*xe+T*se,a[2]=E*O+b*U+y*ne+S*H,a[6]=E*F+b*ce+y*pe+S*J,a[10]=E*k+b*ie+y*de+S*K,a[14]=E*D+b*ae+y*xe+S*se,a[3]=A*O+C*U+R*ne+I*H,a[7]=A*F+C*ce+R*pe+I*J,a[11]=A*k+C*ie+R*de+I*K,a[15]=A*D+C*ae+R*xe+I*se,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[4],s=e[8],a=e[12],l=e[1],u=e[5],d=e[9],h=e[13],f=e[2],p=e[6],m=e[10],T=e[14],E=e[3],b=e[7],y=e[11],S=e[15];return E*(+a*d*p-s*h*p-a*u*m+r*h*m+s*u*T-r*d*T)+b*(+n*d*T-n*h*m+a*l*m-s*l*T+s*h*f-a*d*f)+y*(+n*h*p-n*u*T-a*l*p+r*l*T+a*u*f-r*h*f)+S*(-s*u*f-n*d*p+n*u*m+s*l*p-r*l*m+r*d*f)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,r){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=n,s[14]=r),this}invert(){const e=this.elements,n=e[0],r=e[1],s=e[2],a=e[3],l=e[4],u=e[5],d=e[6],h=e[7],f=e[8],p=e[9],m=e[10],T=e[11],E=e[12],b=e[13],y=e[14],S=e[15],A=p*y*h-b*m*h+b*d*T-u*y*T-p*d*S+u*m*S,C=E*m*h-f*y*h-E*d*T+l*y*T+f*d*S-l*m*S,R=f*b*h-E*p*h+E*u*T-l*b*T-f*u*S+l*p*S,I=E*p*d-f*b*d-E*u*m+l*b*m+f*u*y-l*p*y,O=n*A+r*C+s*R+a*I;if(O===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const F=1/O;return e[0]=A*F,e[1]=(b*m*a-p*y*a-b*s*T+r*y*T+p*s*S-r*m*S)*F,e[2]=(u*y*a-b*d*a+b*s*h-r*y*h-u*s*S+r*d*S)*F,e[3]=(p*d*a-u*m*a-p*s*h+r*m*h+u*s*T-r*d*T)*F,e[4]=C*F,e[5]=(f*y*a-E*m*a+E*s*T-n*y*T-f*s*S+n*m*S)*F,e[6]=(E*d*a-l*y*a-E*s*h+n*y*h+l*s*S-n*d*S)*F,e[7]=(l*m*a-f*d*a+f*s*h-n*m*h-l*s*T+n*d*T)*F,e[8]=R*F,e[9]=(E*p*a-f*b*a-E*r*T+n*b*T+f*r*S-n*p*S)*F,e[10]=(l*b*a-E*u*a+E*r*h-n*b*h-l*r*S+n*u*S)*F,e[11]=(f*u*a-l*p*a-f*r*h+n*p*h+l*r*T-n*u*T)*F,e[12]=I*F,e[13]=(f*b*s-E*p*s+E*r*m-n*b*m-f*r*y+n*p*y)*F,e[14]=(E*u*s-l*b*s-E*r*d+n*b*d+l*r*y-n*u*y)*F,e[15]=(l*p*s-f*u*s+f*r*d-n*p*d-l*r*m+n*u*m)*F,this}scale(e){const n=this.elements,r=e.x,s=e.y,a=e.z;return n[0]*=r,n[4]*=s,n[8]*=a,n[1]*=r,n[5]*=s,n[9]*=a,n[2]*=r,n[6]*=s,n[10]*=a,n[3]*=r,n[7]*=s,n[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,r,s))}makeTranslation(e,n,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,r,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const r=Math.cos(n),s=Math.sin(n),a=1-r,l=e.x,u=e.y,d=e.z,h=a*l,f=a*u;return this.set(h*l+r,h*u-s*d,h*d+s*u,0,h*u+s*d,f*u+r,f*d-s*l,0,h*d-s*u,f*d+s*l,a*d*d+r,0,0,0,0,1),this}makeScale(e,n,r){return this.set(e,0,0,0,0,n,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,n,r,s,a,l){return this.set(1,r,a,0,e,1,l,0,n,s,1,0,0,0,0,1),this}compose(e,n,r){const s=this.elements,a=n._x,l=n._y,u=n._z,d=n._w,h=a+a,f=l+l,p=u+u,m=a*h,T=a*f,E=a*p,b=l*f,y=l*p,S=u*p,A=d*h,C=d*f,R=d*p,I=r.x,O=r.y,F=r.z;return s[0]=(1-(b+S))*I,s[1]=(T+R)*I,s[2]=(E-C)*I,s[3]=0,s[4]=(T-R)*O,s[5]=(1-(m+S))*O,s[6]=(y+A)*O,s[7]=0,s[8]=(E+C)*F,s[9]=(y-A)*F,s[10]=(1-(m+b))*F,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,n,r){const s=this.elements;let a=Um.set(s[0],s[1],s[2]).length();const l=Um.set(s[4],s[5],s[6]).length(),u=Um.set(s[8],s[9],s[10]).length();this.determinant()<0&&(a=-a),e.x=s[12],e.y=s[13],e.z=s[14],yl.copy(this);const h=1/a,f=1/l,p=1/u;return yl.elements[0]*=h,yl.elements[1]*=h,yl.elements[2]*=h,yl.elements[4]*=f,yl.elements[5]*=f,yl.elements[6]*=f,yl.elements[8]*=p,yl.elements[9]*=p,yl.elements[10]*=p,n.setFromRotationMatrix(yl),r.x=a,r.y=l,r.z=u,this}makePerspective(e,n,r,s,a,l,u=$c){const d=this.elements,h=2*a/(n-e),f=2*a/(r-s),p=(n+e)/(n-e),m=(r+s)/(r-s);let T,E;if(u===$c)T=-(l+a)/(l-a),E=-2*l*a/(l-a);else if(u===nE)T=-l/(l-a),E=-l*a/(l-a);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+u);return d[0]=h,d[4]=0,d[8]=p,d[12]=0,d[1]=0,d[5]=f,d[9]=m,d[13]=0,d[2]=0,d[6]=0,d[10]=T,d[14]=E,d[3]=0,d[7]=0,d[11]=-1,d[15]=0,this}makeOrthographic(e,n,r,s,a,l,u=$c){const d=this.elements,h=1/(n-e),f=1/(r-s),p=1/(l-a),m=(n+e)*h,T=(r+s)*f;let E,b;if(u===$c)E=(l+a)*p,b=-2*p;else if(u===nE)E=a*p,b=-1*p;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+u);return d[0]=2*h,d[4]=0,d[8]=0,d[12]=-m,d[1]=0,d[5]=2*f,d[9]=0,d[13]=-T,d[2]=0,d[6]=0,d[10]=b,d[14]=-E,d[3]=0,d[7]=0,d[11]=0,d[15]=1,this}equals(e){const n=this.elements,r=e.elements;for(let s=0;s<16;s++)if(n[s]!==r[s])return!1;return!0}fromArray(e,n=0){for(let r=0;r<16;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e[n+9]=r[9],e[n+10]=r[10],e[n+11]=r[11],e[n+12]=r[12],e[n+13]=r[13],e[n+14]=r[14],e[n+15]=r[15],e}}const Um=new te,yl=new pn,S4=new te(0,0,0),$4=new te(1,1,1),Lh=new te,Zy=new te,na=new te,OL=new pn,LL=new Er;class EE{constructor(e=0,n=0,r=0,s=EE.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,r,s=this._order){return this._x=e,this._y=n,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,r=!0){const s=e.elements,a=s[0],l=s[4],u=s[8],d=s[1],h=s[5],f=s[9],p=s[2],m=s[6],T=s[10];switch(n){case"XYZ":this._y=Math.asin(pr(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-f,T),this._z=Math.atan2(-l,a)):(this._x=Math.atan2(m,h),this._z=0);break;case"YXZ":this._x=Math.asin(-pr(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(u,T),this._z=Math.atan2(d,h)):(this._y=Math.atan2(-p,a),this._z=0);break;case"ZXY":this._x=Math.asin(pr(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-p,T),this._z=Math.atan2(-l,h)):(this._y=0,this._z=Math.atan2(d,a));break;case"ZYX":this._y=Math.asin(-pr(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(m,T),this._z=Math.atan2(d,a)):(this._x=0,this._z=Math.atan2(-l,h));break;case"YZX":this._z=Math.asin(pr(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(-f,h),this._y=Math.atan2(-p,a)):(this._x=0,this._y=Math.atan2(u,T));break;case"XZY":this._z=Math.asin(-pr(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(m,h),this._y=Math.atan2(u,a)):(this._x=Math.atan2(-f,T),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,r){return OL.makeRotationFromQuaternion(e),this.setFromRotationMatrix(OL,n,r)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return LL.setFromEuler(this),this.setFromQuaternion(LL,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}EE.DEFAULT_ORDER="XYZ";class op{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let b4=0;const NL=new te,Gm=new Er,fu=new pn,qy=new te,Dv=new te,A4=new te,C4=new Er,kL=new te(1,0,0),PL=new te(0,1,0),DL=new te(0,0,1),x4={type:"added"},BL={type:"removed"};class Xn extends Mc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:b4++}),this.uuid=ca(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Xn.DEFAULT_UP.clone();const e=new te,n=new EE,r=new Er,s=new te(1,1,1);function a(){r.setFromEuler(n,!1)}function l(){n.setFromQuaternion(r,void 0,!1)}n._onChange(a),r._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new pn},normalMatrix:{value:new Ln}}),this.matrix=new pn,this.matrixWorld=new pn,this.matrixAutoUpdate=Xn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Xn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new op,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return Gm.setFromAxisAngle(e,n),this.quaternion.multiply(Gm),this}rotateOnWorldAxis(e,n){return Gm.setFromAxisAngle(e,n),this.quaternion.premultiply(Gm),this}rotateX(e){return this.rotateOnAxis(kL,e)}rotateY(e){return this.rotateOnAxis(PL,e)}rotateZ(e){return this.rotateOnAxis(DL,e)}translateOnAxis(e,n){return NL.copy(e).applyQuaternion(this.quaternion),this.position.add(NL.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(kL,e)}translateY(e){return this.translateOnAxis(PL,e)}translateZ(e){return this.translateOnAxis(DL,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(fu.copy(this.matrixWorld).invert())}lookAt(e,n,r){e.isVector3?qy.copy(e):qy.set(e,n,r);const s=this.parent;this.updateWorldMatrix(!0,!1),Dv.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?fu.lookAt(Dv,qy,this.up):fu.lookAt(qy,Dv,this.up),this.quaternion.setFromRotationMatrix(fu),s&&(fu.extractRotation(s.matrixWorld),Gm.setFromRotationMatrix(fu),this.quaternion.premultiply(Gm.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(x4)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(BL)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const n=this.children[e];n.parent=null,n.dispatchEvent(BL)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),fu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),fu.multiply(e.parent.matrixWorld)),e.applyMatrix4(fu),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let r=0,s=this.children.length;r<s;r++){const l=this.children[r].getObjectByProperty(e,n);if(l!==void 0)return l}}getObjectsByProperty(e,n){let r=[];this[e]===n&&r.push(this);for(let s=0,a=this.children.length;s<a;s++){const l=this.children[s].getObjectsByProperty(e,n);l.length>0&&(r=r.concat(l))}return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Dv,e,A4),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Dv,C4,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let r=0,s=n.length;r<s;r++)n[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let r=0,s=n.length;r<s;r++)n[r].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let r=0,s=n.length;r<s;r++){const a=n[r];(a.matrixWorldAutoUpdate===!0||e===!0)&&a.updateMatrixWorld(e)}}updateWorldMatrix(e,n){const r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),n===!0){const s=this.children;for(let a=0,l=s.length;a<l;a++){const u=s[a];u.matrixWorldAutoUpdate===!0&&u.updateWorldMatrix(!1,!0)}}}toJSON(e){const n=e===void 0||typeof e=="string",r={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON()));function a(u,d){return u[d.uuid]===void 0&&(u[d.uuid]=d.toJSON(e)),d.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=a(e.geometries,this.geometry);const u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){const d=u.shapes;if(Array.isArray(d))for(let h=0,f=d.length;h<f;h++){const p=d[h];a(e.shapes,p)}else a(e.shapes,d)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const u=[];for(let d=0,h=this.material.length;d<h;d++)u.push(a(e.materials,this.material[d]));s.material=u}else s.material=a(e.materials,this.material);if(this.children.length>0){s.children=[];for(let u=0;u<this.children.length;u++)s.children.push(this.children[u].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let u=0;u<this.animations.length;u++){const d=this.animations[u];s.animations.push(a(e.animations,d))}}if(n){const u=l(e.geometries),d=l(e.materials),h=l(e.textures),f=l(e.images),p=l(e.shapes),m=l(e.skeletons),T=l(e.animations),E=l(e.nodes);u.length>0&&(r.geometries=u),d.length>0&&(r.materials=d),h.length>0&&(r.textures=h),f.length>0&&(r.images=f),p.length>0&&(r.shapes=p),m.length>0&&(r.skeletons=m),T.length>0&&(r.animations=T),E.length>0&&(r.nodes=E)}return r.object=s,r;function l(u){const d=[];for(const h in u){const f=u[h];delete f.metadata,d.push(f)}return d}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations,this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let r=0;r<e.children.length;r++){const s=e.children[r];this.add(s.clone())}return this}}Xn.DEFAULT_UP=new te(0,1,0);Xn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Xn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Sl=new te,pu=new te,dC=new te,mu=new te,Hm=new te,Vm=new te,FL=new te,fC=new te,pC=new te,mC=new te;let Qy=!1;class Co{constructor(e=new te,n=new te,r=new te){this.a=e,this.b=n,this.c=r}static getNormal(e,n,r,s){s.subVectors(r,n),Sl.subVectors(e,n),s.cross(Sl);const a=s.lengthSq();return a>0?s.multiplyScalar(1/Math.sqrt(a)):s.set(0,0,0)}static getBarycoord(e,n,r,s,a){Sl.subVectors(s,n),pu.subVectors(r,n),dC.subVectors(e,n);const l=Sl.dot(Sl),u=Sl.dot(pu),d=Sl.dot(dC),h=pu.dot(pu),f=pu.dot(dC),p=l*h-u*u;if(p===0)return a.set(-2,-1,-1);const m=1/p,T=(h*d-u*f)*m,E=(l*f-u*d)*m;return a.set(1-T-E,E,T)}static containsPoint(e,n,r,s){return this.getBarycoord(e,n,r,s,mu),mu.x>=0&&mu.y>=0&&mu.x+mu.y<=1}static getUV(e,n,r,s,a,l,u,d){return Qy===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Qy=!0),this.getInterpolation(e,n,r,s,a,l,u,d)}static getInterpolation(e,n,r,s,a,l,u,d){return this.getBarycoord(e,n,r,s,mu),d.setScalar(0),d.addScaledVector(a,mu.x),d.addScaledVector(l,mu.y),d.addScaledVector(u,mu.z),d}static isFrontFacing(e,n,r,s){return Sl.subVectors(r,n),pu.subVectors(e,n),Sl.cross(pu).dot(s)<0}set(e,n,r){return this.a.copy(e),this.b.copy(n),this.c.copy(r),this}setFromPointsAndIndices(e,n,r,s){return this.a.copy(e[n]),this.b.copy(e[r]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,n,r,s){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Sl.subVectors(this.c,this.b),pu.subVectors(this.a,this.b),Sl.cross(pu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Co.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return Co.getBarycoord(e,this.a,this.b,this.c,n)}getUV(e,n,r,s,a){return Qy===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Qy=!0),Co.getInterpolation(e,this.a,this.b,this.c,n,r,s,a)}getInterpolation(e,n,r,s,a){return Co.getInterpolation(e,this.a,this.b,this.c,n,r,s,a)}containsPoint(e){return Co.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Co.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const r=this.a,s=this.b,a=this.c;let l,u;Hm.subVectors(s,r),Vm.subVectors(a,r),fC.subVectors(e,r);const d=Hm.dot(fC),h=Vm.dot(fC);if(d<=0&&h<=0)return n.copy(r);pC.subVectors(e,s);const f=Hm.dot(pC),p=Vm.dot(pC);if(f>=0&&p<=f)return n.copy(s);const m=d*p-f*h;if(m<=0&&d>=0&&f<=0)return l=d/(d-f),n.copy(r).addScaledVector(Hm,l);mC.subVectors(e,a);const T=Hm.dot(mC),E=Vm.dot(mC);if(E>=0&&T<=E)return n.copy(a);const b=T*h-d*E;if(b<=0&&h>=0&&E<=0)return u=h/(h-E),n.copy(r).addScaledVector(Vm,u);const y=f*E-T*p;if(y<=0&&p-f>=0&&T-E>=0)return FL.subVectors(a,s),u=(p-f)/(p-f+(T-E)),n.copy(s).addScaledVector(FL,u);const S=1/(y+b+m);return l=b*S,u=m*S,n.copy(r).addScaledVector(Hm,l).addScaledVector(Vm,u)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let R4=0;class rr extends Mc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:R4++}),this.uuid=ca(),this.name="",this.type="Material",this.blending=np,this.side=Ya,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=nM,this.blendDst=iM,this.blendEquation=Uf,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=zS,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=fF,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=mS,this.stencilZFail=mS,this.stencilZPass=mS,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const r=e[n];if(r===void 0){console.warn(`THREE.Material: parameter '${n}' has value of undefined.`);continue}const s=this[n];if(s===void 0){console.warn(`THREE.Material: '${n}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(r):s&&s.isVector3&&r&&r.isVector3?s.copy(r):this[n]=r}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==np&&(r.blending=this.blending),this.side!==Ya&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(r.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(r.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=this.flatShading),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function s(a){const l=[];for(const u in a){const d=a[u];delete d.metadata,l.push(d)}return l}if(n){const a=s(e.textures),l=s(e.images);a.length>0&&(r.textures=a),l.length>0&&(r.images=l)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let r=null;if(n!==null){const s=n.length;r=new Array(s);for(let a=0;a!==s;++a)r[a]=n[a].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}const bF={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},$l={h:0,s:0,l:0},e0={h:0,s:0,l:0};function gC(i,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?i+(e-i)*6*n:n<1/2?e:n<2/3?i+(e-i)*6*(2/3-n):i}class Ct{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=Tn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Pa.toWorkingColorSpace(this,n),this}setRGB(e,n,r,s=Pa.workingColorSpace){return this.r=e,this.g=n,this.b=r,Pa.toWorkingColorSpace(this,s),this}setHSL(e,n,r,s=Pa.workingColorSpace){if(e=_M(e,1),n=pr(n,0,1),r=pr(r,0,1),n===0)this.r=this.g=this.b=r;else{const a=r<=.5?r*(1+n):r+n-r*n,l=2*r-a;this.r=gC(l,a,e+1/3),this.g=gC(l,a,e),this.b=gC(l,a,e-1/3)}return Pa.toWorkingColorSpace(this,s),this}setStyle(e,n=Tn){function r(a){a!==void 0&&parseFloat(a)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let a;const l=s[1],u=s[2];switch(l){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return r(a[4]),this.setRGB(Math.min(255,parseInt(a[1],10))/255,Math.min(255,parseInt(a[2],10))/255,Math.min(255,parseInt(a[3],10))/255,n);if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return r(a[4]),this.setRGB(Math.min(100,parseInt(a[1],10))/100,Math.min(100,parseInt(a[2],10))/100,Math.min(100,parseInt(a[3],10))/100,n);break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return r(a[4]),this.setHSL(parseFloat(a[1])/360,parseFloat(a[2])/100,parseFloat(a[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const a=s[1],l=a.length;if(l===3)return this.setRGB(parseInt(a.charAt(0),16)/15,parseInt(a.charAt(1),16)/15,parseInt(a.charAt(2),16)/15,n);if(l===6)return this.setHex(parseInt(a,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=Tn){const r=bF[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Og(e.r),this.g=Og(e.g),this.b=Og(e.b),this}copyLinearToSRGB(e){return this.r=rC(e.r),this.g=rC(e.g),this.b=rC(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Tn){return Pa.fromWorkingColorSpace(Gs.copy(this),e),Math.round(pr(Gs.r*255,0,255))*65536+Math.round(pr(Gs.g*255,0,255))*256+Math.round(pr(Gs.b*255,0,255))}getHexString(e=Tn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=Pa.workingColorSpace){Pa.fromWorkingColorSpace(Gs.copy(this),n);const r=Gs.r,s=Gs.g,a=Gs.b,l=Math.max(r,s,a),u=Math.min(r,s,a);let d,h;const f=(u+l)/2;if(u===l)d=0,h=0;else{const p=l-u;switch(h=f<=.5?p/(l+u):p/(2-l-u),l){case r:d=(s-a)/p+(s<a?6:0);break;case s:d=(a-r)/p+2;break;case a:d=(r-s)/p+4;break}d/=6}return e.h=d,e.s=h,e.l=f,e}getRGB(e,n=Pa.workingColorSpace){return Pa.fromWorkingColorSpace(Gs.copy(this),n),e.r=Gs.r,e.g=Gs.g,e.b=Gs.b,e}getStyle(e=Tn){Pa.fromWorkingColorSpace(Gs.copy(this),e);const n=Gs.r,r=Gs.g,s=Gs.b;return e!==Tn?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(s*255)})`}offsetHSL(e,n,r){return this.getHSL($l),$l.h+=e,$l.s+=n,$l.l+=r,this.setHSL($l.h,$l.s,$l.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL($l),e.getHSL(e0);const r=xT($l.h,e0.h,n),s=xT($l.s,e0.s,n),a=xT($l.l,e0.l,n);return this.setHSL(r,s,a),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,s=this.b,a=e.elements;return this.r=a[0]*n+a[3]*r+a[6]*s,this.g=a[1]*n+a[4]*r+a[7]*s,this.b=a[2]*n+a[5]*r+a[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Gs=new Ct;Ct.NAMES=bF;class ii extends rr{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ct(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=_E,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const yu=w4();function w4(){const i=new ArrayBuffer(4),e=new Float32Array(i),n=new Uint32Array(i),r=new Uint32Array(512),s=new Uint32Array(512);for(let d=0;d<256;++d){const h=d-127;h<-27?(r[d]=0,r[d|256]=32768,s[d]=24,s[d|256]=24):h<-14?(r[d]=1024>>-h-14,r[d|256]=1024>>-h-14|32768,s[d]=-h-1,s[d|256]=-h-1):h<=15?(r[d]=h+15<<10,r[d|256]=h+15<<10|32768,s[d]=13,s[d|256]=13):h<128?(r[d]=31744,r[d|256]=64512,s[d]=24,s[d|256]=24):(r[d]=31744,r[d|256]=64512,s[d]=13,s[d|256]=13)}const a=new Uint32Array(2048),l=new Uint32Array(64),u=new Uint32Array(64);for(let d=1;d<1024;++d){let h=d<<13,f=0;for(;!(h&8388608);)h<<=1,f-=8388608;h&=-8388609,f+=947912704,a[d]=h|f}for(let d=1024;d<2048;++d)a[d]=939524096+(d-1024<<13);for(let d=1;d<31;++d)l[d]=d<<23;l[31]=1199570944,l[32]=2147483648;for(let d=33;d<63;++d)l[d]=2147483648+(d-32<<23);l[63]=3347054592;for(let d=1;d<64;++d)d!==32&&(u[d]=1024);return{floatView:e,uint32View:n,baseTable:r,shiftTable:s,mantissaTable:a,exponentTable:l,offsetTable:u}}function bo(i){Math.abs(i)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),i=pr(i,-65504,65504),yu.floatView[0]=i;const e=yu.uint32View[0],n=e>>23&511;return yu.baseTable[n]+((e&8388607)>>yu.shiftTable[n])}function mT(i){const e=i>>10;return yu.uint32View[0]=yu.mantissaTable[yu.offsetTable[e]+(i&1023)]+yu.exponentTable[e],yu.floatView[0]}const Kf={toHalfFloat:bo,fromHalfFloat:mT},Ir=new te,t0=new mt;class Qn{constructor(e,n,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=r,this.usage=tE,this.updateRange={offset:0,count:-1},this.gpuType=Kr,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,r){e*=this.itemSize,r*=n.itemSize;for(let s=0,a=this.itemSize;s<a;s++)this.array[e+s]=n.array[r+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,r=this.count;n<r;n++)t0.fromBufferAttribute(this,n),t0.applyMatrix3(e),this.setXY(n,t0.x,t0.y);else if(this.itemSize===3)for(let n=0,r=this.count;n<r;n++)Ir.fromBufferAttribute(this,n),Ir.applyMatrix3(e),this.setXYZ(n,Ir.x,Ir.y,Ir.z);return this}applyMatrix4(e){for(let n=0,r=this.count;n<r;n++)Ir.fromBufferAttribute(this,n),Ir.applyMatrix4(e),this.setXYZ(n,Ir.x,Ir.y,Ir.z);return this}applyNormalMatrix(e){for(let n=0,r=this.count;n<r;n++)Ir.fromBufferAttribute(this,n),Ir.applyNormalMatrix(e),this.setXYZ(n,Ir.x,Ir.y,Ir.z);return this}transformDirection(e){for(let n=0,r=this.count;n<r;n++)Ir.fromBufferAttribute(this,n),Ir.transformDirection(e),this.setXYZ(n,Ir.x,Ir.y,Ir.z);return this}set(e,n=0){return this.array.set(e,n),this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=oa(n,this.array)),n}setX(e,n){return this.normalized&&(n=kn(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=oa(n,this.array)),n}setY(e,n){return this.normalized&&(n=kn(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=oa(n,this.array)),n}setZ(e,n){return this.normalized&&(n=kn(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=oa(n,this.array)),n}setW(e,n){return this.normalized&&(n=kn(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,r){return e*=this.itemSize,this.normalized&&(n=kn(n,this.array),r=kn(r,this.array)),this.array[e+0]=n,this.array[e+1]=r,this}setXYZ(e,n,r,s){return e*=this.itemSize,this.normalized&&(n=kn(n,this.array),r=kn(r,this.array),s=kn(s,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=s,this}setXYZW(e,n,r,s,a){return e*=this.itemSize,this.normalized&&(n=kn(n,this.array),r=kn(r,this.array),s=kn(s,this.array),a=kn(a,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=s,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==tE&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class M4 extends Qn{constructor(e,n,r){super(new Int8Array(e),n,r)}}class I4 extends Qn{constructor(e,n,r){super(new Uint8Array(e),n,r)}}class O4 extends Qn{constructor(e,n,r){super(new Uint8ClampedArray(e),n,r)}}class L4 extends Qn{constructor(e,n,r){super(new Int16Array(e),n,r)}}class EM extends Qn{constructor(e,n,r){super(new Uint16Array(e),n,r)}}class N4 extends Qn{constructor(e,n,r){super(new Int32Array(e),n,r)}}class yM extends Qn{constructor(e,n,r){super(new Uint32Array(e),n,r)}}class k4 extends Qn{constructor(e,n,r){super(new Uint16Array(e),n,r),this.isFloat16BufferAttribute=!0}getX(e){let n=mT(this.array[e*this.itemSize]);return this.normalized&&(n=oa(n,this.array)),n}setX(e,n){return this.normalized&&(n=kn(n,this.array)),this.array[e*this.itemSize]=bo(n),this}getY(e){let n=mT(this.array[e*this.itemSize+1]);return this.normalized&&(n=oa(n,this.array)),n}setY(e,n){return this.normalized&&(n=kn(n,this.array)),this.array[e*this.itemSize+1]=bo(n),this}getZ(e){let n=mT(this.array[e*this.itemSize+2]);return this.normalized&&(n=oa(n,this.array)),n}setZ(e,n){return this.normalized&&(n=kn(n,this.array)),this.array[e*this.itemSize+2]=bo(n),this}getW(e){let n=mT(this.array[e*this.itemSize+3]);return this.normalized&&(n=oa(n,this.array)),n}setW(e,n){return this.normalized&&(n=kn(n,this.array)),this.array[e*this.itemSize+3]=bo(n),this}setXY(e,n,r){return e*=this.itemSize,this.normalized&&(n=kn(n,this.array),r=kn(r,this.array)),this.array[e+0]=bo(n),this.array[e+1]=bo(r),this}setXYZ(e,n,r,s){return e*=this.itemSize,this.normalized&&(n=kn(n,this.array),r=kn(r,this.array),s=kn(s,this.array)),this.array[e+0]=bo(n),this.array[e+1]=bo(r),this.array[e+2]=bo(s),this}setXYZW(e,n,r,s,a){return e*=this.itemSize,this.normalized&&(n=kn(n,this.array),r=kn(r,this.array),s=kn(s,this.array),a=kn(a,this.array)),this.array[e+0]=bo(n),this.array[e+1]=bo(r),this.array[e+2]=bo(s),this.array[e+3]=bo(a),this}}class Yt extends Qn{constructor(e,n,r){super(new Float32Array(e),n,r)}}class P4 extends Qn{constructor(e,n,r){super(new Float64Array(e),n,r)}}let D4=0;const ka=new pn,_C=new Xn,zm=new te,ia=new Xs,Bv=new Xs,is=new te;class rn extends Mc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:D4++}),this.uuid=ca(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new($F(e)?yM:EM)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,r=0){this.groups.push({start:e,count:n,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const a=new Ln().getNormalMatrix(e);r.applyNormalMatrix(a),r.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ka.makeRotationFromQuaternion(e),this.applyMatrix4(ka),this}rotateX(e){return ka.makeRotationX(e),this.applyMatrix4(ka),this}rotateY(e){return ka.makeRotationY(e),this.applyMatrix4(ka),this}rotateZ(e){return ka.makeRotationZ(e),this.applyMatrix4(ka),this}translate(e,n,r){return ka.makeTranslation(e,n,r),this.applyMatrix4(ka),this}scale(e,n,r){return ka.makeScale(e,n,r),this.applyMatrix4(ka),this}lookAt(e){return _C.lookAt(e),_C.updateMatrix(),this.applyMatrix4(_C.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(zm).negate(),this.translate(zm.x,zm.y,zm.z),this}setFromPoints(e){const n=[];for(let r=0,s=e.length;r<s;r++){const a=e[r];n.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new Yt(n,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Xs);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new te(-1/0,-1/0,-1/0),new te(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let r=0,s=n.length;r<s;r++){const a=n[r];ia.setFromBufferAttribute(a),this.morphTargetsRelative?(is.addVectors(this.boundingBox.min,ia.min),this.boundingBox.expandByPoint(is),is.addVectors(this.boundingBox.max,ia.max),this.boundingBox.expandByPoint(is)):(this.boundingBox.expandByPoint(ia.min),this.boundingBox.expandByPoint(ia.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new js);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new te,1/0);return}if(e){const r=this.boundingSphere.center;if(ia.setFromBufferAttribute(e),n)for(let a=0,l=n.length;a<l;a++){const u=n[a];Bv.setFromBufferAttribute(u),this.morphTargetsRelative?(is.addVectors(ia.min,Bv.min),ia.expandByPoint(is),is.addVectors(ia.max,Bv.max),ia.expandByPoint(is)):(ia.expandByPoint(Bv.min),ia.expandByPoint(Bv.max))}ia.getCenter(r);let s=0;for(let a=0,l=e.count;a<l;a++)is.fromBufferAttribute(e,a),s=Math.max(s,r.distanceToSquared(is));if(n)for(let a=0,l=n.length;a<l;a++){const u=n[a],d=this.morphTargetsRelative;for(let h=0,f=u.count;h<f;h++)is.fromBufferAttribute(u,h),d&&(zm.fromBufferAttribute(e,h),is.add(zm)),s=Math.max(s,r.distanceToSquared(is))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=e.array,s=n.position.array,a=n.normal.array,l=n.uv.array,u=s.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Qn(new Float32Array(4*u),4));const d=this.getAttribute("tangent").array,h=[],f=[];for(let U=0;U<u;U++)h[U]=new te,f[U]=new te;const p=new te,m=new te,T=new te,E=new mt,b=new mt,y=new mt,S=new te,A=new te;function C(U,ce,ie){p.fromArray(s,U*3),m.fromArray(s,ce*3),T.fromArray(s,ie*3),E.fromArray(l,U*2),b.fromArray(l,ce*2),y.fromArray(l,ie*2),m.sub(p),T.sub(p),b.sub(E),y.sub(E);const ae=1/(b.x*y.y-y.x*b.y);isFinite(ae)&&(S.copy(m).multiplyScalar(y.y).addScaledVector(T,-b.y).multiplyScalar(ae),A.copy(T).multiplyScalar(b.x).addScaledVector(m,-y.x).multiplyScalar(ae),h[U].add(S),h[ce].add(S),h[ie].add(S),f[U].add(A),f[ce].add(A),f[ie].add(A))}let R=this.groups;R.length===0&&(R=[{start:0,count:r.length}]);for(let U=0,ce=R.length;U<ce;++U){const ie=R[U],ae=ie.start,ne=ie.count;for(let pe=ae,de=ae+ne;pe<de;pe+=3)C(r[pe+0],r[pe+1],r[pe+2])}const I=new te,O=new te,F=new te,k=new te;function D(U){F.fromArray(a,U*3),k.copy(F);const ce=h[U];I.copy(ce),I.sub(F.multiplyScalar(F.dot(ce))).normalize(),O.crossVectors(k,ce);const ae=O.dot(f[U])<0?-1:1;d[U*4]=I.x,d[U*4+1]=I.y,d[U*4+2]=I.z,d[U*4+3]=ae}for(let U=0,ce=R.length;U<ce;++U){const ie=R[U],ae=ie.start,ne=ie.count;for(let pe=ae,de=ae+ne;pe<de;pe+=3)D(r[pe+0]),D(r[pe+1]),D(r[pe+2])}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Qn(new Float32Array(n.count*3),3),this.setAttribute("normal",r);else for(let m=0,T=r.count;m<T;m++)r.setXYZ(m,0,0,0);const s=new te,a=new te,l=new te,u=new te,d=new te,h=new te,f=new te,p=new te;if(e)for(let m=0,T=e.count;m<T;m+=3){const E=e.getX(m+0),b=e.getX(m+1),y=e.getX(m+2);s.fromBufferAttribute(n,E),a.fromBufferAttribute(n,b),l.fromBufferAttribute(n,y),f.subVectors(l,a),p.subVectors(s,a),f.cross(p),u.fromBufferAttribute(r,E),d.fromBufferAttribute(r,b),h.fromBufferAttribute(r,y),u.add(f),d.add(f),h.add(f),r.setXYZ(E,u.x,u.y,u.z),r.setXYZ(b,d.x,d.y,d.z),r.setXYZ(y,h.x,h.y,h.z)}else for(let m=0,T=n.count;m<T;m+=3)s.fromBufferAttribute(n,m+0),a.fromBufferAttribute(n,m+1),l.fromBufferAttribute(n,m+2),f.subVectors(l,a),p.subVectors(s,a),f.cross(p),r.setXYZ(m+0,f.x,f.y,f.z),r.setXYZ(m+1,f.x,f.y,f.z),r.setXYZ(m+2,f.x,f.y,f.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let n=0,r=e.count;n<r;n++)is.fromBufferAttribute(e,n),is.normalize(),e.setXYZ(n,is.x,is.y,is.z)}toNonIndexed(){function e(u,d){const h=u.array,f=u.itemSize,p=u.normalized,m=new h.constructor(d.length*f);let T=0,E=0;for(let b=0,y=d.length;b<y;b++){u.isInterleavedBufferAttribute?T=d[b]*u.data.stride+u.offset:T=d[b]*f;for(let S=0;S<f;S++)m[E++]=h[T++]}return new Qn(m,f,p)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new rn,r=this.index.array,s=this.attributes;for(const u in s){const d=s[u],h=e(d,r);n.setAttribute(u,h)}const a=this.morphAttributes;for(const u in a){const d=[],h=a[u];for(let f=0,p=h.length;f<p;f++){const m=h[f],T=e(m,r);d.push(T)}n.morphAttributes[u]=d}n.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let u=0,d=l.length;u<d;u++){const h=l[u];n.addGroup(h.start,h.count,h.materialIndex)}return n}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const d=this.parameters;for(const h in d)d[h]!==void 0&&(e[h]=d[h]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const r=this.attributes;for(const d in r){const h=r[d];e.data.attributes[d]=h.toJSON(e.data)}const s={};let a=!1;for(const d in this.morphAttributes){const h=this.morphAttributes[d],f=[];for(let p=0,m=h.length;p<m;p++){const T=h[p];f.push(T.toJSON(e.data))}f.length>0&&(s[d]=f,a=!0)}a&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const u=this.boundingSphere;return u!==null&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(n));const s=e.attributes;for(const h in s){const f=s[h];this.setAttribute(h,f.clone(n))}const a=e.morphAttributes;for(const h in a){const f=[],p=a[h];for(let m=0,T=p.length;m<T;m++)f.push(p[m].clone(n));this.morphAttributes[h]=f}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let h=0,f=l.length;h<f;h++){const p=l[h];this.addGroup(p.start,p.count,p.materialIndex)}const u=e.boundingBox;u!==null&&(this.boundingBox=u.clone());const d=e.boundingSphere;return d!==null&&(this.boundingSphere=d.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const UL=new pn,Af=new Ip,n0=new js,GL=new te,Wm=new te,Xm=new te,jm=new te,vC=new te,i0=new te,r0=new mt,s0=new mt,o0=new mt,HL=new te,VL=new te,zL=new te,a0=new te,l0=new te;class Pn extends Xn{constructor(e=new rn,n=new ii){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const s=n[r[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,l=s.length;a<l;a++){const u=s[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=a}}}}getVertexPosition(e,n){const r=this.geometry,s=r.attributes.position,a=r.morphAttributes.position,l=r.morphTargetsRelative;n.fromBufferAttribute(s,e);const u=this.morphTargetInfluences;if(a&&u){i0.set(0,0,0);for(let d=0,h=a.length;d<h;d++){const f=u[d],p=a[d];f!==0&&(vC.fromBufferAttribute(p,e),l?i0.addScaledVector(vC,f):i0.addScaledVector(vC.sub(n),f))}n.add(i0)}return n}raycast(e,n){const r=this.geometry,s=this.material,a=this.matrixWorld;s!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),n0.copy(r.boundingSphere),n0.applyMatrix4(a),Af.copy(e.ray).recast(e.near),!(n0.containsPoint(Af.origin)===!1&&(Af.intersectSphere(n0,GL)===null||Af.origin.distanceToSquared(GL)>(e.far-e.near)**2))&&(UL.copy(a).invert(),Af.copy(e.ray).applyMatrix4(UL),!(r.boundingBox!==null&&Af.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,n,Af)))}_computeIntersections(e,n,r){let s;const a=this.geometry,l=this.material,u=a.index,d=a.attributes.position,h=a.attributes.uv,f=a.attributes.uv1,p=a.attributes.normal,m=a.groups,T=a.drawRange;if(u!==null)if(Array.isArray(l))for(let E=0,b=m.length;E<b;E++){const y=m[E],S=l[y.materialIndex],A=Math.max(y.start,T.start),C=Math.min(u.count,Math.min(y.start+y.count,T.start+T.count));for(let R=A,I=C;R<I;R+=3){const O=u.getX(R),F=u.getX(R+1),k=u.getX(R+2);s=c0(this,S,e,r,h,f,p,O,F,k),s&&(s.faceIndex=Math.floor(R/3),s.face.materialIndex=y.materialIndex,n.push(s))}}else{const E=Math.max(0,T.start),b=Math.min(u.count,T.start+T.count);for(let y=E,S=b;y<S;y+=3){const A=u.getX(y),C=u.getX(y+1),R=u.getX(y+2);s=c0(this,l,e,r,h,f,p,A,C,R),s&&(s.faceIndex=Math.floor(y/3),n.push(s))}}else if(d!==void 0)if(Array.isArray(l))for(let E=0,b=m.length;E<b;E++){const y=m[E],S=l[y.materialIndex],A=Math.max(y.start,T.start),C=Math.min(d.count,Math.min(y.start+y.count,T.start+T.count));for(let R=A,I=C;R<I;R+=3){const O=R,F=R+1,k=R+2;s=c0(this,S,e,r,h,f,p,O,F,k),s&&(s.faceIndex=Math.floor(R/3),s.face.materialIndex=y.materialIndex,n.push(s))}}else{const E=Math.max(0,T.start),b=Math.min(d.count,T.start+T.count);for(let y=E,S=b;y<S;y+=3){const A=y,C=y+1,R=y+2;s=c0(this,l,e,r,h,f,p,A,C,R),s&&(s.faceIndex=Math.floor(y/3),n.push(s))}}}}function B4(i,e,n,r,s,a,l,u){let d;if(e.side===zs?d=r.intersectTriangle(l,a,s,!0,u):d=r.intersectTriangle(s,a,l,e.side===Ya,u),d===null)return null;l0.copy(u),l0.applyMatrix4(i.matrixWorld);const h=n.ray.origin.distanceTo(l0);return h<n.near||h>n.far?null:{distance:h,point:l0.clone(),object:i}}function c0(i,e,n,r,s,a,l,u,d,h){i.getVertexPosition(u,Wm),i.getVertexPosition(d,Xm),i.getVertexPosition(h,jm);const f=B4(i,e,n,r,Wm,Xm,jm,a0);if(f){s&&(r0.fromBufferAttribute(s,u),s0.fromBufferAttribute(s,d),o0.fromBufferAttribute(s,h),f.uv=Co.getInterpolation(a0,Wm,Xm,jm,r0,s0,o0,new mt)),a&&(r0.fromBufferAttribute(a,u),s0.fromBufferAttribute(a,d),o0.fromBufferAttribute(a,h),f.uv1=Co.getInterpolation(a0,Wm,Xm,jm,r0,s0,o0,new mt),f.uv2=f.uv1),l&&(HL.fromBufferAttribute(l,u),VL.fromBufferAttribute(l,d),zL.fromBufferAttribute(l,h),f.normal=Co.getInterpolation(a0,Wm,Xm,jm,HL,VL,zL,new te),f.normal.dot(r.direction)>0&&f.normal.multiplyScalar(-1));const p={a:u,b:d,c:h,normal:new te,materialIndex:0};Co.getNormal(Wm,Xm,jm,p.normal),f.face=p}return f}class gd extends rn{constructor(e=1,n=1,r=1,s=1,a=1,l=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:s,heightSegments:a,depthSegments:l};const u=this;s=Math.floor(s),a=Math.floor(a),l=Math.floor(l);const d=[],h=[],f=[],p=[];let m=0,T=0;E("z","y","x",-1,-1,r,n,e,l,a,0),E("z","y","x",1,-1,r,n,-e,l,a,1),E("x","z","y",1,1,e,r,n,s,l,2),E("x","z","y",1,-1,e,r,-n,s,l,3),E("x","y","z",1,-1,e,n,r,s,a,4),E("x","y","z",-1,-1,e,n,-r,s,a,5),this.setIndex(d),this.setAttribute("position",new Yt(h,3)),this.setAttribute("normal",new Yt(f,3)),this.setAttribute("uv",new Yt(p,2));function E(b,y,S,A,C,R,I,O,F,k,D){const U=R/F,ce=I/k,ie=R/2,ae=I/2,ne=O/2,pe=F+1,de=k+1;let xe=0,H=0;const J=new te;for(let K=0;K<de;K++){const se=K*ce-ae;for(let Y=0;Y<pe;Y++){const he=Y*U-ie;J[b]=he*A,J[y]=se*C,J[S]=ne,h.push(J.x,J.y,J.z),J[b]=0,J[y]=0,J[S]=O>0?1:-1,f.push(J.x,J.y,J.z),p.push(Y/F),p.push(1-K/k),xe+=1}}for(let K=0;K<k;K++)for(let se=0;se<F;se++){const Y=m+se+pe*K,he=m+se+pe*(K+1),ue=m+(se+1)+pe*(K+1),Te=m+(se+1)+pe*K;d.push(Y,he,Te),d.push(he,ue,Te),H+=6}u.addGroup(T,H,D),T+=H,m+=xe}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gd(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Xg(i){const e={};for(const n in i){e[n]={};for(const r in i[n]){const s=i[n][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=s.clone():Array.isArray(s)?e[n][r]=s.slice():e[n][r]=s}}return e}function oo(i){const e={};for(let n=0;n<i.length;n++){const r=Xg(i[n]);for(const s in r)e[s]=r[s]}return e}function F4(i){const e=[];for(let n=0;n<i.length;n++)e.push(i[n].clone());return e}function AF(i){return i.getRenderTarget()===null?i.outputColorSpace:Io}const rE={clone:Xg,merge:oo};var U4=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,G4=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Oo extends rr{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=U4,this.fragmentShader=G4,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Xg(e.uniforms),this.uniformsGroups=F4(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const s in this.uniforms){const l=this.uniforms[s].value;l&&l.isTexture?n.uniforms[s]={type:"t",value:l.toJSON(e).uuid}:l&&l.isColor?n.uniforms[s]={type:"c",value:l.getHex()}:l&&l.isVector2?n.uniforms[s]={type:"v2",value:l.toArray()}:l&&l.isVector3?n.uniforms[s]={type:"v3",value:l.toArray()}:l&&l.isVector4?n.uniforms[s]={type:"v4",value:l.toArray()}:l&&l.isMatrix3?n.uniforms[s]={type:"m3",value:l.toArray()}:l&&l.isMatrix4?n.uniforms[s]={type:"m4",value:l.toArray()}:n.uniforms[s]={value:l}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const r={};for(const s in this.extensions)this.extensions[s]===!0&&(r[s]=!0);return Object.keys(r).length>0&&(n.extensions=r),n}}class yE extends Xn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new pn,this.projectionMatrix=new pn,this.projectionMatrixInverse=new pn,this.coordinateSystem=$c}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(-n[8],-n[9],-n[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Ui extends yE{constructor(e=50,n=1,r=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=s,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=Wg*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(rp*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Wg*2*Math.atan(Math.tan(rp*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,n,r,s,a,l){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=s,this.view.width=a,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(rp*.5*this.fov)/this.zoom,r=2*n,s=this.aspect*r,a=-.5*s;const l=this.view;if(this.view!==null&&this.view.enabled){const d=l.fullWidth,h=l.fullHeight;a+=l.offsetX*s/d,n-=l.offsetY*r/h,s*=l.width/d,r*=l.height/h}const u=this.filmOffset;u!==0&&(a+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+s,n,n-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const Ym=-90,Km=1;class CF extends Xn{constructor(e,n,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null;const s=new Ui(Ym,Km,e,n);s.layers=this.layers,this.add(s);const a=new Ui(Ym,Km,e,n);a.layers=this.layers,this.add(a);const l=new Ui(Ym,Km,e,n);l.layers=this.layers,this.add(l);const u=new Ui(Ym,Km,e,n);u.layers=this.layers,this.add(u);const d=new Ui(Ym,Km,e,n);d.layers=this.layers,this.add(d);const h=new Ui(Ym,Km,e,n);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[r,s,a,l,u,d]=n;for(const h of n)this.remove(h);if(e===$c)r.up.set(0,1,0),r.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),a.up.set(0,0,-1),a.lookAt(0,1,0),l.up.set(0,0,1),l.lookAt(0,-1,0),u.up.set(0,1,0),u.lookAt(0,0,1),d.up.set(0,1,0),d.lookAt(0,0,-1);else if(e===nE)r.up.set(0,-1,0),r.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),a.up.set(0,0,1),a.lookAt(0,1,0),l.up.set(0,0,-1),l.lookAt(0,-1,0),u.up.set(0,-1,0),u.lookAt(0,0,1),d.up.set(0,-1,0),d.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const h of n)this.add(h),h.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const r=this.renderTarget;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,l,u,d,h]=this.children,f=e.getRenderTarget(),p=e.toneMapping,m=e.xr.enabled;e.toneMapping=Ll,e.xr.enabled=!1;const T=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(n,s),e.setRenderTarget(r,1),e.render(n,a),e.setRenderTarget(r,2),e.render(n,l),e.setRenderTarget(r,3),e.render(n,u),e.setRenderTarget(r,4),e.render(n,d),r.texture.generateMipmaps=T,e.setRenderTarget(r,5),e.render(n,h),e.setRenderTarget(f),e.toneMapping=p,e.xr.enabled=m,r.texture.needsPMREMUpdate=!0}}class SE extends ni{constructor(e,n,r,s,a,l,u,d,h,f){e=e!==void 0?e:[],n=n!==void 0?n:Ou,super(e,n,r,s,a,l,u,d,h,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class SM extends da{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},s=[r,r,r,r,r,r];n.encoding!==void 0&&(RT("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===xc?Tn:id),this.texture=new SE(s,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Gn}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new gd(5,5,5),a=new Oo({name:"CubemapFromEquirect",uniforms:Xg(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:zs,blending:Cc});a.uniforms.tEquirect.value=n;const l=new Pn(s,a),u=n.minFilter;return n.minFilter===Ka&&(n.minFilter=Gn),new CF(1,10,this).update(e,l),n.minFilter=u,l.geometry.dispose(),l.material.dispose(),this}clear(e,n,r,s){const a=e.getRenderTarget();for(let l=0;l<6;l++)e.setRenderTarget(this,l),e.clear(n,r,s);e.setRenderTarget(a)}}const TC=new te,H4=new te,V4=new Ln;let Eu=class{constructor(e=new te(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,r,s){return this.normal.set(e,n,r),this.constant=s,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,r){const s=TC.subVectors(r,n).cross(H4.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const r=e.delta(TC),s=this.normal.dot(r);if(s===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const a=-(e.start.dot(this.normal)+this.constant)/s;return a<0||a>1?null:n.copy(e.start).addScaledVector(r,a)}intersectsLine(e){const n=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return n<0&&r>0||r<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const r=n||V4.getNormalMatrix(e),s=this.coplanarPoint(TC).applyMatrix4(e),a=this.normal.applyMatrix3(r).normalize();return this.constant=-s.dot(a),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const Cf=new js,u0=new te;class M${constructor(e=new Eu,n=new Eu,r=new Eu,s=new Eu,a=new Eu,l=new Eu){this.planes=[e,n,r,s,a,l]}set(e,n,r,s,a,l){const u=this.planes;return u[0].copy(e),u[1].copy(n),u[2].copy(r),u[3].copy(s),u[4].copy(a),u[5].copy(l),this}copy(e){const n=this.planes;for(let r=0;r<6;r++)n[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,n=$c){const r=this.planes,s=e.elements,a=s[0],l=s[1],u=s[2],d=s[3],h=s[4],f=s[5],p=s[6],m=s[7],T=s[8],E=s[9],b=s[10],y=s[11],S=s[12],A=s[13],C=s[14],R=s[15];if(r[0].setComponents(d-a,m-h,y-T,R-S).normalize(),r[1].setComponents(d+a,m+h,y+T,R+S).normalize(),r[2].setComponents(d+l,m+f,y+E,R+A).normalize(),r[3].setComponents(d-l,m-f,y-E,R-A).normalize(),r[4].setComponents(d-u,m-p,y-b,R-C).normalize(),n===$c)r[5].setComponents(d+u,m+p,y+b,R+C).normalize();else if(n===nE)r[5].setComponents(u,p,b,C).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Cf.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),Cf.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Cf)}intersectsSprite(e){return Cf.center.set(0,0,0),Cf.radius=.7071067811865476,Cf.applyMatrix4(e.matrixWorld),this.intersectsSphere(Cf)}intersectsSphere(e){const n=this.planes,r=e.center,s=-e.radius;for(let a=0;a<6;a++)if(n[a].distanceToPoint(r)<s)return!1;return!0}intersectsBox(e){const n=this.planes;for(let r=0;r<6;r++){const s=n[r];if(u0.x=s.normal.x>0?e.max.x:e.min.x,u0.y=s.normal.y>0?e.max.y:e.min.y,u0.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(u0)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let r=0;r<6;r++)if(n[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function xF(){let i=null,e=!1,n=null,r=null;function s(a,l){n(a,l),r=i.requestAnimationFrame(s)}return{start:function(){e!==!0&&n!==null&&(r=i.requestAnimationFrame(s),e=!0)},stop:function(){i.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(a){n=a},setContext:function(a){i=a}}}function z4(i,e){const n=e.isWebGL2,r=new WeakMap;function s(h,f){const p=h.array,m=h.usage,T=i.createBuffer();i.bindBuffer(f,T),i.bufferData(f,p,m),h.onUploadCallback();let E;if(p instanceof Float32Array)E=i.FLOAT;else if(p instanceof Uint16Array)if(h.isFloat16BufferAttribute)if(n)E=i.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else E=i.UNSIGNED_SHORT;else if(p instanceof Int16Array)E=i.SHORT;else if(p instanceof Uint32Array)E=i.UNSIGNED_INT;else if(p instanceof Int32Array)E=i.INT;else if(p instanceof Int8Array)E=i.BYTE;else if(p instanceof Uint8Array)E=i.UNSIGNED_BYTE;else if(p instanceof Uint8ClampedArray)E=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+p);return{buffer:T,type:E,bytesPerElement:p.BYTES_PER_ELEMENT,version:h.version}}function a(h,f,p){const m=f.array,T=f.updateRange;i.bindBuffer(p,h),T.count===-1?i.bufferSubData(p,0,m):(n?i.bufferSubData(p,T.offset*m.BYTES_PER_ELEMENT,m,T.offset,T.count):i.bufferSubData(p,T.offset*m.BYTES_PER_ELEMENT,m.subarray(T.offset,T.offset+T.count)),T.count=-1),f.onUploadCallback()}function l(h){return h.isInterleavedBufferAttribute&&(h=h.data),r.get(h)}function u(h){h.isInterleavedBufferAttribute&&(h=h.data);const f=r.get(h);f&&(i.deleteBuffer(f.buffer),r.delete(h))}function d(h,f){if(h.isGLBufferAttribute){const m=r.get(h);(!m||m.version<h.version)&&r.set(h,{buffer:h.buffer,type:h.type,bytesPerElement:h.elementSize,version:h.version});return}h.isInterleavedBufferAttribute&&(h=h.data);const p=r.get(h);p===void 0?r.set(h,s(h,f)):p.version<h.version&&(a(p.buffer,h,f),p.version=h.version)}return{get:l,remove:u,update:d}}class Bl extends rn{constructor(e=1,n=1,r=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:r,heightSegments:s};const a=e/2,l=n/2,u=Math.floor(r),d=Math.floor(s),h=u+1,f=d+1,p=e/u,m=n/d,T=[],E=[],b=[],y=[];for(let S=0;S<f;S++){const A=S*m-l;for(let C=0;C<h;C++){const R=C*p-a;E.push(R,-A,0),b.push(0,0,1),y.push(C/u),y.push(1-S/d)}}for(let S=0;S<d;S++)for(let A=0;A<u;A++){const C=A+h*S,R=A+h*(S+1),I=A+1+h*(S+1),O=A+1+h*S;T.push(C,R,O),T.push(R,I,O)}this.setIndex(T),this.setAttribute("position",new Yt(E,3)),this.setAttribute("normal",new Yt(b,3)),this.setAttribute("uv",new Yt(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Bl(e.width,e.height,e.widthSegments,e.heightSegments)}}var W4=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,X4=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,j4=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Y4=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,K4=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,J4=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Z4="vec3 transformed = vec3( position );",q4=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Q4=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,eW=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,tW=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,nW=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,iW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,rW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,sW=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,oW=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,aW=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,lW=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,cW=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,uW=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,hW=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,dW=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,fW=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,pW=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,mW=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,gW=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,_W="gl_FragColor = linearToOutputTexel( gl_FragColor );",vW=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,TW=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,EW=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,yW=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,SW=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,$W=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,bW=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,AW=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,CW=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,xW=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,RW=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,wW=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,MW=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,IW=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,OW=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,LW=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,NW=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,kW=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,PW=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,DW=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,BW=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,FW=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,UW=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,GW=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,HW=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,VW=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,zW=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,WW=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,XW=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,jW=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,YW=`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,KW=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,JW=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,ZW=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,qW=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,QW=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,e5=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,t5=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,n5=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,i5=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,r5=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,s5=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,o5=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,a5=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,l5=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,c5=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,u5=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,h5=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,d5=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,f5=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,p5=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,m5=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,g5=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,_5=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,v5=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,T5=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,E5=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,y5=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,S5=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,$5=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,b5=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,A5=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,C5=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,x5=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,R5=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,w5=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,M5=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,I5=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,O5=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,L5=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,N5=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,k5=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,P5=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,D5=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,B5=`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,F5=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const U5=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,G5=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,H5=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,V5=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,z5=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,W5=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,X5=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,j5=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Y5=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,K5=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,J5=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Z5=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,q5=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Q5=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,e8=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,t8=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,n8=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,i8=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,r8=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,s8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,o8=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,a8=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,l8=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,c8=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,u8=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,h8=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,d8=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,f8=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,p8=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,m8=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,g8=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,_8=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,v8=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,T8=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,On={alphamap_fragment:W4,alphamap_pars_fragment:X4,alphatest_fragment:j4,alphatest_pars_fragment:Y4,aomap_fragment:K4,aomap_pars_fragment:J4,begin_vertex:Z4,beginnormal_vertex:q4,bsdfs:Q4,iridescence_fragment:eW,bumpmap_pars_fragment:tW,clipping_planes_fragment:nW,clipping_planes_pars_fragment:iW,clipping_planes_pars_vertex:rW,clipping_planes_vertex:sW,color_fragment:oW,color_pars_fragment:aW,color_pars_vertex:lW,color_vertex:cW,common:uW,cube_uv_reflection_fragment:hW,defaultnormal_vertex:dW,displacementmap_pars_vertex:fW,displacementmap_vertex:pW,emissivemap_fragment:mW,emissivemap_pars_fragment:gW,encodings_fragment:_W,encodings_pars_fragment:vW,envmap_fragment:TW,envmap_common_pars_fragment:EW,envmap_pars_fragment:yW,envmap_pars_vertex:SW,envmap_physical_pars_fragment:NW,envmap_vertex:$W,fog_vertex:bW,fog_pars_vertex:AW,fog_fragment:CW,fog_pars_fragment:xW,gradientmap_pars_fragment:RW,lightmap_fragment:wW,lightmap_pars_fragment:MW,lights_lambert_fragment:IW,lights_lambert_pars_fragment:OW,lights_pars_begin:LW,lights_toon_fragment:kW,lights_toon_pars_fragment:PW,lights_phong_fragment:DW,lights_phong_pars_fragment:BW,lights_physical_fragment:FW,lights_physical_pars_fragment:UW,lights_fragment_begin:GW,lights_fragment_maps:HW,lights_fragment_end:VW,logdepthbuf_fragment:zW,logdepthbuf_pars_fragment:WW,logdepthbuf_pars_vertex:XW,logdepthbuf_vertex:jW,map_fragment:YW,map_pars_fragment:KW,map_particle_fragment:JW,map_particle_pars_fragment:ZW,metalnessmap_fragment:qW,metalnessmap_pars_fragment:QW,morphcolor_vertex:e5,morphnormal_vertex:t5,morphtarget_pars_vertex:n5,morphtarget_vertex:i5,normal_fragment_begin:r5,normal_fragment_maps:s5,normal_pars_fragment:o5,normal_pars_vertex:a5,normal_vertex:l5,normalmap_pars_fragment:c5,clearcoat_normal_fragment_begin:u5,clearcoat_normal_fragment_maps:h5,clearcoat_pars_fragment:d5,iridescence_pars_fragment:f5,output_fragment:p5,packing:m5,premultiplied_alpha_fragment:g5,project_vertex:_5,dithering_fragment:v5,dithering_pars_fragment:T5,roughnessmap_fragment:E5,roughnessmap_pars_fragment:y5,shadowmap_pars_fragment:S5,shadowmap_pars_vertex:$5,shadowmap_vertex:b5,shadowmask_pars_fragment:A5,skinbase_vertex:C5,skinning_pars_vertex:x5,skinning_vertex:R5,skinnormal_vertex:w5,specularmap_fragment:M5,specularmap_pars_fragment:I5,tonemapping_fragment:O5,tonemapping_pars_fragment:L5,transmission_fragment:N5,transmission_pars_fragment:k5,uv_pars_fragment:P5,uv_pars_vertex:D5,uv_vertex:B5,worldpos_vertex:F5,background_vert:U5,background_frag:G5,backgroundCube_vert:H5,backgroundCube_frag:V5,cube_vert:z5,cube_frag:W5,depth_vert:X5,depth_frag:j5,distanceRGBA_vert:Y5,distanceRGBA_frag:K5,equirect_vert:J5,equirect_frag:Z5,linedashed_vert:q5,linedashed_frag:Q5,meshbasic_vert:e8,meshbasic_frag:t8,meshlambert_vert:n8,meshlambert_frag:i8,meshmatcap_vert:r8,meshmatcap_frag:s8,meshnormal_vert:o8,meshnormal_frag:a8,meshphong_vert:l8,meshphong_frag:c8,meshphysical_vert:u8,meshphysical_frag:h8,meshtoon_vert:d8,meshtoon_frag:f8,points_vert:p8,points_frag:m8,shadow_vert:g8,shadow_frag:_8,sprite_vert:v8,sprite_frag:T8},Lt={common:{diffuse:{value:new Ct(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ln},alphaMap:{value:null},alphaMapTransform:{value:new Ln},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ln}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ln}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ln}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ln},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ln},normalScale:{value:new mt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ln},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ln}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ln}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ln}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ct(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ct(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ln},alphaTest:{value:0},uvTransform:{value:new Ln}},sprite:{diffuse:{value:new Ct(16777215)},opacity:{value:1},center:{value:new mt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ln},alphaMap:{value:null},alphaMapTransform:{value:new Ln},alphaTest:{value:0}}},Ml={basic:{uniforms:oo([Lt.common,Lt.specularmap,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.fog]),vertexShader:On.meshbasic_vert,fragmentShader:On.meshbasic_frag},lambert:{uniforms:oo([Lt.common,Lt.specularmap,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.emissivemap,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.fog,Lt.lights,{emissive:{value:new Ct(0)}}]),vertexShader:On.meshlambert_vert,fragmentShader:On.meshlambert_frag},phong:{uniforms:oo([Lt.common,Lt.specularmap,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.emissivemap,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.fog,Lt.lights,{emissive:{value:new Ct(0)},specular:{value:new Ct(1118481)},shininess:{value:30}}]),vertexShader:On.meshphong_vert,fragmentShader:On.meshphong_frag},standard:{uniforms:oo([Lt.common,Lt.envmap,Lt.aomap,Lt.lightmap,Lt.emissivemap,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.roughnessmap,Lt.metalnessmap,Lt.fog,Lt.lights,{emissive:{value:new Ct(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:On.meshphysical_vert,fragmentShader:On.meshphysical_frag},toon:{uniforms:oo([Lt.common,Lt.aomap,Lt.lightmap,Lt.emissivemap,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.gradientmap,Lt.fog,Lt.lights,{emissive:{value:new Ct(0)}}]),vertexShader:On.meshtoon_vert,fragmentShader:On.meshtoon_frag},matcap:{uniforms:oo([Lt.common,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,Lt.fog,{matcap:{value:null}}]),vertexShader:On.meshmatcap_vert,fragmentShader:On.meshmatcap_frag},points:{uniforms:oo([Lt.points,Lt.fog]),vertexShader:On.points_vert,fragmentShader:On.points_frag},dashed:{uniforms:oo([Lt.common,Lt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:On.linedashed_vert,fragmentShader:On.linedashed_frag},depth:{uniforms:oo([Lt.common,Lt.displacementmap]),vertexShader:On.depth_vert,fragmentShader:On.depth_frag},normal:{uniforms:oo([Lt.common,Lt.bumpmap,Lt.normalmap,Lt.displacementmap,{opacity:{value:1}}]),vertexShader:On.meshnormal_vert,fragmentShader:On.meshnormal_frag},sprite:{uniforms:oo([Lt.sprite,Lt.fog]),vertexShader:On.sprite_vert,fragmentShader:On.sprite_frag},background:{uniforms:{uvTransform:{value:new Ln},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:On.background_vert,fragmentShader:On.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:On.backgroundCube_vert,fragmentShader:On.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:On.cube_vert,fragmentShader:On.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:On.equirect_vert,fragmentShader:On.equirect_frag},distanceRGBA:{uniforms:oo([Lt.common,Lt.displacementmap,{referencePosition:{value:new te},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:On.distanceRGBA_vert,fragmentShader:On.distanceRGBA_frag},shadow:{uniforms:oo([Lt.lights,Lt.fog,{color:{value:new Ct(0)},opacity:{value:1}}]),vertexShader:On.shadow_vert,fragmentShader:On.shadow_frag}};Ml.physical={uniforms:oo([Ml.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ln},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ln},clearcoatNormalScale:{value:new mt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ln},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ln},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ln},sheen:{value:0},sheenColor:{value:new Ct(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ln},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ln},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ln},transmissionSamplerSize:{value:new mt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ln},attenuationDistance:{value:0},attenuationColor:{value:new Ct(0)},specularColor:{value:new Ct(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ln},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ln},anisotropyVector:{value:new mt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ln}}]),vertexShader:On.meshphysical_vert,fragmentShader:On.meshphysical_frag};const h0={r:0,b:0,g:0};function E8(i,e,n,r,s,a,l){const u=new Ct(0);let d=a===!0?0:1,h,f,p=null,m=0,T=null;function E(y,S){let A=!1,C=S.isScene===!0?S.background:null;switch(C&&C.isTexture&&(C=(S.backgroundBlurriness>0?n:e).get(C)),C===null?b(u,d):C&&C.isColor&&(b(C,1),A=!0),i.xr.getEnvironmentBlendMode()){case"opaque":A=!0;break;case"additive":r.buffers.color.setClear(0,0,0,1,l),A=!0;break;case"alpha-blend":r.buffers.color.setClear(0,0,0,0,l),A=!0;break}(i.autoClear||A)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),C&&(C.isCubeTexture||C.mapping===Qg)?(f===void 0&&(f=new Pn(new gd(1,1,1),new Oo({name:"BackgroundCubeMaterial",uniforms:Xg(Ml.backgroundCube.uniforms),vertexShader:Ml.backgroundCube.vertexShader,fragmentShader:Ml.backgroundCube.fragmentShader,side:zs,depthTest:!1,depthWrite:!1,fog:!1})),f.geometry.deleteAttribute("normal"),f.geometry.deleteAttribute("uv"),f.onBeforeRender=function(O,F,k){this.matrixWorld.copyPosition(k.matrixWorld)},Object.defineProperty(f.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(f)),f.material.uniforms.envMap.value=C,f.material.uniforms.flipEnvMap.value=C.isCubeTexture&&C.isRenderTargetTexture===!1?-1:1,f.material.uniforms.backgroundBlurriness.value=S.backgroundBlurriness,f.material.uniforms.backgroundIntensity.value=S.backgroundIntensity,f.material.toneMapped=C.colorSpace!==Tn,(p!==C||m!==C.version||T!==i.toneMapping)&&(f.material.needsUpdate=!0,p=C,m=C.version,T=i.toneMapping),f.layers.enableAll(),y.unshift(f,f.geometry,f.material,0,0,null)):C&&C.isTexture&&(h===void 0&&(h=new Pn(new Bl(2,2),new Oo({name:"BackgroundMaterial",uniforms:Xg(Ml.background.uniforms),vertexShader:Ml.background.vertexShader,fragmentShader:Ml.background.fragmentShader,side:Ya,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(h)),h.material.uniforms.t2D.value=C,h.material.uniforms.backgroundIntensity.value=S.backgroundIntensity,h.material.toneMapped=C.colorSpace!==Tn,C.matrixAutoUpdate===!0&&C.updateMatrix(),h.material.uniforms.uvTransform.value.copy(C.matrix),(p!==C||m!==C.version||T!==i.toneMapping)&&(h.material.needsUpdate=!0,p=C,m=C.version,T=i.toneMapping),h.layers.enableAll(),y.unshift(h,h.geometry,h.material,0,0,null))}function b(y,S){y.getRGB(h0,AF(i)),r.buffers.color.setClear(h0.r,h0.g,h0.b,S,l)}return{getClearColor:function(){return u},setClearColor:function(y,S=1){u.set(y),d=S,b(u,d)},getClearAlpha:function(){return d},setClearAlpha:function(y){d=y,b(u,d)},render:E}}function y8(i,e,n,r){const s=i.getParameter(i.MAX_VERTEX_ATTRIBS),a=r.isWebGL2?null:e.get("OES_vertex_array_object"),l=r.isWebGL2||a!==null,u={},d=y(null);let h=d,f=!1;function p(ne,pe,de,xe,H){let J=!1;if(l){const K=b(xe,de,pe);h!==K&&(h=K,T(h.object)),J=S(ne,xe,de,H),J&&A(ne,xe,de,H)}else{const K=pe.wireframe===!0;(h.geometry!==xe.id||h.program!==de.id||h.wireframe!==K)&&(h.geometry=xe.id,h.program=de.id,h.wireframe=K,J=!0)}H!==null&&n.update(H,i.ELEMENT_ARRAY_BUFFER),(J||f)&&(f=!1,k(ne,pe,de,xe),H!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.get(H).buffer))}function m(){return r.isWebGL2?i.createVertexArray():a.createVertexArrayOES()}function T(ne){return r.isWebGL2?i.bindVertexArray(ne):a.bindVertexArrayOES(ne)}function E(ne){return r.isWebGL2?i.deleteVertexArray(ne):a.deleteVertexArrayOES(ne)}function b(ne,pe,de){const xe=de.wireframe===!0;let H=u[ne.id];H===void 0&&(H={},u[ne.id]=H);let J=H[pe.id];J===void 0&&(J={},H[pe.id]=J);let K=J[xe];return K===void 0&&(K=y(m()),J[xe]=K),K}function y(ne){const pe=[],de=[],xe=[];for(let H=0;H<s;H++)pe[H]=0,de[H]=0,xe[H]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:pe,enabledAttributes:de,attributeDivisors:xe,object:ne,attributes:{},index:null}}function S(ne,pe,de,xe){const H=h.attributes,J=pe.attributes;let K=0;const se=de.getAttributes();for(const Y in se)if(se[Y].location>=0){const ue=H[Y];let Te=J[Y];if(Te===void 0&&(Y==="instanceMatrix"&&ne.instanceMatrix&&(Te=ne.instanceMatrix),Y==="instanceColor"&&ne.instanceColor&&(Te=ne.instanceColor)),ue===void 0||ue.attribute!==Te||Te&&ue.data!==Te.data)return!0;K++}return h.attributesNum!==K||h.index!==xe}function A(ne,pe,de,xe){const H={},J=pe.attributes;let K=0;const se=de.getAttributes();for(const Y in se)if(se[Y].location>=0){let ue=J[Y];ue===void 0&&(Y==="instanceMatrix"&&ne.instanceMatrix&&(ue=ne.instanceMatrix),Y==="instanceColor"&&ne.instanceColor&&(ue=ne.instanceColor));const Te={};Te.attribute=ue,ue&&ue.data&&(Te.data=ue.data),H[Y]=Te,K++}h.attributes=H,h.attributesNum=K,h.index=xe}function C(){const ne=h.newAttributes;for(let pe=0,de=ne.length;pe<de;pe++)ne[pe]=0}function R(ne){I(ne,0)}function I(ne,pe){const de=h.newAttributes,xe=h.enabledAttributes,H=h.attributeDivisors;de[ne]=1,xe[ne]===0&&(i.enableVertexAttribArray(ne),xe[ne]=1),H[ne]!==pe&&((r.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](ne,pe),H[ne]=pe)}function O(){const ne=h.newAttributes,pe=h.enabledAttributes;for(let de=0,xe=pe.length;de<xe;de++)pe[de]!==ne[de]&&(i.disableVertexAttribArray(de),pe[de]=0)}function F(ne,pe,de,xe,H,J,K){K===!0?i.vertexAttribIPointer(ne,pe,de,H,J):i.vertexAttribPointer(ne,pe,de,xe,H,J)}function k(ne,pe,de,xe){if(r.isWebGL2===!1&&(ne.isInstancedMesh||xe.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;C();const H=xe.attributes,J=de.getAttributes(),K=pe.defaultAttributeValues;for(const se in J){const Y=J[se];if(Y.location>=0){let he=H[se];if(he===void 0&&(se==="instanceMatrix"&&ne.instanceMatrix&&(he=ne.instanceMatrix),se==="instanceColor"&&ne.instanceColor&&(he=ne.instanceColor)),he!==void 0){const ue=he.normalized,Te=he.itemSize,_e=n.get(he);if(_e===void 0)continue;const Re=_e.buffer,De=_e.type,et=_e.bytesPerElement,Ue=r.isWebGL2===!0&&(De===i.INT||De===i.UNSIGNED_INT||he.gpuType===C$);if(he.isInterleavedBufferAttribute){const Le=he.data,re=Le.stride,Ye=he.offset;if(Le.isInstancedInterleavedBuffer){for(let Fe=0;Fe<Y.locationSize;Fe++)I(Y.location+Fe,Le.meshPerAttribute);ne.isInstancedMesh!==!0&&xe._maxInstanceCount===void 0&&(xe._maxInstanceCount=Le.meshPerAttribute*Le.count)}else for(let Fe=0;Fe<Y.locationSize;Fe++)R(Y.location+Fe);i.bindBuffer(i.ARRAY_BUFFER,Re);for(let Fe=0;Fe<Y.locationSize;Fe++)F(Y.location+Fe,Te/Y.locationSize,De,ue,re*et,(Ye+Te/Y.locationSize*Fe)*et,Ue)}else{if(he.isInstancedBufferAttribute){for(let Le=0;Le<Y.locationSize;Le++)I(Y.location+Le,he.meshPerAttribute);ne.isInstancedMesh!==!0&&xe._maxInstanceCount===void 0&&(xe._maxInstanceCount=he.meshPerAttribute*he.count)}else for(let Le=0;Le<Y.locationSize;Le++)R(Y.location+Le);i.bindBuffer(i.ARRAY_BUFFER,Re);for(let Le=0;Le<Y.locationSize;Le++)F(Y.location+Le,Te/Y.locationSize,De,ue,Te*et,Te/Y.locationSize*Le*et,Ue)}}else if(K!==void 0){const ue=K[se];if(ue!==void 0)switch(ue.length){case 2:i.vertexAttrib2fv(Y.location,ue);break;case 3:i.vertexAttrib3fv(Y.location,ue);break;case 4:i.vertexAttrib4fv(Y.location,ue);break;default:i.vertexAttrib1fv(Y.location,ue)}}}}O()}function D(){ie();for(const ne in u){const pe=u[ne];for(const de in pe){const xe=pe[de];for(const H in xe)E(xe[H].object),delete xe[H];delete pe[de]}delete u[ne]}}function U(ne){if(u[ne.id]===void 0)return;const pe=u[ne.id];for(const de in pe){const xe=pe[de];for(const H in xe)E(xe[H].object),delete xe[H];delete pe[de]}delete u[ne.id]}function ce(ne){for(const pe in u){const de=u[pe];if(de[ne.id]===void 0)continue;const xe=de[ne.id];for(const H in xe)E(xe[H].object),delete xe[H];delete de[ne.id]}}function ie(){ae(),f=!0,h!==d&&(h=d,T(h.object))}function ae(){d.geometry=null,d.program=null,d.wireframe=!1}return{setup:p,reset:ie,resetDefaultState:ae,dispose:D,releaseStatesOfGeometry:U,releaseStatesOfProgram:ce,initAttributes:C,enableAttribute:R,disableUnusedAttributes:O}}function S8(i,e,n,r){const s=r.isWebGL2;let a;function l(h){a=h}function u(h,f){i.drawArrays(a,h,f),n.update(f,a,1)}function d(h,f,p){if(p===0)return;let m,T;if(s)m=i,T="drawArraysInstanced";else if(m=e.get("ANGLE_instanced_arrays"),T="drawArraysInstancedANGLE",m===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[T](a,h,f,p),n.update(f,a,p)}this.setMode=l,this.render=u,this.renderInstances=d}function $8(i,e,n){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const F=e.get("EXT_texture_filter_anisotropic");r=i.getParameter(F.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function a(F){if(F==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";F="mediump"}return F==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const l=typeof WebGL2RenderingContext<"u"&&i.constructor.name==="WebGL2RenderingContext";let u=n.precision!==void 0?n.precision:"highp";const d=a(u);d!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",d,"instead."),u=d);const h=l||e.has("WEBGL_draw_buffers"),f=n.logarithmicDepthBuffer===!0,p=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),m=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),T=i.getParameter(i.MAX_TEXTURE_SIZE),E=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),b=i.getParameter(i.MAX_VERTEX_ATTRIBS),y=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),S=i.getParameter(i.MAX_VARYING_VECTORS),A=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),C=m>0,R=l||e.has("OES_texture_float"),I=C&&R,O=l?i.getParameter(i.MAX_SAMPLES):0;return{isWebGL2:l,drawBuffers:h,getMaxAnisotropy:s,getMaxPrecision:a,precision:u,logarithmicDepthBuffer:f,maxTextures:p,maxVertexTextures:m,maxTextureSize:T,maxCubemapSize:E,maxAttributes:b,maxVertexUniforms:y,maxVaryings:S,maxFragmentUniforms:A,vertexTextures:C,floatFragmentTextures:R,floatVertexTextures:I,maxSamples:O}}function b8(i){const e=this;let n=null,r=0,s=!1,a=!1;const l=new Eu,u=new Ln,d={value:null,needsUpdate:!1};this.uniform=d,this.numPlanes=0,this.numIntersection=0,this.init=function(p,m){const T=p.length!==0||m||r!==0||s;return s=m,r=p.length,T},this.beginShadows=function(){a=!0,f(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(p,m){n=f(p,m,0)},this.setState=function(p,m,T){const E=p.clippingPlanes,b=p.clipIntersection,y=p.clipShadows,S=i.get(p);if(!s||E===null||E.length===0||a&&!y)a?f(null):h();else{const A=a?0:r,C=A*4;let R=S.clippingState||null;d.value=R,R=f(E,m,C,T);for(let I=0;I!==C;++I)R[I]=n[I];S.clippingState=R,this.numIntersection=b?this.numPlanes:0,this.numPlanes+=A}};function h(){d.value!==n&&(d.value=n,d.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function f(p,m,T,E){const b=p!==null?p.length:0;let y=null;if(b!==0){if(y=d.value,E!==!0||y===null){const S=T+b*4,A=m.matrixWorldInverse;u.getNormalMatrix(A),(y===null||y.length<S)&&(y=new Float32Array(S));for(let C=0,R=T;C!==b;++C,R+=4)l.copy(p[C]).applyMatrix4(A,u),l.normal.toArray(y,R),y[R+3]=l.constant}d.value=y,d.needsUpdate=!0}return e.numPlanes=b,e.numIntersection=0,y}}function A8(i){let e=new WeakMap;function n(l,u){return u===Vg?l.mapping=Ou:u===QT&&(l.mapping=ad),l}function r(l){if(l&&l.isTexture&&l.isRenderTargetTexture===!1){const u=l.mapping;if(u===Vg||u===QT)if(e.has(l)){const d=e.get(l).texture;return n(d,l.mapping)}else{const d=l.image;if(d&&d.height>0){const h=new SM(d.height/2);return h.fromEquirectangularTexture(i,l),e.set(l,h),l.addEventListener("dispose",s),n(h.texture,l.mapping)}else return null}}return l}function s(l){const u=l.target;u.removeEventListener("dispose",s);const d=e.get(u);d!==void 0&&(e.delete(u),d.dispose())}function a(){e=new WeakMap}return{get:r,dispose:a}}class ua extends yE{constructor(e=-1,n=1,r=1,s=-1,a=.1,l=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=r,this.bottom=s,this.near=a,this.far=l,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,r,s,a,l){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=s,this.view.width=a,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let a=r-e,l=r+e,u=s+n,d=s-n;if(this.view!==null&&this.view.enabled){const h=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=h*this.view.offsetX,l=a+h*this.view.width,u-=f*this.view.offsetY,d=u-f*this.view.height}this.projectionMatrix.makeOrthographic(a,l,u,d,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}const $g=4,WL=[.125,.215,.35,.446,.526,.582],Gf=20,EC=new ua,XL=new Ct;let yC=null;const Ff=(1+Math.sqrt(5))/2,Jm=1/Ff,jL=[new te(1,1,1),new te(-1,1,1),new te(1,1,-1),new te(-1,1,-1),new te(0,Ff,Jm),new te(0,Ff,-Jm),new te(Jm,0,Ff),new te(-Jm,0,Ff),new te(Ff,Jm,0),new te(-Ff,Jm,0)];class DR{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,r=.1,s=100){yC=this._renderer.getRenderTarget(),this._setSize(256);const a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(e,r,s,a),n>0&&this._blur(a,0,0,n),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=JL(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=KL(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(yC),e.scissorTest=!1,d0(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===Ou||e.mapping===ad?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),yC=this._renderer.getRenderTarget();const r=n||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,r={magFilter:Gn,minFilter:Gn,generateMipmaps:!1,type:ss,format:jr,colorSpace:Io,depthBuffer:!1},s=YL(e,n,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=YL(e,n,r);const{_lodMax:a}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=C8(a)),this._blurMaterial=x8(a,e,n)}return s}_compileMaterial(e){const n=new Pn(this._lodPlanes[0],e);this._renderer.compile(n,EC)}_sceneToCubeUV(e,n,r,s){const u=new Ui(90,1,n,r),d=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],f=this._renderer,p=f.autoClear,m=f.toneMapping;f.getClearColor(XL),f.toneMapping=Ll,f.autoClear=!1;const T=new ii({name:"PMREM.Background",side:zs,depthWrite:!1,depthTest:!1}),E=new Pn(new gd,T);let b=!1;const y=e.background;y?y.isColor&&(T.color.copy(y),e.background=null,b=!0):(T.color.copy(XL),b=!0);for(let S=0;S<6;S++){const A=S%3;A===0?(u.up.set(0,d[S],0),u.lookAt(h[S],0,0)):A===1?(u.up.set(0,0,d[S]),u.lookAt(0,h[S],0)):(u.up.set(0,d[S],0),u.lookAt(0,0,h[S]));const C=this._cubeSize;d0(s,A*C,S>2?C:0,C,C),f.setRenderTarget(s),b&&f.render(E,u),f.render(e,u)}E.geometry.dispose(),E.material.dispose(),f.toneMapping=m,f.autoClear=p,e.background=y}_textureToCubeUV(e,n){const r=this._renderer,s=e.mapping===Ou||e.mapping===ad;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=JL()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=KL());const a=s?this._cubemapMaterial:this._equirectMaterial,l=new Pn(this._lodPlanes[0],a),u=a.uniforms;u.envMap.value=e;const d=this._cubeSize;d0(n,0,0,3*d,2*d),r.setRenderTarget(n),r.render(l,EC)}_applyPMREM(e){const n=this._renderer,r=n.autoClear;n.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),l=jL[(s-1)%jL.length];this._blur(e,s-1,s,a,l)}n.autoClear=r}_blur(e,n,r,s,a){const l=this._pingPongRenderTarget;this._halfBlur(e,l,n,r,s,"latitudinal",a),this._halfBlur(l,e,r,r,s,"longitudinal",a)}_halfBlur(e,n,r,s,a,l,u){const d=this._renderer,h=this._blurMaterial;l!=="latitudinal"&&l!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const f=3,p=new Pn(this._lodPlanes[s],h),m=h.uniforms,T=this._sizeLods[r]-1,E=isFinite(a)?Math.PI/(2*T):2*Math.PI/(2*Gf-1),b=a/E,y=isFinite(a)?1+Math.floor(f*b):Gf;y>Gf&&console.warn(`sigmaRadians, ${a}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${Gf}`);const S=[];let A=0;for(let F=0;F<Gf;++F){const k=F/b,D=Math.exp(-k*k/2);S.push(D),F===0?A+=D:F<y&&(A+=2*D)}for(let F=0;F<S.length;F++)S[F]=S[F]/A;m.envMap.value=e.texture,m.samples.value=y,m.weights.value=S,m.latitudinal.value=l==="latitudinal",u&&(m.poleAxis.value=u);const{_lodMax:C}=this;m.dTheta.value=E,m.mipInt.value=C-r;const R=this._sizeLods[s],I=3*R*(s>C-$g?s-C+$g:0),O=4*(this._cubeSize-R);d0(n,I,O,3*R,2*R),d.setRenderTarget(n),d.render(p,EC)}}function C8(i){const e=[],n=[],r=[];let s=i;const a=i-$g+1+WL.length;for(let l=0;l<a;l++){const u=Math.pow(2,s);n.push(u);let d=1/u;l>i-$g?d=WL[l-i+$g-1]:l===0&&(d=0),r.push(d);const h=1/(u-2),f=-h,p=1+h,m=[f,f,p,f,p,p,f,f,p,p,f,p],T=6,E=6,b=3,y=2,S=1,A=new Float32Array(b*E*T),C=new Float32Array(y*E*T),R=new Float32Array(S*E*T);for(let O=0;O<T;O++){const F=O%3*2/3-1,k=O>2?0:-1,D=[F,k,0,F+2/3,k,0,F+2/3,k+1,0,F,k,0,F+2/3,k+1,0,F,k+1,0];A.set(D,b*E*O),C.set(m,y*E*O);const U=[O,O,O,O,O,O];R.set(U,S*E*O)}const I=new rn;I.setAttribute("position",new Qn(A,b)),I.setAttribute("uv",new Qn(C,y)),I.setAttribute("faceIndex",new Qn(R,S)),e.push(I),s>$g&&s--}return{lodPlanes:e,sizeLods:n,sigmas:r}}function YL(i,e,n){const r=new da(i,e,n);return r.texture.mapping=Qg,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function d0(i,e,n,r,s){i.viewport.set(e,n,r,s),i.scissor.set(e,n,r,s)}function x8(i,e,n){const r=new Float32Array(Gf),s=new te(0,1,0);return new Oo({name:"SphericalGaussianBlur",defines:{n:Gf,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:$M(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Cc,depthTest:!1,depthWrite:!1})}function KL(){return new Oo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:$M(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Cc,depthTest:!1,depthWrite:!1})}function JL(){return new Oo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:$M(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Cc,depthTest:!1,depthWrite:!1})}function $M(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function R8(i){let e=new WeakMap,n=null;function r(u){if(u&&u.isTexture){const d=u.mapping,h=d===Vg||d===QT,f=d===Ou||d===ad;if(h||f)if(u.isRenderTargetTexture&&u.needsPMREMUpdate===!0){u.needsPMREMUpdate=!1;let p=e.get(u);return n===null&&(n=new DR(i)),p=h?n.fromEquirectangular(u,p):n.fromCubemap(u,p),e.set(u,p),p.texture}else{if(e.has(u))return e.get(u).texture;{const p=u.image;if(h&&p&&p.height>0||f&&p&&s(p)){n===null&&(n=new DR(i));const m=h?n.fromEquirectangular(u):n.fromCubemap(u);return e.set(u,m),u.addEventListener("dispose",a),m.texture}else return null}}}return u}function s(u){let d=0;const h=6;for(let f=0;f<h;f++)u[f]!==void 0&&d++;return d===h}function a(u){const d=u.target;d.removeEventListener("dispose",a);const h=e.get(d);h!==void 0&&(e.delete(d),h.dispose())}function l(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:r,dispose:l}}function w8(i){const e={};function n(r){if(e[r]!==void 0)return e[r];let s;switch(r){case"WEBGL_depth_texture":s=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=i.getExtension(r)}return e[r]=s,s}return{has:function(r){return n(r)!==null},init:function(r){r.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(r){const s=n(r);return s===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),s}}}function M8(i,e,n,r){const s={},a=new WeakMap;function l(p){const m=p.target;m.index!==null&&e.remove(m.index);for(const E in m.attributes)e.remove(m.attributes[E]);for(const E in m.morphAttributes){const b=m.morphAttributes[E];for(let y=0,S=b.length;y<S;y++)e.remove(b[y])}m.removeEventListener("dispose",l),delete s[m.id];const T=a.get(m);T&&(e.remove(T),a.delete(m)),r.releaseStatesOfGeometry(m),m.isInstancedBufferGeometry===!0&&delete m._maxInstanceCount,n.memory.geometries--}function u(p,m){return s[m.id]===!0||(m.addEventListener("dispose",l),s[m.id]=!0,n.memory.geometries++),m}function d(p){const m=p.attributes;for(const E in m)e.update(m[E],i.ARRAY_BUFFER);const T=p.morphAttributes;for(const E in T){const b=T[E];for(let y=0,S=b.length;y<S;y++)e.update(b[y],i.ARRAY_BUFFER)}}function h(p){const m=[],T=p.index,E=p.attributes.position;let b=0;if(T!==null){const A=T.array;b=T.version;for(let C=0,R=A.length;C<R;C+=3){const I=A[C+0],O=A[C+1],F=A[C+2];m.push(I,O,O,F,F,I)}}else{const A=E.array;b=E.version;for(let C=0,R=A.length/3-1;C<R;C+=3){const I=C+0,O=C+1,F=C+2;m.push(I,O,O,F,F,I)}}const y=new($F(m)?yM:EM)(m,1);y.version=b;const S=a.get(p);S&&e.remove(S),a.set(p,y)}function f(p){const m=a.get(p);if(m){const T=p.index;T!==null&&m.version<T.version&&h(p)}else h(p);return a.get(p)}return{get:u,update:d,getWireframeAttribute:f}}function I8(i,e,n,r){const s=r.isWebGL2;let a;function l(m){a=m}let u,d;function h(m){u=m.type,d=m.bytesPerElement}function f(m,T){i.drawElements(a,T,u,m*d),n.update(T,a,1)}function p(m,T,E){if(E===0)return;let b,y;if(s)b=i,y="drawElementsInstanced";else if(b=e.get("ANGLE_instanced_arrays"),y="drawElementsInstancedANGLE",b===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}b[y](a,T,u,m*d,E),n.update(T,a,E)}this.setMode=l,this.setIndex=h,this.render=f,this.renderInstances=p}function O8(i){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function r(a,l,u){switch(n.calls++,l){case i.TRIANGLES:n.triangles+=u*(a/3);break;case i.LINES:n.lines+=u*(a/2);break;case i.LINE_STRIP:n.lines+=u*(a-1);break;case i.LINE_LOOP:n.lines+=u*a;break;case i.POINTS:n.points+=u*a;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",l);break}}function s(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:s,update:r}}function L8(i,e){return i[0]-e[0]}function N8(i,e){return Math.abs(e[1])-Math.abs(i[1])}function k8(i,e,n){const r={},s=new Float32Array(8),a=new WeakMap,l=new Hn,u=[];for(let h=0;h<8;h++)u[h]=[h,0];function d(h,f,p){const m=h.morphTargetInfluences;if(e.isWebGL2===!0){const E=f.morphAttributes.position||f.morphAttributes.normal||f.morphAttributes.color,b=E!==void 0?E.length:0;let y=a.get(f);if(y===void 0||y.count!==b){let pe=function(){ae.dispose(),a.delete(f),f.removeEventListener("dispose",pe)};var T=pe;y!==void 0&&y.texture.dispose();const C=f.morphAttributes.position!==void 0,R=f.morphAttributes.normal!==void 0,I=f.morphAttributes.color!==void 0,O=f.morphAttributes.position||[],F=f.morphAttributes.normal||[],k=f.morphAttributes.color||[];let D=0;C===!0&&(D=1),R===!0&&(D=2),I===!0&&(D=3);let U=f.attributes.position.count*D,ce=1;U>e.maxTextureSize&&(ce=Math.ceil(U/e.maxTextureSize),U=e.maxTextureSize);const ie=new Float32Array(U*ce*4*b),ae=new w$(ie,U,ce,b);ae.type=Kr,ae.needsUpdate=!0;const ne=D*4;for(let de=0;de<b;de++){const xe=O[de],H=F[de],J=k[de],K=U*ce*4*de;for(let se=0;se<xe.count;se++){const Y=se*ne;C===!0&&(l.fromBufferAttribute(xe,se),ie[K+Y+0]=l.x,ie[K+Y+1]=l.y,ie[K+Y+2]=l.z,ie[K+Y+3]=0),R===!0&&(l.fromBufferAttribute(H,se),ie[K+Y+4]=l.x,ie[K+Y+5]=l.y,ie[K+Y+6]=l.z,ie[K+Y+7]=0),I===!0&&(l.fromBufferAttribute(J,se),ie[K+Y+8]=l.x,ie[K+Y+9]=l.y,ie[K+Y+10]=l.z,ie[K+Y+11]=J.itemSize===4?l.w:1)}}y={count:b,texture:ae,size:new mt(U,ce)},a.set(f,y),f.addEventListener("dispose",pe)}let S=0;for(let C=0;C<m.length;C++)S+=m[C];const A=f.morphTargetsRelative?1:1-S;p.getUniforms().setValue(i,"morphTargetBaseInfluence",A),p.getUniforms().setValue(i,"morphTargetInfluences",m),p.getUniforms().setValue(i,"morphTargetsTexture",y.texture,n),p.getUniforms().setValue(i,"morphTargetsTextureSize",y.size)}else{const E=m===void 0?0:m.length;let b=r[f.id];if(b===void 0||b.length!==E){b=[];for(let R=0;R<E;R++)b[R]=[R,0];r[f.id]=b}for(let R=0;R<E;R++){const I=b[R];I[0]=R,I[1]=m[R]}b.sort(N8);for(let R=0;R<8;R++)R<E&&b[R][1]?(u[R][0]=b[R][0],u[R][1]=b[R][1]):(u[R][0]=Number.MAX_SAFE_INTEGER,u[R][1]=0);u.sort(L8);const y=f.morphAttributes.position,S=f.morphAttributes.normal;let A=0;for(let R=0;R<8;R++){const I=u[R],O=I[0],F=I[1];O!==Number.MAX_SAFE_INTEGER&&F?(y&&f.getAttribute("morphTarget"+R)!==y[O]&&f.setAttribute("morphTarget"+R,y[O]),S&&f.getAttribute("morphNormal"+R)!==S[O]&&f.setAttribute("morphNormal"+R,S[O]),s[R]=F,A+=F):(y&&f.hasAttribute("morphTarget"+R)===!0&&f.deleteAttribute("morphTarget"+R),S&&f.hasAttribute("morphNormal"+R)===!0&&f.deleteAttribute("morphNormal"+R),s[R]=0)}const C=f.morphTargetsRelative?1:1-A;p.getUniforms().setValue(i,"morphTargetBaseInfluence",C),p.getUniforms().setValue(i,"morphTargetInfluences",s)}}return{update:d}}function P8(i,e,n,r){let s=new WeakMap;function a(d){const h=r.render.frame,f=d.geometry,p=e.get(d,f);return s.get(p)!==h&&(e.update(p),s.set(p,h)),d.isInstancedMesh&&(d.hasEventListener("dispose",u)===!1&&d.addEventListener("dispose",u),n.update(d.instanceMatrix,i.ARRAY_BUFFER),d.instanceColor!==null&&n.update(d.instanceColor,i.ARRAY_BUFFER)),p}function l(){s=new WeakMap}function u(d){const h=d.target;h.removeEventListener("dispose",u),n.remove(h.instanceMatrix),h.instanceColor!==null&&n.remove(h.instanceColor)}return{update:a,dispose:l}}const RF=new ni,wF=new w$,MF=new TM,IF=new SE,ZL=[],qL=[],QL=new Float32Array(16),eN=new Float32Array(9),tN=new Float32Array(4);function e_(i,e,n){const r=i[0];if(r<=0||r>0)return i;const s=e*n;let a=ZL[s];if(a===void 0&&(a=new Float32Array(s),ZL[s]=a),e!==0){r.toArray(a,0);for(let l=1,u=0;l!==e;++l)u+=n,i[l].toArray(a,u)}return a}function Zr(i,e){if(i.length!==e.length)return!1;for(let n=0,r=i.length;n<r;n++)if(i[n]!==e[n])return!1;return!0}function qr(i,e){for(let n=0,r=e.length;n<r;n++)i[n]=e[n]}function I$(i,e){let n=qL[e];n===void 0&&(n=new Int32Array(e),qL[e]=n);for(let r=0;r!==e;++r)n[r]=i.allocateTextureUnit();return n}function D8(i,e){const n=this.cache;n[0]!==e&&(i.uniform1f(this.addr,e),n[0]=e)}function B8(i,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Zr(n,e))return;i.uniform2fv(this.addr,e),qr(n,e)}}function F8(i,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(Zr(n,e))return;i.uniform3fv(this.addr,e),qr(n,e)}}function U8(i,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Zr(n,e))return;i.uniform4fv(this.addr,e),qr(n,e)}}function G8(i,e){const n=this.cache,r=e.elements;if(r===void 0){if(Zr(n,e))return;i.uniformMatrix2fv(this.addr,!1,e),qr(n,e)}else{if(Zr(n,r))return;tN.set(r),i.uniformMatrix2fv(this.addr,!1,tN),qr(n,r)}}function H8(i,e){const n=this.cache,r=e.elements;if(r===void 0){if(Zr(n,e))return;i.uniformMatrix3fv(this.addr,!1,e),qr(n,e)}else{if(Zr(n,r))return;eN.set(r),i.uniformMatrix3fv(this.addr,!1,eN),qr(n,r)}}function V8(i,e){const n=this.cache,r=e.elements;if(r===void 0){if(Zr(n,e))return;i.uniformMatrix4fv(this.addr,!1,e),qr(n,e)}else{if(Zr(n,r))return;QL.set(r),i.uniformMatrix4fv(this.addr,!1,QL),qr(n,r)}}function z8(i,e){const n=this.cache;n[0]!==e&&(i.uniform1i(this.addr,e),n[0]=e)}function W8(i,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Zr(n,e))return;i.uniform2iv(this.addr,e),qr(n,e)}}function X8(i,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Zr(n,e))return;i.uniform3iv(this.addr,e),qr(n,e)}}function j8(i,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Zr(n,e))return;i.uniform4iv(this.addr,e),qr(n,e)}}function Y8(i,e){const n=this.cache;n[0]!==e&&(i.uniform1ui(this.addr,e),n[0]=e)}function K8(i,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(Zr(n,e))return;i.uniform2uiv(this.addr,e),qr(n,e)}}function J8(i,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(Zr(n,e))return;i.uniform3uiv(this.addr,e),qr(n,e)}}function Z8(i,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(Zr(n,e))return;i.uniform4uiv(this.addr,e),qr(n,e)}}function q8(i,e,n){const r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s),n.setTexture2D(e||RF,s)}function Q8(i,e,n){const r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s),n.setTexture3D(e||MF,s)}function e6(i,e,n){const r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s),n.setTextureCube(e||IF,s)}function t6(i,e,n){const r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s),n.setTexture2DArray(e||wF,s)}function n6(i){switch(i){case 5126:return D8;case 35664:return B8;case 35665:return F8;case 35666:return U8;case 35674:return G8;case 35675:return H8;case 35676:return V8;case 5124:case 35670:return z8;case 35667:case 35671:return W8;case 35668:case 35672:return X8;case 35669:case 35673:return j8;case 5125:return Y8;case 36294:return K8;case 36295:return J8;case 36296:return Z8;case 35678:case 36198:case 36298:case 36306:case 35682:return q8;case 35679:case 36299:case 36307:return Q8;case 35680:case 36300:case 36308:case 36293:return e6;case 36289:case 36303:case 36311:case 36292:return t6}}function i6(i,e){i.uniform1fv(this.addr,e)}function r6(i,e){const n=e_(e,this.size,2);i.uniform2fv(this.addr,n)}function s6(i,e){const n=e_(e,this.size,3);i.uniform3fv(this.addr,n)}function o6(i,e){const n=e_(e,this.size,4);i.uniform4fv(this.addr,n)}function a6(i,e){const n=e_(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,n)}function l6(i,e){const n=e_(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,n)}function c6(i,e){const n=e_(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,n)}function u6(i,e){i.uniform1iv(this.addr,e)}function h6(i,e){i.uniform2iv(this.addr,e)}function d6(i,e){i.uniform3iv(this.addr,e)}function f6(i,e){i.uniform4iv(this.addr,e)}function p6(i,e){i.uniform1uiv(this.addr,e)}function m6(i,e){i.uniform2uiv(this.addr,e)}function g6(i,e){i.uniform3uiv(this.addr,e)}function _6(i,e){i.uniform4uiv(this.addr,e)}function v6(i,e,n){const r=this.cache,s=e.length,a=I$(n,s);Zr(r,a)||(i.uniform1iv(this.addr,a),qr(r,a));for(let l=0;l!==s;++l)n.setTexture2D(e[l]||RF,a[l])}function T6(i,e,n){const r=this.cache,s=e.length,a=I$(n,s);Zr(r,a)||(i.uniform1iv(this.addr,a),qr(r,a));for(let l=0;l!==s;++l)n.setTexture3D(e[l]||MF,a[l])}function E6(i,e,n){const r=this.cache,s=e.length,a=I$(n,s);Zr(r,a)||(i.uniform1iv(this.addr,a),qr(r,a));for(let l=0;l!==s;++l)n.setTextureCube(e[l]||IF,a[l])}function y6(i,e,n){const r=this.cache,s=e.length,a=I$(n,s);Zr(r,a)||(i.uniform1iv(this.addr,a),qr(r,a));for(let l=0;l!==s;++l)n.setTexture2DArray(e[l]||wF,a[l])}function S6(i){switch(i){case 5126:return i6;case 35664:return r6;case 35665:return s6;case 35666:return o6;case 35674:return a6;case 35675:return l6;case 35676:return c6;case 5124:case 35670:return u6;case 35667:case 35671:return h6;case 35668:case 35672:return d6;case 35669:case 35673:return f6;case 5125:return p6;case 36294:return m6;case 36295:return g6;case 36296:return _6;case 35678:case 36198:case 36298:case 36306:case 35682:return v6;case 35679:case 36299:case 36307:return T6;case 35680:case 36300:case 36308:case 36293:return E6;case 36289:case 36303:case 36311:case 36292:return y6}}class $6{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.setValue=n6(n.type)}}class b6{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.size=n.size,this.setValue=S6(n.type)}}class A6{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,r){const s=this.seq;for(let a=0,l=s.length;a!==l;++a){const u=s[a];u.setValue(e,n[u.id],r)}}}const SC=/(\w+)(\])?(\[|\.)?/g;function nN(i,e){i.seq.push(e),i.map[e.id]=e}function C6(i,e,n){const r=i.name,s=r.length;for(SC.lastIndex=0;;){const a=SC.exec(r),l=SC.lastIndex;let u=a[1];const d=a[2]==="]",h=a[3];if(d&&(u=u|0),h===void 0||h==="["&&l+2===s){nN(n,h===void 0?new $6(u,i,e):new b6(u,i,e));break}else{let p=n.map[u];p===void 0&&(p=new A6(u),nN(n,p)),n=p}}}class gS{constructor(e,n){this.seq=[],this.map={};const r=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let s=0;s<r;++s){const a=e.getActiveUniform(n,s),l=e.getUniformLocation(n,a.name);C6(a,l,this)}}setValue(e,n,r,s){const a=this.map[n];a!==void 0&&a.setValue(e,r,s)}setOptional(e,n,r){const s=n[r];s!==void 0&&this.setValue(e,r,s)}static upload(e,n,r,s){for(let a=0,l=n.length;a!==l;++a){const u=n[a],d=r[u.id];d.needsUpdate!==!1&&u.setValue(e,d.value,s)}}static seqWithValue(e,n){const r=[];for(let s=0,a=e.length;s!==a;++s){const l=e[s];l.id in n&&r.push(l)}return r}}function iN(i,e,n){const r=i.createShader(e);return i.shaderSource(r,n),i.compileShader(r),r}let x6=0;function R6(i,e){const n=i.split(`
`),r=[],s=Math.max(e-6,0),a=Math.min(e+6,n.length);for(let l=s;l<a;l++){const u=l+1;r.push(`${u===e?">":" "} ${u}: ${n[l]}`)}return r.join(`
`)}function w6(i){switch(i){case Io:return["Linear","( value )"];case Tn:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",i),["Linear","( value )"]}}function rN(i,e,n){const r=i.getShaderParameter(e,i.COMPILE_STATUS),s=i.getShaderInfoLog(e).trim();if(r&&s==="")return"";const a=/ERROR: 0:(\d+)/.exec(s);if(a){const l=parseInt(a[1]);return n.toUpperCase()+`

`+s+`

`+R6(i.getShaderSource(e),l)}else return s}function M6(i,e){const n=w6(e);return"vec4 "+i+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function I6(i,e){let n;switch(e){case qB:n="Linear";break;case QB:n="Reinhard";break;case eF:n="OptimizedCineon";break;case rM:n="ACESFilmic";break;case tF:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+i+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function O6(i){return[i.extensionDerivatives||i.envMapCubeUVHeight||i.bumpMap||i.normalMapTangentSpace||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(gT).join(`
`)}function L6(i){const e=[];for(const n in i){const r=i[n];r!==!1&&e.push("#define "+n+" "+r)}return e.join(`
`)}function N6(i,e){const n={},r=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){const a=i.getActiveAttrib(e,s),l=a.name;let u=1;a.type===i.FLOAT_MAT2&&(u=2),a.type===i.FLOAT_MAT3&&(u=3),a.type===i.FLOAT_MAT4&&(u=4),n[l]={type:a.type,location:i.getAttribLocation(e,l),locationSize:u}}return n}function gT(i){return i!==""}function sN(i,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function oN(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const k6=/^[ \t]*#include +<([\w\d./]+)>/gm;function BR(i){return i.replace(k6,P6)}function P6(i,e){const n=On[e];if(n===void 0)throw new Error("Can not resolve #include <"+e+">");return BR(n)}const D6=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function aN(i){return i.replace(D6,B6)}function B6(i,e,n,r){let s="";for(let a=parseInt(e);a<parseInt(n);a++)s+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return s}function lN(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function F6(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===b$?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===CT?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===xl&&(e="SHADOWMAP_TYPE_VSM"),e}function U6(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case Ou:case ad:e="ENVMAP_TYPE_CUBE";break;case Qg:e="ENVMAP_TYPE_CUBE_UV";break}return e}function G6(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case ad:e="ENVMAP_MODE_REFRACTION";break}return e}function H6(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case _E:e="ENVMAP_BLENDING_MULTIPLY";break;case JB:e="ENVMAP_BLENDING_MIX";break;case ZB:e="ENVMAP_BLENDING_ADD";break}return e}function V6(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),7*16)),texelHeight:r,maxMip:n}}function z6(i,e,n,r){const s=i.getContext(),a=n.defines;let l=n.vertexShader,u=n.fragmentShader;const d=F6(n),h=U6(n),f=G6(n),p=H6(n),m=V6(n),T=n.isWebGL2?"":O6(n),E=L6(a),b=s.createProgram();let y,S,A=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(y=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,E].filter(gT).join(`
`),y.length>0&&(y+=`
`),S=[T,"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,E].filter(gT).join(`
`),S.length>0&&(S+=`
`)):(y=[lN(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,E,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(gT).join(`
`),S=[T,lN(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,E,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+f:"",n.envMap?"#define "+p:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Ll?"#define TONE_MAPPING":"",n.toneMapping!==Ll?On.tonemapping_pars_fragment:"",n.toneMapping!==Ll?I6("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",On.encodings_pars_fragment,M6("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(gT).join(`
`)),l=BR(l),l=sN(l,n),l=oN(l,n),u=BR(u),u=sN(u,n),u=oN(u,n),l=aN(l),u=aN(u),n.isWebGL2&&n.isRawShaderMaterial!==!0&&(A=`#version 300 es
`,y=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,S=["#define varying in",n.glslVersion===kR?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===kR?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+S);const C=A+y+l,R=A+S+u,I=iN(s,s.VERTEX_SHADER,C),O=iN(s,s.FRAGMENT_SHADER,R);if(s.attachShader(b,I),s.attachShader(b,O),n.index0AttributeName!==void 0?s.bindAttribLocation(b,0,n.index0AttributeName):n.morphTargets===!0&&s.bindAttribLocation(b,0,"position"),s.linkProgram(b),i.debug.checkShaderErrors){const D=s.getProgramInfoLog(b).trim(),U=s.getShaderInfoLog(I).trim(),ce=s.getShaderInfoLog(O).trim();let ie=!0,ae=!0;if(s.getProgramParameter(b,s.LINK_STATUS)===!1)if(ie=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(s,b,I,O);else{const ne=rN(s,I,"vertex"),pe=rN(s,O,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(b,s.VALIDATE_STATUS)+`

Program Info Log: `+D+`
`+ne+`
`+pe)}else D!==""?console.warn("THREE.WebGLProgram: Program Info Log:",D):(U===""||ce==="")&&(ae=!1);ae&&(this.diagnostics={runnable:ie,programLog:D,vertexShader:{log:U,prefix:y},fragmentShader:{log:ce,prefix:S}})}s.deleteShader(I),s.deleteShader(O);let F;this.getUniforms=function(){return F===void 0&&(F=new gS(s,b)),F};let k;return this.getAttributes=function(){return k===void 0&&(k=N6(s,b)),k},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(b),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=x6++,this.cacheKey=e,this.usedTimes=1,this.program=b,this.vertexShader=I,this.fragmentShader=O,this}let W6=0;class X6{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,r=e.fragmentShader,s=this._getShaderStage(n),a=this._getShaderStage(r),l=this._getShaderCacheForMaterial(e);return l.has(s)===!1&&(l.add(s),s.usedTimes++),l.has(a)===!1&&(l.add(a),a.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const r of n)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let r=n.get(e);return r===void 0&&(r=new Set,n.set(e,r)),r}_getShaderStage(e){const n=this.shaderCache;let r=n.get(e);return r===void 0&&(r=new j6(e),n.set(e,r)),r}}class j6{constructor(e){this.id=W6++,this.code=e,this.usedTimes=0}}function Y6(i,e,n,r,s,a,l){const u=new op,d=new X6,h=[],f=s.isWebGL2,p=s.logarithmicDepthBuffer,m=s.vertexTextures;let T=s.precision;const E={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function b(D){return D===0?"uv":`uv${D}`}function y(D,U,ce,ie,ae){const ne=ie.fog,pe=ae.geometry,de=D.isMeshStandardMaterial?ie.environment:null,xe=(D.isMeshStandardMaterial?n:e).get(D.envMap||de),H=xe&&xe.mapping===Qg?xe.image.height:null,J=E[D.type];D.precision!==null&&(T=s.getMaxPrecision(D.precision),T!==D.precision&&console.warn("THREE.WebGLProgram.getParameters:",D.precision,"not supported, using",T,"instead."));const K=pe.morphAttributes.position||pe.morphAttributes.normal||pe.morphAttributes.color,se=K!==void 0?K.length:0;let Y=0;pe.morphAttributes.position!==void 0&&(Y=1),pe.morphAttributes.normal!==void 0&&(Y=2),pe.morphAttributes.color!==void 0&&(Y=3);let he,ue,Te,_e;if(J){const We=Ml[J];he=We.vertexShader,ue=We.fragmentShader}else he=D.vertexShader,ue=D.fragmentShader,d.update(D),Te=d.getVertexShaderID(D),_e=d.getFragmentShaderID(D);const Re=i.getRenderTarget(),De=ae.isInstancedMesh===!0,et=!!D.map,Ue=!!D.matcap,Le=!!xe,re=!!D.aoMap,Ye=!!D.lightMap,Fe=!!D.bumpMap,Ze=!!D.normalMap,Xe=!!D.displacementMap,dt=!!D.emissiveMap,je=!!D.metalnessMap,it=!!D.roughnessMap,Ce=D.anisotropy>0,Me=D.clearcoat>0,St=D.iridescence>0,oe=D.sheen>0,ee=D.transmission>0,W=Ce&&!!D.anisotropyMap,ot=Me&&!!D.clearcoatMap,ze=Me&&!!D.clearcoatNormalMap,qe=Me&&!!D.clearcoatRoughnessMap,ut=St&&!!D.iridescenceMap,ft=St&&!!D.iridescenceThicknessMap,Ge=oe&&!!D.sheenColorMap,$t=oe&&!!D.sheenRoughnessMap,L=!!D.specularMap,X=!!D.specularColorMap,fe=!!D.specularIntensityMap,z=ee&&!!D.transmissionMap,Ae=ee&&!!D.thicknessMap,tt=!!D.gradientMap,ye=!!D.alphaMap,Ie=D.alphaTest>0,Be=!!D.extensions,N=!!pe.attributes.uv1,j=!!pe.attributes.uv2,ge=!!pe.attributes.uv3;return{isWebGL2:f,shaderID:J,shaderType:D.type,shaderName:D.name,vertexShader:he,fragmentShader:ue,defines:D.defines,customVertexShaderID:Te,customFragmentShaderID:_e,isRawShaderMaterial:D.isRawShaderMaterial===!0,glslVersion:D.glslVersion,precision:T,instancing:De,instancingColor:De&&ae.instanceColor!==null,supportsVertexTextures:m,outputColorSpace:Re===null?i.outputColorSpace:Re.isXRRenderTarget===!0?Re.texture.colorSpace:Io,map:et,matcap:Ue,envMap:Le,envMapMode:Le&&xe.mapping,envMapCubeUVHeight:H,aoMap:re,lightMap:Ye,bumpMap:Fe,normalMap:Ze,displacementMap:m&&Xe,emissiveMap:dt,normalMapObjectSpace:Ze&&D.normalMapType===dF,normalMapTangentSpace:Ze&&D.normalMapType===md,metalnessMap:je,roughnessMap:it,anisotropy:Ce,anisotropyMap:W,clearcoat:Me,clearcoatMap:ot,clearcoatNormalMap:ze,clearcoatRoughnessMap:qe,iridescence:St,iridescenceMap:ut,iridescenceThicknessMap:ft,sheen:oe,sheenColorMap:Ge,sheenRoughnessMap:$t,specularMap:L,specularColorMap:X,specularIntensityMap:fe,transmission:ee,transmissionMap:z,thicknessMap:Ae,gradientMap:tt,opaque:D.transparent===!1&&D.blending===np,alphaMap:ye,alphaTest:Ie,combine:D.combine,mapUv:et&&b(D.map.channel),aoMapUv:re&&b(D.aoMap.channel),lightMapUv:Ye&&b(D.lightMap.channel),bumpMapUv:Fe&&b(D.bumpMap.channel),normalMapUv:Ze&&b(D.normalMap.channel),displacementMapUv:Xe&&b(D.displacementMap.channel),emissiveMapUv:dt&&b(D.emissiveMap.channel),metalnessMapUv:je&&b(D.metalnessMap.channel),roughnessMapUv:it&&b(D.roughnessMap.channel),anisotropyMapUv:W&&b(D.anisotropyMap.channel),clearcoatMapUv:ot&&b(D.clearcoatMap.channel),clearcoatNormalMapUv:ze&&b(D.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:qe&&b(D.clearcoatRoughnessMap.channel),iridescenceMapUv:ut&&b(D.iridescenceMap.channel),iridescenceThicknessMapUv:ft&&b(D.iridescenceThicknessMap.channel),sheenColorMapUv:Ge&&b(D.sheenColorMap.channel),sheenRoughnessMapUv:$t&&b(D.sheenRoughnessMap.channel),specularMapUv:L&&b(D.specularMap.channel),specularColorMapUv:X&&b(D.specularColorMap.channel),specularIntensityMapUv:fe&&b(D.specularIntensityMap.channel),transmissionMapUv:z&&b(D.transmissionMap.channel),thicknessMapUv:Ae&&b(D.thicknessMap.channel),alphaMapUv:ye&&b(D.alphaMap.channel),vertexTangents:!!pe.attributes.tangent&&(Ze||Ce),vertexColors:D.vertexColors,vertexAlphas:D.vertexColors===!0&&!!pe.attributes.color&&pe.attributes.color.itemSize===4,vertexUv1s:N,vertexUv2s:j,vertexUv3s:ge,pointsUvs:ae.isPoints===!0&&!!pe.attributes.uv&&(et||ye),fog:!!ne,useFog:D.fog===!0,fogExp2:ne&&ne.isFogExp2,flatShading:D.flatShading===!0,sizeAttenuation:D.sizeAttenuation===!0,logarithmicDepthBuffer:p,skinning:ae.isSkinnedMesh===!0,morphTargets:pe.morphAttributes.position!==void 0,morphNormals:pe.morphAttributes.normal!==void 0,morphColors:pe.morphAttributes.color!==void 0,morphTargetsCount:se,morphTextureStride:Y,numDirLights:U.directional.length,numPointLights:U.point.length,numSpotLights:U.spot.length,numSpotLightMaps:U.spotLightMap.length,numRectAreaLights:U.rectArea.length,numHemiLights:U.hemi.length,numDirLightShadows:U.directionalShadowMap.length,numPointLightShadows:U.pointShadowMap.length,numSpotLightShadows:U.spotShadowMap.length,numSpotLightShadowsWithMaps:U.numSpotLightShadowsWithMaps,numClippingPlanes:l.numPlanes,numClipIntersection:l.numIntersection,dithering:D.dithering,shadowMapEnabled:i.shadowMap.enabled&&ce.length>0,shadowMapType:i.shadowMap.type,toneMapping:D.toneMapped?i.toneMapping:Ll,useLegacyLights:i.useLegacyLights,premultipliedAlpha:D.premultipliedAlpha,doubleSided:D.side===Ss,flipSided:D.side===zs,useDepthPacking:D.depthPacking>=0,depthPacking:D.depthPacking||0,index0AttributeName:D.index0AttributeName,extensionDerivatives:Be&&D.extensions.derivatives===!0,extensionFragDepth:Be&&D.extensions.fragDepth===!0,extensionDrawBuffers:Be&&D.extensions.drawBuffers===!0,extensionShaderTextureLOD:Be&&D.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:f||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:f||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:f||r.has("EXT_shader_texture_lod"),customProgramCacheKey:D.customProgramCacheKey()}}function S(D){const U=[];if(D.shaderID?U.push(D.shaderID):(U.push(D.customVertexShaderID),U.push(D.customFragmentShaderID)),D.defines!==void 0)for(const ce in D.defines)U.push(ce),U.push(D.defines[ce]);return D.isRawShaderMaterial===!1&&(A(U,D),C(U,D),U.push(i.outputColorSpace)),U.push(D.customProgramCacheKey),U.join()}function A(D,U){D.push(U.precision),D.push(U.outputColorSpace),D.push(U.envMapMode),D.push(U.envMapCubeUVHeight),D.push(U.mapUv),D.push(U.alphaMapUv),D.push(U.lightMapUv),D.push(U.aoMapUv),D.push(U.bumpMapUv),D.push(U.normalMapUv),D.push(U.displacementMapUv),D.push(U.emissiveMapUv),D.push(U.metalnessMapUv),D.push(U.roughnessMapUv),D.push(U.anisotropyMapUv),D.push(U.clearcoatMapUv),D.push(U.clearcoatNormalMapUv),D.push(U.clearcoatRoughnessMapUv),D.push(U.iridescenceMapUv),D.push(U.iridescenceThicknessMapUv),D.push(U.sheenColorMapUv),D.push(U.sheenRoughnessMapUv),D.push(U.specularMapUv),D.push(U.specularColorMapUv),D.push(U.specularIntensityMapUv),D.push(U.transmissionMapUv),D.push(U.thicknessMapUv),D.push(U.combine),D.push(U.fogExp2),D.push(U.sizeAttenuation),D.push(U.morphTargetsCount),D.push(U.morphAttributeCount),D.push(U.numDirLights),D.push(U.numPointLights),D.push(U.numSpotLights),D.push(U.numSpotLightMaps),D.push(U.numHemiLights),D.push(U.numRectAreaLights),D.push(U.numDirLightShadows),D.push(U.numPointLightShadows),D.push(U.numSpotLightShadows),D.push(U.numSpotLightShadowsWithMaps),D.push(U.shadowMapType),D.push(U.toneMapping),D.push(U.numClippingPlanes),D.push(U.numClipIntersection),D.push(U.depthPacking)}function C(D,U){u.disableAll(),U.isWebGL2&&u.enable(0),U.supportsVertexTextures&&u.enable(1),U.instancing&&u.enable(2),U.instancingColor&&u.enable(3),U.matcap&&u.enable(4),U.envMap&&u.enable(5),U.normalMapObjectSpace&&u.enable(6),U.normalMapTangentSpace&&u.enable(7),U.clearcoat&&u.enable(8),U.iridescence&&u.enable(9),U.alphaTest&&u.enable(10),U.vertexColors&&u.enable(11),U.vertexAlphas&&u.enable(12),U.vertexUv1s&&u.enable(13),U.vertexUv2s&&u.enable(14),U.vertexUv3s&&u.enable(15),U.vertexTangents&&u.enable(16),U.anisotropy&&u.enable(17),D.push(u.mask),u.disableAll(),U.fog&&u.enable(0),U.useFog&&u.enable(1),U.flatShading&&u.enable(2),U.logarithmicDepthBuffer&&u.enable(3),U.skinning&&u.enable(4),U.morphTargets&&u.enable(5),U.morphNormals&&u.enable(6),U.morphColors&&u.enable(7),U.premultipliedAlpha&&u.enable(8),U.shadowMapEnabled&&u.enable(9),U.useLegacyLights&&u.enable(10),U.doubleSided&&u.enable(11),U.flipSided&&u.enable(12),U.useDepthPacking&&u.enable(13),U.dithering&&u.enable(14),U.transmission&&u.enable(15),U.sheen&&u.enable(16),U.opaque&&u.enable(17),U.pointsUvs&&u.enable(18),D.push(u.mask)}function R(D){const U=E[D.type];let ce;if(U){const ie=Ml[U];ce=rE.clone(ie.uniforms)}else ce=D.uniforms;return ce}function I(D,U){let ce;for(let ie=0,ae=h.length;ie<ae;ie++){const ne=h[ie];if(ne.cacheKey===U){ce=ne,++ce.usedTimes;break}}return ce===void 0&&(ce=new z6(i,U,D,a),h.push(ce)),ce}function O(D){if(--D.usedTimes===0){const U=h.indexOf(D);h[U]=h[h.length-1],h.pop(),D.destroy()}}function F(D){d.remove(D)}function k(){d.dispose()}return{getParameters:y,getProgramCacheKey:S,getUniforms:R,acquireProgram:I,releaseProgram:O,releaseShaderCache:F,programs:h,dispose:k}}function K6(){let i=new WeakMap;function e(a){let l=i.get(a);return l===void 0&&(l={},i.set(a,l)),l}function n(a){i.delete(a)}function r(a,l,u){i.get(a)[l]=u}function s(){i=new WeakMap}return{get:e,remove:n,update:r,dispose:s}}function J6(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function cN(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function uN(){const i=[];let e=0;const n=[],r=[],s=[];function a(){e=0,n.length=0,r.length=0,s.length=0}function l(p,m,T,E,b,y){let S=i[e];return S===void 0?(S={id:p.id,object:p,geometry:m,material:T,groupOrder:E,renderOrder:p.renderOrder,z:b,group:y},i[e]=S):(S.id=p.id,S.object=p,S.geometry=m,S.material=T,S.groupOrder=E,S.renderOrder=p.renderOrder,S.z=b,S.group=y),e++,S}function u(p,m,T,E,b,y){const S=l(p,m,T,E,b,y);T.transmission>0?r.push(S):T.transparent===!0?s.push(S):n.push(S)}function d(p,m,T,E,b,y){const S=l(p,m,T,E,b,y);T.transmission>0?r.unshift(S):T.transparent===!0?s.unshift(S):n.unshift(S)}function h(p,m){n.length>1&&n.sort(p||J6),r.length>1&&r.sort(m||cN),s.length>1&&s.sort(m||cN)}function f(){for(let p=e,m=i.length;p<m;p++){const T=i[p];if(T.id===null)break;T.id=null,T.object=null,T.geometry=null,T.material=null,T.group=null}}return{opaque:n,transmissive:r,transparent:s,init:a,push:u,unshift:d,finish:f,sort:h}}function Z6(){let i=new WeakMap;function e(r,s){const a=i.get(r);let l;return a===void 0?(l=new uN,i.set(r,[l])):s>=a.length?(l=new uN,a.push(l)):l=a[s],l}function n(){i=new WeakMap}return{get:e,dispose:n}}function q6(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new te,color:new Ct};break;case"SpotLight":n={position:new te,direction:new te,color:new Ct,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new te,color:new Ct,distance:0,decay:0};break;case"HemisphereLight":n={direction:new te,skyColor:new Ct,groundColor:new Ct};break;case"RectAreaLight":n={color:new Ct,position:new te,halfWidth:new te,halfHeight:new te};break}return i[e.id]=n,n}}}function Q6(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mt};break;case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mt};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mt,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=n,n}}}let eX=0;function tX(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function nX(i,e){const n=new q6,r=Q6(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let f=0;f<9;f++)s.probe.push(new te);const a=new te,l=new pn,u=new pn;function d(f,p){let m=0,T=0,E=0;for(let ce=0;ce<9;ce++)s.probe[ce].set(0,0,0);let b=0,y=0,S=0,A=0,C=0,R=0,I=0,O=0,F=0,k=0;f.sort(tX);const D=p===!0?Math.PI:1;for(let ce=0,ie=f.length;ce<ie;ce++){const ae=f[ce],ne=ae.color,pe=ae.intensity,de=ae.distance,xe=ae.shadow&&ae.shadow.map?ae.shadow.map.texture:null;if(ae.isAmbientLight)m+=ne.r*pe*D,T+=ne.g*pe*D,E+=ne.b*pe*D;else if(ae.isLightProbe)for(let H=0;H<9;H++)s.probe[H].addScaledVector(ae.sh.coefficients[H],pe);else if(ae.isDirectionalLight){const H=n.get(ae);if(H.color.copy(ae.color).multiplyScalar(ae.intensity*D),ae.castShadow){const J=ae.shadow,K=r.get(ae);K.shadowBias=J.bias,K.shadowNormalBias=J.normalBias,K.shadowRadius=J.radius,K.shadowMapSize=J.mapSize,s.directionalShadow[b]=K,s.directionalShadowMap[b]=xe,s.directionalShadowMatrix[b]=ae.shadow.matrix,R++}s.directional[b]=H,b++}else if(ae.isSpotLight){const H=n.get(ae);H.position.setFromMatrixPosition(ae.matrixWorld),H.color.copy(ne).multiplyScalar(pe*D),H.distance=de,H.coneCos=Math.cos(ae.angle),H.penumbraCos=Math.cos(ae.angle*(1-ae.penumbra)),H.decay=ae.decay,s.spot[S]=H;const J=ae.shadow;if(ae.map&&(s.spotLightMap[F]=ae.map,F++,J.updateMatrices(ae),ae.castShadow&&k++),s.spotLightMatrix[S]=J.matrix,ae.castShadow){const K=r.get(ae);K.shadowBias=J.bias,K.shadowNormalBias=J.normalBias,K.shadowRadius=J.radius,K.shadowMapSize=J.mapSize,s.spotShadow[S]=K,s.spotShadowMap[S]=xe,O++}S++}else if(ae.isRectAreaLight){const H=n.get(ae);H.color.copy(ne).multiplyScalar(pe),H.halfWidth.set(ae.width*.5,0,0),H.halfHeight.set(0,ae.height*.5,0),s.rectArea[A]=H,A++}else if(ae.isPointLight){const H=n.get(ae);if(H.color.copy(ae.color).multiplyScalar(ae.intensity*D),H.distance=ae.distance,H.decay=ae.decay,ae.castShadow){const J=ae.shadow,K=r.get(ae);K.shadowBias=J.bias,K.shadowNormalBias=J.normalBias,K.shadowRadius=J.radius,K.shadowMapSize=J.mapSize,K.shadowCameraNear=J.camera.near,K.shadowCameraFar=J.camera.far,s.pointShadow[y]=K,s.pointShadowMap[y]=xe,s.pointShadowMatrix[y]=ae.shadow.matrix,I++}s.point[y]=H,y++}else if(ae.isHemisphereLight){const H=n.get(ae);H.skyColor.copy(ae.color).multiplyScalar(pe*D),H.groundColor.copy(ae.groundColor).multiplyScalar(pe*D),s.hemi[C]=H,C++}}A>0&&(e.isWebGL2||i.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=Lt.LTC_FLOAT_1,s.rectAreaLTC2=Lt.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=Lt.LTC_HALF_1,s.rectAreaLTC2=Lt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=m,s.ambient[1]=T,s.ambient[2]=E;const U=s.hash;(U.directionalLength!==b||U.pointLength!==y||U.spotLength!==S||U.rectAreaLength!==A||U.hemiLength!==C||U.numDirectionalShadows!==R||U.numPointShadows!==I||U.numSpotShadows!==O||U.numSpotMaps!==F)&&(s.directional.length=b,s.spot.length=S,s.rectArea.length=A,s.point.length=y,s.hemi.length=C,s.directionalShadow.length=R,s.directionalShadowMap.length=R,s.pointShadow.length=I,s.pointShadowMap.length=I,s.spotShadow.length=O,s.spotShadowMap.length=O,s.directionalShadowMatrix.length=R,s.pointShadowMatrix.length=I,s.spotLightMatrix.length=O+F-k,s.spotLightMap.length=F,s.numSpotLightShadowsWithMaps=k,U.directionalLength=b,U.pointLength=y,U.spotLength=S,U.rectAreaLength=A,U.hemiLength=C,U.numDirectionalShadows=R,U.numPointShadows=I,U.numSpotShadows=O,U.numSpotMaps=F,s.version=eX++)}function h(f,p){let m=0,T=0,E=0,b=0,y=0;const S=p.matrixWorldInverse;for(let A=0,C=f.length;A<C;A++){const R=f[A];if(R.isDirectionalLight){const I=s.directional[m];I.direction.setFromMatrixPosition(R.matrixWorld),a.setFromMatrixPosition(R.target.matrixWorld),I.direction.sub(a),I.direction.transformDirection(S),m++}else if(R.isSpotLight){const I=s.spot[E];I.position.setFromMatrixPosition(R.matrixWorld),I.position.applyMatrix4(S),I.direction.setFromMatrixPosition(R.matrixWorld),a.setFromMatrixPosition(R.target.matrixWorld),I.direction.sub(a),I.direction.transformDirection(S),E++}else if(R.isRectAreaLight){const I=s.rectArea[b];I.position.setFromMatrixPosition(R.matrixWorld),I.position.applyMatrix4(S),u.identity(),l.copy(R.matrixWorld),l.premultiply(S),u.extractRotation(l),I.halfWidth.set(R.width*.5,0,0),I.halfHeight.set(0,R.height*.5,0),I.halfWidth.applyMatrix4(u),I.halfHeight.applyMatrix4(u),b++}else if(R.isPointLight){const I=s.point[T];I.position.setFromMatrixPosition(R.matrixWorld),I.position.applyMatrix4(S),T++}else if(R.isHemisphereLight){const I=s.hemi[y];I.direction.setFromMatrixPosition(R.matrixWorld),I.direction.transformDirection(S),y++}}}return{setup:d,setupView:h,state:s}}function hN(i,e){const n=new nX(i,e),r=[],s=[];function a(){r.length=0,s.length=0}function l(p){r.push(p)}function u(p){s.push(p)}function d(p){n.setup(r,p)}function h(p){n.setupView(r,p)}return{init:a,state:{lightsArray:r,shadowsArray:s,lights:n},setupLights:d,setupLightsView:h,pushLight:l,pushShadow:u}}function iX(i,e){let n=new WeakMap;function r(a,l=0){const u=n.get(a);let d;return u===void 0?(d=new hN(i,e),n.set(a,[d])):l>=u.length?(d=new hN(i,e),u.push(d)):d=u[l],d}function s(){n=new WeakMap}return{get:r,dispose:s}}class O$ extends rr{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=hF,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class L$ extends rr{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const rX=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,sX=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function oX(i,e,n){let r=new M$;const s=new mt,a=new mt,l=new Hn,u=new O$({depthPacking:mM}),d=new L$,h={},f=n.maxTextureSize,p={[Ya]:zs,[zs]:Ya,[Ss]:Ss},m=new Oo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new mt},radius:{value:4}},vertexShader:rX,fragmentShader:sX}),T=m.clone();T.defines.HORIZONTAL_PASS=1;const E=new rn;E.setAttribute("position",new Qn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new Pn(E,m),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=b$;let S=this.type;this.render=function(I,O,F){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||I.length===0)return;const k=i.getRenderTarget(),D=i.getActiveCubeFace(),U=i.getActiveMipmapLevel(),ce=i.state;ce.setBlending(Cc),ce.buffers.color.setClear(1,1,1,1),ce.buffers.depth.setTest(!0),ce.setScissorTest(!1);const ie=S!==xl&&this.type===xl,ae=S===xl&&this.type!==xl;for(let ne=0,pe=I.length;ne<pe;ne++){const de=I[ne],xe=de.shadow;if(xe===void 0){console.warn("THREE.WebGLShadowMap:",de,"has no shadow.");continue}if(xe.autoUpdate===!1&&xe.needsUpdate===!1)continue;s.copy(xe.mapSize);const H=xe.getFrameExtents();if(s.multiply(H),a.copy(xe.mapSize),(s.x>f||s.y>f)&&(s.x>f&&(a.x=Math.floor(f/H.x),s.x=a.x*H.x,xe.mapSize.x=a.x),s.y>f&&(a.y=Math.floor(f/H.y),s.y=a.y*H.y,xe.mapSize.y=a.y)),xe.map===null||ie===!0||ae===!0){const K=this.type!==xl?{minFilter:tr,magFilter:tr}:{};xe.map!==null&&xe.map.dispose(),xe.map=new da(s.x,s.y,K),xe.map.texture.name=de.name+".shadowMap",xe.camera.updateProjectionMatrix()}i.setRenderTarget(xe.map),i.clear();const J=xe.getViewportCount();for(let K=0;K<J;K++){const se=xe.getViewport(K);l.set(a.x*se.x,a.y*se.y,a.x*se.z,a.y*se.w),ce.viewport(l),xe.updateMatrices(de,K),r=xe.getFrustum(),R(O,F,xe.camera,de,this.type)}xe.isPointLightShadow!==!0&&this.type===xl&&A(xe,F),xe.needsUpdate=!1}S=this.type,y.needsUpdate=!1,i.setRenderTarget(k,D,U)};function A(I,O){const F=e.update(b);m.defines.VSM_SAMPLES!==I.blurSamples&&(m.defines.VSM_SAMPLES=I.blurSamples,T.defines.VSM_SAMPLES=I.blurSamples,m.needsUpdate=!0,T.needsUpdate=!0),I.mapPass===null&&(I.mapPass=new da(s.x,s.y)),m.uniforms.shadow_pass.value=I.map.texture,m.uniforms.resolution.value=I.mapSize,m.uniforms.radius.value=I.radius,i.setRenderTarget(I.mapPass),i.clear(),i.renderBufferDirect(O,null,F,m,b,null),T.uniforms.shadow_pass.value=I.mapPass.texture,T.uniforms.resolution.value=I.mapSize,T.uniforms.radius.value=I.radius,i.setRenderTarget(I.map),i.clear(),i.renderBufferDirect(O,null,F,T,b,null)}function C(I,O,F,k){let D=null;const U=F.isPointLight===!0?I.customDistanceMaterial:I.customDepthMaterial;if(U!==void 0)D=U;else if(D=F.isPointLight===!0?d:u,i.localClippingEnabled&&O.clipShadows===!0&&Array.isArray(O.clippingPlanes)&&O.clippingPlanes.length!==0||O.displacementMap&&O.displacementScale!==0||O.alphaMap&&O.alphaTest>0||O.map&&O.alphaTest>0){const ce=D.uuid,ie=O.uuid;let ae=h[ce];ae===void 0&&(ae={},h[ce]=ae);let ne=ae[ie];ne===void 0&&(ne=D.clone(),ae[ie]=ne),D=ne}if(D.visible=O.visible,D.wireframe=O.wireframe,k===xl?D.side=O.shadowSide!==null?O.shadowSide:O.side:D.side=O.shadowSide!==null?O.shadowSide:p[O.side],D.alphaMap=O.alphaMap,D.alphaTest=O.alphaTest,D.map=O.map,D.clipShadows=O.clipShadows,D.clippingPlanes=O.clippingPlanes,D.clipIntersection=O.clipIntersection,D.displacementMap=O.displacementMap,D.displacementScale=O.displacementScale,D.displacementBias=O.displacementBias,D.wireframeLinewidth=O.wireframeLinewidth,D.linewidth=O.linewidth,F.isPointLight===!0&&D.isMeshDistanceMaterial===!0){const ce=i.properties.get(D);ce.light=F}return D}function R(I,O,F,k,D){if(I.visible===!1)return;if(I.layers.test(O.layers)&&(I.isMesh||I.isLine||I.isPoints)&&(I.castShadow||I.receiveShadow&&D===xl)&&(!I.frustumCulled||r.intersectsObject(I))){I.modelViewMatrix.multiplyMatrices(F.matrixWorldInverse,I.matrixWorld);const ie=e.update(I),ae=I.material;if(Array.isArray(ae)){const ne=ie.groups;for(let pe=0,de=ne.length;pe<de;pe++){const xe=ne[pe],H=ae[xe.materialIndex];if(H&&H.visible){const J=C(I,H,k,D);i.renderBufferDirect(F,null,ie,J,I,xe)}}}else if(ae.visible){const ne=C(I,ae,k,D);i.renderBufferDirect(F,null,ie,ne,I,null)}}const ce=I.children;for(let ie=0,ae=ce.length;ie<ae;ie++)R(ce[ie],O,F,k,D)}}function aX(i,e,n){const r=n.isWebGL2;function s(){let ye=!1;const Ie=new Hn;let Be=null;const N=new Hn(0,0,0,0);return{setMask:function(j){Be!==j&&!ye&&(i.colorMask(j,j,j,j),Be=j)},setLocked:function(j){ye=j},setClear:function(j,ge,we,We,gt){gt===!0&&(j*=We,ge*=We,we*=We),Ie.set(j,ge,we,We),N.equals(Ie)===!1&&(i.clearColor(j,ge,we,We),N.copy(Ie))},reset:function(){ye=!1,Be=null,N.set(-1,0,0,0)}}}function a(){let ye=!1,Ie=null,Be=null,N=null;return{setTest:function(j){j?Re(i.DEPTH_TEST):De(i.DEPTH_TEST)},setMask:function(j){Ie!==j&&!ye&&(i.depthMask(j),Ie=j)},setFunc:function(j){if(Be!==j){switch(j){case VB:i.depthFunc(i.NEVER);break;case zB:i.depthFunc(i.ALWAYS);break;case WB:i.depthFunc(i.LESS);break;case zS:i.depthFunc(i.LEQUAL);break;case XB:i.depthFunc(i.EQUAL);break;case jB:i.depthFunc(i.GEQUAL);break;case YB:i.depthFunc(i.GREATER);break;case KB:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}Be=j}},setLocked:function(j){ye=j},setClear:function(j){N!==j&&(i.clearDepth(j),N=j)},reset:function(){ye=!1,Ie=null,Be=null,N=null}}}function l(){let ye=!1,Ie=null,Be=null,N=null,j=null,ge=null,we=null,We=null,gt=null;return{setTest:function(bt){ye||(bt?Re(i.STENCIL_TEST):De(i.STENCIL_TEST))},setMask:function(bt){Ie!==bt&&!ye&&(i.stencilMask(bt),Ie=bt)},setFunc:function(bt,un,an){(Be!==bt||N!==un||j!==an)&&(i.stencilFunc(bt,un,an),Be=bt,N=un,j=an)},setOp:function(bt,un,an){(ge!==bt||we!==un||We!==an)&&(i.stencilOp(bt,un,an),ge=bt,we=un,We=an)},setLocked:function(bt){ye=bt},setClear:function(bt){gt!==bt&&(i.clearStencil(bt),gt=bt)},reset:function(){ye=!1,Ie=null,Be=null,N=null,j=null,ge=null,we=null,We=null,gt=null}}}const u=new s,d=new a,h=new l,f=new WeakMap,p=new WeakMap;let m={},T={},E=new WeakMap,b=[],y=null,S=!1,A=null,C=null,R=null,I=null,O=null,F=null,k=null,D=!1,U=null,ce=null,ie=null,ae=null,ne=null;const pe=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let de=!1,xe=0;const H=i.getParameter(i.VERSION);H.indexOf("WebGL")!==-1?(xe=parseFloat(/^WebGL (\d)/.exec(H)[1]),de=xe>=1):H.indexOf("OpenGL ES")!==-1&&(xe=parseFloat(/^OpenGL ES (\d)/.exec(H)[1]),de=xe>=2);let J=null,K={};const se=i.getParameter(i.SCISSOR_BOX),Y=i.getParameter(i.VIEWPORT),he=new Hn().fromArray(se),ue=new Hn().fromArray(Y);function Te(ye,Ie,Be,N){const j=new Uint8Array(4),ge=i.createTexture();i.bindTexture(ye,ge),i.texParameteri(ye,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(ye,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let we=0;we<Be;we++)r&&(ye===i.TEXTURE_3D||ye===i.TEXTURE_2D_ARRAY)?i.texImage3D(Ie,0,i.RGBA,1,1,N,0,i.RGBA,i.UNSIGNED_BYTE,j):i.texImage2D(Ie+we,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,j);return ge}const _e={};_e[i.TEXTURE_2D]=Te(i.TEXTURE_2D,i.TEXTURE_2D,1),_e[i.TEXTURE_CUBE_MAP]=Te(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(_e[i.TEXTURE_2D_ARRAY]=Te(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),_e[i.TEXTURE_3D]=Te(i.TEXTURE_3D,i.TEXTURE_3D,1,1)),u.setClear(0,0,0,1),d.setClear(1),h.setClear(0),Re(i.DEPTH_TEST),d.setFunc(zS),Xe(!1),dt(sR),Re(i.CULL_FACE),Fe(Cc);function Re(ye){m[ye]!==!0&&(i.enable(ye),m[ye]=!0)}function De(ye){m[ye]!==!1&&(i.disable(ye),m[ye]=!1)}function et(ye,Ie){return T[ye]!==Ie?(i.bindFramebuffer(ye,Ie),T[ye]=Ie,r&&(ye===i.DRAW_FRAMEBUFFER&&(T[i.FRAMEBUFFER]=Ie),ye===i.FRAMEBUFFER&&(T[i.DRAW_FRAMEBUFFER]=Ie)),!0):!1}function Ue(ye,Ie){let Be=b,N=!1;if(ye)if(Be=E.get(Ie),Be===void 0&&(Be=[],E.set(Ie,Be)),ye.isWebGLMultipleRenderTargets){const j=ye.texture;if(Be.length!==j.length||Be[0]!==i.COLOR_ATTACHMENT0){for(let ge=0,we=j.length;ge<we;ge++)Be[ge]=i.COLOR_ATTACHMENT0+ge;Be.length=j.length,N=!0}}else Be[0]!==i.COLOR_ATTACHMENT0&&(Be[0]=i.COLOR_ATTACHMENT0,N=!0);else Be[0]!==i.BACK&&(Be[0]=i.BACK,N=!0);N&&(n.isWebGL2?i.drawBuffers(Be):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Be))}function Le(ye){return y!==ye?(i.useProgram(ye),y=ye,!0):!1}const re={[Uf]:i.FUNC_ADD,[OB]:i.FUNC_SUBTRACT,[LB]:i.FUNC_REVERSE_SUBTRACT};if(r)re[cR]=i.MIN,re[uR]=i.MAX;else{const ye=e.get("EXT_blend_minmax");ye!==null&&(re[cR]=ye.MIN_EXT,re[uR]=ye.MAX_EXT)}const Ye={[NB]:i.ZERO,[kB]:i.ONE,[PB]:i.SRC_COLOR,[nM]:i.SRC_ALPHA,[HB]:i.SRC_ALPHA_SATURATE,[UB]:i.DST_COLOR,[BB]:i.DST_ALPHA,[DB]:i.ONE_MINUS_SRC_COLOR,[iM]:i.ONE_MINUS_SRC_ALPHA,[GB]:i.ONE_MINUS_DST_COLOR,[FB]:i.ONE_MINUS_DST_ALPHA};function Fe(ye,Ie,Be,N,j,ge,we,We){if(ye===Cc){S===!0&&(De(i.BLEND),S=!1);return}if(S===!1&&(Re(i.BLEND),S=!0),ye!==IB){if(ye!==A||We!==D){if((C!==Uf||O!==Uf)&&(i.blendEquation(i.FUNC_ADD),C=Uf,O=Uf),We)switch(ye){case np:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case oR:i.blendFunc(i.ONE,i.ONE);break;case aR:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case lR:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ye);break}else switch(ye){case np:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case oR:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case aR:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case lR:i.blendFunc(i.ZERO,i.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ye);break}R=null,I=null,F=null,k=null,A=ye,D=We}return}j=j||Ie,ge=ge||Be,we=we||N,(Ie!==C||j!==O)&&(i.blendEquationSeparate(re[Ie],re[j]),C=Ie,O=j),(Be!==R||N!==I||ge!==F||we!==k)&&(i.blendFuncSeparate(Ye[Be],Ye[N],Ye[ge],Ye[we]),R=Be,I=N,F=ge,k=we),A=ye,D=!1}function Ze(ye,Ie){ye.side===Ss?De(i.CULL_FACE):Re(i.CULL_FACE);let Be=ye.side===zs;Ie&&(Be=!Be),Xe(Be),ye.blending===np&&ye.transparent===!1?Fe(Cc):Fe(ye.blending,ye.blendEquation,ye.blendSrc,ye.blendDst,ye.blendEquationAlpha,ye.blendSrcAlpha,ye.blendDstAlpha,ye.premultipliedAlpha),d.setFunc(ye.depthFunc),d.setTest(ye.depthTest),d.setMask(ye.depthWrite),u.setMask(ye.colorWrite);const N=ye.stencilWrite;h.setTest(N),N&&(h.setMask(ye.stencilWriteMask),h.setFunc(ye.stencilFunc,ye.stencilRef,ye.stencilFuncMask),h.setOp(ye.stencilFail,ye.stencilZFail,ye.stencilZPass)),it(ye.polygonOffset,ye.polygonOffsetFactor,ye.polygonOffsetUnits),ye.alphaToCoverage===!0?Re(i.SAMPLE_ALPHA_TO_COVERAGE):De(i.SAMPLE_ALPHA_TO_COVERAGE)}function Xe(ye){U!==ye&&(ye?i.frontFace(i.CW):i.frontFace(i.CCW),U=ye)}function dt(ye){ye!==RB?(Re(i.CULL_FACE),ye!==ce&&(ye===sR?i.cullFace(i.BACK):ye===wB?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):De(i.CULL_FACE),ce=ye}function je(ye){ye!==ie&&(de&&i.lineWidth(ye),ie=ye)}function it(ye,Ie,Be){ye?(Re(i.POLYGON_OFFSET_FILL),(ae!==Ie||ne!==Be)&&(i.polygonOffset(Ie,Be),ae=Ie,ne=Be)):De(i.POLYGON_OFFSET_FILL)}function Ce(ye){ye?Re(i.SCISSOR_TEST):De(i.SCISSOR_TEST)}function Me(ye){ye===void 0&&(ye=i.TEXTURE0+pe-1),J!==ye&&(i.activeTexture(ye),J=ye)}function St(ye,Ie,Be){Be===void 0&&(J===null?Be=i.TEXTURE0+pe-1:Be=J);let N=K[Be];N===void 0&&(N={type:void 0,texture:void 0},K[Be]=N),(N.type!==ye||N.texture!==Ie)&&(J!==Be&&(i.activeTexture(Be),J=Be),i.bindTexture(ye,Ie||_e[ye]),N.type=ye,N.texture=Ie)}function oe(){const ye=K[J];ye!==void 0&&ye.type!==void 0&&(i.bindTexture(ye.type,null),ye.type=void 0,ye.texture=void 0)}function ee(){try{i.compressedTexImage2D.apply(i,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}}function W(){try{i.compressedTexImage3D.apply(i,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}}function ot(){try{i.texSubImage2D.apply(i,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}}function ze(){try{i.texSubImage3D.apply(i,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}}function qe(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}}function ut(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}}function ft(){try{i.texStorage2D.apply(i,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}}function Ge(){try{i.texStorage3D.apply(i,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}}function $t(){try{i.texImage2D.apply(i,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}}function L(){try{i.texImage3D.apply(i,arguments)}catch(ye){console.error("THREE.WebGLState:",ye)}}function X(ye){he.equals(ye)===!1&&(i.scissor(ye.x,ye.y,ye.z,ye.w),he.copy(ye))}function fe(ye){ue.equals(ye)===!1&&(i.viewport(ye.x,ye.y,ye.z,ye.w),ue.copy(ye))}function z(ye,Ie){let Be=p.get(Ie);Be===void 0&&(Be=new WeakMap,p.set(Ie,Be));let N=Be.get(ye);N===void 0&&(N=i.getUniformBlockIndex(Ie,ye.name),Be.set(ye,N))}function Ae(ye,Ie){const N=p.get(Ie).get(ye);f.get(Ie)!==N&&(i.uniformBlockBinding(Ie,N,ye.__bindingPointIndex),f.set(Ie,N))}function tt(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),r===!0&&(i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),m={},J=null,K={},T={},E=new WeakMap,b=[],y=null,S=!1,A=null,C=null,R=null,I=null,O=null,F=null,k=null,D=!1,U=null,ce=null,ie=null,ae=null,ne=null,he.set(0,0,i.canvas.width,i.canvas.height),ue.set(0,0,i.canvas.width,i.canvas.height),u.reset(),d.reset(),h.reset()}return{buffers:{color:u,depth:d,stencil:h},enable:Re,disable:De,bindFramebuffer:et,drawBuffers:Ue,useProgram:Le,setBlending:Fe,setMaterial:Ze,setFlipSided:Xe,setCullFace:dt,setLineWidth:je,setPolygonOffset:it,setScissorTest:Ce,activeTexture:Me,bindTexture:St,unbindTexture:oe,compressedTexImage2D:ee,compressedTexImage3D:W,texImage2D:$t,texImage3D:L,updateUBOMapping:z,uniformBlockBinding:Ae,texStorage2D:ft,texStorage3D:Ge,texSubImage2D:ot,texSubImage3D:ze,compressedTexSubImage2D:qe,compressedTexSubImage3D:ut,scissor:X,viewport:fe,reset:tt}}function lX(i,e,n,r,s,a,l){const u=s.isWebGL2,d=s.maxTextures,h=s.maxCubemapSize,f=s.maxTextureSize,p=s.maxSamples,m=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,T=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),E=new WeakMap;let b;const y=new WeakMap;let S=!1;try{S=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function A(oe,ee){return S?new OffscreenCanvas(oe,ee):iE("canvas")}function C(oe,ee,W,ot){let ze=1;if((oe.width>ot||oe.height>ot)&&(ze=ot/Math.max(oe.width,oe.height)),ze<1||ee===!0)if(typeof HTMLImageElement<"u"&&oe instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&oe instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&oe instanceof ImageBitmap){const qe=ee?XS:Math.floor,ut=qe(ze*oe.width),ft=qe(ze*oe.height);b===void 0&&(b=A(ut,ft));const Ge=W?A(ut,ft):b;return Ge.width=ut,Ge.height=ft,Ge.getContext("2d").drawImage(oe,0,0,ut,ft),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+oe.width+"x"+oe.height+") to ("+ut+"x"+ft+")."),Ge}else return"data"in oe&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+oe.width+"x"+oe.height+")."),oe;return oe}function R(oe){return PR(oe.width)&&PR(oe.height)}function I(oe){return u?!1:oe.wrapS!==Pi||oe.wrapT!==Pi||oe.minFilter!==tr&&oe.minFilter!==Gn}function O(oe,ee){return oe.generateMipmaps&&ee&&oe.minFilter!==tr&&oe.minFilter!==Gn}function F(oe){i.generateMipmap(oe)}function k(oe,ee,W,ot,ze=!1){if(u===!1)return ee;if(oe!==null){if(i[oe]!==void 0)return i[oe];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+oe+"'")}let qe=ee;return ee===i.RED&&(W===i.FLOAT&&(qe=i.R32F),W===i.HALF_FLOAT&&(qe=i.R16F),W===i.UNSIGNED_BYTE&&(qe=i.R8)),ee===i.RG&&(W===i.FLOAT&&(qe=i.RG32F),W===i.HALF_FLOAT&&(qe=i.RG16F),W===i.UNSIGNED_BYTE&&(qe=i.RG8)),ee===i.RGBA&&(W===i.FLOAT&&(qe=i.RGBA32F),W===i.HALF_FLOAT&&(qe=i.RGBA16F),W===i.UNSIGNED_BYTE&&(qe=ot===Tn&&ze===!1?i.SRGB8_ALPHA8:i.RGBA8),W===i.UNSIGNED_SHORT_4_4_4_4&&(qe=i.RGBA4),W===i.UNSIGNED_SHORT_5_5_5_1&&(qe=i.RGB5_A1)),(qe===i.R16F||qe===i.R32F||qe===i.RG16F||qe===i.RG32F||qe===i.RGBA16F||qe===i.RGBA32F)&&e.get("EXT_color_buffer_float"),qe}function D(oe,ee,W){return O(oe,W)===!0||oe.isFramebufferTexture&&oe.minFilter!==tr&&oe.minFilter!==Gn?Math.log2(Math.max(ee.width,ee.height))+1:oe.mipmaps!==void 0&&oe.mipmaps.length>0?oe.mipmaps.length:oe.isCompressedTexture&&Array.isArray(oe.image)?ee.mipmaps.length:1}function U(oe){return oe===tr||oe===zg||oe===ip?i.NEAREST:i.LINEAR}function ce(oe){const ee=oe.target;ee.removeEventListener("dispose",ce),ae(ee),ee.isVideoTexture&&E.delete(ee)}function ie(oe){const ee=oe.target;ee.removeEventListener("dispose",ie),pe(ee)}function ae(oe){const ee=r.get(oe);if(ee.__webglInit===void 0)return;const W=oe.source,ot=y.get(W);if(ot){const ze=ot[ee.__cacheKey];ze.usedTimes--,ze.usedTimes===0&&ne(oe),Object.keys(ot).length===0&&y.delete(W)}r.remove(oe)}function ne(oe){const ee=r.get(oe);i.deleteTexture(ee.__webglTexture);const W=oe.source,ot=y.get(W);delete ot[ee.__cacheKey],l.memory.textures--}function pe(oe){const ee=oe.texture,W=r.get(oe),ot=r.get(ee);if(ot.__webglTexture!==void 0&&(i.deleteTexture(ot.__webglTexture),l.memory.textures--),oe.depthTexture&&oe.depthTexture.dispose(),oe.isWebGLCubeRenderTarget)for(let ze=0;ze<6;ze++)i.deleteFramebuffer(W.__webglFramebuffer[ze]),W.__webglDepthbuffer&&i.deleteRenderbuffer(W.__webglDepthbuffer[ze]);else{if(i.deleteFramebuffer(W.__webglFramebuffer),W.__webglDepthbuffer&&i.deleteRenderbuffer(W.__webglDepthbuffer),W.__webglMultisampledFramebuffer&&i.deleteFramebuffer(W.__webglMultisampledFramebuffer),W.__webglColorRenderbuffer)for(let ze=0;ze<W.__webglColorRenderbuffer.length;ze++)W.__webglColorRenderbuffer[ze]&&i.deleteRenderbuffer(W.__webglColorRenderbuffer[ze]);W.__webglDepthRenderbuffer&&i.deleteRenderbuffer(W.__webglDepthRenderbuffer)}if(oe.isWebGLMultipleRenderTargets)for(let ze=0,qe=ee.length;ze<qe;ze++){const ut=r.get(ee[ze]);ut.__webglTexture&&(i.deleteTexture(ut.__webglTexture),l.memory.textures--),r.remove(ee[ze])}r.remove(ee),r.remove(oe)}let de=0;function xe(){de=0}function H(){const oe=de;return oe>=d&&console.warn("THREE.WebGLTextures: Trying to use "+oe+" texture units while this GPU supports only "+d),de+=1,oe}function J(oe){const ee=[];return ee.push(oe.wrapS),ee.push(oe.wrapT),ee.push(oe.wrapR||0),ee.push(oe.magFilter),ee.push(oe.minFilter),ee.push(oe.anisotropy),ee.push(oe.internalFormat),ee.push(oe.format),ee.push(oe.type),ee.push(oe.generateMipmaps),ee.push(oe.premultiplyAlpha),ee.push(oe.flipY),ee.push(oe.unpackAlignment),ee.push(oe.colorSpace),ee.join()}function K(oe,ee){const W=r.get(oe);if(oe.isVideoTexture&&Me(oe),oe.isRenderTargetTexture===!1&&oe.version>0&&W.__version!==oe.version){const ot=oe.image;if(ot===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ot.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{et(W,oe,ee);return}}n.bindTexture(i.TEXTURE_2D,W.__webglTexture,i.TEXTURE0+ee)}function se(oe,ee){const W=r.get(oe);if(oe.version>0&&W.__version!==oe.version){et(W,oe,ee);return}n.bindTexture(i.TEXTURE_2D_ARRAY,W.__webglTexture,i.TEXTURE0+ee)}function Y(oe,ee){const W=r.get(oe);if(oe.version>0&&W.__version!==oe.version){et(W,oe,ee);return}n.bindTexture(i.TEXTURE_3D,W.__webglTexture,i.TEXTURE0+ee)}function he(oe,ee){const W=r.get(oe);if(oe.version>0&&W.__version!==oe.version){Ue(W,oe,ee);return}n.bindTexture(i.TEXTURE_CUBE_MAP,W.__webglTexture,i.TEXTURE0+ee)}const ue={[Pl]:i.REPEAT,[Pi]:i.CLAMP_TO_EDGE,[Ep]:i.MIRRORED_REPEAT},Te={[tr]:i.NEAREST,[zg]:i.NEAREST_MIPMAP_NEAREST,[ip]:i.NEAREST_MIPMAP_LINEAR,[Gn]:i.LINEAR,[vE]:i.LINEAR_MIPMAP_NEAREST,[Ka]:i.LINEAR_MIPMAP_LINEAR},_e={[pF]:i.NEVER,[yF]:i.ALWAYS,[mF]:i.LESS,[_F]:i.LEQUAL,[gF]:i.EQUAL,[EF]:i.GEQUAL,[vF]:i.GREATER,[TF]:i.NOTEQUAL};function Re(oe,ee,W){if(W?(i.texParameteri(oe,i.TEXTURE_WRAP_S,ue[ee.wrapS]),i.texParameteri(oe,i.TEXTURE_WRAP_T,ue[ee.wrapT]),(oe===i.TEXTURE_3D||oe===i.TEXTURE_2D_ARRAY)&&i.texParameteri(oe,i.TEXTURE_WRAP_R,ue[ee.wrapR]),i.texParameteri(oe,i.TEXTURE_MAG_FILTER,Te[ee.magFilter]),i.texParameteri(oe,i.TEXTURE_MIN_FILTER,Te[ee.minFilter])):(i.texParameteri(oe,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(oe,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),(oe===i.TEXTURE_3D||oe===i.TEXTURE_2D_ARRAY)&&i.texParameteri(oe,i.TEXTURE_WRAP_R,i.CLAMP_TO_EDGE),(ee.wrapS!==Pi||ee.wrapT!==Pi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(oe,i.TEXTURE_MAG_FILTER,U(ee.magFilter)),i.texParameteri(oe,i.TEXTURE_MIN_FILTER,U(ee.minFilter)),ee.minFilter!==tr&&ee.minFilter!==Gn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),ee.compareFunction&&(i.texParameteri(oe,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(oe,i.TEXTURE_COMPARE_FUNC,_e[ee.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const ot=e.get("EXT_texture_filter_anisotropic");if(ee.magFilter===tr||ee.minFilter!==ip&&ee.minFilter!==Ka||ee.type===Kr&&e.has("OES_texture_float_linear")===!1||u===!1&&ee.type===ss&&e.has("OES_texture_half_float_linear")===!1)return;(ee.anisotropy>1||r.get(ee).__currentAnisotropy)&&(i.texParameterf(oe,ot.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ee.anisotropy,s.getMaxAnisotropy())),r.get(ee).__currentAnisotropy=ee.anisotropy)}}function De(oe,ee){let W=!1;oe.__webglInit===void 0&&(oe.__webglInit=!0,ee.addEventListener("dispose",ce));const ot=ee.source;let ze=y.get(ot);ze===void 0&&(ze={},y.set(ot,ze));const qe=J(ee);if(qe!==oe.__cacheKey){ze[qe]===void 0&&(ze[qe]={texture:i.createTexture(),usedTimes:0},l.memory.textures++,W=!0),ze[qe].usedTimes++;const ut=ze[oe.__cacheKey];ut!==void 0&&(ze[oe.__cacheKey].usedTimes--,ut.usedTimes===0&&ne(ee)),oe.__cacheKey=qe,oe.__webglTexture=ze[qe].texture}return W}function et(oe,ee,W){let ot=i.TEXTURE_2D;(ee.isDataArrayTexture||ee.isCompressedArrayTexture)&&(ot=i.TEXTURE_2D_ARRAY),ee.isData3DTexture&&(ot=i.TEXTURE_3D);const ze=De(oe,ee),qe=ee.source;n.bindTexture(ot,oe.__webglTexture,i.TEXTURE0+W);const ut=r.get(qe);if(qe.version!==ut.__version||ze===!0){n.activeTexture(i.TEXTURE0+W),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,ee.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ee.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,ee.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE);const ft=I(ee)&&R(ee.image)===!1;let Ge=C(ee.image,ft,!1,f);Ge=St(ee,Ge);const $t=R(Ge)||u,L=a.convert(ee.format,ee.colorSpace);let X=a.convert(ee.type),fe=k(ee.internalFormat,L,X,ee.colorSpace);Re(ot,ee,$t);let z;const Ae=ee.mipmaps,tt=u&&ee.isVideoTexture!==!0,ye=ut.__version===void 0||ze===!0,Ie=D(ee,Ge,$t);if(ee.isDepthTexture)fe=i.DEPTH_COMPONENT,u?ee.type===Kr?fe=i.DEPTH_COMPONENT32F:ee.type===Sc?fe=i.DEPTH_COMPONENT24:ee.type===td?fe=i.DEPTH24_STENCIL8:fe=i.DEPTH_COMPONENT16:ee.type===Kr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),ee.format===nd&&fe===i.DEPTH_COMPONENT&&ee.type!==A$&&ee.type!==Sc&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),ee.type=Sc,X=a.convert(ee.type)),ee.format===yp&&fe===i.DEPTH_COMPONENT&&(fe=i.DEPTH_STENCIL,ee.type!==td&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),ee.type=td,X=a.convert(ee.type))),ye&&(tt?n.texStorage2D(i.TEXTURE_2D,1,fe,Ge.width,Ge.height):n.texImage2D(i.TEXTURE_2D,0,fe,Ge.width,Ge.height,0,L,X,null));else if(ee.isDataTexture)if(Ae.length>0&&$t){tt&&ye&&n.texStorage2D(i.TEXTURE_2D,Ie,fe,Ae[0].width,Ae[0].height);for(let Be=0,N=Ae.length;Be<N;Be++)z=Ae[Be],tt?n.texSubImage2D(i.TEXTURE_2D,Be,0,0,z.width,z.height,L,X,z.data):n.texImage2D(i.TEXTURE_2D,Be,fe,z.width,z.height,0,L,X,z.data);ee.generateMipmaps=!1}else tt?(ye&&n.texStorage2D(i.TEXTURE_2D,Ie,fe,Ge.width,Ge.height),n.texSubImage2D(i.TEXTURE_2D,0,0,0,Ge.width,Ge.height,L,X,Ge.data)):n.texImage2D(i.TEXTURE_2D,0,fe,Ge.width,Ge.height,0,L,X,Ge.data);else if(ee.isCompressedTexture)if(ee.isCompressedArrayTexture){tt&&ye&&n.texStorage3D(i.TEXTURE_2D_ARRAY,Ie,fe,Ae[0].width,Ae[0].height,Ge.depth);for(let Be=0,N=Ae.length;Be<N;Be++)z=Ae[Be],ee.format!==jr?L!==null?tt?n.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,Be,0,0,0,z.width,z.height,Ge.depth,L,z.data,0,0):n.compressedTexImage3D(i.TEXTURE_2D_ARRAY,Be,fe,z.width,z.height,Ge.depth,0,z.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):tt?n.texSubImage3D(i.TEXTURE_2D_ARRAY,Be,0,0,0,z.width,z.height,Ge.depth,L,X,z.data):n.texImage3D(i.TEXTURE_2D_ARRAY,Be,fe,z.width,z.height,Ge.depth,0,L,X,z.data)}else{tt&&ye&&n.texStorage2D(i.TEXTURE_2D,Ie,fe,Ae[0].width,Ae[0].height);for(let Be=0,N=Ae.length;Be<N;Be++)z=Ae[Be],ee.format!==jr?L!==null?tt?n.compressedTexSubImage2D(i.TEXTURE_2D,Be,0,0,z.width,z.height,L,z.data):n.compressedTexImage2D(i.TEXTURE_2D,Be,fe,z.width,z.height,0,z.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):tt?n.texSubImage2D(i.TEXTURE_2D,Be,0,0,z.width,z.height,L,X,z.data):n.texImage2D(i.TEXTURE_2D,Be,fe,z.width,z.height,0,L,X,z.data)}else if(ee.isDataArrayTexture)tt?(ye&&n.texStorage3D(i.TEXTURE_2D_ARRAY,Ie,fe,Ge.width,Ge.height,Ge.depth),n.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,Ge.width,Ge.height,Ge.depth,L,X,Ge.data)):n.texImage3D(i.TEXTURE_2D_ARRAY,0,fe,Ge.width,Ge.height,Ge.depth,0,L,X,Ge.data);else if(ee.isData3DTexture)tt?(ye&&n.texStorage3D(i.TEXTURE_3D,Ie,fe,Ge.width,Ge.height,Ge.depth),n.texSubImage3D(i.TEXTURE_3D,0,0,0,0,Ge.width,Ge.height,Ge.depth,L,X,Ge.data)):n.texImage3D(i.TEXTURE_3D,0,fe,Ge.width,Ge.height,Ge.depth,0,L,X,Ge.data);else if(ee.isFramebufferTexture){if(ye)if(tt)n.texStorage2D(i.TEXTURE_2D,Ie,fe,Ge.width,Ge.height);else{let Be=Ge.width,N=Ge.height;for(let j=0;j<Ie;j++)n.texImage2D(i.TEXTURE_2D,j,fe,Be,N,0,L,X,null),Be>>=1,N>>=1}}else if(Ae.length>0&&$t){tt&&ye&&n.texStorage2D(i.TEXTURE_2D,Ie,fe,Ae[0].width,Ae[0].height);for(let Be=0,N=Ae.length;Be<N;Be++)z=Ae[Be],tt?n.texSubImage2D(i.TEXTURE_2D,Be,0,0,L,X,z):n.texImage2D(i.TEXTURE_2D,Be,fe,L,X,z);ee.generateMipmaps=!1}else tt?(ye&&n.texStorage2D(i.TEXTURE_2D,Ie,fe,Ge.width,Ge.height),n.texSubImage2D(i.TEXTURE_2D,0,0,0,L,X,Ge)):n.texImage2D(i.TEXTURE_2D,0,fe,L,X,Ge);O(ee,$t)&&F(ot),ut.__version=qe.version,ee.onUpdate&&ee.onUpdate(ee)}oe.__version=ee.version}function Ue(oe,ee,W){if(ee.image.length!==6)return;const ot=De(oe,ee),ze=ee.source;n.bindTexture(i.TEXTURE_CUBE_MAP,oe.__webglTexture,i.TEXTURE0+W);const qe=r.get(ze);if(ze.version!==qe.__version||ot===!0){n.activeTexture(i.TEXTURE0+W),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,ee.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ee.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,ee.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE);const ut=ee.isCompressedTexture||ee.image[0].isCompressedTexture,ft=ee.image[0]&&ee.image[0].isDataTexture,Ge=[];for(let Be=0;Be<6;Be++)!ut&&!ft?Ge[Be]=C(ee.image[Be],!1,!0,h):Ge[Be]=ft?ee.image[Be].image:ee.image[Be],Ge[Be]=St(ee,Ge[Be]);const $t=Ge[0],L=R($t)||u,X=a.convert(ee.format,ee.colorSpace),fe=a.convert(ee.type),z=k(ee.internalFormat,X,fe,ee.colorSpace),Ae=u&&ee.isVideoTexture!==!0,tt=qe.__version===void 0||ot===!0;let ye=D(ee,$t,L);Re(i.TEXTURE_CUBE_MAP,ee,L);let Ie;if(ut){Ae&&tt&&n.texStorage2D(i.TEXTURE_CUBE_MAP,ye,z,$t.width,$t.height);for(let Be=0;Be<6;Be++){Ie=Ge[Be].mipmaps;for(let N=0;N<Ie.length;N++){const j=Ie[N];ee.format!==jr?X!==null?Ae?n.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,N,0,0,j.width,j.height,X,j.data):n.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,N,z,j.width,j.height,0,j.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ae?n.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,N,0,0,j.width,j.height,X,fe,j.data):n.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,N,z,j.width,j.height,0,X,fe,j.data)}}}else{Ie=ee.mipmaps,Ae&&tt&&(Ie.length>0&&ye++,n.texStorage2D(i.TEXTURE_CUBE_MAP,ye,z,Ge[0].width,Ge[0].height));for(let Be=0;Be<6;Be++)if(ft){Ae?n.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,0,0,0,Ge[Be].width,Ge[Be].height,X,fe,Ge[Be].data):n.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,0,z,Ge[Be].width,Ge[Be].height,0,X,fe,Ge[Be].data);for(let N=0;N<Ie.length;N++){const ge=Ie[N].image[Be].image;Ae?n.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,N+1,0,0,ge.width,ge.height,X,fe,ge.data):n.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,N+1,z,ge.width,ge.height,0,X,fe,ge.data)}}else{Ae?n.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,0,0,0,X,fe,Ge[Be]):n.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,0,z,X,fe,Ge[Be]);for(let N=0;N<Ie.length;N++){const j=Ie[N];Ae?n.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,N+1,0,0,X,fe,j.image[Be]):n.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Be,N+1,z,X,fe,j.image[Be])}}}O(ee,L)&&F(i.TEXTURE_CUBE_MAP),qe.__version=ze.version,ee.onUpdate&&ee.onUpdate(ee)}oe.__version=ee.version}function Le(oe,ee,W,ot,ze){const qe=a.convert(W.format,W.colorSpace),ut=a.convert(W.type),ft=k(W.internalFormat,qe,ut,W.colorSpace);r.get(ee).__hasExternalTextures||(ze===i.TEXTURE_3D||ze===i.TEXTURE_2D_ARRAY?n.texImage3D(ze,0,ft,ee.width,ee.height,ee.depth,0,qe,ut,null):n.texImage2D(ze,0,ft,ee.width,ee.height,0,qe,ut,null)),n.bindFramebuffer(i.FRAMEBUFFER,oe),Ce(ee)?m.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,ot,ze,r.get(W).__webglTexture,0,it(ee)):(ze===i.TEXTURE_2D||ze>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&ze<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,ot,ze,r.get(W).__webglTexture,0),n.bindFramebuffer(i.FRAMEBUFFER,null)}function re(oe,ee,W){if(i.bindRenderbuffer(i.RENDERBUFFER,oe),ee.depthBuffer&&!ee.stencilBuffer){let ot=i.DEPTH_COMPONENT16;if(W||Ce(ee)){const ze=ee.depthTexture;ze&&ze.isDepthTexture&&(ze.type===Kr?ot=i.DEPTH_COMPONENT32F:ze.type===Sc&&(ot=i.DEPTH_COMPONENT24));const qe=it(ee);Ce(ee)?m.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,qe,ot,ee.width,ee.height):i.renderbufferStorageMultisample(i.RENDERBUFFER,qe,ot,ee.width,ee.height)}else i.renderbufferStorage(i.RENDERBUFFER,ot,ee.width,ee.height);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,oe)}else if(ee.depthBuffer&&ee.stencilBuffer){const ot=it(ee);W&&Ce(ee)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,ot,i.DEPTH24_STENCIL8,ee.width,ee.height):Ce(ee)?m.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,ot,i.DEPTH24_STENCIL8,ee.width,ee.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,ee.width,ee.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,oe)}else{const ot=ee.isWebGLMultipleRenderTargets===!0?ee.texture:[ee.texture];for(let ze=0;ze<ot.length;ze++){const qe=ot[ze],ut=a.convert(qe.format,qe.colorSpace),ft=a.convert(qe.type),Ge=k(qe.internalFormat,ut,ft,qe.colorSpace),$t=it(ee);W&&Ce(ee)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,$t,Ge,ee.width,ee.height):Ce(ee)?m.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,$t,Ge,ee.width,ee.height):i.renderbufferStorage(i.RENDERBUFFER,Ge,ee.width,ee.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function Ye(oe,ee){if(ee&&ee.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(i.FRAMEBUFFER,oe),!(ee.depthTexture&&ee.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(ee.depthTexture).__webglTexture||ee.depthTexture.image.width!==ee.width||ee.depthTexture.image.height!==ee.height)&&(ee.depthTexture.image.width=ee.width,ee.depthTexture.image.height=ee.height,ee.depthTexture.needsUpdate=!0),K(ee.depthTexture,0);const ot=r.get(ee.depthTexture).__webglTexture,ze=it(ee);if(ee.depthTexture.format===nd)Ce(ee)?m.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,ot,0,ze):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,ot,0);else if(ee.depthTexture.format===yp)Ce(ee)?m.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,ot,0,ze):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,ot,0);else throw new Error("Unknown depthTexture format")}function Fe(oe){const ee=r.get(oe),W=oe.isWebGLCubeRenderTarget===!0;if(oe.depthTexture&&!ee.__autoAllocateDepthBuffer){if(W)throw new Error("target.depthTexture not supported in Cube render targets");Ye(ee.__webglFramebuffer,oe)}else if(W){ee.__webglDepthbuffer=[];for(let ot=0;ot<6;ot++)n.bindFramebuffer(i.FRAMEBUFFER,ee.__webglFramebuffer[ot]),ee.__webglDepthbuffer[ot]=i.createRenderbuffer(),re(ee.__webglDepthbuffer[ot],oe,!1)}else n.bindFramebuffer(i.FRAMEBUFFER,ee.__webglFramebuffer),ee.__webglDepthbuffer=i.createRenderbuffer(),re(ee.__webglDepthbuffer,oe,!1);n.bindFramebuffer(i.FRAMEBUFFER,null)}function Ze(oe,ee,W){const ot=r.get(oe);ee!==void 0&&Le(ot.__webglFramebuffer,oe,oe.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D),W!==void 0&&Fe(oe)}function Xe(oe){const ee=oe.texture,W=r.get(oe),ot=r.get(ee);oe.addEventListener("dispose",ie),oe.isWebGLMultipleRenderTargets!==!0&&(ot.__webglTexture===void 0&&(ot.__webglTexture=i.createTexture()),ot.__version=ee.version,l.memory.textures++);const ze=oe.isWebGLCubeRenderTarget===!0,qe=oe.isWebGLMultipleRenderTargets===!0,ut=R(oe)||u;if(ze){W.__webglFramebuffer=[];for(let ft=0;ft<6;ft++)W.__webglFramebuffer[ft]=i.createFramebuffer()}else{if(W.__webglFramebuffer=i.createFramebuffer(),qe)if(s.drawBuffers){const ft=oe.texture;for(let Ge=0,$t=ft.length;Ge<$t;Ge++){const L=r.get(ft[Ge]);L.__webglTexture===void 0&&(L.__webglTexture=i.createTexture(),l.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(u&&oe.samples>0&&Ce(oe)===!1){const ft=qe?ee:[ee];W.__webglMultisampledFramebuffer=i.createFramebuffer(),W.__webglColorRenderbuffer=[],n.bindFramebuffer(i.FRAMEBUFFER,W.__webglMultisampledFramebuffer);for(let Ge=0;Ge<ft.length;Ge++){const $t=ft[Ge];W.__webglColorRenderbuffer[Ge]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,W.__webglColorRenderbuffer[Ge]);const L=a.convert($t.format,$t.colorSpace),X=a.convert($t.type),fe=k($t.internalFormat,L,X,$t.colorSpace,oe.isXRRenderTarget===!0),z=it(oe);i.renderbufferStorageMultisample(i.RENDERBUFFER,z,fe,oe.width,oe.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ge,i.RENDERBUFFER,W.__webglColorRenderbuffer[Ge])}i.bindRenderbuffer(i.RENDERBUFFER,null),oe.depthBuffer&&(W.__webglDepthRenderbuffer=i.createRenderbuffer(),re(W.__webglDepthRenderbuffer,oe,!0)),n.bindFramebuffer(i.FRAMEBUFFER,null)}}if(ze){n.bindTexture(i.TEXTURE_CUBE_MAP,ot.__webglTexture),Re(i.TEXTURE_CUBE_MAP,ee,ut);for(let ft=0;ft<6;ft++)Le(W.__webglFramebuffer[ft],oe,ee,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+ft);O(ee,ut)&&F(i.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(qe){const ft=oe.texture;for(let Ge=0,$t=ft.length;Ge<$t;Ge++){const L=ft[Ge],X=r.get(L);n.bindTexture(i.TEXTURE_2D,X.__webglTexture),Re(i.TEXTURE_2D,L,ut),Le(W.__webglFramebuffer,oe,L,i.COLOR_ATTACHMENT0+Ge,i.TEXTURE_2D),O(L,ut)&&F(i.TEXTURE_2D)}n.unbindTexture()}else{let ft=i.TEXTURE_2D;(oe.isWebGL3DRenderTarget||oe.isWebGLArrayRenderTarget)&&(u?ft=oe.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(ft,ot.__webglTexture),Re(ft,ee,ut),Le(W.__webglFramebuffer,oe,ee,i.COLOR_ATTACHMENT0,ft),O(ee,ut)&&F(ft),n.unbindTexture()}oe.depthBuffer&&Fe(oe)}function dt(oe){const ee=R(oe)||u,W=oe.isWebGLMultipleRenderTargets===!0?oe.texture:[oe.texture];for(let ot=0,ze=W.length;ot<ze;ot++){const qe=W[ot];if(O(qe,ee)){const ut=oe.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D,ft=r.get(qe).__webglTexture;n.bindTexture(ut,ft),F(ut),n.unbindTexture()}}}function je(oe){if(u&&oe.samples>0&&Ce(oe)===!1){const ee=oe.isWebGLMultipleRenderTargets?oe.texture:[oe.texture],W=oe.width,ot=oe.height;let ze=i.COLOR_BUFFER_BIT;const qe=[],ut=oe.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,ft=r.get(oe),Ge=oe.isWebGLMultipleRenderTargets===!0;if(Ge)for(let $t=0;$t<ee.length;$t++)n.bindFramebuffer(i.FRAMEBUFFER,ft.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+$t,i.RENDERBUFFER,null),n.bindFramebuffer(i.FRAMEBUFFER,ft.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+$t,i.TEXTURE_2D,null,0);n.bindFramebuffer(i.READ_FRAMEBUFFER,ft.__webglMultisampledFramebuffer),n.bindFramebuffer(i.DRAW_FRAMEBUFFER,ft.__webglFramebuffer);for(let $t=0;$t<ee.length;$t++){qe.push(i.COLOR_ATTACHMENT0+$t),oe.depthBuffer&&qe.push(ut);const L=ft.__ignoreDepthValues!==void 0?ft.__ignoreDepthValues:!1;if(L===!1&&(oe.depthBuffer&&(ze|=i.DEPTH_BUFFER_BIT),oe.stencilBuffer&&(ze|=i.STENCIL_BUFFER_BIT)),Ge&&i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,ft.__webglColorRenderbuffer[$t]),L===!0&&(i.invalidateFramebuffer(i.READ_FRAMEBUFFER,[ut]),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[ut])),Ge){const X=r.get(ee[$t]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,X,0)}i.blitFramebuffer(0,0,W,ot,0,0,W,ot,ze,i.NEAREST),T&&i.invalidateFramebuffer(i.READ_FRAMEBUFFER,qe)}if(n.bindFramebuffer(i.READ_FRAMEBUFFER,null),n.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),Ge)for(let $t=0;$t<ee.length;$t++){n.bindFramebuffer(i.FRAMEBUFFER,ft.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+$t,i.RENDERBUFFER,ft.__webglColorRenderbuffer[$t]);const L=r.get(ee[$t]).__webglTexture;n.bindFramebuffer(i.FRAMEBUFFER,ft.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+$t,i.TEXTURE_2D,L,0)}n.bindFramebuffer(i.DRAW_FRAMEBUFFER,ft.__webglMultisampledFramebuffer)}}function it(oe){return Math.min(p,oe.samples)}function Ce(oe){const ee=r.get(oe);return u&&oe.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&ee.__useRenderToTexture!==!1}function Me(oe){const ee=l.render.frame;E.get(oe)!==ee&&(E.set(oe,ee),oe.update())}function St(oe,ee){const W=oe.colorSpace,ot=oe.format,ze=oe.type;return oe.isCompressedTexture===!0||oe.format===WS||W!==Io&&W!==id&&(W===Tn?u===!1?e.has("EXT_sRGB")===!0&&ot===jr?(oe.format=WS,oe.minFilter=Gn,oe.generateMipmaps=!1):ee=vM.sRGBToLinear(ee):(ot!==jr||ze!==la)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",W)),ee}this.allocateTextureUnit=H,this.resetTextureUnits=xe,this.setTexture2D=K,this.setTexture2DArray=se,this.setTexture3D=Y,this.setTextureCube=he,this.rebindTextures=Ze,this.setupRenderTarget=Xe,this.updateRenderTargetMipmap=dt,this.updateMultisampleRenderTarget=je,this.setupDepthRenderbuffer=Fe,this.setupFrameBufferTexture=Le,this.useMultisampledRTT=Ce}function OF(i,e,n){const r=n.isWebGL2;function s(a,l=id){let u;if(a===la)return i.UNSIGNED_BYTE;if(a===aM)return i.UNSIGNED_SHORT_4_4_4_4;if(a===lM)return i.UNSIGNED_SHORT_5_5_5_1;if(a===sM)return i.BYTE;if(a===oM)return i.SHORT;if(a===A$)return i.UNSIGNED_SHORT;if(a===C$)return i.INT;if(a===Sc)return i.UNSIGNED_INT;if(a===Kr)return i.FLOAT;if(a===ss)return r?i.HALF_FLOAT:(u=e.get("OES_texture_half_float"),u!==null?u.HALF_FLOAT_OES:null);if(a===nF)return i.ALPHA;if(a===jr)return i.RGBA;if(a===iF)return i.LUMINANCE;if(a===rF)return i.LUMINANCE_ALPHA;if(a===nd)return i.DEPTH_COMPONENT;if(a===yp)return i.DEPTH_STENCIL;if(a===WS)return u=e.get("EXT_sRGB"),u!==null?u.SRGB_ALPHA_EXT:null;if(a===cM)return i.RED;if(a===uM)return i.RED_INTEGER;if(a===sF)return i.RG;if(a===hM)return i.RG_INTEGER;if(a===dM)return i.RGBA_INTEGER;if(a===cS||a===uS||a===hS||a===dS)if(l===Tn)if(u=e.get("WEBGL_compressed_texture_s3tc_srgb"),u!==null){if(a===cS)return u.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(a===uS)return u.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(a===hS)return u.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(a===dS)return u.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(u=e.get("WEBGL_compressed_texture_s3tc"),u!==null){if(a===cS)return u.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===uS)return u.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===hS)return u.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===dS)return u.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(a===dR||a===fR||a===pR||a===mR)if(u=e.get("WEBGL_compressed_texture_pvrtc"),u!==null){if(a===dR)return u.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===fR)return u.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===pR)return u.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===mR)return u.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(a===oF)return u=e.get("WEBGL_compressed_texture_etc1"),u!==null?u.COMPRESSED_RGB_ETC1_WEBGL:null;if(a===gR||a===_R)if(u=e.get("WEBGL_compressed_texture_etc"),u!==null){if(a===gR)return l===Tn?u.COMPRESSED_SRGB8_ETC2:u.COMPRESSED_RGB8_ETC2;if(a===_R)return l===Tn?u.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:u.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(a===vR||a===TR||a===ER||a===yR||a===SR||a===$R||a===bR||a===AR||a===CR||a===xR||a===RR||a===wR||a===MR||a===IR)if(u=e.get("WEBGL_compressed_texture_astc"),u!==null){if(a===vR)return l===Tn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:u.COMPRESSED_RGBA_ASTC_4x4_KHR;if(a===TR)return l===Tn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:u.COMPRESSED_RGBA_ASTC_5x4_KHR;if(a===ER)return l===Tn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:u.COMPRESSED_RGBA_ASTC_5x5_KHR;if(a===yR)return l===Tn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:u.COMPRESSED_RGBA_ASTC_6x5_KHR;if(a===SR)return l===Tn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:u.COMPRESSED_RGBA_ASTC_6x6_KHR;if(a===$R)return l===Tn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:u.COMPRESSED_RGBA_ASTC_8x5_KHR;if(a===bR)return l===Tn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:u.COMPRESSED_RGBA_ASTC_8x6_KHR;if(a===AR)return l===Tn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:u.COMPRESSED_RGBA_ASTC_8x8_KHR;if(a===CR)return l===Tn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:u.COMPRESSED_RGBA_ASTC_10x5_KHR;if(a===xR)return l===Tn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:u.COMPRESSED_RGBA_ASTC_10x6_KHR;if(a===RR)return l===Tn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:u.COMPRESSED_RGBA_ASTC_10x8_KHR;if(a===wR)return l===Tn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:u.COMPRESSED_RGBA_ASTC_10x10_KHR;if(a===MR)return l===Tn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:u.COMPRESSED_RGBA_ASTC_12x10_KHR;if(a===IR)return l===Tn?u.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:u.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(a===fS)if(u=e.get("EXT_texture_compression_bptc"),u!==null){if(a===fS)return l===Tn?u.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:u.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(a===aF||a===OR||a===LR||a===NR)if(u=e.get("EXT_texture_compression_rgtc"),u!==null){if(a===fS)return u.COMPRESSED_RED_RGTC1_EXT;if(a===OR)return u.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(a===LR)return u.COMPRESSED_RED_GREEN_RGTC2_EXT;if(a===NR)return u.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return a===td?r?i.UNSIGNED_INT_24_8:(u=e.get("WEBGL_depth_texture"),u!==null?u.UNSIGNED_INT_24_8_WEBGL:null):i[a]!==void 0?i[a]:null}return{convert:s}}class LF extends Ui{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class za extends Xn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const cX={type:"move"};class $C{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new za,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new za,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new te,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new te),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new za,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new te,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new te),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const r of e.hand.values())this._getHandJoint(n,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,r){let s=null,a=null,l=null;const u=this._targetRay,d=this._grip,h=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(h&&e.hand){l=!0;for(const b of e.hand.values()){const y=n.getJointPose(b,r),S=this._getHandJoint(h,b);y!==null&&(S.matrix.fromArray(y.transform.matrix),S.matrix.decompose(S.position,S.rotation,S.scale),S.matrixWorldNeedsUpdate=!0,S.jointRadius=y.radius),S.visible=y!==null}const f=h.joints["index-finger-tip"],p=h.joints["thumb-tip"],m=f.position.distanceTo(p.position),T=.02,E=.005;h.inputState.pinching&&m>T+E?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!h.inputState.pinching&&m<=T-E&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else d!==null&&e.gripSpace&&(a=n.getPose(e.gripSpace,r),a!==null&&(d.matrix.fromArray(a.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),d.matrixWorldNeedsUpdate=!0,a.linearVelocity?(d.hasLinearVelocity=!0,d.linearVelocity.copy(a.linearVelocity)):d.hasLinearVelocity=!1,a.angularVelocity?(d.hasAngularVelocity=!0,d.angularVelocity.copy(a.angularVelocity)):d.hasAngularVelocity=!1));u!==null&&(s=n.getPose(e.targetRaySpace,r),s===null&&a!==null&&(s=a),s!==null&&(u.matrix.fromArray(s.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,s.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(s.linearVelocity)):u.hasLinearVelocity=!1,s.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(s.angularVelocity)):u.hasAngularVelocity=!1,this.dispatchEvent(cX)))}return u!==null&&(u.visible=s!==null),d!==null&&(d.visible=a!==null),h!==null&&(h.visible=l!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const r=new za;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[n.jointName]=r,e.add(r)}return e.joints[n.jointName]}}class NF extends ni{constructor(e,n,r,s,a,l,u,d,h,f){if(f=f!==void 0?f:nd,f!==nd&&f!==yp)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&f===nd&&(r=Sc),r===void 0&&f===yp&&(r=td),super(null,s,a,l,u,d,f,r,h),this.isDepthTexture=!0,this.image={width:e,height:n},this.magFilter=u!==void 0?u:tr,this.minFilter=d!==void 0?d:tr,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}class uX extends Mc{constructor(e,n){super();const r=this;let s=null,a=1,l=null,u="local-floor",d=1,h=null,f=null,p=null,m=null,T=null,E=null;const b=n.getContextAttributes();let y=null,S=null;const A=[],C=[];let R=null;const I=new Ui;I.layers.enable(1),I.viewport=new Hn;const O=new Ui;O.layers.enable(2),O.viewport=new Hn;const F=[I,O],k=new LF;k.layers.enable(1),k.layers.enable(2);let D=null,U=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getCamera=function(){},this.setUserCamera=function(Y){R=Y},this.getController=function(Y){let he=A[Y];return he===void 0&&(he=new $C,A[Y]=he),he.getTargetRaySpace()},this.getControllerGrip=function(Y){let he=A[Y];return he===void 0&&(he=new $C,A[Y]=he),he.getGripSpace()},this.getHand=function(Y){let he=A[Y];return he===void 0&&(he=new $C,A[Y]=he),he.getHandSpace()};function ce(Y){const he=C.indexOf(Y.inputSource);if(he===-1)return;const ue=A[he];ue!==void 0&&(ue.update(Y.inputSource,Y.frame,h||l),ue.dispatchEvent({type:Y.type,data:Y.inputSource}))}function ie(){s.removeEventListener("select",ce),s.removeEventListener("selectstart",ce),s.removeEventListener("selectend",ce),s.removeEventListener("squeeze",ce),s.removeEventListener("squeezestart",ce),s.removeEventListener("squeezeend",ce),s.removeEventListener("end",ie),s.removeEventListener("inputsourceschange",ae);for(let Y=0;Y<A.length;Y++){const he=C[Y];he!==null&&(C[Y]=null,A[Y].disconnect(he))}D=null,U=null,e.setRenderTarget(y),T=null,m=null,p=null,s=null,S=null,se.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Y){a=Y,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Y){u=Y,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||l},this.setReferenceSpace=function(Y){h=Y},this.getBaseLayer=function(){return m!==null?m:T},this.getBinding=function(){return p},this.getFrame=function(){return E},this.getSession=function(){return s},this.setSession=async function(Y){if(s=Y,s!==null){if(y=e.getRenderTarget(),s.addEventListener("select",ce),s.addEventListener("selectstart",ce),s.addEventListener("selectend",ce),s.addEventListener("squeeze",ce),s.addEventListener("squeezestart",ce),s.addEventListener("squeezeend",ce),s.addEventListener("end",ie),s.addEventListener("inputsourceschange",ae),b.xrCompatible!==!0&&await n.makeXRCompatible(),s.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const he={antialias:s.renderState.layers===void 0?b.antialias:!0,alpha:!0,depth:b.depth,stencil:b.stencil,framebufferScaleFactor:a};T=new XRWebGLLayer(s,n,he),s.updateRenderState({baseLayer:T}),S=new da(T.framebufferWidth,T.framebufferHeight,{format:jr,type:la,colorSpace:e.outputColorSpace,stencilBuffer:b.stencil})}else{let he=null,ue=null,Te=null;b.depth&&(Te=b.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,he=b.stencil?yp:nd,ue=b.stencil?td:Sc);const _e={colorFormat:n.RGBA8,depthFormat:Te,scaleFactor:a};p=new XRWebGLBinding(s,n),m=p.createProjectionLayer(_e),s.updateRenderState({layers:[m]}),S=new da(m.textureWidth,m.textureHeight,{format:jr,type:la,depthTexture:new NF(m.textureWidth,m.textureHeight,ue,void 0,void 0,void 0,void 0,void 0,void 0,he),stencilBuffer:b.stencil,colorSpace:e.outputColorSpace,samples:b.antialias?4:0});const Re=e.properties.get(S);Re.__ignoreDepthValues=m.ignoreDepthValues}S.isXRRenderTarget=!0,this.setFoveation(d),h=null,l=await s.requestReferenceSpace(u),se.setContext(s),se.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode};function ae(Y){for(let he=0;he<Y.removed.length;he++){const ue=Y.removed[he],Te=C.indexOf(ue);Te>=0&&(C[Te]=null,A[Te].disconnect(ue))}for(let he=0;he<Y.added.length;he++){const ue=Y.added[he];let Te=C.indexOf(ue);if(Te===-1){for(let Re=0;Re<A.length;Re++)if(Re>=C.length){C.push(ue),Te=Re;break}else if(C[Re]===null){C[Re]=ue,Te=Re;break}if(Te===-1)break}const _e=A[Te];_e&&_e.connect(ue)}}const ne=new te,pe=new te;function de(Y,he,ue){ne.setFromMatrixPosition(he.matrixWorld),pe.setFromMatrixPosition(ue.matrixWorld);const Te=ne.distanceTo(pe),_e=he.projectionMatrix.elements,Re=ue.projectionMatrix.elements,De=_e[14]/(_e[10]-1),et=_e[14]/(_e[10]+1),Ue=(_e[9]+1)/_e[5],Le=(_e[9]-1)/_e[5],re=(_e[8]-1)/_e[0],Ye=(Re[8]+1)/Re[0],Fe=De*re,Ze=De*Ye,Xe=Te/(-re+Ye),dt=Xe*-re;he.matrixWorld.decompose(Y.position,Y.quaternion,Y.scale),Y.translateX(dt),Y.translateZ(Xe),Y.matrixWorld.compose(Y.position,Y.quaternion,Y.scale),Y.matrixWorldInverse.copy(Y.matrixWorld).invert();const je=De+Xe,it=et+Xe,Ce=Fe-dt,Me=Ze+(Te-dt),St=Ue*et/it*je,oe=Le*et/it*je;Y.projectionMatrix.makePerspective(Ce,Me,St,oe,je,it),Y.projectionMatrixInverse.copy(Y.projectionMatrix).invert()}function xe(Y,he){he===null?Y.matrixWorld.copy(Y.matrix):Y.matrixWorld.multiplyMatrices(he.matrixWorld,Y.matrix),Y.matrixWorldInverse.copy(Y.matrixWorld).invert()}this.updateCameraXR=function(Y){if(s===null)return Y;R&&(Y=R),k.near=O.near=I.near=Y.near,k.far=O.far=I.far=Y.far,(D!==k.near||U!==k.far)&&(s.updateRenderState({depthNear:k.near,depthFar:k.far}),D=k.near,U=k.far);const he=Y.parent,ue=k.cameras;xe(k,he);for(let Te=0;Te<ue.length;Te++)xe(ue[Te],he);return ue.length===2?de(k,I,O):k.projectionMatrix.copy(I.projectionMatrix),R&&H(k,he),k};function H(Y,he){const ue=R;he===null?ue.matrix.copy(Y.matrixWorld):(ue.matrix.copy(he.matrixWorld),ue.matrix.invert(),ue.matrix.multiply(Y.matrixWorld)),ue.matrix.decompose(ue.position,ue.quaternion,ue.scale),ue.updateMatrixWorld(!0);const Te=ue.children;for(let _e=0,Re=Te.length;_e<Re;_e++)Te[_e].updateMatrixWorld(!0);ue.projectionMatrix.copy(Y.projectionMatrix),ue.projectionMatrixInverse.copy(Y.projectionMatrixInverse),ue.isPerspectiveCamera&&(ue.fov=Wg*2*Math.atan(1/ue.projectionMatrix.elements[5]),ue.zoom=1)}this.getFoveation=function(){if(!(m===null&&T===null))return d},this.setFoveation=function(Y){d=Y,m!==null&&(m.fixedFoveation=Y),T!==null&&T.fixedFoveation!==void 0&&(T.fixedFoveation=Y)};let J=null;function K(Y,he){if(f=he.getViewerPose(h||l),E=he,f!==null){const ue=f.views;T!==null&&(e.setRenderTargetFramebuffer(S,T.framebuffer),e.setRenderTarget(S));let Te=!1;ue.length!==k.cameras.length&&(k.cameras.length=0,Te=!0);for(let _e=0;_e<ue.length;_e++){const Re=ue[_e];let De=null;if(T!==null)De=T.getViewport(Re);else{const Ue=p.getViewSubImage(m,Re);De=Ue.viewport,_e===0&&(e.setRenderTargetTextures(S,Ue.colorTexture,m.ignoreDepthValues?void 0:Ue.depthStencilTexture),e.setRenderTarget(S))}let et=F[_e];et===void 0&&(et=new Ui,et.layers.enable(_e),et.viewport=new Hn,F[_e]=et),et.matrix.fromArray(Re.transform.matrix),et.matrix.decompose(et.position,et.quaternion,et.scale),et.projectionMatrix.fromArray(Re.projectionMatrix),et.projectionMatrixInverse.copy(et.projectionMatrix).invert(),et.viewport.set(De.x,De.y,De.width,De.height),_e===0&&(k.matrix.copy(et.matrix),k.matrix.decompose(k.position,k.quaternion,k.scale)),Te===!0&&k.cameras.push(et)}}for(let ue=0;ue<A.length;ue++){const Te=C[ue],_e=A[ue];Te!==null&&_e!==void 0&&_e.update(Te,he,h||l)}J&&J(Y,he),he.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:he}),E=null}const se=new xF;se.setAnimationLoop(K),this.setAnimationLoop=function(Y){J=Y},this.dispose=function(){}}}function hX(i,e){function n(y,S){y.matrixAutoUpdate===!0&&y.updateMatrix(),S.value.copy(y.matrix)}function r(y,S){S.color.getRGB(y.fogColor.value,AF(i)),S.isFog?(y.fogNear.value=S.near,y.fogFar.value=S.far):S.isFogExp2&&(y.fogDensity.value=S.density)}function s(y,S,A,C,R){S.isMeshBasicMaterial||S.isMeshLambertMaterial?a(y,S):S.isMeshToonMaterial?(a(y,S),p(y,S)):S.isMeshPhongMaterial?(a(y,S),f(y,S)):S.isMeshStandardMaterial?(a(y,S),m(y,S),S.isMeshPhysicalMaterial&&T(y,S,R)):S.isMeshMatcapMaterial?(a(y,S),E(y,S)):S.isMeshDepthMaterial?a(y,S):S.isMeshDistanceMaterial?(a(y,S),b(y,S)):S.isMeshNormalMaterial?a(y,S):S.isLineBasicMaterial?(l(y,S),S.isLineDashedMaterial&&u(y,S)):S.isPointsMaterial?d(y,S,A,C):S.isSpriteMaterial?h(y,S):S.isShadowMaterial?(y.color.value.copy(S.color),y.opacity.value=S.opacity):S.isShaderMaterial&&(S.uniformsNeedUpdate=!1)}function a(y,S){y.opacity.value=S.opacity,S.color&&y.diffuse.value.copy(S.color),S.emissive&&y.emissive.value.copy(S.emissive).multiplyScalar(S.emissiveIntensity),S.map&&(y.map.value=S.map,n(S.map,y.mapTransform)),S.alphaMap&&(y.alphaMap.value=S.alphaMap,n(S.alphaMap,y.alphaMapTransform)),S.bumpMap&&(y.bumpMap.value=S.bumpMap,n(S.bumpMap,y.bumpMapTransform),y.bumpScale.value=S.bumpScale,S.side===zs&&(y.bumpScale.value*=-1)),S.normalMap&&(y.normalMap.value=S.normalMap,n(S.normalMap,y.normalMapTransform),y.normalScale.value.copy(S.normalScale),S.side===zs&&y.normalScale.value.negate()),S.displacementMap&&(y.displacementMap.value=S.displacementMap,n(S.displacementMap,y.displacementMapTransform),y.displacementScale.value=S.displacementScale,y.displacementBias.value=S.displacementBias),S.emissiveMap&&(y.emissiveMap.value=S.emissiveMap,n(S.emissiveMap,y.emissiveMapTransform)),S.specularMap&&(y.specularMap.value=S.specularMap,n(S.specularMap,y.specularMapTransform)),S.alphaTest>0&&(y.alphaTest.value=S.alphaTest);const A=e.get(S).envMap;if(A&&(y.envMap.value=A,y.flipEnvMap.value=A.isCubeTexture&&A.isRenderTargetTexture===!1?-1:1,y.reflectivity.value=S.reflectivity,y.ior.value=S.ior,y.refractionRatio.value=S.refractionRatio),S.lightMap){y.lightMap.value=S.lightMap;const C=i.useLegacyLights===!0?Math.PI:1;y.lightMapIntensity.value=S.lightMapIntensity*C,n(S.lightMap,y.lightMapTransform)}S.aoMap&&(y.aoMap.value=S.aoMap,y.aoMapIntensity.value=S.aoMapIntensity,n(S.aoMap,y.aoMapTransform))}function l(y,S){y.diffuse.value.copy(S.color),y.opacity.value=S.opacity,S.map&&(y.map.value=S.map,n(S.map,y.mapTransform))}function u(y,S){y.dashSize.value=S.dashSize,y.totalSize.value=S.dashSize+S.gapSize,y.scale.value=S.scale}function d(y,S,A,C){y.diffuse.value.copy(S.color),y.opacity.value=S.opacity,y.size.value=S.size*A,y.scale.value=C*.5,S.map&&(y.map.value=S.map,n(S.map,y.uvTransform)),S.alphaMap&&(y.alphaMap.value=S.alphaMap,n(S.alphaMap,y.alphaMapTransform)),S.alphaTest>0&&(y.alphaTest.value=S.alphaTest)}function h(y,S){y.diffuse.value.copy(S.color),y.opacity.value=S.opacity,y.rotation.value=S.rotation,S.map&&(y.map.value=S.map,n(S.map,y.mapTransform)),S.alphaMap&&(y.alphaMap.value=S.alphaMap,n(S.alphaMap,y.alphaMapTransform)),S.alphaTest>0&&(y.alphaTest.value=S.alphaTest)}function f(y,S){y.specular.value.copy(S.specular),y.shininess.value=Math.max(S.shininess,1e-4)}function p(y,S){S.gradientMap&&(y.gradientMap.value=S.gradientMap)}function m(y,S){y.metalness.value=S.metalness,S.metalnessMap&&(y.metalnessMap.value=S.metalnessMap,n(S.metalnessMap,y.metalnessMapTransform)),y.roughness.value=S.roughness,S.roughnessMap&&(y.roughnessMap.value=S.roughnessMap,n(S.roughnessMap,y.roughnessMapTransform)),e.get(S).envMap&&(y.envMapIntensity.value=S.envMapIntensity)}function T(y,S,A){y.ior.value=S.ior,S.sheen>0&&(y.sheenColor.value.copy(S.sheenColor).multiplyScalar(S.sheen),y.sheenRoughness.value=S.sheenRoughness,S.sheenColorMap&&(y.sheenColorMap.value=S.sheenColorMap,n(S.sheenColorMap,y.sheenColorMapTransform)),S.sheenRoughnessMap&&(y.sheenRoughnessMap.value=S.sheenRoughnessMap,n(S.sheenRoughnessMap,y.sheenRoughnessMapTransform))),S.clearcoat>0&&(y.clearcoat.value=S.clearcoat,y.clearcoatRoughness.value=S.clearcoatRoughness,S.clearcoatMap&&(y.clearcoatMap.value=S.clearcoatMap,n(S.clearcoatMap,y.clearcoatMapTransform)),S.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=S.clearcoatRoughnessMap,n(S.clearcoatRoughnessMap,y.clearcoatRoughnessMapTransform)),S.clearcoatNormalMap&&(y.clearcoatNormalMap.value=S.clearcoatNormalMap,n(S.clearcoatNormalMap,y.clearcoatNormalMapTransform),y.clearcoatNormalScale.value.copy(S.clearcoatNormalScale),S.side===zs&&y.clearcoatNormalScale.value.negate())),S.iridescence>0&&(y.iridescence.value=S.iridescence,y.iridescenceIOR.value=S.iridescenceIOR,y.iridescenceThicknessMinimum.value=S.iridescenceThicknessRange[0],y.iridescenceThicknessMaximum.value=S.iridescenceThicknessRange[1],S.iridescenceMap&&(y.iridescenceMap.value=S.iridescenceMap,n(S.iridescenceMap,y.iridescenceMapTransform)),S.iridescenceThicknessMap&&(y.iridescenceThicknessMap.value=S.iridescenceThicknessMap,n(S.iridescenceThicknessMap,y.iridescenceThicknessMapTransform))),S.transmission>0&&(y.transmission.value=S.transmission,y.transmissionSamplerMap.value=A.texture,y.transmissionSamplerSize.value.set(A.width,A.height),S.transmissionMap&&(y.transmissionMap.value=S.transmissionMap,n(S.transmissionMap,y.transmissionMapTransform)),y.thickness.value=S.thickness,S.thicknessMap&&(y.thicknessMap.value=S.thicknessMap,n(S.thicknessMap,y.thicknessMapTransform)),y.attenuationDistance.value=S.attenuationDistance,y.attenuationColor.value.copy(S.attenuationColor)),S.anisotropy>0&&(y.anisotropyVector.value.set(S.anisotropy*Math.cos(S.anisotropyRotation),S.anisotropy*Math.sin(S.anisotropyRotation)),S.anisotropyMap&&(y.anisotropyMap.value=S.anisotropyMap,n(S.anisotropyMap,y.anisotropyMapTransform))),y.specularIntensity.value=S.specularIntensity,y.specularColor.value.copy(S.specularColor),S.specularColorMap&&(y.specularColorMap.value=S.specularColorMap,n(S.specularColorMap,y.specularColorMapTransform)),S.specularIntensityMap&&(y.specularIntensityMap.value=S.specularIntensityMap,n(S.specularIntensityMap,y.specularIntensityMapTransform))}function E(y,S){S.matcap&&(y.matcap.value=S.matcap)}function b(y,S){const A=e.get(S).light;y.referencePosition.value.setFromMatrixPosition(A.matrixWorld),y.nearDistance.value=A.shadow.camera.near,y.farDistance.value=A.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:s}}function dX(i,e,n,r){let s={},a={},l=[];const u=n.isWebGL2?i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS):0;function d(A,C){const R=C.program;r.uniformBlockBinding(A,R)}function h(A,C){let R=s[A.id];R===void 0&&(E(A),R=f(A),s[A.id]=R,A.addEventListener("dispose",y));const I=C.program;r.updateUBOMapping(A,I);const O=e.render.frame;a[A.id]!==O&&(m(A),a[A.id]=O)}function f(A){const C=p();A.__bindingPointIndex=C;const R=i.createBuffer(),I=A.__size,O=A.usage;return i.bindBuffer(i.UNIFORM_BUFFER,R),i.bufferData(i.UNIFORM_BUFFER,I,O),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,C,R),R}function p(){for(let A=0;A<u;A++)if(l.indexOf(A)===-1)return l.push(A),A;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function m(A){const C=s[A.id],R=A.uniforms,I=A.__cache;i.bindBuffer(i.UNIFORM_BUFFER,C);for(let O=0,F=R.length;O<F;O++){const k=R[O];if(T(k,O,I)===!0){const D=k.__offset,U=Array.isArray(k.value)?k.value:[k.value];let ce=0;for(let ie=0;ie<U.length;ie++){const ae=U[ie],ne=b(ae);typeof ae=="number"?(k.__data[0]=ae,i.bufferSubData(i.UNIFORM_BUFFER,D+ce,k.__data)):ae.isMatrix3?(k.__data[0]=ae.elements[0],k.__data[1]=ae.elements[1],k.__data[2]=ae.elements[2],k.__data[3]=ae.elements[0],k.__data[4]=ae.elements[3],k.__data[5]=ae.elements[4],k.__data[6]=ae.elements[5],k.__data[7]=ae.elements[0],k.__data[8]=ae.elements[6],k.__data[9]=ae.elements[7],k.__data[10]=ae.elements[8],k.__data[11]=ae.elements[0]):(ae.toArray(k.__data,ce),ce+=ne.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,D,k.__data)}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function T(A,C,R){const I=A.value;if(R[C]===void 0){if(typeof I=="number")R[C]=I;else{const O=Array.isArray(I)?I:[I],F=[];for(let k=0;k<O.length;k++)F.push(O[k].clone());R[C]=F}return!0}else if(typeof I=="number"){if(R[C]!==I)return R[C]=I,!0}else{const O=Array.isArray(R[C])?R[C]:[R[C]],F=Array.isArray(I)?I:[I];for(let k=0;k<O.length;k++){const D=O[k];if(D.equals(F[k])===!1)return D.copy(F[k]),!0}}return!1}function E(A){const C=A.uniforms;let R=0;const I=16;let O=0;for(let F=0,k=C.length;F<k;F++){const D=C[F],U={boundary:0,storage:0},ce=Array.isArray(D.value)?D.value:[D.value];for(let ie=0,ae=ce.length;ie<ae;ie++){const ne=ce[ie],pe=b(ne);U.boundary+=pe.boundary,U.storage+=pe.storage}if(D.__data=new Float32Array(U.storage/Float32Array.BYTES_PER_ELEMENT),D.__offset=R,F>0){O=R%I;const ie=I-O;O!==0&&ie-U.boundary<0&&(R+=I-O,D.__offset=R)}R+=U.storage}return O=R%I,O>0&&(R+=I-O),A.__size=R,A.__cache={},this}function b(A){const C={boundary:0,storage:0};return typeof A=="number"?(C.boundary=4,C.storage=4):A.isVector2?(C.boundary=8,C.storage=8):A.isVector3||A.isColor?(C.boundary=16,C.storage=12):A.isVector4?(C.boundary=16,C.storage=16):A.isMatrix3?(C.boundary=48,C.storage=48):A.isMatrix4?(C.boundary=64,C.storage=64):A.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",A),C}function y(A){const C=A.target;C.removeEventListener("dispose",y);const R=l.indexOf(C.__bindingPointIndex);l.splice(R,1),i.deleteBuffer(s[C.id]),delete s[C.id],delete a[C.id]}function S(){for(const A in s)i.deleteBuffer(s[A]);l=[],s={},a={}}return{bind:d,update:h,dispose:S}}function fX(){const i=iE("canvas");return i.style.display="block",i}class N${constructor(e={}){const{canvas:n=fX(),context:r=null,depth:s=!0,stencil:a=!0,alpha:l=!1,antialias:u=!1,premultipliedAlpha:d=!0,preserveDrawingBuffer:h=!1,powerPreference:f="default",failIfMajorPerformanceCaveat:p=!1}=e;this.isWebGLRenderer=!0;let m;r!==null?m=r.getContextAttributes().alpha:m=l;const T=new Uint32Array(4),E=new Int32Array(4);let b=null,y=null;const S=[],A=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=Tn,this.useLegacyLights=!0,this.toneMapping=Ll,this.toneMappingExposure=1;const C=this;let R=!1,I=0,O=0,F=null,k=-1,D=null;const U=new Hn,ce=new Hn;let ie=null;const ae=new Ct(0);let ne=0,pe=n.width,de=n.height,xe=1,H=null,J=null;const K=new Hn(0,0,pe,de),se=new Hn(0,0,pe,de);let Y=!1;const he=new M$;let ue=!1,Te=!1,_e=null;const Re=new pn,De=new mt,et=new te,Ue={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Le(){return F===null?xe:1}let re=r;function Ye(B,le){for(let ve=0;ve<B.length;ve++){const me=B[ve],Se=n.getContext(me,le);if(Se!==null)return Se}return null}try{const B={alpha:!0,depth:s,stencil:a,antialias:u,premultipliedAlpha:d,preserveDrawingBuffer:h,powerPreference:f,failIfMajorPerformanceCaveat:p};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${Mp}`),n.addEventListener("webglcontextlost",Ie,!1),n.addEventListener("webglcontextrestored",Be,!1),n.addEventListener("webglcontextcreationerror",N,!1),re===null){const le=["webgl2","webgl","experimental-webgl"];if(C.isWebGL1Renderer===!0&&le.shift(),re=Ye(le,B),re===null)throw Ye(le)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}re instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),re.getShaderPrecisionFormat===void 0&&(re.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(B){throw console.error("THREE.WebGLRenderer: "+B.message),B}let Fe,Ze,Xe,dt,je,it,Ce,Me,St,oe,ee,W,ot,ze,qe,ut,ft,Ge,$t,L,X,fe,z,Ae;function tt(){Fe=new w8(re),Ze=new $8(re,Fe,e),Fe.init(Ze),fe=new OF(re,Fe,Ze),Xe=new aX(re,Fe,Ze),dt=new O8(re),je=new K6,it=new lX(re,Fe,Xe,je,Ze,fe,dt),Ce=new A8(C),Me=new R8(C),St=new z4(re,Ze),z=new y8(re,Fe,St,Ze),oe=new M8(re,St,dt,z),ee=new P8(re,oe,St,dt),$t=new k8(re,Ze,it),ut=new b8(je),W=new Y6(C,Ce,Me,Fe,Ze,z,ut),ot=new hX(C,je),ze=new Z6,qe=new iX(Fe,Ze),Ge=new E8(C,Ce,Me,Xe,ee,m,d),ft=new oX(C,ee,Ze),Ae=new dX(re,dt,Ze,Xe),L=new S8(re,Fe,dt,Ze),X=new I8(re,Fe,dt,Ze),dt.programs=W.programs,C.capabilities=Ze,C.extensions=Fe,C.properties=je,C.renderLists=ze,C.shadowMap=ft,C.state=Xe,C.info=dt}tt();const ye=new uX(C,re);this.xr=ye,this.getContext=function(){return re},this.getContextAttributes=function(){return re.getContextAttributes()},this.forceContextLoss=function(){const B=Fe.get("WEBGL_lose_context");B&&B.loseContext()},this.forceContextRestore=function(){const B=Fe.get("WEBGL_lose_context");B&&B.restoreContext()},this.getPixelRatio=function(){return xe},this.setPixelRatio=function(B){B!==void 0&&(xe=B,this.setSize(pe,de,!1))},this.getSize=function(B){return B.set(pe,de)},this.setSize=function(B,le,ve=!0){if(ye.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}pe=B,de=le,n.width=Math.floor(B*xe),n.height=Math.floor(le*xe),ve===!0&&(n.style.width=B+"px",n.style.height=le+"px"),this.setViewport(0,0,B,le)},this.getDrawingBufferSize=function(B){return B.set(pe*xe,de*xe).floor()},this.setDrawingBufferSize=function(B,le,ve){pe=B,de=le,xe=ve,n.width=Math.floor(B*ve),n.height=Math.floor(le*ve),this.setViewport(0,0,B,le)},this.getCurrentViewport=function(B){return B.copy(U)},this.getViewport=function(B){return B.copy(K)},this.setViewport=function(B,le,ve,me){B.isVector4?K.set(B.x,B.y,B.z,B.w):K.set(B,le,ve,me),Xe.viewport(U.copy(K).multiplyScalar(xe).floor())},this.getScissor=function(B){return B.copy(se)},this.setScissor=function(B,le,ve,me){B.isVector4?se.set(B.x,B.y,B.z,B.w):se.set(B,le,ve,me),Xe.scissor(ce.copy(se).multiplyScalar(xe).floor())},this.getScissorTest=function(){return Y},this.setScissorTest=function(B){Xe.setScissorTest(Y=B)},this.setOpaqueSort=function(B){H=B},this.setTransparentSort=function(B){J=B},this.getClearColor=function(B){return B.copy(Ge.getClearColor())},this.setClearColor=function(){Ge.setClearColor.apply(Ge,arguments)},this.getClearAlpha=function(){return Ge.getClearAlpha()},this.setClearAlpha=function(){Ge.setClearAlpha.apply(Ge,arguments)},this.clear=function(B=!0,le=!0,ve=!0){let me=0;if(B){let Se=!1;if(F!==null){const Ke=F.texture.format;Se=Ke===dM||Ke===hM||Ke===uM}if(Se){const Ke=F.texture.type,Je=Ke===la||Ke===Sc||Ke===A$||Ke===td||Ke===aM||Ke===lM,at=Ge.getClearColor(),rt=Ge.getClearAlpha(),pt=at.r,Ne=at.g,It=at.b,xt=je.get(F).__webglFramebuffer;Je?(T[0]=pt,T[1]=Ne,T[2]=It,T[3]=rt,re.clearBufferuiv(re.COLOR,xt,T)):(E[0]=pt,E[1]=Ne,E[2]=It,E[3]=rt,re.clearBufferiv(re.COLOR,xt,E))}else me|=re.COLOR_BUFFER_BIT}le&&(me|=re.DEPTH_BUFFER_BIT),ve&&(me|=re.STENCIL_BUFFER_BIT),re.clear(me)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",Ie,!1),n.removeEventListener("webglcontextrestored",Be,!1),n.removeEventListener("webglcontextcreationerror",N,!1),ze.dispose(),qe.dispose(),je.dispose(),Ce.dispose(),Me.dispose(),ee.dispose(),z.dispose(),Ae.dispose(),W.dispose(),ye.dispose(),ye.removeEventListener("sessionstart",bt),ye.removeEventListener("sessionend",un),_e&&(_e.dispose(),_e=null),an.stop()};function Ie(B){B.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),R=!0}function Be(){console.log("THREE.WebGLRenderer: Context Restored."),R=!1;const B=dt.autoReset,le=ft.enabled,ve=ft.autoUpdate,me=ft.needsUpdate,Se=ft.type;tt(),dt.autoReset=B,ft.enabled=le,ft.autoUpdate=ve,ft.needsUpdate=me,ft.type=Se}function N(B){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",B.statusMessage)}function j(B){const le=B.target;le.removeEventListener("dispose",j),ge(le)}function ge(B){we(B),je.remove(B)}function we(B){const le=je.get(B).programs;le!==void 0&&(le.forEach(function(ve){W.releaseProgram(ve)}),B.isShaderMaterial&&W.releaseShaderCache(B))}this.renderBufferDirect=function(B,le,ve,me,Se,Ke){le===null&&(le=Ue);const Je=Se.isMesh&&Se.matrixWorld.determinant()<0,at=mi(B,le,ve,me,Se);Xe.setMaterial(me,Je);let rt=ve.index,pt=1;me.wireframe===!0&&(rt=oe.getWireframeAttribute(ve),pt=2);const Ne=ve.drawRange,It=ve.attributes.position;let xt=Ne.start*pt,wt=(Ne.start+Ne.count)*pt;Ke!==null&&(xt=Math.max(xt,Ke.start*pt),wt=Math.min(wt,(Ke.start+Ke.count)*pt)),rt!==null?(xt=Math.max(xt,0),wt=Math.min(wt,rt.count)):It!=null&&(xt=Math.max(xt,0),wt=Math.min(wt,It.count));const Ht=wt-xt;if(Ht<0||Ht===1/0)return;z.setup(Se,me,at,ve,rt);let Zt,jt=L;if(rt!==null&&(Zt=St.get(rt),jt=X,jt.setIndex(Zt)),Se.isMesh)me.wireframe===!0?(Xe.setLineWidth(me.wireframeLinewidth*Le()),jt.setMode(re.LINES)):jt.setMode(re.TRIANGLES);else if(Se.isLine){let Ot=me.linewidth;Ot===void 0&&(Ot=1),Xe.setLineWidth(Ot*Le()),Se.isLineSegments?jt.setMode(re.LINES):Se.isLineLoop?jt.setMode(re.LINE_LOOP):jt.setMode(re.LINE_STRIP)}else Se.isPoints?jt.setMode(re.POINTS):Se.isSprite&&jt.setMode(re.TRIANGLES);if(Se.isInstancedMesh)jt.renderInstances(xt,Ht,Se.count);else if(ve.isInstancedBufferGeometry){const Ot=ve._maxInstanceCount!==void 0?ve._maxInstanceCount:1/0,qt=Math.min(ve.instanceCount,Ot);jt.renderInstances(xt,Ht,qt)}else jt.render(xt,Ht)},this.compile=function(B,le){function ve(me,Se,Ke){me.transparent===!0&&me.side===Ss&&me.forceSinglePass===!1?(me.side=zs,me.needsUpdate=!0,Ti(me,Se,Ke),me.side=Ya,me.needsUpdate=!0,Ti(me,Se,Ke),me.side=Ss):Ti(me,Se,Ke)}y=qe.get(B),y.init(),A.push(y),B.traverseVisible(function(me){me.isLight&&me.layers.test(le.layers)&&(y.pushLight(me),me.castShadow&&y.pushShadow(me))}),y.setupLights(C.useLegacyLights),B.traverse(function(me){const Se=me.material;if(Se)if(Array.isArray(Se))for(let Ke=0;Ke<Se.length;Ke++){const Je=Se[Ke];ve(Je,B,me)}else ve(Se,B,me)}),A.pop(),y=null};let We=null;function gt(B){We&&We(B)}function bt(){an.stop()}function un(){an.start()}const an=new xF;an.setAnimationLoop(gt),typeof self<"u"&&an.setContext(self),this.setAnimationLoop=function(B){We=B,ye.setAnimationLoop(B),B===null?an.stop():an.start()},ye.addEventListener("sessionstart",bt),ye.addEventListener("sessionend",un),this.render=function(B,le){if(le!==void 0&&le.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(R===!0)return;B.matrixWorldAutoUpdate===!0&&B.updateMatrixWorld(),le.parent===null&&le.matrixWorldAutoUpdate===!0&&le.updateMatrixWorld(),ye.enabled===!0&&ye.isPresenting===!0&&(le=ye.updateCameraXR(le)),B.isScene===!0&&B.onBeforeRender(C,B,le,F),y=qe.get(B,A.length),y.init(),A.push(y),Re.multiplyMatrices(le.projectionMatrix,le.matrixWorldInverse),he.setFromProjectionMatrix(Re),Te=this.localClippingEnabled,ue=ut.init(this.clippingPlanes,Te),b=ze.get(B,S.length),b.init(),S.push(b),ei(B,le,0,C.sortObjects),b.finish(),C.sortObjects===!0&&b.sort(H,J),ue===!0&&ut.beginShadows();const ve=y.state.shadowsArray;if(ft.render(ve,B,le),ue===!0&&ut.endShadows(),this.info.autoReset===!0&&this.info.reset(),this.info.render.frame++,Ge.render(b,B),y.setupLights(C.useLegacyLights),le.isArrayCamera){const me=le.cameras;for(let Se=0,Ke=me.length;Se<Ke;Se++){const Je=me[Se];pi(b,B,Je,Je.viewport)}}else pi(b,B,le);F!==null&&(it.updateMultisampleRenderTarget(F),it.updateRenderTargetMipmap(F)),B.isScene===!0&&B.onAfterRender(C,B,le),z.resetDefaultState(),k=-1,D=null,A.pop(),A.length>0?y=A[A.length-1]:y=null,S.pop(),S.length>0?b=S[S.length-1]:b=null};function ei(B,le,ve,me){if(B.visible===!1)return;if(B.layers.test(le.layers)){if(B.isGroup)ve=B.renderOrder;else if(B.isLOD)B.autoUpdate===!0&&B.update(le);else if(B.isLight)y.pushLight(B),B.castShadow&&y.pushShadow(B);else if(B.isSprite){if(!B.frustumCulled||he.intersectsSprite(B)){me&&et.setFromMatrixPosition(B.matrixWorld).applyMatrix4(Re);const Je=ee.update(B),at=B.material;at.visible&&b.push(B,Je,at,ve,et.z,null)}}else if((B.isMesh||B.isLine||B.isPoints)&&(!B.frustumCulled||he.intersectsObject(B))){B.isSkinnedMesh&&B.skeleton.frame!==dt.render.frame&&(B.skeleton.update(),B.skeleton.frame=dt.render.frame);const Je=ee.update(B),at=B.material;if(me&&(B.boundingSphere!==void 0?(B.boundingSphere===null&&B.computeBoundingSphere(),et.copy(B.boundingSphere.center)):(Je.boundingSphere===null&&Je.computeBoundingSphere(),et.copy(Je.boundingSphere.center)),et.applyMatrix4(B.matrixWorld).applyMatrix4(Re)),Array.isArray(at)){const rt=Je.groups;for(let pt=0,Ne=rt.length;pt<Ne;pt++){const It=rt[pt],xt=at[It.materialIndex];xt&&xt.visible&&b.push(B,Je,xt,ve,et.z,It)}}else at.visible&&b.push(B,Je,at,ve,et.z,null)}}const Ke=B.children;for(let Je=0,at=Ke.length;Je<at;Je++)ei(Ke[Je],le,ve,me)}function pi(B,le,ve,me){const Se=B.opaque,Ke=B.transmissive,Je=B.transparent;y.setupLightsView(ve),ue===!0&&ut.setGlobalState(C.clippingPlanes,ve),Ke.length>0&&Ji(Se,Ke,le,ve),me&&Xe.viewport(U.copy(me)),Se.length>0&&Ci(Se,le,ve),Ke.length>0&&Ci(Ke,le,ve),Je.length>0&&Ci(Je,le,ve),Xe.buffers.depth.setTest(!0),Xe.buffers.depth.setMask(!0),Xe.buffers.color.setMask(!0),Xe.setPolygonOffset(!1)}function Ji(B,le,ve,me){const Se=Ze.isWebGL2;_e===null&&(_e=new da(1,1,{generateMipmaps:!0,type:Fe.has("EXT_color_buffer_half_float")?ss:la,minFilter:Ka,samples:Se&&u===!0?4:0})),C.getDrawingBufferSize(De),Se?_e.setSize(De.x,De.y):_e.setSize(XS(De.x),XS(De.y));const Ke=C.getRenderTarget();C.setRenderTarget(_e),C.getClearColor(ae),ne=C.getClearAlpha(),ne<1&&C.setClearColor(16777215,.5),C.clear();const Je=C.toneMapping;C.toneMapping=Ll,Ci(B,ve,me),it.updateMultisampleRenderTarget(_e),it.updateRenderTargetMipmap(_e);let at=!1;for(let rt=0,pt=le.length;rt<pt;rt++){const Ne=le[rt],It=Ne.object,xt=Ne.geometry,wt=Ne.material,Ht=Ne.group;if(wt.side===Ss&&It.layers.test(me.layers)){const Zt=wt.side;wt.side=zs,wt.needsUpdate=!0,vi(It,ve,me,xt,wt,Ht),wt.side=Zt,wt.needsUpdate=!0,at=!0}}at===!0&&(it.updateMultisampleRenderTarget(_e),it.updateRenderTargetMipmap(_e)),C.setRenderTarget(Ke),C.setClearColor(ae,ne),C.toneMapping=Je}function Ci(B,le,ve){const me=le.isScene===!0?le.overrideMaterial:null;for(let Se=0,Ke=B.length;Se<Ke;Se++){const Je=B[Se],at=Je.object,rt=Je.geometry,pt=me===null?Je.material:me,Ne=Je.group;at.layers.test(ve.layers)&&vi(at,le,ve,rt,pt,Ne)}}function vi(B,le,ve,me,Se,Ke){B.onBeforeRender(C,le,ve,me,Se,Ke),B.modelViewMatrix.multiplyMatrices(ve.matrixWorldInverse,B.matrixWorld),B.normalMatrix.getNormalMatrix(B.modelViewMatrix),Se.onBeforeRender(C,le,ve,me,B,Ke),Se.transparent===!0&&Se.side===Ss&&Se.forceSinglePass===!1?(Se.side=zs,Se.needsUpdate=!0,C.renderBufferDirect(ve,le,me,Se,B,Ke),Se.side=Ya,Se.needsUpdate=!0,C.renderBufferDirect(ve,le,me,Se,B,Ke),Se.side=Ss):C.renderBufferDirect(ve,le,me,Se,B,Ke),B.onAfterRender(C,le,ve,me,Se,Ke)}function Ti(B,le,ve){le.isScene!==!0&&(le=Ue);const me=je.get(B),Se=y.state.lights,Ke=y.state.shadowsArray,Je=Se.state.version,at=W.getParameters(B,Se.state,Ke,le,ve),rt=W.getProgramCacheKey(at);let pt=me.programs;me.environment=B.isMeshStandardMaterial?le.environment:null,me.fog=le.fog,me.envMap=(B.isMeshStandardMaterial?Me:Ce).get(B.envMap||me.environment),pt===void 0&&(B.addEventListener("dispose",j),pt=new Map,me.programs=pt);let Ne=pt.get(rt);if(Ne!==void 0){if(me.currentProgram===Ne&&me.lightsStateVersion===Je)return nn(B,at),Ne}else at.uniforms=W.getUniforms(B),B.onBuild(ve,at,C),B.onBeforeCompile(at,C),Ne=W.acquireProgram(at,rt),pt.set(rt,Ne),me.uniforms=at.uniforms;const It=me.uniforms;(!B.isShaderMaterial&&!B.isRawShaderMaterial||B.clipping===!0)&&(It.clippingPlanes=ut.uniform),nn(B,at),me.needsLights=Z(B),me.lightsStateVersion=Je,me.needsLights&&(It.ambientLightColor.value=Se.state.ambient,It.lightProbe.value=Se.state.probe,It.directionalLights.value=Se.state.directional,It.directionalLightShadows.value=Se.state.directionalShadow,It.spotLights.value=Se.state.spot,It.spotLightShadows.value=Se.state.spotShadow,It.rectAreaLights.value=Se.state.rectArea,It.ltc_1.value=Se.state.rectAreaLTC1,It.ltc_2.value=Se.state.rectAreaLTC2,It.pointLights.value=Se.state.point,It.pointLightShadows.value=Se.state.pointShadow,It.hemisphereLights.value=Se.state.hemi,It.directionalShadowMap.value=Se.state.directionalShadowMap,It.directionalShadowMatrix.value=Se.state.directionalShadowMatrix,It.spotShadowMap.value=Se.state.spotShadowMap,It.spotLightMatrix.value=Se.state.spotLightMatrix,It.spotLightMap.value=Se.state.spotLightMap,It.pointShadowMap.value=Se.state.pointShadowMap,It.pointShadowMatrix.value=Se.state.pointShadowMatrix);const xt=Ne.getUniforms(),wt=gS.seqWithValue(xt.seq,It);return me.currentProgram=Ne,me.uniformsList=wt,Ne}function nn(B,le){const ve=je.get(B);ve.outputColorSpace=le.outputColorSpace,ve.instancing=le.instancing,ve.skinning=le.skinning,ve.morphTargets=le.morphTargets,ve.morphNormals=le.morphNormals,ve.morphColors=le.morphColors,ve.morphTargetsCount=le.morphTargetsCount,ve.numClippingPlanes=le.numClippingPlanes,ve.numIntersection=le.numClipIntersection,ve.vertexAlphas=le.vertexAlphas,ve.vertexTangents=le.vertexTangents,ve.toneMapping=le.toneMapping}function mi(B,le,ve,me,Se){le.isScene!==!0&&(le=Ue),it.resetTextureUnits();const Ke=le.fog,Je=me.isMeshStandardMaterial?le.environment:null,at=F===null?C.outputColorSpace:F.isXRRenderTarget===!0?F.texture.colorSpace:Io,rt=(me.isMeshStandardMaterial?Me:Ce).get(me.envMap||Je),pt=me.vertexColors===!0&&!!ve.attributes.color&&ve.attributes.color.itemSize===4,Ne=!!ve.attributes.tangent&&(!!me.normalMap||me.anisotropy>0),It=!!ve.morphAttributes.position,xt=!!ve.morphAttributes.normal,wt=!!ve.morphAttributes.color,Ht=me.toneMapped?C.toneMapping:Ll,Zt=ve.morphAttributes.position||ve.morphAttributes.normal||ve.morphAttributes.color,jt=Zt!==void 0?Zt.length:0,Ot=je.get(me),qt=y.state.lights;if(ue===!0&&(Te===!0||B!==D)){const hn=B===D&&me.id===k;ut.setState(me,B,hn)}let Ft=!1;me.version===Ot.__version?(Ot.needsLights&&Ot.lightsStateVersion!==qt.state.version||Ot.outputColorSpace!==at||Se.isInstancedMesh&&Ot.instancing===!1||!Se.isInstancedMesh&&Ot.instancing===!0||Se.isSkinnedMesh&&Ot.skinning===!1||!Se.isSkinnedMesh&&Ot.skinning===!0||Ot.envMap!==rt||me.fog===!0&&Ot.fog!==Ke||Ot.numClippingPlanes!==void 0&&(Ot.numClippingPlanes!==ut.numPlanes||Ot.numIntersection!==ut.numIntersection)||Ot.vertexAlphas!==pt||Ot.vertexTangents!==Ne||Ot.morphTargets!==It||Ot.morphNormals!==xt||Ot.morphColors!==wt||Ot.toneMapping!==Ht||Ze.isWebGL2===!0&&Ot.morphTargetsCount!==jt)&&(Ft=!0):(Ft=!0,Ot.__version=me.version);let ln=Ot.currentProgram;Ft===!0&&(ln=Ti(me,le,Se));let Bn=!1,on=!1,bn=!1;const tn=ln.getUniforms(),Fn=Ot.uniforms;if(Xe.useProgram(ln.program)&&(Bn=!0,on=!0,bn=!0),me.id!==k&&(k=me.id,on=!0),Bn||D!==B){if(tn.setValue(re,"projectionMatrix",B.projectionMatrix),Ze.logarithmicDepthBuffer&&tn.setValue(re,"logDepthBufFC",2/(Math.log(B.far+1)/Math.LN2)),D!==B&&(D=B,on=!0,bn=!0),me.isShaderMaterial||me.isMeshPhongMaterial||me.isMeshToonMaterial||me.isMeshStandardMaterial||me.envMap){const hn=tn.map.cameraPosition;hn!==void 0&&hn.setValue(re,et.setFromMatrixPosition(B.matrixWorld))}(me.isMeshPhongMaterial||me.isMeshToonMaterial||me.isMeshLambertMaterial||me.isMeshBasicMaterial||me.isMeshStandardMaterial||me.isShaderMaterial)&&tn.setValue(re,"isOrthographic",B.isOrthographicCamera===!0),(me.isMeshPhongMaterial||me.isMeshToonMaterial||me.isMeshLambertMaterial||me.isMeshBasicMaterial||me.isMeshStandardMaterial||me.isShaderMaterial||me.isShadowMaterial||Se.isSkinnedMesh)&&tn.setValue(re,"viewMatrix",B.matrixWorldInverse)}if(Se.isSkinnedMesh){tn.setOptional(re,Se,"bindMatrix"),tn.setOptional(re,Se,"bindMatrixInverse");const hn=Se.skeleton;hn&&(Ze.floatVertexTextures?(hn.boneTexture===null&&hn.computeBoneTexture(),tn.setValue(re,"boneTexture",hn.boneTexture,it),tn.setValue(re,"boneTextureSize",hn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const xn=ve.morphAttributes;if((xn.position!==void 0||xn.normal!==void 0||xn.color!==void 0&&Ze.isWebGL2===!0)&&$t.update(Se,ve,ln),(on||Ot.receiveShadow!==Se.receiveShadow)&&(Ot.receiveShadow=Se.receiveShadow,tn.setValue(re,"receiveShadow",Se.receiveShadow)),me.isMeshGouraudMaterial&&me.envMap!==null&&(Fn.envMap.value=rt,Fn.flipEnvMap.value=rt.isCubeTexture&&rt.isRenderTargetTexture===!1?-1:1),on&&(tn.setValue(re,"toneMappingExposure",C.toneMappingExposure),Ot.needsLights&&yr(Fn,bn),Ke&&me.fog===!0&&ot.refreshFogUniforms(Fn,Ke),ot.refreshMaterialUniforms(Fn,me,xe,de,_e),gS.upload(re,Ot.uniformsList,Fn,it)),me.isShaderMaterial&&me.uniformsNeedUpdate===!0&&(gS.upload(re,Ot.uniformsList,Fn,it),me.uniformsNeedUpdate=!1),me.isSpriteMaterial&&tn.setValue(re,"center",Se.center),tn.setValue(re,"modelViewMatrix",Se.modelViewMatrix),tn.setValue(re,"normalMatrix",Se.normalMatrix),tn.setValue(re,"modelMatrix",Se.matrixWorld),me.isShaderMaterial||me.isRawShaderMaterial){const hn=me.uniformsGroups;for(let zn=0,Mn=hn.length;zn<Mn;zn++)if(Ze.isWebGL2){const Kt=hn[zn];Ae.update(Kt,ln),Ae.bind(Kt,ln)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return ln}function yr(B,le){B.ambientLightColor.needsUpdate=le,B.lightProbe.needsUpdate=le,B.directionalLights.needsUpdate=le,B.directionalLightShadows.needsUpdate=le,B.pointLights.needsUpdate=le,B.pointLightShadows.needsUpdate=le,B.spotLights.needsUpdate=le,B.spotLightShadows.needsUpdate=le,B.rectAreaLights.needsUpdate=le,B.hemisphereLights.needsUpdate=le}function Z(B){return B.isMeshLambertMaterial||B.isMeshToonMaterial||B.isMeshPhongMaterial||B.isMeshStandardMaterial||B.isShadowMaterial||B.isShaderMaterial&&B.lights===!0}this.getActiveCubeFace=function(){return I},this.getActiveMipmapLevel=function(){return O},this.getRenderTarget=function(){return F},this.setRenderTargetTextures=function(B,le,ve){je.get(B.texture).__webglTexture=le,je.get(B.depthTexture).__webglTexture=ve;const me=je.get(B);me.__hasExternalTextures=!0,me.__hasExternalTextures&&(me.__autoAllocateDepthBuffer=ve===void 0,me.__autoAllocateDepthBuffer||Fe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),me.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(B,le){const ve=je.get(B);ve.__webglFramebuffer=le,ve.__useDefaultFramebuffer=le===void 0},this.setRenderTarget=function(B,le=0,ve=0){F=B,I=le,O=ve;let me=!0,Se=null,Ke=!1,Je=!1;if(B){const rt=je.get(B);rt.__useDefaultFramebuffer!==void 0?(Xe.bindFramebuffer(re.FRAMEBUFFER,null),me=!1):rt.__webglFramebuffer===void 0?it.setupRenderTarget(B):rt.__hasExternalTextures&&it.rebindTextures(B,je.get(B.texture).__webglTexture,je.get(B.depthTexture).__webglTexture);const pt=B.texture;(pt.isData3DTexture||pt.isDataArrayTexture||pt.isCompressedArrayTexture)&&(Je=!0);const Ne=je.get(B).__webglFramebuffer;B.isWebGLCubeRenderTarget?(Se=Ne[le],Ke=!0):Ze.isWebGL2&&B.samples>0&&it.useMultisampledRTT(B)===!1?Se=je.get(B).__webglMultisampledFramebuffer:Se=Ne,U.copy(B.viewport),ce.copy(B.scissor),ie=B.scissorTest}else U.copy(K).multiplyScalar(xe).floor(),ce.copy(se).multiplyScalar(xe).floor(),ie=Y;if(Xe.bindFramebuffer(re.FRAMEBUFFER,Se)&&Ze.drawBuffers&&me&&Xe.drawBuffers(B,Se),Xe.viewport(U),Xe.scissor(ce),Xe.setScissorTest(ie),Ke){const rt=je.get(B.texture);re.framebufferTexture2D(re.FRAMEBUFFER,re.COLOR_ATTACHMENT0,re.TEXTURE_CUBE_MAP_POSITIVE_X+le,rt.__webglTexture,ve)}else if(Je){const rt=je.get(B.texture),pt=le||0;re.framebufferTextureLayer(re.FRAMEBUFFER,re.COLOR_ATTACHMENT0,rt.__webglTexture,ve||0,pt)}k=-1},this.readRenderTargetPixels=function(B,le,ve,me,Se,Ke,Je){if(!(B&&B.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let at=je.get(B).__webglFramebuffer;if(B.isWebGLCubeRenderTarget&&Je!==void 0&&(at=at[Je]),at){Xe.bindFramebuffer(re.FRAMEBUFFER,at);try{const rt=B.texture,pt=rt.format,Ne=rt.type;if(pt!==jr&&fe.convert(pt)!==re.getParameter(re.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const It=Ne===ss&&(Fe.has("EXT_color_buffer_half_float")||Ze.isWebGL2&&Fe.has("EXT_color_buffer_float"));if(Ne!==la&&fe.convert(Ne)!==re.getParameter(re.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Ne===Kr&&(Ze.isWebGL2||Fe.has("OES_texture_float")||Fe.has("WEBGL_color_buffer_float")))&&!It){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}le>=0&&le<=B.width-me&&ve>=0&&ve<=B.height-Se&&re.readPixels(le,ve,me,Se,fe.convert(pt),fe.convert(Ne),Ke)}finally{const rt=F!==null?je.get(F).__webglFramebuffer:null;Xe.bindFramebuffer(re.FRAMEBUFFER,rt)}}},this.copyFramebufferToTexture=function(B,le,ve=0){const me=Math.pow(2,-ve),Se=Math.floor(le.image.width*me),Ke=Math.floor(le.image.height*me);it.setTexture2D(le,0),re.copyTexSubImage2D(re.TEXTURE_2D,ve,0,0,B.x,B.y,Se,Ke),Xe.unbindTexture()},this.copyTextureToTexture=function(B,le,ve,me=0){const Se=le.image.width,Ke=le.image.height,Je=fe.convert(ve.format),at=fe.convert(ve.type);it.setTexture2D(ve,0),re.pixelStorei(re.UNPACK_FLIP_Y_WEBGL,ve.flipY),re.pixelStorei(re.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ve.premultiplyAlpha),re.pixelStorei(re.UNPACK_ALIGNMENT,ve.unpackAlignment),le.isDataTexture?re.texSubImage2D(re.TEXTURE_2D,me,B.x,B.y,Se,Ke,Je,at,le.image.data):le.isCompressedTexture?re.compressedTexSubImage2D(re.TEXTURE_2D,me,B.x,B.y,le.mipmaps[0].width,le.mipmaps[0].height,Je,le.mipmaps[0].data):re.texSubImage2D(re.TEXTURE_2D,me,B.x,B.y,Je,at,le.image),me===0&&ve.generateMipmaps&&re.generateMipmap(re.TEXTURE_2D),Xe.unbindTexture()},this.copyTextureToTexture3D=function(B,le,ve,me,Se=0){if(C.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Ke=B.max.x-B.min.x+1,Je=B.max.y-B.min.y+1,at=B.max.z-B.min.z+1,rt=fe.convert(me.format),pt=fe.convert(me.type);let Ne;if(me.isData3DTexture)it.setTexture3D(me,0),Ne=re.TEXTURE_3D;else if(me.isDataArrayTexture)it.setTexture2DArray(me,0),Ne=re.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}re.pixelStorei(re.UNPACK_FLIP_Y_WEBGL,me.flipY),re.pixelStorei(re.UNPACK_PREMULTIPLY_ALPHA_WEBGL,me.premultiplyAlpha),re.pixelStorei(re.UNPACK_ALIGNMENT,me.unpackAlignment);const It=re.getParameter(re.UNPACK_ROW_LENGTH),xt=re.getParameter(re.UNPACK_IMAGE_HEIGHT),wt=re.getParameter(re.UNPACK_SKIP_PIXELS),Ht=re.getParameter(re.UNPACK_SKIP_ROWS),Zt=re.getParameter(re.UNPACK_SKIP_IMAGES),jt=ve.isCompressedTexture?ve.mipmaps[0]:ve.image;re.pixelStorei(re.UNPACK_ROW_LENGTH,jt.width),re.pixelStorei(re.UNPACK_IMAGE_HEIGHT,jt.height),re.pixelStorei(re.UNPACK_SKIP_PIXELS,B.min.x),re.pixelStorei(re.UNPACK_SKIP_ROWS,B.min.y),re.pixelStorei(re.UNPACK_SKIP_IMAGES,B.min.z),ve.isDataTexture||ve.isData3DTexture?re.texSubImage3D(Ne,Se,le.x,le.y,le.z,Ke,Je,at,rt,pt,jt.data):ve.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),re.compressedTexSubImage3D(Ne,Se,le.x,le.y,le.z,Ke,Je,at,rt,jt.data)):re.texSubImage3D(Ne,Se,le.x,le.y,le.z,Ke,Je,at,rt,pt,jt),re.pixelStorei(re.UNPACK_ROW_LENGTH,It),re.pixelStorei(re.UNPACK_IMAGE_HEIGHT,xt),re.pixelStorei(re.UNPACK_SKIP_PIXELS,wt),re.pixelStorei(re.UNPACK_SKIP_ROWS,Ht),re.pixelStorei(re.UNPACK_SKIP_IMAGES,Zt),Se===0&&me.generateMipmaps&&re.generateMipmap(Ne),Xe.unbindTexture()},this.initTexture=function(B){B.isCubeTexture?it.setTextureCube(B,0):B.isData3DTexture?it.setTexture3D(B,0):B.isDataArrayTexture||B.isCompressedArrayTexture?it.setTexture2DArray(B,0):it.setTexture2D(B,0),Xe.unbindTexture()},this.resetState=function(){I=0,O=0,F=null,Xe.reset(),z.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return $c}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Tn?xc:R$}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===xc?Tn:Io}}class kF extends N${}kF.prototype.isWebGL1Renderer=!0;class k${constructor(e,n=25e-5){this.isFogExp2=!0,this.name="",this.color=new Ct(e),this.density=n}clone(){return new k$(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class P${constructor(e,n=1,r=1e3){this.isFog=!0,this.name="",this.color=new Ct(e),this.near=n,this.far=r}clone(){return new P$(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class jg extends Xn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class t_{constructor(e,n){this.isInterleavedBuffer=!0,this.array=e,this.stride=n,this.count=e!==void 0?e.length/n:0,this.usage=tE,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ca()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,n,r){e*=this.stride,r*=n.stride;for(let s=0,a=this.stride;s<a;s++)this.array[e+s]=n.array[r+s];return this}set(e,n=0){return this.array.set(e,n),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ca()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const n=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(n,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ca()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const so=new te;class lo{constructor(e,n,r,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=n,this.offset=r,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let n=0,r=this.data.count;n<r;n++)so.fromBufferAttribute(this,n),so.applyMatrix4(e),this.setXYZ(n,so.x,so.y,so.z);return this}applyNormalMatrix(e){for(let n=0,r=this.count;n<r;n++)so.fromBufferAttribute(this,n),so.applyNormalMatrix(e),this.setXYZ(n,so.x,so.y,so.z);return this}transformDirection(e){for(let n=0,r=this.count;n<r;n++)so.fromBufferAttribute(this,n),so.transformDirection(e),this.setXYZ(n,so.x,so.y,so.z);return this}setX(e,n){return this.normalized&&(n=kn(n,this.array)),this.data.array[e*this.data.stride+this.offset]=n,this}setY(e,n){return this.normalized&&(n=kn(n,this.array)),this.data.array[e*this.data.stride+this.offset+1]=n,this}setZ(e,n){return this.normalized&&(n=kn(n,this.array)),this.data.array[e*this.data.stride+this.offset+2]=n,this}setW(e,n){return this.normalized&&(n=kn(n,this.array)),this.data.array[e*this.data.stride+this.offset+3]=n,this}getX(e){let n=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(n=oa(n,this.array)),n}getY(e){let n=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(n=oa(n,this.array)),n}getZ(e){let n=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(n=oa(n,this.array)),n}getW(e){let n=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(n=oa(n,this.array)),n}setXY(e,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(n=kn(n,this.array),r=kn(r,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=r,this}setXYZ(e,n,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(n=kn(n,this.array),r=kn(r,this.array),s=kn(s,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=r,this.data.array[e+2]=s,this}setXYZW(e,n,r,s,a){return e=e*this.data.stride+this.offset,this.normalized&&(n=kn(n,this.array),r=kn(r,this.array),s=kn(s,this.array),a=kn(a,this.array)),this.data.array[e+0]=n,this.data.array[e+1]=r,this.data.array[e+2]=s,this.data.array[e+3]=a,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)n.push(this.data.array[s+a])}return new Qn(new this.array.constructor(n),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new lo(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const n=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)n.push(this.data.array[s+a])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class bM extends rr{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ct(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Zm;const Fv=new te,qm=new te,Qm=new te,eg=new mt,Uv=new mt,PF=new pn,f0=new te,Gv=new te,p0=new te,dN=new mt,bC=new mt,fN=new mt;class DF extends Xn{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",Zm===void 0){Zm=new rn;const n=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new t_(n,5);Zm.setIndex([0,1,2,0,2,3]),Zm.setAttribute("position",new lo(r,3,0,!1)),Zm.setAttribute("uv",new lo(r,2,3,!1))}this.geometry=Zm,this.material=e!==void 0?e:new bM,this.center=new mt(.5,.5)}raycast(e,n){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),qm.setFromMatrixScale(this.matrixWorld),PF.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Qm.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&qm.multiplyScalar(-Qm.z);const r=this.material.rotation;let s,a;r!==0&&(a=Math.cos(r),s=Math.sin(r));const l=this.center;m0(f0.set(-.5,-.5,0),Qm,l,qm,s,a),m0(Gv.set(.5,-.5,0),Qm,l,qm,s,a),m0(p0.set(.5,.5,0),Qm,l,qm,s,a),dN.set(0,0),bC.set(1,0),fN.set(1,1);let u=e.ray.intersectTriangle(f0,Gv,p0,!1,Fv);if(u===null&&(m0(Gv.set(-.5,.5,0),Qm,l,qm,s,a),bC.set(0,1),u=e.ray.intersectTriangle(f0,p0,Gv,!1,Fv),u===null))return;const d=e.ray.origin.distanceTo(Fv);d<e.near||d>e.far||n.push({distance:d,point:Fv.clone(),uv:Co.getInterpolation(Fv,f0,Gv,p0,dN,bC,fN,new mt),face:null,object:this})}copy(e,n){return super.copy(e,n),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function m0(i,e,n,r,s,a){eg.subVectors(i,n).addScalar(.5).multiply(r),s!==void 0?(Uv.x=a*eg.x-s*eg.y,Uv.y=s*eg.x+a*eg.y):Uv.copy(eg),i.copy(e),i.x+=Uv.x,i.y+=Uv.y,i.applyMatrix4(PF)}const g0=new te,pN=new te;class BF extends Xn{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const n=e.levels;for(let r=0,s=n.length;r<s;r++){const a=n[r];this.addLevel(a.object.clone(),a.distance,a.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,n=0,r=0){n=Math.abs(n);const s=this.levels;let a;for(a=0;a<s.length&&!(n<s[a].distance);a++);return s.splice(a,0,{distance:n,hysteresis:r,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const n=this.levels;if(n.length>0){let r,s;for(r=1,s=n.length;r<s;r++){let a=n[r].distance;if(n[r].object.visible&&(a-=a*n[r].hysteresis),e<a)break}return n[r-1].object}return null}raycast(e,n){if(this.levels.length>0){g0.setFromMatrixPosition(this.matrixWorld);const s=e.ray.origin.distanceTo(g0);this.getObjectForDistance(s).raycast(e,n)}}update(e){const n=this.levels;if(n.length>1){g0.setFromMatrixPosition(e.matrixWorld),pN.setFromMatrixPosition(this.matrixWorld);const r=g0.distanceTo(pN)/e.zoom;n[0].object.visible=!0;let s,a;for(s=1,a=n.length;s<a;s++){let l=n[s].distance;if(n[s].object.visible&&(l-=l*n[s].hysteresis),r>=l)n[s-1].object.visible=!1,n[s].object.visible=!0;else break}for(this._currentLevel=s-1;s<a;s++)n[s].object.visible=!1}}toJSON(e){const n=super.toJSON(e);this.autoUpdate===!1&&(n.object.autoUpdate=!1),n.object.levels=[];const r=this.levels;for(let s=0,a=r.length;s<a;s++){const l=r[s];n.object.levels.push({object:l.object.uuid,distance:l.distance,hysteresis:l.hysteresis})}return n}}const mN=new te,gN=new Hn,_N=new Hn,pX=new te,vN=new pn,tg=new te,AC=new js,TN=new pn,CC=new Ip;class D$ extends Pn{constructor(e,n){super(e,n),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new pn,this.bindMatrixInverse=new pn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Xs),this.boundingBox.makeEmpty();const n=e.getAttribute("position");for(let r=0;r<n.count;r++)tg.fromBufferAttribute(n,r),this.applyBoneTransform(r,tg),this.boundingBox.expandByPoint(tg)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new js),this.boundingSphere.makeEmpty();const n=e.getAttribute("position");for(let r=0;r<n.count;r++)tg.fromBufferAttribute(n,r),this.applyBoneTransform(r,tg),this.boundingSphere.expandByPoint(tg)}copy(e,n){return super.copy(e,n),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,n){const r=this.material,s=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),AC.copy(this.boundingSphere),AC.applyMatrix4(s),e.ray.intersectsSphere(AC)!==!1&&(TN.copy(s).invert(),CC.copy(e.ray).applyMatrix4(TN),!(this.boundingBox!==null&&CC.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,n,CC)))}getVertexPosition(e,n){return super.getVertexPosition(e,n),this.applyBoneTransform(e,n),n}bind(e,n){this.skeleton=e,n===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),n=this.matrixWorld),this.bindMatrix.copy(n),this.bindMatrixInverse.copy(n).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Hn,n=this.geometry.attributes.skinWeight;for(let r=0,s=n.count;r<s;r++){e.fromBufferAttribute(n,r);const a=1/e.manhattanLength();a!==1/0?e.multiplyScalar(a):e.set(1,0,0,0),n.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,n){const r=this.skeleton,s=this.geometry;gN.fromBufferAttribute(s.attributes.skinIndex,e),_N.fromBufferAttribute(s.attributes.skinWeight,e),mN.copy(n).applyMatrix4(this.bindMatrix),n.set(0,0,0);for(let a=0;a<4;a++){const l=_N.getComponent(a);if(l!==0){const u=gN.getComponent(a);vN.multiplyMatrices(r.bones[u].matrixWorld,r.boneInverses[u]),n.addScaledVector(pX.copy(mN).applyMatrix4(vN),l)}}return n.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,n){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,n)}}class $E extends Xn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class ap extends ni{constructor(e=null,n=1,r=1,s,a,l,u,d,h=tr,f=tr,p,m){super(null,l,u,d,h,f,s,a,p,m),this.isDataTexture=!0,this.image={data:e,width:n,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const EN=new pn,mX=new pn;class n_{constructor(e=[],n=[]){this.uuid=ca(),this.bones=e.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,n=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),n.length===0)this.calculateInverses();else if(e.length!==n.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,s=this.bones.length;r<s;r++)this.boneInverses.push(new pn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,n=this.bones.length;e<n;e++){const r=new pn;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,n=this.bones.length;e<n;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,n=this.bones.length;e<n;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,n=this.boneInverses,r=this.boneMatrices,s=this.boneTexture;for(let a=0,l=e.length;a<l;a++){const u=e[a]?e[a].matrixWorld:mX;EN.multiplyMatrices(u,n[a]),EN.toArray(r,a*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new n_(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=SF(e),e=Math.max(e,4);const n=new Float32Array(e*e*4);n.set(this.boneMatrices);const r=new ap(n,e,e,jr,Kr);return r.needsUpdate=!0,this.boneMatrices=n,this.boneTexture=r,this.boneTextureSize=e,this}getBoneByName(e){for(let n=0,r=this.bones.length;n<r;n++){const s=this.bones[n];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,n){this.uuid=e.uuid;for(let r=0,s=e.bones.length;r<s;r++){const a=e.bones[r];let l=n[a];l===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",a),l=new $E),this.bones.push(l),this.boneInverses.push(new pn().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const n=this.bones,r=this.boneInverses;for(let s=0,a=n.length;s<a;s++){const l=n[s];e.bones.push(l.uuid);const u=r[s];e.boneInverses.push(u.toArray())}return e}}class ld extends Qn{constructor(e,n,r,s=1){super(e,n,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const ng=new pn,yN=new pn,_0=[],SN=new Xs,gX=new pn,Hv=new Pn,Vv=new js;class B$ extends Pn{constructor(e,n,r){super(e,n),this.isInstancedMesh=!0,this.instanceMatrix=new ld(new Float32Array(r*16),16),this.instanceColor=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<r;s++)this.setMatrixAt(s,gX)}computeBoundingBox(){const e=this.geometry,n=this.count;this.boundingBox===null&&(this.boundingBox=new Xs),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<n;r++)this.getMatrixAt(r,ng),SN.copy(e.boundingBox).applyMatrix4(ng),this.boundingBox.union(SN)}computeBoundingSphere(){const e=this.geometry,n=this.count;this.boundingSphere===null&&(this.boundingSphere=new js),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<n;r++)this.getMatrixAt(r,ng),Vv.copy(e.boundingSphere).applyMatrix4(ng),this.boundingSphere.union(Vv)}copy(e,n){return super.copy(e,n),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,n){n.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,n){n.fromArray(this.instanceMatrix.array,e*16)}raycast(e,n){const r=this.matrixWorld,s=this.count;if(Hv.geometry=this.geometry,Hv.material=this.material,Hv.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Vv.copy(this.boundingSphere),Vv.applyMatrix4(r),e.ray.intersectsSphere(Vv)!==!1))for(let a=0;a<s;a++){this.getMatrixAt(a,ng),yN.multiplyMatrices(r,ng),Hv.matrixWorld=yN,Hv.raycast(e,_0);for(let l=0,u=_0.length;l<u;l++){const d=_0[l];d.instanceId=a,d.object=this,n.push(d)}_0.length=0}}setColorAt(e,n){this.instanceColor===null&&(this.instanceColor=new ld(new Float32Array(this.instanceMatrix.count*3),3)),n.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,n){n.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class fi extends rr{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ct(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const $N=new te,bN=new te,AN=new pn,xC=new Ip,v0=new js;let Ki=class extends Xn{constructor(e=new rn,n=new fi){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,r=[0];for(let s=1,a=n.count;s<a;s++)$N.fromBufferAttribute(n,s-1),bN.fromBufferAttribute(n,s),r[s]=r[s-1],r[s]+=$N.distanceTo(bN);e.setAttribute("lineDistance",new Yt(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,n){const r=this.geometry,s=this.matrixWorld,a=e.params.Line.threshold,l=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),v0.copy(r.boundingSphere),v0.applyMatrix4(s),v0.radius+=a,e.ray.intersectsSphere(v0)===!1)return;AN.copy(s).invert(),xC.copy(e.ray).applyMatrix4(AN);const u=a/((this.scale.x+this.scale.y+this.scale.z)/3),d=u*u,h=new te,f=new te,p=new te,m=new te,T=this.isLineSegments?2:1,E=r.index,y=r.attributes.position;if(E!==null){const S=Math.max(0,l.start),A=Math.min(E.count,l.start+l.count);for(let C=S,R=A-1;C<R;C+=T){const I=E.getX(C),O=E.getX(C+1);if(h.fromBufferAttribute(y,I),f.fromBufferAttribute(y,O),xC.distanceSqToSegment(h,f,m,p)>d)continue;m.applyMatrix4(this.matrixWorld);const k=e.ray.origin.distanceTo(m);k<e.near||k>e.far||n.push({distance:k,point:p.clone().applyMatrix4(this.matrixWorld),index:C,face:null,faceIndex:null,object:this})}}else{const S=Math.max(0,l.start),A=Math.min(y.count,l.start+l.count);for(let C=S,R=A-1;C<R;C+=T){if(h.fromBufferAttribute(y,C),f.fromBufferAttribute(y,C+1),xC.distanceSqToSegment(h,f,m,p)>d)continue;m.applyMatrix4(this.matrixWorld);const O=e.ray.origin.distanceTo(m);O<e.near||O>e.far||n.push({distance:O,point:p.clone().applyMatrix4(this.matrixWorld),index:C,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const s=n[r[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,l=s.length;a<l;a++){const u=s[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=a}}}}};const CN=new te,xN=new te;class Ja extends Ki{constructor(e,n){super(e,n),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const n=e.attributes.position,r=[];for(let s=0,a=n.count;s<a;s+=2)CN.fromBufferAttribute(n,s),xN.fromBufferAttribute(n,s+1),r[s]=s===0?0:r[s-1],r[s+1]=r[s]+CN.distanceTo(xN);e.setAttribute("lineDistance",new Yt(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class F$ extends Ki{constructor(e,n){super(e,n),this.isLineLoop=!0,this.type="LineLoop"}}class bE extends rr{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ct(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const RN=new pn,FR=new Ip,T0=new js,E0=new te;class U$ extends Xn{constructor(e=new rn,n=new bE){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),this.material=e.material,this.geometry=e.geometry,this}raycast(e,n){const r=this.geometry,s=this.matrixWorld,a=e.params.Points.threshold,l=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),T0.copy(r.boundingSphere),T0.applyMatrix4(s),T0.radius+=a,e.ray.intersectsSphere(T0)===!1)return;RN.copy(s).invert(),FR.copy(e.ray).applyMatrix4(RN);const u=a/((this.scale.x+this.scale.y+this.scale.z)/3),d=u*u,h=r.index,p=r.attributes.position;if(h!==null){const m=Math.max(0,l.start),T=Math.min(h.count,l.start+l.count);for(let E=m,b=T;E<b;E++){const y=h.getX(E);E0.fromBufferAttribute(p,y),wN(E0,y,d,s,e,n,this)}}else{const m=Math.max(0,l.start),T=Math.min(p.count,l.start+l.count);for(let E=m,b=T;E<b;E++)E0.fromBufferAttribute(p,E),wN(E0,E,d,s,e,n,this)}}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const s=n[r[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,l=s.length;a<l;a++){const u=s[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[u]=a}}}}}function wN(i,e,n,r,s,a,l){const u=FR.distanceSqToPoint(i);if(u<n){const d=new te;FR.closestPointToPoint(i,d),d.applyMatrix4(r);const h=s.ray.origin.distanceTo(d);if(h<s.near||h>s.far)return;a.push({distance:h,distanceToRay:Math.sqrt(u),point:d,index:e,face:null,object:l})}}class _X extends ni{constructor(e,n,r,s,a,l,u,d,h){super(e,n,r,s,a,l,u,d,h),this.isVideoTexture=!0,this.minFilter=l!==void 0?l:Gn,this.magFilter=a!==void 0?a:Gn,this.generateMipmaps=!1;const f=this;function p(){f.needsUpdate=!0,e.requestVideoFrameCallback(p)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(p)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class vX extends ni{constructor(e,n){super({width:e,height:n}),this.isFramebufferTexture=!0,this.magFilter=tr,this.minFilter=tr,this.generateMipmaps=!1,this.needsUpdate=!0}}class AM extends ni{constructor(e,n,r,s,a,l,u,d,h,f,p,m){super(null,l,u,d,h,f,s,a,p,m),this.isCompressedTexture=!0,this.image={width:n,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class TX extends AM{constructor(e,n,r,s,a,l){super(e,n,r,a,l),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=Pi}}class EX extends ni{constructor(e,n,r,s,a,l,u,d,h){super(e,n,r,s,a,l,u,d,h),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Fl{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,n){const r=this.getUtoTmapping(e);return this.getPoint(r,n)}getPoints(e=5){const n=[];for(let r=0;r<=e;r++)n.push(this.getPoint(r/e));return n}getSpacedPoints(e=5){const n=[];for(let r=0;r<=e;r++)n.push(this.getPointAt(r/e));return n}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const n=[];let r,s=this.getPoint(0),a=0;n.push(0);for(let l=1;l<=e;l++)r=this.getPoint(l/e),a+=r.distanceTo(s),n.push(a),s=r;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,n){const r=this.getLengths();let s=0;const a=r.length;let l;n?l=n:l=e*r[a-1];let u=0,d=a-1,h;for(;u<=d;)if(s=Math.floor(u+(d-u)/2),h=r[s]-l,h<0)u=s+1;else if(h>0)d=s-1;else{d=s;break}if(s=d,r[s]===l)return s/(a-1);const f=r[s],m=r[s+1]-f,T=(l-f)/m;return(s+T)/(a-1)}getTangent(e,n){let s=e-1e-4,a=e+1e-4;s<0&&(s=0),a>1&&(a=1);const l=this.getPoint(s),u=this.getPoint(a),d=n||(l.isVector2?new mt:new te);return d.copy(u).sub(l).normalize(),d}getTangentAt(e,n){const r=this.getUtoTmapping(e);return this.getTangent(r,n)}computeFrenetFrames(e,n){const r=new te,s=[],a=[],l=[],u=new te,d=new pn;for(let T=0;T<=e;T++){const E=T/e;s[T]=this.getTangentAt(E,new te)}a[0]=new te,l[0]=new te;let h=Number.MAX_VALUE;const f=Math.abs(s[0].x),p=Math.abs(s[0].y),m=Math.abs(s[0].z);f<=h&&(h=f,r.set(1,0,0)),p<=h&&(h=p,r.set(0,1,0)),m<=h&&r.set(0,0,1),u.crossVectors(s[0],r).normalize(),a[0].crossVectors(s[0],u),l[0].crossVectors(s[0],a[0]);for(let T=1;T<=e;T++){if(a[T]=a[T-1].clone(),l[T]=l[T-1].clone(),u.crossVectors(s[T-1],s[T]),u.length()>Number.EPSILON){u.normalize();const E=Math.acos(pr(s[T-1].dot(s[T]),-1,1));a[T].applyMatrix4(d.makeRotationAxis(u,E))}l[T].crossVectors(s[T],a[T])}if(n===!0){let T=Math.acos(pr(a[0].dot(a[e]),-1,1));T/=e,s[0].dot(u.crossVectors(a[0],a[e]))>0&&(T=-T);for(let E=1;E<=e;E++)a[E].applyMatrix4(d.makeRotationAxis(s[E],T*E)),l[E].crossVectors(s[E],a[E])}return{tangents:s,normals:a,binormals:l}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class G$ extends Fl{constructor(e=0,n=0,r=1,s=1,a=0,l=Math.PI*2,u=!1,d=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=n,this.xRadius=r,this.yRadius=s,this.aStartAngle=a,this.aEndAngle=l,this.aClockwise=u,this.aRotation=d}getPoint(e,n){const r=n||new mt,s=Math.PI*2;let a=this.aEndAngle-this.aStartAngle;const l=Math.abs(a)<Number.EPSILON;for(;a<0;)a+=s;for(;a>s;)a-=s;a<Number.EPSILON&&(l?a=0:a=s),this.aClockwise===!0&&!l&&(a===s?a=-s:a=a-s);const u=this.aStartAngle+e*a;let d=this.aX+this.xRadius*Math.cos(u),h=this.aY+this.yRadius*Math.sin(u);if(this.aRotation!==0){const f=Math.cos(this.aRotation),p=Math.sin(this.aRotation),m=d-this.aX,T=h-this.aY;d=m*f-T*p+this.aX,h=m*p+T*f+this.aY}return r.set(d,h)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class FF extends G${constructor(e,n,r,s,a,l){super(e,n,r,r,s,a,l),this.isArcCurve=!0,this.type="ArcCurve"}}function CM(){let i=0,e=0,n=0,r=0;function s(a,l,u,d){i=a,e=u,n=-3*a+3*l-2*u-d,r=2*a-2*l+u+d}return{initCatmullRom:function(a,l,u,d,h){s(l,u,h*(u-a),h*(d-l))},initNonuniformCatmullRom:function(a,l,u,d,h,f,p){let m=(l-a)/h-(u-a)/(h+f)+(u-l)/f,T=(u-l)/f-(d-l)/(f+p)+(d-u)/p;m*=f,T*=f,s(l,u,m,T)},calc:function(a){const l=a*a,u=l*a;return i+e*a+n*l+r*u}}}const y0=new te,RC=new CM,wC=new CM,MC=new CM;class UF extends Fl{constructor(e=[],n=!1,r="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=n,this.curveType=r,this.tension=s}getPoint(e,n=new te){const r=n,s=this.points,a=s.length,l=(a-(this.closed?0:1))*e;let u=Math.floor(l),d=l-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/a)+1)*a:d===0&&u===a-1&&(u=a-2,d=1);let h,f;this.closed||u>0?h=s[(u-1)%a]:(y0.subVectors(s[0],s[1]).add(s[0]),h=y0);const p=s[u%a],m=s[(u+1)%a];if(this.closed||u+2<a?f=s[(u+2)%a]:(y0.subVectors(s[a-1],s[a-2]).add(s[a-1]),f=y0),this.curveType==="centripetal"||this.curveType==="chordal"){const T=this.curveType==="chordal"?.5:.25;let E=Math.pow(h.distanceToSquared(p),T),b=Math.pow(p.distanceToSquared(m),T),y=Math.pow(m.distanceToSquared(f),T);b<1e-4&&(b=1),E<1e-4&&(E=b),y<1e-4&&(y=b),RC.initNonuniformCatmullRom(h.x,p.x,m.x,f.x,E,b,y),wC.initNonuniformCatmullRom(h.y,p.y,m.y,f.y,E,b,y),MC.initNonuniformCatmullRom(h.z,p.z,m.z,f.z,E,b,y)}else this.curveType==="catmullrom"&&(RC.initCatmullRom(h.x,p.x,m.x,f.x,this.tension),wC.initCatmullRom(h.y,p.y,m.y,f.y,this.tension),MC.initCatmullRom(h.z,p.z,m.z,f.z,this.tension));return r.set(RC.calc(d),wC.calc(d),MC.calc(d)),r}copy(e){super.copy(e),this.points=[];for(let n=0,r=e.points.length;n<r;n++){const s=e.points[n];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let n=0,r=this.points.length;n<r;n++){const s=this.points[n];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,r=e.points.length;n<r;n++){const s=e.points[n];this.points.push(new te().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function MN(i,e,n,r,s){const a=(r-e)*.5,l=(s-n)*.5,u=i*i,d=i*u;return(2*n-2*r+a+l)*d+(-3*n+3*r-2*a-l)*u+a*i+n}function yX(i,e){const n=1-i;return n*n*e}function SX(i,e){return 2*(1-i)*i*e}function $X(i,e){return i*i*e}function wT(i,e,n,r){return yX(i,e)+SX(i,n)+$X(i,r)}function bX(i,e){const n=1-i;return n*n*n*e}function AX(i,e){const n=1-i;return 3*n*n*i*e}function CX(i,e){return 3*(1-i)*i*i*e}function xX(i,e){return i*i*i*e}function MT(i,e,n,r,s){return bX(i,e)+AX(i,n)+CX(i,r)+xX(i,s)}class xM extends Fl{constructor(e=new mt,n=new mt,r=new mt,s=new mt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=n,this.v2=r,this.v3=s}getPoint(e,n=new mt){const r=n,s=this.v0,a=this.v1,l=this.v2,u=this.v3;return r.set(MT(e,s.x,a.x,l.x,u.x),MT(e,s.y,a.y,l.y,u.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class GF extends Fl{constructor(e=new te,n=new te,r=new te,s=new te){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=n,this.v2=r,this.v3=s}getPoint(e,n=new te){const r=n,s=this.v0,a=this.v1,l=this.v2,u=this.v3;return r.set(MT(e,s.x,a.x,l.x,u.x),MT(e,s.y,a.y,l.y,u.y),MT(e,s.z,a.z,l.z,u.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class H$ extends Fl{constructor(e=new mt,n=new mt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=n}getPoint(e,n=new mt){const r=n;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,n){return this.getPoint(e,n)}getTangent(e,n=new mt){return n.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,n){return this.getTangent(e,n)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class HF extends Fl{constructor(e=new te,n=new te){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=n}getPoint(e,n=new te){const r=n;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,n){return this.getPoint(e,n)}getTangent(e,n=new te){return n.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,n){return this.getTangent(e,n)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class RM extends Fl{constructor(e=new mt,n=new mt,r=new mt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=n,this.v2=r}getPoint(e,n=new mt){const r=n,s=this.v0,a=this.v1,l=this.v2;return r.set(wT(e,s.x,a.x,l.x),wT(e,s.y,a.y,l.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class wM extends Fl{constructor(e=new te,n=new te,r=new te){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=n,this.v2=r}getPoint(e,n=new te){const r=n,s=this.v0,a=this.v1,l=this.v2;return r.set(wT(e,s.x,a.x,l.x),wT(e,s.y,a.y,l.y),wT(e,s.z,a.z,l.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class MM extends Fl{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,n=new mt){const r=n,s=this.points,a=(s.length-1)*e,l=Math.floor(a),u=a-l,d=s[l===0?l:l-1],h=s[l],f=s[l>s.length-2?s.length-1:l+1],p=s[l>s.length-3?s.length-1:l+2];return r.set(MN(u,d.x,h.x,f.x,p.x),MN(u,d.y,h.y,f.y,p.y)),r}copy(e){super.copy(e),this.points=[];for(let n=0,r=e.points.length;n<r;n++){const s=e.points[n];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let n=0,r=this.points.length;n<r;n++){const s=this.points[n];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let n=0,r=e.points.length;n<r;n++){const s=e.points[n];this.points.push(new mt().fromArray(s))}return this}}var IM=Object.freeze({__proto__:null,ArcCurve:FF,CatmullRomCurve3:UF,CubicBezierCurve:xM,CubicBezierCurve3:GF,EllipseCurve:G$,LineCurve:H$,LineCurve3:HF,QuadraticBezierCurve:RM,QuadraticBezierCurve3:wM,SplineCurve:MM});class VF extends Fl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),n=this.curves[this.curves.length-1].getPoint(1);e.equals(n)||this.curves.push(new H$(n,e))}getPoint(e,n){const r=e*this.getLength(),s=this.getCurveLengths();let a=0;for(;a<s.length;){if(s[a]>=r){const l=s[a]-r,u=this.curves[a],d=u.getLength(),h=d===0?0:1-l/d;return u.getPointAt(h,n)}a++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let n=0;for(let r=0,s=this.curves.length;r<s;r++)n+=this.curves[r].getLength(),e.push(n);return this.cacheLengths=e,e}getSpacedPoints(e=40){const n=[];for(let r=0;r<=e;r++)n.push(this.getPoint(r/e));return this.autoClose&&n.push(n[0]),n}getPoints(e=12){const n=[];let r;for(let s=0,a=this.curves;s<a.length;s++){const l=a[s],u=l.isEllipseCurve?e*2:l.isLineCurve||l.isLineCurve3?1:l.isSplineCurve?e*l.points.length:e,d=l.getPoints(u);for(let h=0;h<d.length;h++){const f=d[h];r&&r.equals(f)||(n.push(f),r=f)}}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}copy(e){super.copy(e),this.curves=[];for(let n=0,r=e.curves.length;n<r;n++){const s=e.curves[n];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let n=0,r=this.curves.length;n<r;n++){const s=this.curves[n];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let n=0,r=e.curves.length;n<r;n++){const s=e.curves[n];this.curves.push(new IM[s.type]().fromJSON(s))}return this}}class sE extends VF{constructor(e){super(),this.type="Path",this.currentPoint=new mt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let n=1,r=e.length;n<r;n++)this.lineTo(e[n].x,e[n].y);return this}moveTo(e,n){return this.currentPoint.set(e,n),this}lineTo(e,n){const r=new H$(this.currentPoint.clone(),new mt(e,n));return this.curves.push(r),this.currentPoint.set(e,n),this}quadraticCurveTo(e,n,r,s){const a=new RM(this.currentPoint.clone(),new mt(e,n),new mt(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}bezierCurveTo(e,n,r,s,a,l){const u=new xM(this.currentPoint.clone(),new mt(e,n),new mt(r,s),new mt(a,l));return this.curves.push(u),this.currentPoint.set(a,l),this}splineThru(e){const n=[this.currentPoint.clone()].concat(e),r=new MM(n);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,n,r,s,a,l){const u=this.currentPoint.x,d=this.currentPoint.y;return this.absarc(e+u,n+d,r,s,a,l),this}absarc(e,n,r,s,a,l){return this.absellipse(e,n,r,r,s,a,l),this}ellipse(e,n,r,s,a,l,u,d){const h=this.currentPoint.x,f=this.currentPoint.y;return this.absellipse(e+h,n+f,r,s,a,l,u,d),this}absellipse(e,n,r,s,a,l,u,d){const h=new G$(e,n,r,s,a,l,u,d);if(this.curves.length>0){const p=h.getPoint(0);p.equals(this.currentPoint)||this.lineTo(p.x,p.y)}this.curves.push(h);const f=h.getPoint(1);return this.currentPoint.copy(f),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class i_ extends rn{constructor(e=[new mt(0,-.5),new mt(.5,0),new mt(0,.5)],n=12,r=0,s=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:n,phiStart:r,phiLength:s},n=Math.floor(n),s=pr(s,0,Math.PI*2);const a=[],l=[],u=[],d=[],h=[],f=1/n,p=new te,m=new mt,T=new te,E=new te,b=new te;let y=0,S=0;for(let A=0;A<=e.length-1;A++)switch(A){case 0:y=e[A+1].x-e[A].x,S=e[A+1].y-e[A].y,T.x=S*1,T.y=-y,T.z=S*0,b.copy(T),T.normalize(),d.push(T.x,T.y,T.z);break;case e.length-1:d.push(b.x,b.y,b.z);break;default:y=e[A+1].x-e[A].x,S=e[A+1].y-e[A].y,T.x=S*1,T.y=-y,T.z=S*0,E.copy(T),T.x+=b.x,T.y+=b.y,T.z+=b.z,T.normalize(),d.push(T.x,T.y,T.z),b.copy(E)}for(let A=0;A<=n;A++){const C=r+A*f*s,R=Math.sin(C),I=Math.cos(C);for(let O=0;O<=e.length-1;O++){p.x=e[O].x*R,p.y=e[O].y,p.z=e[O].x*I,l.push(p.x,p.y,p.z),m.x=A/n,m.y=O/(e.length-1),u.push(m.x,m.y);const F=d[3*O+0]*R,k=d[3*O+1],D=d[3*O+0]*I;h.push(F,k,D)}}for(let A=0;A<n;A++)for(let C=0;C<e.length-1;C++){const R=C+A*e.length,I=R,O=R+e.length,F=R+e.length+1,k=R+1;a.push(I,O,k),a.push(F,k,O)}this.setIndex(a),this.setAttribute("position",new Yt(l,3)),this.setAttribute("uv",new Yt(u,2)),this.setAttribute("normal",new Yt(h,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new i_(e.points,e.segments,e.phiStart,e.phiLength)}}class AE extends i_{constructor(e=1,n=1,r=4,s=8){const a=new sE;a.absarc(0,-n/2,e,Math.PI*1.5,0),a.absarc(0,n/2,e,0,Math.PI*.5),super(a.getPoints(r),s),this.type="CapsuleGeometry",this.parameters={radius:e,height:n,capSegments:r,radialSegments:s}}static fromJSON(e){return new AE(e.radius,e.length,e.capSegments,e.radialSegments)}}class CE extends rn{constructor(e=1,n=32,r=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:n,thetaStart:r,thetaLength:s},n=Math.max(3,n);const a=[],l=[],u=[],d=[],h=new te,f=new mt;l.push(0,0,0),u.push(0,0,1),d.push(.5,.5);for(let p=0,m=3;p<=n;p++,m+=3){const T=r+p/n*s;h.x=e*Math.cos(T),h.y=e*Math.sin(T),l.push(h.x,h.y,h.z),u.push(0,0,1),f.x=(l[m]/e+1)/2,f.y=(l[m+1]/e+1)/2,d.push(f.x,f.y)}for(let p=1;p<=n;p++)a.push(p,p+1,0);this.setIndex(a),this.setAttribute("position",new Yt(l,3)),this.setAttribute("normal",new Yt(u,3)),this.setAttribute("uv",new Yt(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new CE(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Op extends rn{constructor(e=1,n=1,r=1,s=32,a=1,l=!1,u=0,d=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:n,height:r,radialSegments:s,heightSegments:a,openEnded:l,thetaStart:u,thetaLength:d};const h=this;s=Math.floor(s),a=Math.floor(a);const f=[],p=[],m=[],T=[];let E=0;const b=[],y=r/2;let S=0;A(),l===!1&&(e>0&&C(!0),n>0&&C(!1)),this.setIndex(f),this.setAttribute("position",new Yt(p,3)),this.setAttribute("normal",new Yt(m,3)),this.setAttribute("uv",new Yt(T,2));function A(){const R=new te,I=new te;let O=0;const F=(n-e)/r;for(let k=0;k<=a;k++){const D=[],U=k/a,ce=U*(n-e)+e;for(let ie=0;ie<=s;ie++){const ae=ie/s,ne=ae*d+u,pe=Math.sin(ne),de=Math.cos(ne);I.x=ce*pe,I.y=-U*r+y,I.z=ce*de,p.push(I.x,I.y,I.z),R.set(pe,F,de).normalize(),m.push(R.x,R.y,R.z),T.push(ae,1-U),D.push(E++)}b.push(D)}for(let k=0;k<s;k++)for(let D=0;D<a;D++){const U=b[D][k],ce=b[D+1][k],ie=b[D+1][k+1],ae=b[D][k+1];f.push(U,ce,ae),f.push(ce,ie,ae),O+=6}h.addGroup(S,O,0),S+=O}function C(R){const I=E,O=new mt,F=new te;let k=0;const D=R===!0?e:n,U=R===!0?1:-1;for(let ie=1;ie<=s;ie++)p.push(0,y*U,0),m.push(0,U,0),T.push(.5,.5),E++;const ce=E;for(let ie=0;ie<=s;ie++){const ne=ie/s*d+u,pe=Math.cos(ne),de=Math.sin(ne);F.x=D*de,F.y=y*U,F.z=D*pe,p.push(F.x,F.y,F.z),m.push(0,U,0),O.x=pe*.5+.5,O.y=de*.5*U+.5,T.push(O.x,O.y),E++}for(let ie=0;ie<s;ie++){const ae=I+ie,ne=ce+ie;R===!0?f.push(ne,ne+1,ae):f.push(ne+1,ne,ae),k+=3}h.addGroup(S,k,R===!0?1:2),S+=k}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Op(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class xE extends Op{constructor(e=1,n=1,r=32,s=1,a=!1,l=0,u=Math.PI*2){super(0,e,n,r,s,a,l,u),this.type="ConeGeometry",this.parameters={radius:e,height:n,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:l,thetaLength:u}}static fromJSON(e){return new xE(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Pu extends rn{constructor(e=[],n=[],r=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:n,radius:r,detail:s};const a=[],l=[];u(s),h(r),f(),this.setAttribute("position",new Yt(a,3)),this.setAttribute("normal",new Yt(a.slice(),3)),this.setAttribute("uv",new Yt(l,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function u(A){const C=new te,R=new te,I=new te;for(let O=0;O<n.length;O+=3)T(n[O+0],C),T(n[O+1],R),T(n[O+2],I),d(C,R,I,A)}function d(A,C,R,I){const O=I+1,F=[];for(let k=0;k<=O;k++){F[k]=[];const D=A.clone().lerp(R,k/O),U=C.clone().lerp(R,k/O),ce=O-k;for(let ie=0;ie<=ce;ie++)ie===0&&k===O?F[k][ie]=D:F[k][ie]=D.clone().lerp(U,ie/ce)}for(let k=0;k<O;k++)for(let D=0;D<2*(O-k)-1;D++){const U=Math.floor(D/2);D%2===0?(m(F[k][U+1]),m(F[k+1][U]),m(F[k][U])):(m(F[k][U+1]),m(F[k+1][U+1]),m(F[k+1][U]))}}function h(A){const C=new te;for(let R=0;R<a.length;R+=3)C.x=a[R+0],C.y=a[R+1],C.z=a[R+2],C.normalize().multiplyScalar(A),a[R+0]=C.x,a[R+1]=C.y,a[R+2]=C.z}function f(){const A=new te;for(let C=0;C<a.length;C+=3){A.x=a[C+0],A.y=a[C+1],A.z=a[C+2];const R=y(A)/2/Math.PI+.5,I=S(A)/Math.PI+.5;l.push(R,1-I)}E(),p()}function p(){for(let A=0;A<l.length;A+=6){const C=l[A+0],R=l[A+2],I=l[A+4],O=Math.max(C,R,I),F=Math.min(C,R,I);O>.9&&F<.1&&(C<.2&&(l[A+0]+=1),R<.2&&(l[A+2]+=1),I<.2&&(l[A+4]+=1))}}function m(A){a.push(A.x,A.y,A.z)}function T(A,C){const R=A*3;C.x=e[R+0],C.y=e[R+1],C.z=e[R+2]}function E(){const A=new te,C=new te,R=new te,I=new te,O=new mt,F=new mt,k=new mt;for(let D=0,U=0;D<a.length;D+=9,U+=6){A.set(a[D+0],a[D+1],a[D+2]),C.set(a[D+3],a[D+4],a[D+5]),R.set(a[D+6],a[D+7],a[D+8]),O.set(l[U+0],l[U+1]),F.set(l[U+2],l[U+3]),k.set(l[U+4],l[U+5]),I.copy(A).add(C).add(R).divideScalar(3);const ce=y(I);b(O,U+0,A,ce),b(F,U+2,C,ce),b(k,U+4,R,ce)}}function b(A,C,R,I){I<0&&A.x===1&&(l[C]=A.x-1),R.x===0&&R.z===0&&(l[C]=I/2/Math.PI+.5)}function y(A){return Math.atan2(A.z,-A.x)}function S(A){return Math.atan2(-A.y,Math.sqrt(A.x*A.x+A.z*A.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Pu(e.vertices,e.indices,e.radius,e.details)}}class RE extends Pu{constructor(e=1,n=0){const r=(1+Math.sqrt(5))/2,s=1/r,a=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-r,0,-s,r,0,s,-r,0,s,r,-s,-r,0,-s,r,0,s,-r,0,s,r,0,-r,0,-s,r,0,-s,-r,0,s,r,0,s],l=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(a,l,e,n),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new RE(e.radius,e.detail)}}const S0=new te,$0=new te,IC=new te,b0=new Co;class zF extends rn{constructor(e=null,n=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:n},e!==null){const s=Math.pow(10,4),a=Math.cos(rp*n),l=e.getIndex(),u=e.getAttribute("position"),d=l?l.count:u.count,h=[0,0,0],f=["a","b","c"],p=new Array(3),m={},T=[];for(let E=0;E<d;E+=3){l?(h[0]=l.getX(E),h[1]=l.getX(E+1),h[2]=l.getX(E+2)):(h[0]=E,h[1]=E+1,h[2]=E+2);const{a:b,b:y,c:S}=b0;if(b.fromBufferAttribute(u,h[0]),y.fromBufferAttribute(u,h[1]),S.fromBufferAttribute(u,h[2]),b0.getNormal(IC),p[0]=`${Math.round(b.x*s)},${Math.round(b.y*s)},${Math.round(b.z*s)}`,p[1]=`${Math.round(y.x*s)},${Math.round(y.y*s)},${Math.round(y.z*s)}`,p[2]=`${Math.round(S.x*s)},${Math.round(S.y*s)},${Math.round(S.z*s)}`,!(p[0]===p[1]||p[1]===p[2]||p[2]===p[0]))for(let A=0;A<3;A++){const C=(A+1)%3,R=p[A],I=p[C],O=b0[f[A]],F=b0[f[C]],k=`${R}_${I}`,D=`${I}_${R}`;D in m&&m[D]?(IC.dot(m[D].normal)<=a&&(T.push(O.x,O.y,O.z),T.push(F.x,F.y,F.z)),m[D]=null):k in m||(m[k]={index0:h[A],index1:h[C],normal:IC.clone()})}}for(const E in m)if(m[E]){const{index0:b,index1:y}=m[E];S0.fromBufferAttribute(u,b),$0.fromBufferAttribute(u,y),T.push(S0.x,S0.y,S0.z),T.push($0.x,$0.y,$0.z)}this.setAttribute("position",new Yt(T,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class lp extends sE{constructor(e){super(e),this.uuid=ca(),this.type="Shape",this.holes=[]}getPointsHoles(e){const n=[];for(let r=0,s=this.holes.length;r<s;r++)n[r]=this.holes[r].getPoints(e);return n}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let n=0,r=e.holes.length;n<r;n++){const s=e.holes[n];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let n=0,r=this.holes.length;n<r;n++){const s=this.holes[n];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let n=0,r=e.holes.length;n<r;n++){const s=e.holes[n];this.holes.push(new sE().fromJSON(s))}return this}}const RX={triangulate:function(i,e,n=2){const r=e&&e.length,s=r?e[0]*n:i.length;let a=WF(i,0,s,n,!0);const l=[];if(!a||a.next===a.prev)return l;let u,d,h,f,p,m,T;if(r&&(a=LX(i,e,a,n)),i.length>80*n){u=h=i[0],d=f=i[1];for(let E=n;E<s;E+=n)p=i[E],m=i[E+1],p<u&&(u=p),m<d&&(d=m),p>h&&(h=p),m>f&&(f=m);T=Math.max(h-u,f-d),T=T!==0?32767/T:0}return oE(a,l,n,u,d,T,0),l}};function WF(i,e,n,r,s){let a,l;if(s===zX(i,e,n,r)>0)for(a=e;a<n;a+=r)l=IN(a,i[a],i[a+1],l);else for(a=n-r;a>=e;a-=r)l=IN(a,i[a],i[a+1],l);return l&&V$(l,l.next)&&(lE(l),l=l.next),l}function bp(i,e){if(!i)return i;e||(e=i);let n=i,r;do if(r=!1,!n.steiner&&(V$(n,n.next)||nr(n.prev,n,n.next)===0)){if(lE(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function oE(i,e,n,r,s,a,l){if(!i)return;!l&&a&&BX(i,r,s,a);let u=i,d,h;for(;i.prev!==i.next;){if(d=i.prev,h=i.next,a?MX(i,r,s,a):wX(i)){e.push(d.i/n|0),e.push(i.i/n|0),e.push(h.i/n|0),lE(i),i=h.next,u=h.next;continue}if(i=h,i===u){l?l===1?(i=IX(bp(i),e,n),oE(i,e,n,r,s,a,2)):l===2&&OX(i,e,n,r,s,a):oE(bp(i),e,n,r,s,a,1);break}}}function wX(i){const e=i.prev,n=i,r=i.next;if(nr(e,n,r)>=0)return!1;const s=e.x,a=n.x,l=r.x,u=e.y,d=n.y,h=r.y,f=s<a?s<l?s:l:a<l?a:l,p=u<d?u<h?u:h:d<h?d:h,m=s>a?s>l?s:l:a>l?a:l,T=u>d?u>h?u:h:d>h?d:h;let E=r.next;for(;E!==e;){if(E.x>=f&&E.x<=m&&E.y>=p&&E.y<=T&&bg(s,u,a,d,l,h,E.x,E.y)&&nr(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function MX(i,e,n,r){const s=i.prev,a=i,l=i.next;if(nr(s,a,l)>=0)return!1;const u=s.x,d=a.x,h=l.x,f=s.y,p=a.y,m=l.y,T=u<d?u<h?u:h:d<h?d:h,E=f<p?f<m?f:m:p<m?p:m,b=u>d?u>h?u:h:d>h?d:h,y=f>p?f>m?f:m:p>m?p:m,S=UR(T,E,e,n,r),A=UR(b,y,e,n,r);let C=i.prevZ,R=i.nextZ;for(;C&&C.z>=S&&R&&R.z<=A;){if(C.x>=T&&C.x<=b&&C.y>=E&&C.y<=y&&C!==s&&C!==l&&bg(u,f,d,p,h,m,C.x,C.y)&&nr(C.prev,C,C.next)>=0||(C=C.prevZ,R.x>=T&&R.x<=b&&R.y>=E&&R.y<=y&&R!==s&&R!==l&&bg(u,f,d,p,h,m,R.x,R.y)&&nr(R.prev,R,R.next)>=0))return!1;R=R.nextZ}for(;C&&C.z>=S;){if(C.x>=T&&C.x<=b&&C.y>=E&&C.y<=y&&C!==s&&C!==l&&bg(u,f,d,p,h,m,C.x,C.y)&&nr(C.prev,C,C.next)>=0)return!1;C=C.prevZ}for(;R&&R.z<=A;){if(R.x>=T&&R.x<=b&&R.y>=E&&R.y<=y&&R!==s&&R!==l&&bg(u,f,d,p,h,m,R.x,R.y)&&nr(R.prev,R,R.next)>=0)return!1;R=R.nextZ}return!0}function IX(i,e,n){let r=i;do{const s=r.prev,a=r.next.next;!V$(s,a)&&XF(s,r,r.next,a)&&aE(s,a)&&aE(a,s)&&(e.push(s.i/n|0),e.push(r.i/n|0),e.push(a.i/n|0),lE(r),lE(r.next),r=i=a),r=r.next}while(r!==i);return bp(r)}function OX(i,e,n,r,s,a){let l=i;do{let u=l.next.next;for(;u!==l.prev;){if(l.i!==u.i&&GX(l,u)){let d=jF(l,u);l=bp(l,l.next),d=bp(d,d.next),oE(l,e,n,r,s,a,0),oE(d,e,n,r,s,a,0);return}u=u.next}l=l.next}while(l!==i)}function LX(i,e,n,r){const s=[];let a,l,u,d,h;for(a=0,l=e.length;a<l;a++)u=e[a]*r,d=a<l-1?e[a+1]*r:i.length,h=WF(i,u,d,r,!1),h===h.next&&(h.steiner=!0),s.push(UX(h));for(s.sort(NX),a=0;a<s.length;a++)n=kX(s[a],n);return n}function NX(i,e){return i.x-e.x}function kX(i,e){const n=PX(i,e);if(!n)return e;const r=jF(n,i);return bp(r,r.next),bp(n,n.next)}function PX(i,e){let n=e,r=-1/0,s;const a=i.x,l=i.y;do{if(l<=n.y&&l>=n.next.y&&n.next.y!==n.y){const m=n.x+(l-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(m<=a&&m>r&&(r=m,s=n.x<n.next.x?n:n.next,m===a))return s}n=n.next}while(n!==e);if(!s)return null;const u=s,d=s.x,h=s.y;let f=1/0,p;n=s;do a>=n.x&&n.x>=d&&a!==n.x&&bg(l<h?a:r,l,d,h,l<h?r:a,l,n.x,n.y)&&(p=Math.abs(l-n.y)/(a-n.x),aE(n,i)&&(p<f||p===f&&(n.x>s.x||n.x===s.x&&DX(s,n)))&&(s=n,f=p)),n=n.next;while(n!==u);return s}function DX(i,e){return nr(i.prev,i,e.prev)<0&&nr(e.next,i,i.next)<0}function BX(i,e,n,r){let s=i;do s.z===0&&(s.z=UR(s.x,s.y,e,n,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,FX(s)}function FX(i){let e,n,r,s,a,l,u,d,h=1;do{for(n=i,i=null,a=null,l=0;n;){for(l++,r=n,u=0,e=0;e<h&&(u++,r=r.nextZ,!!r);e++);for(d=h;u>0||d>0&&r;)u!==0&&(d===0||!r||n.z<=r.z)?(s=n,n=n.nextZ,u--):(s=r,r=r.nextZ,d--),a?a.nextZ=s:i=s,s.prevZ=a,a=s;n=r}a.nextZ=null,h*=2}while(l>1);return i}function UR(i,e,n,r,s){return i=(i-n)*s|0,e=(e-r)*s|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function UX(i){let e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function bg(i,e,n,r,s,a,l,u){return(s-l)*(e-u)>=(i-l)*(a-u)&&(i-l)*(r-u)>=(n-l)*(e-u)&&(n-l)*(a-u)>=(s-l)*(r-u)}function GX(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!HX(i,e)&&(aE(i,e)&&aE(e,i)&&VX(i,e)&&(nr(i.prev,i,e.prev)||nr(i,e.prev,e))||V$(i,e)&&nr(i.prev,i,i.next)>0&&nr(e.prev,e,e.next)>0)}function nr(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function V$(i,e){return i.x===e.x&&i.y===e.y}function XF(i,e,n,r){const s=C0(nr(i,e,n)),a=C0(nr(i,e,r)),l=C0(nr(n,r,i)),u=C0(nr(n,r,e));return!!(s!==a&&l!==u||s===0&&A0(i,n,e)||a===0&&A0(i,r,e)||l===0&&A0(n,i,r)||u===0&&A0(n,e,r))}function A0(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function C0(i){return i>0?1:i<0?-1:0}function HX(i,e){let n=i;do{if(n.i!==i.i&&n.next.i!==i.i&&n.i!==e.i&&n.next.i!==e.i&&XF(n,n.next,i,e))return!0;n=n.next}while(n!==i);return!1}function aE(i,e){return nr(i.prev,i,i.next)<0?nr(i,e,i.next)>=0&&nr(i,i.prev,e)>=0:nr(i,e,i.prev)<0||nr(i,i.next,e)<0}function VX(i,e){let n=i,r=!1;const s=(i.x+e.x)/2,a=(i.y+e.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&s<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==i);return r}function jF(i,e){const n=new GR(i.i,i.x,i.y),r=new GR(e.i,e.x,e.y),s=i.next,a=e.prev;return i.next=e,e.prev=i,n.next=s,s.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function IN(i,e,n,r){const s=new GR(i,e,n);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function lE(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function GR(i,e,n){this.i=i,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zX(i,e,n,r){let s=0;for(let a=e,l=n-r;a<n;a+=r)s+=(i[l]-i[a])*(i[a+1]+i[l+1]),l=a;return s}class Rc{static area(e){const n=e.length;let r=0;for(let s=n-1,a=0;a<n;s=a++)r+=e[s].x*e[a].y-e[a].x*e[s].y;return r*.5}static isClockWise(e){return Rc.area(e)<0}static triangulateShape(e,n){const r=[],s=[],a=[];ON(e),LN(r,e);let l=e.length;n.forEach(ON);for(let d=0;d<n.length;d++)s.push(l),l+=n[d].length,LN(r,n[d]);const u=RX.triangulate(r,s);for(let d=0;d<u.length;d+=3)a.push(u.slice(d,d+3));return a}}function ON(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function LN(i,e){for(let n=0;n<e.length;n++)i.push(e[n].x),i.push(e[n].y)}class r_ extends rn{constructor(e=new lp([new mt(.5,.5),new mt(-.5,.5),new mt(-.5,-.5),new mt(.5,-.5)]),n={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:n},e=Array.isArray(e)?e:[e];const r=this,s=[],a=[];for(let u=0,d=e.length;u<d;u++){const h=e[u];l(h)}this.setAttribute("position",new Yt(s,3)),this.setAttribute("uv",new Yt(a,2)),this.computeVertexNormals();function l(u){const d=[],h=n.curveSegments!==void 0?n.curveSegments:12,f=n.steps!==void 0?n.steps:1,p=n.depth!==void 0?n.depth:1;let m=n.bevelEnabled!==void 0?n.bevelEnabled:!0,T=n.bevelThickness!==void 0?n.bevelThickness:.2,E=n.bevelSize!==void 0?n.bevelSize:T-.1,b=n.bevelOffset!==void 0?n.bevelOffset:0,y=n.bevelSegments!==void 0?n.bevelSegments:3;const S=n.extrudePath,A=n.UVGenerator!==void 0?n.UVGenerator:WX;let C,R=!1,I,O,F,k;S&&(C=S.getSpacedPoints(f),R=!0,m=!1,I=S.computeFrenetFrames(f,!1),O=new te,F=new te,k=new te),m||(y=0,T=0,E=0,b=0);const D=u.extractPoints(h);let U=D.shape;const ce=D.holes;if(!Rc.isClockWise(U)){U=U.reverse();for(let re=0,Ye=ce.length;re<Ye;re++){const Fe=ce[re];Rc.isClockWise(Fe)&&(ce[re]=Fe.reverse())}}const ae=Rc.triangulateShape(U,ce),ne=U;for(let re=0,Ye=ce.length;re<Ye;re++){const Fe=ce[re];U=U.concat(Fe)}function pe(re,Ye,Fe){return Ye||console.error("THREE.ExtrudeGeometry: vec does not exist"),re.clone().addScaledVector(Ye,Fe)}const de=U.length,xe=ae.length;function H(re,Ye,Fe){let Ze,Xe,dt;const je=re.x-Ye.x,it=re.y-Ye.y,Ce=Fe.x-re.x,Me=Fe.y-re.y,St=je*je+it*it,oe=je*Me-it*Ce;if(Math.abs(oe)>Number.EPSILON){const ee=Math.sqrt(St),W=Math.sqrt(Ce*Ce+Me*Me),ot=Ye.x-it/ee,ze=Ye.y+je/ee,qe=Fe.x-Me/W,ut=Fe.y+Ce/W,ft=((qe-ot)*Me-(ut-ze)*Ce)/(je*Me-it*Ce);Ze=ot+je*ft-re.x,Xe=ze+it*ft-re.y;const Ge=Ze*Ze+Xe*Xe;if(Ge<=2)return new mt(Ze,Xe);dt=Math.sqrt(Ge/2)}else{let ee=!1;je>Number.EPSILON?Ce>Number.EPSILON&&(ee=!0):je<-Number.EPSILON?Ce<-Number.EPSILON&&(ee=!0):Math.sign(it)===Math.sign(Me)&&(ee=!0),ee?(Ze=-it,Xe=je,dt=Math.sqrt(St)):(Ze=je,Xe=it,dt=Math.sqrt(St/2))}return new mt(Ze/dt,Xe/dt)}const J=[];for(let re=0,Ye=ne.length,Fe=Ye-1,Ze=re+1;re<Ye;re++,Fe++,Ze++)Fe===Ye&&(Fe=0),Ze===Ye&&(Ze=0),J[re]=H(ne[re],ne[Fe],ne[Ze]);const K=[];let se,Y=J.concat();for(let re=0,Ye=ce.length;re<Ye;re++){const Fe=ce[re];se=[];for(let Ze=0,Xe=Fe.length,dt=Xe-1,je=Ze+1;Ze<Xe;Ze++,dt++,je++)dt===Xe&&(dt=0),je===Xe&&(je=0),se[Ze]=H(Fe[Ze],Fe[dt],Fe[je]);K.push(se),Y=Y.concat(se)}for(let re=0;re<y;re++){const Ye=re/y,Fe=T*Math.cos(Ye*Math.PI/2),Ze=E*Math.sin(Ye*Math.PI/2)+b;for(let Xe=0,dt=ne.length;Xe<dt;Xe++){const je=pe(ne[Xe],J[Xe],Ze);Re(je.x,je.y,-Fe)}for(let Xe=0,dt=ce.length;Xe<dt;Xe++){const je=ce[Xe];se=K[Xe];for(let it=0,Ce=je.length;it<Ce;it++){const Me=pe(je[it],se[it],Ze);Re(Me.x,Me.y,-Fe)}}}const he=E+b;for(let re=0;re<de;re++){const Ye=m?pe(U[re],Y[re],he):U[re];R?(F.copy(I.normals[0]).multiplyScalar(Ye.x),O.copy(I.binormals[0]).multiplyScalar(Ye.y),k.copy(C[0]).add(F).add(O),Re(k.x,k.y,k.z)):Re(Ye.x,Ye.y,0)}for(let re=1;re<=f;re++)for(let Ye=0;Ye<de;Ye++){const Fe=m?pe(U[Ye],Y[Ye],he):U[Ye];R?(F.copy(I.normals[re]).multiplyScalar(Fe.x),O.copy(I.binormals[re]).multiplyScalar(Fe.y),k.copy(C[re]).add(F).add(O),Re(k.x,k.y,k.z)):Re(Fe.x,Fe.y,p/f*re)}for(let re=y-1;re>=0;re--){const Ye=re/y,Fe=T*Math.cos(Ye*Math.PI/2),Ze=E*Math.sin(Ye*Math.PI/2)+b;for(let Xe=0,dt=ne.length;Xe<dt;Xe++){const je=pe(ne[Xe],J[Xe],Ze);Re(je.x,je.y,p+Fe)}for(let Xe=0,dt=ce.length;Xe<dt;Xe++){const je=ce[Xe];se=K[Xe];for(let it=0,Ce=je.length;it<Ce;it++){const Me=pe(je[it],se[it],Ze);R?Re(Me.x,Me.y+C[f-1].y,C[f-1].x+Fe):Re(Me.x,Me.y,p+Fe)}}}ue(),Te();function ue(){const re=s.length/3;if(m){let Ye=0,Fe=de*Ye;for(let Ze=0;Ze<xe;Ze++){const Xe=ae[Ze];De(Xe[2]+Fe,Xe[1]+Fe,Xe[0]+Fe)}Ye=f+y*2,Fe=de*Ye;for(let Ze=0;Ze<xe;Ze++){const Xe=ae[Ze];De(Xe[0]+Fe,Xe[1]+Fe,Xe[2]+Fe)}}else{for(let Ye=0;Ye<xe;Ye++){const Fe=ae[Ye];De(Fe[2],Fe[1],Fe[0])}for(let Ye=0;Ye<xe;Ye++){const Fe=ae[Ye];De(Fe[0]+de*f,Fe[1]+de*f,Fe[2]+de*f)}}r.addGroup(re,s.length/3-re,0)}function Te(){const re=s.length/3;let Ye=0;_e(ne,Ye),Ye+=ne.length;for(let Fe=0,Ze=ce.length;Fe<Ze;Fe++){const Xe=ce[Fe];_e(Xe,Ye),Ye+=Xe.length}r.addGroup(re,s.length/3-re,1)}function _e(re,Ye){let Fe=re.length;for(;--Fe>=0;){const Ze=Fe;let Xe=Fe-1;Xe<0&&(Xe=re.length-1);for(let dt=0,je=f+y*2;dt<je;dt++){const it=de*dt,Ce=de*(dt+1),Me=Ye+Ze+it,St=Ye+Xe+it,oe=Ye+Xe+Ce,ee=Ye+Ze+Ce;et(Me,St,oe,ee)}}}function Re(re,Ye,Fe){d.push(re),d.push(Ye),d.push(Fe)}function De(re,Ye,Fe){Ue(re),Ue(Ye),Ue(Fe);const Ze=s.length/3,Xe=A.generateTopUV(r,s,Ze-3,Ze-2,Ze-1);Le(Xe[0]),Le(Xe[1]),Le(Xe[2])}function et(re,Ye,Fe,Ze){Ue(re),Ue(Ye),Ue(Ze),Ue(Ye),Ue(Fe),Ue(Ze);const Xe=s.length/3,dt=A.generateSideWallUV(r,s,Xe-6,Xe-3,Xe-2,Xe-1);Le(dt[0]),Le(dt[1]),Le(dt[3]),Le(dt[1]),Le(dt[2]),Le(dt[3])}function Ue(re){s.push(d[re*3+0]),s.push(d[re*3+1]),s.push(d[re*3+2])}function Le(re){a.push(re.x),a.push(re.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),n=this.parameters.shapes,r=this.parameters.options;return XX(n,r,e)}static fromJSON(e,n){const r=[];for(let a=0,l=e.shapes.length;a<l;a++){const u=n[e.shapes[a]];r.push(u)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new IM[s.type]().fromJSON(s)),new r_(r,e.options)}}const WX={generateTopUV:function(i,e,n,r,s){const a=e[n*3],l=e[n*3+1],u=e[r*3],d=e[r*3+1],h=e[s*3],f=e[s*3+1];return[new mt(a,l),new mt(u,d),new mt(h,f)]},generateSideWallUV:function(i,e,n,r,s,a){const l=e[n*3],u=e[n*3+1],d=e[n*3+2],h=e[r*3],f=e[r*3+1],p=e[r*3+2],m=e[s*3],T=e[s*3+1],E=e[s*3+2],b=e[a*3],y=e[a*3+1],S=e[a*3+2];return Math.abs(u-f)<Math.abs(l-h)?[new mt(l,1-d),new mt(h,1-p),new mt(m,1-E),new mt(b,1-S)]:[new mt(u,1-d),new mt(f,1-p),new mt(T,1-E),new mt(y,1-S)]}};function XX(i,e,n){if(n.shapes=[],Array.isArray(i))for(let r=0,s=i.length;r<s;r++){const a=i[r];n.shapes.push(a.uuid)}else n.shapes.push(i.uuid);return n.options=Object.assign({},e),e.extrudePath!==void 0&&(n.options.extrudePath=e.extrudePath.toJSON()),n}class s_ extends Pu{constructor(e=1,n=0){const r=(1+Math.sqrt(5))/2,s=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(s,a,e,n),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new s_(e.radius,e.detail)}}class o_ extends Pu{constructor(e=1,n=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,s,e,n),this.type="OctahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new o_(e.radius,e.detail)}}class wE extends rn{constructor(e=.5,n=1,r=32,s=1,a=0,l=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:n,thetaSegments:r,phiSegments:s,thetaStart:a,thetaLength:l},r=Math.max(3,r),s=Math.max(1,s);const u=[],d=[],h=[],f=[];let p=e;const m=(n-e)/s,T=new te,E=new mt;for(let b=0;b<=s;b++){for(let y=0;y<=r;y++){const S=a+y/r*l;T.x=p*Math.cos(S),T.y=p*Math.sin(S),d.push(T.x,T.y,T.z),h.push(0,0,1),E.x=(T.x/n+1)/2,E.y=(T.y/n+1)/2,f.push(E.x,E.y)}p+=m}for(let b=0;b<s;b++){const y=b*(r+1);for(let S=0;S<r;S++){const A=S+y,C=A,R=A+r+1,I=A+r+2,O=A+1;u.push(C,R,O),u.push(R,I,O)}}this.setIndex(u),this.setAttribute("position",new Yt(d,3)),this.setAttribute("normal",new Yt(h,3)),this.setAttribute("uv",new Yt(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wE(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class ME extends rn{constructor(e=new lp([new mt(0,.5),new mt(-.5,-.5),new mt(.5,-.5)]),n=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:n};const r=[],s=[],a=[],l=[];let u=0,d=0;if(Array.isArray(e)===!1)h(e);else for(let f=0;f<e.length;f++)h(e[f]),this.addGroup(u,d,f),u+=d,d=0;this.setIndex(r),this.setAttribute("position",new Yt(s,3)),this.setAttribute("normal",new Yt(a,3)),this.setAttribute("uv",new Yt(l,2));function h(f){const p=s.length/3,m=f.extractPoints(n);let T=m.shape;const E=m.holes;Rc.isClockWise(T)===!1&&(T=T.reverse());for(let y=0,S=E.length;y<S;y++){const A=E[y];Rc.isClockWise(A)===!0&&(E[y]=A.reverse())}const b=Rc.triangulateShape(T,E);for(let y=0,S=E.length;y<S;y++){const A=E[y];T=T.concat(A)}for(let y=0,S=T.length;y<S;y++){const A=T[y];s.push(A.x,A.y,0),a.push(0,0,1),l.push(A.x,A.y)}for(let y=0,S=b.length;y<S;y++){const A=b[y],C=A[0]+p,R=A[1]+p,I=A[2]+p;r.push(C,R,I),d+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),n=this.parameters.shapes;return jX(n,e)}static fromJSON(e,n){const r=[];for(let s=0,a=e.shapes.length;s<a;s++){const l=n[e.shapes[s]];r.push(l)}return new ME(r,e.curveSegments)}}function jX(i,e){if(e.shapes=[],Array.isArray(i))for(let n=0,r=i.length;n<r;n++){const s=i[n];e.shapes.push(s.uuid)}else e.shapes.push(i.uuid);return e}class a_ extends rn{constructor(e=1,n=32,r=16,s=0,a=Math.PI*2,l=0,u=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:n,heightSegments:r,phiStart:s,phiLength:a,thetaStart:l,thetaLength:u},n=Math.max(3,Math.floor(n)),r=Math.max(2,Math.floor(r));const d=Math.min(l+u,Math.PI);let h=0;const f=[],p=new te,m=new te,T=[],E=[],b=[],y=[];for(let S=0;S<=r;S++){const A=[],C=S/r;let R=0;S===0&&l===0?R=.5/n:S===r&&d===Math.PI&&(R=-.5/n);for(let I=0;I<=n;I++){const O=I/n;p.x=-e*Math.cos(s+O*a)*Math.sin(l+C*u),p.y=e*Math.cos(l+C*u),p.z=e*Math.sin(s+O*a)*Math.sin(l+C*u),E.push(p.x,p.y,p.z),m.copy(p).normalize(),b.push(m.x,m.y,m.z),y.push(O+R,1-C),A.push(h++)}f.push(A)}for(let S=0;S<r;S++)for(let A=0;A<n;A++){const C=f[S][A+1],R=f[S][A],I=f[S+1][A],O=f[S+1][A+1];(S!==0||l>0)&&T.push(C,R,O),(S!==r-1||d<Math.PI)&&T.push(R,I,O)}this.setIndex(T),this.setAttribute("position",new Yt(E,3)),this.setAttribute("normal",new Yt(b,3)),this.setAttribute("uv",new Yt(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new a_(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class IE extends Pu{constructor(e=1,n=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],s=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,s,e,n),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:n}}static fromJSON(e){return new IE(e.radius,e.detail)}}class OE extends rn{constructor(e=1,n=.4,r=12,s=48,a=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:n,radialSegments:r,tubularSegments:s,arc:a},r=Math.floor(r),s=Math.floor(s);const l=[],u=[],d=[],h=[],f=new te,p=new te,m=new te;for(let T=0;T<=r;T++)for(let E=0;E<=s;E++){const b=E/s*a,y=T/r*Math.PI*2;p.x=(e+n*Math.cos(y))*Math.cos(b),p.y=(e+n*Math.cos(y))*Math.sin(b),p.z=n*Math.sin(y),u.push(p.x,p.y,p.z),f.x=e*Math.cos(b),f.y=e*Math.sin(b),m.subVectors(p,f).normalize(),d.push(m.x,m.y,m.z),h.push(E/s),h.push(T/r)}for(let T=1;T<=r;T++)for(let E=1;E<=s;E++){const b=(s+1)*T+E-1,y=(s+1)*(T-1)+E-1,S=(s+1)*(T-1)+E,A=(s+1)*T+E;l.push(b,y,A),l.push(y,S,A)}this.setIndex(l),this.setAttribute("position",new Yt(u,3)),this.setAttribute("normal",new Yt(d,3)),this.setAttribute("uv",new Yt(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new OE(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class LE extends rn{constructor(e=1,n=.4,r=64,s=8,a=2,l=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:n,tubularSegments:r,radialSegments:s,p:a,q:l},r=Math.floor(r),s=Math.floor(s);const u=[],d=[],h=[],f=[],p=new te,m=new te,T=new te,E=new te,b=new te,y=new te,S=new te;for(let C=0;C<=r;++C){const R=C/r*a*Math.PI*2;A(R,a,l,e,T),A(R+.01,a,l,e,E),y.subVectors(E,T),S.addVectors(E,T),b.crossVectors(y,S),S.crossVectors(b,y),b.normalize(),S.normalize();for(let I=0;I<=s;++I){const O=I/s*Math.PI*2,F=-n*Math.cos(O),k=n*Math.sin(O);p.x=T.x+(F*S.x+k*b.x),p.y=T.y+(F*S.y+k*b.y),p.z=T.z+(F*S.z+k*b.z),d.push(p.x,p.y,p.z),m.subVectors(p,T).normalize(),h.push(m.x,m.y,m.z),f.push(C/r),f.push(I/s)}}for(let C=1;C<=r;C++)for(let R=1;R<=s;R++){const I=(s+1)*(C-1)+(R-1),O=(s+1)*C+(R-1),F=(s+1)*C+R,k=(s+1)*(C-1)+R;u.push(I,O,k),u.push(O,F,k)}this.setIndex(u),this.setAttribute("position",new Yt(d,3)),this.setAttribute("normal",new Yt(h,3)),this.setAttribute("uv",new Yt(f,2));function A(C,R,I,O,F){const k=Math.cos(C),D=Math.sin(C),U=I/R*C,ce=Math.cos(U);F.x=O*(2+ce)*.5*k,F.y=O*(2+ce)*D*.5,F.z=O*Math.sin(U)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new LE(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class NE extends rn{constructor(e=new wM(new te(-1,-1,0),new te(-1,1,0),new te(1,1,0)),n=64,r=1,s=8,a=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:n,radius:r,radialSegments:s,closed:a};const l=e.computeFrenetFrames(n,a);this.tangents=l.tangents,this.normals=l.normals,this.binormals=l.binormals;const u=new te,d=new te,h=new mt;let f=new te;const p=[],m=[],T=[],E=[];b(),this.setIndex(E),this.setAttribute("position",new Yt(p,3)),this.setAttribute("normal",new Yt(m,3)),this.setAttribute("uv",new Yt(T,2));function b(){for(let C=0;C<n;C++)y(C);y(a===!1?n:0),A(),S()}function y(C){f=e.getPointAt(C/n,f);const R=l.normals[C],I=l.binormals[C];for(let O=0;O<=s;O++){const F=O/s*Math.PI*2,k=Math.sin(F),D=-Math.cos(F);d.x=D*R.x+k*I.x,d.y=D*R.y+k*I.y,d.z=D*R.z+k*I.z,d.normalize(),m.push(d.x,d.y,d.z),u.x=f.x+r*d.x,u.y=f.y+r*d.y,u.z=f.z+r*d.z,p.push(u.x,u.y,u.z)}}function S(){for(let C=1;C<=n;C++)for(let R=1;R<=s;R++){const I=(s+1)*(C-1)+(R-1),O=(s+1)*C+(R-1),F=(s+1)*C+R,k=(s+1)*(C-1)+R;E.push(I,O,k),E.push(O,F,k)}}function A(){for(let C=0;C<=n;C++)for(let R=0;R<=s;R++)h.x=C/n,h.y=R/s,T.push(h.x,h.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new NE(new IM[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class OM extends rn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const n=[],r=new Set,s=new te,a=new te;if(e.index!==null){const l=e.attributes.position,u=e.index;let d=e.groups;d.length===0&&(d=[{start:0,count:u.count,materialIndex:0}]);for(let h=0,f=d.length;h<f;++h){const p=d[h],m=p.start,T=p.count;for(let E=m,b=m+T;E<b;E+=3)for(let y=0;y<3;y++){const S=u.getX(E+y),A=u.getX(E+(y+1)%3);s.fromBufferAttribute(l,S),a.fromBufferAttribute(l,A),NN(s,a,r)===!0&&(n.push(s.x,s.y,s.z),n.push(a.x,a.y,a.z))}}}else{const l=e.attributes.position;for(let u=0,d=l.count/3;u<d;u++)for(let h=0;h<3;h++){const f=3*u+h,p=3*u+(h+1)%3;s.fromBufferAttribute(l,f),a.fromBufferAttribute(l,p),NN(s,a,r)===!0&&(n.push(s.x,s.y,s.z),n.push(a.x,a.y,a.z))}}this.setAttribute("position",new Yt(n,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function NN(i,e,n){const r=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`;return n.has(r)===!0||n.has(s)===!0?!1:(n.add(r),n.add(s),!0)}var kN=Object.freeze({__proto__:null,BoxGeometry:gd,CapsuleGeometry:AE,CircleGeometry:CE,ConeGeometry:xE,CylinderGeometry:Op,DodecahedronGeometry:RE,EdgesGeometry:zF,ExtrudeGeometry:r_,IcosahedronGeometry:s_,LatheGeometry:i_,OctahedronGeometry:o_,PlaneGeometry:Bl,PolyhedronGeometry:Pu,RingGeometry:wE,ShapeGeometry:ME,SphereGeometry:a_,TetrahedronGeometry:IE,TorusGeometry:OE,TorusKnotGeometry:LE,TubeGeometry:NE,WireframeGeometry:OM});class YF extends rr{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ct(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class KF extends Oo{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Lp extends rr{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ct(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=md,this.normalScale=new mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Nr extends Lp{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new mt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return pr(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(n){this.ior=(1+.4*n)/(1-.4*n)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ct(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ct(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ct(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class JF extends rr{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ct(16777215),this.specular=new Ct(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=md,this.normalScale=new mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=_E,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ZF extends rr{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ct(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=md,this.normalScale=new mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class qF extends rr{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=md,this.normalScale=new mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class QF extends rr{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ct(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=md,this.normalScale=new mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=_E,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class eU extends rr{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ct(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=md,this.normalScale=new mt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class tU extends fi{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Fa(i,e,n){return LM(i)?new i.constructor(i.subarray(e,n!==void 0?n:i.length)):i.slice(e,n)}function Jf(i,e,n){return!i||!n&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)}function LM(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function nU(i){function e(s,a){return i[s]-i[a]}const n=i.length,r=new Array(n);for(let s=0;s!==n;++s)r[s]=s;return r.sort(e),r}function HR(i,e,n){const r=i.length,s=new i.constructor(r);for(let a=0,l=0;l!==r;++a){const u=n[a]*e;for(let d=0;d!==e;++d)s[l++]=i[u+d]}return s}function NM(i,e,n,r){let s=1,a=i[0];for(;a!==void 0&&a[r]===void 0;)a=i[s++];if(a===void 0)return;let l=a[r];if(l!==void 0)if(Array.isArray(l))do l=a[r],l!==void 0&&(e.push(a.time),n.push.apply(n,l)),a=i[s++];while(a!==void 0);else if(l.toArray!==void 0)do l=a[r],l!==void 0&&(e.push(a.time),l.toArray(n,n.length)),a=i[s++];while(a!==void 0);else do l=a[r],l!==void 0&&(e.push(a.time),n.push(l)),a=i[s++];while(a!==void 0)}function YX(i,e,n,r,s=30){const a=i.clone();a.name=e;const l=[];for(let d=0;d<a.tracks.length;++d){const h=a.tracks[d],f=h.getValueSize(),p=[],m=[];for(let T=0;T<h.times.length;++T){const E=h.times[T]*s;if(!(E<n||E>=r)){p.push(h.times[T]);for(let b=0;b<f;++b)m.push(h.values[T*f+b])}}p.length!==0&&(h.times=Jf(p,h.times.constructor),h.values=Jf(m,h.values.constructor),l.push(h))}a.tracks=l;let u=1/0;for(let d=0;d<a.tracks.length;++d)u>a.tracks[d].times[0]&&(u=a.tracks[d].times[0]);for(let d=0;d<a.tracks.length;++d)a.tracks[d].shift(-1*u);return a.resetDuration(),a}function KX(i,e=0,n=i,r=30){r<=0&&(r=30);const s=n.tracks.length,a=e/r;for(let l=0;l<s;++l){const u=n.tracks[l],d=u.ValueTypeName;if(d==="bool"||d==="string")continue;const h=i.tracks.find(function(S){return S.name===u.name&&S.ValueTypeName===d});if(h===void 0)continue;let f=0;const p=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=p/3);let m=0;const T=h.getValueSize();h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(m=T/3);const E=u.times.length-1;let b;if(a<=u.times[0]){const S=f,A=p-f;b=Fa(u.values,S,A)}else if(a>=u.times[E]){const S=E*p+f,A=S+p-f;b=Fa(u.values,S,A)}else{const S=u.createInterpolant(),A=f,C=p-f;S.evaluate(a),b=Fa(S.resultBuffer,A,C)}d==="quaternion"&&new Er().fromArray(b).normalize().conjugate().toArray(b);const y=h.times.length;for(let S=0;S<y;++S){const A=S*T+m;if(d==="quaternion")Er.multiplyQuaternionsFlat(h.values,A,b,0,h.values,A);else{const C=T-m*2;for(let R=0;R<C;++R)h.values[A+R]-=b[R]}}}return i.blendMode=fM,i}const JX={arraySlice:Fa,convertArray:Jf,isTypedArray:LM,getKeyframeOrder:nU,sortedArray:HR,flattenJSON:NM,subclip:YX,makeClipAdditive:KX};class Np{constructor(e,n,r,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new n.constructor(r),this.sampleValues=n,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const n=this.parameterPositions;let r=this._cachedIndex,s=n[r],a=n[r-1];e:{t:{let l;n:{i:if(!(e<s)){for(let u=r+2;;){if(s===void 0){if(e<a)break i;return r=n.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===u)break;if(a=s,s=n[++r],e<s)break t}l=n.length;break n}if(!(e>=a)){const u=n[1];e<u&&(r=2,a=u);for(let d=r-2;;){if(a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===d)break;if(s=a,a=n[--r-1],e>=a)break t}l=r,r=0;break n}break e}for(;r<l;){const u=r+l>>>1;e<n[u]?l=u:r=u+1}if(s=n[r],a=n[r-1],a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return r=n.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,a,s)}return this.interpolate_(r,a,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const n=this.resultBuffer,r=this.sampleValues,s=this.valueSize,a=e*s;for(let l=0;l!==s;++l)n[l]=r[a+l];return n}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class iU extends Np{constructor(e,n,r,s){super(e,n,r,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Xf,endingEnd:Xf}}intervalChanged_(e,n,r){const s=this.parameterPositions;let a=e-2,l=e+1,u=s[a],d=s[l];if(u===void 0)switch(this.getSettings_().endingStart){case jf:a=e,u=2*n-r;break;case eE:a=s.length-2,u=n+s[a]-s[a+1];break;default:a=e,u=r}if(d===void 0)switch(this.getSettings_().endingEnd){case jf:l=e,d=2*r-n;break;case eE:l=1,d=r+s[1]-s[0];break;default:l=e-1,d=n}const h=(r-n)*.5,f=this.valueSize;this._weightPrev=h/(n-u),this._weightNext=h/(d-r),this._offsetPrev=a*f,this._offsetNext=l*f}interpolate_(e,n,r,s){const a=this.resultBuffer,l=this.sampleValues,u=this.valueSize,d=e*u,h=d-u,f=this._offsetPrev,p=this._offsetNext,m=this._weightPrev,T=this._weightNext,E=(r-n)/(s-n),b=E*E,y=b*E,S=-m*y+2*m*b-m*E,A=(1+m)*y+(-1.5-2*m)*b+(-.5+m)*E+1,C=(-1-T)*y+(1.5+T)*b+.5*E,R=T*y-T*b;for(let I=0;I!==u;++I)a[I]=S*l[f+I]+A*l[h+I]+C*l[d+I]+R*l[p+I];return a}}class kM extends Np{constructor(e,n,r,s){super(e,n,r,s)}interpolate_(e,n,r,s){const a=this.resultBuffer,l=this.sampleValues,u=this.valueSize,d=e*u,h=d-u,f=(r-n)/(s-n),p=1-f;for(let m=0;m!==u;++m)a[m]=l[h+m]*p+l[d+m]*f;return a}}class rU extends Np{constructor(e,n,r,s){super(e,n,r,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ul{constructor(e,n,r,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(n===void 0||n.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Jf(n,this.TimeBufferType),this.values=Jf(r,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const n=e.constructor;let r;if(n.toJSON!==this.toJSON)r=n.toJSON(e);else{r={name:e.name,times:Jf(e.times,Array),values:Jf(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(r.interpolation=s)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new rU(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new kM(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new iU(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let n;switch(e){case Sp:n=this.InterpolantFactoryMethodDiscrete;break;case Lu:n=this.InterpolantFactoryMethodLinear;break;case pS:n=this.InterpolantFactoryMethodSmooth;break}if(n===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=n,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Sp;case this.InterpolantFactoryMethodLinear:return Lu;case this.InterpolantFactoryMethodSmooth:return pS}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const n=this.times;for(let r=0,s=n.length;r!==s;++r)n[r]+=e}return this}scale(e){if(e!==1){const n=this.times;for(let r=0,s=n.length;r!==s;++r)n[r]*=e}return this}trim(e,n){const r=this.times,s=r.length;let a=0,l=s-1;for(;a!==s&&r[a]<e;)++a;for(;l!==-1&&r[l]>n;)--l;if(++l,a!==0||l!==s){a>=l&&(l=Math.max(l,1),a=l-1);const u=this.getValueSize();this.times=Fa(r,a,l),this.values=Fa(this.values,a*u,l*u)}return this}validate(){let e=!0;const n=this.getValueSize();n-Math.floor(n)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,s=this.values,a=r.length;a===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let l=null;for(let u=0;u!==a;u++){const d=r[u];if(typeof d=="number"&&isNaN(d)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,u,d),e=!1;break}if(l!==null&&l>d){console.error("THREE.KeyframeTrack: Out of order keys.",this,u,d,l),e=!1;break}l=d}if(s!==void 0&&LM(s))for(let u=0,d=s.length;u!==d;++u){const h=s[u];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,h),e=!1;break}}return e}optimize(){const e=Fa(this.times),n=Fa(this.values),r=this.getValueSize(),s=this.getInterpolation()===pS,a=e.length-1;let l=1;for(let u=1;u<a;++u){let d=!1;const h=e[u],f=e[u+1];if(h!==f&&(u!==1||h!==e[0]))if(s)d=!0;else{const p=u*r,m=p-r,T=p+r;for(let E=0;E!==r;++E){const b=n[p+E];if(b!==n[m+E]||b!==n[T+E]){d=!0;break}}}if(d){if(u!==l){e[l]=e[u];const p=u*r,m=l*r;for(let T=0;T!==r;++T)n[m+T]=n[p+T]}++l}}if(a>0){e[l]=e[a];for(let u=a*r,d=l*r,h=0;h!==r;++h)n[d+h]=n[u+h];++l}return l!==e.length?(this.times=Fa(e,0,l),this.values=Fa(n,0,l*r)):(this.times=e,this.values=n),this}clone(){const e=Fa(this.times,0),n=Fa(this.values,0),r=this.constructor,s=new r(this.name,e,n);return s.createInterpolant=this.createInterpolant,s}}Ul.prototype.TimeBufferType=Float32Array;Ul.prototype.ValueBufferType=Float32Array;Ul.prototype.DefaultInterpolation=Lu;class kp extends Ul{}kp.prototype.ValueTypeName="bool";kp.prototype.ValueBufferType=Array;kp.prototype.DefaultInterpolation=Sp;kp.prototype.InterpolantFactoryMethodLinear=void 0;kp.prototype.InterpolantFactoryMethodSmooth=void 0;class PM extends Ul{}PM.prototype.ValueTypeName="color";class cd extends Ul{}cd.prototype.ValueTypeName="number";class sU extends Np{constructor(e,n,r,s){super(e,n,r,s)}interpolate_(e,n,r,s){const a=this.resultBuffer,l=this.sampleValues,u=this.valueSize,d=(r-n)/(s-n);let h=e*u;for(let f=h+u;h!==f;h+=4)Er.slerpFlat(a,0,l,h-u,l,h,d);return a}}class wc extends Ul{InterpolantFactoryMethodLinear(e){return new sU(this.times,this.values,this.getValueSize(),e)}}wc.prototype.ValueTypeName="quaternion";wc.prototype.DefaultInterpolation=Lu;wc.prototype.InterpolantFactoryMethodSmooth=void 0;class Pp extends Ul{}Pp.prototype.ValueTypeName="string";Pp.prototype.ValueBufferType=Array;Pp.prototype.DefaultInterpolation=Sp;Pp.prototype.InterpolantFactoryMethodLinear=void 0;Pp.prototype.InterpolantFactoryMethodSmooth=void 0;class ud extends Ul{}ud.prototype.ValueTypeName="vector";class Ap{constructor(e,n=-1,r,s=x$){this.name=e,this.tracks=r,this.duration=n,this.blendMode=s,this.uuid=ca(),this.duration<0&&this.resetDuration()}static parse(e){const n=[],r=e.tracks,s=1/(e.fps||1);for(let l=0,u=r.length;l!==u;++l)n.push(qX(r[l]).scale(s));const a=new this(e.name,e.duration,n,e.blendMode);return a.uuid=e.uuid,a}static toJSON(e){const n=[],r=e.tracks,s={name:e.name,duration:e.duration,tracks:n,uuid:e.uuid,blendMode:e.blendMode};for(let a=0,l=r.length;a!==l;++a)n.push(Ul.toJSON(r[a]));return s}static CreateFromMorphTargetSequence(e,n,r,s){const a=n.length,l=[];for(let u=0;u<a;u++){let d=[],h=[];d.push((u+a-1)%a,u,(u+1)%a),h.push(0,1,0);const f=nU(d);d=HR(d,1,f),h=HR(h,1,f),!s&&d[0]===0&&(d.push(a),h.push(h[0])),l.push(new cd(".morphTargetInfluences["+n[u].name+"]",d,h).scale(1/r))}return new this(e,-1,l)}static findByName(e,n){let r=e;if(!Array.isArray(e)){const s=e;r=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<r.length;s++)if(r[s].name===n)return r[s];return null}static CreateClipsFromMorphTargetSequences(e,n,r){const s={},a=/^([\w-]*?)([\d]+)$/;for(let u=0,d=e.length;u<d;u++){const h=e[u],f=h.name.match(a);if(f&&f.length>1){const p=f[1];let m=s[p];m||(s[p]=m=[]),m.push(h)}}const l=[];for(const u in s)l.push(this.CreateFromMorphTargetSequence(u,s[u],n,r));return l}static parseAnimation(e,n){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(p,m,T,E,b){if(T.length!==0){const y=[],S=[];NM(T,y,S,E),y.length!==0&&b.push(new p(m,y,S))}},s=[],a=e.name||"default",l=e.fps||30,u=e.blendMode;let d=e.length||-1;const h=e.hierarchy||[];for(let p=0;p<h.length;p++){const m=h[p].keys;if(!(!m||m.length===0))if(m[0].morphTargets){const T={};let E;for(E=0;E<m.length;E++)if(m[E].morphTargets)for(let b=0;b<m[E].morphTargets.length;b++)T[m[E].morphTargets[b]]=-1;for(const b in T){const y=[],S=[];for(let A=0;A!==m[E].morphTargets.length;++A){const C=m[E];y.push(C.time),S.push(C.morphTarget===b?1:0)}s.push(new cd(".morphTargetInfluence["+b+"]",y,S))}d=T.length*l}else{const T=".bones["+n[p].name+"]";r(ud,T+".position",m,"pos",s),r(wc,T+".quaternion",m,"rot",s),r(ud,T+".scale",m,"scl",s)}}return s.length===0?null:new this(a,d,s,u)}resetDuration(){const e=this.tracks;let n=0;for(let r=0,s=e.length;r!==s;++r){const a=this.tracks[r];n=Math.max(n,a.times[a.times.length-1])}return this.duration=n,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let n=0;n<this.tracks.length;n++)e=e&&this.tracks[n].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function ZX(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return cd;case"vector":case"vector2":case"vector3":case"vector4":return ud;case"color":return PM;case"quaternion":return wc;case"bool":case"boolean":return kp;case"string":return Pp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function qX(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=ZX(i.type);if(i.times===void 0){const n=[],r=[];NM(i.keys,n,r,"value"),i.times=n,i.values=r}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const Cp={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class z${constructor(e,n,r){const s=this;let a=!1,l=0,u=0,d;const h=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=r,this.itemStart=function(f){u++,a===!1&&s.onStart!==void 0&&s.onStart(f,l,u),a=!0},this.itemEnd=function(f){l++,s.onProgress!==void 0&&s.onProgress(f,l,u),l===u&&(a=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(f){s.onError!==void 0&&s.onError(f)},this.resolveURL=function(f){return d?d(f):f},this.setURLModifier=function(f){return d=f,this},this.addHandler=function(f,p){return h.push(f,p),this},this.removeHandler=function(f){const p=h.indexOf(f);return p!==-1&&h.splice(p,2),this},this.getHandler=function(f){for(let p=0,m=h.length;p<m;p+=2){const T=h[p],E=h[p+1];if(T.global&&(T.lastIndex=0),T.test(f))return E}return null}}}const oU=new z$;class as{constructor(e){this.manager=e!==void 0?e:oU,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const r=this;return new Promise(function(s,a){r.load(e,s,n,a)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const gu={};class QX extends Error{constructor(e,n){super(e),this.response=n}}class Lr extends as{constructor(e){super(e)}load(e,n,r,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=Cp.get(e);if(a!==void 0)return this.manager.itemStart(e),setTimeout(()=>{n&&n(a),this.manager.itemEnd(e)},0),a;if(gu[e]!==void 0){gu[e].push({onLoad:n,onProgress:r,onError:s});return}gu[e]=[],gu[e].push({onLoad:n,onProgress:r,onError:s});const l=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),u=this.mimeType,d=this.responseType;fetch(l).then(h=>{if(h.status===200||h.status===0){if(h.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||h.body===void 0||h.body.getReader===void 0)return h;const f=gu[e],p=h.body.getReader(),m=h.headers.get("Content-Length")||h.headers.get("X-File-Size"),T=m?parseInt(m):0,E=T!==0;let b=0;const y=new ReadableStream({start(S){A();function A(){p.read().then(({done:C,value:R})=>{if(C)S.close();else{b+=R.byteLength;const I=new ProgressEvent("progress",{lengthComputable:E,loaded:b,total:T});for(let O=0,F=f.length;O<F;O++){const k=f[O];k.onProgress&&k.onProgress(I)}S.enqueue(R),A()}})}}});return new Response(y)}else throw new QX(`fetch for "${h.url}" responded with ${h.status}: ${h.statusText}`,h)}).then(h=>{switch(d){case"arraybuffer":return h.arrayBuffer();case"blob":return h.blob();case"document":return h.text().then(f=>new DOMParser().parseFromString(f,u));case"json":return h.json();default:if(u===void 0)return h.text();{const p=/charset="?([^;"\s]*)"?/i.exec(u),m=p&&p[1]?p[1].toLowerCase():void 0,T=new TextDecoder(m);return h.arrayBuffer().then(E=>T.decode(E))}}}).then(h=>{Cp.add(e,h);const f=gu[e];delete gu[e];for(let p=0,m=f.length;p<m;p++){const T=f[p];T.onLoad&&T.onLoad(h)}}).catch(h=>{const f=gu[e];if(f===void 0)throw this.manager.itemError(e),h;delete gu[e];for(let p=0,m=f.length;p<m;p++){const T=f[p];T.onError&&T.onError(h)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class ej extends as{constructor(e){super(e)}load(e,n,r,s){const a=this,l=new Lr(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(u){try{n(a.parse(JSON.parse(u)))}catch(d){s?s(d):console.error(d),a.manager.itemError(e)}},r,s)}parse(e){const n=[];for(let r=0;r<e.length;r++){const s=Ap.parse(e[r]);n.push(s)}return n}}class tj extends as{constructor(e){super(e)}load(e,n,r,s){const a=this,l=[],u=new AM,d=new Lr(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(a.withCredentials);let h=0;function f(p){d.load(e[p],function(m){const T=a.parse(m,!0);l[p]={width:T.width,height:T.height,format:T.format,mipmaps:T.mipmaps},h+=1,h===6&&(T.mipmapCount===1&&(u.minFilter=Gn),u.image=l,u.format=T.format,u.needsUpdate=!0,n&&n(u))},r,s)}if(Array.isArray(e))for(let p=0,m=e.length;p<m;++p)f(p);else d.load(e,function(p){const m=a.parse(p,!0);if(m.isCubemap){const T=m.mipmaps.length/m.mipmapCount;for(let E=0;E<T;E++){l[E]={mipmaps:[]};for(let b=0;b<m.mipmapCount;b++)l[E].mipmaps.push(m.mipmaps[E*m.mipmapCount+b]),l[E].format=m.format,l[E].width=m.width,l[E].height=m.height}u.image=l}else u.image.width=m.width,u.image.height=m.height,u.mipmaps=m.mipmaps;m.mipmapCount===1&&(u.minFilter=Gn),u.format=m.format,u.needsUpdate=!0,n&&n(u)},r,s);return u}}class cE extends as{constructor(e){super(e)}load(e,n,r,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,l=Cp.get(e);if(l!==void 0)return a.manager.itemStart(e),setTimeout(function(){n&&n(l),a.manager.itemEnd(e)},0),l;const u=iE("img");function d(){f(),Cp.add(e,this),n&&n(this),a.manager.itemEnd(e)}function h(p){f(),s&&s(p),a.manager.itemError(e),a.manager.itemEnd(e)}function f(){u.removeEventListener("load",d,!1),u.removeEventListener("error",h,!1)}return u.addEventListener("load",d,!1),u.addEventListener("error",h,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(u.crossOrigin=this.crossOrigin),a.manager.itemStart(e),u.src=e,u}}class aU extends as{constructor(e){super(e)}load(e,n,r,s){const a=new SE;a.colorSpace=Tn;const l=new cE(this.manager);l.setCrossOrigin(this.crossOrigin),l.setPath(this.path);let u=0;function d(h){l.load(e[h],function(f){a.images[h]=f,u++,u===6&&(a.needsUpdate=!0,n&&n(a))},void 0,s)}for(let h=0;h<e.length;++h)d(h);return a}}class DM extends as{constructor(e){super(e)}load(e,n,r,s){const a=this,l=new ap,u=new Lr(this.manager);return u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setPath(this.path),u.setWithCredentials(a.withCredentials),u.load(e,function(d){const h=a.parse(d);h&&(h.image!==void 0?l.image=h.image:h.data!==void 0&&(l.image.width=h.width,l.image.height=h.height,l.image.data=h.data),l.wrapS=h.wrapS!==void 0?h.wrapS:Pi,l.wrapT=h.wrapT!==void 0?h.wrapT:Pi,l.magFilter=h.magFilter!==void 0?h.magFilter:Gn,l.minFilter=h.minFilter!==void 0?h.minFilter:Gn,l.anisotropy=h.anisotropy!==void 0?h.anisotropy:1,h.colorSpace!==void 0?l.colorSpace=h.colorSpace:h.encoding!==void 0&&(l.encoding=h.encoding),h.flipY!==void 0&&(l.flipY=h.flipY),h.format!==void 0&&(l.format=h.format),h.type!==void 0&&(l.type=h.type),h.mipmaps!==void 0&&(l.mipmaps=h.mipmaps,l.minFilter=Ka),h.mipmapCount===1&&(l.minFilter=Gn),h.generateMipmaps!==void 0&&(l.generateMipmaps=h.generateMipmaps),l.needsUpdate=!0,n&&n(l,h))},r,s),l}}class BM extends as{constructor(e){super(e)}load(e,n,r,s){const a=new ni,l=new cE(this.manager);return l.setCrossOrigin(this.crossOrigin),l.setPath(this.path),l.load(e,function(u){a.image=u,a.needsUpdate=!0,n!==void 0&&n(a)},r,s),a}}class _d extends Xn{constructor(e,n=1){super(),this.isLight=!0,this.type="Light",this.color=new Ct(e),this.intensity=n}dispose(){}copy(e,n){return super.copy(e,n),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const n=super.toJSON(e);return n.object.color=this.color.getHex(),n.object.intensity=this.intensity,this.groundColor!==void 0&&(n.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(n.object.distance=this.distance),this.angle!==void 0&&(n.object.angle=this.angle),this.decay!==void 0&&(n.object.decay=this.decay),this.penumbra!==void 0&&(n.object.penumbra=this.penumbra),this.shadow!==void 0&&(n.object.shadow=this.shadow.toJSON()),n}}class lU extends _d{constructor(e,n,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Xn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ct(n)}copy(e,n){return super.copy(e,n),this.groundColor.copy(e.groundColor),this}}const OC=new pn,PN=new te,DN=new te;class FM{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new mt(512,512),this.map=null,this.mapPass=null,this.matrix=new pn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new M$,this._frameExtents=new mt(1,1),this._viewportCount=1,this._viewports=[new Hn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const n=this.camera,r=this.matrix;PN.setFromMatrixPosition(e.matrixWorld),n.position.copy(PN),DN.setFromMatrixPosition(e.target.matrixWorld),n.lookAt(DN),n.updateMatrixWorld(),OC.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(OC),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(OC)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class nj extends FM{constructor(){super(new Ui(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const n=this.camera,r=Wg*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,a=e.distance||n.far;(r!==n.fov||s!==n.aspect||a!==n.far)&&(n.fov=r,n.aspect=s,n.far=a,n.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class W$ extends _d{constructor(e,n,r=0,s=Math.PI/3,a=0,l=2){super(e,n),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Xn.DEFAULT_UP),this.updateMatrix(),this.target=new Xn,this.distance=r,this.angle=s,this.penumbra=a,this.decay=l,this.map=null,this.shadow=new nj}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const BN=new pn,zv=new te,LC=new te;class ij extends FM{constructor(){super(new Ui(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new mt(4,2),this._viewportCount=6,this._viewports=[new Hn(2,1,1,1),new Hn(0,1,1,1),new Hn(3,1,1,1),new Hn(1,1,1,1),new Hn(3,0,1,1),new Hn(1,0,1,1)],this._cubeDirections=[new te(1,0,0),new te(-1,0,0),new te(0,0,1),new te(0,0,-1),new te(0,1,0),new te(0,-1,0)],this._cubeUps=[new te(0,1,0),new te(0,1,0),new te(0,1,0),new te(0,1,0),new te(0,0,1),new te(0,0,-1)]}updateMatrices(e,n=0){const r=this.camera,s=this.matrix,a=e.distance||r.far;a!==r.far&&(r.far=a,r.updateProjectionMatrix()),zv.setFromMatrixPosition(e.matrixWorld),r.position.copy(zv),LC.copy(r.position),LC.add(this._cubeDirections[n]),r.up.copy(this._cubeUps[n]),r.lookAt(LC),r.updateMatrixWorld(),s.makeTranslation(-zv.x,-zv.y,-zv.z),BN.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(BN)}}class X$ extends _d{constructor(e,n,r=0,s=2){super(e,n),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=s,this.shadow=new ij}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,n){return super.copy(e,n),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class rj extends FM{constructor(){super(new ua(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class j$ extends _d{constructor(e,n){super(e,n),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Xn.DEFAULT_UP),this.updateMatrix(),this.target=new Xn,this.shadow=new rj}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class cU extends _d{constructor(e,n){super(e,n),this.isAmbientLight=!0,this.type="AmbientLight"}}class uU extends _d{constructor(e,n,r=10,s=10){super(e,n),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const n=super.toJSON(e);return n.object.width=this.width,n.object.height=this.height,n}}class hU{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new te)}set(e){for(let n=0;n<9;n++)this.coefficients[n].copy(e[n]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,n){const r=e.x,s=e.y,a=e.z,l=this.coefficients;return n.copy(l[0]).multiplyScalar(.282095),n.addScaledVector(l[1],.488603*s),n.addScaledVector(l[2],.488603*a),n.addScaledVector(l[3],.488603*r),n.addScaledVector(l[4],1.092548*(r*s)),n.addScaledVector(l[5],1.092548*(s*a)),n.addScaledVector(l[6],.315392*(3*a*a-1)),n.addScaledVector(l[7],1.092548*(r*a)),n.addScaledVector(l[8],.546274*(r*r-s*s)),n}getIrradianceAt(e,n){const r=e.x,s=e.y,a=e.z,l=this.coefficients;return n.copy(l[0]).multiplyScalar(.886227),n.addScaledVector(l[1],2*.511664*s),n.addScaledVector(l[2],2*.511664*a),n.addScaledVector(l[3],2*.511664*r),n.addScaledVector(l[4],2*.429043*r*s),n.addScaledVector(l[5],2*.429043*s*a),n.addScaledVector(l[6],.743125*a*a-.247708),n.addScaledVector(l[7],2*.429043*r*a),n.addScaledVector(l[8],.429043*(r*r-s*s)),n}add(e){for(let n=0;n<9;n++)this.coefficients[n].add(e.coefficients[n]);return this}addScaledSH(e,n){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],n);return this}scale(e){for(let n=0;n<9;n++)this.coefficients[n].multiplyScalar(e);return this}lerp(e,n){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],n);return this}equals(e){for(let n=0;n<9;n++)if(!this.coefficients[n].equals(e.coefficients[n]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,n=0){const r=this.coefficients;for(let s=0;s<9;s++)r[s].fromArray(e,n+s*3);return this}toArray(e=[],n=0){const r=this.coefficients;for(let s=0;s<9;s++)r[s].toArray(e,n+s*3);return e}static getBasisAt(e,n){const r=e.x,s=e.y,a=e.z;n[0]=.282095,n[1]=.488603*s,n[2]=.488603*a,n[3]=.488603*r,n[4]=1.092548*r*s,n[5]=1.092548*s*a,n[6]=.315392*(3*a*a-1),n[7]=1.092548*r*a,n[8]=.546274*(r*r-s*s)}}class Y$ extends _d{constructor(e=new hU,n=1){super(void 0,n),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const n=super.toJSON(e);return n.object.sh=this.sh.toArray(),n}}class K$ extends as{constructor(e){super(e),this.textures={}}load(e,n,r,s){const a=this,l=new Lr(a.manager);l.setPath(a.path),l.setRequestHeader(a.requestHeader),l.setWithCredentials(a.withCredentials),l.load(e,function(u){try{n(a.parse(JSON.parse(u)))}catch(d){s?s(d):console.error(d),a.manager.itemError(e)}},r,s)}parse(e){const n=this.textures;function r(a){return n[a]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",a),n[a]}const s=K$.createMaterialFromType(e.type);if(e.uuid!==void 0&&(s.uuid=e.uuid),e.name!==void 0&&(s.name=e.name),e.color!==void 0&&s.color!==void 0&&s.color.setHex(e.color),e.roughness!==void 0&&(s.roughness=e.roughness),e.metalness!==void 0&&(s.metalness=e.metalness),e.sheen!==void 0&&(s.sheen=e.sheen),e.sheenColor!==void 0&&(s.sheenColor=new Ct().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(s.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(e.emissive),e.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(e.specular),e.specularIntensity!==void 0&&(s.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(s.shininess=e.shininess),e.clearcoat!==void 0&&(s.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(s.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(s.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(s.transmission=e.transmission),e.thickness!==void 0&&(s.thickness=e.thickness),e.attenuationDistance!==void 0&&(s.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(s.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(s.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.combine!==void 0&&(s.combine=e.combine),e.side!==void 0&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.opacity!==void 0&&(s.opacity=e.opacity),e.transparent!==void 0&&(s.transparent=e.transparent),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(s.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(s.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(s.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(s.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(s.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(s.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(s.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(s.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.linewidth!==1&&(s.linewidth=e.linewidth),e.dashSize!==void 0&&(s.dashSize=e.dashSize),e.gapSize!==void 0&&(s.gapSize=e.gapSize),e.scale!==void 0&&(s.scale=e.scale),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(s.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(s.visible=e.visible),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.userData!==void 0&&(s.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const a in e.uniforms){const l=e.uniforms[a];switch(s.uniforms[a]={},l.type){case"t":s.uniforms[a].value=r(l.value);break;case"c":s.uniforms[a].value=new Ct().setHex(l.value);break;case"v2":s.uniforms[a].value=new mt().fromArray(l.value);break;case"v3":s.uniforms[a].value=new te().fromArray(l.value);break;case"v4":s.uniforms[a].value=new Hn().fromArray(l.value);break;case"m3":s.uniforms[a].value=new Ln().fromArray(l.value);break;case"m4":s.uniforms[a].value=new pn().fromArray(l.value);break;default:s.uniforms[a].value=l.value}}if(e.defines!==void 0&&(s.defines=e.defines),e.vertexShader!==void 0&&(s.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(s.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(s.glslVersion=e.glslVersion),e.extensions!==void 0)for(const a in e.extensions)s.extensions[a]=e.extensions[a];if(e.lights!==void 0&&(s.lights=e.lights),e.clipping!==void 0&&(s.clipping=e.clipping),e.size!==void 0&&(s.size=e.size),e.sizeAttenuation!==void 0&&(s.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(s.map=r(e.map)),e.matcap!==void 0&&(s.matcap=r(e.matcap)),e.alphaMap!==void 0&&(s.alphaMap=r(e.alphaMap)),e.bumpMap!==void 0&&(s.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(s.bumpScale=e.bumpScale),e.normalMap!==void 0&&(s.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(s.normalMapType=e.normalMapType),e.normalScale!==void 0){let a=e.normalScale;Array.isArray(a)===!1&&(a=[a,a]),s.normalScale=new mt().fromArray(a)}return e.displacementMap!==void 0&&(s.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(s.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(s.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(s.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(s.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(s.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(s.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(s.specularMap=r(e.specularMap)),e.specularIntensityMap!==void 0&&(s.specularIntensityMap=r(e.specularIntensityMap)),e.specularColorMap!==void 0&&(s.specularColorMap=r(e.specularColorMap)),e.envMap!==void 0&&(s.envMap=r(e.envMap)),e.envMapIntensity!==void 0&&(s.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(s.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(s.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(s.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(s.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(s.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(s.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(s.gradientMap=r(e.gradientMap)),e.clearcoatMap!==void 0&&(s.clearcoatMap=r(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new mt().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(s.iridescenceMap=r(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(s.transmissionMap=r(e.transmissionMap)),e.thicknessMap!==void 0&&(s.thicknessMap=r(e.thicknessMap)),e.anisotropyMap!==void 0&&(s.anisotropyMap=r(e.anisotropyMap)),e.sheenColorMap!==void 0&&(s.sheenColorMap=r(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=r(e.sheenRoughnessMap)),s}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const n={ShadowMaterial:YF,SpriteMaterial:bM,RawShaderMaterial:KF,ShaderMaterial:Oo,PointsMaterial:bE,MeshPhysicalMaterial:Nr,MeshStandardMaterial:Lp,MeshPhongMaterial:JF,MeshToonMaterial:ZF,MeshNormalMaterial:qF,MeshLambertMaterial:QF,MeshDepthMaterial:O$,MeshDistanceMaterial:L$,MeshBasicMaterial:ii,MeshMatcapMaterial:eU,LineDashedMaterial:tU,LineBasicMaterial:fi,Material:rr};return new n[e]}}class Nl{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let n="";for(let r=0,s=e.length;r<s;r++)n+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(n))}catch{return n}}static extractUrlBase(e){const n=e.lastIndexOf("/");return n===-1?"./":e.slice(0,n+1)}static resolveURL(e,n){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(n)&&/^\//.test(e)&&(n=n.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:n+e)}}class J$ extends rn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class dU extends as{constructor(e){super(e)}load(e,n,r,s){const a=this,l=new Lr(a.manager);l.setPath(a.path),l.setRequestHeader(a.requestHeader),l.setWithCredentials(a.withCredentials),l.load(e,function(u){try{n(a.parse(JSON.parse(u)))}catch(d){s?s(d):console.error(d),a.manager.itemError(e)}},r,s)}parse(e){const n={},r={};function s(T,E){if(n[E]!==void 0)return n[E];const y=T.interleavedBuffers[E],S=a(T,y.buffer),A=Sg(y.type,S),C=new t_(A,y.stride);return C.uuid=y.uuid,n[E]=C,C}function a(T,E){if(r[E]!==void 0)return r[E];const y=T.arrayBuffers[E],S=new Uint32Array(y).buffer;return r[E]=S,S}const l=e.isInstancedBufferGeometry?new J$:new rn,u=e.data.index;if(u!==void 0){const T=Sg(u.type,u.array);l.setIndex(new Qn(T,1))}const d=e.data.attributes;for(const T in d){const E=d[T];let b;if(E.isInterleavedBufferAttribute){const y=s(e.data,E.data);b=new lo(y,E.itemSize,E.offset,E.normalized)}else{const y=Sg(E.type,E.array),S=E.isInstancedBufferAttribute?ld:Qn;b=new S(y,E.itemSize,E.normalized)}E.name!==void 0&&(b.name=E.name),E.usage!==void 0&&b.setUsage(E.usage),E.updateRange!==void 0&&(b.updateRange.offset=E.updateRange.offset,b.updateRange.count=E.updateRange.count),l.setAttribute(T,b)}const h=e.data.morphAttributes;if(h)for(const T in h){const E=h[T],b=[];for(let y=0,S=E.length;y<S;y++){const A=E[y];let C;if(A.isInterleavedBufferAttribute){const R=s(e.data,A.data);C=new lo(R,A.itemSize,A.offset,A.normalized)}else{const R=Sg(A.type,A.array);C=new Qn(R,A.itemSize,A.normalized)}A.name!==void 0&&(C.name=A.name),b.push(C)}l.morphAttributes[T]=b}e.data.morphTargetsRelative&&(l.morphTargetsRelative=!0);const p=e.data.groups||e.data.drawcalls||e.data.offsets;if(p!==void 0)for(let T=0,E=p.length;T!==E;++T){const b=p[T];l.addGroup(b.start,b.count,b.materialIndex)}const m=e.data.boundingSphere;if(m!==void 0){const T=new te;m.center!==void 0&&T.fromArray(m.center),l.boundingSphere=new js(T,m.radius)}return e.name&&(l.name=e.name),e.userData&&(l.userData=e.userData),l}}class sj extends as{constructor(e){super(e)}load(e,n,r,s){const a=this,l=this.path===""?Nl.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||l;const u=new Lr(this.manager);u.setPath(this.path),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(d){let h=null;try{h=JSON.parse(d)}catch(p){s!==void 0&&s(p),console.error("THREE:ObjectLoader: Can't parse "+e+".",p.message);return}const f=h.metadata;if(f===void 0||f.type===void 0||f.type.toLowerCase()==="geometry"){s!==void 0&&s(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}a.parse(h,n)},r,s)}async loadAsync(e,n){const r=this,s=this.path===""?Nl.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const a=new Lr(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials);const l=await a.loadAsync(e,n),u=JSON.parse(l),d=u.metadata;if(d===void 0||d.type===void 0||d.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await r.parseAsync(u)}parse(e,n){const r=this.parseAnimations(e.animations),s=this.parseShapes(e.shapes),a=this.parseGeometries(e.geometries,s),l=this.parseImages(e.images,function(){n!==void 0&&n(h)}),u=this.parseTextures(e.textures,l),d=this.parseMaterials(e.materials,u),h=this.parseObject(e.object,a,d,u,r),f=this.parseSkeletons(e.skeletons,h);if(this.bindSkeletons(h,f),n!==void 0){let p=!1;for(const m in l)if(l[m].data instanceof HTMLImageElement){p=!0;break}p===!1&&n(h)}return h}async parseAsync(e){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),a=await this.parseImagesAsync(e.images),l=this.parseTextures(e.textures,a),u=this.parseMaterials(e.materials,l),d=this.parseObject(e.object,s,u,l,n),h=this.parseSkeletons(e.skeletons,d);return this.bindSkeletons(d,h),d}parseShapes(e){const n={};if(e!==void 0)for(let r=0,s=e.length;r<s;r++){const a=new lp().fromJSON(e[r]);n[a.uuid]=a}return n}parseSkeletons(e,n){const r={},s={};if(n.traverse(function(a){a.isBone&&(s[a.uuid]=a)}),e!==void 0)for(let a=0,l=e.length;a<l;a++){const u=new n_().fromJSON(e[a],s);r[u.uuid]=u}return r}parseGeometries(e,n){const r={};if(e!==void 0){const s=new dU;for(let a=0,l=e.length;a<l;a++){let u;const d=e[a];switch(d.type){case"BufferGeometry":case"InstancedBufferGeometry":u=s.parse(d);break;default:d.type in kN?u=kN[d.type].fromJSON(d,n):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${d.type}"`)}u.uuid=d.uuid,d.name!==void 0&&(u.name=d.name),d.userData!==void 0&&(u.userData=d.userData),r[d.uuid]=u}}return r}parseMaterials(e,n){const r={},s={};if(e!==void 0){const a=new K$;a.setTextures(n);for(let l=0,u=e.length;l<u;l++){const d=e[l];r[d.uuid]===void 0&&(r[d.uuid]=a.parse(d)),s[d.uuid]=r[d.uuid]}}return s}parseAnimations(e){const n={};if(e!==void 0)for(let r=0;r<e.length;r++){const s=e[r],a=Ap.parse(s);n[a.uuid]=a}return n}parseImages(e,n){const r=this,s={};let a;function l(d){return r.manager.itemStart(d),a.load(d,function(){r.manager.itemEnd(d)},void 0,function(){r.manager.itemError(d),r.manager.itemEnd(d)})}function u(d){if(typeof d=="string"){const h=d,f=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:r.resourcePath+h;return l(f)}else return d.data?{data:Sg(d.type,d.data),width:d.width,height:d.height}:null}if(e!==void 0&&e.length>0){const d=new z$(n);a=new cE(d),a.setCrossOrigin(this.crossOrigin);for(let h=0,f=e.length;h<f;h++){const p=e[h],m=p.url;if(Array.isArray(m)){const T=[];for(let E=0,b=m.length;E<b;E++){const y=m[E],S=u(y);S!==null&&(S instanceof HTMLImageElement?T.push(S):T.push(new ap(S.data,S.width,S.height)))}s[p.uuid]=new Yf(T)}else{const T=u(p.url);s[p.uuid]=new Yf(T)}}}return s}async parseImagesAsync(e){const n=this,r={};let s;async function a(l){if(typeof l=="string"){const u=l,d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:n.resourcePath+u;return await s.loadAsync(d)}else return l.data?{data:Sg(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){s=new cE(this.manager),s.setCrossOrigin(this.crossOrigin);for(let l=0,u=e.length;l<u;l++){const d=e[l],h=d.url;if(Array.isArray(h)){const f=[];for(let p=0,m=h.length;p<m;p++){const T=h[p],E=await a(T);E!==null&&(E instanceof HTMLImageElement?f.push(E):f.push(new ap(E.data,E.width,E.height)))}r[d.uuid]=new Yf(f)}else{const f=await a(d.url);r[d.uuid]=new Yf(f)}}}return r}parseTextures(e,n){function r(a,l){return typeof a=="number"?a:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",a),l[a])}const s={};if(e!==void 0)for(let a=0,l=e.length;a<l;a++){const u=e[a];u.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',u.uuid),n[u.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",u.image);const d=n[u.image],h=d.data;let f;Array.isArray(h)?(f=new SE,h.length===6&&(f.needsUpdate=!0)):(h&&h.data?f=new ap:f=new ni,h&&(f.needsUpdate=!0)),f.source=d,f.uuid=u.uuid,u.name!==void 0&&(f.name=u.name),u.mapping!==void 0&&(f.mapping=r(u.mapping,oj)),u.channel!==void 0&&(f.channel=u.channel),u.offset!==void 0&&f.offset.fromArray(u.offset),u.repeat!==void 0&&f.repeat.fromArray(u.repeat),u.center!==void 0&&f.center.fromArray(u.center),u.rotation!==void 0&&(f.rotation=u.rotation),u.wrap!==void 0&&(f.wrapS=r(u.wrap[0],FN),f.wrapT=r(u.wrap[1],FN)),u.format!==void 0&&(f.format=u.format),u.internalFormat!==void 0&&(f.internalFormat=u.internalFormat),u.type!==void 0&&(f.type=u.type),u.colorSpace!==void 0&&(f.colorSpace=u.colorSpace),u.encoding!==void 0&&(f.encoding=u.encoding),u.minFilter!==void 0&&(f.minFilter=r(u.minFilter,UN)),u.magFilter!==void 0&&(f.magFilter=r(u.magFilter,UN)),u.anisotropy!==void 0&&(f.anisotropy=u.anisotropy),u.flipY!==void 0&&(f.flipY=u.flipY),u.generateMipmaps!==void 0&&(f.generateMipmaps=u.generateMipmaps),u.premultiplyAlpha!==void 0&&(f.premultiplyAlpha=u.premultiplyAlpha),u.unpackAlignment!==void 0&&(f.unpackAlignment=u.unpackAlignment),u.compareFunction!==void 0&&(f.compareFunction=u.compareFunction),u.userData!==void 0&&(f.userData=u.userData),s[u.uuid]=f}return s}parseObject(e,n,r,s,a){let l;function u(m){return n[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",m),n[m]}function d(m){if(m!==void 0){if(Array.isArray(m)){const T=[];for(let E=0,b=m.length;E<b;E++){const y=m[E];r[y]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",y),T.push(r[y])}return T}return r[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",m),r[m]}}function h(m){return s[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",m),s[m]}let f,p;switch(e.type){case"Scene":l=new jg,e.background!==void 0&&(Number.isInteger(e.background)?l.background=new Ct(e.background):l.background=h(e.background)),e.environment!==void 0&&(l.environment=h(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?l.fog=new P$(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(l.fog=new k$(e.fog.color,e.fog.density))),e.backgroundBlurriness!==void 0&&(l.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(l.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":l=new Ui(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(l.focus=e.focus),e.zoom!==void 0&&(l.zoom=e.zoom),e.filmGauge!==void 0&&(l.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(l.filmOffset=e.filmOffset),e.view!==void 0&&(l.view=Object.assign({},e.view));break;case"OrthographicCamera":l=new ua(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(l.zoom=e.zoom),e.view!==void 0&&(l.view=Object.assign({},e.view));break;case"AmbientLight":l=new cU(e.color,e.intensity);break;case"DirectionalLight":l=new j$(e.color,e.intensity);break;case"PointLight":l=new X$(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":l=new uU(e.color,e.intensity,e.width,e.height);break;case"SpotLight":l=new W$(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":l=new lU(e.color,e.groundColor,e.intensity);break;case"LightProbe":l=new Y$().fromJSON(e);break;case"SkinnedMesh":f=u(e.geometry),p=d(e.material),l=new D$(f,p),e.bindMode!==void 0&&(l.bindMode=e.bindMode),e.bindMatrix!==void 0&&l.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(l.skeleton=e.skeleton);break;case"Mesh":f=u(e.geometry),p=d(e.material),l=new Pn(f,p);break;case"InstancedMesh":f=u(e.geometry),p=d(e.material);const m=e.count,T=e.instanceMatrix,E=e.instanceColor;l=new B$(f,p,m),l.instanceMatrix=new ld(new Float32Array(T.array),16),E!==void 0&&(l.instanceColor=new ld(new Float32Array(E.array),E.itemSize));break;case"LOD":l=new BF;break;case"Line":l=new Ki(u(e.geometry),d(e.material));break;case"LineLoop":l=new F$(u(e.geometry),d(e.material));break;case"LineSegments":l=new Ja(u(e.geometry),d(e.material));break;case"PointCloud":case"Points":l=new U$(u(e.geometry),d(e.material));break;case"Sprite":l=new DF(d(e.material));break;case"Group":l=new za;break;case"Bone":l=new $E;break;default:l=new Xn}if(l.uuid=e.uuid,e.name!==void 0&&(l.name=e.name),e.matrix!==void 0?(l.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(l.matrixAutoUpdate=e.matrixAutoUpdate),l.matrixAutoUpdate&&l.matrix.decompose(l.position,l.quaternion,l.scale)):(e.position!==void 0&&l.position.fromArray(e.position),e.rotation!==void 0&&l.rotation.fromArray(e.rotation),e.quaternion!==void 0&&l.quaternion.fromArray(e.quaternion),e.scale!==void 0&&l.scale.fromArray(e.scale)),e.up!==void 0&&l.up.fromArray(e.up),e.castShadow!==void 0&&(l.castShadow=e.castShadow),e.receiveShadow!==void 0&&(l.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(l.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(l.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(l.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&l.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(l.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(l.visible=e.visible),e.frustumCulled!==void 0&&(l.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(l.renderOrder=e.renderOrder),e.userData!==void 0&&(l.userData=e.userData),e.layers!==void 0&&(l.layers.mask=e.layers),e.children!==void 0){const m=e.children;for(let T=0;T<m.length;T++)l.add(this.parseObject(m[T],n,r,s,a))}if(e.animations!==void 0){const m=e.animations;for(let T=0;T<m.length;T++){const E=m[T];l.animations.push(a[E])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(l.autoUpdate=e.autoUpdate);const m=e.levels;for(let T=0;T<m.length;T++){const E=m[T],b=l.getObjectByProperty("uuid",E.object);b!==void 0&&l.addLevel(b,E.distance,E.hysteresis)}}return l}bindSkeletons(e,n){Object.keys(n).length!==0&&e.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const s=n[r.skeleton];s===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(s,r.bindMatrix)}})}}const oj={UVMapping:od,CubeReflectionMapping:Ou,CubeRefractionMapping:ad,EquirectangularReflectionMapping:Vg,EquirectangularRefractionMapping:QT,CubeUVReflectionMapping:Qg},FN={RepeatWrapping:Pl,ClampToEdgeWrapping:Pi,MirroredRepeatWrapping:Ep},UN={NearestFilter:tr,NearestMipmapNearestFilter:zg,NearestMipmapLinearFilter:ip,LinearFilter:Gn,LinearMipmapNearestFilter:vE,LinearMipmapLinearFilter:Ka};class UM extends as{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,n,r,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,l=Cp.get(e);if(l!==void 0)return a.manager.itemStart(e),setTimeout(function(){n&&n(l),a.manager.itemEnd(e)},0),l;const u={};u.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",u.headers=this.requestHeader,fetch(e,u).then(function(d){return d.blob()}).then(function(d){return createImageBitmap(d,Object.assign(a.options,{colorSpaceConversion:"none"}))}).then(function(d){Cp.add(e,d),n&&n(d),a.manager.itemEnd(e)}).catch(function(d){s&&s(d),a.manager.itemError(e),a.manager.itemEnd(e)}),a.manager.itemStart(e)}}let x0;class GM{static getContext(){return x0===void 0&&(x0=new(window.AudioContext||window.webkitAudioContext)),x0}static setContext(e){x0=e}}class aj extends as{constructor(e){super(e)}load(e,n,r,s){const a=this,l=new Lr(this.manager);l.setResponseType("arraybuffer"),l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(d){try{const h=d.slice(0);GM.getContext().decodeAudioData(h,function(p){n(p)},u)}catch(h){u(h)}},r,s);function u(d){s?s(d):console.error(d),a.manager.itemError(e)}}}class lj extends Y${constructor(e,n,r=1){super(void 0,r),this.isHemisphereLightProbe=!0;const s=new Ct().set(e),a=new Ct().set(n),l=new te(s.r,s.g,s.b),u=new te(a.r,a.g,a.b),d=Math.sqrt(Math.PI),h=d*Math.sqrt(.75);this.sh.coefficients[0].copy(l).add(u).multiplyScalar(d),this.sh.coefficients[1].copy(l).sub(u).multiplyScalar(h)}}class cj extends Y${constructor(e,n=1){super(void 0,n),this.isAmbientLightProbe=!0;const r=new Ct().set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const GN=new pn,HN=new pn,xf=new pn;class uj{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ui,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ui,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const n=this._cache;if(n.focus!==e.focus||n.fov!==e.fov||n.aspect!==e.aspect*this.aspect||n.near!==e.near||n.far!==e.far||n.zoom!==e.zoom||n.eyeSep!==this.eyeSep){n.focus=e.focus,n.fov=e.fov,n.aspect=e.aspect*this.aspect,n.near=e.near,n.far=e.far,n.zoom=e.zoom,n.eyeSep=this.eyeSep,xf.copy(e.projectionMatrix);const s=n.eyeSep/2,a=s*n.near/n.focus,l=n.near*Math.tan(rp*n.fov*.5)/n.zoom;let u,d;HN.elements[12]=-s,GN.elements[12]=s,u=-l*n.aspect+a,d=l*n.aspect+a,xf.elements[0]=2*n.near/(d-u),xf.elements[8]=(d+u)/(d-u),this.cameraL.projectionMatrix.copy(xf),u=-l*n.aspect-a,d=l*n.aspect-a,xf.elements[0]=2*n.near/(d-u),xf.elements[8]=(d+u)/(d-u),this.cameraR.projectionMatrix.copy(xf)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(HN),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(GN)}}class HM{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=VN(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const n=VN();e=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=e}return e}}function VN(){return(typeof performance>"u"?Date:performance).now()}const Rf=new te,zN=new Er,hj=new te,wf=new te;class dj extends Xn{constructor(){super(),this.type="AudioListener",this.context=GM.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new HM}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const n=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Rf,zN,hj),wf.set(0,0,-1).applyQuaternion(zN),n.positionX){const s=this.context.currentTime+this.timeDelta;n.positionX.linearRampToValueAtTime(Rf.x,s),n.positionY.linearRampToValueAtTime(Rf.y,s),n.positionZ.linearRampToValueAtTime(Rf.z,s),n.forwardX.linearRampToValueAtTime(wf.x,s),n.forwardY.linearRampToValueAtTime(wf.y,s),n.forwardZ.linearRampToValueAtTime(wf.z,s),n.upX.linearRampToValueAtTime(r.x,s),n.upY.linearRampToValueAtTime(r.y,s),n.upZ.linearRampToValueAtTime(r.z,s)}else n.setPosition(Rf.x,Rf.y,Rf.z),n.setOrientation(wf.x,wf.y,wf.z,r.x,r.y,r.z)}}class fU extends Xn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const n=this.context.createBufferSource();return n.buffer=this.buffer,n.loop=this.loop,n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.onended=this.onEnded.bind(this),n.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=n,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,n=this.filters.length;e<n;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Mf=new te,WN=new Er,fj=new te,If=new te;class pj extends fU{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,n,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=n,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Mf,WN,fj),If.set(0,0,1).applyQuaternion(WN);const n=this.panner;if(n.positionX){const r=this.context.currentTime+this.listener.timeDelta;n.positionX.linearRampToValueAtTime(Mf.x,r),n.positionY.linearRampToValueAtTime(Mf.y,r),n.positionZ.linearRampToValueAtTime(Mf.z,r),n.orientationX.linearRampToValueAtTime(If.x,r),n.orientationY.linearRampToValueAtTime(If.y,r),n.orientationZ.linearRampToValueAtTime(If.z,r)}else n.setPosition(Mf.x,Mf.y,Mf.z),n.setOrientation(If.x,If.y,If.z)}}class mj{constructor(e,n=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const n=this.getFrequencyData();for(let r=0;r<n.length;r++)e+=n[r];return e/n.length}}class pU{constructor(e,n,r){this.binding=e,this.valueSize=r;let s,a,l;switch(n){case"quaternion":s=this._slerp,a=this._slerpAdditive,l=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":s=this._select,a=this._select,l=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:s=this._lerp,a=this._lerpAdditive,l=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=a,this._setIdentity=l,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,n){const r=this.buffer,s=this.valueSize,a=e*s+s;let l=this.cumulativeWeight;if(l===0){for(let u=0;u!==s;++u)r[a+u]=r[u];l=n}else{l+=n;const u=n/l;this._mixBufferRegion(r,a,0,u,s)}this.cumulativeWeight=l}accumulateAdditive(e){const n=this.buffer,r=this.valueSize,s=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(n,s,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const n=this.valueSize,r=this.buffer,s=e*n+n,a=this.cumulativeWeight,l=this.cumulativeWeightAdditive,u=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){const d=n*this._origIndex;this._mixBufferRegion(r,s,d,1-a,n)}l>0&&this._mixBufferRegionAdditive(r,s,this._addIndex*n,1,n);for(let d=n,h=n+n;d!==h;++d)if(r[d]!==r[d+n]){u.setValue(r,s);break}}saveOriginalState(){const e=this.binding,n=this.buffer,r=this.valueSize,s=r*this._origIndex;e.getValue(n,s);for(let a=r,l=s;a!==l;++a)n[a]=n[s+a%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,n=e+this.valueSize;for(let r=e;r<n;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,n=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[n+r]=this.buffer[e+r]}_select(e,n,r,s,a){if(s>=.5)for(let l=0;l!==a;++l)e[n+l]=e[r+l]}_slerp(e,n,r,s){Er.slerpFlat(e,n,e,n,e,r,s)}_slerpAdditive(e,n,r,s,a){const l=this._workIndex*a;Er.multiplyQuaternionsFlat(e,l,e,n,e,r),Er.slerpFlat(e,n,e,n,e,l,s)}_lerp(e,n,r,s,a){const l=1-s;for(let u=0;u!==a;++u){const d=n+u;e[d]=e[d]*l+e[r+u]*s}}_lerpAdditive(e,n,r,s,a){for(let l=0;l!==a;++l){const u=n+l;e[u]=e[u]+e[r+l]*s}}}const VM="\\[\\]\\.:\\/",gj=new RegExp("["+VM+"]","g"),zM="[^"+VM+"]",_j="[^"+VM.replace("\\.","")+"]",vj=/((?:WC+[\/:])*)/.source.replace("WC",zM),Tj=/(WCOD+)?/.source.replace("WCOD",_j),Ej=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",zM),yj=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",zM),Sj=new RegExp("^"+vj+Tj+Ej+yj+"$"),$j=["material","materials","bones","map"];class bj{constructor(e,n,r){const s=r||Zn.parseTrackName(n);this._targetGroup=e,this._bindings=e.subscribe_(n,s)}getValue(e,n){this.bind();const r=this._targetGroup.nCachedObjects_,s=this._bindings[r];s!==void 0&&s.getValue(e,n)}setValue(e,n){const r=this._bindings;for(let s=this._targetGroup.nCachedObjects_,a=r.length;s!==a;++s)r[s].setValue(e,n)}bind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=e.length;n!==r;++n)e[n].bind()}unbind(){const e=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=e.length;n!==r;++n)e[n].unbind()}}class Zn{constructor(e,n,r){this.path=n,this.parsedPath=r||Zn.parseTrackName(n),this.node=Zn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,n,r){return e&&e.isAnimationObjectGroup?new Zn.Composite(e,n,r):new Zn(e,n,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(gj,"")}static parseTrackName(e){const n=Sj.exec(e);if(n===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:n[2],objectName:n[3],objectIndex:n[4],propertyName:n[5],propertyIndex:n[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const a=r.nodeName.substring(s+1);$j.indexOf(a)!==-1&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=a)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,n){if(n===void 0||n===""||n==="."||n===-1||n===e.name||n===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(n);if(r!==void 0)return r}if(e.children){const r=function(a){for(let l=0;l<a.length;l++){const u=a[l];if(u.name===n||u.uuid===n)return u;const d=r(u.children);if(d)return d}return null},s=r(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,n){e[n]=this.targetObject[this.propertyName]}_getValue_array(e,n){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)e[n++]=r[s]}_getValue_arrayElement(e,n){e[n]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,n){this.resolvedProperty.toArray(e,n)}_setValue_direct(e,n){this.targetObject[this.propertyName]=e[n]}_setValue_direct_setNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,n){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)r[s]=e[n++]}_setValue_array_setNeedsUpdate(e,n){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)r[s]=e[n++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,n){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)r[s]=e[n++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,n){this.resolvedProperty[this.propertyIndex]=e[n]}_setValue_arrayElement_setNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,n){this.resolvedProperty.fromArray(e,n)}_setValue_fromArray_setNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,n){this.bind(),this.getValue(e,n)}_setValue_unbound(e,n){this.bind(),this.setValue(e,n)}bind(){let e=this.node;const n=this.parsedPath,r=n.objectName,s=n.propertyName;let a=n.propertyIndex;if(e||(e=Zn.findNode(this.rootNode,n.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(r){let h=n.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let f=0;f<e.length;f++)if(e[f].name===h){h=f;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(h!==void 0){if(e[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[h]}}const l=e[s];if(l===void 0){const h=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+s+" but it wasn't found.",e);return}let u=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?u=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(u=this.Versioning.MatrixWorldNeedsUpdate);let d=this.BindingType.Direct;if(a!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[a]!==void 0&&(a=e.morphTargetDictionary[a])}d=this.BindingType.ArrayElement,this.resolvedProperty=l,this.propertyIndex=a}else l.fromArray!==void 0&&l.toArray!==void 0?(d=this.BindingType.HasFromToArray,this.resolvedProperty=l):Array.isArray(l)?(d=this.BindingType.EntireArray,this.resolvedProperty=l):this.propertyName=s;this.getValue=this.GetterByBindingType[d],this.setValue=this.SetterByBindingTypeAndVersioning[d][u]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Zn.Composite=bj;Zn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Zn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Zn.prototype.GetterByBindingType=[Zn.prototype._getValue_direct,Zn.prototype._getValue_array,Zn.prototype._getValue_arrayElement,Zn.prototype._getValue_toArray];Zn.prototype.SetterByBindingTypeAndVersioning=[[Zn.prototype._setValue_direct,Zn.prototype._setValue_direct_setNeedsUpdate,Zn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Zn.prototype._setValue_array,Zn.prototype._setValue_array_setNeedsUpdate,Zn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Zn.prototype._setValue_arrayElement,Zn.prototype._setValue_arrayElement_setNeedsUpdate,Zn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Zn.prototype._setValue_fromArray,Zn.prototype._setValue_fromArray_setNeedsUpdate,Zn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Aj{constructor(){this.isAnimationObjectGroup=!0,this.uuid=ca(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let r=0,s=arguments.length;r!==s;++r)e[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}add(){const e=this._objects,n=this._indicesByUUID,r=this._paths,s=this._parsedPaths,a=this._bindings,l=a.length;let u,d=e.length,h=this.nCachedObjects_;for(let f=0,p=arguments.length;f!==p;++f){const m=arguments[f],T=m.uuid;let E=n[T];if(E===void 0){E=d++,n[T]=E,e.push(m);for(let b=0,y=l;b!==y;++b)a[b].push(new Zn(m,r[b],s[b]))}else if(E<h){u=e[E];const b=--h,y=e[b];n[y.uuid]=E,e[E]=y,n[T]=b,e[b]=m;for(let S=0,A=l;S!==A;++S){const C=a[S],R=C[b];let I=C[E];C[E]=R,I===void 0&&(I=new Zn(m,r[S],s[S])),C[b]=I}}else e[E]!==u&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=h}remove(){const e=this._objects,n=this._indicesByUUID,r=this._bindings,s=r.length;let a=this.nCachedObjects_;for(let l=0,u=arguments.length;l!==u;++l){const d=arguments[l],h=d.uuid,f=n[h];if(f!==void 0&&f>=a){const p=a++,m=e[p];n[m.uuid]=f,e[f]=m,n[h]=p,e[p]=d;for(let T=0,E=s;T!==E;++T){const b=r[T],y=b[p],S=b[f];b[f]=y,b[p]=S}}}this.nCachedObjects_=a}uncache(){const e=this._objects,n=this._indicesByUUID,r=this._bindings,s=r.length;let a=this.nCachedObjects_,l=e.length;for(let u=0,d=arguments.length;u!==d;++u){const h=arguments[u],f=h.uuid,p=n[f];if(p!==void 0)if(delete n[f],p<a){const m=--a,T=e[m],E=--l,b=e[E];n[T.uuid]=p,e[p]=T,n[b.uuid]=m,e[m]=b,e.pop();for(let y=0,S=s;y!==S;++y){const A=r[y],C=A[m],R=A[E];A[p]=C,A[m]=R,A.pop()}}else{const m=--l,T=e[m];m>0&&(n[T.uuid]=p),e[p]=T,e.pop();for(let E=0,b=s;E!==b;++E){const y=r[E];y[p]=y[m],y.pop()}}}this.nCachedObjects_=a}subscribe_(e,n){const r=this._bindingsIndicesByPath;let s=r[e];const a=this._bindings;if(s!==void 0)return a[s];const l=this._paths,u=this._parsedPaths,d=this._objects,h=d.length,f=this.nCachedObjects_,p=new Array(h);s=a.length,r[e]=s,l.push(e),u.push(n),a.push(p);for(let m=f,T=d.length;m!==T;++m){const E=d[m];p[m]=new Zn(E,e,n)}return p}unsubscribe_(e){const n=this._bindingsIndicesByPath,r=n[e];if(r!==void 0){const s=this._paths,a=this._parsedPaths,l=this._bindings,u=l.length-1,d=l[u],h=e[u];n[h]=r,l[r]=d,l.pop(),a[r]=a[u],a.pop(),s[r]=s[u],s.pop()}}}class mU{constructor(e,n,r=null,s=n.blendMode){this._mixer=e,this._clip=n,this._localRoot=r,this.blendMode=s;const a=n.tracks,l=a.length,u=new Array(l),d={endingStart:Xf,endingEnd:Xf};for(let h=0;h!==l;++h){const f=a[h].createInterpolant(null);u[h]=f,f.settings=d}this._interpolantSettings=d,this._interpolants=u,this._propertyBindings=new Array(l),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=cF,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,n){return this.loop=e,this.repetitions=n,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,n,r){if(e.fadeOut(n),this.fadeIn(n),r){const s=this._clip.duration,a=e._clip.duration,l=a/s,u=s/a;e.warp(1,l,n),this.warp(u,1,n)}return this}crossFadeTo(e,n,r){return e.crossFadeFrom(this,n,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,n,r){const s=this._mixer,a=s.time,l=this.timeScale;let u=this._timeScaleInterpolant;u===null&&(u=s._lendControlInterpolant(),this._timeScaleInterpolant=u);const d=u.parameterPositions,h=u.sampleValues;return d[0]=a,d[1]=a+r,h[0]=e/l,h[1]=n/l,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,n,r,s){if(!this.enabled){this._updateWeight(e);return}const a=this._startTime;if(a!==null){const d=(e-a)*r;d<0||r===0?n=0:(this._startTime=null,n=r*d)}n*=this._updateTimeScale(e);const l=this._updateTime(n),u=this._updateWeight(e);if(u>0){const d=this._interpolants,h=this._propertyBindings;switch(this.blendMode){case fM:for(let f=0,p=d.length;f!==p;++f)d[f].evaluate(l),h[f].accumulateAdditive(u);break;case x$:default:for(let f=0,p=d.length;f!==p;++f)d[f].evaluate(l),h[f].accumulate(s,u)}}}_updateWeight(e){let n=0;if(this.enabled){n=this.weight;const r=this._weightInterpolant;if(r!==null){const s=r.evaluate(e)[0];n*=s,e>r.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=n,n}_updateTimeScale(e){let n=0;if(!this.paused){n=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const s=r.evaluate(e)[0];n*=s,e>r.parameterPositions[1]&&(this.stopWarping(),n===0?this.paused=!0:this.timeScale=n)}}return this._effectiveTimeScale=n,n}_updateTime(e){const n=this._clip.duration,r=this.loop;let s=this.time+e,a=this._loopCount;const l=r===uF;if(e===0)return a===-1?s:l&&(a&1)===1?n-s:s;if(r===lF){a===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=n)s=n;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(a===-1&&(e>=0?(a=0,this._setEndings(!0,this.repetitions===0,l)):this._setEndings(this.repetitions===0,!0,l)),s>=n||s<0){const u=Math.floor(s/n);s-=n*u,a+=Math.abs(u);const d=this.repetitions-a;if(d<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?n:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(d===1){const h=e<0;this._setEndings(h,!h,l)}else this._setEndings(!1,!1,l);this._loopCount=a,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:u})}}else this.time=s;if(l&&(a&1)===1)return n-s}return s}_setEndings(e,n,r){const s=this._interpolantSettings;r?(s.endingStart=jf,s.endingEnd=jf):(e?s.endingStart=this.zeroSlopeAtStart?jf:Xf:s.endingStart=eE,n?s.endingEnd=this.zeroSlopeAtEnd?jf:Xf:s.endingEnd=eE)}_scheduleFading(e,n,r){const s=this._mixer,a=s.time;let l=this._weightInterpolant;l===null&&(l=s._lendControlInterpolant(),this._weightInterpolant=l);const u=l.parameterPositions,d=l.sampleValues;return u[0]=a,d[0]=n,u[1]=a+e,d[1]=r,this}}const Cj=new Float32Array(1);class xj extends Mc{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,n){const r=e._localRoot||this._root,s=e._clip.tracks,a=s.length,l=e._propertyBindings,u=e._interpolants,d=r.uuid,h=this._bindingsByRootAndName;let f=h[d];f===void 0&&(f={},h[d]=f);for(let p=0;p!==a;++p){const m=s[p],T=m.name;let E=f[T];if(E!==void 0)++E.referenceCount,l[p]=E;else{if(E=l[p],E!==void 0){E._cacheIndex===null&&(++E.referenceCount,this._addInactiveBinding(E,d,T));continue}const b=n&&n._propertyBindings[p].binding.parsedPath;E=new pU(Zn.create(r,T,b),m.ValueTypeName,m.getValueSize()),++E.referenceCount,this._addInactiveBinding(E,d,T),l[p]=E}u[p].resultBuffer=E.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,s=e._clip.uuid,a=this._actionsByClip[s];this._bindAction(e,a&&a.knownActions[0]),this._addInactiveAction(e,s,r)}const n=e._propertyBindings;for(let r=0,s=n.length;r!==s;++r){const a=n[r];a.useCount++===0&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const n=e._propertyBindings;for(let r=0,s=n.length;r!==s;++r){const a=n[r];--a.useCount===0&&(a.restoreOriginalState(),this._takeBackBinding(a))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const n=e._cacheIndex;return n!==null&&n<this._nActiveActions}_addInactiveAction(e,n,r){const s=this._actions,a=this._actionsByClip;let l=a[n];if(l===void 0)l={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,a[n]=l;else{const u=l.knownActions;e._byClipCacheIndex=u.length,u.push(e)}e._cacheIndex=s.length,s.push(e),l.actionByRoot[r]=e}_removeInactiveAction(e){const n=this._actions,r=n[n.length-1],s=e._cacheIndex;r._cacheIndex=s,n[s]=r,n.pop(),e._cacheIndex=null;const a=e._clip.uuid,l=this._actionsByClip,u=l[a],d=u.knownActions,h=d[d.length-1],f=e._byClipCacheIndex;h._byClipCacheIndex=f,d[f]=h,d.pop(),e._byClipCacheIndex=null;const p=u.actionByRoot,m=(e._localRoot||this._root).uuid;delete p[m],d.length===0&&delete l[a],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const n=e._propertyBindings;for(let r=0,s=n.length;r!==s;++r){const a=n[r];--a.referenceCount===0&&this._removeInactiveBinding(a)}}_lendAction(e){const n=this._actions,r=e._cacheIndex,s=this._nActiveActions++,a=n[s];e._cacheIndex=s,n[s]=e,a._cacheIndex=r,n[r]=a}_takeBackAction(e){const n=this._actions,r=e._cacheIndex,s=--this._nActiveActions,a=n[s];e._cacheIndex=s,n[s]=e,a._cacheIndex=r,n[r]=a}_addInactiveBinding(e,n,r){const s=this._bindingsByRootAndName,a=this._bindings;let l=s[n];l===void 0&&(l={},s[n]=l),l[r]=e,e._cacheIndex=a.length,a.push(e)}_removeInactiveBinding(e){const n=this._bindings,r=e.binding,s=r.rootNode.uuid,a=r.path,l=this._bindingsByRootAndName,u=l[s],d=n[n.length-1],h=e._cacheIndex;d._cacheIndex=h,n[h]=d,n.pop(),delete u[a],Object.keys(u).length===0&&delete l[s]}_lendBinding(e){const n=this._bindings,r=e._cacheIndex,s=this._nActiveBindings++,a=n[s];e._cacheIndex=s,n[s]=e,a._cacheIndex=r,n[r]=a}_takeBackBinding(e){const n=this._bindings,r=e._cacheIndex,s=--this._nActiveBindings,a=n[s];e._cacheIndex=s,n[s]=e,a._cacheIndex=r,n[r]=a}_lendControlInterpolant(){const e=this._controlInterpolants,n=this._nActiveControlInterpolants++;let r=e[n];return r===void 0&&(r=new kM(new Float32Array(2),new Float32Array(2),1,Cj),r.__cacheIndex=n,e[n]=r),r}_takeBackControlInterpolant(e){const n=this._controlInterpolants,r=e.__cacheIndex,s=--this._nActiveControlInterpolants,a=n[s];e.__cacheIndex=s,n[s]=e,a.__cacheIndex=r,n[r]=a}clipAction(e,n,r){const s=n||this._root,a=s.uuid;let l=typeof e=="string"?Ap.findByName(s,e):e;const u=l!==null?l.uuid:e,d=this._actionsByClip[u];let h=null;if(r===void 0&&(l!==null?r=l.blendMode:r=x$),d!==void 0){const p=d.actionByRoot[a];if(p!==void 0&&p.blendMode===r)return p;h=d.knownActions[0],l===null&&(l=h._clip)}if(l===null)return null;const f=new mU(this,l,n,r);return this._bindAction(f,h),this._addInactiveAction(f,u,a),f}existingAction(e,n){const r=n||this._root,s=r.uuid,a=typeof e=="string"?Ap.findByName(r,e):e,l=a?a.uuid:e,u=this._actionsByClip[l];return u!==void 0&&u.actionByRoot[s]||null}stopAllAction(){const e=this._actions,n=this._nActiveActions;for(let r=n-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;const n=this._actions,r=this._nActiveActions,s=this.time+=e,a=Math.sign(e),l=this._accuIndex^=1;for(let h=0;h!==r;++h)n[h]._update(s,e,a,l);const u=this._bindings,d=this._nActiveBindings;for(let h=0;h!==d;++h)u[h].apply(l);return this}setTime(e){this.time=0;for(let n=0;n<this._actions.length;n++)this._actions[n].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const n=this._actions,r=e.uuid,s=this._actionsByClip,a=s[r];if(a!==void 0){const l=a.knownActions;for(let u=0,d=l.length;u!==d;++u){const h=l[u];this._deactivateAction(h);const f=h._cacheIndex,p=n[n.length-1];h._cacheIndex=null,h._byClipCacheIndex=null,p._cacheIndex=f,n[f]=p,n.pop(),this._removeInactiveBindingsForAction(h)}delete s[r]}}uncacheRoot(e){const n=e.uuid,r=this._actionsByClip;for(const l in r){const u=r[l].actionByRoot,d=u[n];d!==void 0&&(this._deactivateAction(d),this._removeInactiveAction(d))}const s=this._bindingsByRootAndName,a=s[n];if(a!==void 0)for(const l in a){const u=a[l];u.restoreOriginalState(),this._removeInactiveBinding(u)}}uncacheAction(e,n){const r=this.existingAction(e,n);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class WM{constructor(e){this.value=e}clone(){return new WM(this.value.clone===void 0?this.value:this.value.clone())}}let Rj=0;class wj extends Mc{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Rj++}),this.name="",this.usage=tE,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const n=this.uniforms.indexOf(e);return n!==-1&&this.uniforms.splice(n,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const n=e.uniforms;this.uniforms.length=0;for(let r=0,s=n.length;r<s;r++)this.uniforms.push(n[r].clone());return this}clone(){return new this.constructor().copy(this)}}class jS extends t_{constructor(e,n,r=1){super(e,n),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const n=super.clone(e);return n.meshPerAttribute=this.meshPerAttribute,n}toJSON(e){const n=super.toJSON(e);return n.isInstancedInterleavedBuffer=!0,n.meshPerAttribute=this.meshPerAttribute,n}}class Mj{constructor(e,n,r,s,a){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=n,this.itemSize=r,this.elementSize=s,this.count=a,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,n){return this.type=e,this.elementSize=n,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class As{constructor(e,n,r=0,s=1/0){this.ray=new Ip(e,n),this.near=r,this.far=s,this.camera=null,this.layers=new op,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,n){this.ray.set(e,n)}setFromCamera(e,n){n.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(n).sub(this.ray.origin).normalize(),this.camera=n):n.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(n.near+n.far)/(n.near-n.far)).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld),this.camera=n):console.error("THREE.Raycaster: Unsupported camera type: "+n.type)}intersectObject(e,n=!0,r=[]){return VR(e,this,r,n),r.sort(XN),r}intersectObjects(e,n=!0,r=[]){for(let s=0,a=e.length;s<a;s++)VR(e[s],this,r,n);return r.sort(XN),r}}function XN(i,e){return i.distance-e.distance}function VR(i,e,n,r){if(i.layers.test(e.layers)&&i.raycast(e,n),r===!0){const s=i.children;for(let a=0,l=s.length;a<l;a++)VR(s[a],e,n,!0)}}class zR{constructor(e=1,n=0,r=0){return this.radius=e,this.phi=n,this.theta=r,this}set(e,n,r){return this.radius=e,this.phi=n,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,r){return this.radius=Math.sqrt(e*e+n*n+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(pr(n/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Ij{constructor(e=1,n=0,r=0){return this.radius=e,this.theta=n,this.y=r,this}set(e,n,r){return this.radius=e,this.theta=n,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=n,this}clone(){return new this.constructor().copy(this)}}const jN=new mt;class Oj{constructor(e=new mt(1/0,1/0),n=new mt(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=jN.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,jN).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const YN=new te,R0=new te;class gU{constructor(e=new te,n=new te){this.start=e,this.end=n}set(e,n){return this.start.copy(e),this.end.copy(n),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,n){return this.delta(n).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,n){YN.subVectors(e,this.start),R0.subVectors(this.end,this.start);const r=R0.dot(R0);let a=R0.dot(YN)/r;return n&&(a=pr(a,0,1)),a}closestPointToPoint(e,n,r){const s=this.closestPointToPointParameter(e,n);return this.delta(r).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const KN=new te;class Lj extends Xn{constructor(e,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="SpotLightHelper";const r=new rn,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let l=0,u=1,d=32;l<d;l++,u++){const h=l/d*Math.PI*2,f=u/d*Math.PI*2;s.push(Math.cos(h),Math.sin(h),1,Math.cos(f),Math.sin(f),1)}r.setAttribute("position",new Yt(s,3));const a=new fi({fog:!1,toneMapped:!1});this.cone=new Ja(r,a),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,n=e*Math.tan(this.light.angle);this.cone.scale.set(n,n,e),KN.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(KN),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Nh=new te,w0=new pn,NC=new pn;class Nj extends Ja{constructor(e){const n=_U(e),r=new rn,s=[],a=[],l=new Ct(0,0,1),u=new Ct(0,1,0);for(let h=0;h<n.length;h++){const f=n[h];f.parent&&f.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),a.push(l.r,l.g,l.b),a.push(u.r,u.g,u.b))}r.setAttribute("position",new Yt(s,3)),r.setAttribute("color",new Yt(a,3));const d=new fi({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,d),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=n,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const n=this.bones,r=this.geometry,s=r.getAttribute("position");NC.copy(this.root.matrixWorld).invert();for(let a=0,l=0;a<n.length;a++){const u=n[a];u.parent&&u.parent.isBone&&(w0.multiplyMatrices(NC,u.matrixWorld),Nh.setFromMatrixPosition(w0),s.setXYZ(l,Nh.x,Nh.y,Nh.z),w0.multiplyMatrices(NC,u.parent.matrixWorld),Nh.setFromMatrixPosition(w0),s.setXYZ(l+1,Nh.x,Nh.y,Nh.z),l+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function _U(i){const e=[];i.isBone===!0&&e.push(i);for(let n=0;n<i.children.length;n++)e.push.apply(e,_U(i.children[n]));return e}class kj extends Pn{constructor(e,n,r){const s=new a_(n,4,2),a=new ii({wireframe:!0,fog:!1,toneMapped:!1});super(s,a),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Pj=new te,JN=new Ct,ZN=new Ct;class Dj extends Xn{constructor(e,n,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const s=new o_(n);s.rotateY(Math.PI*.5),this.material=new ii({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const a=s.getAttribute("position"),l=new Float32Array(a.count*3);s.setAttribute("color",new Qn(l,3)),this.add(new Pn(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const n=e.geometry.getAttribute("color");JN.copy(this.light.color),ZN.copy(this.light.groundColor);for(let r=0,s=n.count;r<s;r++){const a=r<s/2?JN:ZN;n.setXYZ(r,a.r,a.g,a.b)}n.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Pj.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Bj extends Ja{constructor(e=10,n=10,r=4473924,s=8947848){r=new Ct(r),s=new Ct(s);const a=n/2,l=e/n,u=e/2,d=[],h=[];for(let m=0,T=0,E=-u;m<=n;m++,E+=l){d.push(-u,0,E,u,0,E),d.push(E,0,-u,E,0,u);const b=m===a?r:s;b.toArray(h,T),T+=3,b.toArray(h,T),T+=3,b.toArray(h,T),T+=3,b.toArray(h,T),T+=3}const f=new rn;f.setAttribute("position",new Yt(d,3)),f.setAttribute("color",new Yt(h,3));const p=new fi({vertexColors:!0,toneMapped:!1});super(f,p),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class Fj extends Ja{constructor(e=10,n=16,r=8,s=64,a=4473924,l=8947848){a=new Ct(a),l=new Ct(l);const u=[],d=[];if(n>1)for(let p=0;p<n;p++){const m=p/n*(Math.PI*2),T=Math.sin(m)*e,E=Math.cos(m)*e;u.push(0,0,0),u.push(T,0,E);const b=p&1?a:l;d.push(b.r,b.g,b.b),d.push(b.r,b.g,b.b)}for(let p=0;p<r;p++){const m=p&1?a:l,T=e-e/r*p;for(let E=0;E<s;E++){let b=E/s*(Math.PI*2),y=Math.sin(b)*T,S=Math.cos(b)*T;u.push(y,0,S),d.push(m.r,m.g,m.b),b=(E+1)/s*(Math.PI*2),y=Math.sin(b)*T,S=Math.cos(b)*T,u.push(y,0,S),d.push(m.r,m.g,m.b)}}const h=new rn;h.setAttribute("position",new Yt(u,3)),h.setAttribute("color",new Yt(d,3));const f=new fi({vertexColors:!0,toneMapped:!1});super(h,f),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const qN=new te,M0=new te,QN=new te;class Uj extends Xn{constructor(e,n,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",n===void 0&&(n=1);let s=new rn;s.setAttribute("position",new Yt([-n,n,0,n,n,0,n,-n,0,-n,-n,0,-n,n,0],3));const a=new fi({fog:!1,toneMapped:!1});this.lightPlane=new Ki(s,a),this.add(this.lightPlane),s=new rn,s.setAttribute("position",new Yt([0,0,0,0,0,1],3)),this.targetLine=new Ki(s,a),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),qN.setFromMatrixPosition(this.light.matrixWorld),M0.setFromMatrixPosition(this.light.target.matrixWorld),QN.subVectors(M0,qN),this.lightPlane.lookAt(M0),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(M0),this.targetLine.scale.z=QN.length()}}const I0=new te,dr=new yE;class Gj extends Ja{constructor(e){const n=new rn,r=new fi({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],a=[],l={};u("n1","n2"),u("n2","n4"),u("n4","n3"),u("n3","n1"),u("f1","f2"),u("f2","f4"),u("f4","f3"),u("f3","f1"),u("n1","f1"),u("n2","f2"),u("n3","f3"),u("n4","f4"),u("p","n1"),u("p","n2"),u("p","n3"),u("p","n4"),u("u1","u2"),u("u2","u3"),u("u3","u1"),u("c","t"),u("p","c"),u("cn1","cn2"),u("cn3","cn4"),u("cf1","cf2"),u("cf3","cf4");function u(E,b){d(E),d(b)}function d(E){s.push(0,0,0),a.push(0,0,0),l[E]===void 0&&(l[E]=[]),l[E].push(s.length/3-1)}n.setAttribute("position",new Yt(s,3)),n.setAttribute("color",new Yt(a,3)),super(n,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=l,this.update();const h=new Ct(16755200),f=new Ct(16711680),p=new Ct(43775),m=new Ct(16777215),T=new Ct(3355443);this.setColors(h,f,p,m,T)}setColors(e,n,r,s,a){const u=this.geometry.getAttribute("color");u.setXYZ(0,e.r,e.g,e.b),u.setXYZ(1,e.r,e.g,e.b),u.setXYZ(2,e.r,e.g,e.b),u.setXYZ(3,e.r,e.g,e.b),u.setXYZ(4,e.r,e.g,e.b),u.setXYZ(5,e.r,e.g,e.b),u.setXYZ(6,e.r,e.g,e.b),u.setXYZ(7,e.r,e.g,e.b),u.setXYZ(8,e.r,e.g,e.b),u.setXYZ(9,e.r,e.g,e.b),u.setXYZ(10,e.r,e.g,e.b),u.setXYZ(11,e.r,e.g,e.b),u.setXYZ(12,e.r,e.g,e.b),u.setXYZ(13,e.r,e.g,e.b),u.setXYZ(14,e.r,e.g,e.b),u.setXYZ(15,e.r,e.g,e.b),u.setXYZ(16,e.r,e.g,e.b),u.setXYZ(17,e.r,e.g,e.b),u.setXYZ(18,e.r,e.g,e.b),u.setXYZ(19,e.r,e.g,e.b),u.setXYZ(20,e.r,e.g,e.b),u.setXYZ(21,e.r,e.g,e.b),u.setXYZ(22,e.r,e.g,e.b),u.setXYZ(23,e.r,e.g,e.b),u.setXYZ(24,n.r,n.g,n.b),u.setXYZ(25,n.r,n.g,n.b),u.setXYZ(26,n.r,n.g,n.b),u.setXYZ(27,n.r,n.g,n.b),u.setXYZ(28,n.r,n.g,n.b),u.setXYZ(29,n.r,n.g,n.b),u.setXYZ(30,n.r,n.g,n.b),u.setXYZ(31,n.r,n.g,n.b),u.setXYZ(32,r.r,r.g,r.b),u.setXYZ(33,r.r,r.g,r.b),u.setXYZ(34,r.r,r.g,r.b),u.setXYZ(35,r.r,r.g,r.b),u.setXYZ(36,r.r,r.g,r.b),u.setXYZ(37,r.r,r.g,r.b),u.setXYZ(38,s.r,s.g,s.b),u.setXYZ(39,s.r,s.g,s.b),u.setXYZ(40,a.r,a.g,a.b),u.setXYZ(41,a.r,a.g,a.b),u.setXYZ(42,a.r,a.g,a.b),u.setXYZ(43,a.r,a.g,a.b),u.setXYZ(44,a.r,a.g,a.b),u.setXYZ(45,a.r,a.g,a.b),u.setXYZ(46,a.r,a.g,a.b),u.setXYZ(47,a.r,a.g,a.b),u.setXYZ(48,a.r,a.g,a.b),u.setXYZ(49,a.r,a.g,a.b),u.needsUpdate=!0}update(){const e=this.geometry,n=this.pointMap,r=1,s=1;dr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),vr("c",n,e,dr,0,0,-1),vr("t",n,e,dr,0,0,1),vr("n1",n,e,dr,-r,-s,-1),vr("n2",n,e,dr,r,-s,-1),vr("n3",n,e,dr,-r,s,-1),vr("n4",n,e,dr,r,s,-1),vr("f1",n,e,dr,-r,-s,1),vr("f2",n,e,dr,r,-s,1),vr("f3",n,e,dr,-r,s,1),vr("f4",n,e,dr,r,s,1),vr("u1",n,e,dr,r*.7,s*1.1,-1),vr("u2",n,e,dr,-r*.7,s*1.1,-1),vr("u3",n,e,dr,0,s*2,-1),vr("cf1",n,e,dr,-r,0,1),vr("cf2",n,e,dr,r,0,1),vr("cf3",n,e,dr,0,-s,1),vr("cf4",n,e,dr,0,s,1),vr("cn1",n,e,dr,-r,0,-1),vr("cn2",n,e,dr,r,0,-1),vr("cn3",n,e,dr,0,-s,-1),vr("cn4",n,e,dr,0,s,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function vr(i,e,n,r,s,a,l){I0.set(s,a,l).unproject(r);const u=e[i];if(u!==void 0){const d=n.getAttribute("position");for(let h=0,f=u.length;h<f;h++)d.setXYZ(u[h],I0.x,I0.y,I0.z)}}const O0=new Xs;class Hj extends Ja{constructor(e,n=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Float32Array(8*3),a=new rn;a.setIndex(new Qn(r,1)),a.setAttribute("position",new Qn(s,3)),super(a,new fi({color:n,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&O0.setFromObject(this.object),O0.isEmpty())return;const n=O0.min,r=O0.max,s=this.geometry.attributes.position,a=s.array;a[0]=r.x,a[1]=r.y,a[2]=r.z,a[3]=n.x,a[4]=r.y,a[5]=r.z,a[6]=n.x,a[7]=n.y,a[8]=r.z,a[9]=r.x,a[10]=n.y,a[11]=r.z,a[12]=r.x,a[13]=r.y,a[14]=n.z,a[15]=n.x,a[16]=r.y,a[17]=n.z,a[18]=n.x,a[19]=n.y,a[20]=n.z,a[21]=r.x,a[22]=n.y,a[23]=n.z,s.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,n){return super.copy(e,n),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Vj extends Ja{constructor(e,n=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],a=new rn;a.setIndex(new Qn(r,1)),a.setAttribute("position",new Yt(s,3)),super(a,new fi({color:n,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const n=this.box;n.isEmpty()||(n.getCenter(this.position),n.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class zj extends Ki{constructor(e,n=1,r=16776960){const s=r,a=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],l=new rn;l.setAttribute("position",new Yt(a,3)),l.computeBoundingSphere(),super(l,new fi({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=n;const u=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],d=new rn;d.setAttribute("position",new Yt(u,3)),d.computeBoundingSphere(),this.add(new Pn(d,new ii({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const ek=new te;let L0,kC;class Wj extends Xn{constructor(e=new te(0,0,1),n=new te(0,0,0),r=1,s=16776960,a=r*.2,l=a*.2){super(),this.type="ArrowHelper",L0===void 0&&(L0=new rn,L0.setAttribute("position",new Yt([0,0,0,0,1,0],3)),kC=new Op(0,.5,1,5,1),kC.translate(0,-.5,0)),this.position.copy(n),this.line=new Ki(L0,new fi({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Pn(kC,new ii({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,a,l)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{ek.set(e.z,0,-e.x).normalize();const n=Math.acos(e.y);this.quaternion.setFromAxisAngle(ek,n)}}setLength(e,n=e*.2,r=n*.2){this.line.scale.set(1,Math.max(1e-4,e-n),1),this.line.updateMatrix(),this.cone.scale.set(r,n,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Xj extends Ja{constructor(e=1){const n=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new rn;s.setAttribute("position",new Yt(n,3)),s.setAttribute("color",new Yt(r,3));const a=new fi({vertexColors:!0,toneMapped:!1});super(s,a),this.type="AxesHelper"}setColors(e,n,r){const s=new Ct,a=this.geometry.attributes.color.array;return s.set(e),s.toArray(a,0),s.toArray(a,3),s.set(n),s.toArray(a,6),s.toArray(a,9),s.set(r),s.toArray(a,12),s.toArray(a,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class vU{constructor(){this.type="ShapePath",this.color=new Ct,this.subPaths=[],this.currentPath=null}moveTo(e,n){return this.currentPath=new sE,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,n),this}lineTo(e,n){return this.currentPath.lineTo(e,n),this}quadraticCurveTo(e,n,r,s){return this.currentPath.quadraticCurveTo(e,n,r,s),this}bezierCurveTo(e,n,r,s,a,l){return this.currentPath.bezierCurveTo(e,n,r,s,a,l),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function n(S){const A=[];for(let C=0,R=S.length;C<R;C++){const I=S[C],O=new lp;O.curves=I.curves,A.push(O)}return A}function r(S,A){const C=A.length;let R=!1;for(let I=C-1,O=0;O<C;I=O++){let F=A[I],k=A[O],D=k.x-F.x,U=k.y-F.y;if(Math.abs(U)>Number.EPSILON){if(U<0&&(F=A[O],D=-D,k=A[I],U=-U),S.y<F.y||S.y>k.y)continue;if(S.y===F.y){if(S.x===F.x)return!0}else{const ce=U*(S.x-F.x)-D*(S.y-F.y);if(ce===0)return!0;if(ce<0)continue;R=!R}}else{if(S.y!==F.y)continue;if(k.x<=S.x&&S.x<=F.x||F.x<=S.x&&S.x<=k.x)return!0}}return R}const s=Rc.isClockWise,a=this.subPaths;if(a.length===0)return[];let l,u,d;const h=[];if(a.length===1)return u=a[0],d=new lp,d.curves=u.curves,h.push(d),h;let f=!s(a[0].getPoints());f=e?!f:f;const p=[],m=[];let T=[],E=0,b;m[E]=void 0,T[E]=[];for(let S=0,A=a.length;S<A;S++)u=a[S],b=u.getPoints(),l=s(b),l=e?!l:l,l?(!f&&m[E]&&E++,m[E]={s:new lp,p:b},m[E].s.curves=u.curves,f&&E++,T[E]=[]):T[E].push({h:u,p:b[0]});if(!m[0])return n(a);if(m.length>1){let S=!1,A=0;for(let C=0,R=m.length;C<R;C++)p[C]=[];for(let C=0,R=m.length;C<R;C++){const I=T[C];for(let O=0;O<I.length;O++){const F=I[O];let k=!0;for(let D=0;D<m.length;D++)r(F.p,m[D].p)&&(C!==D&&A++,k?(k=!1,p[D].push(F)):S=!0);k&&p[C].push(F)}}A>0&&S===!1&&(T=p)}let y;for(let S=0,A=m.length;S<A;S++){d=m[S].s,h.push(d),y=T[S];for(let C=0,R=y.length;C<R;C++)d.holes.push(y[C].h)}return h}}class jj extends gd{constructor(e,n,r,s,a,l){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,n,r,s,a,l)}}class Yj extends AE{constructor(e,n,r,s){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,n,r,s)}}class Kj extends CE{constructor(e,n,r,s){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,n,r,s)}}class Jj extends xE{constructor(e,n,r,s,a,l,u){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,n,r,s,a,l,u)}}class Zj extends Op{constructor(e,n,r,s,a,l,u,d){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,n,r,s,a,l,u,d)}}class qj extends RE{constructor(e,n){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,n)}}class Qj extends r_{constructor(e,n){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,n)}}class e9 extends s_{constructor(e,n){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,n)}}class t9 extends i_{constructor(e,n,r,s){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,n,r,s)}}class n9 extends o_{constructor(e,n){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,n)}}class i9 extends Bl{constructor(e,n,r,s){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,n,r,s)}}class r9 extends Pu{constructor(e,n,r,s){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,n,r,s)}}class s9 extends wE{constructor(e,n,r,s,a,l){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,n,r,s,a,l)}}class o9 extends ME{constructor(e,n){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,n)}}class a9 extends a_{constructor(e,n,r,s,a,l,u){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,n,r,s,a,l,u)}}class l9 extends IE{constructor(e,n){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,n)}}class c9 extends OE{constructor(e,n,r,s,a){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,n,r,s,a)}}class u9 extends LE{constructor(e,n,r,s,a,l){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,n,r,s,a,l)}}class h9 extends NE{constructor(e,n,r,s,a){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,n,r,s,a)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Mp}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Mp);const d9=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:rM,AddEquation:Uf,AddOperation:ZB,AdditiveAnimationBlendMode:fM,AdditiveBlending:oR,AlphaFormat:nF,AlwaysCompare:yF,AlwaysDepth:zB,AlwaysStencilFunc:fF,AmbientLight:cU,AmbientLightProbe:cj,AnimationAction:mU,AnimationClip:Ap,AnimationLoader:ej,AnimationMixer:xj,AnimationObjectGroup:Aj,AnimationUtils:JX,ArcCurve:FF,ArrayCamera:LF,ArrowHelper:Wj,Audio:fU,AudioAnalyser:mj,AudioContext:GM,AudioListener:dj,AudioLoader:aj,AxesHelper:Xj,BackSide:zs,BasicDepthPacking:hF,BasicShadowMap:MB,Bone:$E,BooleanKeyframeTrack:kp,Box2:Oj,Box3:Xs,Box3Helper:Vj,BoxBufferGeometry:jj,BoxGeometry:gd,BoxHelper:Hj,BufferAttribute:Qn,BufferGeometry:rn,BufferGeometryLoader:dU,ByteType:sM,Cache:Cp,Camera:yE,CameraHelper:Gj,CanvasTexture:EX,CapsuleBufferGeometry:Yj,CapsuleGeometry:AE,CatmullRomCurve3:UF,CineonToneMapping:eF,CircleBufferGeometry:Kj,CircleGeometry:CE,ClampToEdgeWrapping:Pi,Clock:HM,Color:Ct,ColorKeyframeTrack:PM,ColorManagement:Pa,CompressedArrayTexture:TX,CompressedTexture:AM,CompressedTextureLoader:tj,ConeBufferGeometry:Jj,ConeGeometry:xE,CubeCamera:CF,CubeReflectionMapping:Ou,CubeRefractionMapping:ad,CubeTexture:SE,CubeTextureLoader:aU,CubeUVReflectionMapping:Qg,CubicBezierCurve:xM,CubicBezierCurve3:GF,CubicInterpolant:iU,CullFaceBack:sR,CullFaceFront:wB,CullFaceFrontBack:Sz,CullFaceNone:RB,Curve:Fl,CurvePath:VF,CustomBlending:IB,CustomToneMapping:tF,CylinderBufferGeometry:Zj,CylinderGeometry:Op,Cylindrical:Ij,Data3DTexture:TM,DataArrayTexture:w$,DataTexture:ap,DataTextureLoader:DM,DataUtils:Kf,DecrementStencilOp:Mz,DecrementWrapStencilOp:Oz,DefaultLoadingManager:oU,DepthFormat:nd,DepthStencilFormat:yp,DepthTexture:NF,DirectionalLight:j$,DirectionalLightHelper:Uj,DiscreteInterpolant:rU,DisplayP3ColorSpace:gM,DodecahedronBufferGeometry:qj,DodecahedronGeometry:RE,DoubleSide:Ss,DstAlphaFactor:BB,DstColorFactor:UB,DynamicCopyUsage:jz,DynamicDrawUsage:Gz,DynamicReadUsage:zz,EdgesGeometry:zF,EllipseCurve:G$,EqualCompare:gF,EqualDepth:XB,EqualStencilFunc:Pz,EquirectangularReflectionMapping:Vg,EquirectangularRefractionMapping:QT,Euler:EE,EventDispatcher:Mc,ExtrudeBufferGeometry:Qj,ExtrudeGeometry:r_,FileLoader:Lr,Float16BufferAttribute:k4,Float32BufferAttribute:Yt,Float64BufferAttribute:P4,FloatType:Kr,Fog:P$,FogExp2:k$,FramebufferTexture:vX,FrontSide:Ya,Frustum:M$,GLBufferAttribute:Mj,GLSL1:Kz,GLSL3:kR,GreaterCompare:vF,GreaterDepth:YB,GreaterEqualCompare:EF,GreaterEqualDepth:jB,GreaterEqualStencilFunc:Uz,GreaterStencilFunc:Bz,GridHelper:Bj,Group:za,HalfFloatType:ss,HemisphereLight:lU,HemisphereLightHelper:Dj,HemisphereLightProbe:lj,IcosahedronBufferGeometry:e9,IcosahedronGeometry:s_,ImageBitmapLoader:UM,ImageLoader:cE,ImageUtils:vM,IncrementStencilOp:wz,IncrementWrapStencilOp:Iz,InstancedBufferAttribute:ld,InstancedBufferGeometry:J$,InstancedInterleavedBuffer:jS,InstancedMesh:B$,Int16BufferAttribute:L4,Int32BufferAttribute:N4,Int8BufferAttribute:M4,IntType:C$,InterleavedBuffer:t_,InterleavedBufferAttribute:lo,Interpolant:Np,InterpolateDiscrete:Sp,InterpolateLinear:Lu,InterpolateSmooth:pS,InvertStencilOp:Lz,KeepStencilOp:mS,KeyframeTrack:Ul,LOD:BF,LatheBufferGeometry:t9,LatheGeometry:i_,Layers:op,LessCompare:mF,LessDepth:WB,LessEqualCompare:_F,LessEqualDepth:zS,LessEqualStencilFunc:Dz,LessStencilFunc:kz,Light:_d,LightProbe:Y$,Line:Ki,Line3:gU,LineBasicMaterial:fi,LineCurve:H$,LineCurve3:HF,LineDashedMaterial:tU,LineLoop:F$,LineSegments:Ja,LinearEncoding:R$,LinearFilter:Gn,LinearInterpolant:kM,LinearMipMapLinearFilter:hR,LinearMipMapNearestFilter:Cz,LinearMipmapLinearFilter:Ka,LinearMipmapNearestFilter:vE,LinearSRGBColorSpace:Io,LinearToneMapping:qB,Loader:as,LoaderUtils:Nl,LoadingManager:z$,LoopOnce:lF,LoopPingPong:uF,LoopRepeat:cF,LuminanceAlphaFormat:rF,LuminanceFormat:iF,MOUSE:Df,Material:rr,MaterialLoader:K$,MathUtils:sp,Matrix3:Ln,Matrix4:pn,MaxEquation:uR,Mesh:Pn,MeshBasicMaterial:ii,MeshDepthMaterial:O$,MeshDistanceMaterial:L$,MeshLambertMaterial:QF,MeshMatcapMaterial:eU,MeshNormalMaterial:qF,MeshPhongMaterial:JF,MeshPhysicalMaterial:Nr,MeshStandardMaterial:Lp,MeshToonMaterial:ZF,MinEquation:cR,MirroredRepeatWrapping:Ep,MixOperation:JB,MultiplyBlending:lR,MultiplyOperation:_E,NearestFilter:tr,NearestMipMapLinearFilter:Az,NearestMipMapNearestFilter:bz,NearestMipmapLinearFilter:ip,NearestMipmapNearestFilter:zg,NeverCompare:pF,NeverDepth:VB,NeverStencilFunc:Nz,NoBlending:Cc,NoColorSpace:id,NoToneMapping:Ll,NormalAnimationBlendMode:x$,NormalBlending:np,NotEqualCompare:TF,NotEqualDepth:KB,NotEqualStencilFunc:Fz,NumberKeyframeTrack:cd,Object3D:Xn,ObjectLoader:sj,ObjectSpaceNormalMap:dF,OctahedronBufferGeometry:n9,OctahedronGeometry:o_,OneFactor:kB,OneMinusDstAlphaFactor:FB,OneMinusDstColorFactor:GB,OneMinusSrcAlphaFactor:iM,OneMinusSrcColorFactor:DB,OrthographicCamera:ua,PCFShadowMap:b$,PCFSoftShadowMap:CT,PMREMGenerator:DR,Path:sE,PerspectiveCamera:Ui,Plane:Eu,PlaneBufferGeometry:i9,PlaneGeometry:Bl,PlaneHelper:zj,PointLight:X$,PointLightHelper:kj,Points:U$,PointsMaterial:bE,PolarGridHelper:Fj,PolyhedronBufferGeometry:r9,PolyhedronGeometry:Pu,PositionalAudio:pj,PropertyBinding:Zn,PropertyMixer:pU,QuadraticBezierCurve:RM,QuadraticBezierCurve3:wM,Quaternion:Er,QuaternionKeyframeTrack:wc,QuaternionLinearInterpolant:sU,RED_GREEN_RGTC2_Format:LR,RED_RGTC1_Format:aF,REVISION:Mp,RGBADepthPacking:mM,RGBAFormat:jr,RGBAIntegerFormat:dM,RGBA_ASTC_10x10_Format:wR,RGBA_ASTC_10x5_Format:CR,RGBA_ASTC_10x6_Format:xR,RGBA_ASTC_10x8_Format:RR,RGBA_ASTC_12x10_Format:MR,RGBA_ASTC_12x12_Format:IR,RGBA_ASTC_4x4_Format:vR,RGBA_ASTC_5x4_Format:TR,RGBA_ASTC_5x5_Format:ER,RGBA_ASTC_6x5_Format:yR,RGBA_ASTC_6x6_Format:SR,RGBA_ASTC_8x5_Format:$R,RGBA_ASTC_8x6_Format:bR,RGBA_ASTC_8x8_Format:AR,RGBA_BPTC_Format:fS,RGBA_ETC2_EAC_Format:_R,RGBA_PVRTC_2BPPV1_Format:mR,RGBA_PVRTC_4BPPV1_Format:pR,RGBA_S3TC_DXT1_Format:uS,RGBA_S3TC_DXT3_Format:hS,RGBA_S3TC_DXT5_Format:dS,RGB_ETC1_Format:oF,RGB_ETC2_Format:gR,RGB_PVRTC_2BPPV1_Format:fR,RGB_PVRTC_4BPPV1_Format:dR,RGB_S3TC_DXT1_Format:cS,RGFormat:sF,RGIntegerFormat:hM,RawShaderMaterial:KF,Ray:Ip,Raycaster:As,RectAreaLight:uU,RedFormat:cM,RedIntegerFormat:uM,ReinhardToneMapping:QB,RepeatWrapping:Pl,ReplaceStencilOp:Rz,ReverseSubtractEquation:LB,RingBufferGeometry:s9,RingGeometry:wE,SIGNED_RED_GREEN_RGTC2_Format:NR,SIGNED_RED_RGTC1_Format:OR,SRGBColorSpace:Tn,Scene:jg,ShaderChunk:On,ShaderLib:Ml,ShaderMaterial:Oo,ShadowMaterial:YF,Shape:lp,ShapeBufferGeometry:o9,ShapeGeometry:ME,ShapePath:vU,ShapeUtils:Rc,ShortType:oM,Skeleton:n_,SkeletonHelper:Nj,SkinnedMesh:D$,Source:Yf,Sphere:js,SphereBufferGeometry:a9,SphereGeometry:a_,Spherical:zR,SphericalHarmonics3:hU,SplineCurve:MM,SpotLight:W$,SpotLightHelper:Lj,Sprite:DF,SpriteMaterial:bM,SrcAlphaFactor:nM,SrcAlphaSaturateFactor:HB,SrcColorFactor:PB,StaticCopyUsage:Xz,StaticDrawUsage:tE,StaticReadUsage:Vz,StereoCamera:uj,StreamCopyUsage:Yz,StreamDrawUsage:Hz,StreamReadUsage:Wz,StringKeyframeTrack:Pp,SubtractEquation:OB,SubtractiveBlending:aR,TOUCH:Bf,TangentSpaceNormalMap:md,TetrahedronBufferGeometry:l9,TetrahedronGeometry:IE,Texture:ni,TextureLoader:BM,TorusBufferGeometry:c9,TorusGeometry:OE,TorusKnotBufferGeometry:u9,TorusKnotGeometry:LE,Triangle:Co,TriangleFanDrawMode:$p,TriangleStripDrawMode:TE,TrianglesDrawMode:pM,TubeBufferGeometry:h9,TubeGeometry:NE,TwoPassDoubleSide:$z,UVMapping:od,Uint16BufferAttribute:EM,Uint32BufferAttribute:yM,Uint8BufferAttribute:I4,Uint8ClampedBufferAttribute:O4,Uniform:WM,UniformsGroup:wj,UniformsLib:Lt,UniformsUtils:rE,UnsignedByteType:la,UnsignedInt248Type:td,UnsignedIntType:Sc,UnsignedShort4444Type:aM,UnsignedShort5551Type:lM,UnsignedShortType:A$,VSMShadowMap:xl,Vector2:mt,Vector3:te,Vector4:Hn,VectorKeyframeTrack:ud,VideoTexture:_X,WebGL1Renderer:kF,WebGL3DRenderTarget:T4,WebGLArrayRenderTarget:v4,WebGLCoordinateSystem:$c,WebGLCubeRenderTarget:SM,WebGLMultipleRenderTargets:E4,WebGLRenderTarget:da,WebGLRenderer:N$,WebGLUtils:OF,WebGPUCoordinateSystem:nE,WireframeGeometry:OM,WrapAroundEnding:eE,ZeroCurvatureEnding:Xf,ZeroFactor:NB,ZeroSlopeEnding:jf,ZeroStencilOp:xz,_SRGBAFormat:WS,sRGBEncoding:xc},Symbol.toStringTag,{value:"Module"}));var TU={exports:{}},Dp={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */Dp.ConcurrentRoot=1;Dp.ContinuousEventPriority=4;Dp.DefaultEventPriority=16;Dp.DiscreteEventPriority=1;Dp.IdleEventPriority=536870912;Dp.LegacyRoot=0;TU.exports=Dp;var Ag=TU.exports;function f9(i){let e;const n=new Set,r=(h,f)=>{const p=typeof h=="function"?h(e):h;if(p!==e){const m=e;e=f?p:Object.assign({},e,p),n.forEach(T=>T(e,m))}},s=()=>e,a=(h,f=s,p=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let m=f(e);function T(){const E=f(e);if(!p(m,E)){const b=m;h(m=E,b)}}return n.add(T),()=>n.delete(T)},d={setState:r,getState:s,subscribe:(h,f,p)=>f||p?a(h,f,p):(n.add(h),()=>n.delete(h)),destroy:()=>n.clear()};return e=i(r,s,d),d}const p9=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),tk=p9?q.useEffect:q.useLayoutEffect;function EU(i){const e=typeof i=="function"?f9(i):i,n=(r=e.getState,s=Object.is)=>{const[,a]=q.useReducer(y=>y+1,0),l=e.getState(),u=q.useRef(l),d=q.useRef(r),h=q.useRef(s),f=q.useRef(!1),p=q.useRef();p.current===void 0&&(p.current=r(l));let m,T=!1;(u.current!==l||d.current!==r||h.current!==s||f.current)&&(m=r(l),T=!s(p.current,m)),tk(()=>{T&&(p.current=m),u.current=l,d.current=r,h.current=s,f.current=!1});const E=q.useRef(l);tk(()=>{const y=()=>{try{const A=e.getState(),C=d.current(A);h.current(p.current,C)||(u.current=A,p.current=C,a())}catch{f.current=!0,a()}},S=e.subscribe(y);return e.getState()!==E.current&&y(),S},[]);const b=T?m:p.current;return q.useDebugValue(b),b};return Object.assign(n,e),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[n,e];return{next(){const s=r.length<=0;return{value:r.shift(),done:s}}}},n}var yU={exports:{}},PC={exports:{}},DC={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nk;function m9(){return nk||(nk=1,function(i){function e(H,J){var K=H.length;H.push(J);e:for(;0<K;){var se=K-1>>>1,Y=H[se];if(0<s(Y,J))H[se]=J,H[K]=Y,K=se;else break e}}function n(H){return H.length===0?null:H[0]}function r(H){if(H.length===0)return null;var J=H[0],K=H.pop();if(K!==J){H[0]=K;e:for(var se=0,Y=H.length,he=Y>>>1;se<he;){var ue=2*(se+1)-1,Te=H[ue],_e=ue+1,Re=H[_e];if(0>s(Te,K))_e<Y&&0>s(Re,Te)?(H[se]=Re,H[_e]=K,se=_e):(H[se]=Te,H[ue]=K,se=ue);else if(_e<Y&&0>s(Re,K))H[se]=Re,H[_e]=K,se=_e;else break e}}return J}function s(H,J){var K=H.sortIndex-J.sortIndex;return K!==0?K:H.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;i.unstable_now=function(){return a.now()}}else{var l=Date,u=l.now();i.unstable_now=function(){return l.now()-u}}var d=[],h=[],f=1,p=null,m=3,T=!1,E=!1,b=!1,y=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(H){for(var J=n(h);J!==null;){if(J.callback===null)r(h);else if(J.startTime<=H)r(h),J.sortIndex=J.expirationTime,e(d,J);else break;J=n(h)}}function R(H){if(b=!1,C(H),!E)if(n(d)!==null)E=!0,de(I);else{var J=n(h);J!==null&&xe(R,J.startTime-H)}}function I(H,J){E=!1,b&&(b=!1,S(k),k=-1),T=!0;var K=m;try{for(C(J),p=n(d);p!==null&&(!(p.expirationTime>J)||H&&!ce());){var se=p.callback;if(typeof se=="function"){p.callback=null,m=p.priorityLevel;var Y=se(p.expirationTime<=J);J=i.unstable_now(),typeof Y=="function"?p.callback=Y:p===n(d)&&r(d),C(J)}else r(d);p=n(d)}if(p!==null)var he=!0;else{var ue=n(h);ue!==null&&xe(R,ue.startTime-J),he=!1}return he}finally{p=null,m=K,T=!1}}var O=!1,F=null,k=-1,D=5,U=-1;function ce(){return!(i.unstable_now()-U<D)}function ie(){if(F!==null){var H=i.unstable_now();U=H;var J=!0;try{J=F(!0,H)}finally{J?ae():(O=!1,F=null)}}else O=!1}var ae;if(typeof A=="function")ae=function(){A(ie)};else if(typeof MessageChannel<"u"){var ne=new MessageChannel,pe=ne.port2;ne.port1.onmessage=ie,ae=function(){pe.postMessage(null)}}else ae=function(){y(ie,0)};function de(H){F=H,O||(O=!0,ae())}function xe(H,J){k=y(function(){H(i.unstable_now())},J)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(H){H.callback=null},i.unstable_continueExecution=function(){E||T||(E=!0,de(I))},i.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<H?Math.floor(1e3/H):5},i.unstable_getCurrentPriorityLevel=function(){return m},i.unstable_getFirstCallbackNode=function(){return n(d)},i.unstable_next=function(H){switch(m){case 1:case 2:case 3:var J=3;break;default:J=m}var K=m;m=J;try{return H()}finally{m=K}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(H,J){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var K=m;m=H;try{return J()}finally{m=K}},i.unstable_scheduleCallback=function(H,J,K){var se=i.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?se+K:se):K=se,H){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=K+Y,H={id:f++,callback:J,priorityLevel:H,startTime:K,expirationTime:Y,sortIndex:-1},K>se?(H.sortIndex=K,e(h,H),n(d)===null&&H===n(h)&&(b?(S(k),k=-1):b=!0,xe(R,K-se))):(H.sortIndex=Y,e(d,H),E||T||(E=!0,de(I))),H},i.unstable_shouldYield=ce,i.unstable_wrapCallback=function(H){var J=m;return function(){var K=m;m=J;try{return H.apply(this,arguments)}finally{m=K}}}}(DC)),DC}var ik;function g9(){return ik||(ik=1,PC.exports=m9()),PC.exports}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _9=function(e){var n={},r=q,s=g9(),a=Object.assign;function l(_){for(var v="https://reactjs.org/docs/error-decoder.html?invariant="+_,x=1;x<arguments.length;x++)v+="&args[]="+encodeURIComponent(arguments[x]);return"Minified React error #"+_+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var u=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,d=Symbol.for("react.element"),h=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),p=Symbol.for("react.strict_mode"),m=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),E=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),S=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),R=Symbol.for("react.offscreen"),I=Symbol.iterator;function O(_){return _===null||typeof _!="object"?null:(_=I&&_[I]||_["@@iterator"],typeof _=="function"?_:null)}function F(_){if(_==null)return null;if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _;switch(_){case f:return"Fragment";case h:return"Portal";case m:return"Profiler";case p:return"StrictMode";case y:return"Suspense";case S:return"SuspenseList"}if(typeof _=="object")switch(_.$$typeof){case E:return(_.displayName||"Context")+".Consumer";case T:return(_._context.displayName||"Context")+".Provider";case b:var v=_.render;return _=_.displayName,_||(_=v.displayName||v.name||"",_=_!==""?"ForwardRef("+_+")":"ForwardRef"),_;case A:return v=_.displayName||null,v!==null?v:F(_.type)||"Memo";case C:v=_._payload,_=_._init;try{return F(_(v))}catch{}}return null}function k(_){var v=_.type;switch(_.tag){case 24:return"Cache";case 9:return(v.displayName||"Context")+".Consumer";case 10:return(v._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return _=v.render,_=_.displayName||_.name||"",v.displayName||(_!==""?"ForwardRef("+_+")":"ForwardRef");case 7:return"Fragment";case 5:return v;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return F(v);case 8:return v===p?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof v=="function")return v.displayName||v.name||null;if(typeof v=="string")return v}return null}function D(_){var v=_,x=_;if(_.alternate)for(;v.return;)v=v.return;else{_=v;do v=_,v.flags&4098&&(x=v.return),_=v.return;while(_)}return v.tag===3?x:null}function U(_){if(D(_)!==_)throw Error(l(188))}function ce(_){var v=_.alternate;if(!v){if(v=D(_),v===null)throw Error(l(188));return v!==_?null:_}for(var x=_,w=v;;){var P=x.return;if(P===null)break;var V=P.alternate;if(V===null){if(w=P.return,w!==null){x=w;continue}break}if(P.child===V.child){for(V=P.child;V;){if(V===x)return U(P),_;if(V===w)return U(P),v;V=V.sibling}throw Error(l(188))}if(x.return!==w.return)x=P,w=V;else{for(var $e=!1,Pe=P.child;Pe;){if(Pe===x){$e=!0,x=P,w=V;break}if(Pe===w){$e=!0,w=P,x=V;break}Pe=Pe.sibling}if(!$e){for(Pe=V.child;Pe;){if(Pe===x){$e=!0,x=V,w=P;break}if(Pe===w){$e=!0,w=V,x=P;break}Pe=Pe.sibling}if(!$e)throw Error(l(189))}}if(x.alternate!==w)throw Error(l(190))}if(x.tag!==3)throw Error(l(188));return x.stateNode.current===x?_:v}function ie(_){return _=ce(_),_!==null?ae(_):null}function ae(_){if(_.tag===5||_.tag===6)return _;for(_=_.child;_!==null;){var v=ae(_);if(v!==null)return v;_=_.sibling}return null}function ne(_){if(_.tag===5||_.tag===6)return _;for(_=_.child;_!==null;){if(_.tag!==4){var v=ne(_);if(v!==null)return v}_=_.sibling}return null}var pe=Array.isArray,de=e.getPublicInstance,xe=e.getRootHostContext,H=e.getChildHostContext,J=e.prepareForCommit,K=e.resetAfterCommit,se=e.createInstance,Y=e.appendInitialChild,he=e.finalizeInitialChildren,ue=e.prepareUpdate,Te=e.shouldSetTextContent,_e=e.createTextInstance,Re=e.scheduleTimeout,De=e.cancelTimeout,et=e.noTimeout,Ue=e.isPrimaryRenderer,Le=e.supportsMutation,re=e.supportsPersistence,Ye=e.supportsHydration,Fe=e.getInstanceFromNode,Ze=e.preparePortalMount,Xe=e.getCurrentEventPriority,dt=e.detachDeletedInstance,je=e.supportsMicrotasks,it=e.scheduleMicrotask,Ce=e.supportsTestSelectors,Me=e.findFiberRoot,St=e.getBoundingRect,oe=e.getTextContent,ee=e.isHiddenSubtree,W=e.matchAccessibilityRole,ot=e.setFocusIfFocusable,ze=e.setupIntersectionObserver,qe=e.appendChild,ut=e.appendChildToContainer,ft=e.commitTextUpdate,Ge=e.commitMount,$t=e.commitUpdate,L=e.insertBefore,X=e.insertInContainerBefore,fe=e.removeChild,z=e.removeChildFromContainer,Ae=e.resetTextContent,tt=e.hideInstance,ye=e.hideTextInstance,Ie=e.unhideInstance,Be=e.unhideTextInstance,N=e.clearContainer,j=e.cloneInstance,ge=e.createContainerChildSet,we=e.appendChildToContainerChildSet,We=e.finalizeContainerChildren,gt=e.replaceContainerChildren,bt=e.cloneHiddenInstance,un=e.cloneHiddenTextInstance,an=e.canHydrateInstance,ei=e.canHydrateTextInstance,pi=e.canHydrateSuspenseInstance,Ji=e.isSuspenseInstancePending,Ci=e.isSuspenseInstanceFallback,vi=e.registerSuspenseInstanceRetry,Ti=e.getNextHydratableSibling,nn=e.getFirstHydratableChild,mi=e.getFirstHydratableChildWithinContainer,yr=e.getFirstHydratableChildWithinSuspenseInstance,Z=e.hydrateInstance,B=e.hydrateTextInstance,le=e.hydrateSuspenseInstance,ve=e.getNextHydratableInstanceAfterSuspenseInstance,me=e.commitHydratedContainer,Se=e.commitHydratedSuspenseInstance,Ke=e.clearSuspenseBoundary,Je=e.clearSuspenseBoundaryFromContainer,at=e.shouldDeleteUnhydratedTailInstances,rt=e.didNotMatchHydratedContainerTextInstance,pt=e.didNotMatchHydratedTextInstance,Ne;function It(_){if(Ne===void 0)try{throw Error()}catch(x){var v=x.stack.trim().match(/\n( *(at )?)/);Ne=v&&v[1]||""}return`
`+Ne+_}var xt=!1;function wt(_,v){if(!_||xt)return"";xt=!0;var x=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(v)if(v=function(){throw Error()},Object.defineProperty(v.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(v,[])}catch(Rt){var w=Rt}Reflect.construct(_,[],v)}else{try{v.call()}catch(Rt){w=Rt}_.call(v.prototype)}else{try{throw Error()}catch(Rt){w=Rt}_()}}catch(Rt){if(Rt&&w&&typeof Rt.stack=="string"){for(var P=Rt.stack.split(`
`),V=w.stack.split(`
`),$e=P.length-1,Pe=V.length-1;1<=$e&&0<=Pe&&P[$e]!==V[Pe];)Pe--;for(;1<=$e&&0<=Pe;$e--,Pe--)if(P[$e]!==V[Pe]){if($e!==1||Pe!==1)do if($e--,Pe--,0>Pe||P[$e]!==V[Pe]){var ht=`
`+P[$e].replace(" at new "," at ");return _.displayName&&ht.includes("<anonymous>")&&(ht=ht.replace("<anonymous>",_.displayName)),ht}while(1<=$e&&0<=Pe);break}}}finally{xt=!1,Error.prepareStackTrace=x}return(_=_?_.displayName||_.name:"")?It(_):""}var Ht=Object.prototype.hasOwnProperty,Zt=[],jt=-1;function Ot(_){return{current:_}}function qt(_){0>jt||(_.current=Zt[jt],Zt[jt]=null,jt--)}function Ft(_,v){jt++,Zt[jt]=_.current,_.current=v}var ln={},Bn=Ot(ln),on=Ot(!1),bn=ln;function tn(_,v){var x=_.type.contextTypes;if(!x)return ln;var w=_.stateNode;if(w&&w.__reactInternalMemoizedUnmaskedChildContext===v)return w.__reactInternalMemoizedMaskedChildContext;var P={},V;for(V in x)P[V]=v[V];return w&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=v,_.__reactInternalMemoizedMaskedChildContext=P),P}function Fn(_){return _=_.childContextTypes,_!=null}function xn(){qt(on),qt(Bn)}function hn(_,v,x){if(Bn.current!==ln)throw Error(l(168));Ft(Bn,v),Ft(on,x)}function zn(_,v,x){var w=_.stateNode;if(v=v.childContextTypes,typeof w.getChildContext!="function")return x;w=w.getChildContext();for(var P in w)if(!(P in v))throw Error(l(108,k(_)||"Unknown",P));return a({},x,w)}function Mn(_){return _=(_=_.stateNode)&&_.__reactInternalMemoizedMergedChildContext||ln,bn=Bn.current,Ft(Bn,_),Ft(on,on.current),!0}function Kt(_,v,x){var w=_.stateNode;if(!w)throw Error(l(169));x?(_=zn(_,v,bn),w.__reactInternalMemoizedMergedChildContext=_,qt(on),qt(Bn),Ft(Bn,_)):qt(on),Ft(on,x)}var An=Math.clz32?Math.clz32:mn,Sr=Math.log,xi=Math.LN2;function mn(_){return _>>>=0,_===0?32:31-(Sr(_)/xi|0)|0}var ls=64,Ys=4194304;function xs(_){switch(_&-_){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return _&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return _}}function hi(_,v){var x=_.pendingLanes;if(x===0)return 0;var w=0,P=_.suspendedLanes,V=_.pingedLanes,$e=x&268435455;if($e!==0){var Pe=$e&~P;Pe!==0?w=xs(Pe):(V&=$e,V!==0&&(w=xs(V)))}else $e=x&~P,$e!==0?w=xs($e):V!==0&&(w=xs(V));if(w===0)return 0;if(v!==0&&v!==w&&!(v&P)&&(P=w&-w,V=v&-v,P>=V||P===16&&(V&4194240)!==0))return v;if(w&4&&(w|=x&16),v=_.entangledLanes,v!==0)for(_=_.entanglements,v&=w;0<v;)x=31-An(v),P=1<<x,w|=_[x],v&=~P;return w}function Rs(_,v){switch(_){case 1:case 2:case 4:return v+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dn(_,v){for(var x=_.suspendedLanes,w=_.pingedLanes,P=_.expirationTimes,V=_.pendingLanes;0<V;){var $e=31-An(V),Pe=1<<$e,ht=P[$e];ht===-1?(!(Pe&x)||Pe&w)&&(P[$e]=Rs(Pe,v)):ht<=v&&(_.expiredLanes|=Pe),V&=~Pe}}function kr(_){return _=_.pendingLanes&-1073741825,_!==0?_:_&1073741824?1073741824:0}function jn(_){for(var v=[],x=0;31>x;x++)v.push(_);return v}function Qr(_,v,x){_.pendingLanes|=v,v!==536870912&&(_.suspendedLanes=0,_.pingedLanes=0),_=_.eventTimes,v=31-An(v),_[v]=x}function Pr(_,v){var x=_.pendingLanes&~v;_.pendingLanes=v,_.suspendedLanes=0,_.pingedLanes=0,_.expiredLanes&=v,_.mutableReadLanes&=v,_.entangledLanes&=v,v=_.entanglements;var w=_.eventTimes;for(_=_.expirationTimes;0<x;){var P=31-An(x),V=1<<P;v[P]=0,w[P]=-1,_[P]=-1,x&=~V}}function ti(_,v){var x=_.entangledLanes|=v;for(_=_.entanglements;x;){var w=31-An(x),P=1<<w;P&v|_[w]&v&&(_[w]|=v),x&=~P}}var sn=0;function Ei(_){return _&=-_,1<_?4<_?_&268435455?16:536870912:4:1}var cs=s.unstable_scheduleCallback,Vi=s.unstable_cancelCallback,Gl=s.unstable_shouldYield,Dr=s.unstable_requestPaint,ai=s.unstable_now,ws=s.unstable_ImmediatePriority,Za=s.unstable_UserBlockingPriority,mr=s.unstable_NormalPriority,qa=s.unstable_IdlePriority,Ri=null,Ii=null;function _o(_){if(Ii&&typeof Ii.onCommitFiberRoot=="function")try{Ii.onCommitFiberRoot(Ri,_,void 0,(_.current.flags&128)===128)}catch{}}function Hl(_,v){return _===v&&(_!==0||1/_===1/v)||_!==_&&v!==v}var $r=typeof Object.is=="function"?Object.is:Hl,or=null,Ks=!1,gr=!1;function ma(_){or===null?or=[_]:or.push(_)}function Vl(_){Ks=!0,ma(_)}function Br(){if(!gr&&or!==null){gr=!0;var _=0,v=sn;try{var x=or;for(sn=1;_<x.length;_++){var w=x[_];do w=w(!0);while(w!==null)}or=null,Ks=!1}catch(P){throw or!==null&&(or=or.slice(_+1)),cs(ws,Br),P}finally{sn=v,gr=!1}}return null}var Bo=u.ReactCurrentBatchConfig;function vo(_,v){if($r(_,v))return!0;if(typeof _!="object"||_===null||typeof v!="object"||v===null)return!1;var x=Object.keys(_),w=Object.keys(v);if(x.length!==w.length)return!1;for(w=0;w<x.length;w++){var P=x[w];if(!Ht.call(v,P)||!$r(_[P],v[P]))return!1}return!0}function Js(_){switch(_.tag){case 5:return It(_.type);case 16:return It("Lazy");case 13:return It("Suspense");case 19:return It("SuspenseList");case 0:case 2:case 15:return _=wt(_.type,!1),_;case 11:return _=wt(_.type.render,!1),_;case 1:return _=wt(_.type,!0),_;default:return""}}function Oi(_,v){if(_&&_.defaultProps){v=a({},v),_=_.defaultProps;for(var x in _)v[x]===void 0&&(v[x]=_[x]);return v}return v}var Ee=Ot(null),Oe=null,lt=null,Et=null;function _n(){Et=lt=Oe=null}function fn(_,v,x){Ue?(Ft(Ee,v._currentValue),v._currentValue=x):(Ft(Ee,v._currentValue2),v._currentValue2=x)}function Qt(_){var v=Ee.current;qt(Ee),Ue?_._currentValue=v:_._currentValue2=v}function yn(_,v,x){for(;_!==null;){var w=_.alternate;if((_.childLanes&v)!==v?(_.childLanes|=v,w!==null&&(w.childLanes|=v)):w!==null&&(w.childLanes&v)!==v&&(w.childLanes|=v),_===x)break;_=_.return}}function li(_,v){Oe=_,Et=lt=null,_=_.dependencies,_!==null&&_.firstContext!==null&&(_.lanes&v&&(ds=!0),_.firstContext=null)}function ci(_){var v=Ue?_._currentValue:_._currentValue2;if(Et!==_)if(_={context:_,memoizedValue:v,next:null},lt===null){if(Oe===null)throw Error(l(308));lt=_,Oe.dependencies={lanes:0,firstContext:_}}else lt=lt.next=_;return v}var br=null,us=!1;function Ic(_){_.updateQueue={baseState:_.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Bp(_,v){_=_.updateQueue,v.updateQueue===_&&(v.updateQueue={baseState:_.baseState,firstBaseUpdate:_.firstBaseUpdate,lastBaseUpdate:_.lastBaseUpdate,shared:_.shared,effects:_.effects})}function Fo(_,v){return{eventTime:_,lane:v,tag:0,payload:null,callback:null,next:null}}function ga(_,v){var x=_.updateQueue;x!==null&&(x=x.shared,qi!==null&&_.mode&1&&!(Rn&2)?(_=x.interleaved,_===null?(v.next=v,br===null?br=[x]:br.push(x)):(v.next=_.next,_.next=v),x.interleaved=v):(_=x.pending,_===null?v.next=v:(v.next=_.next,_.next=v),x.pending=v))}function Du(_,v,x){if(v=v.updateQueue,v!==null&&(v=v.shared,(x&4194240)!==0)){var w=v.lanes;w&=_.pendingLanes,x|=w,v.lanes=x,ti(_,x)}}function Fp(_,v){var x=_.updateQueue,w=_.alternate;if(w!==null&&(w=w.updateQueue,x===w)){var P=null,V=null;if(x=x.firstBaseUpdate,x!==null){do{var $e={eventTime:x.eventTime,lane:x.lane,tag:x.tag,payload:x.payload,callback:x.callback,next:null};V===null?P=V=$e:V=V.next=$e,x=x.next}while(x!==null);V===null?P=V=v:V=V.next=v}else P=V=v;x={baseState:w.baseState,firstBaseUpdate:P,lastBaseUpdate:V,shared:w.shared,effects:w.effects},_.updateQueue=x;return}_=x.lastBaseUpdate,_===null?x.firstBaseUpdate=v:_.next=v,x.lastBaseUpdate=v}function vd(_,v,x,w){var P=_.updateQueue;us=!1;var V=P.firstBaseUpdate,$e=P.lastBaseUpdate,Pe=P.shared.pending;if(Pe!==null){P.shared.pending=null;var ht=Pe,Rt=ht.next;ht.next=null,$e===null?V=Rt:$e.next=Rt,$e=ht;var Gt=_.alternate;Gt!==null&&(Gt=Gt.updateQueue,Pe=Gt.lastBaseUpdate,Pe!==$e&&(Pe===null?Gt.firstBaseUpdate=Rt:Pe.next=Rt,Gt.lastBaseUpdate=ht))}if(V!==null){var En=P.baseState;$e=0,Gt=Rt=ht=null,Pe=V;do{var cn=Pe.lane,_i=Pe.eventTime;if((w&cn)===cn){Gt!==null&&(Gt=Gt.next={eventTime:_i,lane:0,tag:Pe.tag,payload:Pe.payload,callback:Pe.callback,next:null});e:{var Jt=_,Wi=Pe;switch(cn=v,_i=x,Wi.tag){case 1:if(Jt=Wi.payload,typeof Jt=="function"){En=Jt.call(_i,En,cn);break e}En=Jt;break e;case 3:Jt.flags=Jt.flags&-65537|128;case 0:if(Jt=Wi.payload,cn=typeof Jt=="function"?Jt.call(_i,En,cn):Jt,cn==null)break e;En=a({},En,cn);break e;case 2:us=!0}}Pe.callback!==null&&Pe.lane!==0&&(_.flags|=64,cn=P.effects,cn===null?P.effects=[Pe]:cn.push(Pe))}else _i={eventTime:_i,lane:cn,tag:Pe.tag,payload:Pe.payload,callback:Pe.callback,next:null},Gt===null?(Rt=Gt=_i,ht=En):Gt=Gt.next=_i,$e|=cn;if(Pe=Pe.next,Pe===null){if(Pe=P.shared.pending,Pe===null)break;cn=Pe,Pe=cn.next,cn.next=null,P.lastBaseUpdate=cn,P.shared.pending=null}}while(1);if(Gt===null&&(ht=En),P.baseState=ht,P.firstBaseUpdate=Rt,P.lastBaseUpdate=Gt,v=P.shared.interleaved,v!==null){P=v;do $e|=P.lane,P=P.next;while(P!==v)}else V===null&&(P.shared.lanes=0);ic|=$e,_.lanes=$e,_.memoizedState=En}}function Bu(_,v,x){if(_=v.effects,v.effects=null,_!==null)for(v=0;v<_.length;v++){var w=_[v],P=w.callback;if(P!==null){if(w.callback=null,w=x,typeof P!="function")throw Error(l(191,P));P.call(w)}}}var Up=new r.Component().refs;function Fu(_,v,x,w){v=_.memoizedState,x=x(w,v),x=x==null?v:a({},v,x),_.memoizedState=x,_.lanes===0&&(_.updateQueue.baseState=x)}var Oc={isMounted:function(_){return(_=_._reactInternals)?D(_)===_:!1},enqueueSetState:function(_,v,x){_=_._reactInternals;var w=Gr(),P=$a(_),V=Fo(w,P);V.payload=v,x!=null&&(V.callback=x),ga(_,V),v=Ls(_,P,w),v!==null&&Du(v,_,P)},enqueueReplaceState:function(_,v,x){_=_._reactInternals;var w=Gr(),P=$a(_),V=Fo(w,P);V.tag=1,V.payload=v,x!=null&&(V.callback=x),ga(_,V),v=Ls(_,P,w),v!==null&&Du(v,_,P)},enqueueForceUpdate:function(_,v){_=_._reactInternals;var x=Gr(),w=$a(_),P=Fo(x,w);P.tag=2,v!=null&&(P.callback=v),ga(_,P),v=Ls(_,w,x),v!==null&&Du(v,_,w)}};function Uo(_,v,x,w,P,V,$e){return _=_.stateNode,typeof _.shouldComponentUpdate=="function"?_.shouldComponentUpdate(w,V,$e):v.prototype&&v.prototype.isPureReactComponent?!vo(x,w)||!vo(P,V):!0}function Gp(_,v,x){var w=!1,P=ln,V=v.contextType;return typeof V=="object"&&V!==null?V=ci(V):(P=Fn(v)?bn:Bn.current,w=v.contextTypes,V=(w=w!=null)?tn(_,P):ln),v=new v(x,V),_.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=Oc,_.stateNode=v,v._reactInternals=_,w&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=P,_.__reactInternalMemoizedMaskedChildContext=V),v}function Hp(_,v,x,w){_=v.state,typeof v.componentWillReceiveProps=="function"&&v.componentWillReceiveProps(x,w),typeof v.UNSAFE_componentWillReceiveProps=="function"&&v.UNSAFE_componentWillReceiveProps(x,w),v.state!==_&&Oc.enqueueReplaceState(v,v.state,null)}function Lc(_,v,x,w){var P=_.stateNode;P.props=x,P.state=_.memoizedState,P.refs=Up,Ic(_);var V=v.contextType;typeof V=="object"&&V!==null?P.context=ci(V):(V=Fn(v)?bn:Bn.current,P.context=tn(_,V)),P.state=_.memoizedState,V=v.getDerivedStateFromProps,typeof V=="function"&&(Fu(_,v,V,x),P.state=_.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof P.getSnapshotBeforeUpdate=="function"||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(v=P.state,typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount(),v!==P.state&&Oc.enqueueReplaceState(P,P.state,null),vd(_,x,P,w),P.state=_.memoizedState),typeof P.componentDidMount=="function"&&(_.flags|=4194308)}var zl=[],Wl=0,Td=null,Nc=0,Ms=[],Zs=0,Xl=null,_a=1,va="";function jl(_,v){zl[Wl++]=Nc,zl[Wl++]=Td,Td=_,Nc=v}function kc(_,v,x){Ms[Zs++]=_a,Ms[Zs++]=va,Ms[Zs++]=Xl,Xl=_;var w=_a;_=va;var P=32-An(w)-1;w&=~(1<<P),x+=1;var V=32-An(v)+P;if(30<V){var $e=P-P%5;V=(w&(1<<$e)-1).toString(32),w>>=$e,P-=$e,_a=1<<32-An(v)+P|x<<P|w,va=V+_}else _a=1<<V|x<<P|w,va=_}function Ed(_){_.return!==null&&(jl(_,1),kc(_,1,0))}function yd(_){for(;_===Td;)Td=zl[--Wl],zl[Wl]=null,Nc=zl[--Wl],zl[Wl]=null;for(;_===Xl;)Xl=Ms[--Zs],Ms[Zs]=null,va=Ms[--Zs],Ms[Zs]=null,_a=Ms[--Zs],Ms[Zs]=null}var Ar=null,es=null,Li=!1,Uu=!1,qs=null;function Vp(_,v){var x=cr(5,null,null,0);x.elementType="DELETED",x.stateNode=v,x.return=_,v=_.deletions,v===null?(_.deletions=[x],_.flags|=16):v.push(x)}function Ta(_,v){switch(_.tag){case 5:return v=an(v,_.type,_.pendingProps),v!==null?(_.stateNode=v,Ar=_,es=nn(v),!0):!1;case 6:return v=ei(v,_.pendingProps),v!==null?(_.stateNode=v,Ar=_,es=null,!0):!1;case 13:if(v=pi(v),v!==null){var x=Xl!==null?{id:_a,overflow:va}:null;return _.memoizedState={dehydrated:v,treeContext:x,retryLane:1073741824},x=cr(18,null,null,0),x.stateNode=v,x.return=_,_.child=x,Ar=_,es=null,!0}return!1;default:return!1}}function Sd(_){return(_.mode&1)!==0&&(_.flags&128)===0}function $d(_){if(Li){var v=es;if(v){var x=v;if(!Ta(_,v)){if(Sd(_))throw Error(l(418));v=Ti(x);var w=Ar;v&&Ta(_,v)?Vp(w,x):(_.flags=_.flags&-4097|2,Li=!1,Ar=_)}}else{if(Sd(_))throw Error(l(418));_.flags=_.flags&-4097|2,Li=!1,Ar=_}}}function c_(_){for(_=_.return;_!==null&&_.tag!==5&&_.tag!==3&&_.tag!==13;)_=_.return;Ar=_}function Gu(_){if(!Ye||_!==Ar)return!1;if(!Li)return c_(_),Li=!0,!1;if(_.tag!==3&&(_.tag!==5||at(_.type)&&!Te(_.type,_.memoizedProps))){var v=es;if(v){if(Sd(_)){for(_=es;_;)_=Ti(_);throw Error(l(418))}for(;v;)Vp(_,v),v=Ti(v)}}if(c_(_),_.tag===13){if(!Ye)throw Error(l(316));if(_=_.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(l(317));es=ve(_)}else es=Ar?Ti(_.stateNode):null;return!0}function Pc(){Ye&&(es=Ar=null,Uu=Li=!1)}function zp(_){qs===null?qs=[_]:qs.push(_)}function Dc(_,v,x){if(_=x.ref,_!==null&&typeof _!="function"&&typeof _!="object"){if(x._owner){if(x=x._owner,x){if(x.tag!==1)throw Error(l(309));var w=x.stateNode}if(!w)throw Error(l(147,_));var P=w,V=""+_;return v!==null&&v.ref!==null&&typeof v.ref=="function"&&v.ref._stringRef===V?v.ref:(v=function($e){var Pe=P.refs;Pe===Up&&(Pe=P.refs={}),$e===null?delete Pe[V]:Pe[V]=$e},v._stringRef=V,v)}if(typeof _!="string")throw Error(l(284));if(!x._owner)throw Error(l(290,_))}return _}function bd(_,v){throw _=Object.prototype.toString.call(v),Error(l(31,_==="[object Object]"?"object with keys {"+Object.keys(v).join(", ")+"}":_))}function Wp(_){var v=_._init;return v(_._payload)}function u_(_){function v(Qe,He){if(_){var ct=Qe.deletions;ct===null?(Qe.deletions=[He],Qe.flags|=16):ct.push(He)}}function x(Qe,He){if(!_)return null;for(;He!==null;)v(Qe,He),He=He.sibling;return null}function w(Qe,He){for(Qe=new Map;He!==null;)He.key!==null?Qe.set(He.key,He):Qe.set(He.index,He),He=He.sibling;return Qe}function P(Qe,He){return Qe=to(Qe,He),Qe.index=0,Qe.sibling=null,Qe}function V(Qe,He,ct){return Qe.index=ct,_?(ct=Qe.alternate,ct!==null?(ct=ct.index,ct<He?(Qe.flags|=2,He):ct):(Qe.flags|=2,He)):(Qe.flags|=1048576,He)}function $e(Qe){return _&&Qe.alternate===null&&(Qe.flags|=2),Qe}function Pe(Qe,He,ct,Pt){return He===null||He.tag!==6?(He=Jo(ct,Qe.mode,Pt),He.return=Qe,He):(He=P(He,ct),He.return=Qe,He)}function ht(Qe,He,ct,Pt){var en=ct.type;return en===f?Gt(Qe,He,ct.props.children,Pt,ct.key):He!==null&&(He.elementType===en||typeof en=="object"&&en!==null&&en.$$typeof===C&&Wp(en)===He.type)?(Pt=P(He,ct.props),Pt.ref=Dc(Qe,He,ct),Pt.return=Qe,Pt):(Pt=hl(ct.type,ct.key,ct.props,null,Qe.mode,Pt),Pt.ref=Dc(Qe,He,ct),Pt.return=Qe,Pt)}function Rt(Qe,He,ct,Pt){return He===null||He.tag!==4||He.stateNode.containerInfo!==ct.containerInfo||He.stateNode.implementation!==ct.implementation?(He=ac(ct,Qe.mode,Pt),He.return=Qe,He):(He=P(He,ct.children||[]),He.return=Qe,He)}function Gt(Qe,He,ct,Pt,en){return He===null||He.tag!==7?(He=So(ct,Qe.mode,Pt,en),He.return=Qe,He):(He=P(He,ct),He.return=Qe,He)}function En(Qe,He,ct){if(typeof He=="string"&&He!==""||typeof He=="number")return He=Jo(""+He,Qe.mode,ct),He.return=Qe,He;if(typeof He=="object"&&He!==null){switch(He.$$typeof){case d:return ct=hl(He.type,He.key,He.props,null,Qe.mode,ct),ct.ref=Dc(Qe,null,He),ct.return=Qe,ct;case h:return He=ac(He,Qe.mode,ct),He.return=Qe,He;case C:var Pt=He._init;return En(Qe,Pt(He._payload),ct)}if(pe(He)||O(He))return He=So(He,Qe.mode,ct,null),He.return=Qe,He;bd(Qe,He)}return null}function cn(Qe,He,ct,Pt){var en=He!==null?He.key:null;if(typeof ct=="string"&&ct!==""||typeof ct=="number")return en!==null?null:Pe(Qe,He,""+ct,Pt);if(typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case d:return ct.key===en?ht(Qe,He,ct,Pt):null;case h:return ct.key===en?Rt(Qe,He,ct,Pt):null;case C:return en=ct._init,cn(Qe,He,en(ct._payload),Pt)}if(pe(ct)||O(ct))return en!==null?null:Gt(Qe,He,ct,Pt,null);bd(Qe,ct)}return null}function _i(Qe,He,ct,Pt,en){if(typeof Pt=="string"&&Pt!==""||typeof Pt=="number")return Qe=Qe.get(ct)||null,Pe(He,Qe,""+Pt,en);if(typeof Pt=="object"&&Pt!==null){switch(Pt.$$typeof){case d:return Qe=Qe.get(Pt.key===null?ct:Pt.key)||null,ht(He,Qe,Pt,en);case h:return Qe=Qe.get(Pt.key===null?ct:Pt.key)||null,Rt(He,Qe,Pt,en);case C:var Sn=Pt._init;return _i(Qe,He,ct,Sn(Pt._payload),en)}if(pe(Pt)||O(Pt))return Qe=Qe.get(ct)||null,Gt(He,Qe,Pt,en,null);bd(He,Pt)}return null}function Jt(Qe,He,ct,Pt){for(var en=null,Sn=null,vn=He,Wn=He=0,_r=null;vn!==null&&Wn<ct.length;Wn++){vn.index>Wn?(_r=vn,vn=null):_r=vn.sibling;var Yn=cn(Qe,vn,ct[Wn],Pt);if(Yn===null){vn===null&&(vn=_r);break}_&&vn&&Yn.alternate===null&&v(Qe,vn),He=V(Yn,He,Wn),Sn===null?en=Yn:Sn.sibling=Yn,Sn=Yn,vn=_r}if(Wn===ct.length)return x(Qe,vn),Li&&jl(Qe,Wn),en;if(vn===null){for(;Wn<ct.length;Wn++)vn=En(Qe,ct[Wn],Pt),vn!==null&&(He=V(vn,He,Wn),Sn===null?en=vn:Sn.sibling=vn,Sn=vn);return Li&&jl(Qe,Wn),en}for(vn=w(Qe,vn);Wn<ct.length;Wn++)_r=_i(vn,Qe,Wn,ct[Wn],Pt),_r!==null&&(_&&_r.alternate!==null&&vn.delete(_r.key===null?Wn:_r.key),He=V(_r,He,Wn),Sn===null?en=_r:Sn.sibling=_r,Sn=_r);return _&&vn.forEach(function(dl){return v(Qe,dl)}),Li&&jl(Qe,Wn),en}function Wi(Qe,He,ct,Pt){var en=O(ct);if(typeof en!="function")throw Error(l(150));if(ct=en.call(ct),ct==null)throw Error(l(151));for(var Sn=en=null,vn=He,Wn=He=0,_r=null,Yn=ct.next();vn!==null&&!Yn.done;Wn++,Yn=ct.next()){vn.index>Wn?(_r=vn,vn=null):_r=vn.sibling;var dl=cn(Qe,vn,Yn.value,Pt);if(dl===null){vn===null&&(vn=_r);break}_&&vn&&dl.alternate===null&&v(Qe,vn),He=V(dl,He,Wn),Sn===null?en=dl:Sn.sibling=dl,Sn=dl,vn=_r}if(Yn.done)return x(Qe,vn),Li&&jl(Qe,Wn),en;if(vn===null){for(;!Yn.done;Wn++,Yn=ct.next())Yn=En(Qe,Yn.value,Pt),Yn!==null&&(He=V(Yn,He,Wn),Sn===null?en=Yn:Sn.sibling=Yn,Sn=Yn);return Li&&jl(Qe,Wn),en}for(vn=w(Qe,vn);!Yn.done;Wn++,Yn=ct.next())Yn=_i(vn,Qe,Wn,Yn.value,Pt),Yn!==null&&(_&&Yn.alternate!==null&&vn.delete(Yn.key===null?Wn:Yn.key),He=V(Yn,He,Wn),Sn===null?en=Yn:Sn.sibling=Yn,Sn=Yn);return _&&vn.forEach(function(Q$){return v(Qe,Q$)}),Li&&jl(Qe,Wn),en}function ms(Qe,He,ct,Pt){if(typeof ct=="object"&&ct!==null&&ct.type===f&&ct.key===null&&(ct=ct.props.children),typeof ct=="object"&&ct!==null){switch(ct.$$typeof){case d:e:{for(var en=ct.key,Sn=He;Sn!==null;){if(Sn.key===en){if(en=ct.type,en===f){if(Sn.tag===7){x(Qe,Sn.sibling),He=P(Sn,ct.props.children),He.return=Qe,Qe=He;break e}}else if(Sn.elementType===en||typeof en=="object"&&en!==null&&en.$$typeof===C&&Wp(en)===Sn.type){x(Qe,Sn.sibling),He=P(Sn,ct.props),He.ref=Dc(Qe,Sn,ct),He.return=Qe,Qe=He;break e}x(Qe,Sn);break}else v(Qe,Sn);Sn=Sn.sibling}ct.type===f?(He=So(ct.props.children,Qe.mode,Pt,ct.key),He.return=Qe,Qe=He):(Pt=hl(ct.type,ct.key,ct.props,null,Qe.mode,Pt),Pt.ref=Dc(Qe,He,ct),Pt.return=Qe,Qe=Pt)}return $e(Qe);case h:e:{for(Sn=ct.key;He!==null;){if(He.key===Sn)if(He.tag===4&&He.stateNode.containerInfo===ct.containerInfo&&He.stateNode.implementation===ct.implementation){x(Qe,He.sibling),He=P(He,ct.children||[]),He.return=Qe,Qe=He;break e}else{x(Qe,He);break}else v(Qe,He);He=He.sibling}He=ac(ct,Qe.mode,Pt),He.return=Qe,Qe=He}return $e(Qe);case C:return Sn=ct._init,ms(Qe,He,Sn(ct._payload),Pt)}if(pe(ct))return Jt(Qe,He,ct,Pt);if(O(ct))return Wi(Qe,He,ct,Pt);bd(Qe,ct)}return typeof ct=="string"&&ct!==""||typeof ct=="number"?(ct=""+ct,He!==null&&He.tag===6?(x(Qe,He.sibling),He=P(He,ct),He.return=Qe,Qe=He):(x(Qe,He),He=Jo(ct,Qe.mode,Pt),He.return=Qe,Qe=He),$e(Qe)):x(Qe,He)}return ms}var To=u_(!0),Hu=u_(!1),Yl={},hs=Ot(Yl),Go=Ot(Yl),Kl=Ot(Yl);function Qs(_){if(_===Yl)throw Error(l(174));return _}function Ad(_,v){Ft(Kl,v),Ft(Go,_),Ft(hs,Yl),_=xe(v),qt(hs),Ft(hs,_)}function yi(){qt(hs),qt(Go),qt(Kl)}function h_(_){var v=Qs(Kl.current),x=Qs(hs.current);v=H(x,_.type,v),x!==v&&(Ft(Go,_),Ft(hs,v))}function Jl(_){Go.current===_&&(qt(hs),qt(Go))}var gi=Ot(0);function Cd(_){for(var v=_;v!==null;){if(v.tag===13){var x=v.memoizedState;if(x!==null&&(x=x.dehydrated,x===null||Ji(x)||Ci(x)))return v}else if(v.tag===19&&v.memoizedProps.revealOrder!==void 0){if(v.flags&128)return v}else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===_)break;for(;v.sibling===null;){if(v.return===null||v.return===_)return null;v=v.return}v.sibling.return=v.return,v=v.sibling}return null}var xd=[];function Vu(){for(var _=0;_<xd.length;_++){var v=xd[_];Ue?v._workInProgressVersionPrimary=null:v._workInProgressVersionSecondary=null}xd.length=0}var Qa=u.ReactCurrentDispatcher,Is=u.ReactCurrentBatchConfig,Eo=0,wi=null,Cr=null,ar=null,Rd=!1,zu=!1,Wu=0,d_=0;function Fr(){throw Error(l(321))}function wd(_,v){if(v===null)return!1;for(var x=0;x<v.length&&x<_.length;x++)if(!$r(_[x],v[x]))return!1;return!0}function Bc(_,v,x,w,P,V){if(Eo=V,wi=v,v.memoizedState=null,v.updateQueue=null,v.lanes=0,Qa.current=_===null||_.memoizedState===null?qp:b_,_=x(w,P),zu){V=0;do{if(zu=!1,Wu=0,25<=V)throw Error(l(301));V+=1,ar=Cr=null,v.updateQueue=null,Qa.current=A_,_=x(w,P)}while(zu)}if(Qa.current=Ju,v=Cr!==null&&Cr.next!==null,Eo=0,ar=Cr=wi=null,Rd=!1,v)throw Error(l(300));return _}function Xp(){var _=Wu!==0;return Wu=0,_}function Ea(){var _={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ar===null?wi.memoizedState=ar=_:ar=ar.next=_,ar}function Ho(){if(Cr===null){var _=wi.alternate;_=_!==null?_.memoizedState:null}else _=Cr.next;var v=ar===null?wi.memoizedState:ar.next;if(v!==null)ar=v,Cr=_;else{if(_===null)throw Error(l(310));Cr=_,_={memoizedState:Cr.memoizedState,baseState:Cr.baseState,baseQueue:Cr.baseQueue,queue:Cr.queue,next:null},ar===null?wi.memoizedState=ar=_:ar=ar.next=_}return ar}function Zl(_,v){return typeof v=="function"?v(_):v}function ql(_){var v=Ho(),x=v.queue;if(x===null)throw Error(l(311));x.lastRenderedReducer=_;var w=Cr,P=w.baseQueue,V=x.pending;if(V!==null){if(P!==null){var $e=P.next;P.next=V.next,V.next=$e}w.baseQueue=P=V,x.pending=null}if(P!==null){V=P.next,w=w.baseState;var Pe=$e=null,ht=null,Rt=V;do{var Gt=Rt.lane;if((Eo&Gt)===Gt)ht!==null&&(ht=ht.next={lane:0,action:Rt.action,hasEagerState:Rt.hasEagerState,eagerState:Rt.eagerState,next:null}),w=Rt.hasEagerState?Rt.eagerState:_(w,Rt.action);else{var En={lane:Gt,action:Rt.action,hasEagerState:Rt.hasEagerState,eagerState:Rt.eagerState,next:null};ht===null?(Pe=ht=En,$e=w):ht=ht.next=En,wi.lanes|=Gt,ic|=Gt}Rt=Rt.next}while(Rt!==null&&Rt!==V);ht===null?$e=w:ht.next=Pe,$r(w,v.memoizedState)||(ds=!0),v.memoizedState=w,v.baseState=$e,v.baseQueue=ht,x.lastRenderedState=w}if(_=x.interleaved,_!==null){P=_;do V=P.lane,wi.lanes|=V,ic|=V,P=P.next;while(P!==_)}else P===null&&(x.lanes=0);return[v.memoizedState,x.dispatch]}function Xu(_){var v=Ho(),x=v.queue;if(x===null)throw Error(l(311));x.lastRenderedReducer=_;var w=x.dispatch,P=x.pending,V=v.memoizedState;if(P!==null){x.pending=null;var $e=P=P.next;do V=_(V,$e.action),$e=$e.next;while($e!==P);$r(V,v.memoizedState)||(ds=!0),v.memoizedState=V,v.baseQueue===null&&(v.baseState=V),x.lastRenderedState=V}return[V,w]}function f_(){}function ju(_,v){var x=wi,w=Ho(),P=v(),V=!$r(w.memoizedState,P);if(V&&(w.memoizedState=P,ds=!0),w=w.queue,Ku(p_.bind(null,x,w,_),[_]),w.getSnapshot!==v||V||ar!==null&&ar.memoizedState.tag&1){if(x.flags|=2048,Fc(9,Yu.bind(null,x,w,P,v),void 0,null),qi===null)throw Error(l(349));Eo&30||jp(x,v,P)}return P}function jp(_,v,x){_.flags|=16384,_={getSnapshot:v,value:x},v=wi.updateQueue,v===null?(v={lastEffect:null,stores:null},wi.updateQueue=v,v.stores=[_]):(x=v.stores,x===null?v.stores=[_]:x.push(_))}function Yu(_,v,x,w){v.value=x,v.getSnapshot=w,m_(v)&&Ls(_,1,-1)}function p_(_,v,x){return x(function(){m_(v)&&Ls(_,1,-1)})}function m_(_){var v=_.getSnapshot;_=_.value;try{var x=v();return!$r(_,x)}catch{return!0}}function ya(_){var v=Ea();return typeof _=="function"&&(_=_()),v.memoizedState=v.baseState=_,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zl,lastRenderedState:_},v.queue=_,_=_.dispatch=Jp.bind(null,wi,_),[v.memoizedState,_]}function Fc(_,v,x,w){return _={tag:_,create:v,destroy:x,deps:w,next:null},v=wi.updateQueue,v===null?(v={lastEffect:null,stores:null},wi.updateQueue=v,v.lastEffect=_.next=_):(x=v.lastEffect,x===null?v.lastEffect=_.next=_:(w=x.next,x.next=_,_.next=w,v.lastEffect=_)),_}function Vo(){return Ho().memoizedState}function Md(_,v,x,w){var P=Ea();wi.flags|=_,P.memoizedState=Fc(1|v,x,void 0,w===void 0?null:w)}function Id(_,v,x,w){var P=Ho();w=w===void 0?null:w;var V=void 0;if(Cr!==null){var $e=Cr.memoizedState;if(V=$e.destroy,w!==null&&wd(w,$e.deps)){P.memoizedState=Fc(v,x,V,w);return}}wi.flags|=_,P.memoizedState=Fc(1|v,x,V,w)}function Od(_,v){return Md(8390656,8,_,v)}function Ku(_,v){return Id(2048,8,_,v)}function Ql(_,v){return Id(4,2,_,v)}function Yp(_,v){return Id(4,4,_,v)}function g_(_,v){if(typeof v=="function")return _=_(),v(_),function(){v(null)};if(v!=null)return _=_(),v.current=_,function(){v.current=null}}function __(_,v,x){return x=x!=null?x.concat([_]):null,Id(4,4,g_.bind(null,v,_),x)}function Kp(){}function v_(_,v){var x=Ho();v=v===void 0?null:v;var w=x.memoizedState;return w!==null&&v!==null&&wd(v,w[1])?w[0]:(x.memoizedState=[_,v],_)}function T_(_,v){var x=Ho();v=v===void 0?null:v;var w=x.memoizedState;return w!==null&&v!==null&&wd(v,w[1])?w[0]:(_=_(),x.memoizedState=[_,v],_)}function E_(_,v){var x=sn;sn=x!==0&&4>x?x:4,_(!0);var w=Is.transition;Is.transition={};try{_(!1),v()}finally{sn=x,Is.transition=w}}function y_(){return Ho().memoizedState}function FE(_,v,x){var w=$a(_);x={lane:w,action:x,hasEagerState:!1,eagerState:null,next:null},S_(_)?$_(v,x):(Zp(_,v,x),x=Gr(),_=Ls(_,w,x),_!==null&&Ld(_,v,w))}function Jp(_,v,x){var w=$a(_),P={lane:w,action:x,hasEagerState:!1,eagerState:null,next:null};if(S_(_))$_(v,P);else{Zp(_,v,P);var V=_.alternate;if(_.lanes===0&&(V===null||V.lanes===0)&&(V=v.lastRenderedReducer,V!==null))try{var $e=v.lastRenderedState,Pe=V($e,x);if(P.hasEagerState=!0,P.eagerState=Pe,$r(Pe,$e))return}catch{}finally{}x=Gr(),_=Ls(_,w,x),_!==null&&Ld(_,v,w)}}function S_(_){var v=_.alternate;return _===wi||v!==null&&v===wi}function $_(_,v){zu=Rd=!0;var x=_.pending;x===null?v.next=v:(v.next=x.next,x.next=v),_.pending=v}function Zp(_,v,x){qi!==null&&_.mode&1&&!(Rn&2)?(_=v.interleaved,_===null?(x.next=x,br===null?br=[v]:br.push(v)):(x.next=_.next,_.next=x),v.interleaved=x):(_=v.pending,_===null?x.next=x:(x.next=_.next,_.next=x),v.pending=x)}function Ld(_,v,x){if(x&4194240){var w=v.lanes;w&=_.pendingLanes,x|=w,v.lanes=x,ti(_,x)}}var Ju={readContext:ci,useCallback:Fr,useContext:Fr,useEffect:Fr,useImperativeHandle:Fr,useInsertionEffect:Fr,useLayoutEffect:Fr,useMemo:Fr,useReducer:Fr,useRef:Fr,useState:Fr,useDebugValue:Fr,useDeferredValue:Fr,useTransition:Fr,useMutableSource:Fr,useSyncExternalStore:Fr,useId:Fr,unstable_isNewReconciler:!1},qp={readContext:ci,useCallback:function(_,v){return Ea().memoizedState=[_,v===void 0?null:v],_},useContext:ci,useEffect:Od,useImperativeHandle:function(_,v,x){return x=x!=null?x.concat([_]):null,Md(4194308,4,g_.bind(null,v,_),x)},useLayoutEffect:function(_,v){return Md(4194308,4,_,v)},useInsertionEffect:function(_,v){return Md(4,2,_,v)},useMemo:function(_,v){var x=Ea();return v=v===void 0?null:v,_=_(),x.memoizedState=[_,v],_},useReducer:function(_,v,x){var w=Ea();return v=x!==void 0?x(v):v,w.memoizedState=w.baseState=v,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:v},w.queue=_,_=_.dispatch=FE.bind(null,wi,_),[w.memoizedState,_]},useRef:function(_){var v=Ea();return _={current:_},v.memoizedState=_},useState:ya,useDebugValue:Kp,useDeferredValue:function(_){var v=ya(_),x=v[0],w=v[1];return Od(function(){var P=Is.transition;Is.transition={};try{w(_)}finally{Is.transition=P}},[_]),x},useTransition:function(){var _=ya(!1),v=_[0];return _=E_.bind(null,_[1]),Ea().memoizedState=_,[v,_]},useMutableSource:function(){},useSyncExternalStore:function(_,v,x){var w=wi,P=Ea();if(Li){if(x===void 0)throw Error(l(407));x=x()}else{if(x=v(),qi===null)throw Error(l(349));Eo&30||jp(w,v,x)}P.memoizedState=x;var V={value:x,getSnapshot:v};return P.queue=V,Od(p_.bind(null,w,V,_),[_]),w.flags|=2048,Fc(9,Yu.bind(null,w,V,x,v),void 0,null),x},useId:function(){var _=Ea(),v=qi.identifierPrefix;if(Li){var x=va,w=_a;x=(w&~(1<<32-An(w)-1)).toString(32)+x,v=":"+v+"R"+x,x=Wu++,0<x&&(v+="H"+x.toString(32)),v+=":"}else x=d_++,v=":"+v+"r"+x.toString(32)+":";return _.memoizedState=v},unstable_isNewReconciler:!1},b_={readContext:ci,useCallback:v_,useContext:ci,useEffect:Ku,useImperativeHandle:__,useInsertionEffect:Ql,useLayoutEffect:Yp,useMemo:T_,useReducer:ql,useRef:Vo,useState:function(){return ql(Zl)},useDebugValue:Kp,useDeferredValue:function(_){var v=ql(Zl),x=v[0],w=v[1];return Ku(function(){var P=Is.transition;Is.transition={};try{w(_)}finally{Is.transition=P}},[_]),x},useTransition:function(){var _=ql(Zl)[0],v=Ho().memoizedState;return[_,v]},useMutableSource:f_,useSyncExternalStore:ju,useId:y_,unstable_isNewReconciler:!1},A_={readContext:ci,useCallback:v_,useContext:ci,useEffect:Ku,useImperativeHandle:__,useInsertionEffect:Ql,useLayoutEffect:Yp,useMemo:T_,useReducer:Xu,useRef:Vo,useState:function(){return Xu(Zl)},useDebugValue:Kp,useDeferredValue:function(_){var v=Xu(Zl),x=v[0],w=v[1];return Ku(function(){var P=Is.transition;Is.transition={};try{w(_)}finally{Is.transition=P}},[_]),x},useTransition:function(){var _=Xu(Zl)[0],v=Ho().memoizedState;return[_,v]},useMutableSource:f_,useSyncExternalStore:ju,useId:y_,unstable_isNewReconciler:!1};function ec(_,v){try{var x="",w=v;do x+=Js(w),w=w.return;while(w);var P=x}catch(V){P=`
Error generating stack: `+V.message+`
`+V.stack}return{value:_,source:v,stack:P}}function el(_,v){try{console.error(v.value)}catch(x){setTimeout(function(){throw x})}}var tl=typeof WeakMap=="function"?WeakMap:Map;function nl(_,v,x){x=Fo(-1,x),x.tag=3,x.payload={element:null};var w=v.value;return x.callback=function(){rc||(rc=!0,qd=w),el(_,v)},x}function Nd(_,v,x){x=Fo(-1,x),x.tag=3;var w=_.type.getDerivedStateFromError;if(typeof w=="function"){var P=v.value;x.payload=function(){return w(P)},x.callback=function(){el(_,v)}}var V=_.stateNode;return V!==null&&typeof V.componentDidCatch=="function"&&(x.callback=function(){el(_,v),typeof w!="function"&&(al===null?al=new Set([this]):al.add(this));var $e=v.stack;this.componentDidCatch(v.value,{componentStack:$e!==null?$e:""})}),x}function zo(_,v,x){var w=_.pingCache;if(w===null){w=_.pingCache=new tl;var P=new Set;w.set(v,P)}else P=w.get(v),P===void 0&&(P=new Set,w.set(v,P));P.has(x)||(P.add(x),_=Kc.bind(null,_,v,x),v.then(_,_))}function C_(_){do{var v;if((v=_.tag===13)&&(v=_.memoizedState,v=v!==null?v.dehydrated!==null:!0),v)return _;_=_.return}while(_!==null);return null}function x_(_,v,x,w,P){return _.mode&1?(_.flags|=65536,_.lanes=P,_):(_===v?_.flags|=65536:(_.flags|=128,x.flags|=131072,x.flags&=-52805,x.tag===1&&(x.alternate===null?x.tag=17:(v=Fo(-1,1),v.tag=2,ga(x,v))),x.lanes|=1),_)}function Wo(_){_.flags|=4}function R_(_,v){if(_!==null&&_.child===v.child)return!0;if(v.flags&16)return!1;for(_=v.child;_!==null;){if(_.flags&12854||_.subtreeFlags&12854)return!1;_=_.sibling}return!0}var Uc,Zu,qu,Gc;if(Le)Uc=function(_,v){for(var x=v.child;x!==null;){if(x.tag===5||x.tag===6)Y(_,x.stateNode);else if(x.tag!==4&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===v)break;for(;x.sibling===null;){if(x.return===null||x.return===v)return;x=x.return}x.sibling.return=x.return,x=x.sibling}},Zu=function(){},qu=function(_,v,x,w,P){if(_=_.memoizedProps,_!==w){var V=v.stateNode,$e=Qs(hs.current);x=ue(V,x,_,w,P,$e),(v.updateQueue=x)&&Wo(v)}},Gc=function(_,v,x,w){x!==w&&Wo(v)};else if(re){Uc=function(_,v,x,w){for(var P=v.child;P!==null;){if(P.tag===5){var V=P.stateNode;x&&w&&(V=bt(V,P.type,P.memoizedProps,P)),Y(_,V)}else if(P.tag===6)V=P.stateNode,x&&w&&(V=un(V,P.memoizedProps,P)),Y(_,V);else if(P.tag!==4){if(P.tag===22&&P.memoizedState!==null)V=P.child,V!==null&&(V.return=P),Uc(_,P,!0,!0);else if(P.child!==null){P.child.return=P,P=P.child;continue}}if(P===v)break;for(;P.sibling===null;){if(P.return===null||P.return===v)return;P=P.return}P.sibling.return=P.return,P=P.sibling}};var w_=function(_,v,x,w){for(var P=v.child;P!==null;){if(P.tag===5){var V=P.stateNode;x&&w&&(V=bt(V,P.type,P.memoizedProps,P)),we(_,V)}else if(P.tag===6)V=P.stateNode,x&&w&&(V=un(V,P.memoizedProps,P)),we(_,V);else if(P.tag!==4){if(P.tag===22&&P.memoizedState!==null)V=P.child,V!==null&&(V.return=P),w_(_,P,!0,!0);else if(P.child!==null){P.child.return=P,P=P.child;continue}}if(P===v)break;for(;P.sibling===null;){if(P.return===null||P.return===v)return;P=P.return}P.sibling.return=P.return,P=P.sibling}};Zu=function(_,v){var x=v.stateNode;if(!R_(_,v)){_=x.containerInfo;var w=ge(_);w_(w,v,!1,!1),x.pendingChildren=w,Wo(v),We(_,w)}},qu=function(_,v,x,w,P){var V=_.stateNode,$e=_.memoizedProps;if((_=R_(_,v))&&$e===w)v.stateNode=V;else{var Pe=v.stateNode,ht=Qs(hs.current),Rt=null;$e!==w&&(Rt=ue(Pe,x,$e,w,P,ht)),_&&Rt===null?v.stateNode=V:(V=j(V,Rt,x,$e,w,v,_,Pe),he(V,x,w,P,ht)&&Wo(v),v.stateNode=V,_?Wo(v):Uc(V,v,!1,!1))}},Gc=function(_,v,x,w){x!==w?(_=Qs(Kl.current),x=Qs(hs.current),v.stateNode=_e(w,_,x,v),Wo(v)):v.stateNode=_.stateNode}}else Zu=function(){},qu=function(){},Gc=function(){};function Qu(_,v){if(!Li)switch(_.tailMode){case"hidden":v=_.tail;for(var x=null;v!==null;)v.alternate!==null&&(x=v),v=v.sibling;x===null?_.tail=null:x.sibling=null;break;case"collapsed":x=_.tail;for(var w=null;x!==null;)x.alternate!==null&&(w=x),x=x.sibling;w===null?v||_.tail===null?_.tail=null:_.tail.sibling=null:w.sibling=null}}function Ur(_){var v=_.alternate!==null&&_.alternate.child===_.child,x=0,w=0;if(v)for(var P=_.child;P!==null;)x|=P.lanes|P.childLanes,w|=P.subtreeFlags&14680064,w|=P.flags&14680064,P.return=_,P=P.sibling;else for(P=_.child;P!==null;)x|=P.lanes|P.childLanes,w|=P.subtreeFlags,w|=P.flags,P.return=_,P=P.sibling;return _.subtreeFlags|=w,_.childLanes=x,v}function M_(_,v,x){var w=v.pendingProps;switch(yd(v),v.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ur(v),null;case 1:return Fn(v.type)&&xn(),Ur(v),null;case 3:return w=v.stateNode,yi(),qt(on),qt(Bn),Vu(),w.pendingContext&&(w.context=w.pendingContext,w.pendingContext=null),(_===null||_.child===null)&&(Gu(v)?Wo(v):_===null||_.memoizedState.isDehydrated&&!(v.flags&256)||(v.flags|=1024,qs!==null&&(lm(qs),qs=null))),Zu(_,v),Ur(v),null;case 5:Jl(v),x=Qs(Kl.current);var P=v.type;if(_!==null&&v.stateNode!=null)qu(_,v,P,w,x),_.ref!==v.ref&&(v.flags|=512,v.flags|=2097152);else{if(!w){if(v.stateNode===null)throw Error(l(166));return Ur(v),null}if(_=Qs(hs.current),Gu(v)){if(!Ye)throw Error(l(175));_=Z(v.stateNode,v.type,v.memoizedProps,x,_,v,!Uu),v.updateQueue=_,_!==null&&Wo(v)}else{var V=se(P,w,x,_,v);Uc(V,v,!1,!1),v.stateNode=V,he(V,P,w,x,_)&&Wo(v)}v.ref!==null&&(v.flags|=512,v.flags|=2097152)}return Ur(v),null;case 6:if(_&&v.stateNode!=null)Gc(_,v,_.memoizedProps,w);else{if(typeof w!="string"&&v.stateNode===null)throw Error(l(166));if(_=Qs(Kl.current),x=Qs(hs.current),Gu(v)){if(!Ye)throw Error(l(176));if(_=v.stateNode,w=v.memoizedProps,(x=B(_,w,v,!Uu))&&(P=Ar,P!==null))switch(V=(P.mode&1)!==0,P.tag){case 3:rt(P.stateNode.containerInfo,_,w,V);break;case 5:pt(P.type,P.memoizedProps,P.stateNode,_,w,V)}x&&Wo(v)}else v.stateNode=_e(w,_,x,v)}return Ur(v),null;case 13:if(qt(gi),w=v.memoizedState,Li&&es!==null&&v.mode&1&&!(v.flags&128)){for(_=es;_;)_=Ti(_);return Pc(),v.flags|=98560,v}if(w!==null&&w.dehydrated!==null){if(w=Gu(v),_===null){if(!w)throw Error(l(318));if(!Ye)throw Error(l(344));if(_=v.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(l(317));le(_,v)}else Pc(),!(v.flags&128)&&(v.memoizedState=null),v.flags|=4;return Ur(v),null}return qs!==null&&(lm(qs),qs=null),v.flags&128?(v.lanes=x,v):(w=w!==null,x=!1,_===null?Gu(v):x=_.memoizedState!==null,w&&!x&&(v.child.flags|=8192,v.mode&1&&(_===null||gi.current&1?lr===0&&(lr=3):yo())),v.updateQueue!==null&&(v.flags|=4),Ur(v),null);case 4:return yi(),Zu(_,v),_===null&&Ze(v.stateNode.containerInfo),Ur(v),null;case 10:return Qt(v.type._context),Ur(v),null;case 17:return Fn(v.type)&&xn(),Ur(v),null;case 19:if(qt(gi),P=v.memoizedState,P===null)return Ur(v),null;if(w=(v.flags&128)!==0,V=P.rendering,V===null)if(w)Qu(P,!1);else{if(lr!==0||_!==null&&_.flags&128)for(_=v.child;_!==null;){if(V=Cd(_),V!==null){for(v.flags|=128,Qu(P,!1),_=V.updateQueue,_!==null&&(v.updateQueue=_,v.flags|=4),v.subtreeFlags=0,_=x,w=v.child;w!==null;)x=w,P=_,x.flags&=14680066,V=x.alternate,V===null?(x.childLanes=0,x.lanes=P,x.child=null,x.subtreeFlags=0,x.memoizedProps=null,x.memoizedState=null,x.updateQueue=null,x.dependencies=null,x.stateNode=null):(x.childLanes=V.childLanes,x.lanes=V.lanes,x.child=V.child,x.subtreeFlags=0,x.deletions=null,x.memoizedProps=V.memoizedProps,x.memoizedState=V.memoizedState,x.updateQueue=V.updateQueue,x.type=V.type,P=V.dependencies,x.dependencies=P===null?null:{lanes:P.lanes,firstContext:P.firstContext}),w=w.sibling;return Ft(gi,gi.current&1|2),v.child}_=_.sibling}P.tail!==null&&ai()>Zd&&(v.flags|=128,w=!0,Qu(P,!1),v.lanes=4194304)}else{if(!w)if(_=Cd(V),_!==null){if(v.flags|=128,w=!0,_=_.updateQueue,_!==null&&(v.updateQueue=_,v.flags|=4),Qu(P,!0),P.tail===null&&P.tailMode==="hidden"&&!V.alternate&&!Li)return Ur(v),null}else 2*ai()-P.renderingStartTime>Zd&&x!==1073741824&&(v.flags|=128,w=!0,Qu(P,!1),v.lanes=4194304);P.isBackwards?(V.sibling=v.child,v.child=V):(_=P.last,_!==null?_.sibling=V:v.child=V,P.last=V)}return P.tail!==null?(v=P.tail,P.rendering=v,P.tail=v.sibling,P.renderingStartTime=ai(),v.sibling=null,_=gi.current,Ft(gi,w?_&1|2:_&1),v):(Ur(v),null);case 22:case 23:return vt(),w=v.memoizedState!==null,_!==null&&_.memoizedState!==null!==w&&(v.flags|=8192),w&&v.mode&1?Os&1073741824&&(Ur(v),Le&&v.subtreeFlags&6&&(v.flags|=8192)):Ur(v),null;case 24:return null;case 25:return null}throw Error(l(156,v.tag))}var Qp=u.ReactCurrentOwner,ds=!1;function xr(_,v,x,w){v.child=_===null?Hu(v,null,x,w):To(v,_.child,x,w)}function I_(_,v,x,w,P){x=x.render;var V=v.ref;return li(v,P),w=Bc(_,v,x,w,V,P),x=Xp(),_!==null&&!ds?(v.updateQueue=_.updateQueue,v.flags&=-2053,_.lanes&=~P,jo(_,v,P)):(Li&&x&&Ed(v),v.flags|=1,xr(_,v,w,P),v.child)}function O_(_,v,x,w,P){if(_===null){var V=x.type;return typeof V=="function"&&!oc(V)&&V.defaultProps===void 0&&x.compare===null&&x.defaultProps===void 0?(v.tag=15,v.type=V,L_(_,v,V,w,P)):(_=hl(x.type,null,w,v,v.mode,P),_.ref=v.ref,_.return=v,v.child=_)}if(V=_.child,!(_.lanes&P)){var $e=V.memoizedProps;if(x=x.compare,x=x!==null?x:vo,x($e,w)&&_.ref===v.ref)return jo(_,v,P)}return v.flags|=1,_=to(V,w),_.ref=v.ref,_.return=v,v.child=_}function L_(_,v,x,w,P){if(_!==null&&vo(_.memoizedProps,w)&&_.ref===v.ref)if(ds=!1,(_.lanes&P)!==0)_.flags&131072&&(ds=!0);else return v.lanes=_.lanes,jo(_,v,P);return zt(_,v,x,w,P)}function N_(_,v,x){var w=v.pendingProps,P=w.children,V=_!==null?_.memoizedState:null;if(w.mode==="hidden")if(!(v.mode&1))v.memoizedState={baseLanes:0,cachePool:null},Ft(zc,Os),Os|=x;else if(x&1073741824)v.memoizedState={baseLanes:0,cachePool:null},w=V!==null?V.baseLanes:x,Ft(zc,Os),Os|=w;else return _=V!==null?V.baseLanes|x:x,v.lanes=v.childLanes=1073741824,v.memoizedState={baseLanes:_,cachePool:null},v.updateQueue=null,Ft(zc,Os),Os|=_,null;else V!==null?(w=V.baseLanes|x,v.memoizedState=null):w=x,Ft(zc,Os),Os|=w;return xr(_,v,P,x),v.child}function il(_,v){var x=v.ref;(_===null&&x!==null||_!==null&&_.ref!==x)&&(v.flags|=512,v.flags|=2097152)}function zt(_,v,x,w,P){var V=Fn(x)?bn:Bn.current;return V=tn(v,V),li(v,P),x=Bc(_,v,x,w,V,P),w=Xp(),_!==null&&!ds?(v.updateQueue=_.updateQueue,v.flags&=-2053,_.lanes&=~P,jo(_,v,P)):(Li&&w&&Ed(v),v.flags|=1,xr(_,v,x,P),v.child)}function fs(_,v,x,w,P){if(Fn(x)){var V=!0;Mn(v)}else V=!1;if(li(v,P),v.stateNode===null)_!==null&&(_.alternate=null,v.alternate=null,v.flags|=2),Gp(v,x,w),Lc(v,x,w,P),w=!0;else if(_===null){var $e=v.stateNode,Pe=v.memoizedProps;$e.props=Pe;var ht=$e.context,Rt=x.contextType;typeof Rt=="object"&&Rt!==null?Rt=ci(Rt):(Rt=Fn(x)?bn:Bn.current,Rt=tn(v,Rt));var Gt=x.getDerivedStateFromProps,En=typeof Gt=="function"||typeof $e.getSnapshotBeforeUpdate=="function";En||typeof $e.UNSAFE_componentWillReceiveProps!="function"&&typeof $e.componentWillReceiveProps!="function"||(Pe!==w||ht!==Rt)&&Hp(v,$e,w,Rt),us=!1;var cn=v.memoizedState;$e.state=cn,vd(v,w,$e,P),ht=v.memoizedState,Pe!==w||cn!==ht||on.current||us?(typeof Gt=="function"&&(Fu(v,x,Gt,w),ht=v.memoizedState),(Pe=us||Uo(v,x,Pe,w,cn,ht,Rt))?(En||typeof $e.UNSAFE_componentWillMount!="function"&&typeof $e.componentWillMount!="function"||(typeof $e.componentWillMount=="function"&&$e.componentWillMount(),typeof $e.UNSAFE_componentWillMount=="function"&&$e.UNSAFE_componentWillMount()),typeof $e.componentDidMount=="function"&&(v.flags|=4194308)):(typeof $e.componentDidMount=="function"&&(v.flags|=4194308),v.memoizedProps=w,v.memoizedState=ht),$e.props=w,$e.state=ht,$e.context=Rt,w=Pe):(typeof $e.componentDidMount=="function"&&(v.flags|=4194308),w=!1)}else{$e=v.stateNode,Bp(_,v),Pe=v.memoizedProps,Rt=v.type===v.elementType?Pe:Oi(v.type,Pe),$e.props=Rt,En=v.pendingProps,cn=$e.context,ht=x.contextType,typeof ht=="object"&&ht!==null?ht=ci(ht):(ht=Fn(x)?bn:Bn.current,ht=tn(v,ht));var _i=x.getDerivedStateFromProps;(Gt=typeof _i=="function"||typeof $e.getSnapshotBeforeUpdate=="function")||typeof $e.UNSAFE_componentWillReceiveProps!="function"&&typeof $e.componentWillReceiveProps!="function"||(Pe!==En||cn!==ht)&&Hp(v,$e,w,ht),us=!1,cn=v.memoizedState,$e.state=cn,vd(v,w,$e,P);var Jt=v.memoizedState;Pe!==En||cn!==Jt||on.current||us?(typeof _i=="function"&&(Fu(v,x,_i,w),Jt=v.memoizedState),(Rt=us||Uo(v,x,Rt,w,cn,Jt,ht)||!1)?(Gt||typeof $e.UNSAFE_componentWillUpdate!="function"&&typeof $e.componentWillUpdate!="function"||(typeof $e.componentWillUpdate=="function"&&$e.componentWillUpdate(w,Jt,ht),typeof $e.UNSAFE_componentWillUpdate=="function"&&$e.UNSAFE_componentWillUpdate(w,Jt,ht)),typeof $e.componentDidUpdate=="function"&&(v.flags|=4),typeof $e.getSnapshotBeforeUpdate=="function"&&(v.flags|=1024)):(typeof $e.componentDidUpdate!="function"||Pe===_.memoizedProps&&cn===_.memoizedState||(v.flags|=4),typeof $e.getSnapshotBeforeUpdate!="function"||Pe===_.memoizedProps&&cn===_.memoizedState||(v.flags|=1024),v.memoizedProps=w,v.memoizedState=Jt),$e.props=w,$e.state=Jt,$e.context=ht,w=Rt):(typeof $e.componentDidUpdate!="function"||Pe===_.memoizedProps&&cn===_.memoizedState||(v.flags|=4),typeof $e.getSnapshotBeforeUpdate!="function"||Pe===_.memoizedProps&&cn===_.memoizedState||(v.flags|=1024),w=!1)}return Zi(_,v,x,w,V,P)}function Zi(_,v,x,w,P,V){il(_,v);var $e=(v.flags&128)!==0;if(!w&&!$e)return P&&Kt(v,x,!1),jo(_,v,V);w=v.stateNode,Qp.current=v;var Pe=$e&&typeof x.getDerivedStateFromError!="function"?null:w.render();return v.flags|=1,_!==null&&$e?(v.child=To(v,_.child,null,V),v.child=To(v,null,Pe,V)):xr(_,v,Pe,V),v.memoizedState=w.state,P&&Kt(v,x,!0),v.child}function Si(_){var v=_.stateNode;v.pendingContext?hn(_,v.pendingContext,v.pendingContext!==v.context):v.context&&hn(_,v.context,!1),Ad(_,v.containerInfo)}function Xo(_,v,x,w,P){return Pc(),zp(P),v.flags|=256,xr(_,v,x,w),v.child}var rl={dehydrated:null,treeContext:null,retryLane:0};function Nt(_){return{baseLanes:_,cachePool:null}}function Di(_,v,x){var w=v.pendingProps,P=gi.current,V=!1,$e=(v.flags&128)!==0,Pe;if((Pe=$e)||(Pe=_!==null&&_.memoizedState===null?!1:(P&2)!==0),Pe?(V=!0,v.flags&=-129):(_===null||_.memoizedState!==null)&&(P|=1),Ft(gi,P&1),_===null)return $d(v),_=v.memoizedState,_!==null&&(_=_.dehydrated,_!==null)?(v.mode&1?Ci(_)?v.lanes=8:v.lanes=1073741824:v.lanes=1,null):(P=w.children,_=w.fallback,V?(w=v.mode,V=v.child,P={mode:"hidden",children:P},!(w&1)&&V!==null?(V.childLanes=0,V.pendingProps=P):V=Ko(P,w,0,null),_=So(_,w,x,null),V.return=v,_.return=v,V.sibling=_,v.child=V,v.child.memoizedState=Nt(x),v.memoizedState=rl,_):kd(v,P));if(P=_.memoizedState,P!==null){if(Pe=P.dehydrated,Pe!==null){if($e)return v.flags&256?(v.flags&=-257,eh(_,v,x,Error(l(422)))):v.memoizedState!==null?(v.child=_.child,v.flags|=128,null):(V=w.fallback,P=v.mode,w=Ko({mode:"visible",children:w.children},P,0,null),V=So(V,P,x,null),V.flags|=2,w.return=v,V.return=v,w.sibling=V,v.child=w,v.mode&1&&To(v,_.child,null,x),v.child.memoizedState=Nt(x),v.memoizedState=rl,V);if(!(v.mode&1))v=eh(_,v,x,null);else if(Ci(Pe))v=eh(_,v,x,Error(l(419)));else if(w=(x&_.childLanes)!==0,ds||w){if(w=qi,w!==null){switch(x&-x){case 4:V=2;break;case 16:V=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:V=32;break;case 536870912:V=268435456;break;default:V=0}w=V&(w.suspendedLanes|x)?0:V,w!==0&&w!==P.retryLane&&(P.retryLane=w,Ls(_,w,-1))}yo(),v=eh(_,v,x,Error(l(421)))}else Ji(Pe)?(v.flags|=128,v.child=_.child,v=Jc.bind(null,_),vi(Pe,v),v=null):(x=P.treeContext,Ye&&(es=yr(Pe),Ar=v,Li=!0,qs=null,Uu=!1,x!==null&&(Ms[Zs++]=_a,Ms[Zs++]=va,Ms[Zs++]=Xl,_a=x.id,va=x.overflow,Xl=v)),v=kd(v,v.pendingProps.children),v.flags|=4096);return v}return V?(w=Pd(_,v,w.children,w.fallback,x),V=v.child,P=_.child.memoizedState,V.memoizedState=P===null?Nt(x):{baseLanes:P.baseLanes|x,cachePool:null},V.childLanes=_.childLanes&~x,v.memoizedState=rl,w):(x=k_(_,v,w.children,x),v.memoizedState=null,x)}return V?(w=Pd(_,v,w.children,w.fallback,x),V=v.child,P=_.child.memoizedState,V.memoizedState=P===null?Nt(x):{baseLanes:P.baseLanes|x,cachePool:null},V.childLanes=_.childLanes&~x,v.memoizedState=rl,w):(x=k_(_,v,w.children,x),v.memoizedState=null,x)}function kd(_,v){return v=Ko({mode:"visible",children:v},_.mode,0,null),v.return=_,_.child=v}function k_(_,v,x,w){var P=_.child;return _=P.sibling,x=to(P,{mode:"visible",children:x}),!(v.mode&1)&&(x.lanes=w),x.return=v,x.sibling=null,_!==null&&(w=v.deletions,w===null?(v.deletions=[_],v.flags|=16):w.push(_)),v.child=x}function Pd(_,v,x,w,P){var V=v.mode;_=_.child;var $e=_.sibling,Pe={mode:"hidden",children:x};return!(V&1)&&v.child!==_?(x=v.child,x.childLanes=0,x.pendingProps=Pe,v.deletions=null):(x=to(_,Pe),x.subtreeFlags=_.subtreeFlags&14680064),$e!==null?w=to($e,w):(w=So(w,V,P,null),w.flags|=2),w.return=v,x.return=v,x.sibling=w,v.child=x,w}function eh(_,v,x,w){return w!==null&&zp(w),To(v,_.child,null,x),_=kd(v,v.pendingProps.children),_.flags|=2,v.memoizedState=null,_}function P_(_,v,x){_.lanes|=v;var w=_.alternate;w!==null&&(w.lanes|=v),yn(_.return,v,x)}function Dd(_,v,x,w,P){var V=_.memoizedState;V===null?_.memoizedState={isBackwards:v,rendering:null,renderingStartTime:0,last:w,tail:x,tailMode:P}:(V.isBackwards=v,V.rendering=null,V.renderingStartTime=0,V.last=w,V.tail=x,V.tailMode=P)}function Bd(_,v,x){var w=v.pendingProps,P=w.revealOrder,V=w.tail;if(xr(_,v,w.children,x),w=gi.current,w&2)w=w&1|2,v.flags|=128;else{if(_!==null&&_.flags&128)e:for(_=v.child;_!==null;){if(_.tag===13)_.memoizedState!==null&&P_(_,x,v);else if(_.tag===19)P_(_,x,v);else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===v)break e;for(;_.sibling===null;){if(_.return===null||_.return===v)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}w&=1}if(Ft(gi,w),!(v.mode&1))v.memoizedState=null;else switch(P){case"forwards":for(x=v.child,P=null;x!==null;)_=x.alternate,_!==null&&Cd(_)===null&&(P=x),x=x.sibling;x=P,x===null?(P=v.child,v.child=null):(P=x.sibling,x.sibling=null),Dd(v,!1,P,x,V);break;case"backwards":for(x=null,P=v.child,v.child=null;P!==null;){if(_=P.alternate,_!==null&&Cd(_)===null){v.child=P;break}_=P.sibling,P.sibling=x,x=P,P=_}Dd(v,!0,x,null,V);break;case"together":Dd(v,!1,null,null,void 0);break;default:v.memoizedState=null}return v.child}function jo(_,v,x){if(_!==null&&(v.dependencies=_.dependencies),ic|=v.lanes,!(x&v.childLanes))return null;if(_!==null&&v.child!==_.child)throw Error(l(153));if(v.child!==null){for(_=v.child,x=to(_,_.pendingProps),v.child=x,x.return=v;_.sibling!==null;)_=_.sibling,x=x.sibling=to(_,_.pendingProps),x.return=v;x.sibling=null}return v.child}function D_(_,v,x){switch(v.tag){case 3:Si(v),Pc();break;case 5:h_(v);break;case 1:Fn(v.type)&&Mn(v);break;case 4:Ad(v,v.stateNode.containerInfo);break;case 10:fn(v,v.type._context,v.memoizedProps.value);break;case 13:var w=v.memoizedState;if(w!==null)return w.dehydrated!==null?(Ft(gi,gi.current&1),v.flags|=128,null):x&v.child.childLanes?Di(_,v,x):(Ft(gi,gi.current&1),_=jo(_,v,x),_!==null?_.sibling:null);Ft(gi,gi.current&1);break;case 19:if(w=(x&v.childLanes)!==0,_.flags&128){if(w)return Bd(_,v,x);v.flags|=128}var P=v.memoizedState;if(P!==null&&(P.rendering=null,P.tail=null,P.lastEffect=null),Ft(gi,gi.current),w)break;return null;case 22:case 23:return v.lanes=0,N_(_,v,x)}return jo(_,v,x)}function UE(_,v){switch(yd(v),v.tag){case 1:return Fn(v.type)&&xn(),_=v.flags,_&65536?(v.flags=_&-65537|128,v):null;case 3:return yi(),qt(on),qt(Bn),Vu(),_=v.flags,_&65536&&!(_&128)?(v.flags=_&-65537|128,v):null;case 5:return Jl(v),null;case 13:if(qt(gi),_=v.memoizedState,_!==null&&_.dehydrated!==null){if(v.alternate===null)throw Error(l(340));Pc()}return _=v.flags,_&65536?(v.flags=_&-65537|128,v):null;case 19:return qt(gi),null;case 4:return yi(),null;case 10:return Qt(v.type._context),null;case 22:case 23:return vt(),null;case 24:return null;default:return null}}var th=!1,tc=!1,em=typeof WeakSet=="function"?WeakSet:Set,kt=null;function Fd(_,v){var x=_.ref;if(x!==null)if(typeof x=="function")try{x(null)}catch(w){Hr(_,v,w)}else x.current=null}function tm(_,v,x){try{x()}catch(w){Hr(_,v,w)}}var B_=!1;function GE(_,v){for(J(_.containerInfo),kt=v;kt!==null;)if(_=kt,v=_.child,(_.subtreeFlags&1028)!==0&&v!==null)v.return=_,kt=v;else for(;kt!==null;){_=kt;try{var x=_.alternate;if(_.flags&1024)switch(_.tag){case 0:case 11:case 15:break;case 1:if(x!==null){var w=x.memoizedProps,P=x.memoizedState,V=_.stateNode,$e=V.getSnapshotBeforeUpdate(_.elementType===_.type?w:Oi(_.type,w),P);V.__reactInternalSnapshotBeforeUpdate=$e}break;case 3:Le&&N(_.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(l(163))}}catch(Pe){Hr(_,_.return,Pe)}if(v=_.sibling,v!==null){v.return=_.return,kt=v;break}kt=_.return}return x=B_,B_=!1,x}function sl(_,v,x){var w=v.updateQueue;if(w=w!==null?w.lastEffect:null,w!==null){var P=w=w.next;do{if((P.tag&_)===_){var V=P.destroy;P.destroy=void 0,V!==void 0&&tm(v,x,V)}P=P.next}while(P!==w)}}function nh(_,v){if(v=v.updateQueue,v=v!==null?v.lastEffect:null,v!==null){var x=v=v.next;do{if((x.tag&_)===_){var w=x.create;x.destroy=w()}x=x.next}while(x!==v)}}function Hc(_){var v=_.ref;if(v!==null){var x=_.stateNode;switch(_.tag){case 5:_=de(x);break;default:_=x}typeof v=="function"?v(_):v.current=_}}function ih(_,v,x){if(Ii&&typeof Ii.onCommitFiberUnmount=="function")try{Ii.onCommitFiberUnmount(Ri,v)}catch{}switch(v.tag){case 0:case 11:case 14:case 15:if(_=v.updateQueue,_!==null&&(_=_.lastEffect,_!==null)){var w=_=_.next;do{var P=w,V=P.destroy;P=P.tag,V!==void 0&&(P&2||P&4)&&tm(v,x,V),w=w.next}while(w!==_)}break;case 1:if(Fd(v,x),_=v.stateNode,typeof _.componentWillUnmount=="function")try{_.props=v.memoizedProps,_.state=v.memoizedState,_.componentWillUnmount()}catch($e){Hr(v,x,$e)}break;case 5:Fd(v,x);break;case 4:Le?U_(_,v,x):re&&re&&(v=v.stateNode.containerInfo,x=ge(v),gt(v,x))}}function F_(_,v,x){for(var w=v;;)if(ih(_,w,x),w.child===null||Le&&w.tag===4){if(w===v)break;for(;w.sibling===null;){if(w.return===null||w.return===v)return;w=w.return}w.sibling.return=w.return,w=w.sibling}else w.child.return=w,w=w.child}function nm(_){var v=_.alternate;v!==null&&(_.alternate=null,nm(v)),_.child=null,_.deletions=null,_.sibling=null,_.tag===5&&(v=_.stateNode,v!==null&&dt(v)),_.stateNode=null,_.return=null,_.dependencies=null,_.memoizedProps=null,_.memoizedState=null,_.pendingProps=null,_.stateNode=null,_.updateQueue=null}function im(_){return _.tag===5||_.tag===3||_.tag===4}function rm(_){e:for(;;){for(;_.sibling===null;){if(_.return===null||im(_.return))return null;_=_.return}for(_.sibling.return=_.return,_=_.sibling;_.tag!==5&&_.tag!==6&&_.tag!==18;){if(_.flags&2||_.child===null||_.tag===4)continue e;_.child.return=_,_=_.child}if(!(_.flags&2))return _.stateNode}}function sm(_){if(Le){e:{for(var v=_.return;v!==null;){if(im(v))break e;v=v.return}throw Error(l(160))}var x=v;switch(x.tag){case 5:v=x.stateNode,x.flags&32&&(Ae(v),x.flags&=-33),x=rm(_),Ud(_,x,v);break;case 3:case 4:v=x.stateNode.containerInfo,x=rm(_),rh(_,x,v);break;default:throw Error(l(161))}}}function rh(_,v,x){var w=_.tag;if(w===5||w===6)_=_.stateNode,v?X(x,_,v):ut(x,_);else if(w!==4&&(_=_.child,_!==null))for(rh(_,v,x),_=_.sibling;_!==null;)rh(_,v,x),_=_.sibling}function Ud(_,v,x){var w=_.tag;if(w===5||w===6)_=_.stateNode,v?L(x,_,v):qe(x,_);else if(w!==4&&(_=_.child,_!==null))for(Ud(_,v,x),_=_.sibling;_!==null;)Ud(_,v,x),_=_.sibling}function U_(_,v,x){for(var w=v,P=!1,V,$e;;){if(!P){P=w.return;e:for(;;){if(P===null)throw Error(l(160));switch(V=P.stateNode,P.tag){case 5:$e=!1;break e;case 3:V=V.containerInfo,$e=!0;break e;case 4:V=V.containerInfo,$e=!0;break e}P=P.return}P=!0}if(w.tag===5||w.tag===6)F_(_,w,x),$e?z(V,w.stateNode):fe(V,w.stateNode);else if(w.tag===18)$e?Je(V,w.stateNode):Ke(V,w.stateNode);else if(w.tag===4){if(w.child!==null){V=w.stateNode.containerInfo,$e=!0,w.child.return=w,w=w.child;continue}}else if(ih(_,w,x),w.child!==null){w.child.return=w,w=w.child;continue}if(w===v)break;for(;w.sibling===null;){if(w.return===null||w.return===v)return;w=w.return,w.tag===4&&(P=!1)}w.sibling.return=w.return,w=w.sibling}}function om(_,v){if(Le){switch(v.tag){case 0:case 11:case 14:case 15:sl(3,v,v.return),nh(3,v),sl(5,v,v.return);return;case 1:return;case 5:var x=v.stateNode;if(x!=null){var w=v.memoizedProps;_=_!==null?_.memoizedProps:w;var P=v.type,V=v.updateQueue;v.updateQueue=null,V!==null&&$t(x,V,P,_,w,v)}return;case 6:if(v.stateNode===null)throw Error(l(162));x=v.memoizedProps,ft(v.stateNode,_!==null?_.memoizedProps:x,x);return;case 3:Ye&&_!==null&&_.memoizedState.isDehydrated&&me(v.stateNode.containerInfo);return;case 12:return;case 13:Gd(v);return;case 19:Gd(v);return;case 17:return}throw Error(l(163))}switch(v.tag){case 0:case 11:case 14:case 15:sl(3,v,v.return),nh(3,v),sl(5,v,v.return);return;case 12:return;case 13:Gd(v);return;case 19:Gd(v);return;case 3:Ye&&_!==null&&_.memoizedState.isDehydrated&&me(v.stateNode.containerInfo);break;case 22:case 23:return}e:if(re){switch(v.tag){case 1:case 5:case 6:break e;case 3:case 4:v=v.stateNode,gt(v.containerInfo,v.pendingChildren);break e}throw Error(l(163))}}function Gd(_){var v=_.updateQueue;if(v!==null){_.updateQueue=null;var x=_.stateNode;x===null&&(x=_.stateNode=new em),v.forEach(function(w){var P=mh.bind(null,_,w);x.has(w)||(x.add(w),w.then(P,P))})}}function sh(_,v){for(kt=v;kt!==null;){v=kt;var x=v.deletions;if(x!==null)for(var w=0;w<x.length;w++){var P=x[w];try{var V=_;Le?U_(V,P,v):F_(V,P,v);var $e=P.alternate;$e!==null&&($e.return=null),P.return=null}catch(en){Hr(P,v,en)}}if(x=v.child,v.subtreeFlags&12854&&x!==null)x.return=v,kt=x;else for(;kt!==null;){v=kt;try{var Pe=v.flags;if(Pe&32&&Le&&Ae(v.stateNode),Pe&512){var ht=v.alternate;if(ht!==null){var Rt=ht.ref;Rt!==null&&(typeof Rt=="function"?Rt(null):Rt.current=null)}}if(Pe&8192)switch(v.tag){case 13:if(v.memoizedState!==null){var Gt=v.alternate;(Gt===null||Gt.memoizedState===null)&&(Jd=ai())}break;case 22:var En=v.memoizedState!==null,cn=v.alternate,_i=cn!==null&&cn.memoizedState!==null;if(x=v,Le){e:if(w=x,P=En,V=null,Le)for(var Jt=w;;){if(Jt.tag===5){if(V===null){V=Jt;var Wi=Jt.stateNode;P?tt(Wi):Ie(Jt.stateNode,Jt.memoizedProps)}}else if(Jt.tag===6){if(V===null){var ms=Jt.stateNode;P?ye(ms):Be(ms,Jt.memoizedProps)}}else if((Jt.tag!==22&&Jt.tag!==23||Jt.memoizedState===null||Jt===w)&&Jt.child!==null){Jt.child.return=Jt,Jt=Jt.child;continue}if(Jt===w)break;for(;Jt.sibling===null;){if(Jt.return===null||Jt.return===w)break e;V===Jt&&(V=null),Jt=Jt.return}V===Jt&&(V=null),Jt.sibling.return=Jt.return,Jt=Jt.sibling}}if(En&&!_i&&x.mode&1){kt=x;for(var Qe=x.child;Qe!==null;){for(x=kt=Qe;kt!==null;){w=kt;var He=w.child;switch(w.tag){case 0:case 11:case 14:case 15:sl(4,w,w.return);break;case 1:Fd(w,w.return);var ct=w.stateNode;if(typeof ct.componentWillUnmount=="function"){var Pt=w.return;try{ct.props=w.memoizedProps,ct.state=w.memoizedState,ct.componentWillUnmount()}catch(en){Hr(w,Pt,en)}}break;case 5:Fd(w,w.return);break;case 22:if(w.memoizedState!==null){eo(x);continue}}He!==null?(He.return=w,kt=He):eo(x)}Qe=Qe.sibling}}}switch(Pe&4102){case 2:sm(v),v.flags&=-3;break;case 6:sm(v),v.flags&=-3,om(v.alternate,v);break;case 4096:v.flags&=-4097;break;case 4100:v.flags&=-4097,om(v.alternate,v);break;case 4:om(v.alternate,v)}}catch(en){Hr(v,v.return,en)}if(x=v.sibling,x!==null){x.return=v.return,kt=x;break}kt=v.return}}}function G_(_,v,x){kt=_,H_(_)}function H_(_,v,x){for(var w=(_.mode&1)!==0;kt!==null;){var P=kt,V=P.child;if(P.tag===22&&w){var $e=P.memoizedState!==null||th;if(!$e){var Pe=P.alternate,ht=Pe!==null&&Pe.memoizedState!==null||tc;Pe=th;var Rt=tc;if(th=$e,(tc=ht)&&!Rt)for(kt=P;kt!==null;)$e=kt,ht=$e.child,$e.tag===22&&$e.memoizedState!==null?V_(P):ht!==null?(ht.return=$e,kt=ht):V_(P);for(;V!==null;)kt=V,H_(V),V=V.sibling;kt=P,th=Pe,tc=Rt}Hd(_)}else P.subtreeFlags&8772&&V!==null?(V.return=P,kt=V):Hd(_)}}function Hd(_){for(;kt!==null;){var v=kt;if(v.flags&8772){var x=v.alternate;try{if(v.flags&8772)switch(v.tag){case 0:case 11:case 15:tc||nh(5,v);break;case 1:var w=v.stateNode;if(v.flags&4&&!tc)if(x===null)w.componentDidMount();else{var P=v.elementType===v.type?x.memoizedProps:Oi(v.type,x.memoizedProps);w.componentDidUpdate(P,x.memoizedState,w.__reactInternalSnapshotBeforeUpdate)}var V=v.updateQueue;V!==null&&Bu(v,V,w);break;case 3:var $e=v.updateQueue;if($e!==null){if(x=null,v.child!==null)switch(v.child.tag){case 5:x=de(v.child.stateNode);break;case 1:x=v.child.stateNode}Bu(v,$e,x)}break;case 5:var Pe=v.stateNode;x===null&&v.flags&4&&Ge(Pe,v.type,v.memoizedProps,v);break;case 6:break;case 4:break;case 12:break;case 13:if(Ye&&v.memoizedState===null){var ht=v.alternate;if(ht!==null){var Rt=ht.memoizedState;if(Rt!==null){var Gt=Rt.dehydrated;Gt!==null&&Se(Gt)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(l(163))}tc||v.flags&512&&Hc(v)}catch(En){Hr(v,v.return,En)}}if(v===_){kt=null;break}if(x=v.sibling,x!==null){x.return=v.return,kt=x;break}kt=v.return}}function eo(_){for(;kt!==null;){var v=kt;if(v===_){kt=null;break}var x=v.sibling;if(x!==null){x.return=v.return,kt=x;break}kt=v.return}}function V_(_){for(;kt!==null;){var v=kt;try{switch(v.tag){case 0:case 11:case 15:var x=v.return;try{nh(4,v)}catch(ht){Hr(v,x,ht)}break;case 1:var w=v.stateNode;if(typeof w.componentDidMount=="function"){var P=v.return;try{w.componentDidMount()}catch(ht){Hr(v,P,ht)}}var V=v.return;try{Hc(v)}catch(ht){Hr(v,V,ht)}break;case 5:var $e=v.return;try{Hc(v)}catch(ht){Hr(v,$e,ht)}}}catch(ht){Hr(v,v.return,ht)}if(v===_){kt=null;break}var Pe=v.sibling;if(Pe!==null){Pe.return=v.return,kt=Pe;break}kt=v.return}}var Yo=0,oh=1,Vd=2,nc=3,ah=4;if(typeof Symbol=="function"&&Symbol.for){var Vc=Symbol.for;Yo=Vc("selector.component"),oh=Vc("selector.has_pseudo_class"),Vd=Vc("selector.role"),nc=Vc("selector.test_id"),ah=Vc("selector.text")}function zd(_){var v=Fe(_);if(v!=null){if(typeof v.memoizedProps["data-testname"]!="string")throw Error(l(364));return v}if(_=Me(_),_===null)throw Error(l(362));return _.stateNode.current}function Wd(_,v){switch(v.$$typeof){case Yo:if(_.type===v.value)return!0;break;case oh:e:{v=v.value,_=[_,0];for(var x=0;x<_.length;){var w=_[x++],P=_[x++],V=v[P];if(w.tag!==5||!ee(w)){for(;V!=null&&Wd(w,V);)P++,V=v[P];if(P===v.length){v=!0;break e}else for(w=w.child;w!==null;)_.push(w,P),w=w.sibling}}v=!1}return v;case Vd:if(_.tag===5&&W(_.stateNode,v.value))return!0;break;case ah:if((_.tag===5||_.tag===6)&&(_=oe(_),_!==null&&0<=_.indexOf(v.value)))return!0;break;case nc:if(_.tag===5&&(_=_.memoizedProps["data-testname"],typeof _=="string"&&_.toLowerCase()===v.value.toLowerCase()))return!0;break;default:throw Error(l(365))}return!1}function Xd(_){switch(_.$$typeof){case Yo:return"<"+(F(_.value)||"Unknown")+">";case oh:return":has("+(Xd(_)||"")+")";case Vd:return'[role="'+_.value+'"]';case ah:return'"'+_.value+'"';case nc:return'[data-testname="'+_.value+'"]';default:throw Error(l(365))}}function am(_,v){var x=[];_=[_,0];for(var w=0;w<_.length;){var P=_[w++],V=_[w++],$e=v[V];if(P.tag!==5||!ee(P)){for(;$e!=null&&Wd(P,$e);)V++,$e=v[V];if(V===v.length)x.push(P);else for(P=P.child;P!==null;)_.push(P,V),P=P.sibling}}return x}function jd(_,v){if(!Ce)throw Error(l(363));_=zd(_),_=am(_,v),v=[],_=Array.from(_);for(var x=0;x<_.length;){var w=_[x++];if(w.tag===5)ee(w)||v.push(w.stateNode);else for(w=w.child;w!==null;)_.push(w),w=w.sibling}return v}var z_=Math.ceil,lh=u.ReactCurrentDispatcher,Yd=u.ReactCurrentOwner,zi=u.ReactCurrentBatchConfig,Rn=0,qi=null,Qi=null,Rr=0,Os=0,zc=Ot(0),lr=0,ch=null,ic=0,uh=0,Kd=0,Wc=null,ts=null,Jd=0,Zd=1/0;function ol(){Zd=ai()+500}var rc=!1,qd=null,al=null,hh=!1,Sa=null,dh=0,Xc=0,Qd=null,fh=-1,ph=0;function Gr(){return Rn&6?ai():fh!==-1?fh:fh=ai()}function $a(_){return _.mode&1?Rn&2&&Rr!==0?Rr&-Rr:Bo.transition!==null?(ph===0&&(_=ls,ls<<=1,!(ls&4194240)&&(ls=64),ph=_),ph):(_=sn,_!==0?_:Xe()):1}function Ls(_,v,x){if(50<Xc)throw Xc=0,Qd=null,Error(l(185));var w=ef(_,v);return w===null?null:(Qr(w,v,x),(!(Rn&2)||w!==qi)&&(w===qi&&(!(Rn&2)&&(uh|=v),lr===4&&ll(w,Rr)),ps(w,x),v===1&&Rn===0&&!(_.mode&1)&&(ol(),Ks&&Br())),w)}function ef(_,v){_.lanes|=v;var x=_.alternate;for(x!==null&&(x.lanes|=v),x=_,_=_.return;_!==null;)_.childLanes|=v,x=_.alternate,x!==null&&(x.childLanes|=v),x=_,_=_.return;return x.tag===3?x.stateNode:null}function ps(_,v){var x=_.callbackNode;dn(_,v);var w=hi(_,_===qi?Rr:0);if(w===0)x!==null&&Vi(x),_.callbackNode=null,_.callbackPriority=0;else if(v=w&-w,_.callbackPriority!==v){if(x!=null&&Vi(x),v===1)_.tag===0?Vl(X_.bind(null,_)):ma(X_.bind(null,_)),je?it(function(){Rn===0&&Br()}):cs(ws,Br),x=null;else{switch(Ei(w)){case 1:x=ws;break;case 4:x=Za;break;case 16:x=mr;break;case 536870912:x=qa;break;default:x=mr}x=sc(x,W_.bind(null,_))}_.callbackPriority=v,_.callbackNode=x}}function W_(_,v){if(fh=-1,ph=0,Rn&6)throw Error(l(327));var x=_.callbackNode;if(ul()&&_.callbackNode!==x)return null;var w=hi(_,_===qi?Rr:0);if(w===0)return null;if(w&30||w&_.expiredLanes||v)v=yt(_,w);else{v=w;var P=Rn;Rn|=2;var V=nf();(qi!==_||Rr!==v)&&(ol(),Ns(_,v));do try{ks();break}catch(Pe){VE(_,Pe)}while(1);_n(),lh.current=V,Rn=P,Qi!==null?v=0:(qi=null,Rr=0,v=lr)}if(v!==0){if(v===2&&(P=kr(_),P!==0&&(w=P,v=tf(_,P))),v===1)throw x=ch,Ns(_,0),ll(_,w),ps(_,ai()),x;if(v===6)ll(_,w);else{if(P=_.current.alternate,!(w&30)&&!HE(P)&&(v=yt(_,w),v===2&&(V=kr(_),V!==0&&(w=V,v=tf(_,V))),v===1))throw x=ch,Ns(_,0),ll(_,w),ps(_,ai()),x;switch(_.finishedWork=P,_.finishedLanes=w,v){case 0:case 1:throw Error(l(345));case 2:jc(_,ts);break;case 3:if(ll(_,w),(w&130023424)===w&&(v=Jd+500-ai(),10<v)){if(hi(_,0)!==0)break;if(P=_.suspendedLanes,(P&w)!==w){Gr(),_.pingedLanes|=_.suspendedLanes&P;break}_.timeoutHandle=Re(jc.bind(null,_,ts),v);break}jc(_,ts);break;case 4:if(ll(_,w),(w&4194240)===w)break;for(v=_.eventTimes,P=-1;0<w;){var $e=31-An(w);V=1<<$e,$e=v[$e],$e>P&&(P=$e),w&=~V}if(w=P,w=ai()-w,w=(120>w?120:480>w?480:1080>w?1080:1920>w?1920:3e3>w?3e3:4320>w?4320:1960*z_(w/1960))-w,10<w){_.timeoutHandle=Re(jc.bind(null,_,ts),w);break}jc(_,ts);break;case 5:jc(_,ts);break;default:throw Error(l(329))}}}return ps(_,ai()),_.callbackNode===x?W_.bind(null,_):null}function tf(_,v){var x=Wc;return _.current.memoizedState.isDehydrated&&(Ns(_,v).flags|=256),_=yt(_,v),_!==2&&(v=ts,ts=x,v!==null&&lm(v)),_}function lm(_){ts===null?ts=_:ts.push.apply(ts,_)}function HE(_){for(var v=_;;){if(v.flags&16384){var x=v.updateQueue;if(x!==null&&(x=x.stores,x!==null))for(var w=0;w<x.length;w++){var P=x[w],V=P.getSnapshot;P=P.value;try{if(!$r(V(),P))return!1}catch{return!1}}}if(x=v.child,v.subtreeFlags&16384&&x!==null)x.return=v,v=x;else{if(v===_)break;for(;v.sibling===null;){if(v.return===null||v.return===_)return!0;v=v.return}v.sibling.return=v.return,v=v.sibling}}return!0}function ll(_,v){for(v&=~Kd,v&=~uh,_.suspendedLanes|=v,_.pingedLanes&=~v,_=_.expirationTimes;0<v;){var x=31-An(v),w=1<<x;_[x]=-1,v&=~w}}function X_(_){if(Rn&6)throw Error(l(327));ul();var v=hi(_,0);if(!(v&1))return ps(_,ai()),null;var x=yt(_,v);if(_.tag!==0&&x===2){var w=kr(_);w!==0&&(v=w,x=tf(_,w))}if(x===1)throw x=ch,Ns(_,0),ll(_,v),ps(_,ai()),x;if(x===6)throw Error(l(345));return _.finishedWork=_.current.alternate,_.finishedLanes=v,jc(_,ts),ps(_,ai()),null}function j_(_){Sa!==null&&Sa.tag===0&&!(Rn&6)&&ul();var v=Rn;Rn|=1;var x=zi.transition,w=sn;try{if(zi.transition=null,sn=1,_)return _()}finally{sn=w,zi.transition=x,Rn=v,!(Rn&6)&&Br()}}function vt(){Os=zc.current,qt(zc)}function Ns(_,v){_.finishedWork=null,_.finishedLanes=0;var x=_.timeoutHandle;if(x!==et&&(_.timeoutHandle=et,De(x)),Qi!==null)for(x=Qi.return;x!==null;){var w=x;switch(yd(w),w.tag){case 1:w=w.type.childContextTypes,w!=null&&xn();break;case 3:yi(),qt(on),qt(Bn),Vu();break;case 5:Jl(w);break;case 4:yi();break;case 13:qt(gi);break;case 19:qt(gi);break;case 10:Qt(w.type._context);break;case 22:case 23:vt()}x=x.return}if(qi=_,Qi=_=to(_.current,null),Rr=Os=v,lr=0,ch=null,Kd=uh=ic=0,ts=Wc=null,br!==null){for(v=0;v<br.length;v++)if(x=br[v],w=x.interleaved,w!==null){x.interleaved=null;var P=w.next,V=x.pending;if(V!==null){var $e=V.next;V.next=P,w.next=$e}x.pending=w}br=null}return _}function VE(_,v){do{var x=Qi;try{if(_n(),Qa.current=Ju,Rd){for(var w=wi.memoizedState;w!==null;){var P=w.queue;P!==null&&(P.pending=null),w=w.next}Rd=!1}if(Eo=0,ar=Cr=wi=null,zu=!1,Wu=0,Yd.current=null,x===null||x.return===null){lr=1,ch=v,Qi=null;break}e:{var V=_,$e=x.return,Pe=x,ht=v;if(v=Rr,Pe.flags|=32768,ht!==null&&typeof ht=="object"&&typeof ht.then=="function"){var Rt=ht,Gt=Pe,En=Gt.tag;if(!(Gt.mode&1)&&(En===0||En===11||En===15)){var cn=Gt.alternate;cn?(Gt.updateQueue=cn.updateQueue,Gt.memoizedState=cn.memoizedState,Gt.lanes=cn.lanes):(Gt.updateQueue=null,Gt.memoizedState=null)}var _i=C_($e);if(_i!==null){_i.flags&=-257,x_(_i,$e,Pe,V,v),_i.mode&1&&zo(V,Rt,v),v=_i,ht=Rt;var Jt=v.updateQueue;if(Jt===null){var Wi=new Set;Wi.add(ht),v.updateQueue=Wi}else Jt.add(ht);break e}else{if(!(v&1)){zo(V,Rt,v),yo();break e}ht=Error(l(426))}}else if(Li&&Pe.mode&1){var ms=C_($e);if(ms!==null){!(ms.flags&65536)&&(ms.flags|=256),x_(ms,$e,Pe,V,v),zp(ht);break e}}V=ht,lr!==4&&(lr=2),Wc===null?Wc=[V]:Wc.push(V),ht=ec(ht,Pe),Pe=$e;do{switch(Pe.tag){case 3:Pe.flags|=65536,v&=-v,Pe.lanes|=v;var Qe=nl(Pe,ht,v);Fp(Pe,Qe);break e;case 1:V=ht;var He=Pe.type,ct=Pe.stateNode;if(!(Pe.flags&128)&&(typeof He.getDerivedStateFromError=="function"||ct!==null&&typeof ct.componentDidCatch=="function"&&(al===null||!al.has(ct)))){Pe.flags|=65536,v&=-v,Pe.lanes|=v;var Pt=Nd(Pe,V,v);Fp(Pe,Pt);break e}}Pe=Pe.return}while(Pe!==null)}K_(x)}catch(en){v=en,Qi===x&&x!==null&&(Qi=x=x.return);continue}break}while(1)}function nf(){var _=lh.current;return lh.current=Ju,_===null?Ju:_}function yo(){(lr===0||lr===3||lr===2)&&(lr=4),qi===null||!(ic&268435455)&&!(uh&268435455)||ll(qi,Rr)}function yt(_,v){var x=Rn;Rn|=2;var w=nf();qi===_&&Rr===v||Ns(_,v);do try{cl();break}catch(P){VE(_,P)}while(1);if(_n(),Rn=x,lh.current=w,Qi!==null)throw Error(l(261));return qi=null,Rr=0,lr}function cl(){for(;Qi!==null;)Y_(Qi)}function ks(){for(;Qi!==null&&!Gl();)Y_(Qi)}function Y_(_){var v=rf(_.alternate,_,Os);_.memoizedProps=_.pendingProps,v===null?K_(_):Qi=v,Yd.current=null}function K_(_){var v=_;do{var x=v.alternate;if(_=v.return,v.flags&32768){if(x=UE(x,v),x!==null){x.flags&=32767,Qi=x;return}if(_!==null)_.flags|=32768,_.subtreeFlags=0,_.deletions=null;else{lr=6,Qi=null;return}}else if(x=M_(x,v,Os),x!==null){Qi=x;return}if(v=v.sibling,v!==null){Qi=v;return}Qi=v=_}while(v!==null);lr===0&&(lr=5)}function jc(_,v){var x=sn,w=zi.transition;try{zi.transition=null,sn=1,J_(_,v,x)}finally{zi.transition=w,sn=x}return null}function J_(_,v,x){do ul();while(Sa!==null);if(Rn&6)throw Error(l(327));var w=_.finishedWork,P=_.finishedLanes;if(w===null)return null;if(_.finishedWork=null,_.finishedLanes=0,w===_.current)throw Error(l(177));_.callbackNode=null,_.callbackPriority=0;var V=w.lanes|w.childLanes;if(Pr(_,V),_===qi&&(Qi=qi=null,Rr=0),!(w.subtreeFlags&2064)&&!(w.flags&2064)||hh||(hh=!0,sc(mr,function(){return ul(),null})),V=(w.flags&15990)!==0,w.subtreeFlags&15990||V){V=zi.transition,zi.transition=null;var $e=sn;sn=1;var Pe=Rn;Rn|=4,Yd.current=null,GE(_,w),sh(_,w),K(_.containerInfo),_.current=w,G_(w),Dr(),Rn=Pe,sn=$e,zi.transition=V}else _.current=w;if(hh&&(hh=!1,Sa=_,dh=P),V=_.pendingLanes,V===0&&(al=null),_o(w.stateNode),ps(_,ai()),v!==null)for(x=_.onRecoverableError,w=0;w<v.length;w++)x(v[w]);if(rc)throw rc=!1,_=qd,qd=null,_;return dh&1&&_.tag!==0&&ul(),V=_.pendingLanes,V&1?_===Qd?Xc++:(Xc=0,Qd=_):Xc=0,Br(),null}function ul(){if(Sa!==null){var _=Ei(dh),v=zi.transition,x=sn;try{if(zi.transition=null,sn=16>_?16:_,Sa===null)var w=!1;else{if(_=Sa,Sa=null,dh=0,Rn&6)throw Error(l(331));var P=Rn;for(Rn|=4,kt=_.current;kt!==null;){var V=kt,$e=V.child;if(kt.flags&16){var Pe=V.deletions;if(Pe!==null){for(var ht=0;ht<Pe.length;ht++){var Rt=Pe[ht];for(kt=Rt;kt!==null;){var Gt=kt;switch(Gt.tag){case 0:case 11:case 15:sl(8,Gt,V)}var En=Gt.child;if(En!==null)En.return=Gt,kt=En;else for(;kt!==null;){Gt=kt;var cn=Gt.sibling,_i=Gt.return;if(nm(Gt),Gt===Rt){kt=null;break}if(cn!==null){cn.return=_i,kt=cn;break}kt=_i}}}var Jt=V.alternate;if(Jt!==null){var Wi=Jt.child;if(Wi!==null){Jt.child=null;do{var ms=Wi.sibling;Wi.sibling=null,Wi=ms}while(Wi!==null)}}kt=V}}if(V.subtreeFlags&2064&&$e!==null)$e.return=V,kt=$e;else e:for(;kt!==null;){if(V=kt,V.flags&2048)switch(V.tag){case 0:case 11:case 15:sl(9,V,V.return)}var Qe=V.sibling;if(Qe!==null){Qe.return=V.return,kt=Qe;break e}kt=V.return}}var He=_.current;for(kt=He;kt!==null;){$e=kt;var ct=$e.child;if($e.subtreeFlags&2064&&ct!==null)ct.return=$e,kt=ct;else e:for($e=He;kt!==null;){if(Pe=kt,Pe.flags&2048)try{switch(Pe.tag){case 0:case 11:case 15:nh(9,Pe)}}catch(en){Hr(Pe,Pe.return,en)}if(Pe===$e){kt=null;break e}var Pt=Pe.sibling;if(Pt!==null){Pt.return=Pe.return,kt=Pt;break e}kt=Pe.return}}if(Rn=P,Br(),Ii&&typeof Ii.onPostCommitFiberRoot=="function")try{Ii.onPostCommitFiberRoot(Ri,_)}catch{}w=!0}return w}finally{sn=x,zi.transition=v}}return!1}function Yc(_,v,x){v=ec(x,v),v=nl(_,v,1),ga(_,v),v=Gr(),_=ef(_,1),_!==null&&(Qr(_,1,v),ps(_,v))}function Hr(_,v,x){if(_.tag===3)Yc(_,_,x);else for(;v!==null;){if(v.tag===3){Yc(v,_,x);break}else if(v.tag===1){var w=v.stateNode;if(typeof v.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(al===null||!al.has(w))){_=ec(x,_),_=Nd(v,_,1),ga(v,_),_=Gr(),v=ef(v,1),v!==null&&(Qr(v,1,_),ps(v,_));break}}v=v.return}}function Kc(_,v,x){var w=_.pingCache;w!==null&&w.delete(v),v=Gr(),_.pingedLanes|=_.suspendedLanes&x,qi===_&&(Rr&x)===x&&(lr===4||lr===3&&(Rr&130023424)===Rr&&500>ai()-Jd?Ns(_,0):Kd|=x),ps(_,v)}function ba(_,v){v===0&&(_.mode&1?(v=Ys,Ys<<=1,!(Ys&130023424)&&(Ys=4194304)):v=1);var x=Gr();_=ef(_,v),_!==null&&(Qr(_,v,x),ps(_,x))}function Jc(_){var v=_.memoizedState,x=0;v!==null&&(x=v.retryLane),ba(_,x)}function mh(_,v){var x=0;switch(_.tag){case 13:var w=_.stateNode,P=_.memoizedState;P!==null&&(x=P.retryLane);break;case 19:w=_.stateNode;break;default:throw Error(l(314))}w!==null&&w.delete(v),ba(_,x)}var rf;rf=function(_,v,x){if(_!==null)if(_.memoizedProps!==v.pendingProps||on.current)ds=!0;else{if(!(_.lanes&x)&&!(v.flags&128))return ds=!1,D_(_,v,x);ds=!!(_.flags&131072)}else ds=!1,Li&&v.flags&1048576&&kc(v,Nc,v.index);switch(v.lanes=0,v.tag){case 2:var w=v.type;_!==null&&(_.alternate=null,v.alternate=null,v.flags|=2),_=v.pendingProps;var P=tn(v,Bn.current);li(v,x),P=Bc(null,v,w,_,P,x);var V=Xp();return v.flags|=1,typeof P=="object"&&P!==null&&typeof P.render=="function"&&P.$$typeof===void 0?(v.tag=1,v.memoizedState=null,v.updateQueue=null,Fn(w)?(V=!0,Mn(v)):V=!1,v.memoizedState=P.state!==null&&P.state!==void 0?P.state:null,Ic(v),P.updater=Oc,v.stateNode=P,P._reactInternals=v,Lc(v,w,_,x),v=Zi(null,v,w,!0,V,x)):(v.tag=0,Li&&V&&Ed(v),xr(null,v,P,x),v=v.child),v;case 16:w=v.elementType;e:{switch(_!==null&&(_.alternate=null,v.alternate=null,v.flags|=2),_=v.pendingProps,P=w._init,w=P(w._payload),v.type=w,P=v.tag=Aa(w),_=Oi(w,_),P){case 0:v=zt(null,v,w,_,x);break e;case 1:v=fs(null,v,w,_,x);break e;case 11:v=I_(null,v,w,_,x);break e;case 14:v=O_(null,v,w,Oi(w.type,_),x);break e}throw Error(l(306,w,""))}return v;case 0:return w=v.type,P=v.pendingProps,P=v.elementType===w?P:Oi(w,P),zt(_,v,w,P,x);case 1:return w=v.type,P=v.pendingProps,P=v.elementType===w?P:Oi(w,P),fs(_,v,w,P,x);case 3:e:{if(Si(v),_===null)throw Error(l(387));w=v.pendingProps,V=v.memoizedState,P=V.element,Bp(_,v),vd(v,w,null,x);var $e=v.memoizedState;if(w=$e.element,Ye&&V.isDehydrated)if(V={element:w,isDehydrated:!1,cache:$e.cache,transitions:$e.transitions},v.updateQueue.baseState=V,v.memoizedState=V,v.flags&256){P=Error(l(423)),v=Xo(_,v,w,x,P);break e}else if(w!==P){P=Error(l(424)),v=Xo(_,v,w,x,P);break e}else for(Ye&&(es=mi(v.stateNode.containerInfo),Ar=v,Li=!0,qs=null,Uu=!1),x=Hu(v,null,w,x),v.child=x;x;)x.flags=x.flags&-3|4096,x=x.sibling;else{if(Pc(),w===P){v=jo(_,v,x);break e}xr(_,v,w,x)}v=v.child}return v;case 5:return h_(v),_===null&&$d(v),w=v.type,P=v.pendingProps,V=_!==null?_.memoizedProps:null,$e=P.children,Te(w,P)?$e=null:V!==null&&Te(w,V)&&(v.flags|=32),il(_,v),xr(_,v,$e,x),v.child;case 6:return _===null&&$d(v),null;case 13:return Di(_,v,x);case 4:return Ad(v,v.stateNode.containerInfo),w=v.pendingProps,_===null?v.child=To(v,null,w,x):xr(_,v,w,x),v.child;case 11:return w=v.type,P=v.pendingProps,P=v.elementType===w?P:Oi(w,P),I_(_,v,w,P,x);case 7:return xr(_,v,v.pendingProps,x),v.child;case 8:return xr(_,v,v.pendingProps.children,x),v.child;case 12:return xr(_,v,v.pendingProps.children,x),v.child;case 10:e:{if(w=v.type._context,P=v.pendingProps,V=v.memoizedProps,$e=P.value,fn(v,w,$e),V!==null)if($r(V.value,$e)){if(V.children===P.children&&!on.current){v=jo(_,v,x);break e}}else for(V=v.child,V!==null&&(V.return=v);V!==null;){var Pe=V.dependencies;if(Pe!==null){$e=V.child;for(var ht=Pe.firstContext;ht!==null;){if(ht.context===w){if(V.tag===1){ht=Fo(-1,x&-x),ht.tag=2;var Rt=V.updateQueue;if(Rt!==null){Rt=Rt.shared;var Gt=Rt.pending;Gt===null?ht.next=ht:(ht.next=Gt.next,Gt.next=ht),Rt.pending=ht}}V.lanes|=x,ht=V.alternate,ht!==null&&(ht.lanes|=x),yn(V.return,x,v),Pe.lanes|=x;break}ht=ht.next}}else if(V.tag===10)$e=V.type===v.type?null:V.child;else if(V.tag===18){if($e=V.return,$e===null)throw Error(l(341));$e.lanes|=x,Pe=$e.alternate,Pe!==null&&(Pe.lanes|=x),yn($e,x,v),$e=V.sibling}else $e=V.child;if($e!==null)$e.return=V;else for($e=V;$e!==null;){if($e===v){$e=null;break}if(V=$e.sibling,V!==null){V.return=$e.return,$e=V;break}$e=$e.return}V=$e}xr(_,v,P.children,x),v=v.child}return v;case 9:return P=v.type,w=v.pendingProps.children,li(v,x),P=ci(P),w=w(P),v.flags|=1,xr(_,v,w,x),v.child;case 14:return w=v.type,P=Oi(w,v.pendingProps),P=Oi(w.type,P),O_(_,v,w,P,x);case 15:return L_(_,v,v.type,v.pendingProps,x);case 17:return w=v.type,P=v.pendingProps,P=v.elementType===w?P:Oi(w,P),_!==null&&(_.alternate=null,v.alternate=null,v.flags|=2),v.tag=1,Fn(w)?(_=!0,Mn(v)):_=!1,li(v,x),Gp(v,w,P),Lc(v,w,P,x),Zi(null,v,w,!0,_,x);case 19:return Bd(_,v,x);case 22:return N_(_,v,x)}throw Error(l(156,v.tag))};function sc(_,v){return cs(_,v)}function gh(_,v,x,w){this.tag=_,this.key=x,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=v,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function cr(_,v,x,w){return new gh(_,v,x,w)}function oc(_){return _=_.prototype,!(!_||!_.isReactComponent)}function Aa(_){if(typeof _=="function")return oc(_)?1:0;if(_!=null){if(_=_.$$typeof,_===b)return 11;if(_===A)return 14}return 2}function to(_,v){var x=_.alternate;return x===null?(x=cr(_.tag,v,_.key,_.mode),x.elementType=_.elementType,x.type=_.type,x.stateNode=_.stateNode,x.alternate=_,_.alternate=x):(x.pendingProps=v,x.type=_.type,x.flags=0,x.subtreeFlags=0,x.deletions=null),x.flags=_.flags&14680064,x.childLanes=_.childLanes,x.lanes=_.lanes,x.child=_.child,x.memoizedProps=_.memoizedProps,x.memoizedState=_.memoizedState,x.updateQueue=_.updateQueue,v=_.dependencies,x.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext},x.sibling=_.sibling,x.index=_.index,x.ref=_.ref,x}function hl(_,v,x,w,P,V){var $e=2;if(w=_,typeof _=="function")oc(_)&&($e=1);else if(typeof _=="string")$e=5;else e:switch(_){case f:return So(x.children,P,V,v);case p:$e=8,P|=8;break;case m:return _=cr(12,x,v,P|2),_.elementType=m,_.lanes=V,_;case y:return _=cr(13,x,v,P),_.elementType=y,_.lanes=V,_;case S:return _=cr(19,x,v,P),_.elementType=S,_.lanes=V,_;case R:return Ko(x,P,V,v);default:if(typeof _=="object"&&_!==null)switch(_.$$typeof){case T:$e=10;break e;case E:$e=9;break e;case b:$e=11;break e;case A:$e=14;break e;case C:$e=16,w=null;break e}throw Error(l(130,_==null?_:typeof _,""))}return v=cr($e,x,v,P),v.elementType=_,v.type=w,v.lanes=V,v}function So(_,v,x,w){return _=cr(7,_,w,v),_.lanes=x,_}function Ko(_,v,x,w){return _=cr(22,_,w,v),_.elementType=R,_.lanes=x,_.stateNode={},_}function Jo(_,v,x){return _=cr(6,_,null,v),_.lanes=x,_}function ac(_,v,x){return v=cr(4,_.children!==null?_.children:[],_.key,v),v.lanes=x,v.stateNode={containerInfo:_.containerInfo,pendingChildren:null,implementation:_.implementation},v}function _h(_,v,x,w,P){this.tag=v,this.containerInfo=_,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=et,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=jn(0),this.expirationTimes=jn(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jn(0),this.identifierPrefix=w,this.onRecoverableError=P,Ye&&(this.mutableSourceEagerHydrationData=null)}function Ca(_,v,x,w,P,V,$e,Pe,ht){return _=new _h(_,v,x,Pe,ht),v===1?(v=1,V===!0&&(v|=8)):v=0,V=cr(3,null,null,v),_.current=V,V.stateNode=_,V.memoizedState={element:w,isDehydrated:x,cache:null,transitions:null},Ic(V),_}function vh(_){if(!_)return ln;_=_._reactInternals;e:{if(D(_)!==_||_.tag!==1)throw Error(l(170));var v=_;do{switch(v.tag){case 3:v=v.stateNode.context;break e;case 1:if(Fn(v.type)){v=v.stateNode.__reactInternalMemoizedMergedChildContext;break e}}v=v.return}while(v!==null);throw Error(l(171))}if(_.tag===1){var x=_.type;if(Fn(x))return zn(_,x,v)}return v}function lc(_){var v=_._reactInternals;if(v===void 0)throw typeof _.render=="function"?Error(l(188)):(_=Object.keys(_).join(","),Error(l(268,_)));return _=ie(v),_===null?null:_.stateNode}function sf(_,v){if(_=_.memoizedState,_!==null&&_.dehydrated!==null){var x=_.retryLane;_.retryLane=x!==0&&x<v?x:v}}function Th(_,v){sf(_,v),(_=_.alternate)&&sf(_,v)}function Zc(_){return _=ie(_),_===null?null:_.stateNode}function cm(){return null}return n.attemptContinuousHydration=function(_){if(_.tag===13){var v=Gr();Ls(_,134217728,v),Th(_,134217728)}},n.attemptHydrationAtCurrentPriority=function(_){if(_.tag===13){var v=Gr(),x=$a(_);Ls(_,x,v),Th(_,x)}},n.attemptSynchronousHydration=function(_){switch(_.tag){case 3:var v=_.stateNode;if(v.current.memoizedState.isDehydrated){var x=xs(v.pendingLanes);x!==0&&(ti(v,x|1),ps(v,ai()),!(Rn&6)&&(ol(),Br()))}break;case 13:var w=Gr();j_(function(){return Ls(_,1,w)}),Th(_,1)}},n.batchedUpdates=function(_,v){var x=Rn;Rn|=1;try{return _(v)}finally{Rn=x,Rn===0&&(ol(),Ks&&Br())}},n.createComponentSelector=function(_){return{$$typeof:Yo,value:_}},n.createContainer=function(_,v,x,w,P,V,$e){return Ca(_,v,!1,null,x,w,P,V,$e)},n.createHasPseudoClassSelector=function(_){return{$$typeof:oh,value:_}},n.createHydrationContainer=function(_,v,x,w,P,V,$e,Pe,ht){return _=Ca(x,w,!0,_,P,V,$e,Pe,ht),_.context=vh(null),x=_.current,w=Gr(),P=$a(x),V=Fo(w,P),V.callback=v??null,ga(x,V),_.current.lanes=P,Qr(_,P,w),ps(_,w),_},n.createPortal=function(_,v,x){var w=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:h,key:w==null?null:""+w,children:_,containerInfo:v,implementation:x}},n.createRoleSelector=function(_){return{$$typeof:Vd,value:_}},n.createTestNameSelector=function(_){return{$$typeof:nc,value:_}},n.createTextSelector=function(_){return{$$typeof:ah,value:_}},n.deferredUpdates=function(_){var v=sn,x=zi.transition;try{return zi.transition=null,sn=16,_()}finally{sn=v,zi.transition=x}},n.discreteUpdates=function(_,v,x,w,P){var V=sn,$e=zi.transition;try{return zi.transition=null,sn=1,_(v,x,w,P)}finally{sn=V,zi.transition=$e,Rn===0&&ol()}},n.findAllNodes=jd,n.findBoundingRects=function(_,v){if(!Ce)throw Error(l(363));v=jd(_,v),_=[];for(var x=0;x<v.length;x++)_.push(St(v[x]));for(v=_.length-1;0<v;v--){x=_[v];for(var w=x.x,P=w+x.width,V=x.y,$e=V+x.height,Pe=v-1;0<=Pe;Pe--)if(v!==Pe){var ht=_[Pe],Rt=ht.x,Gt=Rt+ht.width,En=ht.y,cn=En+ht.height;if(w>=Rt&&V>=En&&P<=Gt&&$e<=cn){_.splice(v,1);break}else if(w!==Rt||x.width!==ht.width||cn<V||En>$e){if(!(V!==En||x.height!==ht.height||Gt<w||Rt>P)){Rt>w&&(ht.width+=Rt-w,ht.x=w),Gt<P&&(ht.width=P-Rt),_.splice(v,1);break}}else{En>V&&(ht.height+=En-V,ht.y=V),cn<$e&&(ht.height=$e-En),_.splice(v,1);break}}}return _},n.findHostInstance=lc,n.findHostInstanceWithNoPortals=function(_){return _=ce(_),_=_!==null?ne(_):null,_===null?null:_.stateNode},n.findHostInstanceWithWarning=function(_){return lc(_)},n.flushControlled=function(_){var v=Rn;Rn|=1;var x=zi.transition,w=sn;try{zi.transition=null,sn=1,_()}finally{sn=w,zi.transition=x,Rn=v,Rn===0&&(ol(),Br())}},n.flushPassiveEffects=ul,n.flushSync=j_,n.focusWithin=function(_,v){if(!Ce)throw Error(l(363));for(_=zd(_),v=am(_,v),v=Array.from(v),_=0;_<v.length;){var x=v[_++];if(!ee(x)){if(x.tag===5&&ot(x.stateNode))return!0;for(x=x.child;x!==null;)v.push(x),x=x.sibling}}return!1},n.getCurrentUpdatePriority=function(){return sn},n.getFindAllNodesFailureDescription=function(_,v){if(!Ce)throw Error(l(363));var x=0,w=[];_=[zd(_),0];for(var P=0;P<_.length;){var V=_[P++],$e=_[P++],Pe=v[$e];if((V.tag!==5||!ee(V))&&(Wd(V,Pe)&&(w.push(Xd(Pe)),$e++,$e>x&&(x=$e)),$e<v.length))for(V=V.child;V!==null;)_.push(V,$e),V=V.sibling}if(x<v.length){for(_=[];x<v.length;x++)_.push(Xd(v[x]));return`findAllNodes was able to match part of the selector:
  `+(w.join(" > ")+`

No matching component was found for:
  `)+_.join(" > ")}return null},n.getPublicRootInstance=function(_){if(_=_.current,!_.child)return null;switch(_.child.tag){case 5:return de(_.child.stateNode);default:return _.child.stateNode}},n.injectIntoDevTools=function(_){if(_={bundleType:_.bundleType,version:_.version,rendererPackageName:_.rendererPackageName,rendererConfig:_.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:u.ReactCurrentDispatcher,findHostInstanceByFiber:Zc,findFiberByHostInstance:_.findFiberByHostInstance||cm,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")_=!1;else{var v=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(v.isDisabled||!v.supportsFiber)_=!0;else{try{Ri=v.inject(_),Ii=v}catch{}_=!!v.checkDCE}}return _},n.isAlreadyRendering=function(){return!1},n.observeVisibleRects=function(_,v,x,w){if(!Ce)throw Error(l(363));_=jd(_,v);var P=ze(_,x,w).disconnect;return{disconnect:function(){P()}}},n.registerMutableSourceForHydration=function(_,v){var x=v._getVersion;x=x(v._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[v,x]:_.mutableSourceEagerHydrationData.push(v,x)},n.runWithPriority=function(_,v){var x=sn;try{return sn=_,v()}finally{sn=x}},n.shouldError=function(){return null},n.shouldSuspend=function(){return!1},n.updateContainer=function(_,v,x,w){var P=v.current,V=Gr(),$e=$a(P);return x=vh(x),v.context===null?v.context=x:v.pendingContext=x,v=Fo(V,$e),v.payload={element:_},w=w===void 0?null:w,w!==null&&(v.callback=w),ga(P,v),_=Ls(P,$e,V),_!==null&&Du(_,P,$e),$e},n};yU.exports=_9;var v9=yU.exports;const T9=hd(v9);var SU={exports:{}},$U={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(H,J){var K=H.length;H.push(J);e:for(;0<K;){var se=K-1>>>1,Y=H[se];if(0<s(Y,J))H[se]=J,H[K]=Y,K=se;else break e}}function n(H){return H.length===0?null:H[0]}function r(H){if(H.length===0)return null;var J=H[0],K=H.pop();if(K!==J){H[0]=K;e:for(var se=0,Y=H.length,he=Y>>>1;se<he;){var ue=2*(se+1)-1,Te=H[ue],_e=ue+1,Re=H[_e];if(0>s(Te,K))_e<Y&&0>s(Re,Te)?(H[se]=Re,H[_e]=K,se=_e):(H[se]=Te,H[ue]=K,se=ue);else if(_e<Y&&0>s(Re,K))H[se]=Re,H[_e]=K,se=_e;else break e}}return J}function s(H,J){var K=H.sortIndex-J.sortIndex;return K!==0?K:H.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;i.unstable_now=function(){return a.now()}}else{var l=Date,u=l.now();i.unstable_now=function(){return l.now()-u}}var d=[],h=[],f=1,p=null,m=3,T=!1,E=!1,b=!1,y=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(H){for(var J=n(h);J!==null;){if(J.callback===null)r(h);else if(J.startTime<=H)r(h),J.sortIndex=J.expirationTime,e(d,J);else break;J=n(h)}}function R(H){if(b=!1,C(H),!E)if(n(d)!==null)E=!0,de(I);else{var J=n(h);J!==null&&xe(R,J.startTime-H)}}function I(H,J){E=!1,b&&(b=!1,S(k),k=-1),T=!0;var K=m;try{for(C(J),p=n(d);p!==null&&(!(p.expirationTime>J)||H&&!ce());){var se=p.callback;if(typeof se=="function"){p.callback=null,m=p.priorityLevel;var Y=se(p.expirationTime<=J);J=i.unstable_now(),typeof Y=="function"?p.callback=Y:p===n(d)&&r(d),C(J)}else r(d);p=n(d)}if(p!==null)var he=!0;else{var ue=n(h);ue!==null&&xe(R,ue.startTime-J),he=!1}return he}finally{p=null,m=K,T=!1}}var O=!1,F=null,k=-1,D=5,U=-1;function ce(){return!(i.unstable_now()-U<D)}function ie(){if(F!==null){var H=i.unstable_now();U=H;var J=!0;try{J=F(!0,H)}finally{J?ae():(O=!1,F=null)}}else O=!1}var ae;if(typeof A=="function")ae=function(){A(ie)};else if(typeof MessageChannel<"u"){var ne=new MessageChannel,pe=ne.port2;ne.port1.onmessage=ie,ae=function(){pe.postMessage(null)}}else ae=function(){y(ie,0)};function de(H){F=H,O||(O=!0,ae())}function xe(H,J){k=y(function(){H(i.unstable_now())},J)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(H){H.callback=null},i.unstable_continueExecution=function(){E||T||(E=!0,de(I))},i.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<H?Math.floor(1e3/H):5},i.unstable_getCurrentPriorityLevel=function(){return m},i.unstable_getFirstCallbackNode=function(){return n(d)},i.unstable_next=function(H){switch(m){case 1:case 2:case 3:var J=3;break;default:J=m}var K=m;m=J;try{return H()}finally{m=K}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(H,J){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var K=m;m=H;try{return J()}finally{m=K}},i.unstable_scheduleCallback=function(H,J,K){var se=i.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?se+K:se):K=se,H){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=K+Y,H={id:f++,callback:J,priorityLevel:H,startTime:K,expirationTime:Y,sortIndex:-1},K>se?(H.sortIndex=K,e(h,H),n(d)===null&&H===n(h)&&(b?(S(k),k=-1):b=!0,xe(R,K-se))):(H.sortIndex=Y,e(d,H),E||T||(E=!0,de(I))),H},i.unstable_shouldYield=ce,i.unstable_wrapCallback=function(H){var J=m;return function(){var K=m;m=J;try{return H.apply(this,arguments)}finally{m=K}}}})($U);SU.exports=$U;var rk=SU.exports;function bU(i,e,n=(r,s)=>r===s){if(i===e)return!0;if(!i||!e)return!1;const r=i.length;if(e.length!==r)return!1;for(let s=0;s<r;s++)if(!n(i[s],e[s]))return!1;return!0}const Su=[];function AU(i,e,n=!1,r={}){for(const a of Su)if(bU(e,a.keys,a.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(a,"error"))throw a.error;if(Object.prototype.hasOwnProperty.call(a,"response"))return a.response;if(!n)throw a.promise}const s={keys:e,equal:r.equal,promise:i(...e).then(a=>s.response=a).then(()=>{r.lifespan&&r.lifespan>0&&setTimeout(()=>{const a=Su.indexOf(s);a!==-1&&Su.splice(a,1)},r.lifespan)}).catch(a=>s.error=a)};if(Su.push(s),!n)throw s.promise}const E9=(i,e,n)=>AU(i,e,!1,n),y9=(i,e,n)=>void AU(i,e,!0,n),S9=i=>{if(i===void 0||i.length===0)Su.splice(0,Su.length);else{const e=Su.find(n=>bU(i,n.keys,n.equal));if(e){const n=Su.indexOf(e);n!==-1&&Su.splice(n,1)}}},XM={},CU=i=>void Object.assign(XM,i);function $9(i,e){function n(f,{args:p=[],attach:m,...T},E){let b=`${f[0].toUpperCase()}${f.slice(1)}`,y;if(f==="primitive"){if(T.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const S=T.object;y=sg(S,{type:f,root:E,attach:m,primitive:!0})}else{const S=XM[b];if(!S)throw new Error(`R3F: ${b} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(p))throw new Error("R3F: The args prop must be an array!");y=sg(new S(...p),{type:f,root:E,attach:m,memoizedProps:{args:p}})}return y.__r3f.attach===void 0&&(y instanceof rn?y.__r3f.attach="geometry":y instanceof rr&&(y.__r3f.attach="material")),b!=="inject"&&FC(y,T),y}function r(f,p){let m=!1;if(p){var T,E;(T=p.__r3f)!=null&&T.attach?BC(f,p,p.__r3f.attach):p.isObject3D&&f.isObject3D&&(f.add(p),m=!0),m||(E=f.__r3f)==null||E.objects.push(p),p.__r3f||sg(p,{}),p.__r3f.parent=f,XR(p),og(p)}}function s(f,p,m){let T=!1;if(p){var E,b;if((E=p.__r3f)!=null&&E.attach)BC(f,p,p.__r3f.attach);else if(p.isObject3D&&f.isObject3D){p.parent=f,p.dispatchEvent({type:"added"});const y=f.children.filter(A=>A!==p),S=y.indexOf(m);f.children=[...y.slice(0,S),p,...y.slice(S)],T=!0}T||(b=f.__r3f)==null||b.objects.push(p),p.__r3f||sg(p,{}),p.__r3f.parent=f,XR(p),og(p)}}function a(f,p,m=!1){f&&[...f].forEach(T=>l(p,T,m))}function l(f,p,m){if(p){var T,E,b;if(p.__r3f&&(p.__r3f.parent=null),(T=f.__r3f)!=null&&T.objects&&(f.__r3f.objects=f.__r3f.objects.filter(R=>R!==p)),(E=p.__r3f)!=null&&E.attach)ck(f,p,p.__r3f.attach);else if(p.isObject3D&&f.isObject3D){var y;f.remove(p),(y=p.__r3f)!=null&&y.root&&M9(p.__r3f.root,p)}const A=(b=p.__r3f)==null?void 0:b.primitive,C=m===void 0?p.dispose!==null&&!A:m;if(!A){var S;a((S=p.__r3f)==null?void 0:S.objects,p,C),a(p.children,p,C)}p.__r3f&&(delete p.__r3f.root,delete p.__r3f.objects,delete p.__r3f.handlers,delete p.__r3f.memoizedProps,A||delete p.__r3f),C&&p.dispose&&p.type!=="Scene"&&rk.unstable_scheduleCallback(rk.unstable_IdlePriority,()=>{try{p.dispose()}catch{}}),og(f)}}function u(f,p,m,T){var E;const b=(E=f.__r3f)==null?void 0:E.parent;if(!b)return;const y=n(p,m,f.__r3f.root);if(f.children){for(const S of f.children)S.__r3f&&r(y,S);f.children=f.children.filter(S=>!S.__r3f)}f.__r3f.objects.forEach(S=>r(y,S)),f.__r3f.objects=[],f.__r3f.autoRemovedBeforeAppend||l(b,f),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),r(b,y),y.raycast&&y.__r3f.eventCount&&y.__r3f.root.getState().internal.interaction.push(y),[T,T.alternate].forEach(S=>{S!==null&&(S.stateNode=y,S.ref&&(typeof S.ref=="function"?S.ref(y):S.ref.current=y))})}const d=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:T9({createInstance:n,removeChild:l,appendChild:r,appendInitialChild:r,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(f,p)=>{if(!p)return;const m=f.getState().scene;m.__r3f&&(m.__r3f.root=f,r(m,p))},removeChildFromContainer:(f,p)=>{p&&l(f.getState().scene,p)},insertInContainerBefore:(f,p,m)=>{if(!p||!m)return;const T=f.getState().scene;T.__r3f&&s(T,p,m)},getRootHostContext:()=>null,getChildHostContext:f=>f,finalizeInitialChildren(f){var p;return!!((p=f==null?void 0:f.__r3f)!=null?p:{}).handlers},prepareUpdate(f,p,m,T){if(f.__r3f.primitive&&T.object&&T.object!==f)return[!0];{const{args:E=[],children:b,...y}=T,{args:S=[],children:A,...C}=m;if(!Array.isArray(E))throw new Error("R3F: the args prop must be an array!");if(E.some((I,O)=>I!==S[O]))return[!0];const R=LU(f,y,C,!0);return R.changes.length?[!1,R]:null}},commitUpdate(f,[p,m],T,E,b,y){p?u(f,T,b,y):FC(f,m)},commitMount(f,p,m,T){var E;const b=(E=f.__r3f)!=null?E:{};f.raycast&&b.handlers&&b.eventCount&&f.__r3f.root.getState().internal.interaction.push(f)},getPublicInstance:f=>f,prepareForCommit:()=>null,preparePortalMount:f=>sg(f.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(f){var p;const{attach:m,parent:T}=(p=f.__r3f)!=null?p:{};m&&T&&ck(T,f,m),f.isObject3D&&(f.visible=!1),og(f)},unhideInstance(f,p){var m;const{attach:T,parent:E}=(m=f.__r3f)!=null?m:{};T&&E&&BC(E,f,T),(f.isObject3D&&p.visible==null||p.visible)&&(f.visible=!0),og(f)},createTextInstance:d,hideTextInstance:d,unhideTextInstance:d,getCurrentEventPriority:()=>e?e():Ag.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&Fi.fun(performance.now)?performance.now:Fi.fun(Date.now)?Date.now:()=>0,scheduleTimeout:Fi.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Fi.fun(clearTimeout)?clearTimeout:void 0}),applyProps:FC}}var sk,ok;const xU=()=>{var i;return(i=XM.ColorManagement)!=null?i:null},RU=i=>i&&i.isOrthographicCamera,b9=i=>i&&i.hasOwnProperty("current"),kE=typeof window<"u"&&((sk=window.document)!=null&&sk.createElement||((ok=window.navigator)==null?void 0:ok.product)==="ReactNative")?q.useLayoutEffect:q.useEffect;function wU(i){const e=q.useRef(i);return kE(()=>void(e.current=i),[i]),e}function A9({set:i}){return kE(()=>(i(new Promise(()=>null)),()=>i(!1)),[i]),null}class MU extends q.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}MU.getDerivedStateFromError=()=>({error:!0});const IU="__default",ak=new Map,C9=i=>i&&!!i.memoized&&!!i.changes;function OU(i){const e=typeof window<"u"?window.devicePixelRatio:1;return Array.isArray(i)?Math.min(Math.max(i[0],e),i[1]):i}const Wv=i=>{var e;return(e=i.__r3f)==null?void 0:e.root.getState()},Fi={obj:i=>i===Object(i)&&!Fi.arr(i)&&typeof i!="function",fun:i=>typeof i=="function",str:i=>typeof i=="string",num:i=>typeof i=="number",boo:i=>typeof i=="boolean",und:i=>i===void 0,arr:i=>Array.isArray(i),equ(i,e,{arrays:n="shallow",objects:r="reference",strict:s=!0}={}){if(typeof i!=typeof e||!!i!=!!e)return!1;if(Fi.str(i)||Fi.num(i))return i===e;const a=Fi.obj(i);if(a&&r==="reference")return i===e;const l=Fi.arr(i);if(l&&n==="reference")return i===e;if((l||a)&&i===e)return!0;let u;for(u in i)if(!(u in e))return!1;if(a&&n==="shallow"&&r==="shallow"){for(u in s?e:i)if(!Fi.equ(i[u],e[u],{strict:s,objects:"reference"}))return!1}else for(u in s?e:i)if(i[u]!==e[u])return!1;if(Fi.und(u)){if(l&&i.length===0&&e.length===0||a&&Object.keys(i).length===0&&Object.keys(e).length===0)return!0;if(i!==e)return!1}return!0}};function x9(i){const e={nodes:{},materials:{}};return i&&i.traverse(n=>{n.name&&(e.nodes[n.name]=n),n.material&&!e.materials[n.material.name]&&(e.materials[n.material.name]=n.material)}),e}function R9(i){i.dispose&&i.type!=="Scene"&&i.dispose();for(const e in i)e.dispose==null||e.dispose(),delete i[e]}function sg(i,e){const n=i;return(e!=null&&e.primitive||!n.__r3f)&&(n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e}),i}function WR(i,e){let n=i;if(e.includes("-")){const r=e.split("-"),s=r.pop();return n=r.reduce((a,l)=>a[l],i),{target:n,key:s}}else return{target:n,key:e}}const lk=/-\d+$/;function BC(i,e,n){if(Fi.str(n)){if(lk.test(n)){const a=n.replace(lk,""),{target:l,key:u}=WR(i,a);Array.isArray(l[u])||(l[u]=[])}const{target:r,key:s}=WR(i,n);e.__r3f.previousAttach=r[s],r[s]=e}else e.__r3f.previousAttach=n(i,e)}function ck(i,e,n){var r,s;if(Fi.str(n)){const{target:a,key:l}=WR(i,n),u=e.__r3f.previousAttach;u===void 0?delete a[l]:a[l]=u}else(r=e.__r3f)==null||r.previousAttach==null||r.previousAttach(i,e);(s=e.__r3f)==null||delete s.previousAttach}function LU(i,{children:e,key:n,ref:r,...s},{children:a,key:l,ref:u,...d}={},h=!1){var f;const p=(f=i==null?void 0:i.__r3f)!=null?f:{},m=Object.entries(s),T=[];if(h){const b=Object.keys(d);for(let y=0;y<b.length;y++)s.hasOwnProperty(b[y])||m.unshift([b[y],IU+"remove"])}m.forEach(([b,y])=>{var S;if((S=i.__r3f)!=null&&S.primitive&&b==="object"||Fi.equ(y,d[b]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(b))return T.push([b,y,!0,[]]);let A=[];b.includes("-")&&(A=b.split("-")),T.push([b,y,!1,A]);for(const C in s){const R=s[C];C.startsWith(`${b}-`)&&T.push([C,R,!1,C.split("-")])}});const E={...s};return p.memoizedProps&&p.memoizedProps.args&&(E.args=p.memoizedProps.args),p.memoizedProps&&p.memoizedProps.attach&&(E.attach=p.memoizedProps.attach),{memoized:E,changes:T}}function FC(i,e){var n,r,s;const a=(n=i.__r3f)!=null?n:{},l=a.root,u=(r=l==null||l.getState==null?void 0:l.getState())!=null?r:{},{memoized:d,changes:h}=C9(e)?e:LU(i,e),f=a.eventCount;i.__r3f&&(i.__r3f.memoizedProps=d);for(let m=0;m<h.length;m++){let[T,E,b,y]=h[m],S=i,A=S[T];if(y.length&&(A=y.reduce((C,R)=>C[R],i),!(A&&A.set))){const[C,...R]=y.reverse();S=R.reverse().reduce((I,O)=>I[O],i),T=C}if(E===IU+"remove")if(S.constructor){let C=ak.get(S.constructor);C||(C=new S.constructor,ak.set(S.constructor,C)),E=C[T]}else E=0;if(b)E?a.handlers[T]=E:delete a.handlers[T],a.eventCount=Object.keys(a.handlers).length;else if(A&&A.set&&(A.copy||A instanceof op)){if(Array.isArray(E))A.fromArray?A.fromArray(E):A.set(...E);else if(A.copy&&E&&E.constructor&&A.constructor===E.constructor)A.copy(E);else if(E!==void 0){const C=A instanceof Ct;!C&&A.setScalar?A.setScalar(E):A instanceof op&&E instanceof op?A.mask=E.mask:A.set(E),!xU()&&!u.linear&&C&&A.convertSRGBToLinear()}}else S[T]=E,!u.linear&&S[T]instanceof ni&&S[T].format===jr&&S[T].type===la&&(S[T].encoding=xc);og(i)}if(a.parent&&u.internal&&i.raycast&&f!==a.eventCount){const m=u.internal.interaction.indexOf(i);m>-1&&u.internal.interaction.splice(m,1),a.eventCount&&u.internal.interaction.push(i)}return!(h.length===1&&h[0][0]==="onUpdate")&&h.length&&(s=i.__r3f)!=null&&s.parent&&XR(i),i}function og(i){var e,n;const r=(e=i.__r3f)==null||(n=e.root)==null||n.getState==null?void 0:n.getState();r&&r.internal.frames===0&&r.invalidate()}function XR(i){i.onUpdate==null||i.onUpdate(i)}function NU(i,e){i.manual||(RU(i)?(i.left=e.width/-2,i.right=e.width/2,i.top=e.height/2,i.bottom=e.height/-2):i.aspect=e.width/e.height,i.updateProjectionMatrix(),i.updateMatrixWorld())}function N0(i){return(i.eventObject||i.object).uuid+"/"+i.index+i.instanceId}function w9(){var i;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return Ag.DefaultEventPriority;switch((i=e.event)==null?void 0:i.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Ag.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Ag.ContinuousEventPriority;default:return Ag.DefaultEventPriority}}function kU(i,e,n,r){const s=n.get(e);s&&(n.delete(e),n.size===0&&(i.delete(r),s.target.releasePointerCapture(r)))}function M9(i,e){const{internal:n}=i.getState();n.interaction=n.interaction.filter(r=>r!==e),n.initialHits=n.initialHits.filter(r=>r!==e),n.hovered.forEach((r,s)=>{(r.eventObject===e||r.object===e)&&n.hovered.delete(s)}),n.capturedMap.forEach((r,s)=>{kU(n.capturedMap,e,r,s)})}function I9(i){function e(d){const{internal:h}=i.getState(),f=d.offsetX-h.initialClick[0],p=d.offsetY-h.initialClick[1];return Math.round(Math.sqrt(f*f+p*p))}function n(d){return d.filter(h=>["Move","Over","Enter","Out","Leave"].some(f=>{var p;return(p=h.__r3f)==null?void 0:p.handlers["onPointer"+f]}))}function r(d,h){const f=i.getState(),p=new Set,m=[],T=h?h(f.internal.interaction):f.internal.interaction;for(let S=0;S<T.length;S++){const A=Wv(T[S]);A&&(A.raycaster.camera=void 0)}f.previousRoot||f.events.compute==null||f.events.compute(d,f);function E(S){const A=Wv(S);if(!A||!A.events.enabled||A.raycaster.camera===null)return[];if(A.raycaster.camera===void 0){var C;A.events.compute==null||A.events.compute(d,A,(C=A.previousRoot)==null?void 0:C.getState()),A.raycaster.camera===void 0&&(A.raycaster.camera=null)}return A.raycaster.camera?A.raycaster.intersectObject(S,!0):[]}let b=T.flatMap(E).sort((S,A)=>{const C=Wv(S.object),R=Wv(A.object);return!C||!R?S.distance-A.distance:R.events.priority-C.events.priority||S.distance-A.distance}).filter(S=>{const A=N0(S);return p.has(A)?!1:(p.add(A),!0)});f.events.filter&&(b=f.events.filter(b,f));for(const S of b){let A=S.object;for(;A;){var y;(y=A.__r3f)!=null&&y.eventCount&&m.push({...S,eventObject:A}),A=A.parent}}if("pointerId"in d&&f.internal.capturedMap.has(d.pointerId))for(let S of f.internal.capturedMap.get(d.pointerId).values())p.has(N0(S.intersection))||m.push(S.intersection);return m}function s(d,h,f,p){const m=i.getState();if(d.length){const T={stopped:!1};for(const E of d){const b=Wv(E.object)||m,{raycaster:y,pointer:S,camera:A,internal:C}=b,R=new te(S.x,S.y,0).unproject(A),I=U=>{var ce,ie;return(ce=(ie=C.capturedMap.get(U))==null?void 0:ie.has(E.eventObject))!=null?ce:!1},O=U=>{const ce={intersection:E,target:h.target};C.capturedMap.has(U)?C.capturedMap.get(U).set(E.eventObject,ce):C.capturedMap.set(U,new Map([[E.eventObject,ce]])),h.target.setPointerCapture(U)},F=U=>{const ce=C.capturedMap.get(U);ce&&kU(C.capturedMap,E.eventObject,ce,U)};let k={};for(let U in h){let ce=h[U];typeof ce!="function"&&(k[U]=ce)}let D={...E,...k,pointer:S,intersections:d,stopped:T.stopped,delta:f,unprojectedPoint:R,ray:y.ray,camera:A,stopPropagation(){const U="pointerId"in h&&C.capturedMap.get(h.pointerId);if((!U||U.has(E.eventObject))&&(D.stopped=T.stopped=!0,C.hovered.size&&Array.from(C.hovered.values()).find(ce=>ce.eventObject===E.eventObject))){const ce=d.slice(0,d.indexOf(E));a([...ce,E])}},target:{hasPointerCapture:I,setPointerCapture:O,releasePointerCapture:F},currentTarget:{hasPointerCapture:I,setPointerCapture:O,releasePointerCapture:F},nativeEvent:h};if(p(D),T.stopped===!0)break}}return d}function a(d){const{internal:h}=i.getState();for(const f of h.hovered.values())if(!d.length||!d.find(p=>p.object===f.object&&p.index===f.index&&p.instanceId===f.instanceId)){const m=f.eventObject.__r3f,T=m==null?void 0:m.handlers;if(h.hovered.delete(N0(f)),m!=null&&m.eventCount){const E={...f,intersections:d};T.onPointerOut==null||T.onPointerOut(E),T.onPointerLeave==null||T.onPointerLeave(E)}}}function l(d,h){for(let f=0;f<h.length;f++){const p=h[f].__r3f;p==null||p.handlers.onPointerMissed==null||p.handlers.onPointerMissed(d)}}function u(d){switch(d){case"onPointerLeave":case"onPointerCancel":return()=>a([]);case"onLostPointerCapture":return h=>{const{internal:f}=i.getState();"pointerId"in h&&f.capturedMap.has(h.pointerId)&&requestAnimationFrame(()=>{f.capturedMap.has(h.pointerId)&&(f.capturedMap.delete(h.pointerId),a([]))})}}return function(f){const{onPointerMissed:p,internal:m}=i.getState();m.lastEvent.current=f;const T=d==="onPointerMove",E=d==="onClick"||d==="onContextMenu"||d==="onDoubleClick",y=r(f,T?n:void 0),S=E?e(f):0;d==="onPointerDown"&&(m.initialClick=[f.offsetX,f.offsetY],m.initialHits=y.map(C=>C.eventObject)),E&&!y.length&&S<=2&&(l(f,m.interaction),p&&p(f)),T&&a(y);function A(C){const R=C.eventObject,I=R.__r3f,O=I==null?void 0:I.handlers;if(I!=null&&I.eventCount)if(T){if(O.onPointerOver||O.onPointerEnter||O.onPointerOut||O.onPointerLeave){const F=N0(C),k=m.hovered.get(F);k?k.stopped&&C.stopPropagation():(m.hovered.set(F,C),O.onPointerOver==null||O.onPointerOver(C),O.onPointerEnter==null||O.onPointerEnter(C))}O.onPointerMove==null||O.onPointerMove(C)}else{const F=O[d];F?(!E||m.initialHits.includes(R))&&(l(f,m.interaction.filter(k=>!m.initialHits.includes(k))),F(C)):E&&m.initialHits.includes(R)&&l(f,m.interaction.filter(k=>!m.initialHits.includes(k)))}}s(y,f,S,A)}}return{handlePointer:u}}const O9=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],PU=i=>!!(i!=null&&i.render),jM=q.createContext(null),L9=(i,e)=>{const n=EU((u,d)=>{const h=new te,f=new te,p=new te;function m(S=d().camera,A=f,C=d().size){const{width:R,height:I,top:O,left:F}=C,k=R/I;A instanceof te?p.copy(A):p.set(...A);const D=S.getWorldPosition(h).distanceTo(p);if(RU(S))return{width:R/S.zoom,height:I/S.zoom,top:O,left:F,factor:1,distance:D,aspect:k};{const U=S.fov*Math.PI/180,ce=2*Math.tan(U/2)*D,ie=ce*(R/I);return{width:ie,height:ce,top:O,left:F,factor:R/ie,distance:D,aspect:k}}}let T;const E=S=>u(A=>({performance:{...A.performance,current:S}})),b=new mt;return{set:u,get:d,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(S=1)=>i(d(),S),advance:(S,A)=>e(S,A,d()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new HM,pointer:b,mouse:b,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const S=d();T&&clearTimeout(T),S.performance.current!==S.performance.min&&E(S.performance.min),T=setTimeout(()=>E(d().performance.max),S.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:m},setEvents:S=>u(A=>({...A,events:{...A.events,...S}})),setSize:(S,A,C,R,I)=>{const O=d().camera,F={width:S,height:A,top:R||0,left:I||0,updateStyle:C};u(k=>({size:F,viewport:{...k.viewport,...m(O,f,F)}}))},setDpr:S=>u(A=>{const C=OU(S);return{viewport:{...A.viewport,dpr:C,initialDpr:A.viewport.initialDpr||C}}}),setFrameloop:(S="always")=>{const A=d().clock;A.stop(),A.elapsedTime=0,S!=="never"&&(A.start(),A.elapsedTime=0),u(()=>({frameloop:S}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:q.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(S,A,C)=>{const R=d().internal;return R.priority=R.priority+(A>0?1:0),R.subscribers.push({ref:S,priority:A,store:C}),R.subscribers=R.subscribers.sort((I,O)=>I.priority-O.priority),()=>{const I=d().internal;I!=null&&I.subscribers&&(I.priority=I.priority-(A>0?1:0),I.subscribers=I.subscribers.filter(O=>O.ref!==S))}}}}}),r=n.getState();let s=r.size,a=r.viewport.dpr,l=r.camera;return n.subscribe(()=>{const{camera:u,size:d,viewport:h,gl:f,set:p}=n.getState();if(d!==s||h.dpr!==a){var m;s=d,a=h.dpr,NU(u,d),f.setPixelRatio(h.dpr);const T=(m=d.updateStyle)!=null?m:typeof HTMLCanvasElement<"u"&&f.domElement instanceof HTMLCanvasElement;f.setSize(d.width,d.height,T)}u!==l&&(l=u,p(T=>({viewport:{...T.viewport,...T.viewport.getCurrentViewport(u)}})))}),n.subscribe(u=>i(u)),n};let k0,N9=new Set,k9=new Set,P9=new Set;function UC(i,e){if(i.size)for(const{callback:n}of i.values())n(e)}function Xv(i,e){switch(i){case"before":return UC(N9,e);case"after":return UC(k9,e);case"tail":return UC(P9,e)}}let GC,HC;function VC(i,e,n){let r=e.clock.getDelta();for(e.frameloop==="never"&&typeof i=="number"&&(r=i-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=i),GC=e.internal.subscribers,k0=0;k0<GC.length;k0++)HC=GC[k0],HC.ref.current(HC.store.getState(),r,n);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function D9(i){let e=!1,n,r,s;function a(d){r=requestAnimationFrame(a),e=!0,n=0,Xv("before",d);for(const f of i.values()){var h;s=f.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((h=s.gl.xr)!=null&&h.isPresenting)&&(n+=VC(d,s))}if(Xv("after",d),n===0)return Xv("tail",d),e=!1,cancelAnimationFrame(r)}function l(d,h=1){var f;if(!d)return i.forEach(p=>l(p.store.getState()),h);(f=d.gl.xr)!=null&&f.isPresenting||!d.internal.active||d.frameloop==="never"||(d.internal.frames=Math.min(60,d.internal.frames+h),e||(e=!0,requestAnimationFrame(a)))}function u(d,h=!0,f,p){if(h&&Xv("before",d),f)VC(d,f,p);else for(const m of i.values())VC(d,m.store.getState());h&&Xv("after",d)}return{loop:a,invalidate:l,advance:u}}function YM(){const i=q.useContext(jM);if(!i)throw new Error("R3F: Hooks can only be used within the Canvas component!");return i}function $n(i=n=>n,e){return YM()(i,e)}function PE(i,e=0){const n=YM(),r=n.getState().internal.subscribe,s=wU(i);return kE(()=>r(s,e,n),[e,r,n]),null}function DU(i,e){return function(n,...r){const s=new n;return i&&i(s),Promise.all(r.map(a=>new Promise((l,u)=>s.load(a,d=>{d.scene&&Object.assign(d,x9(d.scene)),l(d)},e,d=>u(new Error(`Could not load ${a}: ${d.message})`))))))}}function Nu(i,e,n,r){const s=Array.isArray(e)?e:[e],a=E9(DU(n,r),[i,...s],{equal:Fi.equ});return Array.isArray(e)?a:a[0]}Nu.preload=function(i,e,n){const r=Array.isArray(e)?e:[e];return y9(DU(n),[i,...r])};Nu.clear=function(i,e){const n=Array.isArray(e)?e:[e];return S9([i,...n])};const Yg=new Map,{invalidate:uk,advance:hk}=D9(Yg),{reconciler:uE,applyProps:Hf}=$9(Yg,w9),ig={objects:"shallow",strict:!1},B9=(i,e)=>{const n=typeof i=="function"?i(e):i;return PU(n)?n:new N$({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...i})};function F9(i,e){if(e)return e;if(typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement&&i.parentElement){const{width:n,height:r,top:s,left:a}=i.parentElement.getBoundingClientRect();return{width:n,height:r,top:s,left:a}}else if(typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function U9(i){const e=Yg.get(i),n=e==null?void 0:e.fiber,r=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,a=r||L9(uk,hk),l=n||uE.createContainer(a,Ag.ConcurrentRoot,null,!1,null,"",s,null);e||Yg.set(i,{fiber:l,store:a});let u,d=!1,h;return{configure(f={}){let{gl:p,size:m,scene:T,events:E,onCreated:b,shadows:y=!1,linear:S=!1,flat:A=!1,legacy:C=!1,orthographic:R=!1,frameloop:I="always",dpr:O=[1,2],performance:F,raycaster:k,camera:D,onPointerMissed:U}=f,ce=a.getState(),ie=ce.gl;ce.gl||ce.set({gl:ie=B9(p,i)});let ae=ce.raycaster;ae||ce.set({raycaster:ae=new As});const{params:ne,...pe}=k||{};if(Fi.equ(pe,ae,ig)||Hf(ae,{...pe}),Fi.equ(ne,ae.params,ig)||Hf(ae,{params:{...ae.params,...ne}}),!ce.camera||ce.camera===h&&!Fi.equ(h,D,ig)){h=D;const se=D instanceof yE,Y=se?D:R?new ua(0,0,0,0,.1,1e3):new Ui(75,0,.1,1e3);se||(Y.position.z=5,D&&Hf(Y,D),!ce.camera&&!(D!=null&&D.rotation)&&Y.lookAt(0,0,0)),ce.set({camera:Y})}if(!ce.scene){let se;T instanceof jg?se=T:(se=new jg,T&&Hf(se,T)),ce.set({scene:sg(se)})}if(!ce.xr){const se=(ue,Te)=>{const _e=a.getState();_e.frameloop!=="never"&&hk(ue,!0,_e,Te)},Y=()=>{const ue=a.getState();ue.gl.xr.enabled=ue.gl.xr.isPresenting,ue.gl.xr.setAnimationLoop(ue.gl.xr.isPresenting?se:null),ue.gl.xr.isPresenting||uk(ue)},he={connect(){const ue=a.getState().gl;ue.xr.addEventListener("sessionstart",Y),ue.xr.addEventListener("sessionend",Y)},disconnect(){const ue=a.getState().gl;ue.xr.removeEventListener("sessionstart",Y),ue.xr.removeEventListener("sessionend",Y)}};ie.xr&&he.connect(),ce.set({xr:he})}if(ie.shadowMap){const se=ie.shadowMap.enabled,Y=ie.shadowMap.type;if(ie.shadowMap.enabled=!!y,Fi.boo(y))ie.shadowMap.type=CT;else if(Fi.str(y)){var de;const he={basic:MB,percentage:b$,soft:CT,variance:xl};ie.shadowMap.type=(de=he[y])!=null?de:CT}else Fi.obj(y)&&Object.assign(ie.shadowMap,y);(se!==ie.shadowMap.enabled||Y!==ie.shadowMap.type)&&(ie.shadowMap.needsUpdate=!0)}const xe=xU();xe&&("enabled"in xe?xe.enabled=!C:"legacyMode"in xe&&(xe.legacyMode=C));const H=S?R$:xc,J=A?Ll:rM;ie.outputEncoding!==H&&(ie.outputEncoding=H),ie.toneMapping!==J&&(ie.toneMapping=J),ce.legacy!==C&&ce.set(()=>({legacy:C})),ce.linear!==S&&ce.set(()=>({linear:S})),ce.flat!==A&&ce.set(()=>({flat:A})),p&&!Fi.fun(p)&&!PU(p)&&!Fi.equ(p,ie,ig)&&Hf(ie,p),E&&!ce.events.handlers&&ce.set({events:E(a)});const K=F9(i,m);return Fi.equ(K,ce.size,ig)||ce.setSize(K.width,K.height,K.updateStyle,K.top,K.left),O&&ce.viewport.dpr!==OU(O)&&ce.setDpr(O),ce.frameloop!==I&&ce.setFrameloop(I),ce.onPointerMissed||ce.set({onPointerMissed:U}),F&&!Fi.equ(F,ce.performance,ig)&&ce.set(se=>({performance:{...se.performance,...F}})),u=b,d=!0,this},render(f){return d||this.configure(),uE.updateContainer(q.createElement(G9,{store:a,children:f,onCreated:u,rootElement:i}),l,null,()=>{}),a},unmount(){BU(i)}}}function G9({store:i,children:e,onCreated:n,rootElement:r}){return kE(()=>{const s=i.getState();s.set(a=>({internal:{...a.internal,active:!0}})),n&&n(s),i.getState().events.connected||s.events.connect==null||s.events.connect(r)},[]),q.createElement(jM.Provider,{value:i},e)}function BU(i,e){const n=Yg.get(i),r=n==null?void 0:n.fiber;if(r){const s=n==null?void 0:n.store.getState();s&&(s.internal.active=!1),uE.updateContainer(null,r,null,()=>{s&&setTimeout(()=>{try{var a,l,u,d;s.events.disconnect==null||s.events.disconnect(),(a=s.gl)==null||(l=a.renderLists)==null||l.dispose==null||l.dispose(),(u=s.gl)==null||u.forceContextLoss==null||u.forceContextLoss(),(d=s.gl)!=null&&d.xr&&s.xr.disconnect(),R9(s),Yg.delete(i),e&&e(i)}catch{}},500)})}}function H9(i,e,n){return q.createElement(V9,{key:e.uuid,children:i,container:e,state:n})}function V9({state:i={},children:e,container:n}){const{events:r,size:s,...a}=i,l=YM(),[u]=q.useState(()=>new As),[d]=q.useState(()=>new mt),h=q.useCallback((p,m)=>{const T={...p};Object.keys(p).forEach(b=>{(O9.includes(b)||p[b]!==m[b]&&m[b])&&delete T[b]});let E;if(m&&s){const b=m.camera;E=p.viewport.getCurrentViewport(b,new te,s),b!==p.camera&&NU(b,s)}return{...T,scene:n,raycaster:u,pointer:d,mouse:d,previousRoot:l,events:{...p.events,...m==null?void 0:m.events,...r},size:{...p.size,...s},viewport:{...p.viewport,...E},...a}},[i]),[f]=q.useState(()=>{const p=l.getState();return EU((T,E)=>({...p,scene:n,raycaster:u,pointer:d,mouse:d,previousRoot:l,events:{...p.events,...r},size:{...p.size,...s},...a,set:T,get:E,setEvents:b=>T(y=>({...y,events:{...y.events,...b}}))}))});return q.useEffect(()=>{const p=l.subscribe(m=>f.setState(T=>h(m,T)));return()=>{p(),f.destroy()}},[]),q.useEffect(()=>{f.setState(p=>h(l.getState(),p))},[h]),q.createElement(q.Fragment,null,uE.createPortal(q.createElement(jM.Provider,{value:f},e),f,null))}uE.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:q.version});function Dl(){return Dl=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(i[r]=n[r])}return i},Dl.apply(null,arguments)}function jR(i,e,n){var r,s,a,l,u;e==null&&(e=100);function d(){var f=Date.now()-l;f<e&&f>=0?r=setTimeout(d,e-f):(r=null,n||(u=i.apply(a,s),a=s=null))}var h=function(){a=this,s=arguments,l=Date.now();var f=n&&!r;return r||(r=setTimeout(d,e)),f&&(u=i.apply(a,s),a=s=null),u};return h.clear=function(){r&&(clearTimeout(r),r=null)},h.flush=function(){r&&(u=i.apply(a,s),a=s=null,clearTimeout(r),r=null)},h}jR.debounce=jR;var z9=jR;const dk=hd(z9);function W9(i){let{debounce:e,scroll:n,polyfill:r,offsetSize:s}=i===void 0?{debounce:0,scroll:!1,offsetSize:!1}:i;const a=r||(typeof window>"u"?class{}:window.ResizeObserver);if(!a)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[l,u]=q.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),d=q.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:l}),h=e?typeof e=="number"?e:e.scroll:null,f=e?typeof e=="number"?e:e.resize:null,p=q.useRef(!1);q.useEffect(()=>(p.current=!0,()=>void(p.current=!1)));const[m,T,E]=q.useMemo(()=>{const A=()=>{if(!d.current.element)return;const{left:C,top:R,width:I,height:O,bottom:F,right:k,x:D,y:U}=d.current.element.getBoundingClientRect(),ce={left:C,top:R,width:I,height:O,bottom:F,right:k,x:D,y:U};d.current.element instanceof HTMLElement&&s&&(ce.height=d.current.element.offsetHeight,ce.width=d.current.element.offsetWidth),Object.freeze(ce),p.current&&!K9(d.current.lastBounds,ce)&&u(d.current.lastBounds=ce)};return[A,f?dk(A,f):A,h?dk(A,h):A]},[u,s,h,f]);function b(){d.current.scrollContainers&&(d.current.scrollContainers.forEach(A=>A.removeEventListener("scroll",E,!0)),d.current.scrollContainers=null),d.current.resizeObserver&&(d.current.resizeObserver.disconnect(),d.current.resizeObserver=null)}function y(){d.current.element&&(d.current.resizeObserver=new a(E),d.current.resizeObserver.observe(d.current.element),n&&d.current.scrollContainers&&d.current.scrollContainers.forEach(A=>A.addEventListener("scroll",E,{capture:!0,passive:!0})))}const S=A=>{!A||A===d.current.element||(b(),d.current.element=A,d.current.scrollContainers=FU(A),y())};return j9(E,!!n),X9(T),q.useEffect(()=>{b(),y()},[n,E,T]),q.useEffect(()=>b,[]),[S,l,m]}function X9(i){q.useEffect(()=>{const e=i;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[i])}function j9(i,e){q.useEffect(()=>{if(e){const n=i;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",n,!0)}},[i,e])}function FU(i){const e=[];if(!i||i===document.body)return e;const{overflow:n,overflowX:r,overflowY:s}=window.getComputedStyle(i);return[n,r,s].some(a=>a==="auto"||a==="scroll")&&e.push(i),[...e,...FU(i.parentElement)]}const Y9=["x","y","top","bottom","left","right","width","height"],K9=(i,e)=>Y9.every(n=>i[n]===e[n]);var J9=Object.defineProperty,Z9=Object.defineProperties,q9=Object.getOwnPropertyDescriptors,fk=Object.getOwnPropertySymbols,Q9=Object.prototype.hasOwnProperty,eY=Object.prototype.propertyIsEnumerable,pk=(i,e,n)=>e in i?J9(i,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[e]=n,mk=(i,e)=>{for(var n in e||(e={}))Q9.call(e,n)&&pk(i,n,e[n]);if(fk)for(var n of fk(e))eY.call(e,n)&&pk(i,n,e[n]);return i},tY=(i,e)=>Z9(i,q9(e)),gk,_k;typeof window<"u"&&((gk=window.document)!=null&&gk.createElement||((_k=window.navigator)==null?void 0:_k.product)==="ReactNative")?q.useLayoutEffect:q.useEffect;function UU(i,e,n){if(!i)return;if(n(i)===!0)return i;let r=e?i.return:i.child;for(;r;){const s=UU(r,e,n);if(s)return s;r=e?null:r.sibling}}function GU(i){try{return Object.defineProperties(i,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return i}}const vk=console.error;console.error=function(){const i=[...arguments].join("");if(i!=null&&i.startsWith("Warning:")&&i.includes("useContext")){console.error=vk;return}return vk.apply(this,arguments)};const KM=GU(q.createContext(null));class HU extends q.Component{render(){return q.createElement(KM.Provider,{value:this._reactInternals},this.props.children)}}function nY(){const i=q.useContext(KM);if(i===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=q.useId();return q.useMemo(()=>{for(const r of[i,i==null?void 0:i.alternate]){if(!r)continue;const s=UU(r,!1,a=>{let l=a.memoizedState;for(;l;){if(l.memoizedState===e)return!0;l=l.next}});if(s)return s}},[i,e])}function iY(){const i=nY(),[e]=q.useState(()=>new Map);e.clear();let n=i;for(;n;){if(n.type&&typeof n.type=="object"){const s=n.type._context===void 0&&n.type.Provider===n.type?n.type:n.type._context;s&&s!==KM&&!e.has(s)&&e.set(s,q.useContext(GU(s)))}n=n.return}return e}function rY(){const i=iY();return q.useMemo(()=>Array.from(i.keys()).reduce((e,n)=>r=>q.createElement(e,null,q.createElement(n.Provider,tY(mk({},r),{value:i.get(n)}))),e=>q.createElement(HU,mk({},e))),[i])}const zC={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function sY(i){const{handlePointer:e}=I9(i);return{priority:1,enabled:!0,compute(n,r,s){r.pointer.set(n.offsetX/r.size.width*2-1,-(n.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(zC).reduce((n,r)=>({...n,[r]:e(r)}),{}),update:()=>{var n;const{events:r,internal:s}=i.getState();(n=s.lastEvent)!=null&&n.current&&r.handlers&&r.handlers.onPointerMove(s.lastEvent.current)},connect:n=>{var r;const{set:s,events:a}=i.getState();a.disconnect==null||a.disconnect(),s(l=>({events:{...l.events,connected:n}})),Object.entries((r=a.handlers)!=null?r:[]).forEach(([l,u])=>{const[d,h]=zC[l];n.addEventListener(d,u,{passive:h})})},disconnect:()=>{const{set:n,events:r}=i.getState();if(r.connected){var s;Object.entries((s=r.handlers)!=null?s:[]).forEach(([a,l])=>{if(r&&r.connected instanceof HTMLElement){const[u]=zC[a];r.connected.removeEventListener(u,l)}}),n(a=>({events:{...a.events,connected:void 0}}))}}}}const oY=q.forwardRef(function({children:e,fallback:n,resize:r,style:s,gl:a,events:l=sY,eventSource:u,eventPrefix:d,shadows:h,linear:f,flat:p,legacy:m,orthographic:T,frameloop:E,dpr:b,performance:y,raycaster:S,camera:A,onPointerMissed:C,onCreated:R,...I},O){q.useMemo(()=>CU(d9),[]);const F=rY(),[k,D]=W9({scroll:!0,debounce:{scroll:50,resize:0},...r}),U=q.useRef(null),ce=q.useRef(null);q.useImperativeHandle(O,()=>U.current);const ie=wU(C),[ae,ne]=q.useState(!1),[pe,de]=q.useState(!1);if(ae)throw ae;if(pe)throw pe;const xe=q.useRef(null);kE(()=>{const J=U.current;D.width>0&&D.height>0&&J&&(xe.current||(xe.current=U9(J)),xe.current.configure({gl:a,events:l,shadows:h,linear:f,flat:p,legacy:m,orthographic:T,frameloop:E,dpr:b,performance:y,raycaster:S,camera:A,size:D,onPointerMissed:(...K)=>ie.current==null?void 0:ie.current(...K),onCreated:K=>{K.events.connect==null||K.events.connect(u?b9(u)?u.current:u:ce.current),d&&K.setEvents({compute:(se,Y)=>{const he=se[d+"X"],ue=se[d+"Y"];Y.pointer.set(he/Y.size.width*2-1,-(ue/Y.size.height)*2+1),Y.raycaster.setFromCamera(Y.pointer,Y.camera)}}),R==null||R(K)}}),xe.current.render(q.createElement(F,null,q.createElement(MU,{set:de},q.createElement(q.Suspense,{fallback:q.createElement(A9,{set:ne})},e)))))}),q.useEffect(()=>{const J=U.current;if(J)return()=>BU(J)},[]);const H=u?"none":"auto";return q.createElement("div",Dl({ref:ce,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:H,...s}},I),q.createElement("div",{ref:k,style:{width:"100%",height:"100%"}},q.createElement("canvas",{ref:U,style:{display:"block"}},n)))}),Lo=q.forwardRef(function(e,n){return q.createElement(HU,null,q.createElement(oY,Dl({},e,{ref:n})))}),DE=new te,JM=new te,aY=new te,Tk=new mt;function lY(i,e,n){const r=DE.setFromMatrixPosition(i.matrixWorld);r.project(e);const s=n.width/2,a=n.height/2;return[r.x*s+s,-(r.y*a)+a]}function cY(i,e){const n=DE.setFromMatrixPosition(i.matrixWorld),r=JM.setFromMatrixPosition(e.matrixWorld),s=n.sub(r),a=e.getWorldDirection(aY);return s.angleTo(a)>Math.PI/2}function uY(i,e,n,r){const s=DE.setFromMatrixPosition(i.matrixWorld),a=s.clone();a.project(e),Tk.set(a.x,a.y),n.setFromCamera(Tk,e);const l=n.intersectObjects(r,!0);if(l.length){const u=l[0].distance;return s.distanceTo(n.ray.origin)<u}return!0}function hY(i,e){if(e instanceof ua)return e.zoom;if(e instanceof Ui){const n=DE.setFromMatrixPosition(i.matrixWorld),r=JM.setFromMatrixPosition(e.matrixWorld),s=e.fov*Math.PI/180,a=n.distanceTo(r);return 1/(2*Math.tan(s/2)*a)}else return 1}function dY(i,e,n){if(e instanceof Ui||e instanceof ua){const r=DE.setFromMatrixPosition(i.matrixWorld),s=JM.setFromMatrixPosition(e.matrixWorld),a=r.distanceTo(s),l=(n[1]-n[0])/(e.far-e.near),u=n[1]-l*e.far;return Math.round(l*a+u)}}const YR=i=>Math.abs(i)<1e-10?0:i;function VU(i,e,n=""){let r="matrix3d(";for(let s=0;s!==16;s++)r+=YR(e[s]*i.elements[s])+(s!==15?",":")");return n+r}const fY=(i=>e=>VU(e,i))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),pY=(i=>(e,n)=>VU(e,i(n),"translate(-50%,-50%)"))(i=>[1/i,1/i,1/i,1,-1/i,-1/i,-1/i,-1,1/i,1/i,1/i,1,1,1,1,1]);function mY(i){return i&&typeof i=="object"&&"current"in i}const gY=q.forwardRef(({children:i,eps:e=.001,style:n,className:r,prepend:s,center:a,fullscreen:l,portal:u,distanceFactor:d,sprite:h=!1,transform:f=!1,occlude:p,onOcclude:m,castShadow:T,receiveShadow:E,material:b,geometry:y,zIndexRange:S=[16777271,0],calculatePosition:A=lY,as:C="div",wrapperClass:R,pointerEvents:I="auto",...O},F)=>{const{gl:k,camera:D,scene:U,size:ce,raycaster:ie,events:ae,viewport:ne}=$n(),[pe]=q.useState(()=>document.createElement(C)),de=q.useRef(),xe=q.useRef(null),H=q.useRef(0),J=q.useRef([0,0]),K=q.useRef(null),se=q.useRef(null),Y=(u==null?void 0:u.current)||ae.connected||k.domElement.parentNode,he=q.useRef(null),ue=q.useRef(!1),Te=q.useMemo(()=>p&&p!=="blending"||Array.isArray(p)&&p.length&&mY(p[0]),[p]);q.useLayoutEffect(()=>{const Ue=k.domElement;p&&p==="blending"?(Ue.style.zIndex=`${Math.floor(S[0]/2)}`,Ue.style.position="absolute",Ue.style.pointerEvents="none"):(Ue.style.zIndex=null,Ue.style.position=null,Ue.style.pointerEvents=null)},[p]),q.useLayoutEffect(()=>{if(xe.current){const Ue=de.current=bB(pe);if(U.updateMatrixWorld(),f)pe.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const Le=A(xe.current,D,ce);pe.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${Le[0]}px,${Le[1]}px,0);transform-origin:0 0;`}return Y&&(s?Y.prepend(pe):Y.appendChild(pe)),()=>{Y&&Y.removeChild(pe),Ue.unmount()}}},[Y,f]),q.useLayoutEffect(()=>{R&&(pe.className=R)},[R]);const _e=q.useMemo(()=>f?{position:"absolute",top:0,left:0,width:ce.width,height:ce.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:a?"translate3d(-50%,-50%,0)":"none",...l&&{top:-ce.height/2,left:-ce.width/2,width:ce.width,height:ce.height},...n},[n,a,l,ce,f]),Re=q.useMemo(()=>({position:"absolute",pointerEvents:I}),[I]);q.useLayoutEffect(()=>{if(ue.current=!1,f){var Ue;(Ue=de.current)==null||Ue.render(q.createElement("div",{ref:K,style:_e},q.createElement("div",{ref:se,style:Re},q.createElement("div",{ref:F,className:r,style:n,children:i}))))}else{var Le;(Le=de.current)==null||Le.render(q.createElement("div",{ref:F,style:_e,className:r,children:i}))}});const De=q.useRef(!0);PE(Ue=>{if(xe.current){D.updateMatrixWorld(),xe.current.updateWorldMatrix(!0,!1);const Le=f?J.current:A(xe.current,D,ce);if(f||Math.abs(H.current-D.zoom)>e||Math.abs(J.current[0]-Le[0])>e||Math.abs(J.current[1]-Le[1])>e){const re=cY(xe.current,D);let Ye=!1;Te&&(Array.isArray(p)?Ye=p.map(dt=>dt.current):p!=="blending"&&(Ye=[U]));const Fe=De.current;if(Ye){const dt=uY(xe.current,D,ie,Ye);De.current=dt&&!re}else De.current=!re;Fe!==De.current&&(m?m(!De.current):pe.style.display=De.current?"block":"none");const Ze=Math.floor(S[0]/2),Xe=p?Te?[S[0],Ze]:[Ze-1,0]:S;if(pe.style.zIndex=`${dY(xe.current,D,Xe)}`,f){const[dt,je]=[ce.width/2,ce.height/2],it=D.projectionMatrix.elements[5]*je,{isOrthographicCamera:Ce,top:Me,left:St,bottom:oe,right:ee}=D,W=fY(D.matrixWorldInverse),ot=Ce?`scale(${it})translate(${YR(-(ee+St)/2)}px,${YR((Me+oe)/2)}px)`:`translateZ(${it}px)`;let ze=xe.current.matrixWorld;h&&(ze=D.matrixWorldInverse.clone().transpose().copyPosition(ze).scale(xe.current.scale),ze.elements[3]=ze.elements[7]=ze.elements[11]=0,ze.elements[15]=1),pe.style.width=ce.width+"px",pe.style.height=ce.height+"px",pe.style.perspective=Ce?"":`${it}px`,K.current&&se.current&&(K.current.style.transform=`${ot}${W}translate(${dt}px,${je}px)`,se.current.style.transform=pY(ze,1/((d||10)/400)))}else{const dt=d===void 0?1:hY(xe.current,D)*d;pe.style.transform=`translate3d(${Le[0]}px,${Le[1]}px,0) scale(${dt})`}J.current=Le,H.current=D.zoom}}if(!Te&&he.current&&!ue.current)if(f){if(K.current){const Le=K.current.children[0];if(Le!=null&&Le.clientWidth&&Le!=null&&Le.clientHeight){const{isOrthographicCamera:re}=D;if(re||y)O.scale&&(Array.isArray(O.scale)?O.scale instanceof te?he.current.scale.copy(O.scale.clone().divideScalar(1)):he.current.scale.set(1/O.scale[0],1/O.scale[1],1/O.scale[2]):he.current.scale.setScalar(1/O.scale));else{const Ye=(d||10)/400,Fe=Le.clientWidth*Ye,Ze=Le.clientHeight*Ye;he.current.scale.set(Fe,Ze,1)}ue.current=!0}}}else{const Le=pe.children[0];if(Le!=null&&Le.clientWidth&&Le!=null&&Le.clientHeight){const re=1/ne.factor,Ye=Le.clientWidth*re,Fe=Le.clientHeight*re;he.current.scale.set(Ye,Fe,1),ue.current=!0}he.current.lookAt(Ue.camera.position)}});const et=q.useMemo(()=>({vertexShader:f?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[f]);return q.createElement("group",Dl({},O,{ref:xe}),p&&!Te&&q.createElement("mesh",{castShadow:T,receiveShadow:E,ref:he},y||q.createElement("planeGeometry",null),b||q.createElement("shaderMaterial",{side:Ss,vertexShader:et.vertexShader,fragmentShader:et.fragmentShader})))}),zU=parseInt(Mp.replace(/\D+/g,"")),WU=zU>=125?"uv1":"uv2";function Ek(i,e){if(e===pM)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),i;if(e===$p||e===TE){let n=i.getIndex();if(n===null){const l=[],u=i.getAttribute("position");if(u!==void 0){for(let d=0;d<u.count;d++)l.push(d);i.setIndex(l),n=i.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const r=n.count-2,s=[];if(n)if(e===$p)for(let l=1;l<=r;l++)s.push(n.getX(0)),s.push(n.getX(l)),s.push(n.getX(l+1));else for(let l=0;l<r;l++)l%2===0?(s.push(n.getX(l)),s.push(n.getX(l+1)),s.push(n.getX(l+2))):(s.push(n.getX(l+2)),s.push(n.getX(l+1)),s.push(n.getX(l)));s.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=i.clone();return a.setIndex(s),a.clearGroups(),a}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),i}var Ha=Uint8Array,Xh=Uint16Array,KR=Uint32Array,XU=new Ha([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),jU=new Ha([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),_Y=new Ha([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),YU=function(i,e){for(var n=new Xh(31),r=0;r<31;++r)n[r]=e+=1<<i[r-1];for(var s=new KR(n[30]),r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)s[a]=a-n[r]<<5|r;return[n,s]},KU=YU(XU,2),JU=KU[0],vY=KU[1];JU[28]=258,vY[258]=28;var TY=YU(jU,0),EY=TY[0],JR=new Xh(32768);for(var Gi=0;Gi<32768;++Gi){var kh=(Gi&43690)>>>1|(Gi&21845)<<1;kh=(kh&52428)>>>2|(kh&13107)<<2,kh=(kh&61680)>>>4|(kh&3855)<<4,JR[Gi]=((kh&65280)>>>8|(kh&255)<<8)>>>1}var IT=function(i,e,n){for(var r=i.length,s=0,a=new Xh(e);s<r;++s)++a[i[s]-1];var l=new Xh(e);for(s=0;s<e;++s)l[s]=l[s-1]+a[s-1]<<1;var u;if(n){u=new Xh(1<<e);var d=15-e;for(s=0;s<r;++s)if(i[s])for(var h=s<<4|i[s],f=e-i[s],p=l[i[s]-1]++<<f,m=p|(1<<f)-1;p<=m;++p)u[JR[p]>>>d]=h}else for(u=new Xh(r),s=0;s<r;++s)i[s]&&(u[s]=JR[l[i[s]-1]++]>>>15-i[s]);return u},BE=new Ha(288);for(var Gi=0;Gi<144;++Gi)BE[Gi]=8;for(var Gi=144;Gi<256;++Gi)BE[Gi]=9;for(var Gi=256;Gi<280;++Gi)BE[Gi]=7;for(var Gi=280;Gi<288;++Gi)BE[Gi]=8;var ZU=new Ha(32);for(var Gi=0;Gi<32;++Gi)ZU[Gi]=5;var yY=IT(BE,9,1),SY=IT(ZU,5,1),WC=function(i){for(var e=i[0],n=1;n<i.length;++n)i[n]>e&&(e=i[n]);return e},bl=function(i,e,n){var r=e/8|0;return(i[r]|i[r+1]<<8)>>(e&7)&n},XC=function(i,e){var n=e/8|0;return(i[n]|i[n+1]<<8|i[n+2]<<16)>>(e&7)},$Y=function(i){return(i/8|0)+(i&7&&1)},bY=function(i,e,n){(e==null||e<0)&&(e=0),(n==null||n>i.length)&&(n=i.length);var r=new(i instanceof Xh?Xh:i instanceof KR?KR:Ha)(n-e);return r.set(i.subarray(e,n)),r},AY=function(i,e,n){var r=i.length;if(!r||n&&!n.l&&r<5)return e||new Ha(0);var s=!e||n,a=!n||n.i;n||(n={}),e||(e=new Ha(r*3));var l=function(_e){var Re=e.length;if(_e>Re){var De=new Ha(Math.max(Re*2,_e));De.set(e),e=De}},u=n.f||0,d=n.p||0,h=n.b||0,f=n.l,p=n.d,m=n.m,T=n.n,E=r*8;do{if(!f){n.f=u=bl(i,d,1);var b=bl(i,d+1,3);if(d+=3,b)if(b==1)f=yY,p=SY,m=9,T=5;else if(b==2){var C=bl(i,d,31)+257,R=bl(i,d+10,15)+4,I=C+bl(i,d+5,31)+1;d+=14;for(var O=new Ha(I),F=new Ha(19),k=0;k<R;++k)F[_Y[k]]=bl(i,d+k*3,7);d+=R*3;for(var D=WC(F),U=(1<<D)-1,ce=IT(F,D,1),k=0;k<I;){var ie=ce[bl(i,d,U)];d+=ie&15;var y=ie>>>4;if(y<16)O[k++]=y;else{var ae=0,ne=0;for(y==16?(ne=3+bl(i,d,3),d+=2,ae=O[k-1]):y==17?(ne=3+bl(i,d,7),d+=3):y==18&&(ne=11+bl(i,d,127),d+=7);ne--;)O[k++]=ae}}var pe=O.subarray(0,C),de=O.subarray(C);m=WC(pe),T=WC(de),f=IT(pe,m,1),p=IT(de,T,1)}else throw"invalid block type";else{var y=$Y(d)+4,S=i[y-4]|i[y-3]<<8,A=y+S;if(A>r){if(a)throw"unexpected EOF";break}s&&l(h+S),e.set(i.subarray(y,A),h),n.b=h+=S,n.p=d=A*8;continue}if(d>E){if(a)throw"unexpected EOF";break}}s&&l(h+131072);for(var xe=(1<<m)-1,H=(1<<T)-1,J=d;;J=d){var ae=f[XC(i,d)&xe],K=ae>>>4;if(d+=ae&15,d>E){if(a)throw"unexpected EOF";break}if(!ae)throw"invalid length/literal";if(K<256)e[h++]=K;else if(K==256){J=d,f=null;break}else{var se=K-254;if(K>264){var k=K-257,Y=XU[k];se=bl(i,d,(1<<Y)-1)+JU[k],d+=Y}var he=p[XC(i,d)&H],ue=he>>>4;if(!he)throw"invalid distance";d+=he&15;var de=EY[ue];if(ue>3){var Y=jU[ue];de+=XC(i,d)&(1<<Y)-1,d+=Y}if(d>E){if(a)throw"unexpected EOF";break}s&&l(h+131072);for(var Te=h+se;h<Te;h+=4)e[h]=e[h-de],e[h+1]=e[h+1-de],e[h+2]=e[h+2-de],e[h+3]=e[h+3-de];h=Te}}n.l=f,n.p=J,n.b=h,f&&(u=1,n.m=m,n.d=p,n.n=T)}while(!u);return h==e.length?e:bY(e,0,h)},CY=new Ha(0),xY=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function P0(i,e){return AY((xY(i),i.subarray(2,-4)),e)}var RY=typeof TextDecoder<"u"&&new TextDecoder,wY=0;try{RY.decode(CY,{stream:!0}),wY=1}catch{}const MY=i=>i&&i.isCubeTexture;class IY extends Pn{constructor(e,n){var r,s;const a=MY(e),u=((s=a?(r=e.image[0])==null?void 0:r.width:e.image.width)!=null?s:1024)/4,d=Math.floor(Math.log2(u)),h=Math.pow(2,d),f=3*Math.max(h,16*7),p=4*h,m=[a?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/f}`,`#define CUBEUV_TEXEL_HEIGHT ${1/p}`,`#define CUBEUV_MAX_MIP ${d}.0`],T=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,E=m.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${parseInt(Mp.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,b={map:{value:e},height:{value:(n==null?void 0:n.height)||15},radius:{value:(n==null?void 0:n.radius)||100}},y=new s_(1,16),S=new Oo({uniforms:b,fragmentShader:E,vertexShader:T,side:Ss});super(y,S)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}var OY=Object.defineProperty,LY=(i,e,n)=>e in i?OY(i,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[e]=n,gn=(i,e,n)=>(LY(i,typeof e!="symbol"?e+"":e,n),n);const D0=new Ip,yk=new Eu,NY=Math.cos(70*(Math.PI/180)),Sk=(i,e)=>(i%e+e)%e;let kY=class extends Mc{constructor(e,n){super(),gn(this,"object"),gn(this,"domElement"),gn(this,"enabled",!0),gn(this,"target",new te),gn(this,"minDistance",0),gn(this,"maxDistance",1/0),gn(this,"minZoom",0),gn(this,"maxZoom",1/0),gn(this,"minPolarAngle",0),gn(this,"maxPolarAngle",Math.PI),gn(this,"minAzimuthAngle",-1/0),gn(this,"maxAzimuthAngle",1/0),gn(this,"enableDamping",!1),gn(this,"dampingFactor",.05),gn(this,"enableZoom",!0),gn(this,"zoomSpeed",1),gn(this,"enableRotate",!0),gn(this,"rotateSpeed",1),gn(this,"enablePan",!0),gn(this,"panSpeed",1),gn(this,"screenSpacePanning",!0),gn(this,"keyPanSpeed",7),gn(this,"zoomToCursor",!1),gn(this,"autoRotate",!1),gn(this,"autoRotateSpeed",2),gn(this,"reverseOrbit",!1),gn(this,"reverseHorizontalOrbit",!1),gn(this,"reverseVerticalOrbit",!1),gn(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),gn(this,"mouseButtons",{LEFT:Df.ROTATE,MIDDLE:Df.DOLLY,RIGHT:Df.PAN}),gn(this,"touches",{ONE:Bf.ROTATE,TWO:Bf.DOLLY_PAN}),gn(this,"target0"),gn(this,"position0"),gn(this,"zoom0"),gn(this,"_domElementKeyEvents",null),gn(this,"getPolarAngle"),gn(this,"getAzimuthalAngle"),gn(this,"setPolarAngle"),gn(this,"setAzimuthalAngle"),gn(this,"getDistance"),gn(this,"getZoomScale"),gn(this,"listenToKeyEvents"),gn(this,"stopListenToKeyEvents"),gn(this,"saveState"),gn(this,"reset"),gn(this,"update"),gn(this,"connect"),gn(this,"dispose"),gn(this,"dollyIn"),gn(this,"dollyOut"),gn(this,"getScale"),gn(this,"setScale"),this.object=e,this.domElement=n,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>f.phi,this.getAzimuthalAngle=()=>f.theta,this.setPolarAngle=z=>{let Ae=Sk(z,2*Math.PI),tt=f.phi;tt<0&&(tt+=2*Math.PI),Ae<0&&(Ae+=2*Math.PI);let ye=Math.abs(Ae-tt);2*Math.PI-ye<ye&&(Ae<tt?Ae+=2*Math.PI:tt+=2*Math.PI),p.phi=Ae-tt,r.update()},this.setAzimuthalAngle=z=>{let Ae=Sk(z,2*Math.PI),tt=f.theta;tt<0&&(tt+=2*Math.PI),Ae<0&&(Ae+=2*Math.PI);let ye=Math.abs(Ae-tt);2*Math.PI-ye<ye&&(Ae<tt?Ae+=2*Math.PI:tt+=2*Math.PI),p.theta=Ae-tt,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=z=>{z.addEventListener("keydown",qe),this._domElementKeyEvents=z},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",qe),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(s),r.update(),d=u.NONE},this.update=(()=>{const z=new te,Ae=new te(0,1,0),tt=new Er().setFromUnitVectors(e.up,Ae),ye=tt.clone().invert(),Ie=new te,Be=new Er,N=2*Math.PI;return function(){const ge=r.object.position;tt.setFromUnitVectors(e.up,Ae),ye.copy(tt).invert(),z.copy(ge).sub(r.target),z.applyQuaternion(tt),f.setFromVector3(z),r.autoRotate&&d===u.NONE&&ne(ie()),r.enableDamping?(f.theta+=p.theta*r.dampingFactor,f.phi+=p.phi*r.dampingFactor):(f.theta+=p.theta,f.phi+=p.phi);let we=r.minAzimuthAngle,We=r.maxAzimuthAngle;isFinite(we)&&isFinite(We)&&(we<-Math.PI?we+=N:we>Math.PI&&(we-=N),We<-Math.PI?We+=N:We>Math.PI&&(We-=N),we<=We?f.theta=Math.max(we,Math.min(We,f.theta)):f.theta=f.theta>(we+We)/2?Math.max(we,f.theta):Math.min(We,f.theta)),f.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,f.phi)),f.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(T,r.dampingFactor):r.target.add(T),r.zoomToCursor&&D||r.object.isOrthographicCamera?f.radius=he(f.radius):f.radius=he(f.radius*m),z.setFromSpherical(f),z.applyQuaternion(ye),ge.copy(r.target).add(z),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),r.enableDamping===!0?(p.theta*=1-r.dampingFactor,p.phi*=1-r.dampingFactor,T.multiplyScalar(1-r.dampingFactor)):(p.set(0,0,0),T.set(0,0,0));let gt=!1;if(r.zoomToCursor&&D){let bt=null;if(r.object instanceof Ui&&r.object.isPerspectiveCamera){const un=z.length();bt=he(un*m);const an=un-bt;r.object.position.addScaledVector(F,an),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const un=new te(k.x,k.y,0);un.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/m)),r.object.updateProjectionMatrix(),gt=!0;const an=new te(k.x,k.y,0);an.unproject(r.object),r.object.position.sub(an).add(un),r.object.updateMatrixWorld(),bt=z.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;bt!==null&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(bt).add(r.object.position):(D0.origin.copy(r.object.position),D0.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(D0.direction))<NY?e.lookAt(r.target):(yk.setFromNormalAndCoplanarPoint(r.object.up,r.target),D0.intersectPlane(yk,r.target))))}else r.object instanceof ua&&r.object.isOrthographicCamera&&(gt=m!==1,gt&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/m)),r.object.updateProjectionMatrix()));return m=1,D=!1,gt||Ie.distanceToSquared(r.object.position)>h||8*(1-Be.dot(r.object.quaternion))>h?(r.dispatchEvent(s),Ie.copy(r.object.position),Be.copy(r.object.quaternion),gt=!1,!0):!1}})(),this.connect=z=>{r.domElement=z,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",Ge),r.domElement.addEventListener("pointerdown",St),r.domElement.addEventListener("pointercancel",ee),r.domElement.addEventListener("wheel",ze)},this.dispose=()=>{var z,Ae,tt,ye,Ie,Be;r.domElement&&(r.domElement.style.touchAction="auto"),(z=r.domElement)==null||z.removeEventListener("contextmenu",Ge),(Ae=r.domElement)==null||Ae.removeEventListener("pointerdown",St),(tt=r.domElement)==null||tt.removeEventListener("pointercancel",ee),(ye=r.domElement)==null||ye.removeEventListener("wheel",ze),(Ie=r.domElement)==null||Ie.ownerDocument.removeEventListener("pointermove",oe),(Be=r.domElement)==null||Be.ownerDocument.removeEventListener("pointerup",ee),r._domElementKeyEvents!==null&&r._domElementKeyEvents.removeEventListener("keydown",qe)};const r=this,s={type:"change"},a={type:"start"},l={type:"end"},u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let d=u.NONE;const h=1e-6,f=new zR,p=new zR;let m=1;const T=new te,E=new mt,b=new mt,y=new mt,S=new mt,A=new mt,C=new mt,R=new mt,I=new mt,O=new mt,F=new te,k=new mt;let D=!1;const U=[],ce={};function ie(){return 2*Math.PI/60/60*r.autoRotateSpeed}function ae(){return Math.pow(.95,r.zoomSpeed)}function ne(z){r.reverseOrbit||r.reverseHorizontalOrbit?p.theta+=z:p.theta-=z}function pe(z){r.reverseOrbit||r.reverseVerticalOrbit?p.phi+=z:p.phi-=z}const de=(()=>{const z=new te;return function(tt,ye){z.setFromMatrixColumn(ye,0),z.multiplyScalar(-tt),T.add(z)}})(),xe=(()=>{const z=new te;return function(tt,ye){r.screenSpacePanning===!0?z.setFromMatrixColumn(ye,1):(z.setFromMatrixColumn(ye,0),z.crossVectors(r.object.up,z)),z.multiplyScalar(tt),T.add(z)}})(),H=(()=>{const z=new te;return function(tt,ye){const Ie=r.domElement;if(Ie&&r.object instanceof Ui&&r.object.isPerspectiveCamera){const Be=r.object.position;z.copy(Be).sub(r.target);let N=z.length();N*=Math.tan(r.object.fov/2*Math.PI/180),de(2*tt*N/Ie.clientHeight,r.object.matrix),xe(2*ye*N/Ie.clientHeight,r.object.matrix)}else Ie&&r.object instanceof ua&&r.object.isOrthographicCamera?(de(tt*(r.object.right-r.object.left)/r.object.zoom/Ie.clientWidth,r.object.matrix),xe(ye*(r.object.top-r.object.bottom)/r.object.zoom/Ie.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function J(z){r.object instanceof Ui&&r.object.isPerspectiveCamera||r.object instanceof ua&&r.object.isOrthographicCamera?m=z:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function K(z){J(m/z)}function se(z){J(m*z)}function Y(z){if(!r.zoomToCursor||!r.domElement)return;D=!0;const Ae=r.domElement.getBoundingClientRect(),tt=z.clientX-Ae.left,ye=z.clientY-Ae.top,Ie=Ae.width,Be=Ae.height;k.x=tt/Ie*2-1,k.y=-(ye/Be)*2+1,F.set(k.x,k.y,1).unproject(r.object).sub(r.object.position).normalize()}function he(z){return Math.max(r.minDistance,Math.min(r.maxDistance,z))}function ue(z){E.set(z.clientX,z.clientY)}function Te(z){Y(z),R.set(z.clientX,z.clientY)}function _e(z){S.set(z.clientX,z.clientY)}function Re(z){b.set(z.clientX,z.clientY),y.subVectors(b,E).multiplyScalar(r.rotateSpeed);const Ae=r.domElement;Ae&&(ne(2*Math.PI*y.x/Ae.clientHeight),pe(2*Math.PI*y.y/Ae.clientHeight)),E.copy(b),r.update()}function De(z){I.set(z.clientX,z.clientY),O.subVectors(I,R),O.y>0?K(ae()):O.y<0&&se(ae()),R.copy(I),r.update()}function et(z){A.set(z.clientX,z.clientY),C.subVectors(A,S).multiplyScalar(r.panSpeed),H(C.x,C.y),S.copy(A),r.update()}function Ue(z){Y(z),z.deltaY<0?se(ae()):z.deltaY>0&&K(ae()),r.update()}function Le(z){let Ae=!1;switch(z.code){case r.keys.UP:H(0,r.keyPanSpeed),Ae=!0;break;case r.keys.BOTTOM:H(0,-r.keyPanSpeed),Ae=!0;break;case r.keys.LEFT:H(r.keyPanSpeed,0),Ae=!0;break;case r.keys.RIGHT:H(-r.keyPanSpeed,0),Ae=!0;break}Ae&&(z.preventDefault(),r.update())}function re(){if(U.length==1)E.set(U[0].pageX,U[0].pageY);else{const z=.5*(U[0].pageX+U[1].pageX),Ae=.5*(U[0].pageY+U[1].pageY);E.set(z,Ae)}}function Ye(){if(U.length==1)S.set(U[0].pageX,U[0].pageY);else{const z=.5*(U[0].pageX+U[1].pageX),Ae=.5*(U[0].pageY+U[1].pageY);S.set(z,Ae)}}function Fe(){const z=U[0].pageX-U[1].pageX,Ae=U[0].pageY-U[1].pageY,tt=Math.sqrt(z*z+Ae*Ae);R.set(0,tt)}function Ze(){r.enableZoom&&Fe(),r.enablePan&&Ye()}function Xe(){r.enableZoom&&Fe(),r.enableRotate&&re()}function dt(z){if(U.length==1)b.set(z.pageX,z.pageY);else{const tt=fe(z),ye=.5*(z.pageX+tt.x),Ie=.5*(z.pageY+tt.y);b.set(ye,Ie)}y.subVectors(b,E).multiplyScalar(r.rotateSpeed);const Ae=r.domElement;Ae&&(ne(2*Math.PI*y.x/Ae.clientHeight),pe(2*Math.PI*y.y/Ae.clientHeight)),E.copy(b)}function je(z){if(U.length==1)A.set(z.pageX,z.pageY);else{const Ae=fe(z),tt=.5*(z.pageX+Ae.x),ye=.5*(z.pageY+Ae.y);A.set(tt,ye)}C.subVectors(A,S).multiplyScalar(r.panSpeed),H(C.x,C.y),S.copy(A)}function it(z){const Ae=fe(z),tt=z.pageX-Ae.x,ye=z.pageY-Ae.y,Ie=Math.sqrt(tt*tt+ye*ye);I.set(0,Ie),O.set(0,Math.pow(I.y/R.y,r.zoomSpeed)),K(O.y),R.copy(I)}function Ce(z){r.enableZoom&&it(z),r.enablePan&&je(z)}function Me(z){r.enableZoom&&it(z),r.enableRotate&&dt(z)}function St(z){var Ae,tt;r.enabled!==!1&&(U.length===0&&((Ae=r.domElement)==null||Ae.ownerDocument.addEventListener("pointermove",oe),(tt=r.domElement)==null||tt.ownerDocument.addEventListener("pointerup",ee)),$t(z),z.pointerType==="touch"?ut(z):W(z))}function oe(z){r.enabled!==!1&&(z.pointerType==="touch"?ft(z):ot(z))}function ee(z){var Ae,tt,ye;L(z),U.length===0&&((Ae=r.domElement)==null||Ae.releasePointerCapture(z.pointerId),(tt=r.domElement)==null||tt.ownerDocument.removeEventListener("pointermove",oe),(ye=r.domElement)==null||ye.ownerDocument.removeEventListener("pointerup",ee)),r.dispatchEvent(l),d=u.NONE}function W(z){let Ae;switch(z.button){case 0:Ae=r.mouseButtons.LEFT;break;case 1:Ae=r.mouseButtons.MIDDLE;break;case 2:Ae=r.mouseButtons.RIGHT;break;default:Ae=-1}switch(Ae){case Df.DOLLY:if(r.enableZoom===!1)return;Te(z),d=u.DOLLY;break;case Df.ROTATE:if(z.ctrlKey||z.metaKey||z.shiftKey){if(r.enablePan===!1)return;_e(z),d=u.PAN}else{if(r.enableRotate===!1)return;ue(z),d=u.ROTATE}break;case Df.PAN:if(z.ctrlKey||z.metaKey||z.shiftKey){if(r.enableRotate===!1)return;ue(z),d=u.ROTATE}else{if(r.enablePan===!1)return;_e(z),d=u.PAN}break;default:d=u.NONE}d!==u.NONE&&r.dispatchEvent(a)}function ot(z){if(r.enabled!==!1)switch(d){case u.ROTATE:if(r.enableRotate===!1)return;Re(z);break;case u.DOLLY:if(r.enableZoom===!1)return;De(z);break;case u.PAN:if(r.enablePan===!1)return;et(z);break}}function ze(z){r.enabled===!1||r.enableZoom===!1||d!==u.NONE&&d!==u.ROTATE||(z.preventDefault(),r.dispatchEvent(a),Ue(z),r.dispatchEvent(l))}function qe(z){r.enabled===!1||r.enablePan===!1||Le(z)}function ut(z){switch(X(z),U.length){case 1:switch(r.touches.ONE){case Bf.ROTATE:if(r.enableRotate===!1)return;re(),d=u.TOUCH_ROTATE;break;case Bf.PAN:if(r.enablePan===!1)return;Ye(),d=u.TOUCH_PAN;break;default:d=u.NONE}break;case 2:switch(r.touches.TWO){case Bf.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Ze(),d=u.TOUCH_DOLLY_PAN;break;case Bf.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Xe(),d=u.TOUCH_DOLLY_ROTATE;break;default:d=u.NONE}break;default:d=u.NONE}d!==u.NONE&&r.dispatchEvent(a)}function ft(z){switch(X(z),d){case u.TOUCH_ROTATE:if(r.enableRotate===!1)return;dt(z),r.update();break;case u.TOUCH_PAN:if(r.enablePan===!1)return;je(z),r.update();break;case u.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Ce(z),r.update();break;case u.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Me(z),r.update();break;default:d=u.NONE}}function Ge(z){r.enabled!==!1&&z.preventDefault()}function $t(z){U.push(z)}function L(z){delete ce[z.pointerId];for(let Ae=0;Ae<U.length;Ae++)if(U[Ae].pointerId==z.pointerId){U.splice(Ae,1);return}}function X(z){let Ae=ce[z.pointerId];Ae===void 0&&(Ae=new mt,ce[z.pointerId]=Ae),Ae.set(z.pageX,z.pageY)}function fe(z){const Ae=z.pointerId===U[0].pointerId?U[1]:U[0];return ce[Ae.pointerId]}this.dollyIn=(z=ae())=>{se(z),r.update()},this.dollyOut=(z=ae())=>{K(z),r.update()},this.getScale=()=>m,this.setScale=z=>{J(z),r.update()},this.getZoomScale=()=>ae(),n!==void 0&&this.connect(n),this.update()}};function YS(i){if(typeof TextDecoder<"u")return new TextDecoder().decode(i);let e="";for(let n=0,r=i.length;n<r;n++)e+=String.fromCharCode(i[n]);try{return decodeURIComponent(escape(e))}catch{return e}}const Zf="srgb",xu="srgb-linear",$k=3001,PY=3e3;let ZM=class extends as{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new GY(n)}),this.register(function(n){return new HY(n)}),this.register(function(n){return new ZY(n)}),this.register(function(n){return new qY(n)}),this.register(function(n){return new QY(n)}),this.register(function(n){return new zY(n)}),this.register(function(n){return new WY(n)}),this.register(function(n){return new XY(n)}),this.register(function(n){return new jY(n)}),this.register(function(n){return new UY(n)}),this.register(function(n){return new YY(n)}),this.register(function(n){return new VY(n)}),this.register(function(n){return new JY(n)}),this.register(function(n){return new KY(n)}),this.register(function(n){return new BY(n)}),this.register(function(n){return new eK(n)}),this.register(function(n){return new tK(n)})}load(e,n,r,s){const a=this;let l;if(this.resourcePath!=="")l=this.resourcePath;else if(this.path!==""){const h=Nl.extractUrlBase(e);l=Nl.resolveURL(h,this.path)}else l=Nl.extractUrlBase(e);this.manager.itemStart(e);const u=function(h){s?s(h):console.error(h),a.manager.itemError(e),a.manager.itemEnd(e)},d=new Lr(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,function(h){try{a.parse(h,l,function(f){n(f),a.manager.itemEnd(e)},u)}catch(f){u(f)}},r,u)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,r,s){let a;const l={},u={};if(typeof e=="string")a=JSON.parse(e);else if(e instanceof ArrayBuffer)if(YS(new Uint8Array(e.slice(0,4)))===qU){try{l[Un.KHR_BINARY_GLTF]=new nK(e)}catch(f){s&&s(f);return}a=JSON.parse(l[Un.KHR_BINARY_GLTF].content)}else a=JSON.parse(YS(new Uint8Array(e)));else a=e;if(a.asset===void 0||a.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const d=new mK(a,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const f=this.pluginCallbacks[h](d);f.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),u[f.name]=f,l[f.name]=!0}if(a.extensionsUsed)for(let h=0;h<a.extensionsUsed.length;++h){const f=a.extensionsUsed[h],p=a.extensionsRequired||[];switch(f){case Un.KHR_MATERIALS_UNLIT:l[f]=new FY;break;case Un.KHR_DRACO_MESH_COMPRESSION:l[f]=new iK(a,this.dracoLoader);break;case Un.KHR_TEXTURE_TRANSFORM:l[f]=new rK;break;case Un.KHR_MESH_QUANTIZATION:l[f]=new sK;break;default:p.indexOf(f)>=0&&u[f]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}d.setExtensions(l),d.setPlugins(u),d.parse(r,s)}parseAsync(e,n){const r=this;return new Promise(function(s,a){r.parse(e,n,s,a)})}};function DY(){let i={};return{get:function(e){return i[e]},add:function(e,n){i[e]=n},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const Un={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};let BY=class{constructor(e){this.parser=e,this.name=Un.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let r=0,s=n.length;r<s;r++){const a=n[r];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,a.extensions[this.name].light)}}_loadLight(e){const n=this.parser,r="light:"+e;let s=n.cache.get(r);if(s)return s;const a=n.json,d=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let h;const f=new Ct(16777215);d.color!==void 0&&f.setRGB(d.color[0],d.color[1],d.color[2],xu);const p=d.range!==void 0?d.range:0;switch(d.type){case"directional":h=new j$(f),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new X$(f),h.distance=p;break;case"spot":h=new W$(f),h.distance=p,d.spot=d.spot||{},d.spot.innerConeAngle=d.spot.innerConeAngle!==void 0?d.spot.innerConeAngle:0,d.spot.outerConeAngle=d.spot.outerConeAngle!==void 0?d.spot.outerConeAngle:Math.PI/4,h.angle=d.spot.outerConeAngle,h.penumbra=1-d.spot.innerConeAngle/d.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+d.type)}return h.position.set(0,0,0),h.decay=2,vu(h,d),d.intensity!==void 0&&(h.intensity=d.intensity),h.name=n.createUniqueName(d.name||"light_"+e),s=Promise.resolve(h),n.cache.add(r,s),s}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,r=this.parser,a=r.json.nodes[e],u=(a.extensions&&a.extensions[this.name]||{}).light;return u===void 0?null:this._loadLight(u).then(function(d){return r._getNodeRef(n.cache,u,d)})}},FY=class{constructor(){this.name=Un.KHR_MATERIALS_UNLIT}getMaterialType(){return ii}extendParams(e,n,r){const s=[];e.color=new Ct(1,1,1),e.opacity=1;const a=n.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const l=a.baseColorFactor;e.color.setRGB(l[0],l[1],l[2],xu),e.opacity=l[3]}a.baseColorTexture!==void 0&&s.push(r.assignTexture(e,"map",a.baseColorTexture,Zf))}return Promise.all(s)}},UY=class{constructor(e){this.parser=e,this.name=Un.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name].emissiveStrength;return a!==void 0&&(n.emissiveIntensity=a),Promise.resolve()}},GY=class{constructor(e){this.parser=e,this.name=Un.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],l=s.extensions[this.name];if(l.clearcoatFactor!==void 0&&(n.clearcoat=l.clearcoatFactor),l.clearcoatTexture!==void 0&&a.push(r.assignTexture(n,"clearcoatMap",l.clearcoatTexture)),l.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=l.clearcoatRoughnessFactor),l.clearcoatRoughnessTexture!==void 0&&a.push(r.assignTexture(n,"clearcoatRoughnessMap",l.clearcoatRoughnessTexture)),l.clearcoatNormalTexture!==void 0&&(a.push(r.assignTexture(n,"clearcoatNormalMap",l.clearcoatNormalTexture)),l.clearcoatNormalTexture.scale!==void 0)){const u=l.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new mt(u,u)}return Promise.all(a)}};class HY{constructor(e){this.parser=e,this.name=Un.KHR_MATERIALS_DISPERSION}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return n.dispersion=a.dispersion!==void 0?a.dispersion:0,Promise.resolve()}}let VY=class{constructor(e){this.parser=e,this.name=Un.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],l=s.extensions[this.name];return l.iridescenceFactor!==void 0&&(n.iridescence=l.iridescenceFactor),l.iridescenceTexture!==void 0&&a.push(r.assignTexture(n,"iridescenceMap",l.iridescenceTexture)),l.iridescenceIor!==void 0&&(n.iridescenceIOR=l.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),l.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=l.iridescenceThicknessMinimum),l.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=l.iridescenceThicknessMaximum),l.iridescenceThicknessTexture!==void 0&&a.push(r.assignTexture(n,"iridescenceThicknessMap",l.iridescenceThicknessTexture)),Promise.all(a)}},zY=class{constructor(e){this.parser=e,this.name=Un.KHR_MATERIALS_SHEEN}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[];n.sheenColor=new Ct(0,0,0),n.sheenRoughness=0,n.sheen=1;const l=s.extensions[this.name];if(l.sheenColorFactor!==void 0){const u=l.sheenColorFactor;n.sheenColor.setRGB(u[0],u[1],u[2],xu)}return l.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=l.sheenRoughnessFactor),l.sheenColorTexture!==void 0&&a.push(r.assignTexture(n,"sheenColorMap",l.sheenColorTexture,Zf)),l.sheenRoughnessTexture!==void 0&&a.push(r.assignTexture(n,"sheenRoughnessMap",l.sheenRoughnessTexture)),Promise.all(a)}},WY=class{constructor(e){this.parser=e,this.name=Un.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],l=s.extensions[this.name];return l.transmissionFactor!==void 0&&(n.transmission=l.transmissionFactor),l.transmissionTexture!==void 0&&a.push(r.assignTexture(n,"transmissionMap",l.transmissionTexture)),Promise.all(a)}},XY=class{constructor(e){this.parser=e,this.name=Un.KHR_MATERIALS_VOLUME}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],l=s.extensions[this.name];n.thickness=l.thicknessFactor!==void 0?l.thicknessFactor:0,l.thicknessTexture!==void 0&&a.push(r.assignTexture(n,"thicknessMap",l.thicknessTexture)),n.attenuationDistance=l.attenuationDistance||1/0;const u=l.attenuationColor||[1,1,1];return n.attenuationColor=new Ct().setRGB(u[0],u[1],u[2],xu),Promise.all(a)}},jY=class{constructor(e){this.parser=e,this.name=Un.KHR_MATERIALS_IOR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return n.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}},YY=class{constructor(e){this.parser=e,this.name=Un.KHR_MATERIALS_SPECULAR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],l=s.extensions[this.name];n.specularIntensity=l.specularFactor!==void 0?l.specularFactor:1,l.specularTexture!==void 0&&a.push(r.assignTexture(n,"specularIntensityMap",l.specularTexture));const u=l.specularColorFactor||[1,1,1];return n.specularColor=new Ct().setRGB(u[0],u[1],u[2],xu),l.specularColorTexture!==void 0&&a.push(r.assignTexture(n,"specularColorMap",l.specularColorTexture,Zf)),Promise.all(a)}};class KY{constructor(e){this.parser=e,this.name=Un.EXT_MATERIALS_BUMP}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],l=s.extensions[this.name];return n.bumpScale=l.bumpFactor!==void 0?l.bumpFactor:1,l.bumpTexture!==void 0&&a.push(r.assignTexture(n,"bumpMap",l.bumpTexture)),Promise.all(a)}}let JY=class{constructor(e){this.parser=e,this.name=Un.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],l=s.extensions[this.name];return l.anisotropyStrength!==void 0&&(n.anisotropy=l.anisotropyStrength),l.anisotropyRotation!==void 0&&(n.anisotropyRotation=l.anisotropyRotation),l.anisotropyTexture!==void 0&&a.push(r.assignTexture(n,"anisotropyMap",l.anisotropyTexture)),Promise.all(a)}},ZY=class{constructor(e){this.parser=e,this.name=Un.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const a=s.extensions[this.name],l=n.options.ktx2Loader;if(!l){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,a.source,l)}},qY=class{constructor(e){this.parser=e,this.name=Un.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,r=this.parser,s=r.json,a=s.textures[e];if(!a.extensions||!a.extensions[n])return null;const l=a.extensions[n],u=s.images[l.source];let d=r.textureLoader;if(u.uri){const h=r.options.manager.getHandler(u.uri);h!==null&&(d=h)}return this.detectSupport().then(function(h){if(h)return r.loadTextureImage(e,l.source,d);if(s.extensionsRequired&&s.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}},QY=class{constructor(e){this.parser=e,this.name=Un.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const n=this.name,r=this.parser,s=r.json,a=s.textures[e];if(!a.extensions||!a.extensions[n])return null;const l=a.extensions[n],u=s.images[l.source];let d=r.textureLoader;if(u.uri){const h=r.options.manager.getHandler(u.uri);h!==null&&(d=h)}return this.detectSupport().then(function(h){if(h)return r.loadTextureImage(e,l.source,d);if(s.extensionsRequired&&s.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}},eK=class{constructor(e){this.name=Un.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,r=n.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const s=r.extensions[this.name],a=this.parser.getDependency("buffer",s.buffer),l=this.parser.options.meshoptDecoder;if(!l||!l.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return a.then(function(u){const d=s.byteOffset||0,h=s.byteLength||0,f=s.count,p=s.byteStride,m=new Uint8Array(u,d,h);return l.decodeGltfBufferAsync?l.decodeGltfBufferAsync(f,p,m,s.mode,s.filter).then(function(T){return T.buffer}):l.ready.then(function(){const T=new ArrayBuffer(f*p);return l.decodeGltfBuffer(new Uint8Array(T),f,p,m,s.mode,s.filter),T})})}else return null}},tK=class{constructor(e){this.name=Un.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,r=n.nodes[e];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;const s=n.meshes[r.mesh];for(const h of s.primitives)if(h.mode!==Da.TRIANGLES&&h.mode!==Da.TRIANGLE_STRIP&&h.mode!==Da.TRIANGLE_FAN&&h.mode!==void 0)return null;const l=r.extensions[this.name].attributes,u=[],d={};for(const h in l)u.push(this.parser.getDependency("accessor",l[h]).then(f=>(d[h]=f,d[h])));return u.length<1?null:(u.push(this.parser.createNodeMesh(e)),Promise.all(u).then(h=>{const f=h.pop(),p=f.isGroup?f.children:[f],m=h[0].count,T=[];for(const E of p){const b=new pn,y=new te,S=new Er,A=new te(1,1,1),C=new B$(E.geometry,E.material,m);for(let R=0;R<m;R++)d.TRANSLATION&&y.fromBufferAttribute(d.TRANSLATION,R),d.ROTATION&&S.fromBufferAttribute(d.ROTATION,R),d.SCALE&&A.fromBufferAttribute(d.SCALE,R),C.setMatrixAt(R,b.compose(y,S,A));for(const R in d)if(R==="_COLOR_0"){const I=d[R];C.instanceColor=new ld(I.array,I.itemSize,I.normalized)}else R!=="TRANSLATION"&&R!=="ROTATION"&&R!=="SCALE"&&E.geometry.setAttribute(R,d[R]);Xn.prototype.copy.call(C,E),this.parser.assignFinalMaterial(C),T.push(C)}return f.isGroup?(f.clear(),f.add(...T),f):T[0]}))}};const qU="glTF",jv=12,bk={JSON:1313821514,BIN:5130562};let nK=class{constructor(e){this.name=Un.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,jv);if(this.header={magic:YS(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==qU)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-jv,s=new DataView(e,jv);let a=0;for(;a<r;){const l=s.getUint32(a,!0);a+=4;const u=s.getUint32(a,!0);if(a+=4,u===bk.JSON){const d=new Uint8Array(e,jv+a,l);this.content=YS(d)}else if(u===bk.BIN){const d=jv+a;this.body=e.slice(d,d+l)}a+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},iK=class{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Un.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const r=this.json,s=this.dracoLoader,a=e.extensions[this.name].bufferView,l=e.extensions[this.name].attributes,u={},d={},h={};for(const f in l){const p=ZR[f]||f.toLowerCase();u[p]=l[f]}for(const f in e.attributes){const p=ZR[f]||f.toLowerCase();if(l[f]!==void 0){const m=r.accessors[e.attributes[f]],T=Lg[m.componentType];h[p]=T.name,d[p]=m.normalized===!0}}return n.getDependency("bufferView",a).then(function(f){return new Promise(function(p,m){s.decodeDracoFile(f,function(T){for(const E in T.attributes){const b=T.attributes[E],y=d[E];y!==void 0&&(b.normalized=y)}p(T)},u,h,xu,m)})})}},rK=class{constructor(){this.name=Un.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord===void 0||n.texCoord===e.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}},sK=class{constructor(){this.name=Un.KHR_MESH_QUANTIZATION}},QU=class extends Np{constructor(e,n,r,s){super(e,n,r,s)}copySampleValue_(e){const n=this.resultBuffer,r=this.sampleValues,s=this.valueSize,a=e*s*3+s;for(let l=0;l!==s;l++)n[l]=r[a+l];return n}interpolate_(e,n,r,s){const a=this.resultBuffer,l=this.sampleValues,u=this.valueSize,d=u*2,h=u*3,f=s-n,p=(r-n)/f,m=p*p,T=m*p,E=e*h,b=E-h,y=-2*T+3*m,S=T-m,A=1-y,C=S-m+p;for(let R=0;R!==u;R++){const I=l[b+R+u],O=l[b+R+d]*f,F=l[E+R+u],k=l[E+R]*f;a[R]=A*I+C*O+y*F+S*k}return a}};const oK=new Er;let aK=class extends QU{interpolate_(e,n,r,s){const a=super.interpolate_(e,n,r,s);return oK.fromArray(a).normalize().toArray(a),a}};const Da={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Lg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ak={9728:tr,9729:Gn,9984:zg,9985:vE,9986:ip,9987:Ka},Ck={33071:Pi,33648:Ep,10497:Pl},jC={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ZR={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...zU>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ph={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},lK={CUBICSPLINE:void 0,LINEAR:Lu,STEP:Sp},YC={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function cK(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new Lp({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ya})),i.DefaultMaterial}function Of(i,e,n){for(const r in n.extensions)i[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=n.extensions[r])}function vu(i,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(i.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function uK(i,e,n){let r=!1,s=!1,a=!1;for(let h=0,f=e.length;h<f;h++){const p=e[h];if(p.POSITION!==void 0&&(r=!0),p.NORMAL!==void 0&&(s=!0),p.COLOR_0!==void 0&&(a=!0),r&&s&&a)break}if(!r&&!s&&!a)return Promise.resolve(i);const l=[],u=[],d=[];for(let h=0,f=e.length;h<f;h++){const p=e[h];if(r){const m=p.POSITION!==void 0?n.getDependency("accessor",p.POSITION):i.attributes.position;l.push(m)}if(s){const m=p.NORMAL!==void 0?n.getDependency("accessor",p.NORMAL):i.attributes.normal;u.push(m)}if(a){const m=p.COLOR_0!==void 0?n.getDependency("accessor",p.COLOR_0):i.attributes.color;d.push(m)}}return Promise.all([Promise.all(l),Promise.all(u),Promise.all(d)]).then(function(h){const f=h[0],p=h[1],m=h[2];return r&&(i.morphAttributes.position=f),s&&(i.morphAttributes.normal=p),a&&(i.morphAttributes.color=m),i.morphTargetsRelative=!0,i})}function hK(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let n=0,r=e.weights.length;n<r;n++)i.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(i.morphTargetInfluences.length===n.length){i.morphTargetDictionary={};for(let r=0,s=n.length;r<s;r++)i.morphTargetDictionary[n[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function dK(i){let e;const n=i.extensions&&i.extensions[Un.KHR_DRACO_MESH_COMPRESSION];if(n?e="draco:"+n.bufferView+":"+n.indices+":"+KC(n.attributes):e=i.indices+":"+KC(i.attributes)+":"+i.mode,i.targets!==void 0)for(let r=0,s=i.targets.length;r<s;r++)e+=":"+KC(i.targets[r]);return e}function KC(i){let e="";const n=Object.keys(i).sort();for(let r=0,s=n.length;r<s;r++)e+=n[r]+":"+i[n[r]]+";";return e}function qR(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function fK(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const pK=new pn;let mK=class{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new DY,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,s=!1,a=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,a=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||r||s&&a<98?this.textureLoader=new BM(this.options.manager):this.textureLoader=new UM(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Lr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const r=this,s=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(l){return l._markDefs&&l._markDefs()}),Promise.all(this._invokeAll(function(l){return l.beforeRoot&&l.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(l){const u={scene:l[0][s.scene||0],scenes:l[0],animations:l[1],cameras:l[2],asset:s.asset,parser:r,userData:{}};return Of(a,u,s),vu(u,s),Promise.all(r._invokeAll(function(d){return d.afterRoot&&d.afterRoot(u)})).then(function(){for(const d of u.scenes)d.updateMatrixWorld();e(u)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],r=this.json.meshes||[];for(let s=0,a=n.length;s<a;s++){const l=n[s].joints;for(let u=0,d=l.length;u<d;u++)e[l[u]].isBone=!0}for(let s=0,a=e.length;s<a;s++){const l=e[s];l.mesh!==void 0&&(this._addNodeRef(this.meshCache,l.mesh),l.skin!==void 0&&(r[l.mesh].isSkinnedMesh=!0)),l.camera!==void 0&&this._addNodeRef(this.cameraCache,l.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,r){if(e.refs[n]<=1)return r;const s=r.clone(),a=(l,u)=>{const d=this.associations.get(l);d!=null&&this.associations.set(u,d);for(const[h,f]of l.children.entries())a(f,u.children[h])};return a(r,s),s.name+="_instance_"+e.uses[n]++,s}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let r=0;r<n.length;r++){const s=e(n[r]);if(s)return s}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const r=[];for(let s=0;s<n.length;s++){const a=e(n[s]);a&&r.push(a)}return r}getDependency(e,n){const r=e+":"+n;let s=this.cache.get(r);if(!s){switch(e){case"scene":s=this.loadScene(n);break;case"node":s=this._invokeOne(function(a){return a.loadNode&&a.loadNode(n)});break;case"mesh":s=this._invokeOne(function(a){return a.loadMesh&&a.loadMesh(n)});break;case"accessor":s=this.loadAccessor(n);break;case"bufferView":s=this._invokeOne(function(a){return a.loadBufferView&&a.loadBufferView(n)});break;case"buffer":s=this.loadBuffer(n);break;case"material":s=this._invokeOne(function(a){return a.loadMaterial&&a.loadMaterial(n)});break;case"texture":s=this._invokeOne(function(a){return a.loadTexture&&a.loadTexture(n)});break;case"skin":s=this.loadSkin(n);break;case"animation":s=this._invokeOne(function(a){return a.loadAnimation&&a.loadAnimation(n)});break;case"camera":s=this.loadCamera(n);break;default:if(s=this._invokeOne(function(a){return a!=this&&a.getDependency&&a.getDependency(e,n)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(r,s)}return s}getDependencies(e){let n=this.cache.get(e);if(!n){const r=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(s.map(function(a,l){return r.getDependency(e,l)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],r=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[Un.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(a,l){r.load(Nl.resolveURL(n.uri,s.path),a,void 0,function(){l(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(r){const s=n.byteLength||0,a=n.byteOffset||0;return r.slice(a,a+s)})}loadAccessor(e){const n=this,r=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const l=jC[s.type],u=Lg[s.componentType],d=s.normalized===!0,h=new u(s.count*l);return Promise.resolve(new Qn(h,l,d))}const a=[];return s.bufferView!==void 0?a.push(this.getDependency("bufferView",s.bufferView)):a.push(null),s.sparse!==void 0&&(a.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(a).then(function(l){const u=l[0],d=jC[s.type],h=Lg[s.componentType],f=h.BYTES_PER_ELEMENT,p=f*d,m=s.byteOffset||0,T=s.bufferView!==void 0?r.bufferViews[s.bufferView].byteStride:void 0,E=s.normalized===!0;let b,y;if(T&&T!==p){const S=Math.floor(m/T),A="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+S+":"+s.count;let C=n.cache.get(A);C||(b=new h(u,S*T,s.count*T/f),C=new t_(b,T/f),n.cache.add(A,C)),y=new lo(C,d,m%T/f,E)}else u===null?b=new h(s.count*d):b=new h(u,m,s.count*d),y=new Qn(b,d,E);if(s.sparse!==void 0){const S=jC.SCALAR,A=Lg[s.sparse.indices.componentType],C=s.sparse.indices.byteOffset||0,R=s.sparse.values.byteOffset||0,I=new A(l[1],C,s.sparse.count*S),O=new h(l[2],R,s.sparse.count*d);u!==null&&(y=new Qn(y.array.slice(),y.itemSize,y.normalized));for(let F=0,k=I.length;F<k;F++){const D=I[F];if(y.setX(D,O[F*d]),d>=2&&y.setY(D,O[F*d+1]),d>=3&&y.setZ(D,O[F*d+2]),d>=4&&y.setW(D,O[F*d+3]),d>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return y})}loadTexture(e){const n=this.json,r=this.options,a=n.textures[e].source,l=n.images[a];let u=this.textureLoader;if(l.uri){const d=r.manager.getHandler(l.uri);d!==null&&(u=d)}return this.loadTextureImage(e,a,u)}loadTextureImage(e,n,r){const s=this,a=this.json,l=a.textures[e],u=a.images[n],d=(u.uri||u.bufferView)+":"+l.sampler;if(this.textureCache[d])return this.textureCache[d];const h=this.loadImageSource(n,r).then(function(f){f.flipY=!1,f.name=l.name||u.name||"",f.name===""&&typeof u.uri=="string"&&u.uri.startsWith("data:image/")===!1&&(f.name=u.uri);const m=(a.samplers||{})[l.sampler]||{};return f.magFilter=Ak[m.magFilter]||Gn,f.minFilter=Ak[m.minFilter]||Ka,f.wrapS=Ck[m.wrapS]||Pl,f.wrapT=Ck[m.wrapT]||Pl,s.associations.set(f,{textures:e}),f}).catch(function(){return null});return this.textureCache[d]=h,h}loadImageSource(e,n){const r=this,s=this.json,a=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(p=>p.clone());const l=s.images[e],u=self.URL||self.webkitURL;let d=l.uri||"",h=!1;if(l.bufferView!==void 0)d=r.getDependency("bufferView",l.bufferView).then(function(p){h=!0;const m=new Blob([p],{type:l.mimeType});return d=u.createObjectURL(m),d});else if(l.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(d).then(function(p){return new Promise(function(m,T){let E=m;n.isImageBitmapLoader===!0&&(E=function(b){const y=new ni(b);y.needsUpdate=!0,m(y)}),n.load(Nl.resolveURL(p,a.path),E,void 0,T)})}).then(function(p){return h===!0&&u.revokeObjectURL(d),vu(p,l),p.userData.mimeType=l.mimeType||fK(l.uri),p}).catch(function(p){throw console.error("THREE.GLTFLoader: Couldn't load texture",d),p});return this.sourceCache[e]=f,f}assignTexture(e,n,r,s){const a=this;return this.getDependency("texture",r.index).then(function(l){if(!l)return null;if(r.texCoord!==void 0&&r.texCoord>0&&(l=l.clone(),l.channel=r.texCoord),a.extensions[Un.KHR_TEXTURE_TRANSFORM]){const u=r.extensions!==void 0?r.extensions[Un.KHR_TEXTURE_TRANSFORM]:void 0;if(u){const d=a.associations.get(l);l=a.extensions[Un.KHR_TEXTURE_TRANSFORM].extendTexture(l,u),a.associations.set(l,d)}}return s!==void 0&&(typeof s=="number"&&(s=s===$k?Zf:xu),"colorSpace"in l?l.colorSpace=s:l.encoding=s===Zf?$k:PY),e[n]=l,l})}assignFinalMaterial(e){const n=e.geometry;let r=e.material;const s=n.attributes.tangent===void 0,a=n.attributes.color!==void 0,l=n.attributes.normal===void 0;if(e.isPoints){const u="PointsMaterial:"+r.uuid;let d=this.cache.get(u);d||(d=new bE,rr.prototype.copy.call(d,r),d.color.copy(r.color),d.map=r.map,d.sizeAttenuation=!1,this.cache.add(u,d)),r=d}else if(e.isLine){const u="LineBasicMaterial:"+r.uuid;let d=this.cache.get(u);d||(d=new fi,rr.prototype.copy.call(d,r),d.color.copy(r.color),d.map=r.map,this.cache.add(u,d)),r=d}if(s||a||l){let u="ClonedMaterial:"+r.uuid+":";s&&(u+="derivative-tangents:"),a&&(u+="vertex-colors:"),l&&(u+="flat-shading:");let d=this.cache.get(u);d||(d=r.clone(),a&&(d.vertexColors=!0),l&&(d.flatShading=!0),s&&(d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(u,d),this.associations.set(d,this.associations.get(r))),r=d}e.material=r}getMaterialType(){return Lp}loadMaterial(e){const n=this,r=this.json,s=this.extensions,a=r.materials[e];let l;const u={},d=a.extensions||{},h=[];if(d[Un.KHR_MATERIALS_UNLIT]){const p=s[Un.KHR_MATERIALS_UNLIT];l=p.getMaterialType(),h.push(p.extendParams(u,a,n))}else{const p=a.pbrMetallicRoughness||{};if(u.color=new Ct(1,1,1),u.opacity=1,Array.isArray(p.baseColorFactor)){const m=p.baseColorFactor;u.color.setRGB(m[0],m[1],m[2],xu),u.opacity=m[3]}p.baseColorTexture!==void 0&&h.push(n.assignTexture(u,"map",p.baseColorTexture,Zf)),u.metalness=p.metallicFactor!==void 0?p.metallicFactor:1,u.roughness=p.roughnessFactor!==void 0?p.roughnessFactor:1,p.metallicRoughnessTexture!==void 0&&(h.push(n.assignTexture(u,"metalnessMap",p.metallicRoughnessTexture)),h.push(n.assignTexture(u,"roughnessMap",p.metallicRoughnessTexture))),l=this._invokeOne(function(m){return m.getMaterialType&&m.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(m){return m.extendMaterialParams&&m.extendMaterialParams(e,u)})))}a.doubleSided===!0&&(u.side=Ss);const f=a.alphaMode||YC.OPAQUE;if(f===YC.BLEND?(u.transparent=!0,u.depthWrite=!1):(u.transparent=!1,f===YC.MASK&&(u.alphaTest=a.alphaCutoff!==void 0?a.alphaCutoff:.5)),a.normalTexture!==void 0&&l!==ii&&(h.push(n.assignTexture(u,"normalMap",a.normalTexture)),u.normalScale=new mt(1,1),a.normalTexture.scale!==void 0)){const p=a.normalTexture.scale;u.normalScale.set(p,p)}if(a.occlusionTexture!==void 0&&l!==ii&&(h.push(n.assignTexture(u,"aoMap",a.occlusionTexture)),a.occlusionTexture.strength!==void 0&&(u.aoMapIntensity=a.occlusionTexture.strength)),a.emissiveFactor!==void 0&&l!==ii){const p=a.emissiveFactor;u.emissive=new Ct().setRGB(p[0],p[1],p[2],xu)}return a.emissiveTexture!==void 0&&l!==ii&&h.push(n.assignTexture(u,"emissiveMap",a.emissiveTexture,Zf)),Promise.all(h).then(function(){const p=new l(u);return a.name&&(p.name=a.name),vu(p,a),n.associations.set(p,{materials:e}),a.extensions&&Of(s,p,a),p})}createUniqueName(e){const n=Zn.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,r=this.extensions,s=this.primitiveCache;function a(u){return r[Un.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(u,n).then(function(d){return xk(d,u,n)})}const l=[];for(let u=0,d=e.length;u<d;u++){const h=e[u],f=dK(h),p=s[f];if(p)l.push(p.promise);else{let m;h.extensions&&h.extensions[Un.KHR_DRACO_MESH_COMPRESSION]?m=a(h):m=xk(new rn,h,n),s[f]={primitive:h,promise:m},l.push(m)}}return Promise.all(l)}loadMesh(e){const n=this,r=this.json,s=this.extensions,a=r.meshes[e],l=a.primitives,u=[];for(let d=0,h=l.length;d<h;d++){const f=l[d].material===void 0?cK(this.cache):this.getDependency("material",l[d].material);u.push(f)}return u.push(n.loadGeometries(l)),Promise.all(u).then(function(d){const h=d.slice(0,d.length-1),f=d[d.length-1],p=[];for(let T=0,E=f.length;T<E;T++){const b=f[T],y=l[T];let S;const A=h[T];if(y.mode===Da.TRIANGLES||y.mode===Da.TRIANGLE_STRIP||y.mode===Da.TRIANGLE_FAN||y.mode===void 0)S=a.isSkinnedMesh===!0?new D$(b,A):new Pn(b,A),S.isSkinnedMesh===!0&&S.normalizeSkinWeights(),y.mode===Da.TRIANGLE_STRIP?S.geometry=Ek(S.geometry,TE):y.mode===Da.TRIANGLE_FAN&&(S.geometry=Ek(S.geometry,$p));else if(y.mode===Da.LINES)S=new Ja(b,A);else if(y.mode===Da.LINE_STRIP)S=new Ki(b,A);else if(y.mode===Da.LINE_LOOP)S=new F$(b,A);else if(y.mode===Da.POINTS)S=new U$(b,A);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(S.geometry.morphAttributes).length>0&&hK(S,a),S.name=n.createUniqueName(a.name||"mesh_"+e),vu(S,a),y.extensions&&Of(s,S,y),n.assignFinalMaterial(S),p.push(S)}for(let T=0,E=p.length;T<E;T++)n.associations.set(p[T],{meshes:e,primitives:T});if(p.length===1)return a.extensions&&Of(s,p[0],a),p[0];const m=new za;a.extensions&&Of(s,m,a),n.associations.set(m,{meshes:e});for(let T=0,E=p.length;T<E;T++)m.add(p[T]);return m})}loadCamera(e){let n;const r=this.json.cameras[e],s=r[r.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?n=new Ui(sp.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):r.type==="orthographic"&&(n=new ua(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),r.name&&(n.name=this.createUniqueName(r.name)),vu(n,r),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],r=[];for(let s=0,a=n.joints.length;s<a;s++)r.push(this._loadNodeShallow(n.joints[s]));return n.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",n.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(s){const a=s.pop(),l=s,u=[],d=[];for(let h=0,f=l.length;h<f;h++){const p=l[h];if(p){u.push(p);const m=new pn;a!==null&&m.fromArray(a.array,h*16),d.push(m)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[h])}return new n_(u,d)})}loadAnimation(e){const n=this.json,r=this,s=n.animations[e],a=s.name?s.name:"animation_"+e,l=[],u=[],d=[],h=[],f=[];for(let p=0,m=s.channels.length;p<m;p++){const T=s.channels[p],E=s.samplers[T.sampler],b=T.target,y=b.node,S=s.parameters!==void 0?s.parameters[E.input]:E.input,A=s.parameters!==void 0?s.parameters[E.output]:E.output;b.node!==void 0&&(l.push(this.getDependency("node",y)),u.push(this.getDependency("accessor",S)),d.push(this.getDependency("accessor",A)),h.push(E),f.push(b))}return Promise.all([Promise.all(l),Promise.all(u),Promise.all(d),Promise.all(h),Promise.all(f)]).then(function(p){const m=p[0],T=p[1],E=p[2],b=p[3],y=p[4],S=[];for(let A=0,C=m.length;A<C;A++){const R=m[A],I=T[A],O=E[A],F=b[A],k=y[A];if(R===void 0)continue;R.updateMatrix&&R.updateMatrix();const D=r._createAnimationTracks(R,I,O,F,k);if(D)for(let U=0;U<D.length;U++)S.push(D[U])}return new Ap(a,void 0,S)})}createNodeMesh(e){const n=this.json,r=this,s=n.nodes[e];return s.mesh===void 0?null:r.getDependency("mesh",s.mesh).then(function(a){const l=r._getNodeRef(r.meshCache,s.mesh,a);return s.weights!==void 0&&l.traverse(function(u){if(u.isMesh)for(let d=0,h=s.weights.length;d<h;d++)u.morphTargetInfluences[d]=s.weights[d]}),l})}loadNode(e){const n=this.json,r=this,s=n.nodes[e],a=r._loadNodeShallow(e),l=[],u=s.children||[];for(let h=0,f=u.length;h<f;h++)l.push(r.getDependency("node",u[h]));const d=s.skin===void 0?Promise.resolve(null):r.getDependency("skin",s.skin);return Promise.all([a,Promise.all(l),d]).then(function(h){const f=h[0],p=h[1],m=h[2];m!==null&&f.traverse(function(T){T.isSkinnedMesh&&T.bind(m,pK)});for(let T=0,E=p.length;T<E;T++)f.add(p[T]);return f})}_loadNodeShallow(e){const n=this.json,r=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const a=n.nodes[e],l=a.name?s.createUniqueName(a.name):"",u=[],d=s._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return d&&u.push(d),a.camera!==void 0&&u.push(s.getDependency("camera",a.camera).then(function(h){return s._getNodeRef(s.cameraCache,a.camera,h)})),s._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){u.push(h)}),this.nodeCache[e]=Promise.all(u).then(function(h){let f;if(a.isBone===!0?f=new $E:h.length>1?f=new za:h.length===1?f=h[0]:f=new Xn,f!==h[0])for(let p=0,m=h.length;p<m;p++)f.add(h[p]);if(a.name&&(f.userData.name=a.name,f.name=l),vu(f,a),a.extensions&&Of(r,f,a),a.matrix!==void 0){const p=new pn;p.fromArray(a.matrix),f.applyMatrix4(p)}else a.translation!==void 0&&f.position.fromArray(a.translation),a.rotation!==void 0&&f.quaternion.fromArray(a.rotation),a.scale!==void 0&&f.scale.fromArray(a.scale);return s.associations.has(f)||s.associations.set(f,{}),s.associations.get(f).nodes=e,f}),this.nodeCache[e]}loadScene(e){const n=this.extensions,r=this.json.scenes[e],s=this,a=new za;r.name&&(a.name=s.createUniqueName(r.name)),vu(a,r),r.extensions&&Of(n,a,r);const l=r.nodes||[],u=[];for(let d=0,h=l.length;d<h;d++)u.push(s.getDependency("node",l[d]));return Promise.all(u).then(function(d){for(let f=0,p=d.length;f<p;f++)a.add(d[f]);const h=f=>{const p=new Map;for(const[m,T]of s.associations)(m instanceof rr||m instanceof ni)&&p.set(m,T);return f.traverse(m=>{const T=s.associations.get(m);T!=null&&p.set(m,T)}),p};return s.associations=h(a),a})}_createAnimationTracks(e,n,r,s,a){const l=[],u=e.name?e.name:e.uuid,d=[];Ph[a.path]===Ph.weights?e.traverse(function(m){m.morphTargetInfluences&&d.push(m.name?m.name:m.uuid)}):d.push(u);let h;switch(Ph[a.path]){case Ph.weights:h=cd;break;case Ph.rotation:h=wc;break;case Ph.position:case Ph.scale:h=ud;break;default:switch(r.itemSize){case 1:h=cd;break;case 2:case 3:default:h=ud;break}break}const f=s.interpolation!==void 0?lK[s.interpolation]:Lu,p=this._getArrayFromAccessor(r);for(let m=0,T=d.length;m<T;m++){const E=new h(d[m]+"."+Ph[a.path],n.array,p,f);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(E),l.push(E)}return l}_getArrayFromAccessor(e){let n=e.array;if(e.normalized){const r=qR(n.constructor),s=new Float32Array(n.length);for(let a=0,l=n.length;a<l;a++)s[a]=n[a]*r;n=s}return n}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(r){const s=this instanceof wc?aK:QU;return new s(this.times,this.values,this.getValueSize()/3,r)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function gK(i,e,n){const r=e.attributes,s=new Xs;if(r.POSITION!==void 0){const u=n.json.accessors[r.POSITION],d=u.min,h=u.max;if(d!==void 0&&h!==void 0){if(s.set(new te(d[0],d[1],d[2]),new te(h[0],h[1],h[2])),u.normalized){const f=qR(Lg[u.componentType]);s.min.multiplyScalar(f),s.max.multiplyScalar(f)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const a=e.targets;if(a!==void 0){const u=new te,d=new te;for(let h=0,f=a.length;h<f;h++){const p=a[h];if(p.POSITION!==void 0){const m=n.json.accessors[p.POSITION],T=m.min,E=m.max;if(T!==void 0&&E!==void 0){if(d.setX(Math.max(Math.abs(T[0]),Math.abs(E[0]))),d.setY(Math.max(Math.abs(T[1]),Math.abs(E[1]))),d.setZ(Math.max(Math.abs(T[2]),Math.abs(E[2]))),m.normalized){const b=qR(Lg[m.componentType]);d.multiplyScalar(b)}u.max(d)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(u)}i.boundingBox=s;const l=new js;s.getCenter(l.center),l.radius=s.min.distanceTo(s.max)/2,i.boundingSphere=l}function xk(i,e,n){const r=e.attributes,s=[];function a(l,u){return n.getDependency("accessor",l).then(function(d){i.setAttribute(u,d)})}for(const l in r){const u=ZR[l]||l.toLowerCase();u in i.attributes||s.push(a(r[l],u))}if(e.indices!==void 0&&!i.index){const l=n.getDependency("accessor",e.indices).then(function(u){i.setIndex(u)});s.push(l)}return vu(i,e),gK(i,e,n),Promise.all(s).then(function(){return e.targets!==void 0?uK(i,e.targets,n):i})}class _K extends DM{constructor(e){super(e),this.type=ss}parse(e){const l=function(k,D){switch(k){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(D||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(D||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(D||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(D||""))}},f=`
`,p=function(k,D,U){D=D||1024;let ie=k.pos,ae=-1,ne=0,pe="",de=String.fromCharCode.apply(null,new Uint16Array(k.subarray(ie,ie+128)));for(;0>(ae=de.indexOf(f))&&ne<D&&ie<k.byteLength;)pe+=de,ne+=de.length,ie+=128,de+=String.fromCharCode.apply(null,new Uint16Array(k.subarray(ie,ie+128)));return-1<ae?(U!==!1&&(k.pos+=ne+ae+1),pe+de.slice(0,ae)):!1},m=function(k){const D=/^#\?(\S+)/,U=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,ce=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,ie=/^\s*FORMAT=(\S+)\s*$/,ae=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,ne={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let pe,de;for((k.pos>=k.byteLength||!(pe=p(k)))&&l(1,"no header found"),(de=pe.match(D))||l(3,"bad initial token"),ne.valid|=1,ne.programtype=de[1],ne.string+=pe+`
`;pe=p(k),pe!==!1;){if(ne.string+=pe+`
`,pe.charAt(0)==="#"){ne.comments+=pe+`
`;continue}if((de=pe.match(U))&&(ne.gamma=parseFloat(de[1])),(de=pe.match(ce))&&(ne.exposure=parseFloat(de[1])),(de=pe.match(ie))&&(ne.valid|=2,ne.format=de[1]),(de=pe.match(ae))&&(ne.valid|=4,ne.height=parseInt(de[1],10),ne.width=parseInt(de[2],10)),ne.valid&2&&ne.valid&4)break}return ne.valid&2||l(3,"missing format specifier"),ne.valid&4||l(3,"missing image size specifier"),ne},T=function(k,D,U){const ce=D;if(ce<8||ce>32767||k[0]!==2||k[1]!==2||k[2]&128)return new Uint8Array(k);ce!==(k[2]<<8|k[3])&&l(3,"wrong scanline width");const ie=new Uint8Array(4*D*U);ie.length||l(4,"unable to allocate buffer space");let ae=0,ne=0;const pe=4*ce,de=new Uint8Array(4),xe=new Uint8Array(pe);let H=U;for(;H>0&&ne<k.byteLength;){ne+4>k.byteLength&&l(1),de[0]=k[ne++],de[1]=k[ne++],de[2]=k[ne++],de[3]=k[ne++],(de[0]!=2||de[1]!=2||(de[2]<<8|de[3])!=ce)&&l(3,"bad rgbe scanline format");let J=0,K;for(;J<pe&&ne<k.byteLength;){K=k[ne++];const Y=K>128;if(Y&&(K-=128),(K===0||J+K>pe)&&l(3,"bad scanline data"),Y){const he=k[ne++];for(let ue=0;ue<K;ue++)xe[J++]=he}else xe.set(k.subarray(ne,ne+K),J),J+=K,ne+=K}const se=ce;for(let Y=0;Y<se;Y++){let he=0;ie[ae]=xe[Y+he],he+=ce,ie[ae+1]=xe[Y+he],he+=ce,ie[ae+2]=xe[Y+he],he+=ce,ie[ae+3]=xe[Y+he],ae+=4}H--}return ie},E=function(k,D,U,ce){const ie=k[D+3],ae=Math.pow(2,ie-128)/255;U[ce+0]=k[D+0]*ae,U[ce+1]=k[D+1]*ae,U[ce+2]=k[D+2]*ae,U[ce+3]=1},b=function(k,D,U,ce){const ie=k[D+3],ae=Math.pow(2,ie-128)/255;U[ce+0]=Kf.toHalfFloat(Math.min(k[D+0]*ae,65504)),U[ce+1]=Kf.toHalfFloat(Math.min(k[D+1]*ae,65504)),U[ce+2]=Kf.toHalfFloat(Math.min(k[D+2]*ae,65504)),U[ce+3]=Kf.toHalfFloat(1)},y=new Uint8Array(e);y.pos=0;const S=m(y),A=S.width,C=S.height,R=T(y.subarray(y.pos),A,C);let I,O,F;switch(this.type){case Kr:F=R.length/4;const k=new Float32Array(F*4);for(let U=0;U<F;U++)E(R,U*4,k,U*4);I=k,O=Kr;break;case ss:F=R.length/4;const D=new Uint16Array(F*4);for(let U=0;U<F;U++)b(R,U*4,D,U*4);I=D,O=ss;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:A,height:C,data:I,header:S.string,gamma:S.gamma,exposure:S.exposure,type:O}}setDataType(e){return this.type=e,this}load(e,n,r,s){function a(l,u){switch(l.type){case Kr:case ss:"colorSpace"in l?l.colorSpace="srgb-linear":l.encoding=3e3,l.minFilter=Gn,l.magFilter=Gn,l.generateMipmaps=!1,l.flipY=!0;break}n&&n(l,u)}return super.load(e,a,r,s)}}const Yv="colorSpace"in new ni;class vK extends DM{constructor(e){super(e),this.type=ss}parse(e){const D=Math.pow(2.7182818,2.2);function U(Z,B){for(var le=0,ve=0;ve<65536;++ve)(ve==0||Z[ve>>3]&1<<(ve&7))&&(B[le++]=ve);for(var me=le-1;le<65536;)B[le++]=0;return me}function ce(Z){for(var B=0;B<16384;B++)Z[B]={},Z[B].len=0,Z[B].lit=0,Z[B].p=null}const ie={l:0,c:0,lc:0};function ae(Z,B,le,ve,me){for(;le<Z;)B=B<<8|fe(ve,me),le+=8;le-=Z,ie.l=B>>le&(1<<Z)-1,ie.c=B,ie.lc=le}const ne=new Array(59);function pe(Z){for(var B=0;B<=58;++B)ne[B]=0;for(var B=0;B<65537;++B)ne[Z[B]]+=1;for(var le=0,B=58;B>0;--B){var ve=le+ne[B]>>1;ne[B]=le,le=ve}for(var B=0;B<65537;++B){var me=Z[B];me>0&&(Z[B]=me|ne[me]++<<6)}}function de(Z,B,le,ve,me,Se,Ke){for(var Je=le,at=0,rt=0;me<=Se;me++){if(Je.value-le.value>ve)return!1;ae(6,at,rt,Z,Je);var pt=ie.l;if(at=ie.c,rt=ie.lc,Ke[me]=pt,pt==63){if(Je.value-le.value>ve)throw"Something wrong with hufUnpackEncTable";ae(8,at,rt,Z,Je);var Ne=ie.l+6;if(at=ie.c,rt=ie.lc,me+Ne>Se+1)throw"Something wrong with hufUnpackEncTable";for(;Ne--;)Ke[me++]=0;me--}else if(pt>=59){var Ne=pt-59+2;if(me+Ne>Se+1)throw"Something wrong with hufUnpackEncTable";for(;Ne--;)Ke[me++]=0;me--}}pe(Ke)}function xe(Z){return Z&63}function H(Z){return Z>>6}function J(Z,B,le,ve){for(;B<=le;B++){var me=H(Z[B]),Se=xe(Z[B]);if(me>>Se)throw"Invalid table entry";if(Se>14){var Ke=ve[me>>Se-14];if(Ke.len)throw"Invalid table entry";if(Ke.lit++,Ke.p){var Je=Ke.p;Ke.p=new Array(Ke.lit);for(var at=0;at<Ke.lit-1;++at)Ke.p[at]=Je[at]}else Ke.p=new Array(1);Ke.p[Ke.lit-1]=B}else if(Se)for(var rt=0,at=1<<14-Se;at>0;at--){var Ke=ve[(me<<14-Se)+rt];if(Ke.len||Ke.p)throw"Invalid table entry";Ke.len=Se,Ke.lit=B,rt++}}return!0}const K={c:0,lc:0};function se(Z,B,le,ve){Z=Z<<8|fe(le,ve),B+=8,K.c=Z,K.lc=B}const Y={c:0,lc:0};function he(Z,B,le,ve,me,Se,Ke,Je,at,rt){if(Z==B){ve<8&&(se(le,ve,me,Ke),le=K.c,ve=K.lc),ve-=8;var pt=le>>ve,pt=new Uint8Array([pt])[0];if(at.value+pt>rt)return!1;for(var Ne=Je[at.value-1];pt-- >0;)Je[at.value++]=Ne}else if(at.value<rt)Je[at.value++]=Z;else return!1;Y.c=le,Y.lc=ve}function ue(Z){return Z&65535}function Te(Z){var B=ue(Z);return B>32767?B-65536:B}const _e={a:0,b:0};function Re(Z,B){var le=Te(Z),ve=Te(B),me=ve,Se=le+(me&1)+(me>>1),Ke=Se,Je=Se-me;_e.a=Ke,_e.b=Je}function De(Z,B){var le=ue(Z),ve=ue(B),me=le-(ve>>1)&65535,Se=ve+me-32768&65535;_e.a=Se,_e.b=me}function et(Z,B,le,ve,me,Se,Ke){for(var Je=Ke<16384,at=le>me?me:le,rt=1,pt;rt<=at;)rt<<=1;for(rt>>=1,pt=rt,rt>>=1;rt>=1;){for(var Ne=0,It=Ne+Se*(me-pt),xt=Se*rt,wt=Se*pt,Ht=ve*rt,Zt=ve*pt,jt,Ot,qt,Ft;Ne<=It;Ne+=wt){for(var ln=Ne,Bn=Ne+ve*(le-pt);ln<=Bn;ln+=Zt){var on=ln+Ht,bn=ln+xt,tn=bn+Ht;Je?(Re(Z[ln+B],Z[bn+B]),jt=_e.a,qt=_e.b,Re(Z[on+B],Z[tn+B]),Ot=_e.a,Ft=_e.b,Re(jt,Ot),Z[ln+B]=_e.a,Z[on+B]=_e.b,Re(qt,Ft),Z[bn+B]=_e.a,Z[tn+B]=_e.b):(De(Z[ln+B],Z[bn+B]),jt=_e.a,qt=_e.b,De(Z[on+B],Z[tn+B]),Ot=_e.a,Ft=_e.b,De(jt,Ot),Z[ln+B]=_e.a,Z[on+B]=_e.b,De(qt,Ft),Z[bn+B]=_e.a,Z[tn+B]=_e.b)}if(le&rt){var bn=ln+xt;Je?Re(Z[ln+B],Z[bn+B]):De(Z[ln+B],Z[bn+B]),jt=_e.a,Z[bn+B]=_e.b,Z[ln+B]=jt}}if(me&rt)for(var ln=Ne,Bn=Ne+ve*(le-pt);ln<=Bn;ln+=Zt){var on=ln+Ht;Je?Re(Z[ln+B],Z[on+B]):De(Z[ln+B],Z[on+B]),jt=_e.a,Z[on+B]=_e.b,Z[ln+B]=jt}pt=rt,rt>>=1}return Ne}function Ue(Z,B,le,ve,me,Se,Ke,Je,at,rt){for(var pt=0,Ne=0,It=Je,xt=Math.trunc(me.value+(Se+7)/8);me.value<xt;)for(se(pt,Ne,le,me),pt=K.c,Ne=K.lc;Ne>=14;){var wt=pt>>Ne-14&16383,Ht=B[wt];if(Ht.len)Ne-=Ht.len,he(Ht.lit,Ke,pt,Ne,le,ve,me,at,rt,It),pt=Y.c,Ne=Y.lc;else{if(!Ht.p)throw"hufDecode issues";var Zt;for(Zt=0;Zt<Ht.lit;Zt++){for(var jt=xe(Z[Ht.p[Zt]]);Ne<jt&&me.value<xt;)se(pt,Ne,le,me),pt=K.c,Ne=K.lc;if(Ne>=jt&&H(Z[Ht.p[Zt]])==(pt>>Ne-jt&(1<<jt)-1)){Ne-=jt,he(Ht.p[Zt],Ke,pt,Ne,le,ve,me,at,rt,It),pt=Y.c,Ne=Y.lc;break}}if(Zt==Ht.lit)throw"hufDecode issues"}}var Ot=8-Se&7;for(pt>>=Ot,Ne-=Ot;Ne>0;){var Ht=B[pt<<14-Ne&16383];if(Ht.len)Ne-=Ht.len,he(Ht.lit,Ke,pt,Ne,le,ve,me,at,rt,It),pt=Y.c,Ne=Y.lc;else throw"hufDecode issues"}return!0}function Le(Z,B,le,ve,me,Se){var Ke={value:0},Je=le.value,at=X(B,le),rt=X(B,le);le.value+=4;var pt=X(B,le);if(le.value+=4,at<0||at>=65537||rt<0||rt>=65537)throw"Something wrong with HUF_ENCSIZE";var Ne=new Array(65537),It=new Array(16384);ce(It);var xt=ve-(le.value-Je);if(de(Z,B,le,xt,at,rt,Ne),pt>8*(ve-(le.value-Je)))throw"Something wrong with hufUncompress";J(Ne,at,rt,It),Ue(Ne,It,Z,B,le,pt,rt,Se,me,Ke)}function re(Z,B,le){for(var ve=0;ve<le;++ve)B[ve]=Z[B[ve]]}function Ye(Z){for(var B=1;B<Z.length;B++){var le=Z[B-1]+Z[B]-128;Z[B]=le}}function Fe(Z,B){for(var le=0,ve=Math.floor((Z.length+1)/2),me=0,Se=Z.length-1;!(me>Se||(B[me++]=Z[le++],me>Se));)B[me++]=Z[ve++]}function Ze(Z){for(var B=Z.byteLength,le=new Array,ve=0,me=new DataView(Z);B>0;){var Se=me.getInt8(ve++);if(Se<0){var Ke=-Se;B-=Ke+1;for(var Je=0;Je<Ke;Je++)le.push(me.getUint8(ve++))}else{var Ke=Se;B-=2;for(var at=me.getUint8(ve++),Je=0;Je<Ke+1;Je++)le.push(at)}}return le}function Xe(Z,B,le,ve,me,Se){var on=new DataView(Se.buffer),Ke=le[Z.idx[0]].width,Je=le[Z.idx[0]].height,at=3,rt=Math.floor(Ke/8),pt=Math.ceil(Ke/8),Ne=Math.ceil(Je/8),It=Ke-(pt-1)*8,xt=Je-(Ne-1)*8,wt={value:0},Ht=new Array(at),Zt=new Array(at),jt=new Array(at),Ot=new Array(at),qt=new Array(at);for(let hn=0;hn<at;++hn)qt[hn]=B[Z.idx[hn]],Ht[hn]=hn<1?0:Ht[hn-1]+pt*Ne,Zt[hn]=new Float32Array(64),jt[hn]=new Uint16Array(64),Ot[hn]=new Uint16Array(pt*64);for(let hn=0;hn<Ne;++hn){var Ft=8;hn==Ne-1&&(Ft=xt);var ln=8;for(let Mn=0;Mn<pt;++Mn){Mn==pt-1&&(ln=It);for(let Kt=0;Kt<at;++Kt)jt[Kt].fill(0),jt[Kt][0]=me[Ht[Kt]++],dt(wt,ve,jt[Kt]),je(jt[Kt],Zt[Kt]),it(Zt[Kt]);Ce(Zt);for(let Kt=0;Kt<at;++Kt)Me(Zt[Kt],Ot[Kt],Mn*64)}let zn=0;for(let Mn=0;Mn<at;++Mn){const Kt=le[Z.idx[Mn]].type;for(let An=8*hn;An<8*hn+Ft;++An){zn=qt[Mn][An];for(let Sr=0;Sr<rt;++Sr){const xi=Sr*64+(An&7)*8;on.setUint16(zn+0*2*Kt,Ot[Mn][xi+0],!0),on.setUint16(zn+1*2*Kt,Ot[Mn][xi+1],!0),on.setUint16(zn+2*2*Kt,Ot[Mn][xi+2],!0),on.setUint16(zn+3*2*Kt,Ot[Mn][xi+3],!0),on.setUint16(zn+4*2*Kt,Ot[Mn][xi+4],!0),on.setUint16(zn+5*2*Kt,Ot[Mn][xi+5],!0),on.setUint16(zn+6*2*Kt,Ot[Mn][xi+6],!0),on.setUint16(zn+7*2*Kt,Ot[Mn][xi+7],!0),zn+=8*2*Kt}}if(rt!=pt)for(let An=8*hn;An<8*hn+Ft;++An){const Sr=qt[Mn][An]+8*rt*2*Kt,xi=rt*64+(An&7)*8;for(let mn=0;mn<ln;++mn)on.setUint16(Sr+mn*2*Kt,Ot[Mn][xi+mn],!0)}}}for(var Bn=new Uint16Array(Ke),on=new DataView(Se.buffer),bn=0;bn<at;++bn){le[Z.idx[bn]].decoded=!0;var tn=le[Z.idx[bn]].type;if(le[bn].type==2)for(var Fn=0;Fn<Je;++Fn){const hn=qt[bn][Fn];for(var xn=0;xn<Ke;++xn)Bn[xn]=on.getUint16(hn+xn*2*tn,!0);for(var xn=0;xn<Ke;++xn)on.setFloat32(hn+xn*2*tn,Ie(Bn[xn]),!0)}}}function dt(Z,B,le){for(var ve,me=1;me<64;)ve=B[Z.value],ve==65280?me=64:ve>>8==255?me+=ve&255:(le[me]=ve,me++),Z.value++}function je(Z,B){B[0]=Ie(Z[0]),B[1]=Ie(Z[1]),B[2]=Ie(Z[5]),B[3]=Ie(Z[6]),B[4]=Ie(Z[14]),B[5]=Ie(Z[15]),B[6]=Ie(Z[27]),B[7]=Ie(Z[28]),B[8]=Ie(Z[2]),B[9]=Ie(Z[4]),B[10]=Ie(Z[7]),B[11]=Ie(Z[13]),B[12]=Ie(Z[16]),B[13]=Ie(Z[26]),B[14]=Ie(Z[29]),B[15]=Ie(Z[42]),B[16]=Ie(Z[3]),B[17]=Ie(Z[8]),B[18]=Ie(Z[12]),B[19]=Ie(Z[17]),B[20]=Ie(Z[25]),B[21]=Ie(Z[30]),B[22]=Ie(Z[41]),B[23]=Ie(Z[43]),B[24]=Ie(Z[9]),B[25]=Ie(Z[11]),B[26]=Ie(Z[18]),B[27]=Ie(Z[24]),B[28]=Ie(Z[31]),B[29]=Ie(Z[40]),B[30]=Ie(Z[44]),B[31]=Ie(Z[53]),B[32]=Ie(Z[10]),B[33]=Ie(Z[19]),B[34]=Ie(Z[23]),B[35]=Ie(Z[32]),B[36]=Ie(Z[39]),B[37]=Ie(Z[45]),B[38]=Ie(Z[52]),B[39]=Ie(Z[54]),B[40]=Ie(Z[20]),B[41]=Ie(Z[22]),B[42]=Ie(Z[33]),B[43]=Ie(Z[38]),B[44]=Ie(Z[46]),B[45]=Ie(Z[51]),B[46]=Ie(Z[55]),B[47]=Ie(Z[60]),B[48]=Ie(Z[21]),B[49]=Ie(Z[34]),B[50]=Ie(Z[37]),B[51]=Ie(Z[47]),B[52]=Ie(Z[50]),B[53]=Ie(Z[56]),B[54]=Ie(Z[59]),B[55]=Ie(Z[61]),B[56]=Ie(Z[35]),B[57]=Ie(Z[36]),B[58]=Ie(Z[48]),B[59]=Ie(Z[49]),B[60]=Ie(Z[57]),B[61]=Ie(Z[58]),B[62]=Ie(Z[62]),B[63]=Ie(Z[63])}function it(Z){const B=.5*Math.cos(.7853975),le=.5*Math.cos(3.14159/16),ve=.5*Math.cos(3.14159/8),me=.5*Math.cos(3*3.14159/16),Se=.5*Math.cos(5*3.14159/16),Ke=.5*Math.cos(3*3.14159/8),Je=.5*Math.cos(7*3.14159/16);for(var at=new Array(4),rt=new Array(4),pt=new Array(4),Ne=new Array(4),It=0;It<8;++It){var xt=It*8;at[0]=ve*Z[xt+2],at[1]=Ke*Z[xt+2],at[2]=ve*Z[xt+6],at[3]=Ke*Z[xt+6],rt[0]=le*Z[xt+1]+me*Z[xt+3]+Se*Z[xt+5]+Je*Z[xt+7],rt[1]=me*Z[xt+1]-Je*Z[xt+3]-le*Z[xt+5]-Se*Z[xt+7],rt[2]=Se*Z[xt+1]-le*Z[xt+3]+Je*Z[xt+5]+me*Z[xt+7],rt[3]=Je*Z[xt+1]-Se*Z[xt+3]+me*Z[xt+5]-le*Z[xt+7],pt[0]=B*(Z[xt+0]+Z[xt+4]),pt[3]=B*(Z[xt+0]-Z[xt+4]),pt[1]=at[0]+at[3],pt[2]=at[1]-at[2],Ne[0]=pt[0]+pt[1],Ne[1]=pt[3]+pt[2],Ne[2]=pt[3]-pt[2],Ne[3]=pt[0]-pt[1],Z[xt+0]=Ne[0]+rt[0],Z[xt+1]=Ne[1]+rt[1],Z[xt+2]=Ne[2]+rt[2],Z[xt+3]=Ne[3]+rt[3],Z[xt+4]=Ne[3]-rt[3],Z[xt+5]=Ne[2]-rt[2],Z[xt+6]=Ne[1]-rt[1],Z[xt+7]=Ne[0]-rt[0]}for(var wt=0;wt<8;++wt)at[0]=ve*Z[16+wt],at[1]=Ke*Z[16+wt],at[2]=ve*Z[48+wt],at[3]=Ke*Z[48+wt],rt[0]=le*Z[8+wt]+me*Z[24+wt]+Se*Z[40+wt]+Je*Z[56+wt],rt[1]=me*Z[8+wt]-Je*Z[24+wt]-le*Z[40+wt]-Se*Z[56+wt],rt[2]=Se*Z[8+wt]-le*Z[24+wt]+Je*Z[40+wt]+me*Z[56+wt],rt[3]=Je*Z[8+wt]-Se*Z[24+wt]+me*Z[40+wt]-le*Z[56+wt],pt[0]=B*(Z[wt]+Z[32+wt]),pt[3]=B*(Z[wt]-Z[32+wt]),pt[1]=at[0]+at[3],pt[2]=at[1]-at[2],Ne[0]=pt[0]+pt[1],Ne[1]=pt[3]+pt[2],Ne[2]=pt[3]-pt[2],Ne[3]=pt[0]-pt[1],Z[0+wt]=Ne[0]+rt[0],Z[8+wt]=Ne[1]+rt[1],Z[16+wt]=Ne[2]+rt[2],Z[24+wt]=Ne[3]+rt[3],Z[32+wt]=Ne[3]-rt[3],Z[40+wt]=Ne[2]-rt[2],Z[48+wt]=Ne[1]-rt[1],Z[56+wt]=Ne[0]-rt[0]}function Ce(Z){for(var B=0;B<64;++B){var le=Z[0][B],ve=Z[1][B],me=Z[2][B];Z[0][B]=le+1.5747*me,Z[1][B]=le-.1873*ve-.4682*me,Z[2][B]=le+1.8556*ve}}function Me(Z,B,le){for(var ve=0;ve<64;++ve)B[le+ve]=Kf.toHalfFloat(St(Z[ve]))}function St(Z){return Z<=1?Math.sign(Z)*Math.pow(Math.abs(Z),2.2):Math.sign(Z)*Math.pow(D,Math.abs(Z)-1)}function oe(Z){return new DataView(Z.array.buffer,Z.offset.value,Z.size)}function ee(Z){var B=Z.viewer.buffer.slice(Z.offset.value,Z.offset.value+Z.size),le=new Uint8Array(Ze(B)),ve=new Uint8Array(le.length);return Ye(le),Fe(le,ve),new DataView(ve.buffer)}function W(Z){var B=Z.array.slice(Z.offset.value,Z.offset.value+Z.size),le=P0(B),ve=new Uint8Array(le.length);return Ye(le),Fe(le,ve),new DataView(ve.buffer)}function ot(Z){for(var B=Z.viewer,le={value:Z.offset.value},ve=new Uint16Array(Z.width*Z.scanlineBlockSize*(Z.channels*Z.type)),me=new Uint8Array(8192),Se=0,Ke=new Array(Z.channels),Je=0;Je<Z.channels;Je++)Ke[Je]={},Ke[Je].start=Se,Ke[Je].end=Ke[Je].start,Ke[Je].nx=Z.width,Ke[Je].ny=Z.lines,Ke[Je].size=Z.type,Se+=Ke[Je].nx*Ke[Je].ny*Ke[Je].size;var at=Be(B,le),rt=Be(B,le);if(rt>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(at<=rt)for(var Je=0;Je<rt-at+1;Je++)me[Je+at]=z(B,le);var pt=new Uint16Array(65536),Ne=U(me,pt),It=X(B,le);Le(Z.array,B,le,It,ve,Se);for(var Je=0;Je<Z.channels;++Je)for(var xt=Ke[Je],wt=0;wt<Ke[Je].size;++wt)et(ve,xt.start+wt,xt.nx,xt.size,xt.ny,xt.nx*xt.size,Ne);re(pt,ve,Se);for(var Ht=0,Zt=new Uint8Array(ve.buffer.byteLength),jt=0;jt<Z.lines;jt++)for(var Ot=0;Ot<Z.channels;Ot++){var xt=Ke[Ot],qt=xt.nx*xt.size,Ft=new Uint8Array(ve.buffer,xt.end*2,qt*2);Zt.set(Ft,Ht),Ht+=qt*2,xt.end+=qt}return new DataView(Zt.buffer)}function ze(Z){var B=Z.array.slice(Z.offset.value,Z.offset.value+Z.size),le=P0(B);const ve=Z.lines*Z.channels*Z.width,me=Z.type==1?new Uint16Array(ve):new Uint32Array(ve);let Se=0,Ke=0;const Je=new Array(4);for(let at=0;at<Z.lines;at++)for(let rt=0;rt<Z.channels;rt++){let pt=0;switch(Z.type){case 1:Je[0]=Se,Je[1]=Je[0]+Z.width,Se=Je[1]+Z.width;for(let Ne=0;Ne<Z.width;++Ne){const It=le[Je[0]++]<<8|le[Je[1]++];pt+=It,me[Ke]=pt,Ke++}break;case 2:Je[0]=Se,Je[1]=Je[0]+Z.width,Je[2]=Je[1]+Z.width,Se=Je[2]+Z.width;for(let Ne=0;Ne<Z.width;++Ne){const It=le[Je[0]++]<<24|le[Je[1]++]<<16|le[Je[2]++]<<8;pt+=It,me[Ke]=pt,Ke++}break}}return new DataView(me.buffer)}function qe(Z){var B=Z.viewer,le={value:Z.offset.value},ve=new Uint8Array(Z.width*Z.lines*(Z.channels*Z.type*2)),me={version:Ae(B,le),unknownUncompressedSize:Ae(B,le),unknownCompressedSize:Ae(B,le),acCompressedSize:Ae(B,le),dcCompressedSize:Ae(B,le),rleCompressedSize:Ae(B,le),rleUncompressedSize:Ae(B,le),rleRawSize:Ae(B,le),totalAcUncompressedCount:Ae(B,le),totalDcUncompressedCount:Ae(B,le),acCompression:Ae(B,le)};if(me.version<2)throw"EXRLoader.parse: "+Ti.compression+" version "+me.version+" is unsupported";for(var Se=new Array,Ke=Be(B,le)-2;Ke>0;){var Je=ut(B.buffer,le),at=z(B,le),rt=at>>2&3,pt=(at>>4)-1,Ne=new Int8Array([pt])[0],It=z(B,le);Se.push({name:Je,index:Ne,type:It,compression:rt}),Ke-=Je.length+3}for(var xt=Ti.channels,wt=new Array(Z.channels),Ht=0;Ht<Z.channels;++Ht){var Zt=wt[Ht]={},jt=xt[Ht];Zt.name=jt.name,Zt.compression=0,Zt.decoded=!1,Zt.type=jt.pixelType,Zt.pLinear=jt.pLinear,Zt.width=Z.width,Zt.height=Z.lines}for(var Ot={idx:new Array(3)},qt=0;qt<Z.channels;++qt)for(var Zt=wt[qt],Ht=0;Ht<Se.length;++Ht){var Ft=Se[Ht];Zt.name==Ft.name&&(Zt.compression=Ft.compression,Ft.index>=0&&(Ot.idx[Ft.index]=qt),Zt.offset=qt)}if(me.acCompressedSize>0)switch(me.acCompression){case 0:var on=new Uint16Array(me.totalAcUncompressedCount);Le(Z.array,B,le,me.acCompressedSize,on,me.totalAcUncompressedCount);break;case 1:var ln=Z.array.slice(le.value,le.value+me.totalAcUncompressedCount),Bn=P0(ln),on=new Uint16Array(Bn.buffer);le.value+=me.totalAcUncompressedCount;break}if(me.dcCompressedSize>0){var bn={array:Z.array,offset:le,size:me.dcCompressedSize},tn=new Uint16Array(W(bn).buffer);le.value+=me.dcCompressedSize}if(me.rleRawSize>0){var ln=Z.array.slice(le.value,le.value+me.rleCompressedSize),Bn=P0(ln),Fn=Ze(Bn.buffer);le.value+=me.rleCompressedSize}for(var xn=0,hn=new Array(wt.length),Ht=0;Ht<hn.length;++Ht)hn[Ht]=new Array;for(var zn=0;zn<Z.lines;++zn)for(var Mn=0;Mn<wt.length;++Mn)hn[Mn].push(xn),xn+=wt[Mn].width*Z.type*2;Xe(Ot,hn,wt,on,tn,ve);for(var Ht=0;Ht<wt.length;++Ht){var Zt=wt[Ht];if(!Zt.decoded)switch(Zt.compression){case 2:for(var Kt=0,An=0,zn=0;zn<Z.lines;++zn){for(var Sr=hn[Ht][Kt],xi=0;xi<Zt.width;++xi){for(var mn=0;mn<2*Zt.type;++mn)ve[Sr++]=Fn[An+mn*Zt.width*Zt.height];An++}Kt++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(ve.buffer)}function ut(Z,B){for(var le=new Uint8Array(Z),ve=0;le[B.value+ve]!=0;)ve+=1;var me=new TextDecoder().decode(le.slice(B.value,B.value+ve));return B.value=B.value+ve+1,me}function ft(Z,B,le){var ve=new TextDecoder().decode(new Uint8Array(Z).slice(B.value,B.value+le));return B.value=B.value+le,ve}function Ge(Z,B){var le=L(Z,B),ve=X(Z,B);return[le,ve]}function $t(Z,B){var le=X(Z,B),ve=X(Z,B);return[le,ve]}function L(Z,B){var le=Z.getInt32(B.value,!0);return B.value=B.value+4,le}function X(Z,B){var le=Z.getUint32(B.value,!0);return B.value=B.value+4,le}function fe(Z,B){var le=Z[B.value];return B.value=B.value+1,le}function z(Z,B){var le=Z.getUint8(B.value);return B.value=B.value+1,le}const Ae=function(Z,B){let le;return"getBigInt64"in DataView.prototype?le=Number(Z.getBigInt64(B.value,!0)):le=Z.getUint32(B.value+4,!0)+Number(Z.getUint32(B.value,!0)<<32),B.value+=8,le};function tt(Z,B){var le=Z.getFloat32(B.value,!0);return B.value+=4,le}function ye(Z,B){return Kf.toHalfFloat(tt(Z,B))}function Ie(Z){var B=(Z&31744)>>10,le=Z&1023;return(Z>>15?-1:1)*(B?B===31?le?NaN:1/0:Math.pow(2,B-15)*(1+le/1024):6103515625e-14*(le/1024))}function Be(Z,B){var le=Z.getUint16(B.value,!0);return B.value+=2,le}function N(Z,B){return Ie(Be(Z,B))}function j(Z,B,le,ve){for(var me=le.value,Se=[];le.value<me+ve-1;){var Ke=ut(B,le),Je=L(Z,le),at=z(Z,le);le.value+=3;var rt=L(Z,le),pt=L(Z,le);Se.push({name:Ke,pixelType:Je,pLinear:at,xSampling:rt,ySampling:pt})}return le.value+=1,Se}function ge(Z,B){var le=tt(Z,B),ve=tt(Z,B),me=tt(Z,B),Se=tt(Z,B),Ke=tt(Z,B),Je=tt(Z,B),at=tt(Z,B),rt=tt(Z,B);return{redX:le,redY:ve,greenX:me,greenY:Se,blueX:Ke,blueY:Je,whiteX:at,whiteY:rt}}function we(Z,B){var le=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],ve=z(Z,B);return le[ve]}function We(Z,B){var le=X(Z,B),ve=X(Z,B),me=X(Z,B),Se=X(Z,B);return{xMin:le,yMin:ve,xMax:me,yMax:Se}}function gt(Z,B){var le=["INCREASING_Y"],ve=z(Z,B);return le[ve]}function bt(Z,B){var le=tt(Z,B),ve=tt(Z,B);return[le,ve]}function un(Z,B){var le=tt(Z,B),ve=tt(Z,B),me=tt(Z,B);return[le,ve,me]}function an(Z,B,le,ve,me){if(ve==="string"||ve==="stringvector"||ve==="iccProfile")return ft(B,le,me);if(ve==="chlist")return j(Z,B,le,me);if(ve==="chromaticities")return ge(Z,le);if(ve==="compression")return we(Z,le);if(ve==="box2i")return We(Z,le);if(ve==="lineOrder")return gt(Z,le);if(ve==="float")return tt(Z,le);if(ve==="v2f")return bt(Z,le);if(ve==="v3f")return un(Z,le);if(ve==="int")return L(Z,le);if(ve==="rational")return Ge(Z,le);if(ve==="timecode")return $t(Z,le);if(ve==="preview")return le.value+=me,"skipped";le.value+=me}function ei(Z,B,le){const ve={};if(Z.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";ve.version=Z.getUint8(4);const me=Z.getUint8(5);ve.spec={singleTile:!!(me&2),longName:!!(me&4),deepFormat:!!(me&8),multiPart:!!(me&16)},le.value=8;for(var Se=!0;Se;){var Ke=ut(B,le);if(Ke==0)Se=!1;else{var Je=ut(B,le),at=X(Z,le),rt=an(Z,B,le,Je,at);rt===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Je}'.`):ve[Ke]=rt}}if(me&-5)throw console.error("EXRHeader:",ve),"THREE.EXRLoader: provided file is currently unsupported.";return ve}function pi(Z,B,le,ve,me){const Se={size:0,viewer:B,array:le,offset:ve,width:Z.dataWindow.xMax-Z.dataWindow.xMin+1,height:Z.dataWindow.yMax-Z.dataWindow.yMin+1,channels:Z.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:Z.channels[0].pixelType,uncompress:null,getter:null,format:null,[Yv?"colorSpace":"encoding"]:null};switch(Z.compression){case"NO_COMPRESSION":Se.lines=1,Se.uncompress=oe;break;case"RLE_COMPRESSION":Se.lines=1,Se.uncompress=ee;break;case"ZIPS_COMPRESSION":Se.lines=1,Se.uncompress=W;break;case"ZIP_COMPRESSION":Se.lines=16,Se.uncompress=W;break;case"PIZ_COMPRESSION":Se.lines=32,Se.uncompress=ot;break;case"PXR24_COMPRESSION":Se.lines=16,Se.uncompress=ze;break;case"DWAA_COMPRESSION":Se.lines=32,Se.uncompress=qe;break;case"DWAB_COMPRESSION":Se.lines=256,Se.uncompress=qe;break;default:throw"EXRLoader.parse: "+Z.compression+" is unsupported"}if(Se.scanlineBlockSize=Se.lines,Se.type==1)switch(me){case Kr:Se.getter=N,Se.inputSize=2;break;case ss:Se.getter=Be,Se.inputSize=2;break}else if(Se.type==2)switch(me){case Kr:Se.getter=tt,Se.inputSize=4;break;case ss:Se.getter=ye,Se.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+Se.type+" for "+Z.compression+".";Se.blockCount=(Z.dataWindow.yMax+1)/Se.scanlineBlockSize;for(var Ke=0;Ke<Se.blockCount;Ke++)Ae(B,ve);Se.outputChannels=Se.channels==3?4:Se.channels;const Je=Se.width*Se.height*Se.outputChannels;switch(me){case Kr:Se.byteArray=new Float32Array(Je),Se.channels<Se.outputChannels&&Se.byteArray.fill(1,0,Je);break;case ss:Se.byteArray=new Uint16Array(Je),Se.channels<Se.outputChannels&&Se.byteArray.fill(15360,0,Je);break;default:console.error("THREE.EXRLoader: unsupported type: ",me);break}return Se.bytesPerLine=Se.width*Se.inputSize*Se.channels,Se.outputChannels==4?Se.format=jr:Se.format=cM,Yv?Se.colorSpace="srgb-linear":Se.encoding=3e3,Se}const Ji=new DataView(e),Ci=new Uint8Array(e),vi={value:0},Ti=ei(Ji,e,vi),nn=pi(Ti,Ji,Ci,vi,this.type),mi={value:0},yr={R:0,G:1,B:2,A:3,Y:0};for(let Z=0;Z<nn.height/nn.scanlineBlockSize;Z++){const B=X(Ji,vi);nn.size=X(Ji,vi),nn.lines=B+nn.scanlineBlockSize>nn.height?nn.height-B:nn.scanlineBlockSize;const ve=nn.size<nn.lines*nn.bytesPerLine?nn.uncompress(nn):oe(nn);vi.value+=nn.size;for(let me=0;me<nn.scanlineBlockSize;me++){const Se=me+Z*nn.scanlineBlockSize;if(Se>=nn.height)break;for(let Ke=0;Ke<nn.channels;Ke++){const Je=yr[Ti.channels[Ke].name];for(let at=0;at<nn.width;at++){mi.value=(me*(nn.channels*nn.width)+Ke*nn.width+at)*nn.inputSize;const rt=(nn.height-1-Se)*(nn.width*nn.outputChannels)+at*nn.outputChannels+Je;nn.byteArray[rt]=nn.getter(ve,mi)}}}}return{header:Ti,width:nn.width,height:nn.height,data:nn.byteArray,format:nn.format,[Yv?"colorSpace":"encoding"]:nn[Yv?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,n,r,s){function a(l,u){Yv?l.colorSpace=u.colorSpace:l.encoding=u.encoding,l.minFilter=Gn,l.magFilter=Gn,l.generateMipmaps=!1,l.flipY=!1,n&&n(l,u)}return super.load(e,a,r,s)}}const JC=new WeakMap;class TK extends as{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,n,r,s){const a=new Lr(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,l=>{const u={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(l,u).then(n).catch(s)},r,s)}decodeDracoFile(e,n,r,s){const a={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,a).then(n)}decodeGeometry(e,n){for(const d in n.attributeTypes){const h=n.attributeTypes[d];h.BYTES_PER_ELEMENT!==void 0&&(n.attributeTypes[d]=h.name)}const r=JSON.stringify(n);if(JC.has(e)){const d=JC.get(e);if(d.key===r)return d.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const a=this.workerNextTaskID++,l=e.byteLength,u=this._getWorker(a,l).then(d=>(s=d,new Promise((h,f)=>{s._callbacks[a]={resolve:h,reject:f},s.postMessage({type:"decode",id:a,taskConfig:n,buffer:e},[e])}))).then(d=>this._createGeometry(d.geometry));return u.catch(()=>!0).then(()=>{s&&a&&this._releaseTask(s,a)}),JC.set(e,{key:r,promise:u}),u}_createGeometry(e){const n=new rn;e.index&&n.setIndex(new Qn(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const s=e.attributes[r],a=s.name,l=s.array,u=s.itemSize;n.setAttribute(a,new Qn(l,u))}return n}_loadLibrary(e,n){const r=new Lr(this.manager);return r.setPath(this.decoderPath),r.setResponseType(n),r.setWithCredentials(this.withCredentials),new Promise((s,a)=>{r.load(e,s,void 0,a)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return e?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(r=>{const s=r[0];e||(this.decoderConfig.wasmBinary=r[1]);const a=EK.toString(),l=["/* draco decoder */",s,"","/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l]))}),this.decoderPending}_getWorker(e,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(a){const l=a.data;switch(l.type){case"decode":s._callbacks[l.id].resolve(l);break;case"error":s._callbacks[l.id].reject(l);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+l.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,a){return s._taskLoad>a._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=n,r._taskLoad+=n,r})}_releaseTask(e,n){e._taskLoad-=e._taskCosts[n],delete e._callbacks[n],delete e._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function EK(){let i,e;onmessage=function(l){const u=l.data;switch(u.type){case"init":i=u.decoderConfig,e=new Promise(function(f){i.onModuleLoaded=function(p){f({draco:p})},DracoDecoderModule(i)});break;case"decode":const d=u.buffer,h=u.taskConfig;e.then(f=>{const p=f.draco,m=new p.Decoder,T=new p.DecoderBuffer;T.Init(new Int8Array(d),d.byteLength);try{const E=n(p,m,T,h),b=E.attributes.map(y=>y.array.buffer);E.index&&b.push(E.index.array.buffer),self.postMessage({type:"decode",id:u.id,geometry:E},b)}catch(E){console.error(E),self.postMessage({type:"error",id:u.id,error:E.message})}finally{p.destroy(T),p.destroy(m)}});break}};function n(l,u,d,h){const f=h.attributeIDs,p=h.attributeTypes;let m,T;const E=u.GetEncodedGeometryType(d);if(E===l.TRIANGULAR_MESH)m=new l.Mesh,T=u.DecodeBufferToMesh(d,m);else if(E===l.POINT_CLOUD)m=new l.PointCloud,T=u.DecodeBufferToPointCloud(d,m);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!T.ok()||m.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+T.error_msg());const b={index:null,attributes:[]};for(const y in f){const S=self[p[y]];let A,C;if(h.useUniqueIDs)C=f[y],A=u.GetAttributeByUniqueId(m,C);else{if(C=u.GetAttributeId(m,l[f[y]]),C===-1)continue;A=u.GetAttribute(m,C)}b.attributes.push(s(l,u,m,y,S,A))}return E===l.TRIANGULAR_MESH&&(b.index=r(l,u,m)),l.destroy(m),b}function r(l,u,d){const f=d.num_faces()*3,p=f*4,m=l._malloc(p);u.GetTrianglesUInt32Array(d,p,m);const T=new Uint32Array(l.HEAPF32.buffer,m,f).slice();return l._free(m),{array:T,itemSize:1}}function s(l,u,d,h,f,p){const m=p.num_components(),E=d.num_points()*m,b=E*f.BYTES_PER_ELEMENT,y=a(l,f),S=l._malloc(b);u.GetAttributeDataArrayForAllPoints(d,p,y,b,S);const A=new f(l.HEAPF32.buffer,S,E).slice();return l._free(S),{name:h,array:A,itemSize:m}}function a(l,u){switch(u){case Float32Array:return l.DT_FLOAT32;case Int8Array:return l.DT_INT8;case Int16Array:return l.DT_INT16;case Int32Array:return l.DT_INT32;case Uint8Array:return l.DT_UINT8;case Uint16Array:return l.DT_UINT16;case Uint32Array:return l.DT_UINT32}}}const Rk=new Xs,B0=new te;class qM extends J${constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],n=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],r=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(r),this.setAttribute("position",new Yt(e,3)),this.setAttribute("uv",new Yt(n,2))}applyMatrix4(e){const n=this.attributes.instanceStart,r=this.attributes.instanceEnd;return n!==void 0&&(n.applyMatrix4(e),r.applyMatrix4(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let n;e instanceof Float32Array?n=e:Array.isArray(e)&&(n=new Float32Array(e));const r=new jS(n,6,1);return this.setAttribute("instanceStart",new lo(r,3,0)),this.setAttribute("instanceEnd",new lo(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e,n=3){let r;e instanceof Float32Array?r=e:Array.isArray(e)&&(r=new Float32Array(e));const s=new jS(r,n*2,1);return this.setAttribute("instanceColorStart",new lo(s,n,0)),this.setAttribute("instanceColorEnd",new lo(s,n,n)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new OM(e.geometry)),this}fromLineSegments(e){const n=e.geometry;return this.setPositions(n.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Xs);const e=this.attributes.instanceStart,n=this.attributes.instanceEnd;e!==void 0&&n!==void 0&&(this.boundingBox.setFromBufferAttribute(e),Rk.setFromBufferAttribute(n),this.boundingBox.union(Rk))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new js),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(e!==void 0&&n!==void 0){const r=this.boundingSphere.center;this.boundingBox.getCenter(r);let s=0;for(let a=0,l=e.count;a<l;a++)B0.fromBufferAttribute(e,a),s=Math.max(s,r.distanceToSquared(B0)),B0.fromBufferAttribute(n,a),s=Math.max(s,r.distanceToSquared(B0));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class e2 extends qM{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const n=e.length-3,r=new Float32Array(2*n);for(let s=0;s<n;s+=3)r[2*s]=e[s],r[2*s+1]=e[s+1],r[2*s+2]=e[s+2],r[2*s+3]=e[s+3],r[2*s+4]=e[s+4],r[2*s+5]=e[s+5];return super.setPositions(r),this}setColors(e,n=3){const r=e.length-n,s=new Float32Array(2*r);if(n===3)for(let a=0;a<r;a+=n)s[2*a]=e[a],s[2*a+1]=e[a+1],s[2*a+2]=e[a+2],s[2*a+3]=e[a+3],s[2*a+4]=e[a+4],s[2*a+5]=e[a+5];else for(let a=0;a<r;a+=n)s[2*a]=e[a],s[2*a+1]=e[a+1],s[2*a+2]=e[a+2],s[2*a+3]=e[a+3],s[2*a+4]=e[a+4],s[2*a+5]=e[a+5],s[2*a+6]=e[a+6],s[2*a+7]=e[a+7];return super.setColors(s,n),this}fromLine(e){const n=e.geometry;return this.setPositions(n.attributes.position.array),this}}class QM extends Oo{constructor(e){super({type:"LineMaterial",uniforms:rE.clone(rE.merge([Lt.common,Lt.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new mt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:`
				#include <common>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>

				uniform float linewidth;
				uniform vec2 resolution;

				attribute vec3 instanceStart;
				attribute vec3 instanceEnd;

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
						attribute vec4 instanceColorStart;
						attribute vec4 instanceColorEnd;
					#else
						varying vec3 vLineColor;
						attribute vec3 instanceColorStart;
						attribute vec3 instanceColorEnd;
					#endif
				#endif

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#ifdef USE_DASH

					uniform float dashScale;
					attribute float instanceDistanceStart;
					attribute float instanceDistanceEnd;
					varying float vLineDistance;

				#endif

				void trimSegment( const in vec4 start, inout vec4 end ) {

					// trim end segment so it terminates between the camera plane and the near plane

					// conservative estimate of the near plane
					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
					float nearEstimate = - 0.5 * b / a;

					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

					end.xyz = mix( start.xyz, end.xyz, alpha );

				}

				void main() {

					#ifdef USE_COLOR

						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

					#endif

					#ifdef USE_DASH

						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
						vUv = uv;

					#endif

					float aspect = resolution.x / resolution.y;

					// camera space
					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

					#ifdef WORLD_UNITS

						worldStart = start.xyz;
						worldEnd = end.xyz;

					#else

						vUv = uv;

					#endif

					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
					// perhaps there is a more elegant solution -- WestLangley

					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

					if ( perspective ) {

						if ( start.z < 0.0 && end.z >= 0.0 ) {

							trimSegment( start, end );

						} else if ( end.z < 0.0 && start.z >= 0.0 ) {

							trimSegment( end, start );

						}

					}

					// clip space
					vec4 clipStart = projectionMatrix * start;
					vec4 clipEnd = projectionMatrix * end;

					// ndc space
					vec3 ndcStart = clipStart.xyz / clipStart.w;
					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

					// direction
					vec2 dir = ndcEnd.xy - ndcStart.xy;

					// account for clip-space aspect ratio
					dir.x *= aspect;
					dir = normalize( dir );

					#ifdef WORLD_UNITS

						// get the offset direction as perpendicular to the view vector
						vec3 worldDir = normalize( end.xyz - start.xyz );
						vec3 offset;
						if ( position.y < 0.5 ) {

							offset = normalize( cross( start.xyz, worldDir ) );

						} else {

							offset = normalize( cross( end.xyz, worldDir ) );

						}

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

						// don't extend the line if we're rendering dashes because we
						// won't be rendering the endcaps
						#ifndef USE_DASH

							// extend the line bounds to encompass  endcaps
							start.xyz += - worldDir * linewidth * 0.5;
							end.xyz += worldDir * linewidth * 0.5;

							// shift the position of the quad so it hugs the forward edge of the line
							offset.xy -= dir * forwardOffset;
							offset.z += 0.5;

						#endif

						// endcaps
						if ( position.y > 1.0 || position.y < 0.0 ) {

							offset.xy += dir * 2.0 * forwardOffset;

						}

						// adjust for linewidth
						offset *= linewidth * 0.5;

						// set the world position
						worldPos = ( position.y < 0.5 ) ? start : end;
						worldPos.xyz += offset;

						// project the worldpos
						vec4 clip = projectionMatrix * worldPos;

						// shift the depth of the projected points so the line
						// segments overlap neatly
						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
						clip.z = clipPose.z * clip.w;

					#else

						vec2 offset = vec2( dir.y, - dir.x );
						// undo aspect ratio adjustment
						dir.x /= aspect;
						offset.x /= aspect;

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						// endcaps
						if ( position.y < 0.0 ) {

							offset += - dir;

						} else if ( position.y > 1.0 ) {

							offset += dir;

						}

						// adjust for linewidth
						offset *= linewidth;

						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
						offset /= resolution.y;

						// select end
						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

						// back to clip space
						offset *= clip.w;

						clip.xy += offset;

					#endif

					gl_Position = clip;

					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>

				}
			`,fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${parseInt(Mp.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(n){this.uniforms.diffuse.value=n}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(n){n===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(n){this.uniforms.linewidth.value=n}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(n){!!n!="USE_DASH"in this.defines&&(this.needsUpdate=!0),n===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(n){this.uniforms.dashScale.value=n}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(n){this.uniforms.dashSize.value=n}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(n){this.uniforms.dashOffset.value=n}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(n){this.uniforms.gapSize.value=n}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(n){this.uniforms.opacity.value=n}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(n){this.uniforms.resolution.value.copy(n)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(n){!!n!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),n===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const ZC=new Hn,wk=new te,Mk=new te,_s=new Hn,vs=new Hn,_c=new Hn,qC=new te,QC=new pn,ys=new gU,Ik=new te,F0=new Xs,U0=new js,vc=new Hn;let yc,cp;function Ok(i,e,n){return vc.set(0,0,-e,1).applyMatrix4(i.projectionMatrix),vc.multiplyScalar(1/vc.w),vc.x=cp/n.width,vc.y=cp/n.height,vc.applyMatrix4(i.projectionMatrixInverse),vc.multiplyScalar(1/vc.w),Math.abs(Math.max(vc.x,vc.y))}function yK(i,e){const n=i.matrixWorld,r=i.geometry,s=r.attributes.instanceStart,a=r.attributes.instanceEnd,l=Math.min(r.instanceCount,s.count);for(let u=0,d=l;u<d;u++){ys.start.fromBufferAttribute(s,u),ys.end.fromBufferAttribute(a,u),ys.applyMatrix4(n);const h=new te,f=new te;yc.distanceSqToSegment(ys.start,ys.end,f,h),f.distanceTo(h)<cp*.5&&e.push({point:f,pointOnLine:h,distance:yc.origin.distanceTo(f),object:i,face:null,faceIndex:u,uv:null,[WU]:null})}}function SK(i,e,n){const r=e.projectionMatrix,a=i.material.resolution,l=i.matrixWorld,u=i.geometry,d=u.attributes.instanceStart,h=u.attributes.instanceEnd,f=Math.min(u.instanceCount,d.count),p=-e.near;yc.at(1,_c),_c.w=1,_c.applyMatrix4(e.matrixWorldInverse),_c.applyMatrix4(r),_c.multiplyScalar(1/_c.w),_c.x*=a.x/2,_c.y*=a.y/2,_c.z=0,qC.copy(_c),QC.multiplyMatrices(e.matrixWorldInverse,l);for(let m=0,T=f;m<T;m++){if(_s.fromBufferAttribute(d,m),vs.fromBufferAttribute(h,m),_s.w=1,vs.w=1,_s.applyMatrix4(QC),vs.applyMatrix4(QC),_s.z>p&&vs.z>p)continue;if(_s.z>p){const C=_s.z-vs.z,R=(_s.z-p)/C;_s.lerp(vs,R)}else if(vs.z>p){const C=vs.z-_s.z,R=(vs.z-p)/C;vs.lerp(_s,R)}_s.applyMatrix4(r),vs.applyMatrix4(r),_s.multiplyScalar(1/_s.w),vs.multiplyScalar(1/vs.w),_s.x*=a.x/2,_s.y*=a.y/2,vs.x*=a.x/2,vs.y*=a.y/2,ys.start.copy(_s),ys.start.z=0,ys.end.copy(vs),ys.end.z=0;const b=ys.closestPointToPointParameter(qC,!0);ys.at(b,Ik);const y=sp.lerp(_s.z,vs.z,b),S=y>=-1&&y<=1,A=qC.distanceTo(Ik)<cp*.5;if(S&&A){ys.start.fromBufferAttribute(d,m),ys.end.fromBufferAttribute(h,m),ys.start.applyMatrix4(l),ys.end.applyMatrix4(l);const C=new te,R=new te;yc.distanceSqToSegment(ys.start,ys.end,R,C),n.push({point:R,pointOnLine:C,distance:yc.origin.distanceTo(R),object:i,face:null,faceIndex:m,uv:null,[WU]:null})}}}class t2 extends Pn{constructor(e=new qM,n=new QM({color:Math.random()*16777215})){super(e,n),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,n=e.attributes.instanceStart,r=e.attributes.instanceEnd,s=new Float32Array(2*n.count);for(let l=0,u=0,d=n.count;l<d;l++,u+=2)wk.fromBufferAttribute(n,l),Mk.fromBufferAttribute(r,l),s[u]=u===0?0:s[u-1],s[u+1]=s[u]+wk.distanceTo(Mk);const a=new jS(s,2,1);return e.setAttribute("instanceDistanceStart",new lo(a,1,0)),e.setAttribute("instanceDistanceEnd",new lo(a,1,1)),this}raycast(e,n){const r=this.material.worldUnits,s=e.camera;s===null&&!r&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const a=e.params.Line2!==void 0&&e.params.Line2.threshold||0;yc=e.ray;const l=this.matrixWorld,u=this.geometry,d=this.material;cp=d.linewidth+a,u.boundingSphere===null&&u.computeBoundingSphere(),U0.copy(u.boundingSphere).applyMatrix4(l);let h;if(r)h=cp*.5;else{const p=Math.max(s.near,U0.distanceToPoint(yc.origin));h=Ok(s,p,d.resolution)}if(U0.radius+=h,yc.intersectsSphere(U0)===!1)return;u.boundingBox===null&&u.computeBoundingBox(),F0.copy(u.boundingBox).applyMatrix4(l);let f;if(r)f=cp*.5;else{const p=Math.max(s.near,F0.distanceToPoint(yc.origin));f=Ok(s,p,d.resolution)}F0.expandByScalar(f),yc.intersectsBox(F0)!==!1&&(r?yK(this,n):SK(this,s,n))}onBeforeRender(e){const n=this.material.uniforms;n&&n.resolution&&(e.getViewport(ZC),this.material.uniforms.resolution.value.set(ZC.z,ZC.w))}}class $K extends t2{constructor(e=new e2,n=new QM({color:Math.random()*16777215})){super(e,n),this.isLine2=!0,this.type="Line2"}}let G0;const ex=()=>{if(G0)return G0;const i="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),r=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let s=i;WebAssembly.validate(n)&&(s=e);let a;const l=WebAssembly.instantiate(u(s),{}).then(p=>{a=p.instance,a.exports.__wasm_call_ctors()});function u(p){const m=new Uint8Array(p.length);for(let E=0;E<p.length;++E){const b=p.charCodeAt(E);m[E]=b>96?b-71:b>64?b-65:b>47?b+4:b>46?63:62}let T=0;for(let E=0;E<p.length;++E)m[T++]=m[E]<60?r[m[E]]:(m[E]-60)*64+m[++E];return m.buffer.slice(0,T)}function d(p,m,T,E,b,y){const S=a.exports.sbrk,A=T+3&-4,C=S(A*E),R=S(b.length),I=new Uint8Array(a.exports.memory.buffer);I.set(b,R);const O=p(C,T,E,R,b.length);if(O===0&&y&&y(C,A,E),m.set(I.subarray(C,C+T*E)),S(C-S(0)),O!==0)throw new Error(`Malformed buffer data: ${O}`)}const h={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},f={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return G0={ready:l,supported:!0,decodeVertexBuffer(p,m,T,E,b){d(a.exports.meshopt_decodeVertexBuffer,p,m,T,E,a.exports[h[b]])},decodeIndexBuffer(p,m,T,E){d(a.exports.meshopt_decodeIndexBuffer,p,m,T,E)},decodeIndexSequence(p,m,T,E){d(a.exports.meshopt_decodeIndexSequence,p,m,T,E)},decodeGltfBuffer(p,m,T,E,b,y){d(a.exports[f[b]],p,m,T,E,a.exports[h[y]])}},G0},Al=q.forwardRef(function({children:e,follow:n=!0,lockX:r=!1,lockY:s=!1,lockZ:a=!1,...l},u){const d=q.useRef(null),h=q.useRef(null),f=new Er;return PE(({camera:p})=>{if(!n||!h.current)return;const m=h.current.rotation.clone();h.current.updateMatrix(),h.current.updateWorldMatrix(!1,!1),h.current.getWorldQuaternion(f),p.getWorldQuaternion(d.current.quaternion).premultiply(f.invert()),r&&(h.current.rotation.x=m.x),s&&(h.current.rotation.y=m.y),a&&(h.current.rotation.z=m.z)}),q.useImperativeHandle(u,()=>h.current,[]),q.createElement("group",Dl({ref:h},l),q.createElement("group",{ref:d},e))}),n2=q.forwardRef(function({points:e,color:n=16777215,vertexColors:r,linewidth:s,lineWidth:a,segments:l,dashed:u,...d},h){var f,p;const m=$n(S=>S.size),T=q.useMemo(()=>l?new t2:new $K,[l]),[E]=q.useState(()=>new QM),b=(r==null||(f=r[0])==null?void 0:f.length)===4?4:3,y=q.useMemo(()=>{const S=l?new qM:new e2,A=e.map(C=>{const R=Array.isArray(C);return C instanceof te||C instanceof Hn?[C.x,C.y,C.z]:C instanceof mt?[C.x,C.y,0]:R&&C.length===3?[C[0],C[1],C[2]]:R&&C.length===2?[C[0],C[1],0]:C});if(S.setPositions(A.flat()),r){n=16777215;const C=r.map(R=>R instanceof Ct?R.toArray():R);S.setColors(C.flat(),b)}return S},[e,l,r,b]);return q.useLayoutEffect(()=>{T.computeLineDistances()},[e,T]),q.useLayoutEffect(()=>{u?E.defines.USE_DASH="":delete E.defines.USE_DASH,E.needsUpdate=!0},[u,E]),q.useEffect(()=>()=>{y.dispose(),E.dispose()},[y]),q.createElement("primitive",Dl({object:T,ref:h},d),q.createElement("primitive",{object:y,attach:"geometry"}),q.createElement("primitive",Dl({object:E,attach:"material",color:n,vertexColors:!!r,resolution:[m.width,m.height],linewidth:(p=s??a)!==null&&p!==void 0?p:1,dashed:u,transparent:b===4},d)))});function bK(){var i=Object.create(null);function e(s,a){var l=s.id,u=s.name,d=s.dependencies;d===void 0&&(d=[]);var h=s.init;h===void 0&&(h=function(){});var f=s.getTransferables;if(f===void 0&&(f=null),!i[l])try{d=d.map(function(m){return m&&m.isWorkerModule&&(e(m,function(T){if(T instanceof Error)throw T}),m=i[m.id].value),m}),h=r("<"+u+">.init",h),f&&(f=r("<"+u+">.getTransferables",f));var p=null;typeof h=="function"?p=h.apply(void 0,d):console.error("worker module init function failed to rehydrate"),i[l]={id:l,value:p,getTransferables:f},a(p)}catch(m){m&&m.noLog||console.error(m),a(m)}}function n(s,a){var l,u=s.id,d=s.args;(!i[u]||typeof i[u].value!="function")&&a(new Error("Worker module "+u+": not found or its 'init' did not return a function"));try{var h=(l=i[u]).value.apply(l,d);h&&typeof h.then=="function"?h.then(f,function(p){return a(p instanceof Error?p:new Error(""+p))}):f(h)}catch(p){a(p)}function f(p){try{var m=i[u].getTransferables&&i[u].getTransferables(p);(!m||!Array.isArray(m)||!m.length)&&(m=void 0),a(p,m)}catch(T){console.error(T),a(T)}}}function r(s,a){var l=void 0;self.troikaDefine=function(d){return l=d};var u=URL.createObjectURL(new Blob(["/** "+s.replace(/\*/g,"")+` **/

troikaDefine(
`+a+`
)`],{type:"application/javascript"}));try{importScripts(u)}catch(d){console.error(d)}return URL.revokeObjectURL(u),delete self.troikaDefine,l}self.addEventListener("message",function(s){var a=s.data,l=a.messageId,u=a.action,d=a.data;try{u==="registerModule"&&e(d,function(h){h instanceof Error?postMessage({messageId:l,success:!1,error:h.message}):postMessage({messageId:l,success:!0,result:{isCallable:typeof h=="function"}})}),u==="callModule"&&n(d,function(h,f){h instanceof Error?postMessage({messageId:l,success:!1,error:h.message}):postMessage({messageId:l,success:!0,result:h},f||void 0)})}catch(h){postMessage({messageId:l,success:!1,error:h.stack})}})}function AK(i){var e=function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];return e._getInitResult().then(function(s){if(typeof s=="function")return s.apply(void 0,n);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var n=i.dependencies,r=i.init;n=Array.isArray(n)?n.map(function(a){return a&&a._getInitResult?a._getInitResult():a}):[];var s=Promise.all(n).then(function(a){return r.apply(null,a)});return e._getInitResult=function(){return s},s},e}var i2=function(){var i=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),i=!0}catch(n){typeof process<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+n.message+"]")}return i2=function(){return i},i},CK=0,xK=0,tx=!1,OT=Object.create(null),LT=Object.create(null),QR=Object.create(null);function l_(i){if((!i||typeof i.init!="function")&&!tx)throw new Error("requires `options.init` function");var e=i.dependencies,n=i.init,r=i.getTransferables,s=i.workerId;if(!i2())return AK(i);s==null&&(s="#default");var a="workerModule"+ ++CK,l=i.name||a,u=null;e=e&&e.map(function(h){return typeof h=="function"&&!h.workerModuleData&&(tx=!0,h=l_({workerId:s,name:"<"+l+"> function dependency: "+h.name,init:`function(){return (
`+_S(h)+`
)}`}),tx=!1),h&&h.workerModuleData&&(h=h.workerModuleData),h});function d(){for(var h=[],f=arguments.length;f--;)h[f]=arguments[f];if(!u){u=Lk(s,"registerModule",d.workerModuleData);var p=function(){u=null,LT[s].delete(p)};(LT[s]||(LT[s]=new Set)).add(p)}return u.then(function(m){var T=m.isCallable;if(T)return Lk(s,"callModule",{id:a,args:h});throw new Error("Worker module function was called but `init` did not return a callable function")})}return d.workerModuleData={isWorkerModule:!0,id:a,name:l,dependencies:e,init:_S(n),getTransferables:r&&_S(r)},d}function RK(i){LT[i]&&LT[i].forEach(function(e){e()}),OT[i]&&(OT[i].terminate(),delete OT[i])}function _S(i){var e=i.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function wK(i){var e=OT[i];if(!e){var n=_S(bK);e=OT[i]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+i.replace(/\*/g,"")+` **/

;(`+n+")()"],{type:"application/javascript"}))),e.onmessage=function(r){var s=r.data,a=s.messageId,l=QR[a];if(!l)throw new Error("WorkerModule response with empty or unknown messageId");delete QR[a],l(s)}}return e}function Lk(i,e,n){return new Promise(function(r,s){var a=++xK;QR[a]=function(l){l.success?r(l.result):s(new Error("Error in worker "+e+" call: "+l.error))},wK(i).postMessage({messageId:a,action:e,data:n})})}function r2(){var i=function(e){function n(J,K,se,Y,he,ue,Te,_e){var Re=1-Te;_e.x=Re*Re*J+2*Re*Te*se+Te*Te*he,_e.y=Re*Re*K+2*Re*Te*Y+Te*Te*ue}function r(J,K,se,Y,he,ue,Te,_e,Re,De){var et=1-Re;De.x=et*et*et*J+3*et*et*Re*se+3*et*Re*Re*he+Re*Re*Re*Te,De.y=et*et*et*K+3*et*et*Re*Y+3*et*Re*Re*ue+Re*Re*Re*_e}function s(J,K){for(var se=/([MLQCZ])([^MLQCZ]*)/g,Y,he,ue,Te,_e;Y=se.exec(J);){var Re=Y[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(De){return parseFloat(De)});switch(Y[1]){case"M":Te=he=Re[0],_e=ue=Re[1];break;case"L":(Re[0]!==Te||Re[1]!==_e)&&K("L",Te,_e,Te=Re[0],_e=Re[1]);break;case"Q":{K("Q",Te,_e,Te=Re[2],_e=Re[3],Re[0],Re[1]);break}case"C":{K("C",Te,_e,Te=Re[4],_e=Re[5],Re[0],Re[1],Re[2],Re[3]);break}case"Z":(Te!==he||_e!==ue)&&K("L",Te,_e,he,ue);break}}}function a(J,K,se){se===void 0&&(se=16);var Y={x:0,y:0};s(J,function(he,ue,Te,_e,Re,De,et,Ue,Le){switch(he){case"L":K(ue,Te,_e,Re);break;case"Q":{for(var re=ue,Ye=Te,Fe=1;Fe<se;Fe++)n(ue,Te,De,et,_e,Re,Fe/(se-1),Y),K(re,Ye,Y.x,Y.y),re=Y.x,Ye=Y.y;break}case"C":{for(var Ze=ue,Xe=Te,dt=1;dt<se;dt++)r(ue,Te,De,et,Ue,Le,_e,Re,dt/(se-1),Y),K(Ze,Xe,Y.x,Y.y),Ze=Y.x,Xe=Y.y;break}}})}var l="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",u="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",d=new WeakMap,h={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function f(J,K){var se=J.getContext?J.getContext("webgl",h):J,Y=d.get(se);if(!Y){let Ze=function(Me){var St=ue[Me];if(!St&&(St=ue[Me]=se.getExtension(Me),!St))throw new Error(Me+" not supported");return St},Xe=function(Me,St){var oe=se.createShader(St);return se.shaderSource(oe,Me),se.compileShader(oe),oe},dt=function(Me,St,oe,ee){if(!Te[Me]){var W={},ot={},ze=se.createProgram();se.attachShader(ze,Xe(St,se.VERTEX_SHADER)),se.attachShader(ze,Xe(oe,se.FRAGMENT_SHADER)),se.linkProgram(ze),Te[Me]={program:ze,transaction:function(ut){se.useProgram(ze),ut({setUniform:function(Ge,$t){for(var L=[],X=arguments.length-2;X-- >0;)L[X]=arguments[X+2];var fe=ot[$t]||(ot[$t]=se.getUniformLocation(ze,$t));se["uniform"+Ge].apply(se,[fe].concat(L))},setAttribute:function(Ge,$t,L,X,fe){var z=W[Ge];z||(z=W[Ge]={buf:se.createBuffer(),loc:se.getAttribLocation(ze,Ge),data:null}),se.bindBuffer(se.ARRAY_BUFFER,z.buf),se.vertexAttribPointer(z.loc,$t,se.FLOAT,!1,0,0),se.enableVertexAttribArray(z.loc),he?se.vertexAttribDivisor(z.loc,X):Ze("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(z.loc,X),fe!==z.data&&(se.bufferData(se.ARRAY_BUFFER,fe,L),z.data=fe)}})}}}Te[Me].transaction(ee)},je=function(Me,St){Re++;try{se.activeTexture(se.TEXTURE0+Re);var oe=_e[Me];oe||(oe=_e[Me]=se.createTexture(),se.bindTexture(se.TEXTURE_2D,oe),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MIN_FILTER,se.NEAREST),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MAG_FILTER,se.NEAREST)),se.bindTexture(se.TEXTURE_2D,oe),St(oe,Re)}finally{Re--}},it=function(Me,St,oe){var ee=se.createFramebuffer();De.push(ee),se.bindFramebuffer(se.FRAMEBUFFER,ee),se.activeTexture(se.TEXTURE0+St),se.bindTexture(se.TEXTURE_2D,Me),se.framebufferTexture2D(se.FRAMEBUFFER,se.COLOR_ATTACHMENT0,se.TEXTURE_2D,Me,0);try{oe(ee)}finally{se.deleteFramebuffer(ee),se.bindFramebuffer(se.FRAMEBUFFER,De[--De.length-1]||null)}},Ce=function(){ue={},Te={},_e={},Re=-1,De.length=0};var et=Ze,Ue=Xe,Le=dt,re=je,Ye=it,Fe=Ce,he=typeof WebGL2RenderingContext<"u"&&se instanceof WebGL2RenderingContext,ue={},Te={},_e={},Re=-1,De=[];se.canvas.addEventListener("webglcontextlost",function(Me){Ce(),Me.preventDefault()},!1),d.set(se,Y={gl:se,isWebGL2:he,getExtension:Ze,withProgram:dt,withTexture:je,withTextureFramebuffer:it,handleContextLoss:Ce})}K(Y)}function p(J,K,se,Y,he,ue,Te,_e){Te===void 0&&(Te=15),_e===void 0&&(_e=null),f(J,function(Re){var De=Re.gl,et=Re.withProgram,Ue=Re.withTexture;Ue("copy",function(Le,re){De.texImage2D(De.TEXTURE_2D,0,De.RGBA,he,ue,0,De.RGBA,De.UNSIGNED_BYTE,K),et("copy",l,u,function(Ye){var Fe=Ye.setUniform,Ze=Ye.setAttribute;Ze("aUV",2,De.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),Fe("1i","image",re),De.bindFramebuffer(De.FRAMEBUFFER,_e||null),De.disable(De.BLEND),De.colorMask(Te&8,Te&4,Te&2,Te&1),De.viewport(se,Y,he,ue),De.scissor(se,Y,he,ue),De.drawArrays(De.TRIANGLES,0,3)})})})}function m(J,K,se){var Y=J.width,he=J.height;f(J,function(ue){var Te=ue.gl,_e=new Uint8Array(Y*he*4);Te.readPixels(0,0,Y,he,Te.RGBA,Te.UNSIGNED_BYTE,_e),J.width=K,J.height=se,p(Te,_e,0,0,Y,he)})}var T=Object.freeze({__proto__:null,withWebGLContext:f,renderImageData:p,resizeWebGLCanvasWithoutClearing:m});function E(J,K,se,Y,he,ue){ue===void 0&&(ue=1);var Te=new Uint8Array(J*K),_e=Y[2]-Y[0],Re=Y[3]-Y[1],De=[];a(se,function(Ze,Xe,dt,je){De.push({x1:Ze,y1:Xe,x2:dt,y2:je,minX:Math.min(Ze,dt),minY:Math.min(Xe,je),maxX:Math.max(Ze,dt),maxY:Math.max(Xe,je)})}),De.sort(function(Ze,Xe){return Ze.maxX-Xe.maxX});for(var et=0;et<J;et++)for(var Ue=0;Ue<K;Ue++){var Le=Ye(Y[0]+_e*(et+.5)/J,Y[1]+Re*(Ue+.5)/K),re=Math.pow(1-Math.abs(Le)/he,ue)/2;Le<0&&(re=1-re),re=Math.max(0,Math.min(255,Math.round(re*255))),Te[Ue*J+et]=re}return Te;function Ye(Ze,Xe){for(var dt=1/0,je=1/0,it=De.length;it--;){var Ce=De[it];if(Ce.maxX+je<=Ze)break;if(Ze+je>Ce.minX&&Xe-je<Ce.maxY&&Xe+je>Ce.minY){var Me=S(Ze,Xe,Ce.x1,Ce.y1,Ce.x2,Ce.y2);Me<dt&&(dt=Me,je=Math.sqrt(dt))}}return Fe(Ze,Xe)&&(je=-je),je}function Fe(Ze,Xe){for(var dt=0,je=De.length;je--;){var it=De[je];if(it.maxX<=Ze)break;var Ce=it.y1>Xe!=it.y2>Xe&&Ze<(it.x2-it.x1)*(Xe-it.y1)/(it.y2-it.y1)+it.x1;Ce&&(dt+=it.y1<it.y2?1:-1)}return dt!==0}}function b(J,K,se,Y,he,ue,Te,_e,Re,De){ue===void 0&&(ue=1),_e===void 0&&(_e=0),Re===void 0&&(Re=0),De===void 0&&(De=0),y(J,K,se,Y,he,ue,Te,null,_e,Re,De)}function y(J,K,se,Y,he,ue,Te,_e,Re,De,et){ue===void 0&&(ue=1),Re===void 0&&(Re=0),De===void 0&&(De=0),et===void 0&&(et=0);for(var Ue=E(J,K,se,Y,he,ue),Le=new Uint8Array(Ue.length*4),re=0;re<Ue.length;re++)Le[re*4+et]=Ue[re];p(Te,Le,Re,De,J,K,1<<3-et,_e)}function S(J,K,se,Y,he,ue){var Te=he-se,_e=ue-Y,Re=Te*Te+_e*_e,De=Re?Math.max(0,Math.min(1,((J-se)*Te+(K-Y)*_e)/Re)):0,et=J-(se+De*Te),Ue=K-(Y+De*_e);return et*et+Ue*Ue}var A=Object.freeze({__proto__:null,generate:E,generateIntoCanvas:b,generateIntoFramebuffer:y}),C="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",R="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",I="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",O=new Float32Array([0,0,2,0,0,2]),F=null,k=!1,D={},U=new WeakMap;function ce(J){if(!k&&!pe(J))throw new Error("WebGL generation not supported")}function ie(J,K,se,Y,he,ue,Te){if(ue===void 0&&(ue=1),Te===void 0&&(Te=null),!Te&&(Te=F,!Te)){var _e=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!_e)throw new Error("OffscreenCanvas or DOM canvas not supported");Te=F=_e.getContext("webgl",{depth:!1})}ce(Te);var Re=new Uint8Array(J*K*4);f(Te,function(Le){var re=Le.gl,Ye=Le.withTexture,Fe=Le.withTextureFramebuffer;Ye("readable",function(Ze,Xe){re.texImage2D(re.TEXTURE_2D,0,re.RGBA,J,K,0,re.RGBA,re.UNSIGNED_BYTE,null),Fe(Ze,Xe,function(dt){ne(J,K,se,Y,he,ue,re,dt,0,0,0),re.readPixels(0,0,J,K,re.RGBA,re.UNSIGNED_BYTE,Re)})})});for(var De=new Uint8Array(J*K),et=0,Ue=0;et<Re.length;et+=4)De[Ue++]=Re[et];return De}function ae(J,K,se,Y,he,ue,Te,_e,Re,De){ue===void 0&&(ue=1),_e===void 0&&(_e=0),Re===void 0&&(Re=0),De===void 0&&(De=0),ne(J,K,se,Y,he,ue,Te,null,_e,Re,De)}function ne(J,K,se,Y,he,ue,Te,_e,Re,De,et){ue===void 0&&(ue=1),Re===void 0&&(Re=0),De===void 0&&(De=0),et===void 0&&(et=0),ce(Te);var Ue=[];a(se,function(Le,re,Ye,Fe){Ue.push(Le,re,Ye,Fe)}),Ue=new Float32Array(Ue),f(Te,function(Le){var re=Le.gl,Ye=Le.isWebGL2,Fe=Le.getExtension,Ze=Le.withProgram,Xe=Le.withTexture,dt=Le.withTextureFramebuffer,je=Le.handleContextLoss;if(Xe("rawDistances",function(it,Ce){(J!==it._lastWidth||K!==it._lastHeight)&&re.texImage2D(re.TEXTURE_2D,0,re.RGBA,it._lastWidth=J,it._lastHeight=K,0,re.RGBA,re.UNSIGNED_BYTE,null),Ze("main",C,R,function(Me){var St=Me.setAttribute,oe=Me.setUniform,ee=!Ye&&Fe("ANGLE_instanced_arrays"),W=!Ye&&Fe("EXT_blend_minmax");St("aUV",2,re.STATIC_DRAW,0,O),St("aLineSegment",4,re.DYNAMIC_DRAW,1,Ue),oe.apply(void 0,["4f","uGlyphBounds"].concat(Y)),oe("1f","uMaxDistance",he),oe("1f","uExponent",ue),dt(it,Ce,function(ot){re.enable(re.BLEND),re.colorMask(!0,!0,!0,!0),re.viewport(0,0,J,K),re.scissor(0,0,J,K),re.blendFunc(re.ONE,re.ONE),re.blendEquationSeparate(re.FUNC_ADD,Ye?re.MAX:W.MAX_EXT),re.clear(re.COLOR_BUFFER_BIT),Ye?re.drawArraysInstanced(re.TRIANGLES,0,3,Ue.length/4):ee.drawArraysInstancedANGLE(re.TRIANGLES,0,3,Ue.length/4)})}),Ze("post",l,I,function(Me){Me.setAttribute("aUV",2,re.STATIC_DRAW,0,O),Me.setUniform("1i","tex",Ce),re.bindFramebuffer(re.FRAMEBUFFER,_e),re.disable(re.BLEND),re.colorMask(et===0,et===1,et===2,et===3),re.viewport(Re,De,J,K),re.scissor(Re,De,J,K),re.drawArrays(re.TRIANGLES,0,3)})}),re.isContextLost())throw je(),new Error("webgl context lost")})}function pe(J){var K=!J||J===F?D:J.canvas||J,se=U.get(K);if(se===void 0){k=!0;var Y=null;try{var he=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],ue=ie(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,J);se=ue&&he.length===ue.length&&ue.every(function(Te,_e){return Te===he[_e]}),se||(Y="bad trial run results",console.info(he,ue))}catch(Te){se=!1,Y=Te.message}Y&&console.warn("WebGL SDF generation not supported:",Y),k=!1,U.set(K,se)}return se}var de=Object.freeze({__proto__:null,generate:ie,generateIntoCanvas:ae,generateIntoFramebuffer:ne,isSupported:pe});function xe(J,K,se,Y,he,ue){he===void 0&&(he=Math.max(Y[2]-Y[0],Y[3]-Y[1])/2),ue===void 0&&(ue=1);try{return ie.apply(de,arguments)}catch(Te){return console.info("WebGL SDF generation failed, falling back to JS",Te),E.apply(A,arguments)}}function H(J,K,se,Y,he,ue,Te,_e,Re,De){he===void 0&&(he=Math.max(Y[2]-Y[0],Y[3]-Y[1])/2),ue===void 0&&(ue=1),_e===void 0&&(_e=0),Re===void 0&&(Re=0),De===void 0&&(De=0);try{return ae.apply(de,arguments)}catch(et){return console.info("WebGL SDF generation failed, falling back to JS",et),b.apply(A,arguments)}}return e.forEachPathCommand=s,e.generate=xe,e.generateIntoCanvas=H,e.javascript=A,e.pathToLineSegments=a,e.webgl=de,e.webglUtils=T,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return i}function MK(){var i=function(e){var n={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},r={},s={};r.L=1,s[1]="L",Object.keys(n).forEach(function(je,it){r[je]=1<<it+1,s[r[je]]=je}),Object.freeze(r);var a=r.LRI|r.RLI|r.FSI,l=r.L|r.R|r.AL,u=r.B|r.S|r.WS|r.ON|r.FSI|r.LRI|r.RLI|r.PDI,d=r.BN|r.RLE|r.LRE|r.RLO|r.LRO|r.PDF,h=r.S|r.WS|r.B|a|r.PDI|d,f=null;function p(){if(!f){f=new Map;var je=function(Ce){if(n.hasOwnProperty(Ce)){var Me=0;n[Ce].split(",").forEach(function(St){var oe=St.split("+"),ee=oe[0],W=oe[1];ee=parseInt(ee,36),W=W?parseInt(W,36):0,f.set(Me+=ee,r[Ce]);for(var ot=0;ot<W;ot++)f.set(++Me,r[Ce])})}};for(var it in n)je(it)}}function m(je){return p(),f.get(je.codePointAt(0))||r.L}function T(je){return s[m(je)]}var E={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function b(je,it){var Ce=36,Me=0,St=new Map,oe=it&&new Map,ee;return je.split(",").forEach(function W(ot){if(ot.indexOf("+")!==-1)for(var ze=+ot;ze--;)W(ee);else{ee=ot;var qe=ot.split(">"),ut=qe[0],ft=qe[1];ut=String.fromCodePoint(Me+=parseInt(ut,Ce)),ft=String.fromCodePoint(Me+=parseInt(ft,Ce)),St.set(ut,ft),it&&oe.set(ft,ut)}}),{map:St,reverseMap:oe}}var y,S,A;function C(){if(!y){var je=b(E.pairs,!0),it=je.map,Ce=je.reverseMap;y=it,S=Ce,A=b(E.canonical,!1).map}}function R(je){return C(),y.get(je)||null}function I(je){return C(),S.get(je)||null}function O(je){return C(),A.get(je)||null}var F=r.L,k=r.R,D=r.EN,U=r.ES,ce=r.ET,ie=r.AN,ae=r.CS,ne=r.B,pe=r.S,de=r.ON,xe=r.BN,H=r.NSM,J=r.AL,K=r.LRO,se=r.RLO,Y=r.LRE,he=r.RLE,ue=r.PDF,Te=r.LRI,_e=r.RLI,Re=r.FSI,De=r.PDI;function et(je,it){for(var Ce=125,Me=new Uint32Array(je.length),St=0;St<je.length;St++)Me[St]=m(je[St]);var oe=new Map;function ee(Qt,yn){var li=Me[Qt];Me[Qt]=yn,oe.set(li,oe.get(li)-1),li&u&&oe.set(u,oe.get(u)-1),oe.set(yn,(oe.get(yn)||0)+1),yn&u&&oe.set(u,(oe.get(u)||0)+1)}for(var W=new Uint8Array(je.length),ot=new Map,ze=[],qe=null,ut=0;ut<je.length;ut++)qe||ze.push(qe={start:ut,end:je.length-1,level:it==="rtl"?1:it==="ltr"?0:_n(ut,!1)}),Me[ut]&ne&&(qe.end=ut,qe=null);for(var ft=he|Y|se|K|a|De|ue|ne,Ge=function(Qt){return Qt+(Qt&1?1:2)},$t=function(Qt){return Qt+(Qt&1?2:1)},L=0;L<ze.length;L++){qe=ze[L];var X=[{_level:qe.level,_override:0,_isolate:0}],fe=void 0,z=0,Ae=0,tt=0;oe.clear();for(var ye=qe.start;ye<=qe.end;ye++){var Ie=Me[ye];if(fe=X[X.length-1],oe.set(Ie,(oe.get(Ie)||0)+1),Ie&u&&oe.set(u,(oe.get(u)||0)+1),Ie&ft)if(Ie&(he|Y)){W[ye]=fe._level;var Be=(Ie===he?$t:Ge)(fe._level);Be<=Ce&&!z&&!Ae?X.push({_level:Be,_override:0,_isolate:0}):z||Ae++}else if(Ie&(se|K)){W[ye]=fe._level;var N=(Ie===se?$t:Ge)(fe._level);N<=Ce&&!z&&!Ae?X.push({_level:N,_override:Ie&se?k:F,_isolate:0}):z||Ae++}else if(Ie&a){Ie&Re&&(Ie=_n(ye+1,!0)===1?_e:Te),W[ye]=fe._level,fe._override&&ee(ye,fe._override);var j=(Ie===_e?$t:Ge)(fe._level);j<=Ce&&z===0&&Ae===0?(tt++,X.push({_level:j,_override:0,_isolate:1,_isolInitIndex:ye})):z++}else if(Ie&De){if(z>0)z--;else if(tt>0){for(Ae=0;!X[X.length-1]._isolate;)X.pop();var ge=X[X.length-1]._isolInitIndex;ge!=null&&(ot.set(ge,ye),ot.set(ye,ge)),X.pop(),tt--}fe=X[X.length-1],W[ye]=fe._level,fe._override&&ee(ye,fe._override)}else Ie&ue?(z===0&&(Ae>0?Ae--:!fe._isolate&&X.length>1&&(X.pop(),fe=X[X.length-1])),W[ye]=fe._level):Ie&ne&&(W[ye]=qe.level);else W[ye]=fe._level,fe._override&&Ie!==xe&&ee(ye,fe._override)}for(var we=[],We=null,gt=qe.start;gt<=qe.end;gt++){var bt=Me[gt];if(!(bt&d)){var un=W[gt],an=bt&a,ei=bt===De;We&&un===We._level?(We._end=gt,We._endsWithIsolInit=an):we.push(We={_start:gt,_end:gt,_level:un,_startsWithPDI:ei,_endsWithIsolInit:an})}}for(var pi=[],Ji=0;Ji<we.length;Ji++){var Ci=we[Ji];if(!Ci._startsWithPDI||Ci._startsWithPDI&&!ot.has(Ci._start)){for(var vi=[We=Ci],Ti=void 0;We&&We._endsWithIsolInit&&(Ti=ot.get(We._end))!=null;)for(var nn=Ji+1;nn<we.length;nn++)if(we[nn]._start===Ti){vi.push(We=we[nn]);break}for(var mi=[],yr=0;yr<vi.length;yr++)for(var Z=vi[yr],B=Z._start;B<=Z._end;B++)mi.push(B);for(var le=W[mi[0]],ve=qe.level,me=mi[0]-1;me>=0;me--)if(!(Me[me]&d)){ve=W[me];break}var Se=mi[mi.length-1],Ke=W[Se],Je=qe.level;if(!(Me[Se]&a)){for(var at=Se+1;at<=qe.end;at++)if(!(Me[at]&d)){Je=W[at];break}}pi.push({_seqIndices:mi,_sosType:Math.max(ve,le)%2?k:F,_eosType:Math.max(Je,Ke)%2?k:F})}}for(var rt=0;rt<pi.length;rt++){var pt=pi[rt],Ne=pt._seqIndices,It=pt._sosType,xt=pt._eosType,wt=W[Ne[0]]&1?k:F;if(oe.get(H))for(var Ht=0;Ht<Ne.length;Ht++){var Zt=Ne[Ht];if(Me[Zt]&H){for(var jt=It,Ot=Ht-1;Ot>=0;Ot--)if(!(Me[Ne[Ot]]&d)){jt=Me[Ne[Ot]];break}ee(Zt,jt&(a|De)?de:jt)}}if(oe.get(D))for(var qt=0;qt<Ne.length;qt++){var Ft=Ne[qt];if(Me[Ft]&D)for(var ln=qt-1;ln>=-1;ln--){var Bn=ln===-1?It:Me[Ne[ln]];if(Bn&l){Bn===J&&ee(Ft,ie);break}}}if(oe.get(J))for(var on=0;on<Ne.length;on++){var bn=Ne[on];Me[bn]&J&&ee(bn,k)}if(oe.get(U)||oe.get(ae))for(var tn=1;tn<Ne.length-1;tn++){var Fn=Ne[tn];if(Me[Fn]&(U|ae)){for(var xn=0,hn=0,zn=tn-1;zn>=0&&(xn=Me[Ne[zn]],!!(xn&d));zn--);for(var Mn=tn+1;Mn<Ne.length&&(hn=Me[Ne[Mn]],!!(hn&d));Mn++);xn===hn&&(Me[Fn]===U?xn===D:xn&(D|ie))&&ee(Fn,xn)}}if(oe.get(D))for(var Kt=0;Kt<Ne.length;Kt++){var An=Ne[Kt];if(Me[An]&D){for(var Sr=Kt-1;Sr>=0&&Me[Ne[Sr]]&(ce|d);Sr--)ee(Ne[Sr],D);for(Kt++;Kt<Ne.length&&Me[Ne[Kt]]&(ce|d|D);Kt++)Me[Ne[Kt]]!==D&&ee(Ne[Kt],D)}}if(oe.get(ce)||oe.get(U)||oe.get(ae))for(var xi=0;xi<Ne.length;xi++){var mn=Ne[xi];if(Me[mn]&(ce|U|ae)){ee(mn,de);for(var ls=xi-1;ls>=0&&Me[Ne[ls]]&d;ls--)ee(Ne[ls],de);for(var Ys=xi+1;Ys<Ne.length&&Me[Ne[Ys]]&d;Ys++)ee(Ne[Ys],de)}}if(oe.get(D))for(var xs=0,hi=It;xs<Ne.length;xs++){var Rs=Ne[xs],dn=Me[Rs];dn&D?hi===F&&ee(Rs,F):dn&l&&(hi=dn)}if(oe.get(u)){var kr=k|D|ie,jn=kr|F,Qr=[];{for(var Pr=[],ti=0;ti<Ne.length;ti++)if(Me[Ne[ti]]&u){var sn=je[Ne[ti]],Ei=void 0;if(R(sn)!==null)if(Pr.length<63)Pr.push({char:sn,seqIndex:ti});else break;else if((Ei=I(sn))!==null)for(var cs=Pr.length-1;cs>=0;cs--){var Vi=Pr[cs].char;if(Vi===Ei||Vi===I(O(sn))||R(O(Vi))===sn){Qr.push([Pr[cs].seqIndex,ti]),Pr.length=cs;break}}}Qr.sort(function(Qt,yn){return Qt[0]-yn[0]})}for(var Gl=0;Gl<Qr.length;Gl++){for(var Dr=Qr[Gl],ai=Dr[0],ws=Dr[1],Za=!1,mr=0,qa=ai+1;qa<ws;qa++){var Ri=Ne[qa];if(Me[Ri]&jn){Za=!0;var Ii=Me[Ri]&kr?k:F;if(Ii===wt){mr=Ii;break}}}if(Za&&!mr){mr=It;for(var _o=ai-1;_o>=0;_o--){var Hl=Ne[_o];if(Me[Hl]&jn){var $r=Me[Hl]&kr?k:F;$r!==wt?mr=$r:mr=wt;break}}}if(mr){if(Me[Ne[ai]]=Me[Ne[ws]]=mr,mr!==wt){for(var or=ai+1;or<Ne.length;or++)if(!(Me[Ne[or]]&d)){m(je[Ne[or]])&H&&(Me[Ne[or]]=mr);break}}if(mr!==wt){for(var Ks=ws+1;Ks<Ne.length;Ks++)if(!(Me[Ne[Ks]]&d)){m(je[Ne[Ks]])&H&&(Me[Ne[Ks]]=mr);break}}}}for(var gr=0;gr<Ne.length;gr++)if(Me[Ne[gr]]&u){for(var ma=gr,Vl=gr,Br=It,Bo=gr-1;Bo>=0;Bo--)if(Me[Ne[Bo]]&d)ma=Bo;else{Br=Me[Ne[Bo]]&kr?k:F;break}for(var vo=xt,Js=gr+1;Js<Ne.length;Js++)if(Me[Ne[Js]]&(u|d))Vl=Js;else{vo=Me[Ne[Js]]&kr?k:F;break}for(var Oi=ma;Oi<=Vl;Oi++)Me[Ne[Oi]]=Br===vo?Br:wt;gr=Vl}}}for(var Ee=qe.start;Ee<=qe.end;Ee++){var Oe=W[Ee],lt=Me[Ee];if(Oe&1?lt&(F|D|ie)&&W[Ee]++:lt&k?W[Ee]++:lt&(ie|D)&&(W[Ee]+=2),lt&d&&(W[Ee]=Ee===0?qe.level:W[Ee-1]),Ee===qe.end||m(je[Ee])&(pe|ne))for(var Et=Ee;Et>=0&&m(je[Et])&h;Et--)W[Et]=qe.level}}return{levels:W,paragraphs:ze};function _n(Qt,yn){for(var li=Qt;li<je.length;li++){var ci=Me[li];if(ci&(k|J))return 1;if(ci&(ne|F)||yn&&ci===De)return 0;if(ci&a){var br=fn(li);li=br===-1?je.length:br}}return 0}function fn(Qt){for(var yn=1,li=Qt+1;li<je.length;li++){var ci=Me[li];if(ci&ne)break;if(ci&De){if(--yn===0)return li}else ci&a&&yn++}return-1}}var Ue="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",Le;function re(){if(!Le){var je=b(Ue,!0),it=je.map,Ce=je.reverseMap;Ce.forEach(function(Me,St){it.set(St,Me)}),Le=it}}function Ye(je){return re(),Le.get(je)||null}function Fe(je,it,Ce,Me){var St=je.length;Ce=Math.max(0,Ce==null?0:+Ce),Me=Math.min(St-1,Me==null?St-1:+Me);for(var oe=new Map,ee=Ce;ee<=Me;ee++)if(it[ee]&1){var W=Ye(je[ee]);W!==null&&oe.set(ee,W)}return oe}function Ze(je,it,Ce,Me){var St=je.length;Ce=Math.max(0,Ce==null?0:+Ce),Me=Math.min(St-1,Me==null?St-1:+Me);var oe=[];return it.paragraphs.forEach(function(ee){var W=Math.max(Ce,ee.start),ot=Math.min(Me,ee.end);if(W<ot){for(var ze=it.levels.slice(W,ot+1),qe=ot;qe>=W&&m(je[qe])&h;qe--)ze[qe]=ee.level;for(var ut=ee.level,ft=1/0,Ge=0;Ge<ze.length;Ge++){var $t=ze[Ge];$t>ut&&(ut=$t),$t<ft&&(ft=$t|1)}for(var L=ut;L>=ft;L--)for(var X=0;X<ze.length;X++)if(ze[X]>=L){for(var fe=X;X+1<ze.length&&ze[X+1]>=L;)X++;X>fe&&oe.push([fe+W,X+W])}}}),oe}function Xe(je,it,Ce,Me){var St=dt(je,it,Ce,Me),oe=[].concat(je);return St.forEach(function(ee,W){oe[W]=(it.levels[ee]&1?Ye(je[ee]):null)||je[ee]}),oe.join("")}function dt(je,it,Ce,Me){for(var St=Ze(je,it,Ce,Me),oe=[],ee=0;ee<je.length;ee++)oe[ee]=ee;return St.forEach(function(W){for(var ot=W[0],ze=W[1],qe=oe.slice(ot,ze+1),ut=qe.length;ut--;)oe[ze-ut]=qe[ut]}),oe}return e.closingToOpeningBracket=I,e.getBidiCharType=m,e.getBidiCharTypeName=T,e.getCanonicalBracket=O,e.getEmbeddingLevels=et,e.getMirroredCharacter=Ye,e.getMirroredCharactersMap=Fe,e.getReorderSegments=Ze,e.getReorderedIndices=dt,e.getReorderedString=Xe,e.openingToClosingBracket=R,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return i}const s2=/\bvoid\s+main\s*\(\s*\)\s*{/g;function ew(i){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function n(r,s){let a=On[s];return a?ew(a):r}return i.replace(e,n)}const Ts=[];for(let i=0;i<256;i++)Ts[i]=(i<16?"0":"")+i.toString(16);function IK(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Ts[i&255]+Ts[i>>8&255]+Ts[i>>16&255]+Ts[i>>24&255]+"-"+Ts[e&255]+Ts[e>>8&255]+"-"+Ts[e>>16&15|64]+Ts[e>>24&255]+"-"+Ts[n&63|128]+Ts[n>>8&255]+"-"+Ts[n>>16&255]+Ts[n>>24&255]+Ts[r&255]+Ts[r>>8&255]+Ts[r>>16&255]+Ts[r>>24&255]).toUpperCase()}const Lf=Object.assign||function(){let i=arguments[0];for(let e=1,n=arguments.length;e<n;e++){let r=arguments[e];if(r)for(let s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])}return i},OK=Date.now(),Nk=new WeakMap,kk=new Map;let LK=1e10;function tw(i,e){const n=DK(e);let r=Nk.get(i);if(r||Nk.set(i,r=Object.create(null)),r[n])return new r[n];const s=`_onBeforeCompile${n}`,a=function(h,f){i.onBeforeCompile.call(this,h,f);const p=this.customProgramCacheKey()+"|"+h.vertexShader+"|"+h.fragmentShader;let m=kk[p];if(!m){const T=NK(this,h,e,n);m=kk[p]=T}h.vertexShader=m.vertexShader,h.fragmentShader=m.fragmentShader,Lf(h.uniforms,this.uniforms),e.timeUniform&&(h.uniforms[e.timeUniform]={get value(){return Date.now()-OK}}),this[s]&&this[s](h)},l=function(){return u(e.chained?i:i.clone())},u=function(h){const f=Object.create(h,d);return Object.defineProperty(f,"baseMaterial",{value:i}),Object.defineProperty(f,"id",{value:LK++}),f.uuid=IK(),f.uniforms=Lf({},h.uniforms,e.uniforms),f.defines=Lf({},h.defines,e.defines),f.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",f.extensions=Lf({},h.extensions,e.extensions),f._listeners=void 0,f},d={constructor:{value:l},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return i.customProgramCacheKey()+"|"+n}},onBeforeCompile:{get(){return a},set(h){this[s]=h}},copy:{writable:!0,configurable:!0,value:function(h){return i.copy.call(this,h),!i.isShaderMaterial&&!i.isDerivedMaterial&&(Lf(this.extensions,h.extensions),Lf(this.defines,h.defines),Lf(this.uniforms,rE.clone(h.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const h=new i.constructor;return u(h).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let h=this._depthMaterial;return h||(h=this._depthMaterial=tw(i.isDerivedMaterial?i.getDepthMaterial():new O$({depthPacking:mM}),e),h.defines.IS_DEPTH_MATERIAL="",h.uniforms=this.uniforms),h}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let h=this._distanceMaterial;return h||(h=this._distanceMaterial=tw(i.isDerivedMaterial?i.getDistanceMaterial():new L$,e),h.defines.IS_DISTANCE_MATERIAL="",h.uniforms=this.uniforms),h}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:h,_distanceMaterial:f}=this;h&&h.dispose(),f&&f.dispose(),i.dispose.call(this)}}};return r[n]=l,new l}function NK(i,{vertexShader:e,fragmentShader:n},r,s){let{vertexDefs:a,vertexMainIntro:l,vertexMainOutro:u,vertexTransform:d,fragmentDefs:h,fragmentMainIntro:f,fragmentMainOutro:p,fragmentColorTransform:m,customRewriter:T,timeUniform:E}=r;if(a=a||"",l=l||"",u=u||"",h=h||"",f=f||"",p=p||"",(d||T)&&(e=ew(e)),(m||T)&&(n=n.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),n=ew(n)),T){let b=T({vertexShader:e,fragmentShader:n});e=b.vertexShader,n=b.fragmentShader}if(m){let b=[];n=n.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,y=>(b.push(y),"")),p=`${m}
${b.join(`
`)}
${p}`}if(E){const b=`
uniform float ${E};
`;a=b+a,h=b+h}return d&&(e=`vec3 troika_position_${s};
vec3 troika_normal_${s};
vec2 troika_uv_${s};
${e}
`,a=`${a}
void troikaVertexTransform${s}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${d}
}
`,l=`
troika_position_${s} = vec3(position);
troika_normal_${s} = vec3(normal);
troika_uv_${s} = vec2(uv);
troikaVertexTransform${s}(troika_position_${s}, troika_normal_${s}, troika_uv_${s});
${l}
`,e=e.replace(/\b(position|normal|uv)\b/g,(b,y,S,A)=>/\battribute\s+vec[23]\s+$/.test(A.substr(0,S))?y:`troika_${y}_${s}`),i.map&&i.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${s}`))),e=Pk(e,s,a,l,u),n=Pk(n,s,h,f,p),{vertexShader:e,fragmentShader:n}}function Pk(i,e,n,r,s){return(r||s||n)&&(i=i.replace(s2,`
${n}
void troikaOrigMain${e}() {`),i+=`
void main() {
  ${r}
  troikaOrigMain${e}();
  ${s}
}`),i}function kK(i,e){return i==="uniforms"?void 0:typeof e=="function"?e.toString():e}let PK=0;const Dk=new Map;function DK(i){const e=JSON.stringify(i,kK);let n=Dk.get(e);return n==null&&Dk.set(e,n=++PK),n}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function BK(){return typeof window>"u"&&(self.window=self),function(i){var e={parse:function(s){var a=e._bin,l=new Uint8Array(s);if(a.readASCII(l,0,4)=="ttcf"){var u=4;a.readUshort(l,u),u+=2,a.readUshort(l,u),u+=2;var d=a.readUint(l,u);u+=4;for(var h=[],f=0;f<d;f++){var p=a.readUint(l,u);u+=4,h.push(e._readFont(l,p))}return h}return[e._readFont(l,0)]},_readFont:function(s,a){var l=e._bin,u=a;l.readFixed(s,a),a+=4;var d=l.readUshort(s,a);a+=2,l.readUshort(s,a),a+=2,l.readUshort(s,a),a+=2,l.readUshort(s,a),a+=2;for(var h=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],f={_data:s,_offset:u},p={},m=0;m<d;m++){var T=l.readASCII(s,a,4);a+=4,l.readUint(s,a),a+=4;var E=l.readUint(s,a);a+=4;var b=l.readUint(s,a);a+=4,p[T]={offset:E,length:b}}for(m=0;m<h.length;m++){var y=h[m];p[y]&&(f[y.trim()]=e[y.trim()].parse(s,p[y].offset,p[y].length,f))}return f},_tabOffset:function(s,a,l){for(var u=e._bin,d=u.readUshort(s,l+4),h=l+12,f=0;f<d;f++){var p=u.readASCII(s,h,4);h+=4,u.readUint(s,h),h+=4;var m=u.readUint(s,h);if(h+=4,u.readUint(s,h),h+=4,p==a)return m}return 0}};e._bin={readFixed:function(s,a){return(s[a]<<8|s[a+1])+(s[a+2]<<8|s[a+3])/65540},readF2dot14:function(s,a){return e._bin.readShort(s,a)/16384},readInt:function(s,a){return e._bin._view(s).getInt32(a)},readInt8:function(s,a){return e._bin._view(s).getInt8(a)},readShort:function(s,a){return e._bin._view(s).getInt16(a)},readUshort:function(s,a){return e._bin._view(s).getUint16(a)},readUshorts:function(s,a,l){for(var u=[],d=0;d<l;d++)u.push(e._bin.readUshort(s,a+2*d));return u},readUint:function(s,a){return e._bin._view(s).getUint32(a)},readUint64:function(s,a){return 4294967296*e._bin.readUint(s,a)+e._bin.readUint(s,a+4)},readASCII:function(s,a,l){for(var u="",d=0;d<l;d++)u+=String.fromCharCode(s[a+d]);return u},readUnicode:function(s,a,l){for(var u="",d=0;d<l;d++){var h=s[a++]<<8|s[a++];u+=String.fromCharCode(h)}return u},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(s,a,l){var u=e._bin._tdec;return u&&a==0&&l==s.length?u.decode(s):e._bin.readASCII(s,a,l)},readBytes:function(s,a,l){for(var u=[],d=0;d<l;d++)u.push(s[a+d]);return u},readASCIIArray:function(s,a,l){for(var u=[],d=0;d<l;d++)u.push(String.fromCharCode(s[a+d]));return u},_view:function(s){return s._dataView||(s._dataView=s.buffer?new DataView(s.buffer,s.byteOffset,s.byteLength):new DataView(new Uint8Array(s).buffer))}},e._lctf={},e._lctf.parse=function(s,a,l,u,d){var h=e._bin,f={},p=a;h.readFixed(s,a),a+=4;var m=h.readUshort(s,a);a+=2;var T=h.readUshort(s,a);a+=2;var E=h.readUshort(s,a);return a+=2,f.scriptList=e._lctf.readScriptList(s,p+m),f.featureList=e._lctf.readFeatureList(s,p+T),f.lookupList=e._lctf.readLookupList(s,p+E,d),f},e._lctf.readLookupList=function(s,a,l){var u=e._bin,d=a,h=[],f=u.readUshort(s,a);a+=2;for(var p=0;p<f;p++){var m=u.readUshort(s,a);a+=2;var T=e._lctf.readLookupTable(s,d+m,l);h.push(T)}return h},e._lctf.readLookupTable=function(s,a,l){var u=e._bin,d=a,h={tabs:[]};h.ltype=u.readUshort(s,a),a+=2,h.flag=u.readUshort(s,a),a+=2;var f=u.readUshort(s,a);a+=2;for(var p=h.ltype,m=0;m<f;m++){var T=u.readUshort(s,a);a+=2;var E=l(s,p,d+T,h);h.tabs.push(E)}return h},e._lctf.numOfOnes=function(s){for(var a=0,l=0;l<32;l++)s>>>l&1&&a++;return a},e._lctf.readClassDef=function(s,a){var l=e._bin,u=[],d=l.readUshort(s,a);if(a+=2,d==1){var h=l.readUshort(s,a);a+=2;var f=l.readUshort(s,a);a+=2;for(var p=0;p<f;p++)u.push(h+p),u.push(h+p),u.push(l.readUshort(s,a)),a+=2}if(d==2){var m=l.readUshort(s,a);for(a+=2,p=0;p<m;p++)u.push(l.readUshort(s,a)),a+=2,u.push(l.readUshort(s,a)),a+=2,u.push(l.readUshort(s,a)),a+=2}return u},e._lctf.getInterval=function(s,a){for(var l=0;l<s.length;l+=3){var u=s[l],d=s[l+1];if(s[l+2],u<=a&&a<=d)return l}return-1},e._lctf.readCoverage=function(s,a){var l=e._bin,u={};u.fmt=l.readUshort(s,a),a+=2;var d=l.readUshort(s,a);return a+=2,u.fmt==1&&(u.tab=l.readUshorts(s,a,d)),u.fmt==2&&(u.tab=l.readUshorts(s,a,3*d)),u},e._lctf.coverageIndex=function(s,a){var l=s.tab;if(s.fmt==1)return l.indexOf(a);if(s.fmt==2){var u=e._lctf.getInterval(l,a);if(u!=-1)return l[u+2]+(a-l[u])}return-1},e._lctf.readFeatureList=function(s,a){var l=e._bin,u=a,d=[],h=l.readUshort(s,a);a+=2;for(var f=0;f<h;f++){var p=l.readASCII(s,a,4);a+=4;var m=l.readUshort(s,a);a+=2;var T=e._lctf.readFeatureTable(s,u+m);T.tag=p.trim(),d.push(T)}return d},e._lctf.readFeatureTable=function(s,a){var l=e._bin,u=a,d={},h=l.readUshort(s,a);a+=2,h>0&&(d.featureParams=u+h);var f=l.readUshort(s,a);a+=2,d.tab=[];for(var p=0;p<f;p++)d.tab.push(l.readUshort(s,a+2*p));return d},e._lctf.readScriptList=function(s,a){var l=e._bin,u=a,d={},h=l.readUshort(s,a);a+=2;for(var f=0;f<h;f++){var p=l.readASCII(s,a,4);a+=4;var m=l.readUshort(s,a);a+=2,d[p.trim()]=e._lctf.readScriptTable(s,u+m)}return d},e._lctf.readScriptTable=function(s,a){var l=e._bin,u=a,d={},h=l.readUshort(s,a);a+=2,h>0&&(d.default=e._lctf.readLangSysTable(s,u+h));var f=l.readUshort(s,a);a+=2;for(var p=0;p<f;p++){var m=l.readASCII(s,a,4);a+=4;var T=l.readUshort(s,a);a+=2,d[m.trim()]=e._lctf.readLangSysTable(s,u+T)}return d},e._lctf.readLangSysTable=function(s,a){var l=e._bin,u={};l.readUshort(s,a),a+=2,u.reqFeature=l.readUshort(s,a),a+=2;var d=l.readUshort(s,a);return a+=2,u.features=l.readUshorts(s,a,d),u},e.CFF={},e.CFF.parse=function(s,a,l){var u=e._bin;(s=new Uint8Array(s.buffer,a,l))[a=0],s[++a],s[++a],s[++a],a++;var d=[];a=e.CFF.readIndex(s,a,d);for(var h=[],f=0;f<d.length-1;f++)h.push(u.readASCII(s,a+d[f],d[f+1]-d[f]));a+=d[d.length-1];var p=[];a=e.CFF.readIndex(s,a,p);var m=[];for(f=0;f<p.length-1;f++)m.push(e.CFF.readDict(s,a+p[f],a+p[f+1]));a+=p[p.length-1];var T=m[0],E=[];a=e.CFF.readIndex(s,a,E);var b=[];for(f=0;f<E.length-1;f++)b.push(u.readASCII(s,a+E[f],E[f+1]-E[f]));if(a+=E[E.length-1],e.CFF.readSubrs(s,a,T),T.CharStrings){a=T.CharStrings,E=[],a=e.CFF.readIndex(s,a,E);var y=[];for(f=0;f<E.length-1;f++)y.push(u.readBytes(s,a+E[f],E[f+1]-E[f]));T.CharStrings=y}if(T.ROS){a=T.FDArray;var S=[];for(a=e.CFF.readIndex(s,a,S),T.FDArray=[],f=0;f<S.length-1;f++){var A=e.CFF.readDict(s,a+S[f],a+S[f+1]);e.CFF._readFDict(s,A,b),T.FDArray.push(A)}a+=S[S.length-1],a=T.FDSelect,T.FDSelect=[];var C=s[a];if(a++,C!=3)throw C;var R=u.readUshort(s,a);for(a+=2,f=0;f<R+1;f++)T.FDSelect.push(u.readUshort(s,a),s[a+2]),a+=3}return T.Encoding&&(T.Encoding=e.CFF.readEncoding(s,T.Encoding,T.CharStrings.length)),T.charset&&(T.charset=e.CFF.readCharset(s,T.charset,T.CharStrings.length)),e.CFF._readFDict(s,T,b),T},e.CFF._readFDict=function(s,a,l){var u;for(var d in a.Private&&(u=a.Private[1],a.Private=e.CFF.readDict(s,u,u+a.Private[0]),a.Private.Subrs&&e.CFF.readSubrs(s,u+a.Private.Subrs,a.Private)),a)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(d)!=-1&&(a[d]=l[a[d]-426+35])},e.CFF.readSubrs=function(s,a,l){var u=e._bin,d=[];a=e.CFF.readIndex(s,a,d);var h,f=d.length;h=f<1240?107:f<33900?1131:32768,l.Bias=h,l.Subrs=[];for(var p=0;p<d.length-1;p++)l.Subrs.push(u.readBytes(s,a+d[p],d[p+1]-d[p]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(s,a){for(var l=0;l<s.charset.length;l++)if(s.charset[l]==a)return l;return-1},e.CFF.glyphBySE=function(s,a){return a<0||a>255?-1:e.CFF.glyphByUnicode(s,e.CFF.tableSE[a])},e.CFF.readEncoding=function(s,a,l){e._bin;var u=[".notdef"],d=s[a];if(a++,d!=0)throw"error: unknown encoding format: "+d;var h=s[a];a++;for(var f=0;f<h;f++)u.push(s[a+f]);return u},e.CFF.readCharset=function(s,a,l){var u=e._bin,d=[".notdef"],h=s[a];if(a++,h==0)for(var f=0;f<l;f++){var p=u.readUshort(s,a);a+=2,d.push(p)}else{if(h!=1&&h!=2)throw"error: format: "+h;for(;d.length<l;){p=u.readUshort(s,a),a+=2;var m=0;for(h==1?(m=s[a],a++):(m=u.readUshort(s,a),a+=2),f=0;f<=m;f++)d.push(p),p++}}return d},e.CFF.readIndex=function(s,a,l){var u=e._bin,d=u.readUshort(s,a)+1,h=s[a+=2];if(a++,h==1)for(var f=0;f<d;f++)l.push(s[a+f]);else if(h==2)for(f=0;f<d;f++)l.push(u.readUshort(s,a+2*f));else if(h==3)for(f=0;f<d;f++)l.push(16777215&u.readUint(s,a+3*f-1));else if(d!=1)throw"unsupported offset size: "+h+", count: "+d;return(a+=d*h)-1},e.CFF.getCharString=function(s,a,l){var u=e._bin,d=s[a],h=s[a+1];s[a+2],s[a+3],s[a+4];var f=1,p=null,m=null;d<=20&&(p=d,f=1),d==12&&(p=100*d+h,f=2),21<=d&&d<=27&&(p=d,f=1),d==28&&(m=u.readShort(s,a+1),f=3),29<=d&&d<=31&&(p=d,f=1),32<=d&&d<=246&&(m=d-139,f=1),247<=d&&d<=250&&(m=256*(d-247)+h+108,f=2),251<=d&&d<=254&&(m=256*-(d-251)-h-108,f=2),d==255&&(m=u.readInt(s,a+1)/65535,f=5),l.val=m??"o"+p,l.size=f},e.CFF.readCharString=function(s,a,l){for(var u=a+l,d=e._bin,h=[];a<u;){var f=s[a],p=s[a+1];s[a+2],s[a+3],s[a+4];var m=1,T=null,E=null;f<=20&&(T=f,m=1),f==12&&(T=100*f+p,m=2),f!=19&&f!=20||(T=f,m=2),21<=f&&f<=27&&(T=f,m=1),f==28&&(E=d.readShort(s,a+1),m=3),29<=f&&f<=31&&(T=f,m=1),32<=f&&f<=246&&(E=f-139,m=1),247<=f&&f<=250&&(E=256*(f-247)+p+108,m=2),251<=f&&f<=254&&(E=256*-(f-251)-p-108,m=2),f==255&&(E=d.readInt(s,a+1)/65535,m=5),h.push(E??"o"+T),a+=m}return h},e.CFF.readDict=function(s,a,l){for(var u=e._bin,d={},h=[];a<l;){var f=s[a],p=s[a+1];s[a+2],s[a+3],s[a+4];var m=1,T=null,E=null;if(f==28&&(E=u.readShort(s,a+1),m=3),f==29&&(E=u.readInt(s,a+1),m=5),32<=f&&f<=246&&(E=f-139,m=1),247<=f&&f<=250&&(E=256*(f-247)+p+108,m=2),251<=f&&f<=254&&(E=256*-(f-251)-p-108,m=2),f==255)throw E=u.readInt(s,a+1)/65535,m=5,"unknown number";if(f==30){var b=[];for(m=1;;){var y=s[a+m];m++;var S=y>>4,A=15&y;if(S!=15&&b.push(S),A!=15&&b.push(A),A==15)break}for(var C="",R=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],I=0;I<b.length;I++)C+=R[b[I]];E=parseFloat(C)}f<=21&&(T=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][f],m=1,f==12&&(T=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][p],m=2)),T!=null?(d[T]=h.length==1?h[0]:h,h=[]):h.push(E),a+=m}return d},e.cmap={},e.cmap.parse=function(s,a,l){s=new Uint8Array(s.buffer,a,l),a=0;var u=e._bin,d={};u.readUshort(s,a),a+=2;var h=u.readUshort(s,a);a+=2;var f=[];d.tables=[];for(var p=0;p<h;p++){var m=u.readUshort(s,a);a+=2;var T=u.readUshort(s,a);a+=2;var E=u.readUint(s,a);a+=4;var b="p"+m+"e"+T,y=f.indexOf(E);if(y==-1){var S;y=d.tables.length,f.push(E);var A=u.readUshort(s,E);A==0?S=e.cmap.parse0(s,E):A==4?S=e.cmap.parse4(s,E):A==6?S=e.cmap.parse6(s,E):A==12?S=e.cmap.parse12(s,E):console.debug("unknown format: "+A,m,T,E),d.tables.push(S)}if(d[b]!=null)throw"multiple tables for one platform+encoding";d[b]=y}return d},e.cmap.parse0=function(s,a){var l=e._bin,u={};u.format=l.readUshort(s,a),a+=2;var d=l.readUshort(s,a);a+=2,l.readUshort(s,a),a+=2,u.map=[];for(var h=0;h<d-6;h++)u.map.push(s[a+h]);return u},e.cmap.parse4=function(s,a){var l=e._bin,u=a,d={};d.format=l.readUshort(s,a),a+=2;var h=l.readUshort(s,a);a+=2,l.readUshort(s,a),a+=2;var f=l.readUshort(s,a);a+=2;var p=f/2;d.searchRange=l.readUshort(s,a),a+=2,d.entrySelector=l.readUshort(s,a),a+=2,d.rangeShift=l.readUshort(s,a),a+=2,d.endCount=l.readUshorts(s,a,p),a+=2*p,a+=2,d.startCount=l.readUshorts(s,a,p),a+=2*p,d.idDelta=[];for(var m=0;m<p;m++)d.idDelta.push(l.readShort(s,a)),a+=2;for(d.idRangeOffset=l.readUshorts(s,a,p),a+=2*p,d.glyphIdArray=[];a<u+h;)d.glyphIdArray.push(l.readUshort(s,a)),a+=2;return d},e.cmap.parse6=function(s,a){var l=e._bin,u={};u.format=l.readUshort(s,a),a+=2,l.readUshort(s,a),a+=2,l.readUshort(s,a),a+=2,u.firstCode=l.readUshort(s,a),a+=2;var d=l.readUshort(s,a);a+=2,u.glyphIdArray=[];for(var h=0;h<d;h++)u.glyphIdArray.push(l.readUshort(s,a)),a+=2;return u},e.cmap.parse12=function(s,a){var l=e._bin,u={};u.format=l.readUshort(s,a),a+=2,a+=2,l.readUint(s,a),a+=4,l.readUint(s,a),a+=4;var d=l.readUint(s,a);a+=4,u.groups=[];for(var h=0;h<d;h++){var f=a+12*h,p=l.readUint(s,f+0),m=l.readUint(s,f+4),T=l.readUint(s,f+8);u.groups.push([p,m,T])}return u},e.glyf={},e.glyf.parse=function(s,a,l,u){for(var d=[],h=0;h<u.maxp.numGlyphs;h++)d.push(null);return d},e.glyf._parseGlyf=function(s,a){var l=e._bin,u=s._data,d=e._tabOffset(u,"glyf",s._offset)+s.loca[a];if(s.loca[a]==s.loca[a+1])return null;var h={};if(h.noc=l.readShort(u,d),d+=2,h.xMin=l.readShort(u,d),d+=2,h.yMin=l.readShort(u,d),d+=2,h.xMax=l.readShort(u,d),d+=2,h.yMax=l.readShort(u,d),d+=2,h.xMin>=h.xMax||h.yMin>=h.yMax)return null;if(h.noc>0){h.endPts=[];for(var f=0;f<h.noc;f++)h.endPts.push(l.readUshort(u,d)),d+=2;var p=l.readUshort(u,d);if(d+=2,u.length-d<p)return null;h.instructions=l.readBytes(u,d,p),d+=p;var m=h.endPts[h.noc-1]+1;for(h.flags=[],f=0;f<m;f++){var T=u[d];if(d++,h.flags.push(T),(8&T)!=0){var E=u[d];d++;for(var b=0;b<E;b++)h.flags.push(T),f++}}for(h.xs=[],f=0;f<m;f++){var y=(2&h.flags[f])!=0,S=(16&h.flags[f])!=0;y?(h.xs.push(S?u[d]:-u[d]),d++):S?h.xs.push(0):(h.xs.push(l.readShort(u,d)),d+=2)}for(h.ys=[],f=0;f<m;f++)y=(4&h.flags[f])!=0,S=(32&h.flags[f])!=0,y?(h.ys.push(S?u[d]:-u[d]),d++):S?h.ys.push(0):(h.ys.push(l.readShort(u,d)),d+=2);var A=0,C=0;for(f=0;f<m;f++)A+=h.xs[f],C+=h.ys[f],h.xs[f]=A,h.ys[f]=C}else{var R;h.parts=[];do{R=l.readUshort(u,d),d+=2;var I={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(h.parts.push(I),I.glyphIndex=l.readUshort(u,d),d+=2,1&R){var O=l.readShort(u,d);d+=2;var F=l.readShort(u,d);d+=2}else O=l.readInt8(u,d),d++,F=l.readInt8(u,d),d++;2&R?(I.m.tx=O,I.m.ty=F):(I.p1=O,I.p2=F),8&R?(I.m.a=I.m.d=l.readF2dot14(u,d),d+=2):64&R?(I.m.a=l.readF2dot14(u,d),d+=2,I.m.d=l.readF2dot14(u,d),d+=2):128&R&&(I.m.a=l.readF2dot14(u,d),d+=2,I.m.b=l.readF2dot14(u,d),d+=2,I.m.c=l.readF2dot14(u,d),d+=2,I.m.d=l.readF2dot14(u,d),d+=2)}while(32&R);if(256&R){var k=l.readUshort(u,d);for(d+=2,h.instr=[],f=0;f<k;f++)h.instr.push(u[d]),d++}}return h},e.GDEF={},e.GDEF.parse=function(s,a,l,u){var d=a;a+=4;var h=e._bin.readUshort(s,a);return{glyphClassDef:h===0?null:e._lctf.readClassDef(s,d+h)}},e.GPOS={},e.GPOS.parse=function(s,a,l,u){return e._lctf.parse(s,a,l,u,e.GPOS.subt)},e.GPOS.subt=function(s,a,l,u){var d=e._bin,h=l,f={};if(f.fmt=d.readUshort(s,l),l+=2,a==1||a==2||a==3||a==7||a==8&&f.fmt<=2){var p=d.readUshort(s,l);l+=2,f.coverage=e._lctf.readCoverage(s,p+h)}if(a==1&&f.fmt==1){var m=d.readUshort(s,l);l+=2,m!=0&&(f.pos=e.GPOS.readValueRecord(s,l,m))}else if(a==2&&f.fmt>=1&&f.fmt<=2){m=d.readUshort(s,l),l+=2;var T=d.readUshort(s,l);l+=2;var E=e._lctf.numOfOnes(m),b=e._lctf.numOfOnes(T);if(f.fmt==1){f.pairsets=[];var y=d.readUshort(s,l);l+=2;for(var S=0;S<y;S++){var A=h+d.readUshort(s,l);l+=2;var C=d.readUshort(s,A);A+=2;for(var R=[],I=0;I<C;I++){var O=d.readUshort(s,A);A+=2,m!=0&&(ie=e.GPOS.readValueRecord(s,A,m),A+=2*E),T!=0&&(ae=e.GPOS.readValueRecord(s,A,T),A+=2*b),R.push({gid2:O,val1:ie,val2:ae})}f.pairsets.push(R)}}if(f.fmt==2){var F=d.readUshort(s,l);l+=2;var k=d.readUshort(s,l);l+=2;var D=d.readUshort(s,l);l+=2;var U=d.readUshort(s,l);for(l+=2,f.classDef1=e._lctf.readClassDef(s,h+F),f.classDef2=e._lctf.readClassDef(s,h+k),f.matrix=[],S=0;S<D;S++){var ce=[];for(I=0;I<U;I++){var ie=null,ae=null;m!=0&&(ie=e.GPOS.readValueRecord(s,l,m),l+=2*E),T!=0&&(ae=e.GPOS.readValueRecord(s,l,T),l+=2*b),ce.push({val1:ie,val2:ae})}f.matrix.push(ce)}}}else if(a==4&&f.fmt==1)f.markCoverage=e._lctf.readCoverage(s,d.readUshort(s,l)+h),f.baseCoverage=e._lctf.readCoverage(s,d.readUshort(s,l+2)+h),f.markClassCount=d.readUshort(s,l+4),f.markArray=e.GPOS.readMarkArray(s,d.readUshort(s,l+6)+h),f.baseArray=e.GPOS.readBaseArray(s,d.readUshort(s,l+8)+h,f.markClassCount);else if(a==6&&f.fmt==1)f.mark1Coverage=e._lctf.readCoverage(s,d.readUshort(s,l)+h),f.mark2Coverage=e._lctf.readCoverage(s,d.readUshort(s,l+2)+h),f.markClassCount=d.readUshort(s,l+4),f.mark1Array=e.GPOS.readMarkArray(s,d.readUshort(s,l+6)+h),f.mark2Array=e.GPOS.readBaseArray(s,d.readUshort(s,l+8)+h,f.markClassCount);else{if(a==9&&f.fmt==1){var ne=d.readUshort(s,l);l+=2;var pe=d.readUint(s,l);if(l+=4,u.ltype==9)u.ltype=ne;else if(u.ltype!=ne)throw"invalid extension substitution";return e.GPOS.subt(s,u.ltype,h+pe)}console.debug("unsupported GPOS table LookupType",a,"format",f.fmt)}return f},e.GPOS.readValueRecord=function(s,a,l){var u=e._bin,d=[];return d.push(1&l?u.readShort(s,a):0),a+=1&l?2:0,d.push(2&l?u.readShort(s,a):0),a+=2&l?2:0,d.push(4&l?u.readShort(s,a):0),a+=4&l?2:0,d.push(8&l?u.readShort(s,a):0),a+=8&l?2:0,d},e.GPOS.readBaseArray=function(s,a,l){var u=e._bin,d=[],h=a,f=u.readUshort(s,a);a+=2;for(var p=0;p<f;p++){for(var m=[],T=0;T<l;T++)m.push(e.GPOS.readAnchorRecord(s,h+u.readUshort(s,a))),a+=2;d.push(m)}return d},e.GPOS.readMarkArray=function(s,a){var l=e._bin,u=[],d=a,h=l.readUshort(s,a);a+=2;for(var f=0;f<h;f++){var p=e.GPOS.readAnchorRecord(s,l.readUshort(s,a+2)+d);p.markClass=l.readUshort(s,a),u.push(p),a+=4}return u},e.GPOS.readAnchorRecord=function(s,a){var l=e._bin,u={};return u.fmt=l.readUshort(s,a),u.x=l.readShort(s,a+2),u.y=l.readShort(s,a+4),u},e.GSUB={},e.GSUB.parse=function(s,a,l,u){return e._lctf.parse(s,a,l,u,e.GSUB.subt)},e.GSUB.subt=function(s,a,l,u){var d=e._bin,h=l,f={};if(f.fmt=d.readUshort(s,l),l+=2,a!=1&&a!=2&&a!=4&&a!=5&&a!=6)return null;if(a==1||a==2||a==4||a==5&&f.fmt<=2||a==6&&f.fmt<=2){var p=d.readUshort(s,l);l+=2,f.coverage=e._lctf.readCoverage(s,h+p)}if(a==1&&f.fmt>=1&&f.fmt<=2){if(f.fmt==1)f.delta=d.readShort(s,l),l+=2;else if(f.fmt==2){var m=d.readUshort(s,l);l+=2,f.newg=d.readUshorts(s,l,m),l+=2*f.newg.length}}else if(a==2&&f.fmt==1){m=d.readUshort(s,l),l+=2,f.seqs=[];for(var T=0;T<m;T++){var E=d.readUshort(s,l)+h;l+=2;var b=d.readUshort(s,E);f.seqs.push(d.readUshorts(s,E+2,b))}}else if(a==4)for(f.vals=[],m=d.readUshort(s,l),l+=2,T=0;T<m;T++){var y=d.readUshort(s,l);l+=2,f.vals.push(e.GSUB.readLigatureSet(s,h+y))}else if(a==5&&f.fmt==2){if(f.fmt==2){var S=d.readUshort(s,l);l+=2,f.cDef=e._lctf.readClassDef(s,h+S),f.scset=[];var A=d.readUshort(s,l);for(l+=2,T=0;T<A;T++){var C=d.readUshort(s,l);l+=2,f.scset.push(C==0?null:e.GSUB.readSubClassSet(s,h+C))}}}else if(a==6&&f.fmt==3){if(f.fmt==3){for(T=0;T<3;T++){m=d.readUshort(s,l),l+=2;for(var R=[],I=0;I<m;I++)R.push(e._lctf.readCoverage(s,h+d.readUshort(s,l+2*I)));l+=2*m,T==0&&(f.backCvg=R),T==1&&(f.inptCvg=R),T==2&&(f.ahedCvg=R)}m=d.readUshort(s,l),l+=2,f.lookupRec=e.GSUB.readSubstLookupRecords(s,l,m)}}else{if(a==7&&f.fmt==1){var O=d.readUshort(s,l);l+=2;var F=d.readUint(s,l);if(l+=4,u.ltype==9)u.ltype=O;else if(u.ltype!=O)throw"invalid extension substitution";return e.GSUB.subt(s,u.ltype,h+F)}console.debug("unsupported GSUB table LookupType",a,"format",f.fmt)}return f},e.GSUB.readSubClassSet=function(s,a){var l=e._bin.readUshort,u=a,d=[],h=l(s,a);a+=2;for(var f=0;f<h;f++){var p=l(s,a);a+=2,d.push(e.GSUB.readSubClassRule(s,u+p))}return d},e.GSUB.readSubClassRule=function(s,a){var l=e._bin.readUshort,u={},d=l(s,a),h=l(s,a+=2);a+=2,u.input=[];for(var f=0;f<d-1;f++)u.input.push(l(s,a)),a+=2;return u.substLookupRecords=e.GSUB.readSubstLookupRecords(s,a,h),u},e.GSUB.readSubstLookupRecords=function(s,a,l){for(var u=e._bin.readUshort,d=[],h=0;h<l;h++)d.push(u(s,a),u(s,a+2)),a+=4;return d},e.GSUB.readChainSubClassSet=function(s,a){var l=e._bin,u=a,d=[],h=l.readUshort(s,a);a+=2;for(var f=0;f<h;f++){var p=l.readUshort(s,a);a+=2,d.push(e.GSUB.readChainSubClassRule(s,u+p))}return d},e.GSUB.readChainSubClassRule=function(s,a){for(var l=e._bin,u={},d=["backtrack","input","lookahead"],h=0;h<d.length;h++){var f=l.readUshort(s,a);a+=2,h==1&&f--,u[d[h]]=l.readUshorts(s,a,f),a+=2*u[d[h]].length}return f=l.readUshort(s,a),a+=2,u.subst=l.readUshorts(s,a,2*f),a+=2*u.subst.length,u},e.GSUB.readLigatureSet=function(s,a){var l=e._bin,u=a,d=[],h=l.readUshort(s,a);a+=2;for(var f=0;f<h;f++){var p=l.readUshort(s,a);a+=2,d.push(e.GSUB.readLigature(s,u+p))}return d},e.GSUB.readLigature=function(s,a){var l=e._bin,u={chain:[]};u.nglyph=l.readUshort(s,a),a+=2;var d=l.readUshort(s,a);a+=2;for(var h=0;h<d-1;h++)u.chain.push(l.readUshort(s,a)),a+=2;return u},e.head={},e.head.parse=function(s,a,l){var u=e._bin,d={};return u.readFixed(s,a),a+=4,d.fontRevision=u.readFixed(s,a),a+=4,u.readUint(s,a),a+=4,u.readUint(s,a),a+=4,d.flags=u.readUshort(s,a),a+=2,d.unitsPerEm=u.readUshort(s,a),a+=2,d.created=u.readUint64(s,a),a+=8,d.modified=u.readUint64(s,a),a+=8,d.xMin=u.readShort(s,a),a+=2,d.yMin=u.readShort(s,a),a+=2,d.xMax=u.readShort(s,a),a+=2,d.yMax=u.readShort(s,a),a+=2,d.macStyle=u.readUshort(s,a),a+=2,d.lowestRecPPEM=u.readUshort(s,a),a+=2,d.fontDirectionHint=u.readShort(s,a),a+=2,d.indexToLocFormat=u.readShort(s,a),a+=2,d.glyphDataFormat=u.readShort(s,a),a+=2,d},e.hhea={},e.hhea.parse=function(s,a,l){var u=e._bin,d={};return u.readFixed(s,a),a+=4,d.ascender=u.readShort(s,a),a+=2,d.descender=u.readShort(s,a),a+=2,d.lineGap=u.readShort(s,a),a+=2,d.advanceWidthMax=u.readUshort(s,a),a+=2,d.minLeftSideBearing=u.readShort(s,a),a+=2,d.minRightSideBearing=u.readShort(s,a),a+=2,d.xMaxExtent=u.readShort(s,a),a+=2,d.caretSlopeRise=u.readShort(s,a),a+=2,d.caretSlopeRun=u.readShort(s,a),a+=2,d.caretOffset=u.readShort(s,a),a+=2,a+=8,d.metricDataFormat=u.readShort(s,a),a+=2,d.numberOfHMetrics=u.readUshort(s,a),a+=2,d},e.hmtx={},e.hmtx.parse=function(s,a,l,u){for(var d=e._bin,h={aWidth:[],lsBearing:[]},f=0,p=0,m=0;m<u.maxp.numGlyphs;m++)m<u.hhea.numberOfHMetrics&&(f=d.readUshort(s,a),a+=2,p=d.readShort(s,a),a+=2),h.aWidth.push(f),h.lsBearing.push(p);return h},e.kern={},e.kern.parse=function(s,a,l,u){var d=e._bin,h=d.readUshort(s,a);if(a+=2,h==1)return e.kern.parseV1(s,a-2,l,u);var f=d.readUshort(s,a);a+=2;for(var p={glyph1:[],rval:[]},m=0;m<f;m++){a+=2,l=d.readUshort(s,a),a+=2;var T=d.readUshort(s,a);a+=2;var E=T>>>8;if((E&=15)!=0)throw"unknown kern table format: "+E;a=e.kern.readFormat0(s,a,p)}return p},e.kern.parseV1=function(s,a,l,u){var d=e._bin;d.readFixed(s,a),a+=4;var h=d.readUint(s,a);a+=4;for(var f={glyph1:[],rval:[]},p=0;p<h;p++){d.readUint(s,a),a+=4;var m=d.readUshort(s,a);a+=2,d.readUshort(s,a),a+=2;var T=m>>>8;if((T&=15)!=0)throw"unknown kern table format: "+T;a=e.kern.readFormat0(s,a,f)}return f},e.kern.readFormat0=function(s,a,l){var u=e._bin,d=-1,h=u.readUshort(s,a);a+=2,u.readUshort(s,a),a+=2,u.readUshort(s,a),a+=2,u.readUshort(s,a),a+=2;for(var f=0;f<h;f++){var p=u.readUshort(s,a);a+=2;var m=u.readUshort(s,a);a+=2;var T=u.readShort(s,a);a+=2,p!=d&&(l.glyph1.push(p),l.rval.push({glyph2:[],vals:[]}));var E=l.rval[l.rval.length-1];E.glyph2.push(m),E.vals.push(T),d=p}return a},e.loca={},e.loca.parse=function(s,a,l,u){var d=e._bin,h=[],f=u.head.indexToLocFormat,p=u.maxp.numGlyphs+1;if(f==0)for(var m=0;m<p;m++)h.push(d.readUshort(s,a+(m<<1))<<1);if(f==1)for(m=0;m<p;m++)h.push(d.readUint(s,a+(m<<2)));return h},e.maxp={},e.maxp.parse=function(s,a,l){var u=e._bin,d={},h=u.readUint(s,a);return a+=4,d.numGlyphs=u.readUshort(s,a),a+=2,h==65536&&(d.maxPoints=u.readUshort(s,a),a+=2,d.maxContours=u.readUshort(s,a),a+=2,d.maxCompositePoints=u.readUshort(s,a),a+=2,d.maxCompositeContours=u.readUshort(s,a),a+=2,d.maxZones=u.readUshort(s,a),a+=2,d.maxTwilightPoints=u.readUshort(s,a),a+=2,d.maxStorage=u.readUshort(s,a),a+=2,d.maxFunctionDefs=u.readUshort(s,a),a+=2,d.maxInstructionDefs=u.readUshort(s,a),a+=2,d.maxStackElements=u.readUshort(s,a),a+=2,d.maxSizeOfInstructions=u.readUshort(s,a),a+=2,d.maxComponentElements=u.readUshort(s,a),a+=2,d.maxComponentDepth=u.readUshort(s,a),a+=2),d},e.name={},e.name.parse=function(s,a,l){var u=e._bin,d={};u.readUshort(s,a),a+=2;var h=u.readUshort(s,a);a+=2,u.readUshort(s,a);for(var f,p=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],m=a+=2,T=0;T<h;T++){var E=u.readUshort(s,a);a+=2;var b=u.readUshort(s,a);a+=2;var y=u.readUshort(s,a);a+=2;var S=u.readUshort(s,a);a+=2;var A=u.readUshort(s,a);a+=2;var C=u.readUshort(s,a);a+=2;var R,I=p[S],O=m+12*h+C;if(E==0)R=u.readUnicode(s,O,A/2);else if(E==3&&b==0)R=u.readUnicode(s,O,A/2);else if(b==0)R=u.readASCII(s,O,A);else if(b==1)R=u.readUnicode(s,O,A/2);else if(b==3)R=u.readUnicode(s,O,A/2);else{if(E!=1)throw"unknown encoding "+b+", platformID: "+E;R=u.readASCII(s,O,A),console.debug("reading unknown MAC encoding "+b+" as ASCII")}var F="p"+E+","+y.toString(16);d[F]==null&&(d[F]={}),d[F][I!==void 0?I:S]=R,d[F]._lang=y}for(var k in d)if(d[k].postScriptName!=null&&d[k]._lang==1033)return d[k];for(var k in d)if(d[k].postScriptName!=null&&d[k]._lang==0)return d[k];for(var k in d)if(d[k].postScriptName!=null&&d[k]._lang==3084)return d[k];for(var k in d)if(d[k].postScriptName!=null)return d[k];for(var k in d){f=k;break}return console.debug("returning name table with languageID "+d[f]._lang),d[f]},e["OS/2"]={},e["OS/2"].parse=function(s,a,l){var u=e._bin.readUshort(s,a);a+=2;var d={};if(u==0)e["OS/2"].version0(s,a,d);else if(u==1)e["OS/2"].version1(s,a,d);else if(u==2||u==3||u==4)e["OS/2"].version2(s,a,d);else{if(u!=5)throw"unknown OS/2 table version: "+u;e["OS/2"].version5(s,a,d)}return d},e["OS/2"].version0=function(s,a,l){var u=e._bin;return l.xAvgCharWidth=u.readShort(s,a),a+=2,l.usWeightClass=u.readUshort(s,a),a+=2,l.usWidthClass=u.readUshort(s,a),a+=2,l.fsType=u.readUshort(s,a),a+=2,l.ySubscriptXSize=u.readShort(s,a),a+=2,l.ySubscriptYSize=u.readShort(s,a),a+=2,l.ySubscriptXOffset=u.readShort(s,a),a+=2,l.ySubscriptYOffset=u.readShort(s,a),a+=2,l.ySuperscriptXSize=u.readShort(s,a),a+=2,l.ySuperscriptYSize=u.readShort(s,a),a+=2,l.ySuperscriptXOffset=u.readShort(s,a),a+=2,l.ySuperscriptYOffset=u.readShort(s,a),a+=2,l.yStrikeoutSize=u.readShort(s,a),a+=2,l.yStrikeoutPosition=u.readShort(s,a),a+=2,l.sFamilyClass=u.readShort(s,a),a+=2,l.panose=u.readBytes(s,a,10),a+=10,l.ulUnicodeRange1=u.readUint(s,a),a+=4,l.ulUnicodeRange2=u.readUint(s,a),a+=4,l.ulUnicodeRange3=u.readUint(s,a),a+=4,l.ulUnicodeRange4=u.readUint(s,a),a+=4,l.achVendID=[u.readInt8(s,a),u.readInt8(s,a+1),u.readInt8(s,a+2),u.readInt8(s,a+3)],a+=4,l.fsSelection=u.readUshort(s,a),a+=2,l.usFirstCharIndex=u.readUshort(s,a),a+=2,l.usLastCharIndex=u.readUshort(s,a),a+=2,l.sTypoAscender=u.readShort(s,a),a+=2,l.sTypoDescender=u.readShort(s,a),a+=2,l.sTypoLineGap=u.readShort(s,a),a+=2,l.usWinAscent=u.readUshort(s,a),a+=2,l.usWinDescent=u.readUshort(s,a),a+=2},e["OS/2"].version1=function(s,a,l){var u=e._bin;return a=e["OS/2"].version0(s,a,l),l.ulCodePageRange1=u.readUint(s,a),a+=4,l.ulCodePageRange2=u.readUint(s,a),a+=4},e["OS/2"].version2=function(s,a,l){var u=e._bin;return a=e["OS/2"].version1(s,a,l),l.sxHeight=u.readShort(s,a),a+=2,l.sCapHeight=u.readShort(s,a),a+=2,l.usDefault=u.readUshort(s,a),a+=2,l.usBreak=u.readUshort(s,a),a+=2,l.usMaxContext=u.readUshort(s,a),a+=2},e["OS/2"].version5=function(s,a,l){var u=e._bin;return a=e["OS/2"].version2(s,a,l),l.usLowerOpticalPointSize=u.readUshort(s,a),a+=2,l.usUpperOpticalPointSize=u.readUshort(s,a),a+=2},e.post={},e.post.parse=function(s,a,l){var u=e._bin,d={};return d.version=u.readFixed(s,a),a+=4,d.italicAngle=u.readFixed(s,a),a+=4,d.underlinePosition=u.readShort(s,a),a+=2,d.underlineThickness=u.readShort(s,a),a+=2,d},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(s,a){var l=s.cmap,u=-1;if(l.p0e4!=null?u=l.p0e4:l.p3e1!=null?u=l.p3e1:l.p1e0!=null?u=l.p1e0:l.p0e3!=null&&(u=l.p0e3),u==-1)throw"no familiar platform and encoding!";var d=l.tables[u];if(d.format==0)return a>=d.map.length?0:d.map[a];if(d.format==4){for(var h=-1,f=0;f<d.endCount.length;f++)if(a<=d.endCount[f]){h=f;break}return h==-1||d.startCount[h]>a?0:65535&(d.idRangeOffset[h]!=0?d.glyphIdArray[a-d.startCount[h]+(d.idRangeOffset[h]>>1)-(d.idRangeOffset.length-h)]:a+d.idDelta[h])}if(d.format==12){if(a>d.groups[d.groups.length-1][1])return 0;for(f=0;f<d.groups.length;f++){var p=d.groups[f];if(p[0]<=a&&a<=p[1])return p[2]+(a-p[0])}return 0}throw"unknown cmap table format "+d.format},e.U.glyphToPath=function(s,a){var l={cmds:[],crds:[]};if(s.SVG&&s.SVG.entries[a]){var u=s.SVG.entries[a];return u==null?l:(typeof u=="string"&&(u=e.SVG.toPath(u),s.SVG.entries[a]=u),u)}if(s.CFF){var d={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:s.CFF.Private?s.CFF.Private.defaultWidthX:0,open:!1},h=s.CFF,f=s.CFF.Private;if(h.ROS){for(var p=0;h.FDSelect[p+2]<=a;)p+=2;f=h.FDArray[h.FDSelect[p+1]].Private}e.U._drawCFF(s.CFF.CharStrings[a],d,h,f,l)}else s.glyf&&e.U._drawGlyf(a,s,l);return l},e.U._drawGlyf=function(s,a,l){var u=a.glyf[s];u==null&&(u=a.glyf[s]=e.glyf._parseGlyf(a,s)),u!=null&&(u.noc>-1?e.U._simpleGlyph(u,l):e.U._compoGlyph(u,a,l))},e.U._simpleGlyph=function(s,a){for(var l=0;l<s.noc;l++){for(var u=l==0?0:s.endPts[l-1]+1,d=s.endPts[l],h=u;h<=d;h++){var f=h==u?d:h-1,p=h==d?u:h+1,m=1&s.flags[h],T=1&s.flags[f],E=1&s.flags[p],b=s.xs[h],y=s.ys[h];if(h==u)if(m){if(!T){e.U.P.moveTo(a,b,y);continue}e.U.P.moveTo(a,s.xs[f],s.ys[f])}else T?e.U.P.moveTo(a,s.xs[f],s.ys[f]):e.U.P.moveTo(a,(s.xs[f]+b)/2,(s.ys[f]+y)/2);m?T&&e.U.P.lineTo(a,b,y):E?e.U.P.qcurveTo(a,b,y,s.xs[p],s.ys[p]):e.U.P.qcurveTo(a,b,y,(b+s.xs[p])/2,(y+s.ys[p])/2)}e.U.P.closePath(a)}},e.U._compoGlyph=function(s,a,l){for(var u=0;u<s.parts.length;u++){var d={cmds:[],crds:[]},h=s.parts[u];e.U._drawGlyf(h.glyphIndex,a,d);for(var f=h.m,p=0;p<d.crds.length;p+=2){var m=d.crds[p],T=d.crds[p+1];l.crds.push(m*f.a+T*f.b+f.tx),l.crds.push(m*f.c+T*f.d+f.ty)}for(p=0;p<d.cmds.length;p++)l.cmds.push(d.cmds[p])}},e.U._getGlyphClass=function(s,a){var l=e._lctf.getInterval(a,s);return l==-1?0:a[l+2]},e.U._applySubs=function(s,a,l,u){for(var d=s.length-a-1,h=0;h<l.tabs.length;h++)if(l.tabs[h]!=null){var f,p=l.tabs[h];if(!p.coverage||(f=e._lctf.coverageIndex(p.coverage,s[a]))!=-1){if(l.ltype==1)s[a],p.fmt==1?s[a]=s[a]+p.delta:s[a]=p.newg[f];else if(l.ltype==4)for(var m=p.vals[f],T=0;T<m.length;T++){var E=m[T],b=E.chain.length;if(!(b>d)){for(var y=!0,S=0,A=0;A<b;A++){for(;s[a+S+(1+A)]==-1;)S++;E.chain[A]!=s[a+S+(1+A)]&&(y=!1)}if(y){for(s[a]=E.nglyph,A=0;A<b+S;A++)s[a+A+1]=-1;break}}}else if(l.ltype==5&&p.fmt==2)for(var C=e._lctf.getInterval(p.cDef,s[a]),R=p.cDef[C+2],I=p.scset[R],O=0;O<I.length;O++){var F=I[O],k=F.input;if(!(k.length>d)){for(y=!0,A=0;A<k.length;A++){var D=e._lctf.getInterval(p.cDef,s[a+1+A]);if(C==-1&&p.cDef[D+2]!=k[A]){y=!1;break}}if(y){var U=F.substLookupRecords;for(T=0;T<U.length;T+=2)U[T],U[T+1]}}}else if(l.ltype==6&&p.fmt==3){if(!e.U._glsCovered(s,p.backCvg,a-p.backCvg.length)||!e.U._glsCovered(s,p.inptCvg,a)||!e.U._glsCovered(s,p.ahedCvg,a+p.inptCvg.length))continue;var ce=p.lookupRec;for(O=0;O<ce.length;O+=2){C=ce[O];var ie=u[ce[O+1]];e.U._applySubs(s,a+C,ie,u)}}}}},e.U._glsCovered=function(s,a,l){for(var u=0;u<a.length;u++)if(e._lctf.coverageIndex(a[u],s[l+u])==-1)return!1;return!0},e.U.glyphsToPath=function(s,a,l){for(var u={cmds:[],crds:[]},d=0,h=0;h<a.length;h++){var f=a[h];if(f!=-1){for(var p=h<a.length-1&&a[h+1]!=-1?a[h+1]:0,m=e.U.glyphToPath(s,f),T=0;T<m.crds.length;T+=2)u.crds.push(m.crds[T]+d),u.crds.push(m.crds[T+1]);for(l&&u.cmds.push(l),T=0;T<m.cmds.length;T++)u.cmds.push(m.cmds[T]);l&&u.cmds.push("X"),d+=s.hmtx.aWidth[f],h<a.length-1&&(d+=e.U.getPairAdjustment(s,f,p))}}return u},e.U.P={},e.U.P.moveTo=function(s,a,l){s.cmds.push("M"),s.crds.push(a,l)},e.U.P.lineTo=function(s,a,l){s.cmds.push("L"),s.crds.push(a,l)},e.U.P.curveTo=function(s,a,l,u,d,h,f){s.cmds.push("C"),s.crds.push(a,l,u,d,h,f)},e.U.P.qcurveTo=function(s,a,l,u,d){s.cmds.push("Q"),s.crds.push(a,l,u,d)},e.U.P.closePath=function(s){s.cmds.push("Z")},e.U._drawCFF=function(s,a,l,u,d){for(var h=a.stack,f=a.nStems,p=a.haveWidth,m=a.width,T=a.open,E=0,b=a.x,y=a.y,S=0,A=0,C=0,R=0,I=0,O=0,F=0,k=0,D=0,U=0,ce={val:0,size:0};E<s.length;){e.CFF.getCharString(s,E,ce);var ie=ce.val;if(E+=ce.size,ie=="o1"||ie=="o18")h.length%2!=0&&!p&&(m=h.shift()+u.nominalWidthX),f+=h.length>>1,h.length=0,p=!0;else if(ie=="o3"||ie=="o23")h.length%2!=0&&!p&&(m=h.shift()+u.nominalWidthX),f+=h.length>>1,h.length=0,p=!0;else if(ie=="o4")h.length>1&&!p&&(m=h.shift()+u.nominalWidthX,p=!0),T&&e.U.P.closePath(d),y+=h.pop(),e.U.P.moveTo(d,b,y),T=!0;else if(ie=="o5")for(;h.length>0;)b+=h.shift(),y+=h.shift(),e.U.P.lineTo(d,b,y);else if(ie=="o6"||ie=="o7")for(var ae=h.length,ne=ie=="o6",pe=0;pe<ae;pe++){var de=h.shift();ne?b+=de:y+=de,ne=!ne,e.U.P.lineTo(d,b,y)}else if(ie=="o8"||ie=="o24"){ae=h.length;for(var xe=0;xe+6<=ae;)S=b+h.shift(),A=y+h.shift(),C=S+h.shift(),R=A+h.shift(),b=C+h.shift(),y=R+h.shift(),e.U.P.curveTo(d,S,A,C,R,b,y),xe+=6;ie=="o24"&&(b+=h.shift(),y+=h.shift(),e.U.P.lineTo(d,b,y))}else{if(ie=="o11")break;if(ie=="o1234"||ie=="o1235"||ie=="o1236"||ie=="o1237")ie=="o1234"&&(A=y,C=(S=b+h.shift())+h.shift(),U=R=A+h.shift(),O=R,k=y,b=(F=(I=(D=C+h.shift())+h.shift())+h.shift())+h.shift(),e.U.P.curveTo(d,S,A,C,R,D,U),e.U.P.curveTo(d,I,O,F,k,b,y)),ie=="o1235"&&(S=b+h.shift(),A=y+h.shift(),C=S+h.shift(),R=A+h.shift(),D=C+h.shift(),U=R+h.shift(),I=D+h.shift(),O=U+h.shift(),F=I+h.shift(),k=O+h.shift(),b=F+h.shift(),y=k+h.shift(),h.shift(),e.U.P.curveTo(d,S,A,C,R,D,U),e.U.P.curveTo(d,I,O,F,k,b,y)),ie=="o1236"&&(S=b+h.shift(),A=y+h.shift(),C=S+h.shift(),U=R=A+h.shift(),O=R,F=(I=(D=C+h.shift())+h.shift())+h.shift(),k=O+h.shift(),b=F+h.shift(),e.U.P.curveTo(d,S,A,C,R,D,U),e.U.P.curveTo(d,I,O,F,k,b,y)),ie=="o1237"&&(S=b+h.shift(),A=y+h.shift(),C=S+h.shift(),R=A+h.shift(),D=C+h.shift(),U=R+h.shift(),I=D+h.shift(),O=U+h.shift(),F=I+h.shift(),k=O+h.shift(),Math.abs(F-b)>Math.abs(k-y)?b=F+h.shift():y=k+h.shift(),e.U.P.curveTo(d,S,A,C,R,D,U),e.U.P.curveTo(d,I,O,F,k,b,y));else if(ie=="o14"){if(h.length>0&&!p&&(m=h.shift()+l.nominalWidthX,p=!0),h.length==4){var H=h.shift(),J=h.shift(),K=h.shift(),se=h.shift(),Y=e.CFF.glyphBySE(l,K),he=e.CFF.glyphBySE(l,se);e.U._drawCFF(l.CharStrings[Y],a,l,u,d),a.x=H,a.y=J,e.U._drawCFF(l.CharStrings[he],a,l,u,d)}T&&(e.U.P.closePath(d),T=!1)}else if(ie=="o19"||ie=="o20")h.length%2!=0&&!p&&(m=h.shift()+u.nominalWidthX),f+=h.length>>1,h.length=0,p=!0,E+=f+7>>3;else if(ie=="o21")h.length>2&&!p&&(m=h.shift()+u.nominalWidthX,p=!0),y+=h.pop(),b+=h.pop(),T&&e.U.P.closePath(d),e.U.P.moveTo(d,b,y),T=!0;else if(ie=="o22")h.length>1&&!p&&(m=h.shift()+u.nominalWidthX,p=!0),b+=h.pop(),T&&e.U.P.closePath(d),e.U.P.moveTo(d,b,y),T=!0;else if(ie=="o25"){for(;h.length>6;)b+=h.shift(),y+=h.shift(),e.U.P.lineTo(d,b,y);S=b+h.shift(),A=y+h.shift(),C=S+h.shift(),R=A+h.shift(),b=C+h.shift(),y=R+h.shift(),e.U.P.curveTo(d,S,A,C,R,b,y)}else if(ie=="o26")for(h.length%2&&(b+=h.shift());h.length>0;)S=b,A=y+h.shift(),b=C=S+h.shift(),y=(R=A+h.shift())+h.shift(),e.U.P.curveTo(d,S,A,C,R,b,y);else if(ie=="o27")for(h.length%2&&(y+=h.shift());h.length>0;)A=y,C=(S=b+h.shift())+h.shift(),R=A+h.shift(),b=C+h.shift(),y=R,e.U.P.curveTo(d,S,A,C,R,b,y);else if(ie=="o10"||ie=="o29"){var ue=ie=="o10"?u:l;if(h.length==0)console.debug("error: empty stack");else{var Te=h.pop(),_e=ue.Subrs[Te+ue.Bias];a.x=b,a.y=y,a.nStems=f,a.haveWidth=p,a.width=m,a.open=T,e.U._drawCFF(_e,a,l,u,d),b=a.x,y=a.y,f=a.nStems,p=a.haveWidth,m=a.width,T=a.open}}else if(ie=="o30"||ie=="o31"){var Re=h.length,De=(xe=0,ie=="o31");for(xe+=Re-(ae=-3&Re);xe<ae;)De?(A=y,C=(S=b+h.shift())+h.shift(),y=(R=A+h.shift())+h.shift(),ae-xe==5?(b=C+h.shift(),xe++):b=C,De=!1):(S=b,A=y+h.shift(),C=S+h.shift(),R=A+h.shift(),b=C+h.shift(),ae-xe==5?(y=R+h.shift(),xe++):y=R,De=!0),e.U.P.curveTo(d,S,A,C,R,b,y),xe+=4}else{if((ie+"").charAt(0)=="o")throw console.debug("Unknown operation: "+ie,s),ie;h.push(ie)}}}a.x=b,a.y=y,a.nStems=f,a.haveWidth=p,a.width=m,a.open=T};var n=e,r={Typr:n};return i.Typr=n,i.default=r,Object.defineProperty(i,"__esModule",{value:!0}),i}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function FK(){return function(i){var e=Uint8Array,n=Uint16Array,r=Uint32Array,s=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),l=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=function(ie,ae){for(var ne=new n(31),pe=0;pe<31;++pe)ne[pe]=ae+=1<<ie[pe-1];var de=new r(ne[30]);for(pe=1;pe<30;++pe)for(var xe=ne[pe];xe<ne[pe+1];++xe)de[xe]=xe-ne[pe]<<5|pe;return[ne,de]},d=u(s,2),h=d[0],f=d[1];h[28]=258,f[258]=28;for(var p=u(a,0)[0],m=new n(32768),T=0;T<32768;++T){var E=(43690&T)>>>1|(21845&T)<<1;E=(61680&(E=(52428&E)>>>2|(13107&E)<<2))>>>4|(3855&E)<<4,m[T]=((65280&E)>>>8|(255&E)<<8)>>>1}var b=function(ie,ae,ne){for(var pe=ie.length,de=0,xe=new n(ae);de<pe;++de)++xe[ie[de]-1];var H,J=new n(ae);for(de=0;de<ae;++de)J[de]=J[de-1]+xe[de-1]<<1;if(ne){H=new n(1<<ae);var K=15-ae;for(de=0;de<pe;++de)if(ie[de])for(var se=de<<4|ie[de],Y=ae-ie[de],he=J[ie[de]-1]++<<Y,ue=he|(1<<Y)-1;he<=ue;++he)H[m[he]>>>K]=se}else for(H=new n(pe),de=0;de<pe;++de)ie[de]&&(H[de]=m[J[ie[de]-1]++]>>>15-ie[de]);return H},y=new e(288);for(T=0;T<144;++T)y[T]=8;for(T=144;T<256;++T)y[T]=9;for(T=256;T<280;++T)y[T]=7;for(T=280;T<288;++T)y[T]=8;var S=new e(32);for(T=0;T<32;++T)S[T]=5;var A=b(y,9,1),C=b(S,5,1),R=function(ie){for(var ae=ie[0],ne=1;ne<ie.length;++ne)ie[ne]>ae&&(ae=ie[ne]);return ae},I=function(ie,ae,ne){var pe=ae/8|0;return(ie[pe]|ie[pe+1]<<8)>>(7&ae)&ne},O=function(ie,ae){var ne=ae/8|0;return(ie[ne]|ie[ne+1]<<8|ie[ne+2]<<16)>>(7&ae)},F=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],k=function(ie,ae,ne){var pe=new Error(ae||F[ie]);if(pe.code=ie,Error.captureStackTrace&&Error.captureStackTrace(pe,k),!ne)throw pe;return pe},D=function(ie,ae,ne){var pe=ie.length;if(!pe||ne&&!ne.l&&pe<5)return ae||new e(0);var de=!ae||ne,xe=!ne||ne.i;ne||(ne={}),ae||(ae=new e(3*pe));var H,J=function(fe){var z=ae.length;if(fe>z){var Ae=new e(Math.max(2*z,fe));Ae.set(ae),ae=Ae}},K=ne.f||0,se=ne.p||0,Y=ne.b||0,he=ne.l,ue=ne.d,Te=ne.m,_e=ne.n,Re=8*pe;do{if(!he){ne.f=K=I(ie,se,1);var De=I(ie,se+1,3);if(se+=3,!De){var et=ie[(Ce=((H=se)/8|0)+(7&H&&1)+4)-4]|ie[Ce-3]<<8,Ue=Ce+et;if(Ue>pe){xe&&k(0);break}de&&J(Y+et),ae.set(ie.subarray(Ce,Ue),Y),ne.b=Y+=et,ne.p=se=8*Ue;continue}if(De==1)he=A,ue=C,Te=9,_e=5;else if(De==2){var Le=I(ie,se,31)+257,re=I(ie,se+10,15)+4,Ye=Le+I(ie,se+5,31)+1;se+=14;for(var Fe=new e(Ye),Ze=new e(19),Xe=0;Xe<re;++Xe)Ze[l[Xe]]=I(ie,se+3*Xe,7);se+=3*re;var dt=R(Ze),je=(1<<dt)-1,it=b(Ze,dt,1);for(Xe=0;Xe<Ye;){var Ce,Me=it[I(ie,se,je)];if(se+=15&Me,(Ce=Me>>>4)<16)Fe[Xe++]=Ce;else{var St=0,oe=0;for(Ce==16?(oe=3+I(ie,se,3),se+=2,St=Fe[Xe-1]):Ce==17?(oe=3+I(ie,se,7),se+=3):Ce==18&&(oe=11+I(ie,se,127),se+=7);oe--;)Fe[Xe++]=St}}var ee=Fe.subarray(0,Le),W=Fe.subarray(Le);Te=R(ee),_e=R(W),he=b(ee,Te,1),ue=b(W,_e,1)}else k(1);if(se>Re){xe&&k(0);break}}de&&J(Y+131072);for(var ot=(1<<Te)-1,ze=(1<<_e)-1,qe=se;;qe=se){var ut=(St=he[O(ie,se)&ot])>>>4;if((se+=15&St)>Re){xe&&k(0);break}if(St||k(2),ut<256)ae[Y++]=ut;else{if(ut==256){qe=se,he=null;break}var ft=ut-254;if(ut>264){var Ge=s[Xe=ut-257];ft=I(ie,se,(1<<Ge)-1)+h[Xe],se+=Ge}var $t=ue[O(ie,se)&ze],L=$t>>>4;if($t||k(3),se+=15&$t,W=p[L],L>3&&(Ge=a[L],W+=O(ie,se)&(1<<Ge)-1,se+=Ge),se>Re){xe&&k(0);break}de&&J(Y+131072);for(var X=Y+ft;Y<X;Y+=4)ae[Y]=ae[Y-W],ae[Y+1]=ae[Y+1-W],ae[Y+2]=ae[Y+2-W],ae[Y+3]=ae[Y+3-W];Y=X}}ne.l=he,ne.p=qe,ne.b=Y,he&&(K=1,ne.m=Te,ne.d=ue,ne.n=_e)}while(!K);return Y==ae.length?ae:function(fe,z,Ae){(z==null||z<0)&&(z=0),(Ae==null||Ae>fe.length)&&(Ae=fe.length);var tt=new(fe instanceof n?n:fe instanceof r?r:e)(Ae-z);return tt.set(fe.subarray(z,Ae)),tt}(ae,0,Y)},U=new e(0),ce=typeof TextDecoder<"u"&&new TextDecoder;try{ce.decode(U,{stream:!0})}catch{}return i.convert_streams=function(ie){var ae=new DataView(ie),ne=0;function pe(){var Le=ae.getUint16(ne);return ne+=2,Le}function de(){var Le=ae.getUint32(ne);return ne+=4,Le}function xe(Le){et.setUint16(Ue,Le),Ue+=2}function H(Le){et.setUint32(Ue,Le),Ue+=4}for(var J={signature:de(),flavor:de(),length:de(),numTables:pe(),reserved:pe(),totalSfntSize:de(),majorVersion:pe(),minorVersion:pe(),metaOffset:de(),metaLength:de(),metaOrigLength:de(),privOffset:de(),privLength:de()},K=0;Math.pow(2,K)<=J.numTables;)K++;K--;for(var se=16*Math.pow(2,K),Y=16*J.numTables-se,he=12,ue=[],Te=0;Te<J.numTables;Te++)ue.push({tag:de(),offset:de(),compLength:de(),origLength:de(),origChecksum:de()}),he+=16;var _e,Re=new Uint8Array(12+16*ue.length+ue.reduce(function(Le,re){return Le+re.origLength+4},0)),De=Re.buffer,et=new DataView(De),Ue=0;return H(J.flavor),xe(J.numTables),xe(se),xe(K),xe(Y),ue.forEach(function(Le){H(Le.tag),H(Le.origChecksum),H(he),H(Le.origLength),Le.outOffset=he,(he+=Le.origLength)%4!=0&&(he+=4-he%4)}),ue.forEach(function(Le){var re,Ye=ie.slice(Le.offset,Le.offset+Le.compLength);if(Le.compLength!=Le.origLength){var Fe=new Uint8Array(Le.origLength);re=new Uint8Array(Ye,2),D(re,Fe)}else Fe=new Uint8Array(Ye);Re.set(Fe,Le.outOffset);var Ze=0;(he=Le.outOffset+Le.origLength)%4!=0&&(Ze=4-he%4),Re.set(new Uint8Array(Ze).buffer,Le.outOffset+Le.origLength),_e=he+Ze}),De.slice(0,_e)},Object.defineProperty(i,"__esModule",{value:!0}),i}({}).convert_streams}function UK(i,e){const n={M:2,L:2,Q:4,C:6,Z:0},r={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},s=1,a=2,l=4,u=8,d=16,h=32;let f;function p(F){if(!f){const k={R:a,L:s,D:l,C:d,U:h,T:u};f=new Map;for(let D in r){let U=0;r[D].split(",").forEach(ce=>{let[ie,ae]=ce.split("+");ie=parseInt(ie,36),ae=ae?parseInt(ae,36):0,f.set(U+=ie,k[D]);for(let ne=ae;ne--;)f.set(++U,k[D])})}}return f.get(F)||h}const m=1,T=2,E=3,b=4,y=[null,"isol","init","fina","medi"];function S(F){const k=new Uint8Array(F.length);let D=h,U=m,ce=-1;for(let ie=0;ie<F.length;ie++){const ae=F.codePointAt(ie);let ne=p(ae)|0,pe=m;ne&u||(D&(s|l|d)?ne&(a|l|d)?(pe=E,(U===m||U===E)&&k[ce]++):ne&(s|h)&&(U===T||U===b)&&k[ce]--:D&(a|h)&&(U===T||U===b)&&k[ce]--,U=k[ie]=pe,D=ne,ce=ie,ae>65535&&ie++)}return k}function A(F,k){const D=[];for(let ce=0;ce<k.length;ce++){const ie=k.codePointAt(ce);ie>65535&&ce++,D.push(i.U.codeToGlyph(F,ie))}const U=F.GSUB;if(U){const{lookupList:ce,featureList:ie}=U;let ae;const ne=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,pe=[];ie.forEach(de=>{if(ne.test(de.tag))for(let xe=0;xe<de.tab.length;xe++){if(pe[de.tab[xe]])continue;pe[de.tab[xe]]=!0;const H=ce[de.tab[xe]],J=/^(isol|init|fina|medi)$/.test(de.tag);J&&!ae&&(ae=S(k));for(let K=0;K<D.length;K++)(!ae||!J||y[ae[K]]===de.tag)&&i.U._applySubs(D,K,H,ce)}})}return D}function C(F,k){const D=new Int16Array(k.length*3);let U=0;for(;U<k.length;U++){const ne=k[U];if(ne===-1)continue;D[U*3+2]=F.hmtx.aWidth[ne];const pe=F.GPOS;if(pe){const de=pe.lookupList;for(let xe=0;xe<de.length;xe++){const H=de[xe];for(let J=0;J<H.tabs.length;J++){const K=H.tabs[J];if(H.ltype===1){if(i._lctf.coverageIndex(K.coverage,ne)!==-1&&K.pos){ae(K.pos,U);break}}else if(H.ltype===2){let se=null,Y=ce();if(Y!==-1){const he=i._lctf.coverageIndex(K.coverage,k[Y]);if(he!==-1){if(K.fmt===1){const ue=K.pairsets[he];for(let Te=0;Te<ue.length;Te++)ue[Te].gid2===ne&&(se=ue[Te])}else if(K.fmt===2){const ue=i.U._getGlyphClass(k[Y],K.classDef1),Te=i.U._getGlyphClass(ne,K.classDef2);se=K.matrix[ue][Te]}if(se){se.val1&&ae(se.val1,Y),se.val2&&ae(se.val2,U);break}}}}else if(H.ltype===4){const se=i._lctf.coverageIndex(K.markCoverage,ne);if(se!==-1){const Y=ce(ie),he=Y===-1?-1:i._lctf.coverageIndex(K.baseCoverage,k[Y]);if(he!==-1){const ue=K.markArray[se],Te=K.baseArray[he][ue.markClass];D[U*3]=Te.x-ue.x+D[Y*3]-D[Y*3+2],D[U*3+1]=Te.y-ue.y+D[Y*3+1];break}}}else if(H.ltype===6){const se=i._lctf.coverageIndex(K.mark1Coverage,ne);if(se!==-1){const Y=ce();if(Y!==-1){const he=k[Y];if(R(F,he)===3){const ue=i._lctf.coverageIndex(K.mark2Coverage,he);if(ue!==-1){const Te=K.mark1Array[se],_e=K.mark2Array[ue][Te.markClass];D[U*3]=_e.x-Te.x+D[Y*3]-D[Y*3+2],D[U*3+1]=_e.y-Te.y+D[Y*3+1];break}}}}}}}}else if(F.kern&&!F.cff){const de=ce();if(de!==-1){const xe=F.kern.glyph1.indexOf(k[de]);if(xe!==-1){const H=F.kern.rval[xe].glyph2.indexOf(ne);H!==-1&&(D[de*3+2]+=F.kern.rval[xe].vals[H])}}}}return D;function ce(ne){for(let pe=U-1;pe>=0;pe--)if(k[pe]!==-1&&(!ne||ne(k[pe])))return pe;return-1}function ie(ne){return R(F,ne)===1}function ae(ne,pe){for(let de=0;de<3;de++)D[pe*3+de]+=ne[de]||0}}function R(F,k){const D=F.GDEF&&F.GDEF.glyphClassDef;return D?i.U._getGlyphClass(k,D):0}function I(...F){for(let k=0;k<F.length;k++)if(typeof F[k]=="number")return F[k]}function O(F){const k=Object.create(null),D=F["OS/2"],U=F.hhea,ce=F.head.unitsPerEm,ie=I(D&&D.sTypoAscender,U&&U.ascender,ce),ae={unitsPerEm:ce,ascender:ie,descender:I(D&&D.sTypoDescender,U&&U.descender,0),capHeight:I(D&&D.sCapHeight,ie),xHeight:I(D&&D.sxHeight,ie),lineGap:I(D&&D.sTypoLineGap,U&&U.lineGap),supportsCodePoint(ne){return i.U.codeToGlyph(F,ne)>0},forEachGlyph(ne,pe,de,xe){let H=0;const J=1/ae.unitsPerEm*pe,K=A(F,ne);let se=0;const Y=C(F,K);return K.forEach((he,ue)=>{if(he!==-1){let Te=k[he];if(!Te){const{cmds:_e,crds:Re}=i.U.glyphToPath(F,he);let De="",et=0;for(let Fe=0,Ze=_e.length;Fe<Ze;Fe++){const Xe=n[_e[Fe]];De+=_e[Fe];for(let dt=1;dt<=Xe;dt++)De+=(dt>1?",":"")+Re[et++]}let Ue,Le,re,Ye;if(Re.length){Ue=Le=1/0,re=Ye=-1/0;for(let Fe=0,Ze=Re.length;Fe<Ze;Fe+=2){let Xe=Re[Fe],dt=Re[Fe+1];Xe<Ue&&(Ue=Xe),dt<Le&&(Le=dt),Xe>re&&(re=Xe),dt>Ye&&(Ye=dt)}}else Ue=re=Le=Ye=0;Te=k[he]={index:he,advanceWidth:F.hmtx.aWidth[he],xMin:Ue,yMin:Le,xMax:re,yMax:Ye,path:De}}xe.call(null,Te,H+Y[ue*3]*J,Y[ue*3+1]*J,se),H+=Y[ue*3+2]*J,de&&(H+=de*pe)}se+=ne.codePointAt(se)>65535?2:1}),H}};return ae}return function(k){const D=new Uint8Array(k,0,4),U=i._bin.readASCII(D,0,4);if(U==="wOFF")k=e(k);else if(U==="wOF2")throw new Error("woff2 fonts not supported");return O(i.parse(k)[0])}}const GK=l_({name:"Typr Font Parser",dependencies:[BK,FK,UK],init(i,e,n){const r=i(),s=e();return n(r,s)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function HK(){return function(i){var e=function(){this.buckets=new Map};e.prototype.add=function(C){var R=C>>5;this.buckets.set(R,(this.buckets.get(R)||0)|1<<(31&C))},e.prototype.has=function(C){var R=this.buckets.get(C>>5);return R!==void 0&&(R&1<<(31&C))!=0},e.prototype.serialize=function(){var C=[];return this.buckets.forEach(function(R,I){C.push((+I).toString(36)+":"+R.toString(36))}),C.join(",")},e.prototype.deserialize=function(C){var R=this;this.buckets.clear(),C.split(",").forEach(function(I){var O=I.split(":");R.buckets.set(parseInt(O[0],36),parseInt(O[1],36))})};var n=Math.pow(2,8),r=n-1,s=~r;function a(C){var R=function(O){return O&s}(C).toString(16),I=function(O){return(O&s)+n-1}(C).toString(16);return"codepoint-index/plane"+(C>>16)+"/"+R+"-"+I+".json"}function l(C,R){var I=C&r,O=R.codePointAt(I/6|0);return((O=(O||48)-48)&1<<I%6)!=0}function u(C,R){var I;(I=C,I.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(O){return O.split("-").map(function(F){return parseInt(F.trim(),16)})})).forEach(function(O){var F=O[0],k=O[1];k===void 0&&(k=F),R(F,k)})}function d(C,R){u(C,function(I,O){for(var F=I;F<=O;F++)R(F)})}var h={},f={},p=new WeakMap,m="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function T(C){var R=p.get(C);return R||(R=new e,d(C.ranges,function(I){return R.add(I)}),p.set(C,R)),R}var E,b=new Map;function y(C,R,I){return C[R]?R:C[I]?I:function(O){for(var F in O)return F}(C)}function S(C,R){var I=R;if(!C.includes(I)){I=1/0;for(var O=0;O<C.length;O++)Math.abs(C[O]-R)<Math.abs(I-R)&&(I=C[O])}return I}function A(C){return E||(E=new Set,d("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(R){E.add(R)})),E.has(C)}return i.CodePointSet=e,i.clearCache=function(){h={},f={}},i.getFontsForString=function(C,R){R===void 0&&(R={});var I,O=R.lang;O===void 0&&(O=/\p{Script=Hangul}/u.test(I=C)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(I)?"ja":"en");var F=R.category;F===void 0&&(F="sans-serif");var k=R.style;k===void 0&&(k="normal");var D=R.weight;D===void 0&&(D=400);var U=(R.dataUrl||m).replace(/\/$/g,""),ce=new Map,ie=new Uint8Array(C.length),ae={},ne={},pe=new Array(C.length),de=new Map,xe=!1;function H(se){var Y=b.get(se);return Y||(Y=fetch(U+"/"+se).then(function(he){if(!he.ok)throw new Error(he.statusText);return he.json().then(function(ue){if(!Array.isArray(ue)||ue[0]!==1)throw new Error("Incorrect schema version; need 1, got "+ue[0]);return ue[1]})}).catch(function(he){if(U!==m)return xe||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+U+'", trying default CDN. '+he.message),xe=!0),U=m,b.delete(se),H(se);throw he}),b.set(se,Y)),Y}for(var J=function(se){var Y=C.codePointAt(se),he=a(Y);pe[se]=he,h[he]||de.has(he)||de.set(he,H(he).then(function(ue){h[he]=ue})),Y>65535&&(se++,K=se)},K=0;K<C.length;K++)J(K);return Promise.all(de.values()).then(function(){de.clear();for(var se=function(he){var ue=C.codePointAt(he),Te=null,_e=h[pe[he]],Re=void 0;for(var De in _e){var et=ne[De];if(et===void 0&&(et=ne[De]=new RegExp(De).test(O||"en")),et){for(var Ue in Re=De,_e[De])if(l(ue,_e[De][Ue])){Te=Ue;break}break}}if(!Te){e:for(var Le in _e)if(Le!==Re){for(var re in _e[Le])if(l(ue,_e[Le][re])){Te=re;break e}}}Te||(console.debug("No font coverage for U+"+ue.toString(16)),Te="latin"),pe[he]=Te,f[Te]||de.has(Te)||de.set(Te,H("font-meta/"+Te+".json").then(function(Ye){f[Te]=Ye})),ue>65535&&(he++,Y=he)},Y=0;Y<C.length;Y++)se(Y);return Promise.all(de.values())}).then(function(){for(var se,Y=null,he=0;he<C.length;he++){var ue=C.codePointAt(he);if(Y&&(A(ue)||T(Y).has(ue)))ie[he]=ie[he-1];else{Y=f[pe[he]];var Te=ae[Y.id];if(!Te){var _e=Y.typeforms,Re=y(_e,F,"sans-serif"),De=y(_e[Re],k,"normal"),et=S((se=_e[Re])===null||se===void 0?void 0:se[De],D);Te=ae[Y.id]=U+"/font-files/"+Y.id+"/"+Re+"."+De+"."+et+".woff"}var Ue=ce.get(Te);Ue==null&&(Ue=ce.size,ce.set(Te,Ue)),ie[he]=Ue}ue>65535&&(he++,ie[he]=ie[he-1])}return{fontUrls:Array.from(ce.keys()),chars:ie}})},Object.defineProperty(i,"__esModule",{value:!0}),i}({})}function VK(i,e){const n=Object.create(null),r=Object.create(null);function s(l,u){const d=h=>{console.error(`Failure loading font ${l}`,h)};try{const h=new XMLHttpRequest;h.open("get",l,!0),h.responseType="arraybuffer",h.onload=function(){if(h.status>=400)d(new Error(h.statusText));else if(h.status>0)try{const f=i(h.response);f.src=l,u(f)}catch(f){d(f)}},h.onerror=d,h.send()}catch(h){d(h)}}function a(l,u){let d=n[l];d?u(d):r[l]?r[l].push(u):(r[l]=[u],s(l,h=>{h.src=l,n[l]=h,r[l].forEach(f=>f(h)),delete r[l]}))}return function(l,u,{lang:d,fonts:h=[],style:f="normal",weight:p="normal",unicodeFontsURL:m}={}){const T=new Uint8Array(l.length),E=[];l.length||A();const b=new Map,y=[];if(f!=="italic"&&(f="normal"),typeof p!="number"&&(p=p==="bold"?700:400),h&&!Array.isArray(h)&&(h=[h]),h=h.slice().filter(R=>!R.lang||R.lang.test(d)).reverse(),h.length){let F=0;(function k(D=0){for(let U=D,ce=l.length;U<ce;U++){const ie=l.codePointAt(U);if(F===1&&E[T[U-1]].supportsCodePoint(ie)||/\s/.test(l[U]))T[U]=T[U-1],F===2&&(y[y.length-1][1]=U);else for(let ae=T[U],ne=h.length;ae<=ne;ae++)if(ae===ne){const pe=F===2?y[y.length-1]:y[y.length]=[U,U];pe[1]=U,F=2}else{T[U]=ae;const{src:pe,unicodeRange:de}=h[ae];if(!de||C(ie,de)){const xe=n[pe];if(!xe){a(pe,()=>{k(U)});return}if(xe.supportsCodePoint(ie)){let H=b.get(xe);typeof H!="number"&&(H=E.length,E.push(xe),b.set(xe,H)),T[U]=H,F=1;break}}}ie>65535&&U+1<ce&&(T[U+1]=T[U],U++,F===2&&(y[y.length-1][1]=U))}S()})()}else y.push([0,l.length-1]),S();function S(){if(y.length){const R=y.map(I=>l.substring(I[0],I[1]+1)).join(`
`);e.getFontsForString(R,{lang:d||void 0,style:f,weight:p,dataUrl:m}).then(({fontUrls:I,chars:O})=>{const F=E.length;let k=0;y.forEach(U=>{for(let ce=0,ie=U[1]-U[0];ce<=ie;ce++)T[U[0]+ce]=O[k++]+F;k++});let D=0;I.forEach((U,ce)=>{a(U,ie=>{E[ce+F]=ie,++D===I.length&&A()})})})}else A()}function A(){u({chars:T,fonts:E})}function C(R,I){for(let O=0;O<I.length;O++){const[F,k=F]=I[O];if(F<=R&&R<=k)return!0}return!1}}}const zK=l_({name:"FontResolver",dependencies:[VK,GK,HK],init(i,e,n){return i(e,n())}});function WK(i,e){const r=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,s="[^\\S\\u00A0]",a=new RegExp(`${s}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function l({text:E,lang:b,fonts:y,style:S,weight:A,preResolvedFonts:C,unicodeFontsURL:R},I){const O=({chars:F,fonts:k})=>{let D,U;const ce=[];for(let ie=0;ie<F.length;ie++)F[ie]!==U?(U=F[ie],ce.push(D={start:ie,end:ie,fontObj:k[F[ie]]})):D.end=ie;I(ce)};C?O(C):i(E,O,{lang:b,fonts:y,style:S,weight:A,unicodeFontsURL:R})}function u({text:E="",font:b,lang:y,sdfGlyphSize:S=64,fontSize:A=400,fontWeight:C=1,fontStyle:R="normal",letterSpacing:I=0,lineHeight:O="normal",maxWidth:F=1/0,direction:k,textAlign:D="left",textIndent:U=0,whiteSpace:ce="normal",overflowWrap:ie="normal",anchorX:ae=0,anchorY:ne=0,metricsOnly:pe=!1,unicodeFontsURL:de,preResolvedFonts:xe=null,includeCaretPositions:H=!1,chunkedBoundsSize:J=8192,colorRanges:K=null},se){const Y=p(),he={fontLoad:0,typesetting:0};E.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),E=E.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),A=+A,I=+I,F=+F,O=O||"normal",U=+U,l({text:E,lang:y,style:R,weight:C,fonts:typeof b=="string"?[{src:b}]:b,unicodeFontsURL:de,preResolvedFonts:xe},ue=>{he.fontLoad=p()-Y;const Te=isFinite(F);let _e=null,Re=null,De=null,et=null,Ue=null,Le=null,re=null,Ye=null,Fe=0,Ze=0,Xe=ce!=="nowrap";const dt=new Map,je=p();let it=U,Ce=0,Me=new m;const St=[Me];ue.forEach(ze=>{const{fontObj:qe}=ze,{ascender:ut,descender:ft,unitsPerEm:Ge,lineGap:$t,capHeight:L,xHeight:X}=qe;let fe=dt.get(qe);if(!fe){const Ie=A/Ge,Be=O==="normal"?(ut-ft+$t)*Ie:O*A,N=(Be-(ut-ft)*Ie)/2,j=Math.min(Be,(ut-ft)*Ie),ge=(ut+ft)/2*Ie+j/2;fe={index:dt.size,src:qe.src,fontObj:qe,fontSizeMult:Ie,unitsPerEm:Ge,ascender:ut*Ie,descender:ft*Ie,capHeight:L*Ie,xHeight:X*Ie,lineHeight:Be,baseline:-N-ut*Ie,caretTop:ge,caretBottom:ge-j},dt.set(qe,fe)}const{fontSizeMult:z}=fe,Ae=E.slice(ze.start,ze.end+1);let tt,ye;qe.forEachGlyph(Ae,A,I,(Ie,Be,N,j)=>{Be+=Ce,j+=ze.start,tt=Be,ye=Ie;const ge=E.charAt(j),we=Ie.advanceWidth*z,We=Me.count;let gt;if("isEmpty"in Ie||(Ie.isWhitespace=!!ge&&new RegExp(s).test(ge),Ie.canBreakAfter=!!ge&&a.test(ge),Ie.isEmpty=Ie.xMin===Ie.xMax||Ie.yMin===Ie.yMax||r.test(ge)),!Ie.isWhitespace&&!Ie.isEmpty&&Ze++,Xe&&Te&&!Ie.isWhitespace&&Be+we+it>F&&We){if(Me.glyphAt(We-1).glyphObj.canBreakAfter)gt=new m,it=-Be;else for(let un=We;un--;)if(un===0&&ie==="break-word"){gt=new m,it=-Be;break}else if(Me.glyphAt(un).glyphObj.canBreakAfter){gt=Me.splitAt(un+1);const an=gt.glyphAt(0).x;it-=an;for(let ei=gt.count;ei--;)gt.glyphAt(ei).x-=an;break}gt&&(Me.isSoftWrapped=!0,Me=gt,St.push(Me),Fe=F)}let bt=Me.glyphAt(Me.count);bt.glyphObj=Ie,bt.x=Be+it,bt.y=N,bt.width=we,bt.charIndex=j,bt.fontData=fe,ge===`
`&&(Me=new m,St.push(Me),it=-(Be+we+I*A)+U)}),Ce=tt+ye.advanceWidth*z+I*A});let oe=0;St.forEach(ze=>{let qe=!0;for(let ut=ze.count;ut--;){const ft=ze.glyphAt(ut);qe&&!ft.glyphObj.isWhitespace&&(ze.width=ft.x+ft.width,ze.width>Fe&&(Fe=ze.width),qe=!1);let{lineHeight:Ge,capHeight:$t,xHeight:L,baseline:X}=ft.fontData;Ge>ze.lineHeight&&(ze.lineHeight=Ge);const fe=X-ze.baseline;fe<0&&(ze.baseline+=fe,ze.cap+=fe,ze.ex+=fe),ze.cap=Math.max(ze.cap,ze.baseline+$t),ze.ex=Math.max(ze.ex,ze.baseline+L)}ze.baseline-=oe,ze.cap-=oe,ze.ex-=oe,oe+=ze.lineHeight});let ee=0,W=0;if(ae&&(typeof ae=="number"?ee=-ae:typeof ae=="string"&&(ee=-Fe*(ae==="left"?0:ae==="center"?.5:ae==="right"?1:h(ae)))),ne&&(typeof ne=="number"?W=-ne:typeof ne=="string"&&(W=ne==="top"?0:ne==="top-baseline"?-St[0].baseline:ne==="top-cap"?-St[0].cap:ne==="top-ex"?-St[0].ex:ne==="middle"?oe/2:ne==="bottom"?oe:ne==="bottom-baseline"?-St[St.length-1].baseline:h(ne)*oe)),!pe){const ze=e.getEmbeddingLevels(E,k);_e=new Uint16Array(Ze),Re=new Uint8Array(Ze),De=new Float32Array(Ze*2),et={},re=[1/0,1/0,-1/0,-1/0],Ye=[],H&&(Le=new Float32Array(E.length*4)),K&&(Ue=new Uint8Array(Ze*3));let qe=0,ut=-1,ft=-1,Ge,$t;if(St.forEach((L,X)=>{let{count:fe,width:z}=L;if(fe>0){let Ae=0;for(let j=fe;j--&&L.glyphAt(j).glyphObj.isWhitespace;)Ae++;let tt=0,ye=0;if(D==="center")tt=(Fe-z)/2;else if(D==="right")tt=Fe-z;else if(D==="justify"&&L.isSoftWrapped){let j=0;for(let ge=fe-Ae;ge--;)L.glyphAt(ge).glyphObj.isWhitespace&&j++;ye=(Fe-z)/j}if(ye||tt){let j=0;for(let ge=0;ge<fe;ge++){let we=L.glyphAt(ge);const We=we.glyphObj;we.x+=tt+j,ye!==0&&We.isWhitespace&&ge<fe-Ae&&(j+=ye,we.width+=ye)}}const Ie=e.getReorderSegments(E,ze,L.glyphAt(0).charIndex,L.glyphAt(L.count-1).charIndex);for(let j=0;j<Ie.length;j++){const[ge,we]=Ie[j];let We=1/0,gt=-1/0;for(let bt=0;bt<fe;bt++)if(L.glyphAt(bt).charIndex>=ge){let un=bt,an=bt;for(;an<fe;an++){let ei=L.glyphAt(an);if(ei.charIndex>we)break;an<fe-Ae&&(We=Math.min(We,ei.x),gt=Math.max(gt,ei.x+ei.width))}for(let ei=un;ei<an;ei++){const pi=L.glyphAt(ei);pi.x=gt-(pi.x+pi.width-We)}break}}let Be;const N=j=>Be=j;for(let j=0;j<fe;j++){const ge=L.glyphAt(j);Be=ge.glyphObj;const we=Be.index,We=ze.levels[ge.charIndex]&1;if(We){const gt=e.getMirroredCharacter(E[ge.charIndex]);gt&&ge.fontData.fontObj.forEachGlyph(gt,0,0,N)}if(H){const{charIndex:gt,fontData:bt}=ge,un=ge.x+ee,an=ge.x+ge.width+ee;Le[gt*4]=We?an:un,Le[gt*4+1]=We?un:an,Le[gt*4+2]=L.baseline+bt.caretBottom+W,Le[gt*4+3]=L.baseline+bt.caretTop+W;const ei=gt-ut;ei>1&&f(Le,ut,ei),ut=gt}if(K){const{charIndex:gt}=ge;for(;gt>ft;)ft++,K.hasOwnProperty(ft)&&($t=K[ft])}if(!Be.isWhitespace&&!Be.isEmpty){const gt=qe++,{fontSizeMult:bt,src:un,index:an}=ge.fontData,ei=et[un]||(et[un]={});ei[we]||(ei[we]={path:Be.path,pathBounds:[Be.xMin,Be.yMin,Be.xMax,Be.yMax]});const pi=ge.x+ee,Ji=ge.y+L.baseline+W;De[gt*2]=pi,De[gt*2+1]=Ji;const Ci=pi+Be.xMin*bt,vi=Ji+Be.yMin*bt,Ti=pi+Be.xMax*bt,nn=Ji+Be.yMax*bt;Ci<re[0]&&(re[0]=Ci),vi<re[1]&&(re[1]=vi),Ti>re[2]&&(re[2]=Ti),nn>re[3]&&(re[3]=nn),gt%J===0&&(Ge={start:gt,end:gt,rect:[1/0,1/0,-1/0,-1/0]},Ye.push(Ge)),Ge.end++;const mi=Ge.rect;if(Ci<mi[0]&&(mi[0]=Ci),vi<mi[1]&&(mi[1]=vi),Ti>mi[2]&&(mi[2]=Ti),nn>mi[3]&&(mi[3]=nn),_e[gt]=we,Re[gt]=an,K){const yr=gt*3;Ue[yr]=$t>>16&255,Ue[yr+1]=$t>>8&255,Ue[yr+2]=$t&255}}}}}),Le){const L=E.length-ut;L>1&&f(Le,ut,L)}}const ot=[];dt.forEach(({index:ze,src:qe,unitsPerEm:ut,ascender:ft,descender:Ge,lineHeight:$t,capHeight:L,xHeight:X})=>{ot[ze]={src:qe,unitsPerEm:ut,ascender:ft,descender:Ge,lineHeight:$t,capHeight:L,xHeight:X}}),he.typesetting=p()-je,se({glyphIds:_e,glyphFontIndices:Re,glyphPositions:De,glyphData:et,fontData:ot,caretPositions:Le,glyphColors:Ue,chunkedBounds:Ye,fontSize:A,topBaseline:W+St[0].baseline,blockBounds:[ee,W-oe,ee+Fe,W],visibleBounds:re,timings:he})})}function d(E,b){u({...E,metricsOnly:!0},y=>{const[S,A,C,R]=y.blockBounds;b({width:C-S,height:R-A})})}function h(E){let b=E.match(/^([\d.]+)%$/),y=b?parseFloat(b[1]):NaN;return isNaN(y)?0:y/100}function f(E,b,y){const S=E[b*4],A=E[b*4+1],C=E[b*4+2],R=E[b*4+3],I=(A-S)/y;for(let O=0;O<y;O++){const F=(b+O)*4;E[F]=S+I*O,E[F+1]=S+I*(O+1),E[F+2]=C,E[F+3]=R}}function p(){return(self.performance||Date).now()}function m(){this.data=[]}const T=["glyphObj","x","y","width","charIndex","fontData"];return m.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/T.length)},glyphAt(E){let b=m.flyweight;return b.data=this.data,b.index=E,b},splitAt(E){let b=new m;return b.data=this.data.splice(E*T.length),b}},m.flyweight=T.reduce((E,b,y,S)=>(Object.defineProperty(E,b,{get(){return this.data[this.index*T.length+y]},set(A){this.data[this.index*T.length+y]=A}}),E),{data:null,index:0}),{typeset:u,measure:d}}const up=()=>(self.performance||Date).now(),Z$=r2();let Bk;function XK(i,e,n,r,s,a,l,u,d,h,f=!0){return f?YK(i,e,n,r,s,a,l,u,d,h).then(null,p=>(Bk||(console.warn("WebGL SDF generation failed, falling back to JS",p),Bk=!0),Uk(i,e,n,r,s,a,l,u,d,h))):Uk(i,e,n,r,s,a,l,u,d,h)}const vS=[],jK=5;let nw=0;function o2(){const i=up();for(;vS.length&&up()-i<jK;)vS.shift()();nw=vS.length?setTimeout(o2,0):0}const YK=(...i)=>new Promise((e,n)=>{vS.push(()=>{const r=up();try{Z$.webgl.generateIntoCanvas(...i),e({timing:up()-r})}catch(s){n(s)}}),nw||(nw=setTimeout(o2,0))}),KK=4,JK=2e3,Fk={};let ZK=0;function Uk(i,e,n,r,s,a,l,u,d,h){const f="TroikaTextSDFGenerator_JS_"+ZK++%KK;let p=Fk[f];return p||(p=Fk[f]={workerModule:l_({name:f,workerId:f,dependencies:[r2,up],init(m,T){const E=m().javascript.generate;return function(...b){const y=T();return{textureData:E(...b),timing:T()-y}}},getTransferables(m){return[m.textureData.buffer]}}),requests:0,idleTimer:null}),p.requests++,clearTimeout(p.idleTimer),p.workerModule(i,e,n,r,s,a).then(({textureData:m,timing:T})=>{const E=up(),b=new Uint8Array(m.length*4);for(let y=0;y<m.length;y++)b[y*4+h]=m[y];return Z$.webglUtils.renderImageData(l,b,u,d,i,e,1<<3-h),T+=up()-E,--p.requests===0&&(p.idleTimer=setTimeout(()=>{RK(f)},JK)),{timing:T}})}function qK(i){i._warm||(Z$.webgl.isSupported(i),i._warm=!0)}const QK=Z$.webglUtils.resizeWebGLCanvasWithoutClearing,ag={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},e7=new Ct;function rg(){return(self.performance||Date).now()}const Gk=Object.create(null);function a2(i,e){i=i7({},i);const n=rg(),{defaultFontURL:r}=ag,s=[];if(r&&s.push({label:"default",src:Hk(r)}),i.font&&s.push({label:"user",src:Hk(i.font)}),i.font=s,i.text=""+i.text,i.sdfGlyphSize=i.sdfGlyphSize||ag.sdfGlyphSize,i.unicodeFontsURL=i.unicodeFontsURL||ag.unicodeFontsURL,i.colorRanges!=null){let m={};for(let T in i.colorRanges)if(i.colorRanges.hasOwnProperty(T)){let E=i.colorRanges[T];typeof E!="number"&&(E=e7.set(E).getHex()),m[T]=E}i.colorRanges=m}Object.freeze(i);const{textureWidth:a,sdfExponent:l}=ag,{sdfGlyphSize:u}=i,d=a/u*4;let h=Gk[u];if(!h){const m=document.createElement("canvas");m.width=a,m.height=u*256/d,h=Gk[u]={glyphCount:0,sdfGlyphSize:u,sdfCanvas:m,sdfTexture:new ni(m,void 0,void 0,void 0,Gn,Gn),contextLost:!1,glyphsByFont:new Map},h.sdfTexture.generateMipmaps=!1,t7(h)}const{sdfTexture:f,sdfCanvas:p}=h;s7(i).then(m=>{const{glyphIds:T,glyphFontIndices:E,fontData:b,glyphPositions:y,fontSize:S,timings:A}=m,C=[],R=new Float32Array(T.length*4);let I=0,O=0;const F=rg(),k=b.map(ae=>{let ne=h.glyphsByFont.get(ae.src);return ne||h.glyphsByFont.set(ae.src,ne=new Map),ne});T.forEach((ae,ne)=>{const pe=E[ne],{src:de,unitsPerEm:xe}=b[pe];let H=k[pe].get(ae);if(!H){const{path:he,pathBounds:ue}=m.glyphData[de][ae],Te=Math.max(ue[2]-ue[0],ue[3]-ue[1])/u*(ag.sdfMargin*u+.5),_e=h.glyphCount++,Re=[ue[0]-Te,ue[1]-Te,ue[2]+Te,ue[3]+Te];k[pe].set(ae,H={path:he,atlasIndex:_e,sdfViewBox:Re}),C.push(H)}const{sdfViewBox:J}=H,K=y[O++],se=y[O++],Y=S/xe;R[I++]=K+J[0]*Y,R[I++]=se+J[1]*Y,R[I++]=K+J[2]*Y,R[I++]=se+J[3]*Y,T[ne]=H.atlasIndex}),A.quads=(A.quads||0)+(rg()-F);const D=rg();A.sdf={};const U=p.height,ce=Math.ceil(h.glyphCount/d),ie=Math.pow(2,Math.ceil(Math.log2(ce*u)));ie>U&&(console.info(`Increasing SDF texture size ${U}->${ie}`),QK(p,a,ie),f.dispose()),Promise.all(C.map(ae=>l2(ae,h,i.gpuAccelerateSDF).then(({timing:ne})=>{A.sdf[ae.atlasIndex]=ne}))).then(()=>{C.length&&!h.contextLost&&(c2(h),f.needsUpdate=!0),A.sdfTotal=rg()-D,A.total=rg()-n,e(Object.freeze({parameters:i,sdfTexture:f,sdfGlyphSize:u,sdfExponent:l,glyphBounds:R,glyphAtlasIndices:T,glyphColors:m.glyphColors,caretPositions:m.caretPositions,chunkedBounds:m.chunkedBounds,ascender:m.ascender,descender:m.descender,lineHeight:m.lineHeight,capHeight:m.capHeight,xHeight:m.xHeight,topBaseline:m.topBaseline,blockBounds:m.blockBounds,visibleBounds:m.visibleBounds,timings:m.timings}))})}),Promise.resolve().then(()=>{h.contextLost||qK(p)})}function l2({path:i,atlasIndex:e,sdfViewBox:n},{sdfGlyphSize:r,sdfCanvas:s,contextLost:a},l){if(a)return Promise.resolve({timing:-1});const{textureWidth:u,sdfExponent:d}=ag,h=Math.max(n[2]-n[0],n[3]-n[1]),f=Math.floor(e/4),p=f%(u/r)*r,m=Math.floor(f/(u/r))*r,T=e%4;return XK(r,r,i,n,h,d,s,p,m,T,l)}function t7(i){const e=i.sdfCanvas;e.addEventListener("webglcontextlost",n=>{console.log("Context Lost",n),n.preventDefault(),i.contextLost=!0}),e.addEventListener("webglcontextrestored",n=>{console.log("Context Restored",n),i.contextLost=!1;const r=[];i.glyphsByFont.forEach(s=>{s.forEach(a=>{r.push(l2(a,i,!0))})}),Promise.all(r).then(()=>{c2(i),i.sdfTexture.needsUpdate=!0})})}function n7({font:i,characters:e,sdfGlyphSize:n},r){let s=Array.isArray(e)?e.join(`
`):""+e;a2({font:i,sdfGlyphSize:n,text:s},r)}function i7(i,e){for(let n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return i}let H0;function Hk(i){return H0||(H0=typeof document>"u"?{}:document.createElement("a")),H0.href=i,H0.href}function c2(i){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:n}=i,{width:r,height:s}=e,a=i.sdfCanvas.getContext("webgl");let l=n.image.data;(!l||l.length!==r*s*4)&&(l=new Uint8Array(r*s*4),n.image={width:r,height:s,data:l},n.flipY=!1,n.isDataTexture=!0),a.readPixels(0,0,r,s,a.RGBA,a.UNSIGNED_BYTE,l)}}const r7=l_({name:"Typesetter",dependencies:[WK,zK,MK],init(i,e,n){return i(e,n())}}),s7=l_({name:"Typesetter",dependencies:[r7],init(i){return function(e){return new Promise(n=>{i.typeset(e,n)})}},getTransferables(i){const e=[];for(let n in i)i[n]&&i[n].buffer&&e.push(i[n].buffer);return e}}),Vk={};function o7(i){let e=Vk[i];if(!e){const n=new Bl(1,1,i,i),r=n.clone(),s=n.attributes,a=r.attributes,l=new rn,u=s.uv.count;for(let d=0;d<u;d++)a.position.array[d*3]*=-1,a.normal.array[d*3+2]*=-1;["position","normal","uv"].forEach(d=>{l.setAttribute(d,new Yt([...s[d].array,...a[d].array],s[d].itemSize))}),l.setIndex([...n.index.array,...r.index.array.map(d=>d+u)]),l.translate(.5,.5,0),e=Vk[i]=l}return e}const a7="aTroikaGlyphBounds",zk="aTroikaGlyphIndex",l7="aTroikaGlyphColor";class c7 extends J${constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new js,this.boundingBox=new Xs}computeBoundingSphere(){}computeBoundingBox(){}setSide(e){const n=this.getIndex().count;this.setDrawRange(e===zs?n/2:0,e===Ss?n:n/2)}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let n=o7(e);["position","normal","uv"].forEach(r=>{this.attributes[r]=n.attributes[r].clone()}),this.setIndex(n.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,n,r,s,a){nx(this,a7,e,4),nx(this,zk,n,1),nx(this,l7,a,3),this._blockBounds=r,this._chunkedBounds=s,this.instanceCount=n.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:n,boundingBox:r}=this;if(n){const{PI:s,floor:a,min:l,max:u,sin:d,cos:h}=Math,f=s/2,p=s*2,m=Math.abs(n),T=e[0]/m,E=e[2]/m,b=a((T+f)/p)!==a((E+f)/p)?-m:l(d(T)*m,d(E)*m),y=a((T-f)/p)!==a((E-f)/p)?m:u(d(T)*m,d(E)*m),S=a((T+s)/p)!==a((E+s)/p)?m*2:u(m-h(T)*m,m-h(E)*m);r.min.set(b,e[1],n<0?-S:0),r.max.set(y,e[3],n<0?0:S)}else r.min.set(e[0],e[1],0),r.max.set(e[2],e[3],0);r.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let n=this.getAttribute(zk).count,r=this._chunkedBounds;if(r)for(let s=r.length;s--;){n=r[s].end;let a=r[s].rect;if(a[1]<e.w&&a[3]>e.y&&a[0]<e.z&&a[2]>e.x)break}this.instanceCount=n}}function nx(i,e,n,r){const s=i.getAttribute(e);n?s&&s.array.length===n.length?(s.array.set(n),s.needsUpdate=!0):(i.setAttribute(e,new ld(n,r)),delete i._maxInstanceCount,i.dispose()):s&&i.deleteAttribute(e)}const u7=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,h7=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,d7=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,f7=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function p7(i){const e=tw(i,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new mt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Hn(0,0,0,0)},uTroikaClipRect:{value:new Hn(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new mt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Ct},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Ln},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:u7,vertexTransform:h7,fragmentDefs:d7,fragmentColorTransform:f7,customRewriter({vertexShader:n,fragmentShader:r}){let s=/\buniform\s+vec3\s+diffuse\b/;return s.test(r)&&(r=r.replace(s,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),s.test(n)||(n=n.replace(s2,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:n,fragmentShader:r}}});return e.transparent=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const eI=new ii({color:16777215,side:Ss,transparent:!0}),Wk=8421504,Xk=new pn,V0=new te,ix=new te,Kv=[],m7=new te,rx="+x+y";function jk(i){return Array.isArray(i)?i[0]:i}let u2=()=>{const i=new Pn(new Bl(1,1),eI);return u2=()=>i,i},h2=()=>{const i=new Pn(new Bl(1,1,32,1),eI);return h2=()=>i,i};const g7={type:"syncstart"},_7={type:"synccomplete"},d2=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],v7=d2.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let f2=class extends Pn{constructor(){const e=new c7;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=Wk,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=rx,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(g7),a2({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},n=>{this._isSyncing=!1,this._textRenderInfo=n,this.geometry.updateGlyphs(n.glyphBounds,n.glyphAtlasIndices,n.blockBounds,n.chunkedBounds,n.glyphColors);const r=this._queuedSyncs;r&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{r.forEach(s=>s&&s())})),this.dispatchEvent(_7),e&&e()})))}onBeforeRender(e,n,r,s,a,l){this.sync(),a.isTroikaTextMaterial&&this._prepareForRender(a),a._hadOwnSide=a.hasOwnProperty("side"),this.geometry.setSide(a._actualSide=a.side),a.side=Ya}onAfterRender(e,n,r,s,a,l){a._hadOwnSide?a.side=a._actualSide:delete a.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let e=this._derivedMaterial;const n=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=eI.clone());if((!e||e.baseMaterial!==n)&&(e=this._derivedMaterial=p7(n),n.addEventListener("dispose",function r(){n.removeEventListener("dispose",r),e.dispose()})),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let r=e._outlineMtl;return r||(r=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),r.isTextOutlineMaterial=!0,r.depthWrite=!1,r.map=null,e.addEventListener("dispose",function s(){e.removeEventListener("dispose",s),r.dispose()})),[r,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return jk(this.material).getDepthMaterial()}get customDistanceMaterial(){return jk(this.material).getDistanceMaterial()}_prepareForRender(e){const n=e.isTextOutlineMaterial,r=e.uniforms,s=this.textRenderInfo;if(s){const{sdfTexture:u,blockBounds:d}=s;r.uTroikaSDFTexture.value=u,r.uTroikaSDFTextureSize.value.set(u.image.width,u.image.height),r.uTroikaSDFGlyphSize.value=s.sdfGlyphSize,r.uTroikaSDFExponent.value=s.sdfExponent,r.uTroikaTotalBounds.value.fromArray(d),r.uTroikaUseGlyphColors.value=!n&&!!s.glyphColors;let h=0,f=0,p=0,m,T,E,b=0,y=0;if(n){let{outlineWidth:A,outlineOffsetX:C,outlineOffsetY:R,outlineBlur:I,outlineOpacity:O}=this;h=this._parsePercent(A)||0,f=Math.max(0,this._parsePercent(I)||0),m=O,b=this._parsePercent(C)||0,y=this._parsePercent(R)||0}else p=Math.max(0,this._parsePercent(this.strokeWidth)||0),p&&(E=this.strokeColor,r.uTroikaStrokeColor.value.set(E??Wk),T=this.strokeOpacity,T==null&&(T=1)),m=this.fillOpacity;r.uTroikaDistanceOffset.value=h,r.uTroikaPositionOffset.value.set(b,y),r.uTroikaBlurRadius.value=f,r.uTroikaStrokeWidth.value=p,r.uTroikaStrokeOpacity.value=T,r.uTroikaFillOpacity.value=m??1,r.uTroikaCurveRadius.value=this.curveRadius||0;let S=this.clipRect;if(S&&Array.isArray(S)&&S.length===4)r.uTroikaClipRect.value.fromArray(S);else{const A=(this.fontSize||.1)*100;r.uTroikaClipRect.value.set(d[0]-A,d[1]-A,d[2]+A,d[3]+A)}this.geometry.applyClipRect(r.uTroikaClipRect.value)}r.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const a=n?this.outlineColor||0:this.color;if(a==null)delete e.color;else{const u=e.hasOwnProperty("color")?e.color:e.color=new Ct;(a!==u._input||typeof a=="object")&&u.set(u._input=a)}let l=this.orientation||rx;if(l!==e._orientation){let u=r.uTroikaOrient.value;l=l.replace(/[^-+xyz]/g,"");let d=l!==rx&&l.match(/^([-+])([xyz])([-+])([xyz])$/);if(d){let[,h,f,p,m]=d;V0.set(0,0,0)[f]=h==="-"?1:-1,ix.set(0,0,0)[m]=p==="-"?-1:1,Xk.lookAt(m7,V0.cross(ix),ix),u.setFromMatrix4(Xk)}else u.identity();e._orientation=l}}_parsePercent(e){if(typeof e=="string"){let n=e.match(/^(-?[\d.]+)%$/),r=n?parseFloat(n[1]):NaN;e=(isNaN(r)?0:r/100)*this.fontSize}return e}localPositionToTextCoords(e,n=new mt){n.copy(e);const r=this.curveRadius;return r&&(n.x=Math.atan2(e.x,Math.abs(r)-Math.abs(e.z))*Math.abs(r)),n}worldPositionToTextCoords(e,n=new mt){return V0.copy(e),this.localPositionToTextCoords(this.worldToLocal(V0),n)}raycast(e,n){const{textRenderInfo:r,curveRadius:s}=this;if(r){const a=r.blockBounds,l=s?h2():u2(),u=l.geometry,{position:d,uv:h}=u.attributes;for(let f=0;f<h.count;f++){let p=a[0]+h.getX(f)*(a[2]-a[0]);const m=a[1]+h.getY(f)*(a[3]-a[1]);let T=0;s&&(T=s-Math.cos(p/s)*s,p=Math.sin(p/s)*s),d.setXYZ(f,p,m,T)}u.boundingSphere=this.geometry.boundingSphere,u.boundingBox=this.geometry.boundingBox,l.matrixWorld=this.matrixWorld,l.material.side=this.material.side,Kv.length=0,l.raycast(e,Kv);for(let f=0;f<Kv.length;f++)Kv[f].object=this,n.push(Kv[f])}}copy(e){const n=this.geometry;return super.copy(e),this.geometry=n,v7.forEach(r=>{this[r]=e[r]}),this}clone(){return new this.constructor().copy(this)}};d2.forEach(i=>{const e="_private_"+i;Object.defineProperty(f2.prototype,i,{get(){return this[e]},set(n){n!==this[e]&&(this[e]=n,this._needsSync=!0)}})});const T7=i=>typeof i=="object"&&typeof i.then=="function",z0=[];function E7(i,e,n=(r,s)=>r===s){if(i===e)return!0;if(!i||!e)return!1;const r=i.length;if(e.length!==r)return!1;for(let s=0;s<r;s++)if(!n(i[s],e[s]))return!1;return!0}function y7(i,e=null,n=!1,r={}){e===null&&(e=[i]);for(const a of z0)if(E7(e,a.keys,a.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(a,"error"))throw a.error;if(Object.prototype.hasOwnProperty.call(a,"response"))return r.lifespan&&r.lifespan>0&&(a.timeout&&clearTimeout(a.timeout),a.timeout=setTimeout(a.remove,r.lifespan)),a.response;if(!n)throw a.promise}const s={keys:e,equal:r.equal,remove:()=>{const a=z0.indexOf(s);a!==-1&&z0.splice(a,1)},promise:(T7(i)?i:i(...e)).then(a=>{s.response=a,r.lifespan&&r.lifespan>0&&(s.timeout=setTimeout(s.remove,r.lifespan))}).catch(a=>s.error=a)};if(z0.push(s),!n)throw s.promise}const S7=(i,e,n)=>y7(i,e,!1,n),ji=q.forwardRef(({sdfGlyphSize:i=64,anchorX:e="center",anchorY:n="middle",font:r,fontSize:s=1,children:a,characters:l,onSync:u,...d},h)=>{const f=$n(({invalidate:E})=>E),[p]=q.useState(()=>new f2),[m,T]=q.useMemo(()=>{const E=[];let b="";return q.Children.forEach(a,y=>{typeof y=="string"||typeof y=="number"?b+=y:E.push(y)}),[E,b]},[a]);return S7(()=>new Promise(E=>n7({font:r,characters:l},E)),["troika-text",r,l]),q.useLayoutEffect(()=>void p.sync(()=>{f(),u&&u(p)})),q.useEffect(()=>()=>p.dispose(),[p]),q.createElement("primitive",Dl({object:p,ref:h,font:r,text:T,anchorX:e,anchorY:n,fontSize:s,sdfGlyphSize:i},d),m)});let W0=null,p2="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function m2(i=!0,e=!0,n){return r=>{n&&n(r),i&&(W0||(W0=new TK),W0.setDecoderPath(typeof i=="string"?i:p2),r.setDRACOLoader(W0)),e&&r.setMeshoptDecoder(typeof ex=="function"?ex():ex)}}const Cs=(i,e,n,r)=>Nu(ZM,i,m2(e,n,r));Cs.preload=(i,e,n,r)=>Nu.preload(ZM,i,m2(e,n,r));Cs.clear=i=>Nu.clear(ZM,i);Cs.setDecoderPath=i=>{p2=i};const No=q.forwardRef(({makeDefault:i,camera:e,regress:n,domElement:r,enableDamping:s=!0,keyEvents:a=!1,onChange:l,onStart:u,onEnd:d,...h},f)=>{const p=$n(O=>O.invalidate),m=$n(O=>O.camera),T=$n(O=>O.gl),E=$n(O=>O.events),b=$n(O=>O.setEvents),y=$n(O=>O.set),S=$n(O=>O.get),A=$n(O=>O.performance),C=e||m,R=r||E.connected||T.domElement,I=q.useMemo(()=>new kY(C),[C]);return PE(()=>{I.enabled&&I.update()},-1),q.useEffect(()=>(a&&I.connect(a===!0?R:a),I.connect(R),()=>void I.dispose()),[a,R,n,I,p]),q.useEffect(()=>{const O=D=>{p(),n&&A.regress(),l&&l(D)},F=D=>{u&&u(D)},k=D=>{d&&d(D)};return I.addEventListener("change",O),I.addEventListener("start",F),I.addEventListener("end",k),()=>{I.removeEventListener("start",F),I.removeEventListener("end",k),I.removeEventListener("change",O)}},[l,u,d,I,p,b]),q.useEffect(()=>{if(i){const O=S().controls;return y({controls:I}),()=>y({controls:O})}},[i,I]),q.createElement("primitive",Dl({ref:f,object:I,enableDamping:s},h))}),$7=3e3,b7=3001,g2=(i,e,n)=>{let r;switch(i){case la:r=new Uint8ClampedArray(e*n*4);break;case ss:r=new Uint16Array(e*n*4);break;case Sc:r=new Uint32Array(e*n*4);break;case sM:r=new Int8Array(e*n*4);break;case oM:r=new Int16Array(e*n*4);break;case C$:r=new Int32Array(e*n*4);break;case Kr:r=new Float32Array(e*n*4);break;default:throw new Error("Unsupported data type")}return r};let X0;const A7=(i,e,n,r)=>{if(X0!==void 0)return X0;const s=new da(1,1,r);e.setRenderTarget(s);const a=new Pn(new Bl,new ii({color:16777215}));e.render(a,n),e.setRenderTarget(null);const l=g2(i,s.width,s.height);return e.readRenderTargetPixels(s,0,0,s.width,s.height,l),s.dispose(),a.geometry.dispose(),a.material.dispose(),X0=l[0]!==0,X0};class tI{constructor(e){var n,r,s,a,l,u,d,h,f,p,m,T,E,b,y,S;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(C){throw this._renderer.setRenderTarget(null),C}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const A={format:jr,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((n=e.renderTargetOptions)===null||n===void 0?void 0:n.anisotropy)!==void 0?(r=e.renderTargetOptions)===null||r===void 0?void 0:r.anisotropy:1,generateMipmaps:((s=e.renderTargetOptions)===null||s===void 0?void 0:s.generateMipmaps)!==void 0?(a=e.renderTargetOptions)===null||a===void 0?void 0:a.generateMipmaps:!1,magFilter:((l=e.renderTargetOptions)===null||l===void 0?void 0:l.magFilter)!==void 0?(u=e.renderTargetOptions)===null||u===void 0?void 0:u.magFilter:Gn,minFilter:((d=e.renderTargetOptions)===null||d===void 0?void 0:d.minFilter)!==void 0?(h=e.renderTargetOptions)===null||h===void 0?void 0:h.minFilter:Gn,samples:((f=e.renderTargetOptions)===null||f===void 0?void 0:f.samples)!==void 0?(p=e.renderTargetOptions)===null||p===void 0?void 0:p.samples:void 0,wrapS:((m=e.renderTargetOptions)===null||m===void 0?void 0:m.wrapS)!==void 0?(T=e.renderTargetOptions)===null||T===void 0?void 0:T.wrapS:Pi,wrapT:((E=e.renderTargetOptions)===null||E===void 0?void 0:E.wrapT)!==void 0?(b=e.renderTargetOptions)===null||b===void 0?void 0:b.wrapT:Pi};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=tI.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new jg,this._camera=new ua,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!A7(this._type,this._renderer,this._camera,A)){let C;switch(this._type){case ss:C=this._renderer.extensions.has("EXT_color_buffer_float")?Kr:void 0;break}C!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Kr}`),this._type=C):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Pn(new Bl,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new da(this.width,this.height,A),this._renderTarget.texture.mapping=((y=e.renderTargetOptions)===null||y===void 0?void 0:y.mapping)!==void 0?(S=e.renderTargetOptions)===null||S===void 0?void 0:S.mapping:od}static instantiateRenderer(){const e=new N$;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=g2(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const n=new ap(this.toArray(),this.width,this.height,jr,this._type,(e==null?void 0:e.mapping)||od,(e==null?void 0:e.wrapS)||Pi,(e==null?void 0:e.wrapT)||Pi,(e==null?void 0:e.magFilter)||Gn,(e==null?void 0:e.minFilter)||Gn,(e==null?void 0:e.anisotropy)||1,Io);return n.generateMipmaps=(e==null?void 0:e.generateMipmaps)!==void 0?e==null?void 0:e.generateMipmaps:!1,n}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof Oo&&Object.values(this.material.uniforms).forEach(n=>{n.value instanceof ni&&n.value.dispose()}),Object.values(this.material).forEach(n=>{n instanceof ni&&n.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const C7=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,x7=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class R7 extends Oo{constructor({gamma:e,offsetHdr:n,offsetSdr:r,gainMapMin:s,gainMapMax:a,maxDisplayBoost:l,hdrCapacityMin:u,hdrCapacityMax:d,sdr:h,gainMap:f}){super({name:"GainMapDecoderMaterial",vertexShader:C7,fragmentShader:x7,uniforms:{sdr:{value:h},gainMap:{value:f},gamma:{value:new te(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new te().fromArray(n)},offsetSdr:{value:new te().fromArray(r)},gainMapMin:{value:new te().fromArray(s)},gainMapMax:{value:new te().fromArray(a)},weightFactor:{value:(Math.log2(l)-u)/(d-u)}},blending:Cc,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=l,this._hdrCapacityMin=u,this._hdrCapacityMax=d,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const n=this.uniforms.gamma.value;n.x=1/e[0],n.y=1/e[1],n.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class _2 extends Error{}class v2 extends Error{}const Jv=(i,e,n)=>{var r;let s;const a=(r=i.attributes.getNamedItem(e))===null||r===void 0?void 0:r.nodeValue;if(a)s=a;else{const l=i.getElementsByTagName(e)[0];if(l){const u=l.getElementsByTagName("rdf:li");if(u.length===3)s=Array.from(u).map(d=>d.innerHTML);else throw new Error(`Gainmap metadata contains an array of items for ${e} but its length is not 3`)}else{if(n)return n;throw new Error(`Can't find ${e} in gainmap metadata`)}}return s},w7=i=>{var e,n;let r;typeof TextDecoder<"u"?r=new TextDecoder().decode(i):r=i.toString();let s=r.indexOf("<x:xmpmeta");const a=new DOMParser;for(;s!==-1;){const l=r.indexOf("x:xmpmeta>",s);r.slice(s,l+10);const u=r.slice(s,l+10);try{const h=a.parseFromString(u,"text/xml").getElementsByTagName("rdf:Description")[0],f=Jv(h,"hdrgm:GainMapMin","0"),p=Jv(h,"hdrgm:GainMapMax"),m=Jv(h,"hdrgm:Gamma","1"),T=Jv(h,"hdrgm:OffsetSDR","0.015625"),E=Jv(h,"hdrgm:OffsetHDR","0.015625");let b=(e=h.attributes.getNamedItem("hdrgm:HDRCapacityMin"))===null||e===void 0?void 0:e.nodeValue;b||(b="0");const y=(n=h.attributes.getNamedItem("hdrgm:HDRCapacityMax"))===null||n===void 0?void 0:n.nodeValue;if(!y)throw new Error("Incomplete gainmap metadata");return{gainMapMin:Array.isArray(f)?f.map(S=>parseFloat(S)):[parseFloat(f),parseFloat(f),parseFloat(f)],gainMapMax:Array.isArray(p)?p.map(S=>parseFloat(S)):[parseFloat(p),parseFloat(p),parseFloat(p)],gamma:Array.isArray(m)?m.map(S=>parseFloat(S)):[parseFloat(m),parseFloat(m),parseFloat(m)],offsetSdr:Array.isArray(T)?T.map(S=>parseFloat(S)):[parseFloat(T),parseFloat(T),parseFloat(T)],offsetHdr:Array.isArray(E)?E.map(S=>parseFloat(S)):[parseFloat(E),parseFloat(E),parseFloat(E)],hdrCapacityMin:parseFloat(b),hdrCapacityMax:parseFloat(y)}}catch{}s=r.indexOf("<x:xmpmeta",l)}};class M7{constructor(e){this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((n,r)=>{const s=this.options.debug,a=new DataView(e.buffer);if(a.getUint16(0)!==65496){r(new Error("Not a valid jpeg"));return}const l=a.byteLength;let u=2,d=0,h;for(;u<l;){if(++d>250){r(new Error(`Found no marker after ${d} loops 😵`));return}if(a.getUint8(u)!==255){r(new Error(`Not a valid marker at offset 0x${u.toString(16)}, found: 0x${a.getUint8(u).toString(16)}`));return}if(h=a.getUint8(u+1),s&&console.log(`Marker: ${h.toString(16)}`),h===226){s&&console.log("Found APP2 marker (0xffe2)");const f=u+4;if(a.getUint32(f)===1297106432){const p=f+4;let m;if(a.getUint16(p)===18761)m=!1;else if(a.getUint16(p)===19789)m=!0;else{r(new Error("No valid endianness marker found in TIFF header"));return}if(a.getUint16(p+2,!m)!==42){r(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const T=a.getUint32(p+4,!m);if(T<8){r(new Error("Not valid TIFF data! (First offset less than 8)"));return}const E=p+T,b=a.getUint16(E,!m),y=E+2;let S=0;for(let I=y;I<y+12*b;I+=12)a.getUint16(I,!m)===45057&&(S=a.getUint32(I+8,!m));const A=4,C=E+2+b*12+A,R=[];for(let I=C;I<C+S*16;I+=16){const O={MPType:a.getUint32(I,!m),size:a.getUint32(I+4,!m),dataOffset:a.getUint32(I+8,!m),dependantImages:a.getUint32(I+12,!m),start:-1,end:-1,isFII:!1};O.dataOffset?(O.start=p+O.dataOffset,O.isFII=!1):(O.start=0,O.isFII=!0),O.end=O.start+O.size,R.push(O)}if(this.options.extractNonFII&&R.length){const I=new Blob([a]),O=[];for(const F of R){if(F.isFII&&!this.options.extractFII)continue;const k=I.slice(F.start,F.end+1,"image/jpeg");O.push(k)}n(O)}}}u+=2+a.getUint16(u+2)}})}}const I7=async i=>{const e=w7(i);if(!e)throw new v2("Gain map XMP metadata not found");const r=await new M7({extractFII:!0,extractNonFII:!0}).extract(i);if(r.length!==2)throw new _2("Gain map recovery image not found");return{sdr:new Uint8Array(await r[0].arrayBuffer()),gainMap:new Uint8Array(await r[1].arrayBuffer()),metadata:e}},Yk=i=>new Promise((e,n)=>{const r=document.createElement("img");r.onload=()=>{e(r)},r.onerror=s=>{n(s)},r.src=URL.createObjectURL(i)});class T2 extends as{constructor(e,n){super(n),e&&(this._renderer=e),this._internalLoadingManager=new z$}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=new R7({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new ni,sdr:new ni});return new tI({width:16,height:16,type:ss,colorSpace:Io,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,n,r,s){const a=s?new Blob([s],{type:"image/jpeg"}):void 0,l=new Blob([r],{type:"image/jpeg"});let u,d,h=!1;if(typeof createImageBitmap>"u"){const m=await Promise.all([a?Yk(a):Promise.resolve(void 0),Yk(l)]);d=m[0],u=m[1],h=!0}else{const m=await Promise.all([a?createImageBitmap(a,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(l,{imageOrientation:"flipY"})]);d=m[0],u=m[1]}const f=new ni(d||new ImageData(2,2),od,Pi,Pi,Gn,hR,jr,la,1,Io);f.flipY=h,f.needsUpdate=!0;const p=new ni(u,od,Pi,Pi,Gn,hR,jr,la,1,Tn);p.flipY=h,p.needsUpdate=!0,e.width=u.width,e.height=u.height,e.material.gainMap=f,e.material.sdr=p,e.material.gainMapMin=n.gainMapMin,e.material.gainMapMax=n.gainMapMax,e.material.offsetHdr=n.offsetHdr,e.material.offsetSdr=n.offsetSdr,e.material.gamma=n.gamma,e.material.hdrCapacityMin=n.hdrCapacityMin,e.material.hdrCapacityMax=n.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,n.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}}class O7 extends T2{load([e,n,r],s,a,l){const u=this.prepareQuadRenderer();let d,h,f;const p=async()=>{if(d&&h&&f){try{await this.render(u,f,d,h)}catch(D){this.manager.itemError(e),this.manager.itemError(n),this.manager.itemError(r),typeof l=="function"&&l(D),u.disposeOnDemandRenderer();return}typeof s=="function"&&s(u),this.manager.itemEnd(e),this.manager.itemEnd(n),this.manager.itemEnd(r),u.disposeOnDemandRenderer()}};let m=!0,T=0,E=0,b=!0,y=0,S=0,A=!0,C=0,R=0;const I=()=>{if(typeof a=="function"){const D=T+y+C,U=E+S+R,ce=m&&b&&A;a(new ProgressEvent("progress",{lengthComputable:ce,loaded:U,total:D}))}};this.manager.itemStart(e),this.manager.itemStart(n),this.manager.itemStart(r);const O=new Lr(this._internalLoadingManager);O.setResponseType("arraybuffer"),O.setRequestHeader(this.requestHeader),O.setPath(this.path),O.setWithCredentials(this.withCredentials),O.load(e,async D=>{if(typeof D=="string")throw new Error("Invalid sdr buffer");d=D,await p()},D=>{m=D.lengthComputable,E=D.loaded,T=D.total,I()},D=>{this.manager.itemError(e),typeof l=="function"&&l(D)});const F=new Lr(this._internalLoadingManager);F.setResponseType("arraybuffer"),F.setRequestHeader(this.requestHeader),F.setPath(this.path),F.setWithCredentials(this.withCredentials),F.load(n,async D=>{if(typeof D=="string")throw new Error("Invalid gainmap buffer");h=D,await p()},D=>{b=D.lengthComputable,S=D.loaded,y=D.total,I()},D=>{this.manager.itemError(n),typeof l=="function"&&l(D)});const k=new Lr(this._internalLoadingManager);return k.setRequestHeader(this.requestHeader),k.setPath(this.path),k.setWithCredentials(this.withCredentials),k.load(r,async D=>{if(typeof D!="string")throw new Error("Invalid metadata string");f=JSON.parse(D),await p()},D=>{A=D.lengthComputable,R=D.loaded,C=D.total,I()},D=>{this.manager.itemError(r),typeof l=="function"&&l(D)}),u}}class L7 extends T2{load(e,n,r,s){const a=this.prepareQuadRenderer(),l=new Lr(this._internalLoadingManager);return l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setPath(this.path),l.setWithCredentials(this.withCredentials),this.manager.itemStart(e),l.load(e,async u=>{if(typeof u=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const d=new Uint8Array(u);let h,f,p;try{const m=await I7(d);h=m.sdr,f=m.gainMap,p=m.metadata}catch(m){if(m instanceof v2||m instanceof _2)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),p={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},h=d;else throw m}try{await this.render(a,p,h,f)}catch(m){this.manager.itemError(e),typeof s=="function"&&s(m),a.disposeOnDemandRenderer();return}typeof n=="function"&&n(a),this.manager.itemEnd(e),a.disposeOnDemandRenderer()},r,u=>{this.manager.itemError(e),typeof s=="function"&&s(u)}),a}}const hE={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},E2="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Ng=i=>Array.isArray(i),nI=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function q$({files:i=nI,path:e="",preset:n=void 0,encoding:r=void 0,extensions:s}={}){let a=null,l=!1;n&&(iI(n),i=hE[n],e=E2),l=Ng(i);const{extension:u,isCubemap:d}=rI(i);if(a=sI(u),!a)throw new Error("useEnvironment: Unrecognized file extension: "+i);const h=$n(T=>T.gl);q.useLayoutEffect(()=>{if(u!=="webp"&&u!=="jpg"&&u!=="jpeg")return;function T(){Nu.clear(a,l?[i]:i)}h.domElement.addEventListener("webglcontextlost",T,{once:!0})},[i,h.domElement]);const f=Nu(a,l?[i]:i,T=>{(u==="webp"||u==="jpg"||u==="jpeg")&&T.setRenderer(h),T.setPath==null||T.setPath(e),s&&s(T)});let p=l?f[0]:f;if(u==="jpg"||u==="jpeg"||u==="webp"){var m;p=(m=p.renderTarget)==null?void 0:m.texture}return p.mapping=d?Ou:Vg,"colorSpace"in p?p.colorSpace=r??d?"srgb":"srgb-linear":p.encoding=r??d?b7:$7,p}const N7={files:nI,path:"",preset:void 0,extensions:void 0};q$.preload=i=>{const e={...N7,...i};let{files:n,path:r=""}=e;const{preset:s,extensions:a}=e;s&&(iI(s),n=hE[s],r=E2);const{extension:l}=rI(n);if(l==="webp"||l==="jpg"||l==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const u=sI(l);if(!u)throw new Error("useEnvironment: Unrecognized file extension: "+n);Nu.preload(u,Ng(n)?[n]:n,d=>{d.setPath==null||d.setPath(r),a&&a(d)})};const k7={files:nI,preset:void 0};q$.clear=i=>{const e={...k7,...i};let{files:n}=e;const{preset:r}=e;r&&(iI(r),n=hE[r]);const{extension:s}=rI(n),a=sI(s);if(!a)throw new Error("useEnvironment: Unrecognized file extension: "+n);Nu.clear(a,Ng(n)?[n]:n)};function iI(i){if(!(i in hE))throw new Error("Preset must be one of: "+Object.keys(hE).join(", "))}function rI(i){var e;const n=Ng(i)&&i.length===6,r=Ng(i)&&i.length===3&&i.some(l=>l.endsWith("json")),s=Ng(i)?i[0]:i;return{extension:n?"cube":r?"webp":s.startsWith("data:application/exr")?"exr":s.startsWith("data:application/hdr")?"hdr":s.startsWith("data:image/jpeg")?"jpg":(e=s.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase(),isCubemap:n,isGainmap:r}}function sI(i){return i==="cube"?aU:i==="hdr"?_K:i==="exr"?vK:i==="jpg"||i==="jpeg"?L7:i==="webp"?O7:null}const P7=i=>i.current&&i.current.isScene,D7=i=>P7(i)?i.current:i;function oI(i,e,n,r,s={}){var a,l,u,d,h;s={backgroundBlurriness:(a=s.blur)!==null&&a!==void 0?a:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...s};const f=D7(e||n),p=f.background,m=f.environment,T={backgroundBlurriness:f.backgroundBlurriness,backgroundIntensity:f.backgroundIntensity,backgroundRotation:(l=(u=f.backgroundRotation)==null||u.clone==null?void 0:u.clone())!==null&&l!==void 0?l:[0,0,0],environmentIntensity:f.environmentIntensity,environmentRotation:(d=(h=f.environmentRotation)==null||h.clone==null?void 0:h.clone())!==null&&d!==void 0?d:[0,0,0]};return i!=="only"&&(f.environment=r),i&&(f.background=r),Hf(f,s),()=>{i!=="only"&&(f.environment=m),i&&(f.background=p),Hf(f,T)}}function aI({scene:i,background:e=!1,map:n,...r}){const s=$n(a=>a.scene);return q.useLayoutEffect(()=>{if(n)return oI(e,i,s,n,r)}),null}function y2({background:i=!1,scene:e,blur:n,backgroundBlurriness:r,backgroundIntensity:s,backgroundRotation:a,environmentIntensity:l,environmentRotation:u,...d}){const h=q$(d),f=$n(p=>p.scene);return q.useLayoutEffect(()=>oI(i,e,f,h,{blur:n,backgroundBlurriness:r,backgroundIntensity:s,backgroundRotation:a,environmentIntensity:l,environmentRotation:u})),null}function B7({children:i,near:e=1,far:n=1e3,resolution:r=256,frames:s=1,map:a,background:l=!1,blur:u,backgroundBlurriness:d,backgroundIntensity:h,backgroundRotation:f,environmentIntensity:p,environmentRotation:m,scene:T,files:E,path:b,preset:y=void 0,extensions:S}){const A=$n(k=>k.gl),C=$n(k=>k.scene),R=q.useRef(null),[I]=q.useState(()=>new jg),O=q.useMemo(()=>{const k=new SM(r);return k.texture.type=ss,k},[r]);q.useLayoutEffect(()=>(s===1&&R.current.update(A,I),oI(l,T,C,O.texture,{blur:u,backgroundBlurriness:d,backgroundIntensity:h,backgroundRotation:f,environmentIntensity:p,environmentRotation:m})),[i,I,O.texture,T,C,l,s,A]);let F=1;return PE(()=>{(s===1/0||F<s)&&(R.current.update(A,I),F++)}),q.createElement(q.Fragment,null,H9(q.createElement(q.Fragment,null,i,q.createElement("cubeCamera",{ref:R,args:[e,n,O]}),E||y?q.createElement(y2,{background:!0,files:E,preset:y,path:b,extensions:S}):a?q.createElement(aI,{background:!0,map:a,extensions:S}):null),I))}function F7(i){var e,n,r,s;const a=q$(i),l=i.map||a;q.useMemo(()=>CU({GroundProjectedEnvImpl:IY}),[]);const u=q.useMemo(()=>[l],[l]),d=(e=i.ground)==null?void 0:e.height,h=(n=i.ground)==null?void 0:n.radius,f=(r=(s=i.ground)==null?void 0:s.scale)!==null&&r!==void 0?r:1e3;return q.createElement(q.Fragment,null,q.createElement(aI,Dl({},i,{map:l})),q.createElement("groundProjectedEnvImpl",{args:u,scale:f,height:d,radius:h}))}function ko(i){return i.ground?q.createElement(F7,i):i.map?q.createElement(aI,i):i.children?q.createElement(B7,i):q.createElement(y2,i)}function U7(i){return{all:i=i||new Map,on:function(e,n){var r=i.get(e);r?r.push(n):i.set(e,[n])},off:function(e,n){var r=i.get(e);r&&(n?r.splice(r.indexOf(n)>>>0,1):i.set(e,[]))},emit:function(e,n){var r=i.get(e);r&&r.slice().map(function(s){s(n)}),(r=i.get("*"))&&r.slice().map(function(s){s(e,n)})}}}const Tt=U7(),j0=2.54,sx=1,G7="INCHES",H7="RESET",po=cw.forwardRef(({mouseControlEnabled:i,measurementViewEnabled:e,droneScale:n,cameraOffset:r,lineColor:s,flyerText:a,droneSpeed:l=.033333333332},u)=>{const d=q.useMemo(()=>Cs("assets/models/drone.glb"),[]),h=u||q.useRef(),f=q.useRef(new te(0,0,0)),p=q.useRef({w:!1,a:!1,s:!1,d:!1,u:!1,p:!1,t:!1}),{camera:m}=$n(),[T,E]=q.useState([new te(0,0,0)]),[b,y]=q.useState(!1),[S,A]=q.useState(!1),C=.033333333332,R=(he,[ue,Te])=>{const _e=he.clone();return new Promise(Re=>{const De=()=>{if(!h.current)return Re();const et=h.current.position.clone(),Ue=_e.clone().sub(et).normalize(),Le=l,re=et.add(Ue.multiplyScalar(Le));h.current.position.copy(re),re.distanceTo(_e)>Le?requestAnimationFrame(De):Re()};De()})},I=async([he,ue])=>{await ae("z",[he,ue],1)},O=async([he,ue])=>{await ae("z",[he+sx,ue],-1)},F=async([he,ue])=>{await ae("x",[he,ue],1)},k=async([he,ue])=>{await ae("x",[he+sx,ue],-1)},D=async([he,ue])=>{await ae("y",[he,ue],1)},U=async([he,ue])=>{if(he==-1/0)if(ue.split(",")[1]!=null){const _e=ue.split(",")[1];await pe([h.current.position.x,0,h.current.position.z,"CM"]),J([parseInt(_e),!0])}else await pe([h.current.position.x,0,h.current.position.z,"CM"]);else await ae("y",[he+sx,ue],-1)},ce=async he=>{await pe(he)},ie=async he=>{if(!h.current)return;const[ue]=he;console.log("commanding to flip it",ue),A(!0);const Te=h.current.rotation.clone(),_e=Math.PI*2,et=1*60,Ue=_e/et;let Le=0;const re=()=>{if(Le<et){switch(ue){case"FORWARD":h.current.rotation.x+=Ue;break;case"BACKWARD":h.current.rotation.x-=Ue;break;case"RIGHT":h.current.rotation.z+=Ue;break;case"LEFT":h.current.rotation.z-=Ue;break;default:console.warn("Invalid flip direction"),A(!1);return}Le++,requestAnimationFrame(re)}else h.current.rotation.copy(Te),A(!1),console.log(`${ue} Flip complete`)};re()},ae=async(he,[ue,Te],_e=1)=>{if(!h.current)return;const Re=h.current.position.clone();if(Te==="SECONDS"){const De=new te(he==="x"?_e:0,he==="y"?_e:0,he==="z"?_e:0);ne(De,ue)}else{const De=Te==="INCHES"?ue*j0:ue;Re[he]+=De*_e,await R(new te(Re.x,Re.y,Re.z),[ue,Te])}},ne=(he,ue)=>{const _e=Date.now(),Re=ue*1e3,De=he.clone().applyQuaternion(h.current.quaternion).normalize(),et=()=>{Date.now()-_e<Re?(h.current.position.add(De.clone().multiplyScalar(.075)),requestAnimationFrame(et)):console.log("Movement complete.")};et()},pe=async he=>{let[ue,Te,_e,Re]=he;Re==H7&&E([new te(0,0,0)]),Re===G7&&(ue*=j0,Te*=j0,_e*=j0);const De=new te(ue,Te,_e),et=.05,Ue=()=>{const Le=h.current.position.clone(),re=Le.distanceTo(De);if(re<.01)h.current.position.copy(De);else{const Ye=De.clone().sub(Le).normalize(),Fe=Math.min(re,et);h.current.position.add(Ye.multiplyScalar(Fe)),requestAnimationFrame(Ue)}};Ue()},de=he=>{const[ue,Te,_e,Re]=he,Ue=(Re==="INCHES"?_e*2.54:_e)/100,Le=sp.degToRad(Te);xe(Ue,Le,ue==="CIRCLE_RIGHT"||ue==="ARC_RIGHT")},xe=(he,ue,Te)=>{const _e=h.current.rotation.y,Re=ue/60,De=h.current.position.clone(),et=De.x-he*Math.sin(_e),Ue=De.z-he*Math.cos(_e);let Le=0;const re=()=>{if(Math.abs(Le)>=Math.abs(ue))return;Le+=Re;const Ye=_e+(Te?-Le:Le),Fe=et+he*Math.sin(Ye),Ze=Ue+he*Math.cos(Ye);h.current.position.set(Fe,De.y,Ze),h.current.rotation.y=Ye,requestAnimationFrame(re)};re()},H=he=>new Promise(ue=>setTimeout(ue,he*1e3)),J=async([he,ue])=>{y(!0),await H(he),y(!1),ue&&await R(new te(h.current.position.x,h.current.position.y+5,h.current.position.z),[5,"CM"])},K=he=>{l=C*he},se=async()=>{await R(new te(0,0,0),[5,"CM"]),E([new te(0,0,0)])};q.useEffect(()=>{Tt.on("commandFlyFoward",I),Tt.on("commandFlyBackward",O),Tt.on("commandFlyUp",D),Tt.on("commandFlyDown",U),Tt.on("commandFlyLeft",F),Tt.on("commandFlyRight",k),Tt.on("commandFlyTo",ce),Tt.on("commandRotate",de),Tt.on("resetSimulationEnv",se),Tt.on("commandSetWaitTime",J),Tt.on("commandSetSpeed",K),Tt.on("commandFlip",ie);const he=Te=>{p.current[Te.key]=!0},ue=Te=>{p.current[Te.key]=!1};return window.addEventListener("keydown",he),window.addEventListener("keyup",ue),()=>{Tt.off("commandFlyFoward",I),Tt.off("commandFlyBackward",O),Tt.off("commandFlyLeft",k),Tt.off("commandFlyRight",F),Tt.off("commandFlyUp",D),Tt.off("commandFlyTo",ce),Tt.off("commandRotate",de),Tt.on("resetSimulationEnv",se),Tt.off("commandSetWaitTime",J),Tt.off("commandSetSpeed",K),Tt.off("commandFlip",ie),window.removeEventListener("keydown",he),window.removeEventListener("keyup",ue)}},[p]);const Y=()=>{if(f.current.set(0,0,0),!h.current)return;if(S){m.lookAt(h.current.position);return}const he=new te(0,0,1).applyQuaternion(h.current.quaternion),ue=new te(0,0,-1).applyQuaternion(h.current.quaternion),Te=new te(1,0,0).applyQuaternion(h.current.quaternion),_e=new te(-1,0,0).applyQuaternion(h.current.quaternion);if(p.current.w&&f.current.add(he.multiplyScalar(l)),p.current.s&&f.current.add(ue.multiplyScalar(l)),p.current.a&&f.current.add(Te.multiplyScalar(l)),p.current.d&&f.current.add(_e.multiplyScalar(l)),p.current.z&&(h.current.rotation.y+=sp.degToRad(1)),p.current.c&&(h.current.rotation.y-=sp.degToRad(1)),p.current.u&&(f.current.y+=l),p.current.p&&(f.current.y-=l),h.current.position.add(f.current),!i&&!e){const[De,et,Ue]=r,Le=new te(De,et,Ue);Le.applyQuaternion(h.current.quaternion),m.position.copy(h.current.position.clone().add(Le)),m.lookAt(h.current.position)}const Re=h.current.position.clone();E(De=>[...De,Re])};return PE(()=>{h.current&&Y()}),G.jsxs(G.Fragment,{children:[G.jsx("mesh",{ref:h,children:G.jsx("primitive",{object:d.scene,position:[0,0,0],scale:n})}),a&&G.jsxs(G.Fragment,{children:[G.jsxs("mesh",{position:[0,-.4,0],children:[G.jsx("planeGeometry",{args:[100,10]}),G.jsx("meshBasicMaterial",{color:"white",side:Ss})]}),G.jsxs(ji,{position:[0,0,1],fontSize:5,color:"black",anchorX:"center",anchorY:"middle",children:[" ",a," "]})]}),G.jsx(n2,{points:T,color:s,lineWidth:3})]})});po.propTypes={mouseControlEnabled:Xt.bool,measurementViewEnabled:Xt.bool,droneScale:Xt.number,cameraOffset:Xt.arrayOf(Xt.number),lineColor:Xt.string,droneSpeed:Xt.number,flyerText:Xt.string};class Po extends r_{constructor(e,n={}){const r=n.font;if(r===void 0)super();else{const s=r.generateShapes(e,n.size);n.depth=n.height!==void 0?n.height:50,n.bevelThickness===void 0&&(n.bevelThickness=10),n.bevelSize===void 0&&(n.bevelSize=8),n.bevelEnabled===void 0&&(n.bevelEnabled=!1),super(s,n)}this.type="TextGeometry"}}class Do extends as{constructor(e){super(e)}load(e,n,r,s){const a=this,l=new Lr(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(u){const d=a.parse(JSON.parse(u));n&&n(d)},r,s)}parse(e){return new V7(e)}}class V7{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,n=100){const r=[],s=z7(e,n,this.data);for(let a=0,l=s.length;a<l;a++)r.push(...s[a].toShapes());return r}}function z7(i,e,n){const r=Array.from(i),s=e/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*s,l=[];let u=0,d=0;for(let h=0;h<r.length;h++){const f=r[h];if(f===`
`)u=0,d-=a;else{const p=W7(f,s,u,d,n);u+=p.offsetX,l.push(p.path)}}return l}function W7(i,e,n,r,s){const a=s.glyphs[i]||s.glyphs["?"];if(!a){console.error('THREE.Font: character "'+i+'" does not exists in font family '+s.familyName+".");return}const l=new vU;let u,d,h,f,p,m,T,E;if(a.o){const b=a._cachedOutline||(a._cachedOutline=a.o.split(" "));for(let y=0,S=b.length;y<S;)switch(b[y++]){case"m":u=b[y++]*e+n,d=b[y++]*e+r,l.moveTo(u,d);break;case"l":u=b[y++]*e+n,d=b[y++]*e+r,l.lineTo(u,d);break;case"q":h=b[y++]*e+n,f=b[y++]*e+r,p=b[y++]*e+n,m=b[y++]*e+r,l.quadraticCurveTo(p,m,h,f);break;case"b":h=b[y++]*e+n,f=b[y++]*e+r,p=b[y++]*e+n,m=b[y++]*e+r,T=b[y++]*e+n,E=b[y++]*e+r,l.bezierCurveTo(p,m,T,E,h,f);break}}return{offsetX:a.ha*e,path:l}}const X7=new Do;let S2,KS,Y0=null,j7="white",Y7="black",K7="yellow",J7="white",Z7="lightgreen",q7="black";const Q7=({measurementViewEnabled:i})=>{const{camera:e,gl:n,scene:r}=$n(),s=q.useRef();return q.useEffect(()=>{i?(e.position.set(0,10,0),e.lookAt(new te(0,5,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI/2,s.current.minPolarAngle=Math.PI/2,s.current.enableRotate=!1)):(e.position.set(50,50,50),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI,s.current.minPolarAngle=0,s.current.enableRotate=!0)),S2=e,KS=r},[i,e]),G.jsx(G.Fragment,{children:!i&&G.jsx(No,{ref:s,args:[e,n.domElement]})})},eJ=({position:i})=>G.jsxs("mesh",{position:i,children:[G.jsx("sphereGeometry",{args:[.1,4,4]}),G.jsx("meshStandardMaterial",{color:Y7})]}),tJ=(i,e,n,r)=>{if(n){const s=i.target.getBoundingClientRect(),a=(i.clientX-s.left)/s.width*2-1,l=-((i.clientY-s.top)/s.height)*2+1,u=new te(a,l,.5),d=new As;d.setFromCamera(u,S2);const h=d.intersectObject(KS,!0);if(h.length>0){const f=h[0].point;e(y=>[...y,f]),Y0==null&&(Y0=r.current.position.clone());const p=[Y0,f],m=new rn().setFromPoints(p),T=new fi({color:j7}),E=new Ki(m,T);KS.add(E),Y0.copy(f);const b=`X: ${f.x.toFixed(2)} cm, Y: ${f.y.toFixed(2)} cm, Z: ${f.z.toFixed(2)} cm`;nJ(b,f)}}},nJ=(i,e)=>{X7.load("assets/helvetiker_regular.typeface.json",n=>{const r=new Po(i,{font:n,size:.2,height:.01,curveSegments:1,bevelEnabled:!1,bevelThickness:0,bevelSize:.02,bevelSegments:1}),s=new ii({color:q7}),a=new Pn(r,s);console.log(e),a.position.set(e.x,e.y+1,e.z),a.rotation.x=-Math.PI/2,KS.add(a)},void 0,n=>{console.error("An error occurred loading the font:",n)})},iJ=()=>{const i=q.useRef(),e=13;return G.jsxs(G.Fragment,{children:[G.jsxs("mesh",{ref:i,rotation:[-Math.PI/2,0,0],position:[0,-2,0],children:[G.jsx("planeGeometry",{args:[e,e]}),G.jsx("meshStandardMaterial",{color:Z7,roughness:.9})]}),G.jsx(K0,{position:[-e/2,-2,-e/2]})," ",G.jsx(K0,{position:[e/2,-2,-e/2]}),"  ",G.jsx(K0,{position:[-e/2,-2,e/2]}),"  ",G.jsx(K0,{position:[e/2,-2,e/2]}),"   "]})},K0=({position:i})=>G.jsxs("mesh",{position:i,children:[G.jsx("boxGeometry",{args:[1,.1,1]}),G.jsx("meshStandardMaterial",{color:J7})]}),rJ=()=>{const{gl:i}=$n(),e=()=>{const n=i.domElement.toDataURL("image/png"),r=new Date().toISOString().replace(/[:.]/g,"-"),s=document.createElement("a");s.href=n,s.download=`slate_${r}.png`,s.click()};return q.useEffect(()=>{const n=()=>{e()};return Tt.on("commandTakeScreenShot",n),()=>{Tt.off("commandTakeScreenShot",n)}},[]),null},$2=({droneRef:i,measurementViewEnabled:e,mouseControlEnabled:n})=>{const r=q.useRef(),[s,a]=q.useState([]);return G.jsxs(Lo,{shadows:!0,style:{background:"gray"},onClick:l=>tJ(l,a,e,i),children:[G.jsx("ambientLight",{intensity:.4,color:new Ct(0)}),G.jsx(ko,{preset:"sunset",intensity:.5}),G.jsx(iJ,{}),s.map((l,u)=>G.jsx(eJ,{position:l},u)),G.jsx(Q7,{measurementViewEnabled:e}),G.jsx(rJ,{}),G.jsx(po,{ref:i,controlsRef:r,measurementViewEnabled:e,mouseControlEnabled:n,cameraOffset:[0,6,-5],droneScale:.1,lineColor:K7})]})};$2.propTypes={droneRef:Xt.object.isRequired,mouseControlEnabled:Xt.bool,measurementViewEnabled:Xt.bool};var b2={exports:{}},ox={exports:{}},Kk;function lI(){return Kk||(Kk=1,function(i,e){(function(n,r){i.exports=r()})(qf,function(){var n={},r,s,a,l,u,d,h,f,p,m,T,E,b,y,S,A,C,R,I,O,F,k,D,U,ce,ie,ae,ne,pe,de,xe,H,J,K,se,Y,he,ue,Te,_e,Re,De,et,Ue,Le,re,Ye,Fe,Ze,Xe,dt,je,it,Ce,Me,St,oe,ee,W,ot,ze,qe,ut,ft,Ge,$t,L,X,fe,z,Ae,tt,ye,Ie,Be,N,j,ge,we,We,gt,bt,un,an,ei,pi,Ji,Ci,vi,Ti,nn,mi,yr,Z,B,le,ve,me,Se,Ke,Je,at,rt,pt,Ne,It,xt,wt,Ht,Zt,jt,Ot,qt,Ft,ln,Bn,on,bn,tn,Fn,xn,hn,zn,Mn,Kt,An,Sr,xi,mn,ls,Ys,xs,hi,Rs,dn,kr,jn,Qr,Pr,ti,sn,Ei,cs,Vi,Gl,Dr,ai,ws,Za,mr,qa,Ri,Ii,_o,Hl,$r,or,Ks,gr,ma,Vl,Br,Bo,vo,Js,Oi,Ee,Oe,lt,Et,_n,fn,Qt,yn,li,ci,br,us,Ic,Bp,Fo,ga,Du,Fp,vd,Bu,Up,Fu,Oc,Uo,Gp,Hp,Lc,zl,Wl,Td,Nc,Ms,Zs,Xl,_a,va,jl,kc,Ed,yd,Ar,es,Li,Uu,qs,Vp,Ta,Sd,$d,c_,Gu,Pc,zp,Dc,bd,Wp,u_,To,Hu,Yl,hs,Go,Kl,Qs,Ad,yi,h_,Jl,gi,Cd,xd,Vu,Qa,Is,Eo,wi,Cr,ar,Rd,zu,Wu,d_,Fr,wd,Bc,Xp,Ea,Ho,Zl,ql,Xu,f_,ju,jp,Yu,p_,m_,ya,Fc,Vo,Md,Id,Od,Ku,Ql,Yp,g_,__,Kp,v_,T_,E_,y_,FE,Jp,S_,$_,Zp,Ld,Ju,qp,b_,A_,ec,el,tl,nl,Nd,zo,C_,x_,Wo,R_,Uc,Zu,qu,Gc,w_,Qu,Ur,M_,Qp,ds,xr,I_,O_,L_,N_,il,zt,fs,Zi,Si,Xo,rl,Nt,Di,kd,k_,Pd,eh,P_,Dd,Bd,jo,D_,UE,th,tc,em,kt,Fd,tm,B_,GE,sl,nh,Hc,ih,F_,nm,im,rm,sm,rh,Ud,U_,om,Gd,sh,G_,H_,Hd,eo,V_,Yo,oh,Vd,nc,ah,Vc,zd,Wd,Xd,am,jd,z_,lh,Yd,zi,Rn,qi,Qi,Rr,Os,zc,lr,ch,ic,uh,Kd,Wc,ts,Jd,Zd,ol,rc,qd,al,hh,Sa,dh,Xc,Qd,fh,ph,Gr,$a,Ls,ef,ps,W_,tf,lm,HE,ll,X_,j_,vt;r=function(t,o,c,g){if(!(t instanceof yt)&&typeof t!="string"||`${t}`.trim()==="")throw Error('Invalid type "'+t+'". The type must be a non-empty string or a Blockly.registry.Type.');if(t=`${t}`.toLowerCase(),typeof o!="string"||o.trim()==="")throw Error('Invalid name "'+o+'". The name must be a non-empty string.');const $=o.toLowerCase();if(!c)throw Error("Can not register a null value");let M=Ns[t],Q=nf[t];if(M||(M=Ns[t]=Object.create(null),Q=nf[t]=Object.create(null)),s(t,c),!g&&M[$]&&M[$]!==c)throw Error('Name "'+$+'" with type "'+t+'" already registered.');M[$]=c,Q[$]=o},s=function(t,o){switch(t){case String(yt.FIELD):if(typeof o.fromJson!="function")throw Error('Type "'+t+'" must have a fromJson function')}},a=function(t,o){t=`${t}`.toLowerCase(),o=o.toLowerCase();const c=Ns[t];c&&c[o]?(delete Ns[t][o],delete nf[t][o]):console.warn("Unable to unregister ["+o+"]["+t+"] from the registry.")},l=function(t,o,c){t=`${t}`.toLowerCase(),o=o.toLowerCase();const g=Ns[t];if(!g||!g[o]){if(o="Unable to find ["+o+"]["+t+"] in the registry.",c)throw Error(o+" You must require or register a "+t+" plugin.");return console.warn(o),null}return g[o]},u=function(t,o){return t=`${t}`.toLowerCase(),o=o.toLowerCase(),(t=Ns[t])?!!t[o]:!1},d=function(t,o,c){return l(t,o,c)},h=function(t,o,c){return l(t,o,c)},f=function(t,o,c){t=`${t}`.toLowerCase();var g=Ns[t];if(!g){if(g=`Unable to find [${t}] in the registry.`,c)throw Error(`${g} You must require or register a ${t} plugin.`);return console.warn(g),null}if(!o)return g;t=nf[t],c=Object.create(null);for(const $ of Object.keys(g))c[t[$]]=g[$];return c},p=function(t,o,c){return o=o.plugins[String(t)]||yo,typeof o=="function"?o:d(t,o,c)},m=function(){return"blockly-"+(jc++).toString(36)},T=function(){return K_.genUid()},n.setRecordUndo$$module$build$src$core$events$utils=function(t){Yc=t},E=function(){return Yc},b=function(t){cm.fireInternal(t)},y=function(t){if(R()){if(!Zc.length)try{requestAnimationFrame(()=>{setTimeout(S,0)})}catch{setTimeout(S,0)}Zc.push(t)}},S=function(){var t=A(Zc,!0);Zc.length=0;for(let c=0,g;g=t[c];c++)if(g.workspaceId){var o=U(g.workspaceId);o&&o.fireChangeListener(g)}t=new Set(t.map(c=>c.workspaceId));for(const c of t){if(!c||(t=U(c),!t))continue;t=t.getUndoStack();let g;for(o=t.length;0<o;o--){const $=t[o-1];if($.group==="")break;if(g===void 0)g=$.group;else if($.group!==g)break}g&&o!=t.length-1&&(o=t.splice(o,t.length-o),o=A(o,!0),t.push(...o))}},A=function(t,o){t=t.slice(),o||t.reverse();const c=[],g=Object.create(null);for(let Q=0,be;be=t[Q];Q++)if(!be.isNull()){var $=[be.isUiEvent?rf:be.type,be.blockId,be.workspaceId].join(" "),M=g[$];const nt=M?M.event:null;M?be.type===n.MOVE$$module$build$src$core$events$utils&&M.index===Q-1?($=be,nt.newParentId=$.newParentId,nt.newInputName=$.newInputName,nt.newCoordinate=$.newCoordinate,$.reason&&(nt.reason?($=new Set($.reason.concat(nt.reason)),nt.reason=Array.from($)):nt.reason=$.reason),M.index=Q):be.type===n.CHANGE$$module$build$src$core$events$utils&&be.element===nt.element&&be.name===nt.name?nt.newValue=be.newValue:be.type===Ko?(M=be,nt.viewTop=M.viewTop,nt.viewLeft=M.viewLeft,nt.scale=M.scale,nt.oldScale=M.oldScale):(be.type!==cr||nt.type!==Aa)&&(g[$]={event:be,index:Q},c.push(be)):(g[$]={event:be,index:Q},c.push(be))}t=c.filter(function(Q){return!Q.isNull()}),o||t.reverse();for(let Q=1,be;be=t[Q];Q++)be.type===n.CHANGE$$module$build$src$core$events$utils&&be.element==="mutation"&&t.unshift(t.splice(Q,1)[0]);return t},C=function(){for(let t=0,o;o=Zc[t];t++)o.recordUndo=!1},n.disable$$module$build$src$core$events$utils=function(){Hr++},n.enable$$module$build$src$core$events$utils=function(){Hr--},R=function(){return Hr===0},n.getGroup$$module$build$src$core$events$utils=function(){return ul},n.setGroup$$module$build$src$core$events$utils=function(t){cm.setGroupInternal(t)},I=function(t){ul=typeof t=="boolean"?t?T():"":t},O=function(t){const o=[];t=t.getDescendants(!1);for(let c=0,g;g=t[c];c++)o[c]=g.id;return o},F=function(t,o){const c=k(t.type);if(!c)throw Error("Unknown event type.");return c.fromJson(t,o)},k=function(t){const o=d(yt.EVENT,t);if(!o)throw Error(`Event type ${t} not found in registry.`);return o},D=function(t){if((t.type===n.MOVE$$module$build$src$core$events$utils||t.type===n.CREATE$$module$build$src$core$events$utils)&&t.workspaceId){var o=U(t.workspaceId);if(!t.blockId)throw Error("Encountered a blockEvent without a proper blockId");if(t=o.getBlockById(t.blockId)){const c=Yc;try{Yc=!1;const g=t.getParent();if(g&&!g.hasDisabledReason(sf)){const $=t.getDescendants(!1);for(let M=0,Q;Q=$[M];M++)Q.setDisabledReason(!1,sf)}else if((t.outputConnection||t.previousConnection)&&!o.isDragging())do t.setDisabledReason(!0,sf),t=t.getNextBlock();while(t)}finally{Yc=c}}}},U=function(t){return v[t]||null},ce=function(){const t=[];for(const o in v)t.push(v[o]);return t},ie=function(t){v[t.id]=t},ae=function(t){delete v[t.id]},ne=function(){return x},pe=function(t){x=t},de=function(){return w},n.setSelected$$module$build$src$core$common=function(t){if(w!==t){var o,c,g,$,M,Q,be=new(k(gh))((g=(o=w)==null?void 0:o.id)!=null?g:null,($=t==null?void 0:t.id)!=null?$:null,(Q=(M=t==null?void 0:t.workspace.id)!=null?M:(c=w)==null?void 0:c.workspace.id)!=null?Q:"");b(be);var nt;(nt=w)==null||nt.unselect(),w=t;var Dt;(Dt=w)==null||Dt.select()}},xe=function(){return P},H=function(t){P=t},J=function(t){for(;t.options.parentWorkspace;)t=t.options.parentWorkspace;const o=t.getParentSvg(),c=t.getCachedParentSvgSize();var g=o.parentElement;if(g instanceof HTMLElement){var $=g.offsetWidth;g=g.offsetHeight,c.width!==$&&(o.setAttribute("width",$+"px"),t.setCachedParentSvgSize($,null)),c.height!==g&&(o.setAttribute("height",g+"px"),t.setCachedParentSvgSize(null,g)),t.resize()}},K=function(t,o){const c=Object.create(null),g=t.getDescendants(!0);o&&(t=t.getNextBlock())&&(t=g.indexOf(t),g.splice(t,g.length-t));for(let $=0,M;M=g[$];$++)c[M.type]?c[M.type]++:c[M.type]=1;return c},se=function(t){return function(){this.jsonInit(t)}},Y=function(t){$e.defineBlocksWithJsonArrayInternal(t)},he=function(t){n.defineBlocks$$module$build$src$core$common(n.createBlockDefinitionsFromJsonArray$$module$build$src$core$common(t))},n.createBlockDefinitionsFromJsonArray$$module$build$src$core$common=function(t){const o={};for(let c=0;c<t.length;c++){const g=t[c];if(!g){console.warn(`Block definition #${c} in JSON array is ${g}. Skipping`);continue}const $=g.type;$?o[$]={init:se(g)}:console.warn(`Block definition #${c} in JSON array is missing a type attribute. Skipping.`)}return o},n.defineBlocks$$module$build$src$core$common=function(t){for(const o of Object.keys(t)){const c=t[o];o in ks&&console.warn(`Block definition "${o}" overwrites previous definition.`),ks[o]=c}},ue=function(t,o){Te(),ms=setTimeout(function(){o&&o.handleRightClick(t)},cn)},Te=function(){ms&&(clearTimeout(ms),ms=0)},_e=function(){Jt=null},Re=function(t){return!t.type.startsWith("pointer")||t instanceof PointerEvent&&et(t)},De=function(t){return`${t.pointerId}`},et=function(t){const o=De(t);return Jt?Jt===o:t.type==="pointerdown"?(Jt=o,!0):!1},Ue=function(t,o,c,g,$){function M(be){($||Re(be))&&(c?g.call(c,be):g(be))}const Q=[];if(o in Wi)for(let be=0;be<Wi[o].length;be++){const nt=Wi[o][be];t.addEventListener(nt,M,!1),Q.push([t,nt,M])}else t.addEventListener(o,M,!1),Q.push([t,o,M]);return Q},Le=function(t,o,c,g){function $(Q){c?g.call(c,Q):g(Q)}const M=[];if(o in Wi)for(let Q=0;Q<Wi[o].length;Q++){const be=Wi[o][Q];t.addEventListener(be,$,!1),M.push([t,be,$])}else t.addEventListener(o,$,!1),M.push([t,o,$]);return M},re=function(t){const o=t[t.length-1][2];for(;t.length;){const[c,g,$]=t.pop();c.removeEventListener(g,$,!1)}return o},Ye=function(t){if(t.target instanceof HTMLElement){if(t.target.isContentEditable||t.target.getAttribute("data-is-text-input")==="true")return!0;if(t.target instanceof HTMLInputElement)return t=t.target,t.type==="text"||t.type==="number"||t.type==="email"||t.type==="password"||t.type==="search"||t.type==="tel"||t.type==="url";if(t.target instanceof HTMLTextAreaElement)return!0}return!1},Fe=function(t){return t.ctrlKey&&tb?!0:t.button===2},Ze=function(t,o,c){const g=o.createSVGPoint();return g.x=t.clientX,g.y=t.clientY,c||(c=o.getScreenCTM().inverse()),g.matrixTransform(c)},Xe=function(t){switch(t.deltaMode){default:return{x:t.deltaX,y:t.deltaY};case 1:return{x:t.deltaX*vI,y:t.deltaY*vI};case 2:return{x:t.deltaX*TI,y:t.deltaY*TI}}},dt=function(t,o){return o=t.indexOf(o),o===-1?!1:(t.splice(o,1),!0)},je=function(t){if(nb)throw Error("CSS already injected");ib+=`
`+t},it=function(t,o){nb||(nb=!0,t&&(t=o.replace(/[\\/]$/,""),o=ib.replace(/<<<PATH>>>/g,t),ib="",t=document.createElement("style"),t.id="blockly-common-style",o=document.createTextNode(o),t.appendChild(o),document.head.insertBefore(t,document.head.firstChild)))},Ce=function(t,o,c){t=document.createElementNS(q_,`${t}`);for(const g in o)t.setAttribute(g,`${o[g]}`);return c&&c.appendChild(t),t},Me=function(t,o){return o=o.split(" "),o.every(c=>t.classList.contains(c))?!1:(t.classList.add(...o),!0)},St=function(t,o){t.classList.remove(...o.split(" "))},oe=function(t,o){return o=o.split(" "),o.every(c=>!t.classList.contains(c))?!1:(t.classList.remove(...o),!0)},ee=function(t,o){return t.classList.contains(o)},W=function(t){return t&&t.parentNode?t.parentNode.removeChild(t):null},ot=function(t,o){const c=o.nextSibling;if(o=o.parentNode,!o)throw Error("Reference node has no parent.");c?o.insertBefore(t,c):o.appendChild(t)},ze=function(t,o){t.style.transform=o,t.style["-webkit-transform"]=o},qe=function(){sb++,fl||(fl=Object.create(null))},ut=function(){sb--,sb||(fl=null)},ft=function(t){const o=t.textContent+`
`+t.className.baseVal;let c;if(fl&&(c=fl[o]))return c;try{c=t.getComputedTextLength()}catch{return 8*t.textContent.length}return fl&&(fl[o]=c),c},Ge=function(t,o,c,g){return $t(t,o+"pt",c,g)},$t=function(t,o,c,g){const $=t.textContent;t=$+`
`+t.className.baseVal;var M;return fl&&(M=fl[t])||(zE||(M=document.createElement("canvas"),M.className="blocklyComputeCanvas",document.body.appendChild(M),zE=M.getContext("2d")),zE.font=c+" "+o+" "+g,M=$?zE.measureText($).width:0,fl&&(fl[t]=M)),M},L=function(t,o,c,g){const $=document.createElement("span");$.style.font=c+" "+o+" "+g,$.textContent=t,t=document.createElement("div"),t.style.width="1px",t.style.height="0",o=document.createElement("div"),o.style.display="flex",o.style.position="fixed",o.style.top="0",o.style.left="0",o.appendChild($),o.appendChild(t),document.body.appendChild(o),c={height:0,baseline:0};try{o.style.alignItems="baseline",c.baseline=t.offsetTop-$.offsetTop,o.style.alignItems="flex-end",c.height=t.offsetTop-$.offsetTop}finally{document.body.removeChild(o)}return c},X=function(t){return yI.getSizeInternal(t)},fe=function(t){if(Ae(t,"display")!=="none")return z(t);const o=t.style,c=o.display,g=o.visibility,$=o.position;o.visibility="hidden",o.position="absolute",o.display="inline";const M=t.offsetWidth;return t=t.offsetHeight,o.display=c,o.position=$,o.visibility=g,new Kn(M,t)},z=function(t){return new Kn(t.offsetWidth,t.offsetHeight)},Ae=function(t,o){return t=window.getComputedStyle(t),t[o]||t.getPropertyValue(o)},tt=function(t){const o=new At(0,0);t=t.getBoundingClientRect();var c=document.documentElement;return c=new At(window.pageXOffset||c.scrollLeft,window.pageYOffset||c.scrollTop),o.x=t.left+c.x,o.y=t.top+c.y,o},ye=function(){const t=document.body,o=document.documentElement;return new At(t.scrollLeft||o.scrollLeft,t.scrollTop||o.scrollTop)},Ie=function(t){const o=parseFloat(Ae(t,"borderLeftWidth")),c=parseFloat(Ae(t,"borderRightWidth")),g=parseFloat(Ae(t,"borderTopWidth"));return t=parseFloat(Ae(t,"borderBottomWidth")),new $i(g,t,o,c)},Be=function(t,o,c){t=N(t,o,c),o.scrollLeft=t.x,o.scrollTop=t.y},N=function(t,o,c){var g=tt(t),$=tt(o),M=Ie(o);const Q=g.x-$.x-M.left;return g=g.y-$.y-M.top,$=z(t),t=o.clientWidth-$.width,$=o.clientHeight-$.height,M=o.scrollLeft,o=o.scrollTop,c?(M+=Q-t/2,o+=g-$/2):(M+=Math.min(Q,Math.max(Q-t,0)),o+=Math.min(g,Math.max(g-$,0))),new At(M,o)},j=function(t){const o=new At(0,0);var c=t.x&&t.getAttribute("x");const g=t.y&&t.getAttribute("y");return c&&(o.x=parseInt(c)),g&&(o.y=parseInt(g)),(c=(c=t.getAttribute("transform"))&&c.match(SI))&&(o.x+=Number(c[1]),c[3]&&(o.y+=Number(c[3]))),(t=t.getAttribute("style"))&&t.includes("translate")&&(t=t.match($I))&&(o.x+=Number(t[1]),t[3]&&(o.y+=Number(t[3]))),o},ge=function(t){let o=0,c=0;for(;t;){const g=j(t);if(o+=g.x,c+=g.y,(" "+(t.getAttribute("class")||"")+" ").includes(" injectionDiv "))break;t=t.parentNode}return new At(o,c)},we=function(){const t=ye();return new $i(t.y,document.documentElement.clientHeight+t.y,t.x,document.documentElement.clientWidth+t.x)},We=function(){const t=document.documentElement,o=window;return new At(o.pageXOffset||t.scrollLeft,o.pageYOffset||t.scrollTop)},gt=function(t,o){var c=o.x;o=o.y;const g=t.getInjectionDiv().getBoundingClientRect();return c=new At(c-g.left,o-g.top),o=t.getOriginOffsetInPixels(),At.difference(c,o).scale(1/t.scale)},bt=function(t,o){var c=o.scale(t.scale);o=c.x,c=c.y;const g=t.getInjectionDiv().getBoundingClientRect();return t=t.getOriginOffsetInPixels(),new At(o+g.left+t.x,c+g.top+t.y)},un=function(t){({document:XE=XE,DOMParser:Q_=Q_,XMLSerializer:ev=ev}=t),WE=new Q_,ob=new ev},n.createElement$$module$build$src$core$utils$xml=function(t){return XE.createElementNS(bI,t)},n.createTextNode$$module$build$src$core$utils$xml=function(t){return XE.createTextNode(t)},n.textToDom$$module$build$src$core$utils$xml=function(t){let o=WE.parseFromString(t,"text/xml");if(o&&o.documentElement&&!o.getElementsByTagName("parsererror").length)return o.documentElement;if((o=WE.parseFromString(t,"text/html"))&&o.body.firstChild&&o.body.firstChild.nodeName.toLowerCase()==="xml")return o.body.firstChild;throw Error(`DOMParser was unable to parse: ${t}`)},an=function(t){return ei(ob.serializeToString(t))},ei=function(t){return t.replace(iG,o=>`&#${o.charCodeAt(0)};`)},pi=function(t){return t?((t instanceof Element||typeof t=="string")&&(t=B(t),t=mi(t)),Ji(t),t):null},Ji=function(t){const o=t.kind;if(t=t.contents,o&&o!==AI&&o!==ab)throw Error("Invalid toolbox kind "+o+". Please supply either "+AI+" or "+ab);if(!t)throw Error("Toolbox must have a contents attribute.")},Ci=function(t){return t?t.contents?t.contents:Array.isArray(t)&&0<t.length&&!t[0].nodeType?t:yr(t):[]},vi=function(t){return CI.hasCategoriesInternal(t)},Ti=function(t){if(!t)return!1;const o=t.kind;return o?o===ab:!!t.contents.filter(function(c){return c.kind.toUpperCase()==="CATEGORY"}).length},nn=function(t){return t&&t.contents?!!t.contents.filter(function(o){return o.kind.toUpperCase()==="CATEGORY"}).length:!1},mi=function(t){const o={contents:yr(t)};return t instanceof Node&&Z(t,o),o},yr=function(t){const o=[];let c=t.childNodes;c||(c=t);for(let g=0,$;$=c[g];g++){if(!$.tagName)continue;t={};const M=$.tagName.toUpperCase();t.kind=M,M==="BLOCK"?t.blockxml=$:$.childNodes&&0<$.childNodes.length&&(t.contents=yr($)),Z($,t),o.push(t)}return o},Z=function(t,o){for(let c=0;c<t.attributes.length;c++){const g=t.attributes[c];g.nodeName.includes("css-")?(o.cssconfig=o.cssconfig||{},o.cssconfig[g.nodeName.replace("css-","")]=g.value):o[g.nodeName]=g.value}},B=function(t){let o=null;if(t)if(typeof t=="string"){if(o=n.textToDom$$module$build$src$core$utils$xml(t),o.nodeName.toLowerCase()!=="xml")throw TypeError("Toolbox should be an <xml> document.")}else t instanceof Element&&(o=t);return o},le=function(t,o,c,g,$,M){const Q=M.scrollbar&&M.scrollbar.canScrollVertically();return t.horizontal===hm.LEFT?(c=$.absoluteMetrics.left+c,Q&&M.RTL&&(c+=ur.scrollbarThickness)):(c=$.absoluteMetrics.left+$.viewMetrics.width-o.width-c,Q&&!M.RTL&&(c-=ur.scrollbarThickness)),t.vertical===tu.TOP?t=$.absoluteMetrics.top+g:(t=$.absoluteMetrics.top+$.viewMetrics.height-o.height-g,M.scrollbar&&M.scrollbar.canScrollHorizontally()&&(t-=ur.scrollbarThickness)),new $i(t,t+o.height,c,c+o.width)},ve=function(t,o){return{horizontal:o.toolboxMetrics.position===Cn.LEFT||t.horizontalLayout&&!t.RTL?hm.RIGHT:hm.LEFT,vertical:o.toolboxMetrics.position===Cn.BOTTOM?tu.TOP:tu.BOTTOM}},me=function(t,o,c,g){const $=t.left,M=t.right-t.left,Q=t.bottom-t.top;for(let be=0;be<g.length;be++){const nt=g[be];t.intersects(nt)&&(t=c===Sh.UP?nt.top-Q-o:nt.bottom+o,t=new $i(t,t+Q,$,$+M),be=-1)}return t},Se=function(t,o){RI(t,o)},Ke=function(t){RI=t},Je=function(t,o){II.confirmInternal(t,o)},at=function(t,o){wI(t,o)},rt=function(t){wI=t},pt=function(t,o,c){MI(t,o,c)},Ne=function(t){MI=t},It=function(t){return t.getVariableModel!==void 0},xt=function(t){return t.getProcedureDef!==void 0},wt=function(t){return t.getProcedureCall!==void 0&&t.renameProcedure!==void 0},n.allUsedVarModels$$module$build$src$core$variables=function(t){t=t.getAllBlocks(!1);const o=new Set;for(let c=0;c<t.length;c++){const g=t[c].getVarModels();if(g)for(let $=0;$<g.length;$++){const M=g[$];M.getId()&&o.add(M)}}return Array.from(o.values())},n.allDeveloperVariables$$module$build$src$core$variables=function(t){t=t.getAllBlocks(!1);const o=new Set;for(let g=0,$;$=t[g];g++){var c=$.getDeveloperVariables;if(c){c=c();for(let M=0;M<c.length;M++)o.add(c[M])}}return Array.from(o.values())},Ht=function(t){let o=[];const c=document.createElement("button");return c.setAttribute("text","%{BKY_NEW_VARIABLE}"),c.setAttribute("callbackKey","CREATE_VARIABLE"),t.registerButtonCallback("CREATE_VARIABLE",function(g){Ft(g.getTargetWorkspace())}),o.push(c),t=Zt(t),o=o.concat(t)},Zt=function(t){t=t.getVariablesOfType("");const o=[];if(0<t.length){var c=t[t.length-1];if(ks.variables_set){var g=n.createElement$$module$build$src$core$utils$xml("block");g.setAttribute("type","variables_set"),g.setAttribute("gap",ks.math_change?"8":"24"),g.appendChild(xn(c)),o.push(g)}if(ks.math_change&&(g=n.createElement$$module$build$src$core$utils$xml("block"),g.setAttribute("type","math_change"),g.setAttribute("gap",ks.variables_get?"20":"8"),g.appendChild(xn(c)),c=n.textToDom$$module$build$src$core$utils$xml('<value name="DELTA"><shadow type="math_number"><field name="NUM">1</field></shadow></value>'),g.appendChild(c),o.push(g)),ks.variables_get){t.sort(iv.compareByName);for(let $=0,M;M=t[$];$++)c=n.createElement$$module$build$src$core$utils$xml("block"),c.setAttribute("type","variables_get"),c.setAttribute("gap","8"),c.appendChild(xn(M)),o.push(c)}}return o},jt=function(t){return LI.generateUniqueNameInternal(t)},Ot=function(t){return qt(hb.charAt(0),t.getAllVariableNames())},qt=function(t,o){if(!o.length)return t;const c=hb;let g="",$=c.indexOf(t);for(;;){let M=!1;for(let Q=0;Q<o.length;Q++)if(o[Q].toLowerCase()===t){M=!0;break}if(!M)break;$++,$===c.length&&($=0,g=`${Number(g)+1}`),t=c.charAt($)+g}return t},Ft=function(t,o,c){function g(M){ln(n.Msg$$module$build$src$core$msg.NEW_VARIABLE_TITLE,M,function(Q){if(Q){var be=on(Q,t);if(be){if(be.type===$)var nt=n.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS.replace("%1",be.name);else nt=n.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE,nt=nt.replace("%1",be.name).replace("%2",be.type);Se(nt,function(){g(Q)})}else t.createVariable(Q,$),o&&o(Q)}else o&&o(null)})}const $=c||"";g("")},n.renameVariable$$module$build$src$core$variables=function(t,o,c){function g($){const M=n.Msg$$module$build$src$core$msg.RENAME_VARIABLE_TITLE.replace("%1",o.name);ln(M,$,function(Q){if(Q){var be=Bn(Q,o.type,t),nt=bn(o.name,Q,t);if(be||nt){var Dt="";be?Dt=n.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE.replace("%1",be.name).replace("%2",be.type):nt&&(Dt=n.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER.replace("%1",Q).replace("%2",nt)),Se(Dt,function(){g(Q)})}else t.renameVariableById(o.getId(),Q),c&&c(Q)}else c&&c(null)})}g("")},ln=function(t,o,c){pt(t,o,function(g){g&&(g=g.replace(/[\s\xa0]+/g," ").trim(),g===n.Msg$$module$build$src$core$msg.RENAME_VARIABLE||g===n.Msg$$module$build$src$core$msg.NEW_VARIABLE)&&(g=null),c(g)})},Bn=function(t,o,c){c=c.getVariableMap().getAllVariables(),t=t.toLowerCase();for(let g=0,$;$=c[g];g++)if($.name.toLowerCase()===t&&$.type!==o)return $;return null},on=function(t,o){o=o.getVariableMap().getAllVariables(),t=t.toLowerCase();for(let c=0,g;g=o[c];c++)if(g.name.toLowerCase()===t)return g;return null},bn=function(t,o,c){return c.getProcedureMap().getProcedures().length?tn(t,o,c):Fn(t,o,c)},tn=function(t,o,c){t=t.toLowerCase(),o=o.toLowerCase(),c=c.getProcedureMap().getProcedures();for(const $ of c){var g=$.getParameters().filter(It).map(M=>M.getVariableModel().name);if(g&&(c=g.some(M=>M.toLowerCase()===t),g=g.some(M=>M.toLowerCase()===o),c&&g))return $.getName()}return null},Fn=function(t,o,c){t=t.toLowerCase(),o=o.toLowerCase(),c=c.getAllBlocks(!1);for(const $ of c){if(!xt($))continue;c=$.getProcedureDef();var g=c[1];const M=g.some(Q=>Q.toLowerCase()===t);if(g=g.some(Q=>Q.toLowerCase()===o),M&&g)return c[0]}return null},xn=function(t){const o=n.createElement$$module$build$src$core$utils$xml("field");return o.setAttribute("name","VAR"),o.setAttribute("id",t.getId()),o.setAttribute("variabletype",t.type),t=n.createTextNode$$module$build$src$core$utils$xml(t.name),o.appendChild(t),o},n.getOrCreateVariablePackage$$module$build$src$core$variables=function(t,o,c,g){let $=n.getVariable$$module$build$src$core$variables(t,o,c,g);return $||($=hn(t,o,c,g)),$},n.getVariable$$module$build$src$core$variables=function(t,o,c,g){const $=t.getPotentialVariableMap();let M=null;if(o&&(M=t.getVariableById(o),!M&&$&&(M=$.getVariableById(o)),M))return M;if(c){if(g===void 0)throw Error("Tried to look up a variable by name without a type");M=t.getVariable(c,g),!M&&$&&(M=$.getVariable(c,g))}return M},hn=function(t,o,c,g){const $=t.getPotentialVariableMap();return c||(c=jt(t.isFlyout?t.targetWorkspace:t)),$?$.createVariable(c,g,o):t.createVariable(c,g,o)},zn=function(t,o){t=t.getAllVariables();const c=[];if(o.length!==t.length)for(let g=0;g<t.length;g++){const $=t[g];o.includes($)||c.push($)}return c},Mn=function(t){return xi(t),Sr()?(mn(),Promise.resolve()):(dm||(dm=new Promise(o=>{pb=o,NI=window.requestAnimationFrame(()=>{mn(),o()})})),dm)},Kt=function(){return dm||Promise.resolve()},An=function(t){t||window.cancelAnimationFrame(NI),mn(t),!t&&pb&&pb()},Sr=function(){return pI},xi=function(t){db.add(t),fb.set(t,n.getGroup$$module$build$src$core$events$utils());const o=t.getParent();o?xi(o):YE.add(t)},mn=function(t){const o=t?new Set([t]):new Set([...YE].map(M=>M.workspace)),c=[...YE].filter(Ys).filter(M=>o.has(M.workspace));for(var g of c)xs(g);for(const M of o)M.resizeContents();for(var $ of c)g=$.getRelativeToSurfaceXY(),$.updateComponentLocations(g);for(const M of c)$=n.getGroup$$module$build$src$core$events$utils(),(g=fb.get(M))&&n.setGroup$$module$build$src$core$events$utils(g),M.bumpNeighbours(),n.setGroup$$module$build$src$core$events$utils($);for(const M of c)ls(M);t||(dm=null)},ls=function(t){YE.delete(t),db.delete(t),fb.delete(t);for(const o of t.getChildren(!1))ls(o)},Ys=function(t){return!t.isDisposed()&&!t.getParent()},xs=function(t){if(db.has(t)&&t.initialized){for(const o of t.getChildren(!1))xs(o);t.renderEfficiently()}},hi=function(t,o){r(yt.SERIALIZER,t,o)},Rs=function(t){a(yt.SERIALIZER,t)},dn=function(t,{addCoordinates:o=!1,saveIds:c=!0}={}){const g=t.workspace,$=Object.create(null);return $.height=t.getSize().height,$.width=t.getSize().width,c&&($.id=t.id),o&&(o=t.getRelativeToSurfaceXY(),$.x=g.RTL?g.getWidth()-o.x:o.x,$.y=o.y),t.getText()&&($.text=t.getText()),t.isCollapsed()&&($.collapsed=!0),t.isOwnEditable()||($.editable=!1),t.isOwnMovable()||($.movable=!1),t.isOwnDeletable()||($.deletable=!1),$},kr=function(t,o,{recordUndo:c=!1}={}){const g=E();if(n.setRecordUndo$$module$build$src$core$events$utils(c),c=o.newComment(t.id),t.text!==void 0&&c.setText(t.text),t.x!==void 0||t.y!==void 0){const M=c.getRelativeToSurfaceXY();let Q,be=(Q=t.x)!=null?Q:M.x;be=o.RTL?o.getWidth()-be:be;var $;o=($=t.y)!=null?$:M.y,c.moveTo(new At(be,o))}if(t.width!==void 0||t.height){$=c.getSize();let M,Q;c.setSize(new Kn((M=t.width)!=null?M:$.width,(Q=t.height)!=null?Q:$.height))}return t.collapsed!==void 0&&c.setCollapsed(t.collapsed),t.editable!==void 0&&c.setEditable(t.editable),t.movable!==void 0&&c.setMovable(t.movable),t.deletable!==void 0&&c.setDeletable(t.deletable),n.setRecordUndo$$module$build$src$core$events$utils(g),c},jn=function(t,o){r(yt.PASTER,t,o)},Qr=function(t){a(yt.PASTER,t)},Pr=function(t){const o=t.workspace,c=t.getRelativeToSurfaceXY(),g=new At(0,0),$=o.getTopComments(!1).filter(M=>M.id!==t.id).map(M=>M.getRelativeToSurfaceXY());for(;ti(At.sum(c,g),$);)g.translate(o.RTL?-30:30,30);t.moveTo(At.sum(c,g))},ti=function(t,o){return o.some(c=>1>=Math.abs(c.x-t.x)&&1>=Math.abs(c.y-t.y))},sn=function(t,o){t.setAttribute(aG,o)},Ei=function(t,o,c){Array.isArray(c)&&(c=c.join(" ")),t.setAttribute(oG+o,`${c}`)},cs=function(t){return t.saveState!==void 0&&t.loadState!==void 0},Vi=function(t,{addCoordinates:o=!1,addInputBlocks:c=!0,addNextBlocks:g=!0,doFullSerialization:$=!0,saveIds:M=!0}={}){if(t.isInsertionMarker())return null;const Q={type:t.type,id:M?t.id:void 0};return o&&Dr(t,Q),Gl(t,Q),ai(t,Q,$),ws(t,Q,$),Za(t,Q,$),c&&mr(t,Q,$,M),g&&qa(t,Q,$,M),Q},Gl=function(t,o){t.isCollapsed()&&(o.collapsed=!0),t.isEnabled()||(o.disabledReasons=Array.from(t.getDisabledReasons())),t.isOwnDeletable()||(o.deletable=!1),t.isOwnMovable()||(o.movable=!1),t.isOwnEditable()||(o.editable=!1),t.inputsInline!==void 0&&t.inputsInline!==t.inputsInlineDefault&&(o.inline=t.inputsInline),t.data&&(o.data=t.data)},Dr=function(t,o){const c=t.workspace;t=t.getRelativeToSurfaceXY(),o.x=Math.round(c.RTL?c.getWidth()-t.x:t.x),o.y=Math.round(t.y)},ai=function(t,o,c){t.saveExtraState?(t=t.saveExtraState(c),t!==null&&(o.extraState=t)):t.mutationToDom&&(t=t.mutationToDom(),t!==null&&(o.extraState=Vo(t).replace(' xmlns="https://developers.google.com/blockly/xml"',"")))},ws=function(t,o,c){const g=Object.create(null);for(const $ of t.getIcons())cs($)&&(t=$.saveState(c))&&(g[$.getType().toString()]=t);Object.keys(g).length&&(o.icons=g)},Za=function(t,o,c){const g=Object.create(null);for(let $=0;$<t.inputList.length;$++){const M=t.inputList[$];for(let Q=0;Q<M.fieldRow.length;Q++){const be=M.fieldRow[Q];be.isSerializable()&&(g[be.name]=be.saveState(c))}}Object.keys(g).length&&(o.fields=g)},mr=function(t,o,c,g){const $=Object.create(null);for(let M=0;M<t.inputList.length;M++){const Q=t.inputList[M];if(!Q.connection)continue;const be=Ri(Q.connection,c,g);be&&($[Q.name]=be)}Object.keys($).length&&(o.inputs=$)},qa=function(t,o,c,g){t.nextConnection&&(t=Ri(t.nextConnection,c,g))&&(o.next=t)},Ri=function(t,o,c){const g=t.getShadowState(!0);if(t=t.targetBlock(),!g&&!t)return null;const $=Object.create(null);return g&&($.shadow=g),t&&!t.isShadow()&&($.block=Vi(t,{doFullSerialization:o,saveIds:c})),$},Ii=function(t,o,{recordUndo:c=!1}={}){return t=_o(t,o,{recordUndo:c}),o.rendered&&An(),t},_o=function(t,o,{parentConnection:c,isShadow:g=!1,recordUndo:$=!1}={}){const M=E();n.setRecordUndo$$module$build$src$core$events$utils($),($=n.getGroup$$module$build$src$core$events$utils())||n.setGroup$$module$build$src$core$events$utils(!0),n.disable$$module$build$src$core$events$utils();const Q=o.getAllVariables();let be;try{be=Hl(t,o,{parentConnection:c,isShadow:g})}finally{n.enable$$module$build$src$core$events$utils()}if($r(o,Q),R()&&b(new(k(n.CREATE$$module$build$src$core$events$utils))(be)),n.setGroup$$module$build$src$core$events$utils($),n.setRecordUndo$$module$build$src$core$events$utils(M),o.rendered){const nt=be;setTimeout(()=>{nt.disposed||nt.setConnectionTracking(!0)},1)}return be},Hl=function(t,o,{parentConnection:c,isShadow:g=!1}={}){if(!t.type)throw new HI(t);const $=o.newBlock(t.type,t.id);return $.setShadow(g),or($,t),Ks($,t),gr($,t),ma(c,$,t),Vl($,t),Br($,t),Bo($,t),vo($,t),Oi($,o.rendered),$},$r=function(t,o){if(R())for(t=zn(t,o),o=0;o<t.length;o++){const c=t[o];b(new(k(ba))(c))}},or=function(t,o){let c=o.x===void 0?0:o.x;o=o.y===void 0?0:o.y;const g=t.workspace;c=g.RTL?g.getWidth()-c:c,t.moveBy(c,o)},Ks=function(t,o){if(o.collapsed&&t.setCollapsed(!0),o.deletable===!1&&t.setDeletable(!1),o.movable===!1&&t.setMovable(!1),o.editable===!1&&t.setEditable(!1),o.enabled===!1&&t.setDisabledReason(!0,xa),Array.isArray(o.disabledReasons))for(const c of o.disabledReasons)t.setDisabledReason(!0,c);o.inline!==void 0&&t.setInputsInline(o.inline),o.data!==void 0&&(t.data=o.data)},gr=function(t,o){o.extraState&&(t.loadExtraState?t.loadExtraState(o.extraState):t.domToMutation&&t.domToMutation(n.textToDom$$module$build$src$core$utils$xml(o.extraState)))},ma=function(t,o,c){if(t){if(t.getSourceBlock().isShadow()&&!o.isShadow())throw new zI(c);if(t.type===n.inputTypes$$module$build$src$core$inputs$input_types.VALUE){var g=o.outputConnection;if(!g)throw new sv("output",o,c)}else if(g=o.previousConnection,!g)throw new sv("previous",o,c);if(!t.connect(g)){const $=o.workspace.connectionChecker;throw new VI($.getErrorMessage($.canConnectWithReason(g,t,!1),g,t),t.type===n.inputTypes$$module$build$src$core$inputs$input_types.VALUE?"output connection":"previous connection",o,c)}}},Vl=function(t,o){if(o.icons){var c=Object.keys(o.icons);for(const $ of c){c=o.icons[$];var g=t.getIcon($);if(!g){if(g=d(yt.ICON,$,!1),!g)throw new WI($,t,o);g=new g(t),t.addIcon(g)}cs(g)&&g.loadState(c)}}},Br=function(t,o){if(o.fields){var c=Object.keys(o.fields);for(let g=0;g<c.length;g++){const $=c[g],M=o.fields[$],Q=t.getField($);Q?Q.loadState(M):console.warn(`Ignoring non-existant field ${$} in block ${t.type}`)}}},Bo=function(t,o){if(o.inputs){var c=Object.keys(o.inputs);for(let g=0;g<c.length;g++){const $=c[g],M=t.getInput($);if(!M||!M.connection)throw new sv($,t,o);Js(M.connection,o.inputs[$])}}},vo=function(t,o){if(o.next){if(!t.nextConnection)throw new sv("next",t,o);Js(t.nextConnection,o.next)}},Js=function(t,o){o.shadow&&t.setShadowState(o.shadow),o.block&&Hl(o.block,t.getSourceBlock().workspace,{parentConnection:t})},Oi=function(t,o){if(o){t.setConnectionTracking(!1),t.initSvg(),t.queueRender();for(const c of t.getIcons())c.onLocationChange(t.getRelativeToSurfaceXY())}else t.initModel()},Ee=function(t){return t.bubbleIsVisible!==void 0&&t.setBubbleVisible!==void 0},Oe=function(t){return t*Math.PI/180},lt=function(t){return 180*t/Math.PI},Et=function(t,o,c){if(c<t){const g=c;c=t,t=g}return Math.max(t,Math.min(o,c))},_n=function(){document.querySelector(".blocklyDropDownDiv")||(ri=document.createElement("div"),ri.className="blocklyDropDownDiv",(xe()||document.body).appendChild(ri),_m=document.createElement("div"),_m.className="blocklyDropDownContent",ri.appendChild(_m),ff=document.createElement("div"),ff.className="blocklyDropDownArrow",ri.appendChild(ff),ri.style.opacity="0",ri.style.transition="transform "+ey+"s, opacity "+ey+"s",ri.addEventListener("focusin",function(){Me(ri,"blocklyFocused")}),ri.addEventListener("focusout",function(){oe(ri,"blocklyFocused")}))},fn=function(t){bb=t},Qt=function(){return $h},yn=function(){return _m},li=function(){_m.textContent="",_m.style.width=""},ci=function(t,o){ri.style.backgroundColor=t,ri.style.borderColor=o},br=function(t,o,c,g){return Fo(Ic(o),t,c,g)},us=function(t,o,c){return YI=!0,Fo(Bp(t),t,o,c)},Ic=function(t){var o=t.getSvgRoot();const c=t.workspace.scale,g=t.height*c;return t=t.width*c,o=tt(o),new $i(o.y,o.y+g,o.x,o.x+t)},Bp=function(t){return t=t.getScaledBBox(),new $i(t.top,t.bottom,t.left,t.right)},Fo=function(t,o,c,g){const $=t.left+(t.right-t.left)/2,M=t.bottom;t=t.top,g&&(t+=g),g=o.getSourceBlock();let Q=g.workspace;for(;Q.options.parentWorkspace;)Q=Q.options.parentWorkspace;return fn(Q.getParentSvg().parentNode),ga(o,g.RTL,$,M,$,t,c)},ga=function(t,o,c,g,$,M,Q){return $h=t,df=Q||null,ri.style.direction=o?"rtl":"ltr",t=ne(),mm=t.getRenderer().getClassName(),gm=t.getTheme().getClassName(),mm&&Me(ri,mm),gm&&Me(ri,gm),Gp(c,g,$,M)},Du=function(t,o,c,g){return t=Bu(t,c.left,c.right,g.width),{initialX:t.divX,initialY:o,finalX:t.divX,finalY:o+Sb,arrowX:t.arrowX,arrowY:-(av/2+yb),arrowAtTop:!0,arrowVisible:!0}},Fp=function(t,o,c,g){return t=Bu(t,c.left,c.right,g.width),{initialX:t.divX,initialY:o-g.height,finalX:t.divX,finalY:o-g.height-Sb,arrowX:t.arrowX,arrowY:g.height-2*yb-av/2,arrowAtTop:!1,arrowVisible:!0}},vd=function(t,o,c){return t=Bu(t,o.left,o.right,c.width),{initialX:t.divX,initialY:0,finalX:t.divX,finalY:0,arrowAtTop:null,arrowX:null,arrowY:null,arrowVisible:!1}},Bu=function(t,o,c,g){return o=Et(o,t-g/2,c-g),t=t-av/2-o,c=jI,t=Et(c,t,g-c-av),{arrowX:t,divX:o}},Up=function(){return!!$h},Fu=function(t,o){return $h===t?(o?Uo():Oc(),!0):!1},Oc=function(){ri.style.transform="translate(0, 0)",ri.style.opacity="0",$b=setTimeout(function(){Uo()},1e3*ey),df&&(df(),df=null)},Uo=function(){Up()&&($b&&clearTimeout($b),ri.style.transform="",ri.style.left="",ri.style.top="",ri.style.opacity="0",ri.style.display="none",ri.style.backgroundColor="",ri.style.borderColor="",df&&(df(),df=null),li(),$h=null,mm&&(oe(ri,mm),mm=""),gm&&(oe(ri,gm),gm=""),ne().markFocused())},Gp=function(t,o,c,g){t=Ab.getPositionMetrics(t,o,c,g),t.arrowVisible?(ff.style.display="",ff.style.transform="translate("+t.arrowX+"px,"+t.arrowY+"px) rotate(45deg)",ff.setAttribute("class",t.arrowAtTop?"blocklyDropDownArrow blocklyArrowTop":"blocklyDropDownArrow blocklyArrowBottom")):ff.style.display="none",o=Math.floor(t.initialX),c=Math.floor(t.initialY),g=Math.floor(t.finalX);const $=Math.floor(t.finalY);return ri.style.left=o+"px",ri.style.top=c+"px",ri.style.display="block",ri.style.opacity="1",ri.style.transform="translate("+(g-o)+"px,"+($-c)+"px)",!!t.arrowAtTop},Hp=function(){if($h){var t=$h.getSourceBlock();t=YI?Bp($h):Ic(t);const o=t.left+(t.right-t.left)/2;Gp(o,t.bottom,o,t.top)}else Oc()},Lc=function(t){return t.length?t.reduce(function(o,c){return o.length<c.length?o:c}).length:0},zl=function(t,o){if(!t.length)return 0;if(t.length===1)return t[0].length;let c=0;o=o||Lc(t);let g;for(g=0;g<o;g++){for(var $=t[0][g],M=1;M<t.length;M++)if($!==t[M][g])return c;$===" "&&(c=g+1)}for($=1;$<t.length;$++)if((M=t[$][g])&&M!==" ")return c;return o},Wl=function(t,o){if(!t.length)return 0;if(t.length===1)return t[0].length;let c=0;o=o||Lc(t);let g;for(g=0;g<o;g++){for(var $=t[0].substr(-g-1,1),M=1;M<t.length;M++)if($!==t[M].substr(-g-1,1))return c;$===" "&&(c=g+1)}for($=1;$<t.length;$++)if((M=t[$].charAt(t[$].length-g-1))&&M!==" ")return c;return o},n.wrap$$module$build$src$core$utils$string=function(t,o){t=t.split(`
`);for(let c=0;c<t.length;c++)t[c]=Td(t[c],o);return t.join(`
`)},Td=function(t,o){if(t.length<=o)return t;const c=t.trim().split(/\s+/);for(var g=0;g<c.length;g++)c[g].length>o&&(o=c[g].length);var $=-1/0;let M,Q=1;do{g=$,M=t,t=[],$=c.length/Q;let be=1;for(let nt=0;nt<c.length-1;nt++)be<(nt+1.5)/$?(be++,t[nt]=!0):t[nt]=!1;t=Ms(c,t,o),$=Nc(c,t,o),t=Zs(c,t),Q++}while($>g);return M},Nc=function(t,o,c){const g=[0],$=[];for(var M=0;M<t.length;M++)g[g.length-1]+=t[M].length,o[M]===!0?(g.push(0),$.push(t[M].charAt(t[M].length-1))):o[M]===!1&&g[g.length-1]++;for(t=Math.max(...g),o=0,M=0;M<g.length;M++)o-=2*Math.pow(Math.abs(c-g[M]),1.5),o-=Math.pow(t-g[M],1.5),".?!".includes($[M])?o+=c/3:",;)]}".includes($[M])&&(o+=c/4);return 1<g.length&&g[g.length-1]<=g[g.length-2]&&(o+=.5),o},Ms=function(t,o,c){let g=Nc(t,o,c),$;for(let M=0;M<o.length-1;M++){if(o[M]===o[M+1])continue;const Q=[].concat(o);Q[M]=!Q[M],Q[M+1]=!Q[M+1];const be=Nc(t,Q,c);be>g&&(g=be,$=Q)}return $?Ms(t,$,c):o},Zs=function(t,o){const c=[];for(let g=0;g<t.length;g++)c.push(t[g]),o[g]!==void 0&&c.push(o[g]?`
`:" ");return c.join("")},n.isNumber$$module$build$src$core$utils$string=function(t){return/^\s*-?\d+(\.\d+)?\s*$/.test(t)},Xl=function(t){ty=t},_a=function(){return ty},va=function(){return cv},jl=function(){return Mr},kc=function(t){if(t=Ed(t)){for(t=t.tooltip;typeof t=="function";)t=t();if(typeof t!="string")throw Error("Tooltip function must return a string.");return t}return""},Ed=function(t){for(;t&&t.tooltip;){if(typeof t.tooltip=="string"||typeof t.tooltip=="function")return t;t=t.tooltip}return null},yd=function(){document.querySelector(".blocklyTooltipDiv")||(Mr=document.createElement("div"),Mr.className="blocklyTooltipDiv",(xe()||document.body).appendChild(Mr))},Ar=function(t){t.mouseOverWrapper_=Le(t,"pointerover",null,Li),t.mouseOutWrapper_=Le(t,"pointerout",null,Uu),t.addEventListener("pointermove",qs,!1)},es=function(t){t&&(re(t.mouseOverWrapper_),re(t.mouseOutWrapper_),t.removeEventListener("pointermove",qs))},Li=function(t){Tm||(t=Ed(t.currentTarget),Ra!==t&&(Ta(),uv=null,Ra=t),clearTimeout(JI))},Uu=function(t){Tm||(JI=setTimeout(function(){uv=Ra=null,Ta()},1),clearTimeout(pf),pf=0)},qs=function(t){if(Ra&&Ra.tooltip&&!Tm)if(cv){const o=Cb-t.pageX;t=xb-t.pageY,Math.sqrt(o*o+t*t)>ZI&&Ta()}else uv!==Ra&&(clearTimeout(pf),Cb=t.pageX,xb=t.pageY,pf=setTimeout(zp,qI))},Vp=function(){uv=Ra=null,Ta()},Ta=function(){cv&&(cv=!1,Mr&&(Mr.style.display="none")),pf&&(clearTimeout(pf),pf=0)},Sd=function(){Ta(),Tm=!0},$d=function(){Tm=!1},c_=function(){Mr&&Ra&&(typeof ty=="function"?ty(Mr,Ra):Gu())},Gu=function(){var t=kc(Ra);t=n.wrap$$module$build$src$core$utils$string(t,KI),t=t.split(`
`);for(let o=0;o<t.length;o++){const c=document.createElement("div");c.appendChild(document.createTextNode(t[o])),Mr.appendChild(c)}},Pc=function(t){const o=document.documentElement.clientWidth,c=document.documentElement.clientHeight;let g=Cb;g=t?g-(Rb+Mr.offsetWidth):g+Rb;let $=xb+wb;return $+Mr.offsetHeight>c+window.scrollY&&($-=Mr.offsetHeight+2*wb),t?g=Math.max(ny-window.scrollX,g):g+Mr.offsetWidth>o+window.scrollX-2*ny&&(g=o-Mr.offsetWidth-2*ny),{x:g,y:$}},zp=function(){if(!Tm&&(uv=Ra,Mr)){Mr.textContent="",c_();var t=Ra.RTL;Mr.style.direction=t?"rtl":"ltr",Mr.style.display="block",cv=!0;var{x:o,y:c}=Pc(t);Mr.style.left=o+"px",Mr.style.top=c+"px"}},Dc=function(){return Mb},bd=function(t){Mb=t},Wp=function(){return Ib},u_=function(t){Ib=t},To=function(t){t=`${t}`.toLowerCase().trim();var o=QI[t];if(o||(o=t.substring(0,2)==="0x"?"#"+t.substring(2):t,o=o[0]==="#"?o:"#"+o,/^#[0-9a-f]{6}$/.test(o)))return o;if(/^#[0-9a-f]{3}$/.test(o))return["#",o[1],o[1],o[2],o[2],o[3],o[3]].join("");var c=t.match(/^(?:rgb)?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);return c&&(t=Number(c[1]),o=Number(c[2]),c=Number(c[3]),0<=t&&256>t&&0<=o&&256>o&&0<=c&&256>c)?Hu(t,o,c):null},Hu=function(t,o,c){return o=t<<16|o<<8|c,16>t?"#"+(16777216|o).toString(16).substr(1):"#"+o.toString(16)},Yl=function(t){return t=To(t),t?(t=parseInt(t.substr(1),16),[t>>16,t>>8&255,t&255]):[0,0,0]},hs=function(t,o,c){let g=0,$=0,M=0;if(o===0)M=$=g=c;else{const Q=Math.floor(t/60),be=t/60-Q;t=c*(1-o);const nt=c*(1-o*be);switch(o=c*(1-o*(1-be)),Q){case 1:g=nt,$=c,M=t;break;case 2:g=t,$=c,M=o;break;case 3:g=t,$=nt,M=c;break;case 4:g=o,$=t,M=c;break;case 5:g=c,$=t,M=nt;break;case 6:case 0:g=c,$=o,M=t}}return Hu(Math.floor(g),Math.floor($),Math.floor(M))},Go=function(t,o,c){return t=To(t),!t||(o=To(o),!o)?null:(t=Yl(t),o=Yl(o),Hu(Math.round(o[0]+c*(t[0]-o[0])),Math.round(o[1]+c*(t[1]-o[1])),Math.round(o[2]+c*(t[2]-o[2]))))},Kl=function(t){return hs(t,Mb,255*Ib)},Qs=function(t,o,c){const g=[];var $=t.split("");$.push("");var M=0;t=[];let Q=null;for(let Dt=0;Dt<$.length;Dt++){var be=$[Dt];if(M===0)if(be==="%")(M=t.join(""))&&g.push(M),t.length=0,M=1;else if(c&&be===`
`){const Ni=t.join("");Ni&&g.push(Ni),t.length=0,g.push(be)}else t.push(be);else if(M===1)be==="%"?(t.push(be),M=0):o&&"0"<=be&&"9">=be?(M=2,Q=be,(be=t.join(""))&&g.push(be),t.length=0):be==="{"?M=3:(t.push("%",be),M=0);else if(M===2)if("0"<=be&&"9">=be)Q+=be;else{var nt=void 0;g.push(parseInt((nt=Q)!=null?nt:"",10)),Dt--,M=0}else M===3&&(be===""?(t.splice(0,0,"%{"),Dt--,M=0):be!=="}"?t.push(be):(M=t.join(""),/[A-Z]\w*/i.test(M)?(be=M.toUpperCase(),(be=be.startsWith("BKY_")?be.substring(4):null)&&be in n.Msg$$module$build$src$core$msg?(M=n.Msg$$module$build$src$core$msg[be],typeof M=="string"?Array.prototype.push.apply(g,Qs(M,o,c)):o?g.push(`${M}`):g.push(M)):g.push("%{"+M+"}")):g.push("%{"+M+"}"),M=t.length=0))}for((o=t.join(""))&&g.push(o),nt=[],t.length=0,$=0;$<g.length;$++)typeof g[$]!="string"||c&&g[$]===`
`?((o=t.join(""))&&nt.push(o),t.length=0,nt.push(g[$])):t.push(g[$]);return(o=t.join(""))&&nt.push(o),t.length=0,nt},Ad=function(t){return Qs(t,!0,!0)},yi=function(t){return typeof t!="string"?t:(t=Qs(t,!1,!1),t.length?String(t[0]):"")},h_=function(t){let o=!0;const c=n.Msg$$module$build$src$core$msg,g=t.match(/%{BKY_[A-Z]\w*}/gi);if(g)for(let $=0;$<g.length;$++){const M=g[$].toUpperCase();c[M.slice(6,-1)]===void 0&&(console.warn("No message string for "+g[$]+" in "+t),o=!1)}return o},Jl=function(t){const o=typeof t=="string"?yi(t):t;var c=Number(o);if(!isNaN(c)&&0<=c&&360>=c)return{hue:c,hex:hs(c,Dc(),255*Wp())};if(c=To(o))return{hue:null,hex:c};throw c='Invalid colour: "'+o+'"',t!==o&&(c+=' (from "'+t+'")'),Error(c)},gi=function(){return ml},Cd=function(t){if(ml=t,t===null){let o;(o=document.querySelector("."+ry))==null||o.remove()}},xd=function(){const t=xe()||document.body;document.querySelector("."+ry)?ml=document.querySelector("."+ry):(ml=document.createElement("div"),ml.className=ry),t.appendChild(ml)},Vu=function(t,o,c,g){if(Qa(),Em=t,iy=c,c=ml){if(c.style.direction=o?"rtl":"ltr",c.style.display="block",!g&&t instanceof bi){let Q;g=(Q=t.getSourceBlock())==null?void 0:Q.workspace}var $;Ob=($=g)!=null?$:null;var M;t=(M=g)!=null?M:ne(),ym=t.getRenderer().getClassName(),Sm=t.getTheme().getClassName(),ym&&Me(c,ym),Sm&&Me(c,Sm)}},Qa=function(){if(Is()){Em=null;var t=ml;t&&(t.style.display="none",t.style.left="",t.style.top="",iy&&iy(),iy=null,t.textContent="",ym&&(oe(t,ym),ym=""),Sm&&(oe(t,Sm),Sm=""),ne().markFocused())}},Is=function(){return!!Em},Eo=function(t){Em===t&&Qa()},wi=function(t){Ob!==null&&Ob!==t||Qa()},Cr=function(t,o,c){ml.style.left=t+"px",ml.style.top=o+"px",ml.style.height=c+"px"},ar=function(t,o,c,g){const $=zu(t,o,c);t=Rd(t,o,c,g),0>$?Cr(t,0,c.height+$):Cr(t,$,c.height)},Rd=function(t,o,c,g){return g?Math.min(Math.max(o.right-c.width,t.left),t.right-c.width):Math.max(Math.min(o.left,t.right-c.width),t.left)},zu=function(t,o,c){return o.bottom+c.height>=t.bottom?o.top-c.height:o.bottom},Wu=function(t){return!(t==null||!t.repositionForWindowResize)},d_=function(){Wu(Em)&&Em.repositionForWindowResize()||Qa()},Fr=function(){return sy},wd=function(t){sy=t},Bc=function(t,o,c,g){if(Vu(e1,c,Xu,g),o.length){var $=Xp(o,c,t);oy=$,Ea($,t,c),setTimeout(function(){$.focus()},1),sy=null}else ql()},Xp=function(t,o,c){const g=new Tb;g.setRole(pl.MENU);for(let $=0;$<t.length;$++){const M=t[$],Q=new Eb(M.text);Q.setRightToLeft(o),Q.setRole(pl.MENUITEM),g.addChild(Q),Q.setEnabled(M.enabled),M.enabled&&Q.onAction(function(){ql(),requestAnimationFrame(()=>{setTimeout(()=>{M.callback(M.scope,c)},0)})},{})}return g},Ea=function(t,o,c){const g=we();o=new $i(o.clientY+g.top,o.clientY+g.top,o.clientX+g.left,o.clientX+g.left),Ho(t);const $=t.getSize();c&&(o.left+=$.width,o.right+=$.width,g.left+=$.width,g.right+=$.width),ar(g,o,$,c),t.focus()},Ho=function(t){var o=gi();if(!o)throw Error("Attempting to create a context menu when widget div is null");o=t.render(o),Me(o,"blocklyContextMenu"),Ue(o,"contextmenu",null,Zl),t.focus()},Zl=function(t){t.preventDefault(),t.stopPropagation()},ql=function(){Eo(e1),sy=null},Xu=function(){oy&&(oy.dispose(),oy=null)},n.callbackFactory$$module$build$src$core$contextmenu=function(t,o){return()=>{n.disable$$module$build$src$core$events$utils();let c;try{c=o instanceof Element?Ql(o,t.workspace):_o(o,t.workspace);const g=t.getRelativeToSurfaceXY();g.x=t.RTL?g.x-n.config$$module$build$src$core$config.snapRadius:g.x+n.config$$module$build$src$core$config.snapRadius,g.y+=2*n.config$$module$build$src$core$config.snapRadius,c.moveBy(g.x,g.y)}finally{n.enable$$module$build$src$core$events$utils()}return R()&&!c.isShadow()&&b(new(k(n.CREATE$$module$build$src$core$events$utils))(c)),n.setSelected$$module$build$src$core$common(c),c}},f_=function(t,o=!1){const c=n.createElement$$module$build$src$core$utils$xml("xml");var g=jp(n.allUsedVarModels$$module$build$src$core$variables(t));g.hasChildNodes()&&c.appendChild(g);for(const $ of t.getTopComments())c.appendChild(ju($,o));for(t=t.getTopBlocks(!0),g=0;g<t.length;g++)c.appendChild(Yu(t[g],o));return c},ju=function(t,o=!1){const c=n.createElement$$module$build$src$core$utils$xml("comment");o||c.setAttribute("id",t.id),o=t.workspace;const g=t.getRelativeToSurfaceXY();return g.x=o.RTL?o.getWidth()-g.x:g.x,c.setAttribute("x",`${g.x}`),c.setAttribute("y",`${g.y}`),c.setAttribute("w",`${t.getSize().width}`),c.setAttribute("h",`${t.getSize().height}`),t.getText()&&(c.textContent=t.getText()),t.isCollapsed()&&c.setAttribute("collapsed","true"),t.isOwnEditable()||c.setAttribute("editable","false"),t.isOwnMovable()||c.setAttribute("movable","false"),t.isOwnDeletable()||c.setAttribute("deletable","false"),c},jp=function(t){const o=n.createElement$$module$build$src$core$utils$xml("variables");for(let c=0;c<t.length;c++){const g=t[c],$=n.createElement$$module$build$src$core$utils$xml("variable");$.appendChild(n.createTextNode$$module$build$src$core$utils$xml(g.name)),g.type&&$.setAttribute("type",g.type),$.id=g.getId(),o.appendChild($)}return o},Yu=function(t,o){if(t.isInsertionMarker()&&(t=t.getChildren(!1)[0],!t))return new DocumentFragment;let c=0;if(t.workspace.RTL&&(c=t.workspace.getWidth()),o=ya(t,o),Zp(o)){const g=t.getRelativeToSurfaceXY();o.setAttribute("x",String(Math.round(t.workspace.RTL?c-g.x:g.x))),o.setAttribute("y",String(Math.round(g.y)))}return o},p_=function(t){if(t.isSerializable()){const o=n.createElement$$module$build$src$core$utils$xml("field");return o.setAttribute("name",t.name||""),t.toXml(o)}return null},m_=function(t,o){for(let c=0;c<t.inputList.length;c++){const g=t.inputList[c];for(let $=0;$<g.fieldRow.length;$++){const M=p_(g.fieldRow[$]);M&&o.appendChild(M)}}},ya=function(t,o){if(t.isInsertionMarker())return(o=t.getChildren(!1)[0])?ya(o):new DocumentFragment;const c=n.createElement$$module$build$src$core$utils$xml(t.isShadow()?"shadow":"block");if(c.setAttribute("type",t.type),o||(c.id=t.id),t.mutationToDom){var g=t.mutationToDom();g&&(g.hasChildNodes()||g.hasAttributes())&&c.appendChild(g)}if(m_(t,c),g=t.getCommentText()){var $=t.getIcon(wr.COMMENT),M=$.getBubbleSize();$=$.bubbleIsVisible();var Q=n.createElement$$module$build$src$core$utils$xml("comment");Q.appendChild(n.createTextNode$$module$build$src$core$utils$xml(g)),Q.setAttribute("pinned",`${$}`),Q.setAttribute("h",String(M.height)),Q.setAttribute("w",String(M.width)),c.appendChild(Q)}for(t.data&&(g=n.createElement$$module$build$src$core$utils$xml("data"),g.appendChild(n.createTextNode$$module$build$src$core$utils$xml(t.data)),c.appendChild(g)),g=0;g<t.inputList.length;g++){M=t.inputList[g];var be=void 0;if($=!0,M.type!==n.inputTypes$$module$build$src$core$inputs$input_types.DUMMY&&M.type!==n.inputTypes$$module$build$src$core$inputs$input_types.END_ROW){Q=M.connection.targetBlock(),M.type===n.inputTypes$$module$build$src$core$inputs$input_types.VALUE?be=n.createElement$$module$build$src$core$utils$xml("value"):M.type===n.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT&&(be=n.createElement$$module$build$src$core$utils$xml("statement"));const Dt=M.connection.getShadowDom();!Dt||Q&&Q.isShadow()||be.appendChild(Fc(Dt,o)),Q&&(Q=ya(Q,o),Q.nodeType===eu.ELEMENT_NODE&&(be.appendChild(Q),$=!1)),be.setAttribute("name",M.name),$||c.appendChild(be)}}t.inputsInline!==void 0&&t.inputsInline!==t.inputsInlineDefault&&c.setAttribute("inline",String(t.inputsInline)),t.isCollapsed()&&c.setAttribute("collapsed","true"),t.isEnabled()||c.setAttribute("disabled-reasons",Array.from(t.getDisabledReasons()).map(encodeURIComponent).join(",")),t.isOwnDeletable()||c.setAttribute("deletable","false"),t.isOwnMovable()||c.setAttribute("movable","false"),t.isOwnEditable()||c.setAttribute("editable","false"),be=t.getNextBlock();let nt;return be&&(g=ya(be,o),g.nodeType===eu.ELEMENT_NODE&&(nt=n.createElement$$module$build$src$core$utils$xml("next"),nt.appendChild(g),c.appendChild(nt))),t=t.nextConnection&&t.nextConnection.getShadowDom(),!t||be&&be.isShadow()||nt.appendChild(Fc(t,o)),c},Fc=function(t,o){let c=t=t.cloneNode(!0),g;for(;c;)if(o&&c.nodeName==="shadow"&&c.removeAttribute("id"),c.firstChild)c=c.firstChild;else{for(;c&&!c.nextSibling;){g=c,c=c.parentNode;let $;g.nodeType===eu.TEXT_NODE&&g.data.trim()===""&&(($=c)==null?void 0:$.firstChild)!==g&&W(g)}c&&(g=c,c=c.nextSibling,g.nodeType===eu.TEXT_NODE&&g.data.trim()===""&&W(g))}return t},Vo=function(t){return an(t).replace(/<(\w+)([^<]*)\/>/g,"<$1$2></$1>")},Md=function(t){t=Vo(t).split("<");let o="";for(let c=1;c<t.length;c++){const g=t[c];g[0]==="/"&&(o=o.substring(2)),t[c]=o+"<"+g,g[0]!=="/"&&g.slice(-2)!=="/>"&&(o+="  ")}return t=t.join(`
`),t=t.replace(/(<(\w+)\b[^>]*>[^\n]*)\n *<\/\2>/g,"$1</$2>"),t.replace(/^\n/,"")},Id=function(t,o){return o.setResizesEnabled(!1),o.clear(),t=n.domToWorkspace$$module$build$src$core$xml(t,o),o.setResizesEnabled(!0),t},n.domToWorkspace$$module$build$src$core$xml=function(t,o){let c=0;o.RTL&&(c=o.getWidth());const g=[];qe();const $=n.getGroup$$module$build$src$core$events$utils();$||n.setGroup$$module$build$src$core$events$utils(!0),o.setResizesEnabled&&o.setResizesEnabled(!1);let M=!0;try{for(let Q=0,be;be=t.childNodes[Q];Q++){const nt=be.nodeName.toLowerCase(),Dt=be;if(nt==="block"||nt==="shadow"&&!E()){const Ni=Ql(Dt,o);g.push(Ni.id);let Mi;const $o=parseInt((Mi=Dt.getAttribute("x"))!=null?Mi:"10",10);let Lm;const Cv=parseInt((Lm=Dt.getAttribute("y"))!=null?Lm:"10",10);isNaN($o)||isNaN(Cv)||Ni.moveBy(o.RTL?c-$o:$o,Cv,["create"]),M=!1}else{if(nt==="shadow")throw TypeError("Shadow block cannot be a top-level block.");if(nt==="comment")Od(Dt,o);else if(nt==="variables"){if(M)Yp(Dt,o);else throw Error("'variables' tag must exist once before block and shadow tag elements in the workspace XML, but it was found in another location.");M=!1}}}}finally{n.setGroup$$module$build$src$core$events$utils($),o.setResizesEnabled&&o.setResizesEnabled(!0),o.rendered&&An(),ut()}return b(new(k(lc))(o)),g},Od=function(t,o){var c;const g=(c=t.getAttribute("id"))!=null?c:void 0;c=o.rendered?new ay(o,g):new JE(o,g);var $;c.setText(($=t.textContent)!=null?$:"");var M;$=parseInt((M=t.getAttribute("x"))!=null?M:"",10);let Q;M=parseInt((Q=t.getAttribute("y"))!=null?Q:"",10),isNaN($)||isNaN(M)||($=o.RTL?o.getWidth()-$:$,c.moveTo(new At($,M)));var be;o=parseInt((be=t.getAttribute("w"))!=null?be:"",10);let nt;return be=parseInt((nt=t.getAttribute("h"))!=null?nt:"",10),isNaN(o)||isNaN(be)||c.setSize(new Kn(o,be)),t.getAttribute("collapsed")==="true"&&c.setCollapsed(!0),t.getAttribute("editable")==="false"&&c.setEditable(!1),t.getAttribute("movable")==="false"&&c.setMovable(!1),t.getAttribute("deletable")==="false"&&c.setDeletable(!1),c},Ku=function(t,o){if(!o.getBlocksBoundingBox)return n.domToWorkspace$$module$build$src$core$xml(t,o);var c=o.getBlocksBoundingBox();if(t=n.domToWorkspace$$module$build$src$core$xml(t,o),c&&c.top!==c.bottom){var g=c.bottom;c=o.RTL?c.right:c.left;var $=1/0;let M=-1/0,Q=1/0;for(let be=0;be<t.length;be++){const nt=o.getBlockById(t[be]).getRelativeToSurfaceXY();nt.y<Q&&(Q=nt.y),nt.x<$&&($=nt.x),nt.x>M&&(M=nt.x)}for(g=g-Q+10,c=o.RTL?c-M:c-$,$=0;$<t.length;$++)o.getBlockById(t[$]).moveBy(c,g,["create"])}return t},n.domToBlock$$module$build$src$core$xml=function(t,o){return t=Ql(t,o),o.rendered&&An(),t},Ql=function(t,o){n.disable$$module$build$src$core$events$utils();var c=o.getAllVariables();let g;try{if(g=Jp(t,o),o.rendered){const $=g,M=g.getDescendants(!1);$.setConnectionTracking(!1);for(let Q=M.length-1;0<=Q;Q--)M[Q].initSvg();for(let Q=M.length-1;0<=Q;Q--)M[Q].queueRender();setTimeout(function(){$.disposed||$.setConnectionTracking(!0)},1),o.resizeContents()}else{const $=g.getDescendants(!1);for(let M=$.length-1;0<=M;M--)$[M].initModel()}}finally{n.enable$$module$build$src$core$events$utils()}if(R()){for(t=zn(o,c),o=0;o<t.length;o++)c=t[o],b(new(k(ba))(c));b(new(k(n.CREATE$$module$build$src$core$events$utils))(g))}return g},Yp=function(t,o){for(let g=0;g<t.children.length;g++){var c=t.children[g];const $=c.getAttribute("type"),M=c.getAttribute("id");if(c=c.textContent,!c)break;o.createVariable(c,$,M)}},g_=function(t){const o={mutation:[],comment:[],data:[],field:[],input:[],next:[]};for(let c=0;c<t.children.length;c++){const g=t.children[c];if(g.nodeType!==eu.TEXT_NODE)switch(g.nodeName.toLowerCase()){case"mutation":o.mutation.push(g);break;case"comment":o.comment.push(g);break;case"data":o.data.push(g);break;case"title":case"field":o.field.push(g);break;case"value":case"statement":o.input.push(g);break;case"next":o.next.push(g);break;default:console.warn("Ignoring unknown tag: "+g.nodeName)}}return o},__=function(t,o){let c=!1;for(let g=0;g<t.length;g++){const $=t[g];o.domToMutation&&(o.domToMutation($),o.initSvg&&(c=!0))}return c},Kp=function(t,o){for(let g=0;g<t.length;g++){var c=t[g];const $=c.textContent,M=c.getAttribute("pinned")==="true";let Q;const be=parseInt((Q=c.getAttribute("w"))!=null?Q:"50",10);let nt;c=parseInt((nt=c.getAttribute("h"))!=null?nt:"50",10),o.setCommentText($);const Dt=o.getIcon(wr.COMMENT);isNaN(be)||isNaN(c)||Dt.setBubbleSize(new Kn(be,c)),Dt.setBubbleVisible(M),setTimeout(()=>Dt.setBubbleVisible(M),1)}},v_=function(t,o){for(let c=0;c<t.length;c++)o.data=t[c].textContent},T_=function(t,o){for(let c=0;c<t.length;c++){const g=t[c],$=g.getAttribute("name");$?S_(o,$,g):console.warn(`Ignoring unnamed field in block ${o.type}`)}},E_=function(t){let o=null,c=null;for(let g=0;g<t.childNodes.length;g++){const $=t.childNodes[g];Zp($)&&($.nodeName.toLowerCase()==="block"?o=$:$.nodeName.toLowerCase()==="shadow"&&(c=$))}return{childBlockElement:o,childShadowElement:c}},y_=function(t,o,c,g){for(let M=0;M<t.length;M++){var $=t[M];const Q=$.getAttribute("name"),be=Q?c.getInput(Q):null;if(!be){console.warn("Ignoring non-existent input "+Q+" in block "+g);break}if($=E_($),$.childBlockElement){if(!be.connection)throw TypeError("Input connection does not exist.");Jp($.childBlockElement,o,be.connection,!1)}if($.childShadowElement){let nt;(nt=be.connection)==null||nt.setShadowDom($.childShadowElement)}}},FE=function(t,o,c){for(let g=0;g<t.length;g++){const $=E_(t[g]);if($.childBlockElement){if(!c.nextConnection)throw TypeError("Next statement does not exist.");if(c.nextConnection.isConnected())throw TypeError("Next statement is already connected.");Jp($.childBlockElement,o,c.nextConnection,!0)}$.childShadowElement&&c.nextConnection&&c.nextConnection.setShadowDom($.childShadowElement)}},Jp=function(t,o,c,g){var $;const M=t.getAttribute("type");if(!M)throw TypeError("Block type unspecified: "+t.outerHTML);var Q=($=t.getAttribute("id"))!=null?$:void 0;$=o.newBlock(M,Q),Q=g_(t);const be=__(Q.mutation,$);if(Kp(Q.comment,$),v_(Q.data,$),c)if(g)if($.previousConnection)c.connect($.previousConnection);else throw TypeError("Next block does not have previous statement.");else if($.outputConnection)c.connect($.outputConnection);else if($.previousConnection)c.connect($.previousConnection);else throw TypeError("Child block does not have output or previous statement.");if(T_(Q.field,$),y_(Q.input,o,$,M),FE(Q.next,o,$),be&&$.initSvg(),(o=t.getAttribute("inline"))&&$.setInputsInline(o==="true"),(o=t.getAttribute("disabled"))&&$.setDisabledReason(o==="true"||o==="disabled",xa),o=t.getAttribute("disabled-reasons"),o!==null)for(var nt of o.split(","))$.setDisabledReason(!0,decodeURIComponent(nt));if((nt=t.getAttribute("deletable"))&&$.setDeletable(nt==="true"),(nt=t.getAttribute("movable"))&&$.setMovable(nt==="true"),(nt=t.getAttribute("editable"))&&$.setEditable(nt==="true"),(nt=t.getAttribute("collapsed"))&&$.setCollapsed(nt==="true"),t.nodeName.toLowerCase()==="shadow"){for(t=$.getChildren(!1),nt=0;nt<t.length;nt++)if(!t[nt].isShadow())throw TypeError("Shadow block not allowed non-shadow child.");$.setShadow(!0)}return $},S_=function(t,o,c){const g=t.getField(o);g?g.fromXml(c):console.warn("Ignoring non-existent field "+o+" in block "+t.type)},$_=function(t){for(let o=0;o<t.childNodes.length;o++){const c=t.childNodes[o];if(c.nodeName.toLowerCase()==="next"){t.removeChild(c);break}}},Zp=function(t){return t.nodeType===eu.ELEMENT_NODE},Ld=function(t){if(!(100<t.getDescendants(!1).length)){var o=t.workspace,c=t.getSvgRoot();o.getAudioManager().play("delete");var g=t.getRelativeToSurfaceXY(),$=c.cloneNode(!0);$.setAttribute("transform","translate("+g.x+","+g.y+")");var M;(M=o.getLayerManager())==null||M.appendToAnimationLayer({getSvgRoot:()=>$}),Ju($,{x:g.x,y:g.y,width:t.width,height:t.height},o.RTL,new Date)}},Ju=function(t,o,c,g){const $=(new Date().getTime()-g.getTime())/150;1<$?W(t):(t.setAttribute("transform","translate("+(o.x+(c?-1:1)*o.width/2*$)+","+(o.y+o.height/2*$)+") scale("+(1-$)+")"),setTimeout(Ju,10,t,o,c,g))},qp=function(t){var o=t.workspace;const c=o.scale;if(o.getAudioManager().play("click"),!(1>c)){var g=o.getSvgXY(t.getSvgRoot());t.outputConnection?(g.x+=(t.RTL?3:-3)*c,g.y+=13*c):t.previousConnection&&(g.x+=(t.RTL?-23:23)*c,g.y+=3*c);var $=Ce(Ve.CIRCLE,{cx:g.x,cy:g.y,r:0,fill:"none",stroke:"#888","stroke-width":10},o.getParentSvg());t=Ce(Ve.ANIMATE,{id:"animationCircle",begin:"indefinite",attributeName:"r",dur:"150ms",from:0,to:25*c},$),o=Ce(Ve.ANIMATE,{id:"animationOpacity",begin:"indefinite",attributeName:"opacity",dur:"150ms",from:1,to:0},$),t.beginElement(),o.beginElement(),setTimeout(()=>void W($),150)}},b_=function(t){if(ec(),t.workspace.getAudioManager().play("disconnect"),!(1>t.workspace.scale)){var o=t.getHeightWidth().height;o=Math.atan(10/o)/Math.PI*180,t.RTL||(o*=-1),dv=t,A_(t,o,new Date)}},A_=function(t,o,c){const g=(new Date().getTime()-c.getTime())/200;let $="";1>=g&&($=`skewX(${Math.round(Math.sin(g*Math.PI*3)*(1-g)*o)})`,ly=setTimeout(A_,10,t,o,c)),t.getSvgRoot().setAttribute("transform",`${t.getTranslation()} ${$}`)},ec=function(){dv&&(ly&&(clearTimeout(ly),ly=null),dv.getSvgRoot().setAttribute("transform",dv.getTranslation()),dv=null)},el=function(t){return t.getRelativeToSurfaceXY!==void 0&&t.isMovable!==void 0&&t.startDrag!==void 0&&t.drag!==void 0&&t.endDrag!==void 0&&t.revertDrag!==void 0},tl=function(t,o){for(const c in o)t[c]=o[c]!==null&&typeof o[c]=="object"?tl(t[c]||Object.create(null),o[c]):o[c];return t},nl=function(t){return t.getProcedureModel!==void 0&&t.doProcedureUpdate!==void 0&&t.isProcedureDef!==void 0},Nd=function(t){return t.startPublishing!==void 0&&t.stopPublishing!==void 0},zo=function(t,o){r(yt.FIELD,t,o)},C_=function(t){a(yt.FIELD,t)},n.fromJson$$module$build$src$core$field_registry=function(t){return r1.fromJsonInternal(t)},x_=function(t){const o=h(yt.FIELD,t.type);return o?o.fromJson(t):(console.warn("Blockly could not create a field of type "+t.type+". The field is probably not being registered. This could be because the file is not loaded, the field does not register itself (Issue #1584), or the registration is not being reached."),null)},Wo=function(t){let o=!1;const c=t.map(([Q,be])=>typeof Q=="string"?[yi(Q),be]:(o=!0,[Q.alt!==null?Object.assign({},Q,{alt:yi(Q.alt)}):Object.assign({},Q),be]));if(o||2>t.length)return{options:c};var g=c.map(([Q])=>Q),$=Lc(g);t=zl(g,$);const M=Wl(g,$);return!t&&!M||$<=t+M?{options:c}:($=t?g[0].substring(0,t-1):void 0,g=M?g[0].substr(1-M):void 0,{options:R_(c,t,M),prefix:$,suffix:g})},R_=function(t,o,c){return t.map(([g,$])=>[g.substring(o,g.length-c),$])},Uc=function(t){if(!Array.isArray(t))throw TypeError("FieldDropdown options must be an array.");if(!t.length)throw TypeError("FieldDropdown options must not be an empty array.");let o=!1;for(let c=0;c<t.length;c++){const g=t[c];Array.isArray(g)?typeof g[1]!="string"?(o=!0,console.error("Invalid option["+c+"]: Each FieldDropdown option id must be a string. Found "+g[1]+" in: ",g)):g[0]&&typeof g[0]!="string"&&typeof g[0].src!="string"&&(o=!0,console.error("Invalid option["+c+"]: Each FieldDropdown option must have a string label or image description. Found"+g[0]+" in: ",g)):(o=!0,console.error("Invalid option["+c+"]: Each FieldDropdown option must be an array. Found: ",g))}if(o)throw TypeError("Found invalid FieldDropdown options.")},n.register$$module$build$src$core$extensions=function(t,o){if(typeof t!="string"||t.trim()==="")throw Error('Error: Invalid extension name "'+t+'"');if(bm[t])throw Error('Error: Extension "'+t+'" is already registered.');if(typeof o!="function")throw Error('Error: Extension "'+t+'" must be a function');bm[t]=o},n.registerMixin$$module$build$src$core$extensions=function(t,o){if(!o||typeof o!="object")throw Error('Error: Mixin "'+t+'" must be a object');n.register$$module$build$src$core$extensions(t,function(){this.mixin(o)})},n.registerMutator$$module$build$src$core$extensions=function(t,o,c,g){const $='Error when registering mutator "'+t+'": ';ds($,o);const M=M_(o,$);if(c&&typeof c!="function")throw Error($+'Extension "'+t+'" is not a function');n.register$$module$build$src$core$extensions(t,function(){M&&this.setMutator(new n.MutatorIcon$$module$build$src$core$icons$mutator_icon(g||[],this)),this.mixin(o),c&&c.apply(this)})},Zu=function(t){qu(t)?delete bm[t]:console.warn('No extension mapping for name "'+t+'" found to unregister')},qu=function(t){return!!bm[t]},Gc=function(t,o,c){const g=bm[t];if(typeof g!="function")throw Error('Error: Extension "'+t+'" not found.');let $;if(c?w_(t,o):$=xr(o),g.apply(o),c)ds('Error after applying mutator "'+t+'": ',o);else if(!I_($,o))throw Error('Error when applying extension "'+t+'": mutation properties changed when applying a non-mutator extension.')},w_=function(t,o){if(xr(o).length)throw Error('Error: tried to apply mutation "'+t+'" to a block that already has mutator functions.  Block id: '+o.id)},Qu=function(t,o){return Qp(t.mutationToDom,t.domToMutation,o+" mutationToDom/domToMutation")},Ur=function(t,o){return Qp(t.saveExtraState,t.loadExtraState,o+" saveExtraState/loadExtraState")},M_=function(t,o){return Qp(t.compose,t.decompose,o+" compose/decompose")},Qp=function(t,o,c){if(t&&o){if(typeof t!="function"||typeof o!="function")throw Error(c+" must be a function");return!0}if(!t&&!o)return!1;throw Error(c+"Must have both or neither functions")},ds=function(t,o){const c=Qu(o,t),g=Ur(o,t);if(!c&&!g)throw Error(t+"Mutations must contain either XML hooks, or JSON hooks, or both");M_(o,t)},xr=function(t){const o=[];return t.domToMutation!==void 0&&o.push(t.domToMutation),t.mutationToDom!==void 0&&o.push(t.mutationToDom),t.saveExtraState!==void 0&&o.push(t.saveExtraState),t.loadExtraState!==void 0&&o.push(t.loadExtraState),t.compose!==void 0&&o.push(t.compose),t.decompose!==void 0&&o.push(t.decompose),o},I_=function(t,o){if(o=xr(o),o.length!==t.length)return!1;for(let c=0;c<o.length;c++)if(t[c]!==o[c])return!1;return!0},O_=function(t){if(typeof document!="object")throw Error("runAfterPageLoad() requires browser document.");if(document.readyState==="complete")t();else{const o=setInterval(function(){document.readyState==="complete"&&(clearInterval(o),t())},10)}},n.buildTooltipForDropdown$$module$build$src$core$extensions=function(t,o){const c=[];return function(){c.includes(this.type)||(L_(this,t,o),c.push(this.type)),this.setTooltip((function(){const g=String(this.getFieldValue(t));return yi(o[g])}).bind(this))}},L_=function(t,o,c){var g=t.getField(o);if(g instanceof uc&&!g.isOptionListDynamic()){g=g.getOptions();for(const[,$]of g)c[$]===void 0&&console.warn(`No tooltip mapping for value ${$} of field ${o} of block type ${t.type}.`)}},n.buildTooltipWithFieldText$$module$build$src$core$extensions=function(t,o){return function(){this.setTooltip((function(){const c=this.getField(o);return yi(t).replace("%1",c?c.getText():"")}).bind(this))}},N_=function(){const t=this.tooltip;this.setTooltip((function(){const o=this.getParent();return o&&o.getInputsInline()&&o.tooltip||t}).bind(this))},il=function(t,o,c,g){t=t+" was deprecated in "+o+" and will be deleted in "+c+".",g&&(t+=`
Use `+g+" instead."),o1.has(t)||(o1.add(t),console.warn(t))},zt=function(t,o){return" "+t+","+o+" "},fs=function(t,o){return" "+t+o.join("")},Zi=function(t,o){return" M "+t+","+o+" "},Si=function(t,o){return" m "+t+","+o+" "},Xo=function(t,o){return" l "+t+","+o+" "},rl=function(t){return" l"+t.join("")},Nt=function(t,o){return" "+t+" "+o+" "},Di=function(t,o,c,g){return t+" "+c+" "+c+" "+o+g},kd=function(t,o){r(yt.ICON,t.toString(),o)},k_=function(t){a(yt.ICON,t)},Pd=function(t){const o=t.getProcedureMap().getProcedures().filter(g=>!g.getReturnTypes()).map(g=>[g.getName(),g.getParameters().map($=>$.getName()),!1]);t.getBlocksByType("procedures_defnoreturn",!1).forEach(g=>{!nl(g)&&xt(g)&&o.push(g.getProcedureDef())});const c=t.getProcedureMap().getProcedures().filter(g=>!!g.getReturnTypes()).map(g=>[g.getName(),g.getParameters().map($=>$.getName()),!0]);return t.getBlocksByType("procedures_defreturn",!1).forEach(g=>{!nl(g)&&xt(g)&&c.push(g.getProcedureDef())}),o.sort(eh),c.sort(eh),[o,c]},eh=function(t,o){return t[0].localeCompare(o[0],void 0,{sensitivity:"base"})},n.findLegalName$$module$build$src$core$procedures=function(t,o){if(o.isInFlyout)return t;for(t=t||n.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed";!P_(t,o.workspace,o);){const c=t.match(/^(.*?)(\d+)$/);t=c?c[1]+(parseInt(c[2])+1):t+"2"}return t},P_=function(t,o,c){return!Dd(t,o,c)},Dd=function(t,o,c){for(const g of o.getAllBlocks(!1))if(g!==c&&xt(g)&&n.Names$$module$build$src$core$names.equals(g.getProcedureDef()[0],t))return!0;c=c&&nl(c)?c==null?void 0:c.getProcedureModel():void 0;for(const g of o.getProcedureMap().getProcedures())if(g!==c&&n.Names$$module$build$src$core$names.equals(g.getName(),t))return!0;return!1},n.rename$$module$build$src$core$procedures=function(t){var o=this.getSourceBlock();if(!o)throw new hr;t=t.trim();const c=n.findLegalName$$module$build$src$core$procedures(t,o);nl(o)&&!o.isInsertionMarker()&&o.getProcedureModel().setName(c);const g=this.getValue();if(g!==t&&g!==c)for(t=o.workspace.getAllBlocks(!1),o=0;o<t.length;o++){const $=t[o];$.renameProcedure&&$.renameProcedure(g,c)}return c},Bd=function(t){function o(M,Q){for(let nt=0;nt<M.length;nt++){var be=M[nt][0];const Dt=M[nt][1],Ni=n.createElement$$module$build$src$core$utils$xml("block");Ni.setAttribute("type",Q),Ni.setAttribute("gap","16");const Mi=n.createElement$$module$build$src$core$utils$xml("mutation");for(Mi.setAttribute("name",be),Ni.appendChild(Mi),be=0;be<Dt.length;be++){const $o=n.createElement$$module$build$src$core$utils$xml("arg");$o.setAttribute("name",Dt[be]),Mi.appendChild($o)}c.push(Ni)}}const c=[];if(ks.procedures_defnoreturn){var g=n.createElement$$module$build$src$core$utils$xml("block");g.setAttribute("type","procedures_defnoreturn"),g.setAttribute("gap","16");var $=n.createElement$$module$build$src$core$utils$xml("field");$.setAttribute("name","NAME"),$.appendChild(n.createTextNode$$module$build$src$core$utils$xml(n.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_PROCEDURE)),g.appendChild($),c.push(g)}return ks.procedures_defreturn&&(g=n.createElement$$module$build$src$core$utils$xml("block"),g.setAttribute("type","procedures_defreturn"),g.setAttribute("gap","16"),$=n.createElement$$module$build$src$core$utils$xml("field"),$.setAttribute("name","NAME"),$.appendChild(n.createTextNode$$module$build$src$core$utils$xml(n.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_PROCEDURE)),g.appendChild($),c.push(g)),ks.procedures_ifreturn&&(g=n.createElement$$module$build$src$core$utils$xml("block"),g.setAttribute("type","procedures_ifreturn"),g.setAttribute("gap","16"),c.push(g)),c.length&&c[c.length-1].setAttribute("gap","24"),t=Pd(t),o(t[0],"procedures_callnoreturn"),o(t[1],"procedures_callreturn"),c},jo=function(t){var o=[],c=t.getBlocksByType("procedures_mutatorarg",!1);for(let M=0,Q;Q=c[M];M++)o.push(Q.getFieldValue("NAME"));c=n.createElement$$module$build$src$core$utils$xml("xml");const g=n.createElement$$module$build$src$core$utils$xml("block");g.setAttribute("type","procedures_mutatorarg");const $=n.createElement$$module$build$src$core$utils$xml("field");$.setAttribute("name","NAME"),o=qt(n.DEFAULT_ARG$$module$build$src$core$procedures,o),o=n.createTextNode$$module$build$src$core$utils$xml(o),$.appendChild(o),g.appendChild($),c.appendChild(g),t.updateToolbox(c)},D_=function(t){if(t.type===Aa&&t.bubbleType==="mutator"&&t.isOpen&&t.blockId){t=U(t.workspaceId).getBlockById(t.blockId);var o=t.type;(o==="procedures_defnoreturn"||o==="procedures_defreturn")&&(t=t.getIcon(n.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE).getWorkspace(),jo(t),t.addChangeListener(UE))}},UE=function(t){(t.type===n.CREATE$$module$build$src$core$events$utils||t.type===n.DELETE$$module$build$src$core$events$utils||t.type===n.CHANGE$$module$build$src$core$events$utils||t.type===Kc)&&(t=U(t.workspaceId),jo(t))},th=function(t,o){return o.getAllBlocks(!1).filter(c=>tc(c,t)||wt(c)&&n.Names$$module$build$src$core$names.equals(c.getProcedureCall(),t))},tc=function(t,o){return nl(t)&&!t.isProcedureDef()&&t.getProcedureModel()&&n.Names$$module$build$src$core$names.equals(t.getProcedureModel().getName(),o)},n.mutateCallers$$module$build$src$core$procedures=function(t){const o=E();var c=t.getProcedureDef()[0];const g=t.mutationToDom(!0);t=th(c,t.workspace);for(let M=0,Q;Q=t[M];M++){c=(c=Q.mutationToDom())&&an(c),Q.domToMutation&&Q.domToMutation(g);var $=Q.mutationToDom();$=$&&an($),c!==$&&(n.setRecordUndo$$module$build$src$core$events$utils(!1),b(new(k(n.CHANGE$$module$build$src$core$events$utils))(Q,"mutation",null,c,$)),n.setRecordUndo$$module$build$src$core$events$utils(o))}},n.getDefinition$$module$build$src$core$procedures=function(t,o){for(const c of o.getAllBlocks(!1))if(nl(c)&&c.isProcedureDef()&&n.Names$$module$build$src$core$names.equals(c.getProcedureModel().getName(),t)||xt(c)&&n.Names$$module$build$src$core$names.equals(c.getProcedureDef()[0],t))return c;return null},em=function(t){return t.isDynamic},kt=function(t){return t.pathDown!==void 0&&t.pathUp!==void 0},Fd=function(t){return t.pathLeft!==void 0&&t.pathRight!==void 0},tm=function(t,o){if(!t||!o)throw Error("Cannot connect null connections.");t.targetConnection=o,o.targetConnection=t},B_=function(t,o){let c=null;o=o.outputConnection;const g=o==null?void 0:o.getConnectionChecker();for(let $=0,M;M=t.inputList[$];$++){const Q=M.connection;let be;if(Q&&((be=g)!=null&&be.canConnect(o,Q,!1))){if(c)return null;c=Q}}return c},GE=function(t,o){let c;for(;c=B_(t,o);)if(t=c.targetBlock(),!t||t.isShadow())return c;return null},sl=function(t){return t.getType!==void 0&&t.initView!==void 0&&t.dispose!==void 0&&t.getWeight!==void 0&&t.getSize!==void 0&&t.applyColour!==void 0&&t.hideForInsertionMarker!==void 0&&t.updateEditable!==void 0&&t.updateCollapsed!==void 0&&t.isShownWhenCollapsed!==void 0&&t.setOffsetInBlock!==void 0&&t.onLocationChange!==void 0&&t.onClick!==void 0},nh=function(t){return sl(t)&&Ee(t)&&cs(t)&&t.setText!==void 0&&t.getText!==void 0&&t.setBubbleSize!==void 0&&t.getBubbleSize!==void 0&&t.getType()===wr.COMMENT},Hc=function(t){let o=t.outputConnection;return(!o||t.previousConnection&&t.previousConnection.isConnected())&&(o=t.previousConnection),o},ih=function(t,o){r(yt.RENDERER,t,o)},F_=function(t){a(yt.RENDERER,t)},nm=function(t,o,c){return t=new(d(yt.RENDERER,t))(t),t.init(o,c),t},im=function(t){Ft(t.getTargetWorkspace(),void 0,"String")},rm=function(t){Ft(t.getTargetWorkspace(),void 0,"Number")},sm=function(t){Ft(t.getTargetWorkspace(),void 0,"Colour")},rh=function(t){let o=[],c=document.createElement("button");return c.setAttribute("text",n.Msg$$module$build$src$core$msg.NEW_STRING_VARIABLE),c.setAttribute("callbackKey","CREATE_VARIABLE_STRING"),o.push(c),c=document.createElement("button"),c.setAttribute("text",n.Msg$$module$build$src$core$msg.NEW_NUMBER_VARIABLE),c.setAttribute("callbackKey","CREATE_VARIABLE_NUMBER"),o.push(c),c=document.createElement("button"),c.setAttribute("text",n.Msg$$module$build$src$core$msg.NEW_COLOUR_VARIABLE),c.setAttribute("callbackKey","CREATE_VARIABLE_COLOUR"),o.push(c),t.registerButtonCallback("CREATE_VARIABLE_STRING",im),t.registerButtonCallback("CREATE_VARIABLE_NUMBER",rm),t.registerButtonCallback("CREATE_VARIABLE_COLOUR",sm),t=Ud(t),o=o.concat(t)},Ud=function(t){t=t.getAllVariables();const o=[];if(0<t.length){if(ks.variables_set_dynamic){var c=t[t.length-1];const g=n.createElement$$module$build$src$core$utils$xml("block");g.setAttribute("type","variables_set_dynamic"),g.setAttribute("gap","24"),g.appendChild(xn(c)),o.push(g)}if(ks.variables_get_dynamic){t.sort(iv.compareByName);for(let g=0,$;$=t[g];g++)c=n.createElement$$module$build$src$core$utils$xml("block"),c.setAttribute("type","variables_get_dynamic"),c.setAttribute("gap","8"),c.appendChild(xn($)),o.push(c)}}return o},U_=function(t,o){const c=t.workspace,g=n.config$$module$build$src$core$config.snapRadius,$=At.difference(o,t.getRelativeToSurfaceXY()),M=new At(0,0),Q=c.getAllBlocks(!1).filter(be=>be.id!=t.id).map(be=>be.getRelativeToSurfaceXY());for(;om(At.sum(o,M),Q)||Gd(t,At.sum($,M),g);)c.RTL?M.translate(-g,2*g):M.translate(g,2*g);t.moveTo(At.sum(o,M))},om=function(t,o){return o.some(c=>1>=Math.abs(c.x-t.x)&&1>=Math.abs(c.y-t.y))},Gd=function(t,o,c){return t.getConnections_(!1).some(g=>!!g.closest(c,o).connection)},sh=function(t,o,c){const g=c.getBoundingRectangle(),$=g.right-g.left,M=Et(o.top,g.top,o.top+o.height-(g.bottom-g.top))-g.top;let Q=o.left;return o=o.left+o.width-$,t.RTL?Q=Math.min(o,Q):o=Math.max(Q,o),(t=Et(Q,g.left,o)-g.left)||M?(c.moveBy(t,M,["inbounds"]),!0):!1},G_=function(t){return o=>{var c=t.getMetricsManager();if(c.hasFixedEdges()&&!t.isDragging()){var g;if(Th.includes((g=o.type)!=null?g:"")){g=c.getScrollMetrics(!0);const $=H_(t,o);$&&(c=n.getGroup$$module$build$src$core$events$utils()||!1,n.setGroup$$module$build$src$core$events$utils(o.group),sh(t,g,$)&&!o.group&&console.warn("Moved object in bounds but there was no event group. This may break undo."),n.setGroup$$module$build$src$core$events$utils(c))}else o.type===Ko&&o.scale&&o.oldScale&&o.scale>o.oldScale&&Hd(t)}}},H_=function(t,o){let c=null;switch(o.type){case n.CREATE$$module$build$src$core$events$utils:case n.MOVE$$module$build$src$core$events$utils:(c=t.getBlockById(o.blockId))&&(c=c.getRootBlock());break;case Jo:case Ca:c=t.getCommentById(o.commentId)}return c},Hd=function(t){var o=t.getMetricsManager();if(o.hasFixedEdges()&&!t.isDragging()){o=o.getScrollMetrics(!0);var c=t.getTopBoundedElements();for(let g=0,$;$=c[g];g++)sh(t,o,$)}},eo=function(t){return t.isDeletable!==void 0&&t.dispose!==void 0&&t.setDeleteStyle!==void 0},V_=function(t){const o=t.toCopyData();lA=o;let c;return cA=(c=t.workspace)!=null?c:null,o},Yo=function(t,o,c){return t&&o?oh(t,o,c):lA&&cA?oh(lA,cA):null},oh=function(t,o,c){let g;o=(g=o.getRootWorkspace())!=null?g:o;let $,M;return(M=($=h(yt.PASTER,t.paster,!1))==null?void 0:$.paste(t,o,c))!=null?M:null},Vd=function(t){const o=t.toCopyData();return o?Yo(o,t.workspace):null},nc=function(t){return t.toCopyData!==void 0},ah=function(){si.registry.register({name:fc.ESCAPE,preconditionFn(t){return!t.options.readOnly},callback(t){return t.hideChaff(),!0},keyCodes:[In.ESC]})},Vc=function(){si.registry.register({name:fc.DELETE,preconditionFn(t){const o=de();return!t.options.readOnly&&o!=null&&eo(o)&&o.isDeletable()&&!nu.inProgress()},callback(t,o){return o.preventDefault(),t=de(),t instanceof Na?t.checkAndDelete():eo(t)&&t.isDeletable()&&(n.setGroup$$module$build$src$core$events$utils(!0),t.dispose(),n.setGroup$$module$build$src$core$events$utils(!1)),!0},keyCodes:[In.DELETE,In.BACKSPACE]})},zd=function(){const t=si.registry.createSerializedKey(In.C,[In.CTRL]),o=si.registry.createSerializedKey(In.C,[In.ALT]),c=si.registry.createSerializedKey(In.C,[In.META]);si.registry.register({name:fc.COPY,preconditionFn(g){const $=de();return!g.options.readOnly&&!nu.inProgress()&&$!=null&&eo($)&&$.isDeletable()&&el($)&&$.isMovable()&&nc($)},callback(g,$){return $.preventDefault(),g.hideChaff(),$=de(),!$||!nc($)?!1:(Ch=$.toCopyData(),xh=g,Mm=el($)?$.getRelativeToSurfaceXY():null,!!Ch)},keyCodes:[t,o,c]})},Wd=function(){const t=si.registry.createSerializedKey(In.X,[In.CTRL]),o=si.registry.createSerializedKey(In.X,[In.ALT]),c=si.registry.createSerializedKey(In.X,[In.META]);si.registry.register({name:fc.CUT,preconditionFn(g){const $=de();return!g.options.readOnly&&!nu.inProgress()&&$!=null&&eo($)&&$.isDeletable()&&el($)&&$.isMovable()&&!$.workspace.isFlyout},callback(g){const $=de();return $ instanceof Na?(Ch=$.toCopyData(),xh=g,Mm=$.getRelativeToSurfaceXY(),$.checkAndDelete(),!0):eo($)&&$.isDeletable()&&nc($)?(Ch=$.toCopyData(),xh=g,Mm=el($)?$.getRelativeToSurfaceXY():null,$.dispose(),!0):!1},keyCodes:[t,o,c]})},Xd=function(){const t=si.registry.createSerializedKey(In.V,[In.CTRL]),o=si.registry.createSerializedKey(In.V,[In.ALT]),c=si.registry.createSerializedKey(In.V,[In.META]);si.registry.register({name:fc.PASTE,preconditionFn(g){return!g.options.readOnly&&!nu.inProgress()},callback(){if(!Ch||!xh)return!1;if(!Mm)return!!Yo(Ch,xh);const{left:g,top:$,width:M,height:Q}=xh.getMetricsManager().getViewMetrics(!0);if(new $i($,$+Q,g,g+M).contains(Mm.x,Mm.y))return!!Yo(Ch,xh);const be=new At(g+M/2,$+Q/2);return!!Yo(Ch,xh,be)},keyCodes:[t,o,c]})},am=function(){const t=si.registry.createSerializedKey(In.Z,[In.CTRL]),o=si.registry.createSerializedKey(In.Z,[In.ALT]),c=si.registry.createSerializedKey(In.Z,[In.META]);si.registry.register({name:fc.UNDO,preconditionFn(g){return!g.options.readOnly&&!nu.inProgress()},callback(g,$){return g.hideChaff(),g.undo(!1),$.preventDefault(),!0},keyCodes:[t,o,c]})},jd=function(){const t=si.registry.createSerializedKey(In.Z,[In.SHIFT,In.CTRL]),o=si.registry.createSerializedKey(In.Z,[In.SHIFT,In.ALT]),c=si.registry.createSerializedKey(In.Z,[In.SHIFT,In.META]),g=si.registry.createSerializedKey(In.Y,[In.CTRL]);si.registry.register({name:fc.REDO,preconditionFn($){return!nu.inProgress()&&!$.options.readOnly},callback($,M){return $.hideChaff(),$.undo(!0),M.preventDefault(),!0},keyCodes:[t,o,c,g]})},z_=function(){ah(),Vc(),zd(),Wd(),Xd(),am(),jd()},lh=function(t){const o=t.saveState();return t.getParameters().length&&(o.parameters=t.getParameters().map(c=>c.saveState())),o},Yd=function(t,o,c,g){if(t=t.loadState(c,g),!c.parameters)return t;for(const[$,M]of c.parameters.entries())t.insertParameter(o.loadState(M,g),$);return t},zi=function(t){const o=Object.create(null),c=f(yt.SERIALIZER,!0);for(const g in c){let $;const M=($=c[g])==null?void 0:$.save(t);M&&(o[g]=M)}return o},Rn=function(t,o,{recordUndo:c=!1}={}){var g=f(yt.SERIALIZER,!0);if(g){g=Object.entries(g).sort((M,Q)=>Q[1].priority-M[1].priority);var $=E();n.setRecordUndo$$module$build$src$core$events$utils(c),(c=n.getGroup$$module$build$src$core$events$utils())||n.setGroup$$module$build$src$core$events$utils(!0),qe(),o instanceof La&&o.setResizesEnabled(!1);for(const[,M]of g.reverse()){let Q;(Q=M)==null||Q.clear(o)}for(const[M,Q]of g.reverse())if(t[M]){let be;(be=Q)==null||be.load(t[M],o)}o instanceof La&&o.setResizesEnabled(!0),ut(),b(new(k(lc))(o)),n.setGroup$$module$build$src$core$events$utils(c),n.setRecordUndo$$module$build$src$core$events$utils($)}},qi=function(t,o){let c=null;c=typeof t=="string"?document.getElementById(t)||document.querySelector(t):t;var g;if(!document.contains(c)&&document!==((g=c)==null?void 0:g.ownerDocument))throw Error("Error: container is not in current document");t=new Ma(o||{}),g=document.createElement("div"),Me(g,"injectionDiv"),o!=null&&o.rtl&&Me(g,"blocklyRTL"),g.tabIndex=0,Ei(g,zr.LABEL,n.Msg$$module$build$src$core$msg.WORKSPACE_ARIA_LABEL),c.appendChild(g),o=Qi(g,t);const $=Rr(g,o,t);return Os($),pe($),J($),g.addEventListener("focusin",function(){pe($)}),$},Qi=function(t,o){t.setAttribute("dir","LTR"),it(o.hasCss,o.pathToMedia),t=Ce(Ve.SVG,{xmlns:q_,"xmlns:html":cc,"xmlns:xlink":Zo,version:"1.1",class:"blocklySvg",tabindex:"0"},t);const c=Ce(Ve.DEFS,{},t),g=String(Math.random()).substring(2);return o.gridPattern=Pb.createDom(g,o.gridOptions,c),t},Rr=function(t,o,c){c.parentWorkspace=null,c=new La(c);const g=c.options;c.scale=g.zoomOptions.startScale,o.appendChild(c.createDom("blocklyMainBackground",t));var $=c.getRenderer().getClassName();return $&&Me(t,$),($=c.getTheme().getClassName())&&Me(t,$),!g.hasCategories&&g.languageTree&&(t=c.addFlyout(Ve.SVG),ot(t,o)),g.hasTrashcan&&c.addTrashcan(),g.zoomOptions&&g.zoomOptions.controls&&c.addZoomControls(),c.getThemeManager().subscribe(o,"workspaceBackgroundColour","background-color"),c.translate(0,0),c.addChangeListener(G_(c)),J(c),xd(),_n(),yd(),c},Os=function(t){const o=t.options;var c=t.getParentSvg();if(Ue(c.parentNode,"contextmenu",null,function(g){Ye(g)||g.preventDefault()}),c=Ue(window,"resize",null,function(){Ta(),t.hideComponents(!0),Hp(),d_(),J(t),Hd(t)}),t.setResizeHandlerWrapper(c),lr(),o.languageTree){c=t.getToolbox();const g=t.getFlyout(!0);c?c.init():g&&(g.init(t),g.show(o.languageTree),typeof g.scrollToStart=="function"&&g.scrollToStart())}o.hasTrashcan&&t.trashcan.init(),o.zoomOptions&&o.zoomOptions.controls&&t.zoomControls_.init(),o.moveOptions&&o.moveOptions.scrollbars?(t.scrollbar=new hA(t,o.moveOptions.scrollbars===!0||!!o.moveOptions.scrollbars.horizontal,o.moveOptions.scrollbars===!0||!!o.moveOptions.scrollbars.vertical,"blocklyMainWorkspaceScrollbar"),t.scrollbar.resize()):t.setMetrics({x:.5,y:.5}),o.hasSounds&&ch(o.pathToMedia,t)},zc=function(t){const o=ne();o&&!(Ye(t)||o.rendered&&!o.isVisible())&&si.registry.onKeyDown(o,t)},lr=function(){H1||(Ue(document,"scroll",null,function(){const t=ce();for(let o=0,c;c=t[o];o++)c instanceof La&&c.updateInverseScreenCTM()}),Ue(document,"keydown",null,zc),Le(document,"touchend",null,Te),Le(document,"touchcancel",null,Te),Z_&&Ue(window,"orientationchange",document,function(){J(ne())})),H1=!0},ch=function(t,o){function c(){for(;$.length;){const M=$.pop();M&&re(M)}g.preload()}const g=o.getAudioManager();g.load([t+"click.mp3",t+"click.wav",t+"click.ogg"],"click"),g.load([t+"disconnect.wav",t+"disconnect.mp3",t+"disconnect.ogg"],"disconnect"),g.load([t+"delete.mp3",t+"delete.ogg",t+"delete.wav"],"delete");const $=[];$.push(Ue(document,"pointermove",null,c,!0)),$.push(Ue(document,"touchstart",null,c,!0))},ic=function(){wn.registry.register({displayText(){return n.Msg$$module$build$src$core$msg.UNDO},preconditionFn(t){return 0<t.workspace.getUndoStack().length?"enabled":"disabled"},callback(t){t.workspace.undo(!1)},scopeType:wn.ScopeType.WORKSPACE,id:"undoWorkspace",weight:1})},uh=function(){wn.registry.register({displayText(){return n.Msg$$module$build$src$core$msg.REDO},preconditionFn(t){return 0<t.workspace.getRedoStack().length?"enabled":"disabled"},callback(t){t.workspace.undo(!0)},scopeType:wn.ScopeType.WORKSPACE,id:"redoWorkspace",weight:2})},Kd=function(){wn.registry.register({displayText(){return n.Msg$$module$build$src$core$msg.CLEAN_UP},preconditionFn(t){return t.workspace.isMovable()?1<t.workspace.getTopBlocks(!1).length?"enabled":"disabled":"hidden"},callback(t){t.workspace.cleanUp()},scopeType:wn.ScopeType.WORKSPACE,id:"cleanWorkspace",weight:3})},Wc=function(t,o){function c(M){$--,M.setCollapsed(t),$===0&&n.setGroup$$module$build$src$core$events$utils(!1)}let g=0,$=0;n.setGroup$$module$build$src$core$events$utils(!0);for(let M=0;M<o.length;M++){let Q=o[M];for(;Q;)$++,setTimeout(c.bind(null,Q),g),Q=Q.getNextBlock(),g+=10}},ts=function(){wn.registry.register({displayText(){return n.Msg$$module$build$src$core$msg.COLLAPSE_ALL},preconditionFn(t){if(t.workspace.options.collapse){t=t.workspace.getTopBlocks(!1);for(let o=0;o<t.length;o++){let c=t[o];for(;c;){if(!c.isCollapsed())return"enabled";c=c.getNextBlock()}}return"disabled"}return"hidden"},callback(t){Wc(!0,t.workspace.getTopBlocks(!0))},scopeType:wn.ScopeType.WORKSPACE,id:"collapseWorkspace",weight:4})},Jd=function(){wn.registry.register({displayText(){return n.Msg$$module$build$src$core$msg.EXPAND_ALL},preconditionFn(t){if(t.workspace.options.collapse){t=t.workspace.getTopBlocks(!1);for(let o=0;o<t.length;o++){let c=t[o];for(;c;){if(c.isCollapsed())return"enabled";c=c.getNextBlock()}}return"disabled"}return"hidden"},callback(t){Wc(!1,t.workspace.getTopBlocks(!0))},scopeType:wn.ScopeType.WORKSPACE,id:"expandWorkspace",weight:5})},Zd=function(t,o){if(t.isDeletable())Array.prototype.push.apply(o,t.getDescendants(!1));else{t=t.getChildren(!1);for(let c=0;c<t.length;c++)Zd(t[c],o)}},ol=function(t){const o=[];t=t.getTopBlocks(!0);for(let c=0;c<t.length;c++)Zd(t[c],o);return o},rc=function(t,o){o?n.setGroup$$module$build$src$core$events$utils(o):(n.setGroup$$module$build$src$core$events$utils(!0),o=n.getGroup$$module$build$src$core$events$utils());const c=t.shift();c&&(c.isDeadOrDying()?rc(t,o):(c.dispose(!1,!0),setTimeout(rc,10,t,o))),n.setGroup$$module$build$src$core$events$utils(!1)},qd=function(){wn.registry.register({displayText(t){return t.workspace?(t=ol(t.workspace).length,t===1?n.Msg$$module$build$src$core$msg.DELETE_BLOCK:n.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",`${t}`)):""},preconditionFn(t){return t.workspace&&0<ol(t.workspace).length?"enabled":"disabled"},callback(t){if(t.workspace){t.workspace.cancelCurrentGesture();var o=ol(t.workspace);2>o.length?rc(o):Je(n.Msg$$module$build$src$core$msg.DELETE_ALL_BLOCKS.replace("%1",String(o.length)),function(c){c&&rc(o)})}},scopeType:wn.ScopeType.WORKSPACE,id:"workspaceDelete",weight:6})},al=function(){ic(),uh(),Kd(),ts(),Jd(),qd()},hh=function(){wn.registry.register({displayText(){return n.Msg$$module$build$src$core$msg.DUPLICATE_BLOCK},preconditionFn(t){return t=t.block,!t.isInFlyout&&t.isDeletable()&&t.isMovable()?t.isDuplicatable()?"enabled":"disabled":"hidden"},callback(t){if(t.block){var o=t.block.toCopyData();o&&Yo(o,t.block.workspace)}},scopeType:wn.ScopeType.BLOCK,id:"blockDuplicate",weight:1})},Sa=function(){wn.registry.register({displayText(t){return t.block.hasIcon(su.TYPE)?n.Msg$$module$build$src$core$msg.REMOVE_COMMENT:n.Msg$$module$build$src$core$msg.ADD_COMMENT},preconditionFn(t){return t=t.block,!t.isInFlyout&&t.workspace.options.comments&&!t.isCollapsed()&&t.isEditable()?"enabled":"hidden"},callback(t){t=t.block,t.hasIcon(su.TYPE)?t.setCommentText(null):t.setCommentText("")},scopeType:wn.ScopeType.BLOCK,id:"blockComment",weight:2})},dh=function(){wn.registry.register({displayText(t){return t.block.getInputsInline()?n.Msg$$module$build$src$core$msg.EXTERNAL_INPUTS:n.Msg$$module$build$src$core$msg.INLINE_INPUTS},preconditionFn(t){if(t=t.block,!t.isInFlyout&&t.isMovable()&&!t.isCollapsed()){for(let o=1;o<t.inputList.length;o++)if(!(t.inputList[o-1]instanceof xy||t.inputList[o]instanceof xy))return"enabled"}return"hidden"},callback(t){t.block.setInputsInline(!t.block.getInputsInline())},scopeType:wn.ScopeType.BLOCK,id:"blockInline",weight:3})},Xc=function(){wn.registry.register({displayText(t){return t.block.isCollapsed()?n.Msg$$module$build$src$core$msg.EXPAND_BLOCK:n.Msg$$module$build$src$core$msg.COLLAPSE_BLOCK},preconditionFn(t){return t=t.block,!t.isInFlyout&&t.isMovable()&&t.workspace.options.collapse?"enabled":"hidden"},callback(t){t.block.setCollapsed(!t.block.isCollapsed())},scopeType:wn.ScopeType.BLOCK,id:"blockCollapseExpand",weight:4})},Qd=function(){wn.registry.register({displayText(t){return t.block.hasDisabledReason(xa)?n.Msg$$module$build$src$core$msg.ENABLE_BLOCK:n.Msg$$module$build$src$core$msg.DISABLE_BLOCK},preconditionFn(t){if(t=t.block,!t.isInFlyout&&t.workspace.options.disable&&t.isEditable()){var o=t.getDisabledReasons();return o=o.size>(o.has(xa)?1:0),t.getInheritedDisabled()||o?"disabled":"enabled"}return"hidden"},callback(t){t=t.block;const o=n.getGroup$$module$build$src$core$events$utils();o||n.setGroup$$module$build$src$core$events$utils(!0),t.setDisabledReason(!t.hasDisabledReason(xa),xa),n.setGroup$$module$build$src$core$events$utils(o)},scopeType:wn.ScopeType.BLOCK,id:"blockDisable",weight:5})},fh=function(){wn.registry.register({displayText(t){var o=t.block;return t=o.getDescendants(!1).length,(o=o.getNextBlock())&&(t-=o.getDescendants(!1).length),t===1?n.Msg$$module$build$src$core$msg.DELETE_BLOCK:n.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",`${t}`)},preconditionFn(t){return!t.block.isInFlyout&&t.block.isDeletable()?"enabled":"hidden"},callback(t){t.block&&t.block.checkAndDelete()},scopeType:wn.ScopeType.BLOCK,id:"blockDelete",weight:6})},ph=function(){wn.registry.register({displayText(){return n.Msg$$module$build$src$core$msg.HELP},preconditionFn(t){return t=t.block,(typeof t.helpUrl=="function"?t.helpUrl():t.helpUrl)?"enabled":"hidden"},callback(t){t.block.showHelp()},scopeType:wn.ScopeType.BLOCK,id:"blockHelp",weight:7})},Gr=function(){wn.registry.register({displayText:()=>n.Msg$$module$build$src$core$msg.REMOVE_COMMENT,preconditionFn(t){let o;return(o=t.comment)!=null&&o.isDeletable()?"enabled":"hidden"},callback(t){n.setGroup$$module$build$src$core$events$utils(!0);let o;(o=t.comment)==null||o.dispose(),n.setGroup$$module$build$src$core$events$utils(!1)},scopeType:wn.ScopeType.COMMENT,id:"commentDelete",weight:6})},$a=function(){wn.registry.register({displayText:()=>n.Msg$$module$build$src$core$msg.DUPLICATE_COMMENT,preconditionFn(t){let o;return(o=t.comment)!=null&&o.isMovable()?"enabled":"hidden"},callback(t){if(t.comment){var o=t.comment.toCopyData();o&&Yo(o,t.comment.workspace)}},scopeType:wn.ScopeType.COMMENT,id:"commentDuplicate",weight:1})},Ls=function(){wn.registry.register({displayText:()=>n.Msg$$module$build$src$core$msg.ADD_COMMENT,preconditionFn:()=>"enabled",callback:(t,o)=>{if(t=t.workspace){n.setGroup$$module$build$src$core$events$utils(!0);var c=new ay(t);c.setText(n.Msg$$module$build$src$core$msg.WORKSPACE_COMMENT_DEFAULT_TEXT),c.moveTo(ef(new At(o.clientX,o.clientY),t)),n.setSelected$$module$build$src$core$common(c),n.setGroup$$module$build$src$core$events$utils(!1)}},scopeType:wn.ScopeType.WORKSPACE,id:"commentCreate",weight:8})},ef=function(t,o){var c=o.getInjectionDiv().getBoundingClientRect();return t=new At(t.x-c.left,t.y-c.top),c=o.getOriginOffsetInPixels(),t=At.difference(t,c),t.scale(1/o.scale),t},ps=function(){hh(),Sa(),dh(),Xc(),Qd(),fh(),ph()},W_=function(){$a(),Gr(),Ls()},tf=function(){al(),ps()},lm=function(t){return t.paste!==void 0},HE=function(t){return t.getSvgRoot!==void 0},ll=function(t){return typeof t.id=="string"&&t.workspace!==void 0&&t.select!==void 0&&t.unselect!==void 0},X_=function(t){return t.isSelectable()},j_=function(t){ne().hideChaff(t)},vt=vt||{},vt.scope={},vt.ASSUME_ES5=!1,vt.ASSUME_NO_NATIVE_MAP=!1,vt.ASSUME_NO_NATIVE_SET=!1,vt.SIMPLE_FROUND_POLYFILL=!1,vt.ISOLATE_POLYFILLS=!1,vt.FORCE_POLYFILL_PROMISE=!1,vt.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,vt.defineProperty=vt.ASSUME_ES5||typeof Object.defineProperties=="function"?Object.defineProperty:function(t,o,c){return t==Array.prototype||t==Object.prototype||(t[o]=c.value),t},vt.getGlobal=function(t){t=[typeof globalThis=="object"&&globalThis,t,typeof window=="object"&&window,typeof self=="object"&&self,typeof qf=="object"&&qf];for(var o=0;o<t.length;++o){var c=t[o];if(c&&c.Math==Math)return c}throw Error("Cannot find global object")},vt.global=vt.getGlobal(this),vt.IS_SYMBOL_NATIVE=typeof Symbol=="function"&&typeof Symbol("x")=="symbol",vt.TRUST_ES6_POLYFILLS=!vt.ISOLATE_POLYFILLS||vt.IS_SYMBOL_NATIVE,vt.polyfills={},vt.propertyToPolyfillSymbol={},vt.POLYFILL_PREFIX="$jscp$",vt.polyfill=function(t,o,c,g){o&&(vt.ISOLATE_POLYFILLS?vt.polyfillIsolated(t,o,c,g):vt.polyfillUnisolated(t,o,c,g))},vt.polyfillUnisolated=function(t,o,c,g){for(c=vt.global,t=t.split("."),g=0;g<t.length-1;g++){var $=t[g];if(!($ in c))return;c=c[$]}t=t[t.length-1],g=c[t],o=o(g),o!=g&&o!=null&&vt.defineProperty(c,t,{configurable:!0,writable:!0,value:o})},vt.polyfillIsolated=function(t,o,c,g){var $=t.split(".");t=$.length===1,g=$[0],g=!t&&g in vt.polyfills?vt.polyfills:vt.global;for(var M=0;M<$.length-1;M++){var Q=$[M];if(!(Q in g))return;g=g[Q]}$=$[$.length-1],c=vt.IS_SYMBOL_NATIVE&&c==="es6"?g[$]:null,o=o(c),o!=null&&(t?vt.defineProperty(vt.polyfills,$,{configurable:!0,writable:!0,value:o}):o!==c&&(vt.propertyToPolyfillSymbol[$]===void 0&&(c=1e9*Math.random()>>>0,vt.propertyToPolyfillSymbol[$]=vt.IS_SYMBOL_NATIVE?vt.global.Symbol($):vt.POLYFILL_PREFIX+c+"$"+$),vt.defineProperty(g,vt.propertyToPolyfillSymbol[$],{configurable:!0,writable:!0,value:o})))},vt.underscoreProtoCanBeSet=function(){var t={a:!0},o={};try{return o.__proto__=t,o.a}catch{}return!1},vt.setPrototypeOf=vt.TRUST_ES6_POLYFILLS&&typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf:vt.underscoreProtoCanBeSet()?function(t,o){if(t.__proto__=o,t.__proto__!==o)throw new TypeError(t+" is not extensible");return t}:null,vt.arrayIteratorImpl=function(t){var o=0;return function(){return o<t.length?{done:!1,value:t[o++]}:{done:!0}}},vt.arrayIterator=function(t){return{next:vt.arrayIteratorImpl(t)}},vt.makeIterator=function(t){var o=typeof Symbol<"u"&&Symbol.iterator&&t[Symbol.iterator];if(o)return o.call(t);if(typeof t.length=="number")return vt.arrayIterator(t);throw Error(String(t)+" is not an iterable or ArrayLike")},vt.generator={},vt.generator.ensureIteratorResultIsObject_=function(t){if(!(t instanceof Object))throw new TypeError("Iterator result "+t+" is not an object")},vt.generator.Context=function(){this.isRunning_=!1,this.yieldAllIterator_=null,this.yieldResult=void 0,this.nextAddress=1,this.finallyAddress_=this.catchAddress_=0,this.finallyContexts_=this.abruptCompletion_=null},vt.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0},vt.generator.Context.prototype.stop_=function(){this.isRunning_=!1},vt.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_},vt.generator.Context.prototype.next_=function(t){this.yieldResult=t},vt.generator.Context.prototype.throw_=function(t){this.abruptCompletion_={exception:t,isException:!0},this.jumpToErrorHandler_()},vt.generator.Context.prototype.return=function(t){this.abruptCompletion_={return:t},this.nextAddress=this.finallyAddress_},vt.generator.Context.prototype.jumpThroughFinallyBlocks=function(t){this.abruptCompletion_={jumpTo:t},this.nextAddress=this.finallyAddress_},vt.generator.Context.prototype.yield=function(t,o){return this.nextAddress=o,{value:t}},vt.generator.Context.prototype.yieldAll=function(t,o){t=vt.makeIterator(t);var c=t.next();if(vt.generator.ensureIteratorResultIsObject_(c),c.done)this.yieldResult=c.value,this.nextAddress=o;else return this.yieldAllIterator_=t,this.yield(c.value,o)},vt.generator.Context.prototype.jumpTo=function(t){this.nextAddress=t},vt.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0},vt.generator.Context.prototype.setCatchFinallyBlocks=function(t,o){this.catchAddress_=t,o!=null&&(this.finallyAddress_=o)},vt.generator.Context.prototype.setFinallyBlock=function(t){this.catchAddress_=0,this.finallyAddress_=t||0},vt.generator.Context.prototype.leaveTryBlock=function(t,o){this.nextAddress=t,this.catchAddress_=o||0},vt.generator.Context.prototype.enterCatchBlock=function(t){return this.catchAddress_=t||0,t=this.abruptCompletion_.exception,this.abruptCompletion_=null,t},vt.generator.Context.prototype.enterFinallyBlock=function(t,o,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_],this.catchAddress_=t||0,this.finallyAddress_=o||0},vt.generator.Context.prototype.leaveFinallyBlock=function(t,o){if(o=this.finallyContexts_.splice(o||0)[0],o=this.abruptCompletion_=this.abruptCompletion_||o){if(o.isException)return this.jumpToErrorHandler_();o.jumpTo!=null&&this.finallyAddress_<o.jumpTo?(this.nextAddress=o.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=t},vt.generator.Context.prototype.forIn=function(t){return new vt.generator.Context.PropertyIterator(t)},vt.generator.Context.PropertyIterator=function(t){this.object_=t,this.properties_=[];for(var o in t)this.properties_.push(o);this.properties_.reverse()},vt.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var t=this.properties_.pop();if(t in this.object_)return t}return null},vt.generator.Engine_=function(t){this.context_=new vt.generator.Context,this.program_=t},vt.generator.Engine_.prototype.next_=function(t){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.next,t,this.context_.next_):(this.context_.next_(t),this.nextStep_())},vt.generator.Engine_.prototype.return_=function(t){this.context_.start_();var o=this.context_.yieldAllIterator_;return o?this.yieldAllStep_("return"in o?o.return:function(c){return{value:c,done:!0}},t,this.context_.return):(this.context_.return(t),this.nextStep_())},vt.generator.Engine_.prototype.throw_=function(t){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.throw,t,this.context_.next_):(this.context_.throw_(t),this.nextStep_())},vt.generator.Engine_.prototype.yieldAllStep_=function(t,o,c){try{var g=t.call(this.context_.yieldAllIterator_,o);if(vt.generator.ensureIteratorResultIsObject_(g),!g.done)return this.context_.stop_(),g;var $=g.value}catch(M){return this.context_.yieldAllIterator_=null,this.context_.throw_(M),this.nextStep_()}return this.context_.yieldAllIterator_=null,c.call(this.context_,$),this.nextStep_()},vt.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var t=this.program_(this.context_);if(t)return this.context_.stop_(),{value:t.value,done:!1}}catch(o){this.context_.yieldResult=void 0,this.context_.throw_(o)}if(this.context_.stop_(),this.context_.abruptCompletion_){if(t=this.context_.abruptCompletion_,this.context_.abruptCompletion_=null,t.isException)throw t.exception;return{value:t.return,done:!0}}return{value:void 0,done:!0}},vt.generator.Generator_=function(t){this.next=function(o){return t.next_(o)},this.throw=function(o){return t.throw_(o)},this.return=function(o){return t.return_(o)},this[Symbol.iterator]=function(){return this}},vt.generator.createGenerator=function(t,o){return o=new vt.generator.Generator_(new vt.generator.Engine_(o)),vt.setPrototypeOf&&t.prototype&&vt.setPrototypeOf(o,t.prototype),o},vt.asyncExecutePromiseGenerator=function(t){function o(g){return t.next(g)}function c(g){return t.throw(g)}return new Promise(function(g,$){function M(Q){Q.done?g(Q.value):Promise.resolve(Q.value).then(o,c).then(M,$)}M(t.next())})},vt.asyncExecutePromiseGeneratorFunction=function(t){return vt.asyncExecutePromiseGenerator(t())},vt.asyncExecutePromiseGeneratorProgram=function(t){return vt.asyncExecutePromiseGenerator(new vt.generator.Generator_(new vt.generator.Engine_(t)))},vt.polyfill("globalThis",function(t){return t||vt.global},"es_2020","es3"),vt.polyfill("Array.prototype.includes",function(t){return t||function(o,c){var g=this;g instanceof String&&(g=String(g));var $=g.length;for(c=c||0,0>c&&(c=Math.max(c+$,0));c<$;c++){var M=g[c];if(M===o||Object.is(M,o))return!0}return!1}},"es7","es3"),vt.initSymbol=function(){},vt.iteratorPrototype=function(t){return t={next:t},t[Symbol.iterator]=function(){return this},t},vt.iteratorFromArray=function(t,o){t instanceof String&&(t+="");var c=0,g=!1,$={next:function(){if(!g&&c<t.length){var M=c++;return{value:o(M,t[M]),done:!1}}return g=!0,{done:!0,value:void 0}}};return $[Symbol.iterator]=function(){return $},$},vt.polyfill("Array.prototype.values",function(t){return t||function(){return vt.iteratorFromArray(this,function(o,c){return c})}},"es8","es3"),vt.polyfill("Array.prototype.flat",function(t){return t||function(o){o=o===void 0?1:o;var c=[];return Array.prototype.forEach.call(this,function(g){Array.isArray(g)&&0<o?(g=Array.prototype.flat.call(g,o-1),c.push.apply(c,g)):c.push(g)}),c}},"es9","es5"),vt.polyfill("Array.prototype.flatMap",function(t){return t||function(o,c){var g=[];return Array.prototype.forEach.call(this,function($,M){$=o.call(c,$,M,this),Array.isArray($)?g.push.apply(g,$):g.push($)}),g}},"es9","es5"),vt.owns=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},vt.polyfill("Object.entries",function(t){return t||function(o){var c=[],g;for(g in o)vt.owns(o,g)&&c.push([g,o[g]]);return c}},"es8","es3"),vt.polyfill("Object.values",function(t){return t||function(o){var c=[],g;for(g in o)vt.owns(o,g)&&c.push(o[g]);return c}},"es8","es3");var Ns=Object.create(null),VE={typeMap:Ns},nf=Object.create(null),yo="default",yt=class{constructor(t){this.name=t}toString(){return this.name}};yt.CONNECTION_CHECKER=new yt("connectionChecker"),yt.CONNECTION_PREVIEWER=new yt("connectionPreviewer"),yt.CURSOR=new yt("cursor"),yt.EVENT=new yt("event"),yt.FIELD=new yt("field"),yt.INPUT=new yt("input"),yt.RENDERER=new yt("renderer"),yt.TOOLBOX=new yt("toolbox"),yt.THEME=new yt("theme"),yt.TOOLBOX_ITEM=new yt("toolboxItem"),yt.FLYOUTS_VERTICAL_TOOLBOX=new yt("flyoutsVerticalToolbox"),yt.FLYOUTS_HORIZONTAL_TOOLBOX=new yt("flyoutsHorizontalToolbox"),yt.METRICS_MANAGER=new yt("metricsManager"),yt.BLOCK_DRAGGER=new yt("blockDragger"),yt.SERIALIZER=new yt("serializer"),yt.ICON=new yt("icon"),yt.PASTER=new yt("paster");var cl={DEFAULT:yo,TEST_ONLY:VE};cl.Type=yt,cl.getAllItems=f,cl.getClass=d,cl.getClassFromOptions=p,cl.getObject=h,cl.hasItem=u,cl.register=r,cl.unregister=a;var ks=Object.create(null),Y_="!#$%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",K_={genUid:()=>{const t=Y_.length,o=[];for(let c=0;20>c;c++)o[c]=Y_.charAt(Math.random()*t);return o.join("")}},jc=0,J_={TEST_ONLY:K_};J_.genUid=T,J_.getNextUniqueId=m;var ul,Yc,Hr,Kc,ba,Jc,mh,rf,sc,gh,cr,oc,Aa,to,hl,So,Ko,Jo,ac,_h,Ca,vh,lc,sf,Th,Zc,cm,_;ul="",Yc=!0,Hr=0,n.CREATE$$module$build$src$core$events$utils="create",n.CREATE$$module$build$src$core$events$utils,n.DELETE$$module$build$src$core$events$utils="delete",n.DELETE$$module$build$src$core$events$utils,n.CHANGE$$module$build$src$core$events$utils="change",n.CHANGE$$module$build$src$core$events$utils,Kc="block_field_intermediate_change",n.MOVE$$module$build$src$core$events$utils="move",n.MOVE$$module$build$src$core$events$utils,ba="var_create",Jc="var_delete",mh="var_rename",rf="ui",sc="drag",gh="selected",cr="click",oc="marker_move",Aa="bubble_open",to="trashcan_open",hl="toolbox_item_select",So="theme_change",Ko="viewport_change",Jo="comment_create",ac="comment_delete",_h="comment_change",Ca="comment_move",vh="comment_collapse",lc="finished_loading",sf="ORPHANED_BLOCK",Th=[n.CREATE$$module$build$src$core$events$utils,n.MOVE$$module$build$src$core$events$utils,Jo,Ca],Zc=[],cm={FIRE_QUEUE:Zc,fireNow:S,fireInternal:y,setGroupInternal:I},_={BLOCK_CHANGE:n.CHANGE$$module$build$src$core$events$utils,BLOCK_CREATE:n.CREATE$$module$build$src$core$events$utils,BLOCK_DELETE:n.DELETE$$module$build$src$core$events$utils,BLOCK_DRAG:sc,BLOCK_FIELD_INTERMEDIATE_CHANGE:Kc,BLOCK_MOVE:n.MOVE$$module$build$src$core$events$utils,BUBBLE_OPEN:Aa,BUMP_EVENTS:Th,CHANGE:n.CHANGE$$module$build$src$core$events$utils,CLICK:cr,COMMENT_CHANGE:_h,COMMENT_COLLAPSE:vh,COMMENT_CREATE:Jo,COMMENT_DELETE:ac,COMMENT_MOVE:Ca,CREATE:n.CREATE$$module$build$src$core$events$utils,DELETE:n.DELETE$$module$build$src$core$events$utils,FINISHED_LOADING:lc,MARKER_MOVE:oc,MOVE:n.MOVE$$module$build$src$core$events$utils,SELECTED:gh,TEST_ONLY:cm,THEME_CHANGE:So,TOOLBOX_ITEM_SELECT:hl,TRASHCAN_OPEN:to,UI:rf,VAR_CREATE:ba,VAR_DELETE:Jc,VAR_RENAME:mh,VIEWPORT_CHANGE:Ko},_.clearPendingUndo=C,_.disable=n.disable$$module$build$src$core$events$utils,_.disableOrphans=D,_.enable=n.enable$$module$build$src$core$events$utils,_.filter=A,_.fire=b,_.fromJson=F,_.get=k,_.getDescendantIds=O,_.getGroup=n.getGroup$$module$build$src$core$events$utils,_.getRecordUndo=E,_.isEnabled=R,_.setGroup=n.setGroup$$module$build$src$core$events$utils,_.setRecordUndo=n.setRecordUndo$$module$build$src$core$events$utils;var v=Object.create(null),x,w=null,P,V=[],$e={defineBlocksWithJsonArrayInternal:he},Pe={TEST_ONLY:$e};Pe.createBlockDefinitionsFromJsonArray=n.createBlockDefinitionsFromJsonArray$$module$build$src$core$common,Pe.defineBlocks=n.defineBlocks$$module$build$src$core$common,Pe.defineBlocksWithJsonArray=Y,Pe.draggingConnections=V,Pe.getAllWorkspaces=ce,Pe.getBlockTypeCounts=K,Pe.getMainWorkspace=ne,Pe.getParentContainer=xe,Pe.getSelected=de,Pe.getWorkspaceById=U,Pe.registerWorkspace=ie,Pe.setMainWorkspace=pe,Pe.setParentContainer=H,Pe.setSelected=n.setSelected$$module$build$src$core$common,Pe.svgResize=J,Pe.unregisterWorkpace=ae;var ht=class{constructor(){this.workspaceId=void 0,this.isUiEvent=!1,this.type="",this.group=n.getGroup$$module$build$src$core$events$utils(),this.recordUndo=E()}toJson(){return{type:this.type,group:this.group}}static fromJson(t,o,c){return c.isBlank=!1,c.group=t.group||"",c.workspaceId=o.id,c}isNull(){return!1}run(t){}getEventWorkspace_(){let t;if(this.workspaceId&&(t=U(this.workspaceId)),!t)throw Error("Workspace is null. Event must have been generated from real Blockly events.");return t}},Rt=class extends ht{constructor(t){super(),this.recordUndo=!1,this.isUiEvent=!0,this.isBlank=typeof t>"u",this.workspaceId=t||""}},Gt=class extends Rt{constructor(t,o,c){o=t?t.workspace.id:o,o===null&&(o=void 0),super(o),this.type=cr,this.blockId=t?t.id:void 0,this.targetType=c}toJson(){const t=super.toJson();if(!this.targetType)throw Error("The click target type is undefined. Either pass a block to the constructor, or call fromJson");return t.targetType=this.targetType,t.blockId=this.blockId,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new Gt),o.targetType=t.targetType,o.blockId=t.blockId,o}},En;(function(t){t.BLOCK="block",t.WORKSPACE="workspace",t.ZOOM_CONTROLS="zoom_controls"})(En||(En={})),r(yt.EVENT,cr,Gt);var cn=750,_i="ontouchstart"in globalThis||!!(globalThis.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!globalThis.navigator||!globalThis.navigator.maxTouchPoints&&!globalThis.navigator.msMaxTouchPoints),Jt=null,Wi={mousedown:["pointerdown"],mouseenter:["pointerenter"],mouseleave:["pointerleave"],mousemove:["pointermove"],mouseout:["pointerout"],mouseover:["pointerover"],mouseup:["pointerup","pointercancel"],touchend:["pointerup"],touchcancel:["pointercancel"]},ms=0,Qe={TOUCH_ENABLED:_i,TOUCH_MAP:Wi};Qe.checkTouchIdentifier=et,Qe.clearTouchIdentifier=_e,Qe.getTouchIdentifierFromEvent=De,Qe.longStart=ue,Qe.longStop=Te,Qe.shouldHandleEvent=Re;var He,ct,Pt,en,Sn,vn,Wn,_r,Yn,dl;(function(t){function o(g){return c.includes(g.toUpperCase())}He=t;const c=He.toUpperCase();ct=o("JavaFX"),Pt=o("WebKit"),en=o("Gecko")&&!Pt,Sn=o("Android"),t=globalThis.navigator&&globalThis.navigator.maxTouchPoints,vn=o("iPad")||o("Macintosh")&&0<t,Wn=o("iPhone")&&!vn,_r=o("Macintosh"),Yn=vn||Sn&&!o("Mobile")||o("Silk"),dl=!Yn&&(Wn||Sn)})(globalThis.navigator&&globalThis.navigator.userAgent||"");var Q$=He,pI=ct,mI=en,eb=Sn,Z_=vn,gI=Wn,tb=_r,_I=dl,tG={ANDROID:eb,GECKO:mI,IPAD:Z_,IPHONE:gI,JavaFx:pI,MAC:tb,MOBILE:_I,raw:Q$},vI=40,TI=125,qc={};qc.bind=Le,qc.conditionalBind=Ue,qc.getScrollDeltaPixels=Xe,qc.isRightButton=Fe,qc.isTargetInput=Ye,qc.mouseToSvg=Ze,qc.unbind=re;var EI={};EI.removeElem=dt;var Qc=class{constructor(t){this.name_=t}toString(){return this.name_}};Qc.POSITIONABLE=new Qc("positionable"),Qc.DRAG_TARGET=new Qc("drag_target"),Qc.DELETE_AREA=new Qc("delete_area"),Qc.AUTOHIDEABLE=new Qc("autohideable");var Vr=class{constructor(){this.componentData=new Map,this.capabilityToComponentIds=new Map}addComponent(t,o){const c=t.component.id;if(!o&&this.componentData.has(c)){var g;throw Error('Plugin "'+c+'" with capabilities "'+((g=this.componentData.get(c))==null?void 0:g.capabilities)+'" already added.')}for(this.componentData.set(c,t),o=[],g=0;g<t.capabilities.length;g++){const $=String(t.capabilities[g]).toLowerCase();if(o.push($),this.capabilityToComponentIds.has($)){let M;(M=this.capabilityToComponentIds.get($))==null||M.push(c)}else this.capabilityToComponentIds.set($,[c])}this.componentData.get(c).capabilities=o}removeComponent(t){const o=this.componentData.get(t);if(o){for(let c=0;c<o.capabilities.length;c++){const g=String(o.capabilities[c]).toLowerCase();dt(this.capabilityToComponentIds.get(g),t)}this.componentData.delete(t)}}addCapability(t,o){if(!this.getComponent(t))throw Error('Cannot add capability, "'+o+'". Plugin "'+t+'" has not been added to the ComponentManager');if(this.hasCapability(t,o))console.warn('Plugin "'+t+'already has capability "'+o+'"');else{o=`${o}`.toLowerCase();var c;(c=this.componentData.get(t))==null||c.capabilities.push(o);var g;(g=this.capabilityToComponentIds.get(o))==null||g.push(t)}}removeCapability(t,o){if(!this.getComponent(t))throw Error('Cannot remove capability, "'+o+'". Plugin "'+t+'" has not been added to the ComponentManager');this.hasCapability(t,o)?(o=`${o}`.toLowerCase(),dt(this.componentData.get(t).capabilities,o),dt(this.capabilityToComponentIds.get(o),t)):console.warn('Plugin "'+t+`doesn't have capability "`+o+'" to remove')}hasCapability(t,o){return o=`${o}`.toLowerCase(),this.componentData.has(t)&&this.componentData.get(t).capabilities.includes(o)}getComponent(t){let o;return(o=this.componentData.get(t))==null?void 0:o.component}getComponents(t,o){if(t=`${t}`.toLowerCase(),t=this.capabilityToComponentIds.get(t),!t)return[];const c=[];if(o){const g=[];t.forEach($=>{g.push(this.componentData.get($))}),g.sort(function($,M){return $.weight-M.weight}),g.forEach(function($){c.push($.component)})}else t.forEach(g=>{c.push(this.componentData.get(g).component)});return c}};Vr.Capability=Qc;var nb=!1,ib=`
.blocklySvg {
  background-color: #fff;
  outline: none;
  overflow: hidden;  /* IE overflows by default. */
  position: absolute;
  display: block;
}

.blocklyWidgetDiv {
  display: none;
  position: absolute;
  z-index: 99999;  /* big value for bootstrap3 compatibility */
}

.injectionDiv {
  height: 100%;
  position: relative;
  overflow: hidden;  /* So blocks in drag surface disappear at edges */
  touch-action: none;
}

.blocklyNonSelectable {
  user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
}

.blocklyBlockCanvas.blocklyCanvasTransitioning,
.blocklyBubbleCanvas.blocklyCanvasTransitioning {
  transition: transform .5s;
}

.blocklyTooltipDiv {
  background-color: #ffffc7;
  border: 1px solid #ddc;
  box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);
  color: #000;
  display: none;
  font: 9pt sans-serif;
  opacity: .9;
  padding: 2px;
  position: absolute;
  z-index: 100000;  /* big value for bootstrap3 compatibility */
}

.blocklyDropDownDiv {
  position: absolute;
  left: 0;
  top: 0;
  z-index: 1000;
  display: none;
  border: 1px solid;
  border-color: #dadce0;
  background-color: #fff;
  border-radius: 2px;
  padding: 4px;
  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);
}

.blocklyDropDownDiv.blocklyFocused {
  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);
}

.blocklyDropDownContent {
  max-height: 300px;  /* @todo: spec for maximum height. */
  overflow: auto;
  overflow-x: hidden;
  position: relative;
}

.blocklyDropDownArrow {
  position: absolute;
  left: 0;
  top: 0;
  width: 16px;
  height: 16px;
  z-index: -1;
  background-color: inherit;
  border-color: inherit;
}

.blocklyDropDownButton {
  display: inline-block;
  float: left;
  padding: 0;
  margin: 4px;
  border-radius: 4px;
  outline: none;
  border: 1px solid;
  transition: box-shadow .1s;
  cursor: pointer;
}

.blocklyArrowTop {
  border-top: 1px solid;
  border-left: 1px solid;
  border-top-left-radius: 4px;
  border-color: inherit;
}

.blocklyArrowBottom {
  border-bottom: 1px solid;
  border-right: 1px solid;
  border-bottom-right-radius: 4px;
  border-color: inherit;
}

.blocklyResizeSE {
  cursor: se-resize;
  fill: #aaa;
}

.blocklyResizeSW {
  cursor: sw-resize;
  fill: #aaa;
}

.blocklyResizeLine {
  stroke: #515A5A;
  stroke-width: 1;
}

.blocklyHighlightedConnectionPath {
  fill: none;
  stroke: #fc3;
  stroke-width: 4px;
}

.blocklyPathLight {
  fill: none;
  stroke-linecap: round;
  stroke-width: 1;
}

.blocklySelected>.blocklyPathLight {
  display: none;
}

.blocklyDraggable {
  cursor: grab;
  cursor: -webkit-grab;
}

.blocklyDragging {
  cursor: grabbing;
  cursor: -webkit-grabbing;
  /* Drag surface disables events to not block the toolbox, so we have to
   * reenable them here for the cursor values to work. */
  pointer-events: auto;
}

  /* Changes cursor on mouse down. Not effective in Firefox because of
     https://bugzilla.mozilla.org/show_bug.cgi?id=771241 */
.blocklyDraggable:active {
  cursor: grabbing;
  cursor: -webkit-grabbing;
}

.blocklyDragging.blocklyDraggingDelete {
  cursor: url("<<<PATH>>>/handdelete.cur"), auto;
}

.blocklyDragging>.blocklyPath,
.blocklyDragging>.blocklyPathLight {
  fill-opacity: .8;
  stroke-opacity: .8;
}

.blocklyDragging>.blocklyPathDark {
  display: none;
}

.blocklyDisabled>.blocklyPath {
  fill-opacity: .5;
  stroke-opacity: .5;
}

.blocklyDisabled>.blocklyPathLight,
.blocklyDisabled>.blocklyPathDark {
  display: none;
}

.blocklyInsertionMarker>.blocklyPath,
.blocklyInsertionMarker>.blocklyPathLight,
.blocklyInsertionMarker>.blocklyPathDark {
  fill-opacity: .2;
  stroke: none;
}

.blocklyMultilineText {
  font-family: monospace;
}

.blocklyNonEditableText>text {
  pointer-events: none;
}

.blocklyFlyout {
  position: absolute;
  z-index: 20;
}

.blocklyText text {
  cursor: default;
}

/*
  Don't allow users to select text.  It gets annoying when trying to
  drag a block and selected text moves instead.
*/
.blocklySvg text {
  user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
  cursor: inherit;
}

.blocklyHidden {
  display: none;
}

.blocklyFieldDropdown:not(.blocklyHidden) {
  display: block;
}

.blocklyIconGroup {
  cursor: default;
}

.blocklyIconGroup:not(:hover),
.blocklyIconGroupReadonly {
  opacity: .6;
}

.blocklyIconShape {
  fill: #00f;
  stroke: #fff;
  stroke-width: 1px;
}

.blocklyIconSymbol {
  fill: #fff;
}

.blocklyMinimalBody {
  margin: 0;
  padding: 0;
  height: 100%;
}

.blocklyHtmlInput {
  border: none;
  border-radius: 4px;
  height: 100%;
  margin: 0;
  outline: none;
  padding: 0;
  width: 100%;
  text-align: center;
  display: block;
  box-sizing: border-box;
}

/* Remove the increase and decrease arrows on the field number editor */
input.blocklyHtmlInput[type=number]::-webkit-inner-spin-button,
input.blocklyHtmlInput[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

input[type=number] {
  -moz-appearance: textfield;
}

.blocklyMainBackground {
  stroke-width: 1;
  stroke: #c6c6c6;  /* Equates to #ddd due to border being off-pixel. */
}

.blocklyMutatorBackground {
  fill: #fff;
  stroke: #ddd;
  stroke-width: 1;
}

.blocklyFlyoutBackground {
  fill: #ddd;
  fill-opacity: .8;
}

.blocklyMainWorkspaceScrollbar {
  z-index: 20;
}

.blocklyFlyoutScrollbar {
  z-index: 30;
}

.blocklyScrollbarHorizontal,
.blocklyScrollbarVertical {
  position: absolute;
  outline: none;
}

.blocklyScrollbarBackground {
  opacity: 0;
}

.blocklyScrollbarHandle {
  fill: #ccc;
}

.blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,
.blocklyScrollbarHandle:hover {
  fill: #bbb;
}

/* Darken flyout scrollbars due to being on a grey background. */
/* By contrast, workspace scrollbars are on a white background. */
.blocklyFlyout .blocklyScrollbarHandle {
  fill: #bbb;
}

.blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,
.blocklyFlyout .blocklyScrollbarHandle:hover {
  fill: #aaa;
}

.blocklyInvalidInput {
  background: #faa;
}

.blocklyVerticalMarker {
  stroke-width: 3px;
  fill: rgba(255,255,255,.5);
  pointer-events: none;
}

.blocklyComputeCanvas {
  position: absolute;
  width: 0;
  height: 0;
}

.blocklyNoPointerEvents {
  pointer-events: none;
}

.blocklyContextMenu {
  border-radius: 4px;
  max-height: 100%;
}

.blocklyDropdownMenu {
  border-radius: 2px;
  padding: 0 !important;
}

.blocklyDropdownMenu .blocklyMenuItem {
  /* 28px on the left for icon or checkbox. */
  padding-left: 28px;
}

/* BiDi override for the resting state. */
.blocklyDropdownMenu .blocklyMenuItemRtl {
  /* Flip left/right padding for BiDi. */
  padding-left: 5px;
  padding-right: 28px;
}

.blocklyWidgetDiv .blocklyMenu {
  background: #fff;
  border: 1px solid transparent;
  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);
  font: normal 13px Arial, sans-serif;
  margin: 0;
  outline: none;
  padding: 4px 0;
  position: absolute;
  overflow-y: auto;
  overflow-x: hidden;
  max-height: 100%;
  z-index: 20000;  /* Arbitrary, but some apps depend on it... */
}

.blocklyWidgetDiv .blocklyMenu.blocklyFocused {
  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);
}

.blocklyDropDownDiv .blocklyMenu {
  background: inherit;  /* Compatibility with gapi, reset from goog-menu */
  border: inherit;  /* Compatibility with gapi, reset from goog-menu */
  font: normal 13px "Helvetica Neue", Helvetica, sans-serif;
  outline: none;
  position: relative;  /* Compatibility with gapi, reset from goog-menu */
  z-index: 20000;  /* Arbitrary, but some apps depend on it... */
}

/* State: resting. */
.blocklyMenuItem {
  border: none;
  color: #000;
  cursor: pointer;
  list-style: none;
  margin: 0;
  /* 7em on the right for shortcut. */
  min-width: 7em;
  padding: 6px 15px;
  white-space: nowrap;
}

/* State: disabled. */
.blocklyMenuItemDisabled {
  color: #ccc;
  cursor: inherit;
}

/* State: hover. */
.blocklyMenuItemHighlight {
  background-color: rgba(0,0,0,.1);
}

/* State: selected/checked. */
.blocklyMenuItemCheckbox {
  height: 16px;
  position: absolute;
  width: 16px;
}

.blocklyMenuItemSelected .blocklyMenuItemCheckbox {
  background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;
  float: left;
  margin-left: -24px;
  position: static;  /* Scroll with the menu. */
}

.blocklyMenuItemRtl .blocklyMenuItemCheckbox {
  float: right;
  margin-right: -24px;
}

.blocklyBlockDragSurface, .blocklyAnimationLayer {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: visible !important;
  z-index: 80;
  pointer-events: none;
}
`,rb={};rb.inject=it,rb.register=je;var At=class{constructor(t,o){this.x=t,this.y=o}clone(){return new At(this.x,this.y)}scale(t){return this.x*=t,this.y*=t,this}translate(t,o){return this.x+=t,this.y+=o,this}static equals(t,o){return t===o?!0:t&&o?t.x===o.x&&t.y===o.y:!1}static distance(t,o){const c=t.x-o.x;return t=t.y-o.y,Math.sqrt(c*c+t*t)}static magnitude(t){return Math.sqrt(t.x*t.x+t.y*t.y)}static difference(t,o){return new At(t.x-o.x,t.y-o.y)}static sum(t,o){return new At(t.x+o.x,t.y+o.y)}},q_="http://www.w3.org/2000/svg",cc="http://www.w3.org/1999/xhtml",Zo="http://www.w3.org/1999/xlink",eu;(function(t){t[t.ELEMENT_NODE=1]="ELEMENT_NODE",t[t.TEXT_NODE=3]="TEXT_NODE",t[t.COMMENT_NODE=8]="COMMENT_NODE"})(eu||(eu={}));var fl=null,sb=0,zE=null,ns={HTML_NS:cc};ns.NodeType=eu,ns.SVG_NS=q_,ns.XLINK_NS=Zo,ns.addClass=Me,ns.createSvgElement=Ce,ns.getFastTextWidth=Ge,ns.getFastTextWidthWithSizeString=$t,ns.getTextWidth=ft,ns.hasClass=ee,ns.insertAfter=ot,ns.measureFontMetrics=L,ns.removeClass=oe,ns.removeClasses=St,ns.removeNode=W,ns.setCssTransform=ze,ns.startTextWidthCache=qe,ns.stopTextWidthCache=ut;var Ve=class{constructor(t){this.tagName=t}toString(){return this.tagName}};Ve.ANIMATE=new Ve("animate"),Ve.CIRCLE=new Ve("circle"),Ve.CLIPPATH=new Ve("clipPath"),Ve.DEFS=new Ve("defs"),Ve.FECOMPOSITE=new Ve("feComposite"),Ve.FECOMPONENTTRANSFER=new Ve("feComponentTransfer"),Ve.FEFLOOD=new Ve("feFlood"),Ve.FEFUNCA=new Ve("feFuncA"),Ve.FEGAUSSIANBLUR=new Ve("feGaussianBlur"),Ve.FEPOINTLIGHT=new Ve("fePointLight"),Ve.FESPECULARLIGHTING=new Ve("feSpecularLighting"),Ve.FILTER=new Ve("filter"),Ve.FOREIGNOBJECT=new Ve("foreignObject"),Ve.G=new Ve("g"),Ve.IMAGE=new Ve("image"),Ve.LINE=new Ve("line"),Ve.PATH=new Ve("path"),Ve.PATTERN=new Ve("pattern"),Ve.POLYGON=new Ve("polygon"),Ve.RECT=new Ve("rect"),Ve.SVG=new Ve("svg"),Ve.TEXT=new Ve("text"),Ve.TSPAN=new Ve("tspan");var $i=class{constructor(t,o,c,g){this.top=t,this.bottom=o,this.left=c,this.right=g}getHeight(){return this.bottom-this.top}getWidth(){return this.right-this.left}contains(t,o){return t>=this.left&&t<=this.right&&o>=this.top&&o<=this.bottom}intersects(t){return!(this.left>t.right||this.right<t.left||this.top>t.bottom||this.bottom<t.top)}},Kn=class{constructor(t,o){this.width=t,this.height=o}static equals(t,o){return t===o?!0:t&&o?t.width===o.width&&t.height===o.height:!1}static max(t,o){return new Kn(Math.max(t.width,o.width),Math.max(t.height,o.height))}static min(t,o){return new Kn(Math.min(t.width,o.width),Math.min(t.height,o.height))}},yI={getSizeInternal:fe},Eh={TEST_ONLY:yI};Eh.getBorderBox=Ie,Eh.getComputedStyle=Ae,Eh.getContainerOffsetToScrollInto=N,Eh.getPageOffset=tt,Eh.getSize=X,Eh.getViewportPageOffset=ye,Eh.scrollIntoContainerView=Be;var SI=/translate\(\s*([-+\d.e]+)([ ,]\s*([-+\d.e]+)\s*)?/,$I=/transform:\s*translate(?:3d)?\(\s*([-+\d.e]+)\s*px([ ,]\s*([-+\d.e]+)\s*px)?/,nG={XY_REGEX:SI,XY_STYLE_REGEX:$I},of={TEST_ONLY:nG};of.getDocumentScroll=We,of.getInjectionDivXY=ge,of.getRelativeXY=j,of.getViewportBBox=we,of.screenToWsCoordinates=gt,of.wsToScreenCoordinates=bt;var ur=class{constructor(t,o,c,g,$){this.workspace=t,this.horizontal=o,this.oldHostMetrics=null,this.ratio=1,this.origin=new At(0,0),this.startDragHandle=this.handlePosition=this.handleLength=this.scrollbarLength=this.startDragMouse=0,this.containerVisible=this.isHandleVisible=!0,this.position=new At(0,0),this.onMouseMoveWrapper_=this.onMouseUpWrapper_=null,this.pair=c||!1,this.margin=$!==void 0?$:ur.DEFAULT_SCROLLBAR_MARGIN,t="blocklyScrollbar"+(this.horizontal?"Horizontal":"Vertical"),g&&(t+=" "+g),this.outerSvg=Ce(Ve.SVG,{class:t}),g=Ce(Ve.G,{},this.outerSvg),this.svgBackground=Ce(Ve.RECT,{class:"blocklyScrollbarBackground"},g),t=Math.floor((ur.scrollbarThickness-5)/2),this.svgHandle=Ce(Ve.RECT,{class:"blocklyScrollbarHandle",rx:t,ry:t},g),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarColour","fill"),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarOpacity","fill-opacity"),ot(this.outerSvg,this.workspace.getParentSvg()),this.setInitialThickness(),o?(this.lengthAttribute_="width",this.positionAttribute_="x"):(this.lengthAttribute_="height",this.positionAttribute_="y"),this.onMouseDownBarWrapper_=Ue(this.svgBackground,"pointerdown",this,this.onMouseDownBar),this.onMouseDownHandleWrapper_=Ue(this.svgHandle,"pointerdown",this,this.onMouseDownHandle)}setInitialThickness(){const t=ur.scrollbarThickness;this.horizontal?(this.svgBackground.setAttribute("height",String(t)),this.outerSvg.setAttribute("height",String(t)),this.svgHandle.setAttribute("height",String(t-5)),this.svgHandle.setAttribute("y","2.5")):(this.svgBackground.setAttribute("width",String(t)),this.outerSvg.setAttribute("width",String(t)),this.svgHandle.setAttribute("width",String(t-5)),this.svgHandle.setAttribute("x","2.5"))}dispose(){this.cleanUp(),re(this.onMouseDownBarWrapper_),re(this.onMouseDownHandleWrapper_),W(this.outerSvg),this.workspace.getThemeManager().unsubscribe(this.svgHandle)}constrainHandleLength(t){return t=0>=t||isNaN(t)?0:Math.min(t,this.scrollbarLength)}setHandleLength(t){this.handleLength=t,this.svgHandle.setAttribute(this.lengthAttribute_,String(this.handleLength))}constrainHandlePosition(t){return t=0>=t||isNaN(t)?0:Math.min(t,this.scrollbarLength-this.handleLength)}setHandlePosition(t){this.handlePosition=t,this.svgHandle.setAttribute(this.positionAttribute_,String(this.handlePosition))}setScrollbarLength(t){this.scrollbarLength=t,this.outerSvg.setAttribute(this.lengthAttribute_,String(this.scrollbarLength)),this.svgBackground.setAttribute(this.lengthAttribute_,String(this.scrollbarLength))}setPosition(t,o){this.position.x=t,this.position.y=o,ze(this.outerSvg,"translate("+(this.position.x+this.origin.x)+"px,"+(this.position.y+this.origin.y)+"px)")}resize(t){!t&&(t=this.workspace.getMetrics(),!t)||this.oldHostMetrics&&ur.metricsAreEquivalent(t,this.oldHostMetrics)||(this.horizontal?this.resizeHorizontal(t):this.resizeVertical(t),this.oldHostMetrics=t,this.updateMetrics())}requiresViewResize(t){return this.oldHostMetrics?this.oldHostMetrics.viewWidth!==t.viewWidth||this.oldHostMetrics.viewHeight!==t.viewHeight||this.oldHostMetrics.absoluteLeft!==t.absoluteLeft||this.oldHostMetrics.absoluteTop!==t.absoluteTop:!0}resizeHorizontal(t){this.requiresViewResize(t)?this.resizeViewHorizontal(t):this.resizeContentHorizontal(t)}resizeViewHorizontal(t){var o=t.viewWidth-2*this.margin;this.pair&&(o-=ur.scrollbarThickness),this.setScrollbarLength(Math.max(0,o)),o=t.absoluteLeft+this.margin,this.pair&&this.workspace.RTL&&(o+=ur.scrollbarThickness),this.setPosition(o,t.absoluteTop+t.viewHeight-ur.scrollbarThickness-this.margin),this.resizeContentHorizontal(t)}resizeContentHorizontal(t){if(t.viewWidth>=t.scrollWidth)this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var o=this.scrollbarLength*t.viewWidth/t.scrollWidth;o=this.constrainHandleLength(o),this.setHandleLength(o),o=t.scrollWidth-t.viewWidth;var c=this.scrollbarLength-this.handleLength;t=(t.viewLeft-t.scrollLeft)/o*c,t=this.constrainHandlePosition(t),this.setHandlePosition(t),this.ratio=c/o}}resizeVertical(t){this.requiresViewResize(t)?this.resizeViewVertical(t):this.resizeContentVertical(t)}resizeViewVertical(t){let o=t.viewHeight-2*this.margin;this.pair&&(o-=ur.scrollbarThickness),this.setScrollbarLength(Math.max(0,o)),this.setPosition(this.workspace.RTL?t.absoluteLeft+this.margin:t.absoluteLeft+t.viewWidth-ur.scrollbarThickness-this.margin,t.absoluteTop+this.margin),this.resizeContentVertical(t)}resizeContentVertical(t){if(t.viewHeight>=t.scrollHeight)this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var o=this.scrollbarLength*t.viewHeight/t.scrollHeight;o=this.constrainHandleLength(o),this.setHandleLength(o),o=t.scrollHeight-t.viewHeight;var c=this.scrollbarLength-this.handleLength;t=(t.viewTop-t.scrollTop)/o*c,t=this.constrainHandlePosition(t),this.setHandlePosition(t),this.ratio=c/o}}isVisible(){return this.isHandleVisible}setContainerVisible(t){const o=t!==this.containerVisible;this.containerVisible=t,o&&this.updateDisplay_()}setVisible(t){if(this.pair)throw Error("Unable to toggle visibility of paired scrollbars.");this.setVisibleInternal(t)}setVisibleInternal(t){const o=t!==this.isVisible();this.isHandleVisible=t,o&&this.updateDisplay_()}updateDisplay_(){this.containerVisible&&this.isVisible()?this.outerSvg.setAttribute("display","block"):this.outerSvg.setAttribute("display","none")}onMouseDownBar(t){if(this.workspace.markFocused(),_e(),this.cleanUp(),Fe(t))t.stopPropagation();else{var o=Ze(t,this.workspace.getParentSvg(),this.workspace.getInverseScreenCTM());o=this.horizontal?o.x:o.y;var c=ge(this.svgHandle);c=this.horizontal?c.x:c.y;var g=this.handlePosition,$=.95*this.handleLength;o<=c?g-=$:o>=c+this.handleLength&&(g+=$),this.setHandlePosition(this.constrainHandlePosition(g)),this.updateMetrics(),t.stopPropagation(),t.preventDefault()}}onMouseDownHandle(t){this.workspace.markFocused(),this.cleanUp(),Fe(t)?t.stopPropagation():(this.startDragHandle=this.handlePosition,this.startDragMouse=this.horizontal?t.clientX:t.clientY,this.onMouseUpWrapper_=Ue(document,"pointerup",this,this.onMouseUpHandle),this.onMouseMoveWrapper_=Ue(document,"pointermove",this,this.onMouseMoveHandle),t.stopPropagation(),t.preventDefault())}onMouseMoveHandle(t){this.setHandlePosition(this.constrainHandlePosition(this.startDragHandle+((this.horizontal?t.clientX:t.clientY)-this.startDragMouse))),this.updateMetrics()}onMouseUpHandle(){_e(),this.cleanUp()}cleanUp(){this.workspace.hideChaff(!0),this.onMouseUpWrapper_&&(re(this.onMouseUpWrapper_),this.onMouseUpWrapper_=null),this.onMouseMoveWrapper_&&(re(this.onMouseMoveWrapper_),this.onMouseMoveWrapper_=null)}getRatio_(){let t=this.handlePosition/(this.scrollbarLength-this.handleLength);return isNaN(t)&&(t=0),t}updateMetrics(){const t=this.getRatio_();this.horizontal?this.workspace.setMetrics({x:t}):this.workspace.setMetrics({y:t})}set(t,o){this.setHandlePosition(this.constrainHandlePosition(t*this.ratio)),(o||o===void 0)&&this.updateMetrics()}setOrigin(t,o){this.origin=new At(t,o)}static metricsAreEquivalent(t,o){return t.viewWidth===o.viewWidth&&t.viewHeight===o.viewHeight&&t.viewLeft===o.viewLeft&&t.viewTop===o.viewTop&&t.absoluteTop===o.absoluteTop&&t.absoluteLeft===o.absoluteLeft&&t.scrollWidth===o.scrollWidth&&t.scrollHeight===o.scrollHeight&&t.scrollLeft===o.scrollLeft&&t.scrollTop===o.scrollTop}};ur.scrollbarThickness=_i?25:15,ur.DEFAULT_SCROLLBAR_MARGIN=.5;var WE={parseFromString:function(){throw Error("DOMParser was not found in the global scope and was not properly injected using injectDependencies")}},ob={serializeToString:function(){throw Error("XMLSerializer was not foundin the global scope and was not properly injected using injectDependencies")}},{document:XE,DOMParser:Q_,XMLSerializer:ev}=globalThis;Q_&&(WE=new Q_),ev&&(ob=new ev);var bI="https://developers.google.com/blockly/xml",iG=/[\x00-\x09\x0B\x0C\x0E-\x1F]/g,um={NAME_SPACE:bI};um.createElement=n.createElement$$module$build$src$core$utils$xml,um.createTextNode=n.createTextNode$$module$build$src$core$utils$xml,um.domToText=an,um.injectDependencies=un,um.textToDom=n.textToDom$$module$build$src$core$utils$xml;var ab="categoryToolbox",AI="flyoutToolbox",Cn;(function(t){t[t.TOP=0]="TOP",t[t.BOTTOM=1]="BOTTOM",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"})(Cn||(Cn={}));var CI={hasCategoriesInternal:Ti},yh={};yh.Position=Cn,yh.TEST_ONLY=CI,yh.convertFlyoutDefToJsonArray=Ci,yh.convertToolboxDefToJson=pi,yh.hasCategories=vi,yh.isCategoryCollapsible=nn,yh.parseToolboxTree=B;var tu;(function(t){t[t.TOP=0]="TOP",t[t.BOTTOM=1]="BOTTOM"})(tu||(tu={}));var hm;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT"})(hm||(hm={}));var Sh;(function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN"})(Sh||(Sh={}));var af={};af.bumpDirection=Sh,af.bumpPositionRect=me,af.getCornerOppositeToolbox=ve,af.getStartPositionRect=le,af.horizontalPosition=hm,af.verticalPosition=tu;var no={width:96,height:124,url:"sprites.png"},xI=class{constructor(t){this.workspace=t,this.id="zoomControls",this.boundEvents=[],this.zoomResetGroup=this.zoomOutGroup=this.zoomInGroup=null,this.HEIGHT=this.WIDTH=32,this.SMALL_SPACING=2,this.LARGE_SPACING=11,this.MARGIN_HORIZONTAL=this.MARGIN_VERTICAL=20,this.svgGroup=null,this.top=this.left=0,this.initialized=!1}createDom(){this.svgGroup=Ce(Ve.G,{});const t=String(Math.random()).substring(2);return this.createZoomOutSvg(t),this.createZoomInSvg(t),this.workspace.isMovable()&&this.createZoomResetSvg(t),this.svgGroup}init(){this.workspace.getComponentManager().addComponent({component:this,weight:2,capabilities:[Vr.Capability.POSITIONABLE]}),this.initialized=!0}dispose(){this.workspace.getComponentManager().removeComponent("zoomControls"),this.svgGroup&&W(this.svgGroup);for(const t of this.boundEvents)re(t);this.boundEvents.length=0}getBoundingRectangle(){let t=this.SMALL_SPACING+2*this.HEIGHT;return this.zoomResetGroup&&(t+=this.LARGE_SPACING+this.HEIGHT),new $i(this.top,this.top+t,this.left,this.left+this.WIDTH)}position(t,o){if(this.initialized){var c=ve(this.workspace,t),g=this.SMALL_SPACING+2*this.HEIGHT;if(this.zoomResetGroup&&(g+=this.LARGE_SPACING+this.HEIGHT),t=le(c,new Kn(this.WIDTH,g),this.MARGIN_HORIZONTAL,this.MARGIN_VERTICAL,t,this.workspace),c=c.vertical,o=me(t,this.MARGIN_VERTICAL,c===tu.TOP?Sh.DOWN:Sh.UP,o),c===tu.TOP){var $=this.SMALL_SPACING+this.HEIGHT,M;(M=this.zoomInGroup)==null||M.setAttribute("transform","translate(0, "+$+")"),this.zoomResetGroup&&this.zoomResetGroup.setAttribute("transform","translate(0, "+($+this.LARGE_SPACING+this.HEIGHT)+")")}else{M=this.zoomResetGroup?this.LARGE_SPACING+this.HEIGHT:0;let be;(be=this.zoomInGroup)==null||be.setAttribute("transform","translate(0, "+M+")"),M=M+this.SMALL_SPACING+this.HEIGHT,($=this.zoomOutGroup)==null||$.setAttribute("transform","translate(0, "+M+")")}this.top=o.top,this.left=o.left;var Q;(Q=this.svgGroup)==null||Q.setAttribute("transform","translate("+this.left+","+this.top+")")}}createZoomOutSvg(t){this.zoomOutGroup=Ce(Ve.G,{class:"blocklyZoom blocklyZoomOut"},this.svgGroup);const o=Ce(Ve.CLIPPATH,{id:"blocklyZoomoutClipPath"+t},this.zoomOutGroup);Ce(Ve.RECT,{width:32,height:32},o),Ce(Ve.IMAGE,{width:no.width,height:no.height,x:-64,y:-92,"clip-path":"url(#blocklyZoomoutClipPath"+t+")"},this.zoomOutGroup).setAttributeNS(Zo,"xlink:href",this.workspace.options.pathToMedia+no.url),this.boundEvents.push(Ue(this.zoomOutGroup,"pointerdown",null,this.zoom.bind(this,-1)))}createZoomInSvg(t){this.zoomInGroup=Ce(Ve.G,{class:"blocklyZoom blocklyZoomIn"},this.svgGroup);const o=Ce(Ve.CLIPPATH,{id:"blocklyZoominClipPath"+t},this.zoomInGroup);Ce(Ve.RECT,{width:32,height:32},o),Ce(Ve.IMAGE,{width:no.width,height:no.height,x:-32,y:-92,"clip-path":"url(#blocklyZoominClipPath"+t+")"},this.zoomInGroup).setAttributeNS(Zo,"xlink:href",this.workspace.options.pathToMedia+no.url),this.boundEvents.push(Ue(this.zoomInGroup,"pointerdown",null,this.zoom.bind(this,1)))}zoom(t,o){this.workspace.markFocused(),this.workspace.zoomCenter(t),this.fireZoomEvent(),_e(),o.stopPropagation(),o.preventDefault()}createZoomResetSvg(t){this.zoomResetGroup=Ce(Ve.G,{class:"blocklyZoom blocklyZoomReset"},this.svgGroup);const o=Ce(Ve.CLIPPATH,{id:"blocklyZoomresetClipPath"+t},this.zoomResetGroup);Ce(Ve.RECT,{width:32,height:32},o),Ce(Ve.IMAGE,{width:no.width,height:no.height,y:-92,"clip-path":"url(#blocklyZoomresetClipPath"+t+")"},this.zoomResetGroup).setAttributeNS(Zo,"xlink:href",this.workspace.options.pathToMedia+no.url),this.boundEvents.push(Ue(this.zoomResetGroup,"pointerdown",null,this.resetZoom.bind(this)))}resetZoom(t){this.workspace.markFocused();const o=Math.log(this.workspace.options.zoomOptions.startScale/this.workspace.scale)/Math.log(this.workspace.options.zoomOptions.scaleSpeed);this.workspace.beginCanvasTransition(),this.workspace.zoomCenter(o),this.workspace.scrollCenter(),setTimeout(this.workspace.endCanvasTransition.bind(this.workspace),500),this.fireZoomEvent(),_e(),t.stopPropagation(),t.preventDefault()}fireZoomEvent(){const t=new(k(cr))(null,this.workspace.id,"zoom_controls");b(t)}};je(`
.blocklyZoom>image, .blocklyZoom>svg>image {
  opacity: .4;
}

.blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {
  opacity: .6;
}

.blocklyZoom>image:active, .blocklyZoom>svg>image:active {
  opacity: .8;
}
`);var tv="_TEMP_COLLAPSED_INPUT",jE="_TEMP_COLLAPSED_FIELD",xa="MANUALLY_DISABLED",rG={COLLAPSED_FIELD_NAME:jE,COLLAPSED_INPUT_NAME:tv,MANUALLY_DISABLED:xa},wr=class{constructor(t){this.name=t}toString(){return this.name}equals(t){return this.name===t.toString()}};wr.MUTATOR=new wr("mutator"),wr.WARNING=new wr("warning"),wr.COMMENT=new wr("comment"),function(t){t[t.VALUE=1]="VALUE",t[t.STATEMENT=3]="STATEMENT",t[t.DUMMY=5]="DUMMY",t[t.CUSTOM=6]="CUSTOM",t[t.END_ROW=7]="END_ROW"}(n.inputTypes$$module$build$src$core$inputs$input_types||(n.inputTypes$$module$build$src$core$inputs$input_types={})),n.inputTypes$$module$build$src$core$inputs$input_types;var RI=function(t,o){window.alert(t),o&&o()},wI=function(t,o){o(window.confirm(t))},MI=function(t,o,c){c(window.prompt(t,o))},II={confirmInternal:at},lf={TEST_ONLY:II};lf.alert=Se,lf.confirm=Je,lf.prompt=pt,lf.setAlert=Ke,lf.setConfirm=rt,lf.setPrompt=Ne;var lb,OI;n.Msg$$module$build$src$core$msg=Object.create(null),lb=function(t){Object.keys(t).forEach(function(o){n.Msg$$module$build$src$core$msg[o]=t[o]})},OI={Msg:n.Msg$$module$build$src$core$msg,setLocale:lb};var nv=class extends ht{constructor(t){super(),this.isBlank=typeof t>"u",t&&(this.varId=t.getId(),this.workspaceId=t.workspace.id)}toJson(){const t=super.toJson();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");return t.varId=this.varId,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new nv),o.varId=t.varId,o}},cb=class extends nv{constructor(t){super(t),this.type=ba,t&&(this.varType=t.type,this.varName=t.name)}toJson(){const t=super.toJson();if(this.varType===void 0)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");return t.varType=this.varType,t.varName=this.varName,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new cb),o.varType=t.varType,o.varName=t.varName,o}run(t){const o=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");t?o.createVariable(this.varName,this.varType,this.varId):o.deleteVariableById(this.varId)}};r(yt.EVENT,ba,cb);var iv=class{constructor(t,o,c,g){this.workspace=t,this.name=o,this.type=c||"",this.id_=g||T()}getId(){return this.id_}static compareByName(t,o){return t.name.localeCompare(o.name,void 0,{sensitivity:"base"})}},ub="VARIABLE",hb="ijkmnopqrstuvwxyzabcdefgh",LI={generateUniqueNameInternal:Ot},gs={CATEGORY_NAME:ub,TEST_ONLY:LI,VAR_LETTER_OPTIONS:hb};gs.allDeveloperVariables=n.allDeveloperVariables$$module$build$src$core$variables,gs.allUsedVarModels=n.allUsedVarModels$$module$build$src$core$variables,gs.createVariableButtonHandler=Ft,gs.flyoutCategory=Ht,gs.flyoutCategoryBlocks=Zt,gs.generateUniqueName=jt,gs.generateUniqueNameFromOptions=qt,gs.generateVariableFieldDom=xn,gs.getAddedVariables=zn,gs.getOrCreateVariablePackage=n.getOrCreateVariablePackage$$module$build$src$core$variables,gs.getVariable=n.getVariable$$module$build$src$core$variables,gs.nameUsedWithAnyType=on,gs.nameUsedWithConflictingParam=bn,gs.promptName=ln,gs.renameVariable=n.renameVariable$$module$build$src$core$variables;var YE=new Set,db=new WeakSet,fb=new WeakMap,dm=null,pb=null,NI=0,KE={};KE.finishQueuedRenders=Kt,KE.queueRender=Mn,KE.triggerQueuedRenders=An;var JE=class{constructor(t,o){this.workspace=t,this.text="",this.size=new Kn(120,100),this.collapsed=!1,this.deletable=this.movable=this.editable=!0,this.location=new At(0,0),this.disposing=this.disposed=!1,this.id=o&&!t.getCommentById(o)?o:T(),t.addTopComment(this),this.fireCreateEvent()}fireCreateEvent(){R()&&b(new(k(Jo))(this))}fireDeleteEvent(){R()&&b(new(k(ac))(this))}fireChangeEvent(t,o){R()&&b(new(k(_h))(this,t,o))}fireCollapseEvent(t){R()&&b(new(k(vh))(this,t))}setText(t){const o=this.text;this.text=t,this.fireChangeEvent(o,t)}getText(){return this.text}setSize(t){this.size=t}getSize(){return this.size}setCollapsed(t){this.collapsed=t,this.fireCollapseEvent(t)}isCollapsed(){return this.collapsed}setEditable(t){this.editable=t}isEditable(){return this.isOwnEditable()&&!this.workspace.options.readOnly}isOwnEditable(){return this.editable}setMovable(t){this.movable=t}isMovable(){return this.isOwnMovable()&&!this.workspace.options.readOnly}isOwnMovable(){return this.movable}setDeletable(t){this.deletable=t}isDeletable(){return this.isOwnDeletable()&&!this.workspace.options.readOnly}isOwnDeletable(){return this.deletable}moveTo(t,o){const c=new(k(Ca))(this);o&&c.setReason(o),this.location=t,c.recordNew(),R()&&b(c)}getRelativeToSurfaceXY(){return this.location}dispose(){this.disposing=!0,this.fireDeleteEvent(),this.workspace.removeTopComment(this),this.disposed=!0}isDisposed(){return this.disposed}isDeadOrDying(){return this.disposing||this.disposed}},fm=50,mb=100,kI=class{constructor(t){this.workspace=t,this.size=new Kn(120,100),this.collapsed=!1,this.editable=!0,this.location=new At(0,0),this.text="",this.textChangeListeners=[],this.sizeChangeListeners=[],this.disposeListeners=[],this.collapseChangeListeners=[],this.resizePointerMoveListener=this.resizePointerUpListener=null,this.disposed=this.disposing=!1,this.svgRoot=Ce(Ve.G,{class:"blocklyComment blocklyEditable"}),this.highlightRect=this.createHighlightRect(this.svgRoot),{topBarGroup:this.topBarGroup,topBarBackground:this.topBarBackground,deleteIcon:this.deleteIcon,foldoutIcon:this.foldoutIcon,textPreview:this.textPreview,textPreviewNode:this.textPreviewNode}=this.createTopBar(this.svgRoot,t),{foreignObject:this.foreignObject,textArea:this.textArea}=this.createTextArea(this.svgRoot),this.resizeHandle=this.createResizeHandle(this.svgRoot,t);let o;(o=t.getLayerManager())==null||o.append(this,fm),this.setSize(this.size),this.moveTo(new At(0,0))}createHighlightRect(t){return Ce(Ve.RECT,{class:"blocklyCommentHighlight"},t)}createTopBar(t,o){t=Ce(Ve.G,{class:"blocklyCommentTopbar"},t);const c=Ce(Ve.RECT,{class:"blocklyCommentTopbarBackground"},t),g=Ce(Ve.IMAGE,{class:"blocklyDeleteIcon",href:`${o.options.pathToMedia}delete-icon.svg`},t);o=Ce(Ve.IMAGE,{class:"blocklyFoldoutIcon",href:`${o.options.pathToMedia}foldout-icon.svg`},t);const $=Ce(Ve.TEXT,{class:"blocklyCommentPreview blocklyCommentText blocklyText"},t),M=document.createTextNode("");return $.appendChild(M),Ue(o,"pointerdown",this,this.onFoldoutDown),Ue(g,"pointerdown",this,this.onDeleteDown),{topBarGroup:t,topBarBackground:c,deleteIcon:g,foldoutIcon:o,textPreview:$,textPreviewNode:M}}createTextArea(t){t=Ce(Ve.FOREIGNOBJECT,{class:"blocklyCommentForeignObject"},t);const o=document.createElementNS(cc,"body");o.setAttribute("xmlns",cc),o.className="blocklyMinimalBody";const c=document.createElementNS(cc,"textarea");return Me(c,"blocklyCommentText"),Me(c,"blocklyTextarea"),Me(c,"blocklyText"),o.appendChild(c),t.appendChild(o),Ue(c,"change",this,this.onTextChange),{foreignObject:t,textArea:c}}createResizeHandle(t,o){return t=Ce(Ve.IMAGE,{class:"blocklyResizeHandle",href:`${o.options.pathToMedia}resize-handle.svg`},t),Ue(t,"pointerdown",this,this.onResizePointerDown),t}getSvgRoot(){return this.svgRoot}getSize(){return this.collapsed?this.topBarBackground.getBBox():this.size}setSize(t){const o=this.topBarBackground.getBBox(),c=this.deleteIcon.getBBox(),g=this.foldoutIcon.getBBox(),$=this.textPreview.getBBox(),M=this.resizeHandle.getBBox();t=Kn.max(t,this.calcMinSize(o,g,c));const Q=this.size;this.size=t,this.svgRoot.setAttribute("height",`${t.height}`),this.svgRoot.setAttribute("width",`${t.width}`),this.updateHighlightRect(t),this.updateTopBarSize(t),this.updateTextAreaSize(t,o),this.updateDeleteIconPosition(t,o,c),this.updateFoldoutIconPosition(o,g),this.updateTextPreviewSize(t,o,$,c,M),this.updateResizeHandlePosition(t,M),this.onSizeChange(Q,this.size)}calcMinSize(t,o,c){var g;this.updateTextPreview((g=this.textArea.value)!=null?g:""),g=ft(this.textPreview);const $=this.calcFoldoutMargin(t,o),M=this.calcDeleteMargin(t,c);let Q=g;return this.foldoutIcon.checkVisibility()?Q+=o.width+2*$:g&&(Q+=4),this.deleteIcon.checkVisibility()?Q+=c.width+2*M:g&&(Q+=4),new Kn(Q,t.height+20)}calcDeleteMargin(t,o){return(t.height-o.height)/2}calcFoldoutMargin(t,o){return(t.height-o.height)/2}updateHighlightRect(t){this.highlightRect.setAttribute("height",`${t.height}`),this.highlightRect.setAttribute("width",`${t.width}`),this.workspace.RTL&&this.highlightRect.setAttribute("x",`${-t.width}`)}updateTopBarSize(t){this.topBarBackground.setAttribute("width",`${t.width}`)}updateTextAreaSize(t,o){this.foreignObject.setAttribute("height",`${t.height-o.height}`),this.foreignObject.setAttribute("width",`${t.width}`),this.foreignObject.setAttribute("y",`${o.height}`),this.workspace.RTL&&this.foreignObject.setAttribute("x",`${-t.width}`)}updateDeleteIconPosition(t,o,c){o=this.calcDeleteMargin(o,c),this.deleteIcon.setAttribute("y",`${o}`),this.deleteIcon.setAttribute("x",`${t.width-c.width-o}`)}updateFoldoutIconPosition(t,o){t=this.calcFoldoutMargin(t,o),this.foldoutIcon.setAttribute("y",`${t}`),this.foldoutIcon.setAttribute("x",`${t}`)}updateTextPreviewSize(t,o,c,g,$){const M=(o.height-c.height)/2,Q=this.calcDeleteMargin(o,g);o=this.calcFoldoutMargin(o,$),t=t.width-$.width-2*o-g.width-2*Q,this.textPreview.setAttribute("x",`${$.width+2*o*(this.workspace.RTL?-1:1)}`),this.textPreview.setAttribute("y",`${M+c.height/2}`),this.textPreview.setAttribute("width",`${t}`)}updateResizeHandlePosition(t,o){this.resizeHandle.setAttribute("y",`${t.height-o.height}`),this.resizeHandle.setAttribute("x",`${t.width-o.width}`)}onSizeChange(t,o){for(let c=this.sizeChangeListeners.length-1;0<=c;c--)this.sizeChangeListeners[c](t,o)}addSizeChangeListener(t){this.sizeChangeListeners.push(t)}removeSizeChangeListener(t){this.sizeChangeListeners.splice(this.sizeChangeListeners.indexOf(t),1)}onResizePointerDown(t){this.isEditable()&&(this.bringToFront(),Fe(t)||(this.workspace.startDrag(t,new At(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=Ue(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=Ue(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),t.stopPropagation())}onResizePointerUp(t){_e(),this.resizePointerUpListener&&(re(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(re(this.resizePointerMoveListener),this.resizePointerMoveListener=null)}onResizePointerMove(t){t=this.workspace.moveDrag(t),this.setSize(new Kn(this.workspace.RTL?-t.x:t.x,t.y))}isCollapsed(){return this.collapsed}setCollapsed(t){(this.collapsed=t)?Me(this.svgRoot,"blocklyCollapsed"):oe(this.svgRoot,"blocklyCollapsed"),this.setSize(this.size),this.onCollapse()}onCollapse(){for(let t=this.collapseChangeListeners.length-1;0<=t;t--)this.collapseChangeListeners[t](this.collapsed)}addOnCollapseListener(t){this.collapseChangeListeners.push(t)}removeOnCollapseListener(t){this.collapseChangeListeners.splice(this.collapseChangeListeners.indexOf(t),1)}onFoldoutDown(t){this.bringToFront(),Fe(t)||(this.setCollapsed(!this.collapsed),this.workspace.hideChaff()),t.stopPropagation()}isEditable(){return this.editable}setEditable(t){(this.editable=t)?(Me(this.svgRoot,"blocklyEditable"),oe(this.svgRoot,"blocklyReadonly"),this.textArea.removeAttribute("readonly")):(oe(this.svgRoot,"blocklyEditable"),Me(this.svgRoot,"blocklyReadonly"),this.textArea.setAttribute("readonly","true"))}getRelativeToSurfaceXY(){return this.location}moveTo(t){this.location=t,this.svgRoot.setAttribute("transform",`translate(${t.x}, ${t.y})`)}getText(){return this.text}setText(t){this.textArea.value=t,this.onTextChange()}addTextChangeListener(t){this.textChangeListeners.push(t)}removeTextChangeListener(t){this.textChangeListeners.splice(this.textChangeListeners.indexOf(t),1)}onTextChange(){const t=this.text;this.text=this.textArea.value,this.updateTextPreview(this.text),this.setSize(this.size);for(let o=this.textChangeListeners.length-1;0<=o;o--)this.textChangeListeners[o](t,this.text)}updateTextPreview(t){this.textPreviewNode.textContent=this.truncateText(t)}truncateText(t){return 12<=t.length?`${t.substring(0,9)}...`:t}bringToFront(){const t=this.svgRoot.parentNode,o=t.childNodes;o[o.length-1]!==this.svgRoot&&t.appendChild(this.svgRoot)}onDeleteDown(t){Fe(t)||this.dispose(),t.stopPropagation()}dispose(){this.disposing=!0,W(this.svgRoot);for(let t=this.disposeListeners.length-1;0<=t;t--)this.disposeListeners[t]();this.disposed=!0}isDisposed(){return this.disposed}isDeadOrDying(){return this.disposing||this.disposed}addDisposeListener(t){this.disposeListeners.push(t)}removeDisposeListener(t){this.disposeListeners.splice(this.disposeListeners.indexOf(t),1)}};je(`
.injectionDiv {
  --commentFillColour: #FFFCC7;
  --commentBorderColour: #F2E49B;
}

.blocklyComment .blocklyTextarea {
  background-color: var(--commentFillColour);
  border: 1px solid var(--commentBorderColour);
  box-sizing: border-box;
  display: block;
  outline: 0;
  padding: 5px;
  resize: none;
  width: 100%;
  height: 100%;
}

.blocklyReadonly.blocklyComment .blocklyTextarea {
  cursor: inherit;
}

.blocklyDeleteIcon {
  width: 20px;
  height: 20px;
  display: none;
  cursor: pointer;
}

.blocklyFoldoutIcon {
  width: 20px;
  height: 20px;
  transform-origin: 12px 12px;
  cursor: pointer;
}
.blocklyResizeHandle {
  width: 12px;
  height: 12px;
  cursor: se-resize;
}
.blocklyReadonly.blocklyComment .blocklyResizeHandle {
  cursor: inherit;
}

.blocklyCommentTopbarBackground {
  cursor: grab;
  fill: var(--commentBorderColour);
  height: 24px;
}

.blocklyComment .blocklyCommentPreview.blocklyText {
  fill: #000;
  dominant-baseline: middle;
  visibility: hidden;
}

.blocklyCollapsed.blocklyComment .blocklyCommentPreview {
  visibility: visible;
}

.blocklyCollapsed.blocklyComment .blocklyCommentForeignObject,
.blocklyCollapsed.blocklyComment .blocklyResizeHandle {
  display: none;
}

.blocklyCollapsed.blocklyComment .blocklyFoldoutIcon {
  transform: rotate(-90deg);
}

.blocklyRTL .blocklyCommentTopbar {
  transform: scale(-1, 1);
}

.blocklyRTL .blocklyCommentForeignObject {
  direction: rtl;
}

.blocklyRTL .blocklyCommentPreview {
  /* Revert the scale and control RTL using direction instead. */
  transform: scale(-1, 1);
  direction: rtl;
}

.blocklyRTL .blocklyResizeHandle {
  transform: scale(-1, 1);
  cursor: sw-resize;
}

.blocklyCommentHighlight {
  fill: none;
}

.blocklySelected .blocklyCommentHighlight {
  stroke: #fc3;
  stroke-width: 3px;
}

.blocklyCollapsed.blocklySelected .blocklyCommentHighlight {
  stroke: none;
}

.blocklyCollapsed.blocklySelected .blocklyCommentTopbarBackground {
  stroke: #fc3;
  stroke-width: 3px;
}
`);var PI=class{constructor(t){this.comment=t,this.startLoc=null,this.workspace=t.workspace}isMovable(){return this.comment.isOwnMovable()&&!this.workspace.options.readOnly}startDrag(){n.getGroup$$module$build$src$core$events$utils()||n.setGroup$$module$build$src$core$events$utils(!0),this.startLoc=this.comment.getRelativeToSurfaceXY(),this.workspace.setResizesEnabled(!1);let t;(t=this.workspace.getLayerManager())==null||t.moveToDragLayer(this.comment),this.comment.setDragging(!0)}drag(t){this.comment.moveDuringDrag(t)}endDrag(){this.fireMoveEvent();let t;(t=this.workspace.getLayerManager())==null||t.moveOffDragLayer(this.comment,fm),this.comment.setDragging(!1),this.comment.snapToGrid(),this.workspace.setResizesEnabled(!0),n.setGroup$$module$build$src$core$events$utils(!1)}fireMoveEvent(){if(!this.comment.isDeadOrDying()){var t=new(k(Ca))(this.comment);t.setReason(["drag"]),t.oldCoordinate_=this.startLoc,t.recordNew(),b(t)}}revertDrag(){this.startLoc&&this.comment.moveDuringDrag(this.startLoc)}},DI=100,BI=75,FI=50,UI=25,sG={BLOCKS:FI,PROCEDURES:BI,VARIABLES:DI,WORKSPACE_COMMENTS:UI},gb={};gb.register=hi,gb.unregister=Rs;var GI=class{constructor(){this.priority=UI}save(t){const o=[];for(const c of t.getTopComments())(t=dn(c,{addCoordinates:!0,saveIds:!0}))&&o.push(t);return o.length?o:null}load(t,o){for(const c of t)kr(c,o,{recordUndo:E()})}clear(t){for(const o of t.getTopComments())o.dispose()}};hi("workspaceComments",new GI);var ZE={};ZE.WorkspaceCommentSerializer=GI,ZE.append=kr,ZE.save=dn;var _b={};_b.register=jn,_b.unregister=Qr;var qE=class{paste(t,o,c){t=t.commentState,c&&(t.x=c.x,t.y=c.y),n.disable$$module$build$src$core$events$utils();let g;try{g=kr(t,o),Pr(g)}finally{n.enable$$module$build$src$core$events$utils()}return g?(R()&&b(new(k(Jo))(g)),n.setSelected$$module$build$src$core$common(g),g):null}};qE.TYPE="workspace-comment",jn(qE.TYPE,new qE);var vb;vb=28,n.config$$module$build$src$core$config={dragRadius:5,flyoutDragRadius:10,snapRadius:vb,connectingSnapRadius:vb,currentConnectionPreference:8,bumpDelay:250},n.config$$module$build$src$core$config;var oG="aria-",aG="role",pl;(function(t){t.GRID="grid",t.GRIDCELL="gridcell",t.GROUP="group",t.LISTBOX="listbox",t.MENU="menu",t.MENUITEM="menuitem",t.MENUITEMCHECKBOX="menuitemcheckbox",t.OPTION="option",t.PRESENTATION="presentation",t.ROW="row",t.TREE="tree",t.TREEITEM="treeitem"})(pl||(pl={}));var zr;(function(t){t.ACTIVEDESCENDANT="activedescendant",t.COLCOUNT="colcount",t.DISABLED="disabled",t.EXPANDED="expanded",t.INVALID="invalid",t.LABEL="label",t.LABELLEDBY="labelledby",t.LEVEL="level",t.ORIENTATION="orientation",t.POSINSET="posinset",t.ROWCOUNT="rowcount",t.SELECTED="selected",t.SETSIZE="setsize",t.VALUEMAX="valuemax",t.VALUEMIN="valuemin"})(zr||(zr={}));var rv={};rv.Role=pl,rv.State=zr,rv.setRole=sn,rv.setState=Ei;var Tb=class{constructor(){this.menuItems=[],this.roleName=this.element=this.onKeyDownHandler=this.mouseLeaveHandler=this.mouseEnterHandler=this.clickHandler=this.mouseOverHandler=this.highlightedItem=this.openingCoords=null}addChild(t){this.menuItems.push(t)}render(t){const o=document.createElement("div");o.className="blocklyMenu goog-menu blocklyNonSelectable",o.tabIndex=0,this.roleName&&sn(o,this.roleName),this.element=o;for(let c=0,g;g=this.menuItems[c];c++)o.appendChild(g.createDom());return this.mouseOverHandler=Ue(o,"pointerover",this,this.handleMouseOver,!0),this.clickHandler=Ue(o,"pointerup",this,this.handleClick,!0),this.mouseEnterHandler=Ue(o,"pointerenter",this,this.handleMouseEnter,!0),this.mouseLeaveHandler=Ue(o,"pointerleave",this,this.handleMouseLeave,!0),this.onKeyDownHandler=Ue(o,"keydown",this,this.handleKeyEvent),t.appendChild(o),o}getElement(){return this.element}focus(){const t=this.getElement();t&&(t.focus({preventScroll:!0}),Me(t,"blocklyFocused"))}blur(){const t=this.getElement();t&&(t.blur(),oe(t,"blocklyFocused"))}setRole(t){this.roleName=t}dispose(){this.mouseOverHandler&&(re(this.mouseOverHandler),this.mouseOverHandler=null),this.clickHandler&&(re(this.clickHandler),this.clickHandler=null),this.mouseEnterHandler&&(re(this.mouseEnterHandler),this.mouseEnterHandler=null),this.mouseLeaveHandler&&(re(this.mouseLeaveHandler),this.mouseLeaveHandler=null),this.onKeyDownHandler&&(re(this.onKeyDownHandler),this.onKeyDownHandler=null);for(let t=0,o;o=this.menuItems[t];t++)o.dispose();this.element=null}getMenuItem(t){const o=this.getElement();for(;t&&t!==o;){if(t.classList.contains("blocklyMenuItem")){for(let c=0,g;g=this.menuItems[c];c++)if(g.getElement()===t)return g}t=t.parentElement}return null}setHighlighted(t){var o=this.highlightedItem;o&&(o.setHighlighted(!1),this.highlightedItem=null),t&&(t.setHighlighted(!0),this.highlightedItem=t,o=this.getElement(),Be(t.getElement(),o),Ei(o,zr.ACTIVEDESCENDANT,t.getId()))}highlightNext(){const t=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(t,1)}highlightPrevious(){const t=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(0>t?this.menuItems.length:t,-1)}highlightFirst(){this.highlightHelper(-1,1)}highlightLast(){this.highlightHelper(this.menuItems.length,-1)}highlightHelper(t,o){t+=o;let c;for(;c=this.menuItems[t];){if(c.isEnabled()){this.setHighlighted(c);break}t+=o}}handleMouseOver(t){(t=this.getMenuItem(t.target))&&(t.isEnabled()?this.highlightedItem!==t&&this.setHighlighted(t):this.setHighlighted(null))}handleClick(t){const o=this.openingCoords;if(this.openingCoords=null,o&&typeof t.clientX=="number"){const c=new At(t.clientX,t.clientY);if(1>At.distance(o,c))return}(t=this.getMenuItem(t.target))&&t.performAction()}handleMouseEnter(t){this.focus()}handleMouseLeave(t){this.getElement()&&(this.blur(),this.setHighlighted(null))}handleKeyEvent(t){if(this.menuItems.length&&!(t.shiftKey||t.ctrlKey||t.metaKey||t.altKey)){var o=this.highlightedItem;switch(t.key){case"Enter":case" ":o&&o.performAction();break;case"ArrowUp":this.highlightPrevious();break;case"ArrowDown":this.highlightNext();break;case"PageUp":case"Home":this.highlightFirst();break;case"PageDown":case"End":this.highlightLast();break;default:return}t.preventDefault(),t.stopPropagation()}}getSize(){const t=this.getElement(),o=X(t);return o.height=t.scrollHeight,o}},Eb=class{constructor(t,o){this.content=t,this.opt_value=o,this.enabled=!0,this.element=null,this.rightToLeft=!1,this.roleName=null,this.highlight=this.checked=this.checkable=!1,this.actionHandler=null}createDom(){const t=document.createElement("div");t.id=m(),this.element=t,t.className="blocklyMenuItem goog-menuitem "+(this.enabled?"":"blocklyMenuItemDisabled goog-menuitem-disabled ")+(this.checked?"blocklyMenuItemSelected goog-option-selected ":"")+(this.highlight?"blocklyMenuItemHighlight goog-menuitem-highlight ":"")+(this.rightToLeft?"blocklyMenuItemRtl goog-menuitem-rtl ":"");const o=document.createElement("div");if(o.className="blocklyMenuItemContent goog-menuitem-content",this.checkable){var c=document.createElement("div");c.className="blocklyMenuItemCheckbox goog-menuitem-checkbox",o.appendChild(c)}return c=this.content,typeof this.content=="string"&&(c=document.createTextNode(this.content)),o.appendChild(c),t.appendChild(o),this.roleName&&sn(t,this.roleName),Ei(t,zr.SELECTED,this.checkable&&this.checked||!1),Ei(t,zr.DISABLED,!this.enabled),t}dispose(){this.element=null}getElement(){return this.element}getId(){return this.element.id}getValue(){let t;return(t=this.opt_value)!=null?t:null}setRightToLeft(t){this.rightToLeft=t}setRole(t){this.roleName=t}setCheckable(t){this.checkable=t}setChecked(t){this.checked=t}setHighlighted(t){this.highlight=t;const o=this.getElement();o&&this.isEnabled()&&(t?(Me(o,"blocklyMenuItemHighlight"),Me(o,"goog-menuitem-highlight")):(oe(o,"blocklyMenuItemHighlight"),oe(o,"goog-menuitem-highlight")))}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}performAction(){this.isEnabled()&&this.actionHandler&&this.actionHandler(this)}onAction(t,o){this.actionHandler=t.bind(o)}},pm=class extends Error{},HI=class extends pm{constructor(t){super("Expected to find a 'type' property, defining the block type"),this.state=t}},sv=class extends pm{constructor(t,o,c){super(`The block ${o.toDevString()} is missing a(n) ${t}
connection`),this.block=o,this.state=c}},VI=class extends pm{constructor(t,o,c,g){super(`The block ${c.toDevString()} could not connect its
${o} to its parent, because: ${t}`),this.childBlock=c,this.childState=g}},zI=class extends pm{constructor(t){super(`Encountered a real block which is defined as a child of a shadow
block. It is an invariant of Blockly that shadow blocks only have shadow
children`),this.state=t}},WI=class extends pm{constructor(t,o,c){super(`Cannot add an icon of type '${t}' to the block ${o.toDevString()}, because there is no icon registered with type '${t}'. Make sure that all of your icons have been registered.`),this.block=o,this.state=c}},cf={};cf.BadConnectionCheck=VI,cf.DeserializationError=pm,cf.MissingBlockType=HI,cf.MissingConnection=sv,cf.RealChildOfShadow=zI,cf.UnregisteredIcon=WI;var XI=class{constructor(){this.priority=FI}save(t){const o=[];for(const c of t.getTopBlocks(!1))(t=Vi(c,{addCoordinates:!0,doFullSerialization:!1}))&&o.push(t);return o.length?{languageVersion:0,blocks:o}:null}load(t,o){t=t.blocks;for(const c of t)Ii(c,o,{recordUndo:E()})}clear(t){for(const o of t.getTopBlocks(!1))o.dispose(!1)}};hi("blocks",new XI);var ov={};ov.BlockSerializer=XI,ov.append=Ii,ov.appendInternal=_o,ov.save=Vi;var uf=class extends ht{constructor(t){super(),this.isBlank=!t,t&&(this.blockId=t.id,this.workspaceId=t.workspace.id)}toJson(){const t=super.toJson();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");return t.blockId=this.blockId,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new uf),o.blockId=t.blockId,o}},hf=class extends uf{constructor(t,o,c,g,$){super(t),this.type=n.CHANGE$$module$build$src$core$events$utils,t&&(this.element=o,this.name=c||void 0,this.oldValue=g,this.newValue=$)}toJson(){const t=super.toJson();if(!this.element)throw Error("The changed element is undefined. Either pass an element to the constructor, or call fromJson");return t.element=this.element,t.name=this.name,t.oldValue=this.oldValue,t.newValue=this.newValue,this.disabledReason&&(t.disabledReason=this.disabledReason),t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new hf),o.element=t.element,o.name=t.name,o.oldValue=t.oldValue,o.newValue=t.newValue,t.disabledReason!==void 0&&(o.disabledReason=t.disabledReason),o}setDisabledReason(t){if(this.element!=="disabled")throw Error('Cannot set the disabled reason for a BlockChange event if the element is not "disabled".');this.disabledReason=t}isNull(){return this.oldValue===this.newValue}run(t){var o=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(o=o.getBlockById(this.blockId),!o)throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");const c=o.getIcon(wr.MUTATOR);switch(c&&Ee(c)&&c.bubbleIsVisible()&&c.setBubbleVisible(!1),t=t?this.newValue:this.oldValue,this.element){case"field":(o=o.getField(this.name))?o.setValue(t):console.warn("Can't set non-existent field: "+this.name);break;case"comment":o.setCommentText(t||null);break;case"collapsed":o.setCollapsed(!!t);break;case"disabled":var g;o.setDisabledReason(!!t,(g=this.disabledReason)!=null?g:xa);break;case"inline":o.setInputsInline(!!t);break;case"mutation":g=hf.getExtraBlockState_(o),o.loadExtraState?o.loadExtraState(JSON.parse(t||"{}")):o.domToMutation&&o.domToMutation(n.textToDom$$module$build$src$core$utils$xml(t||"<mutation/>")),b(new hf(o,"mutation",null,g,t));break;default:console.warn("Unknown change type: "+this.element)}}static getExtraBlockState_(t){return t.saveExtraState?(t=t.saveExtraState(!0))?JSON.stringify(t):"":t.mutationToDom&&(t=t.mutationToDom())?Vo(t):""}};r(yt.EVENT,n.CHANGE$$module$build$src$core$events$utils,hf);var QE={};QE.clamp=Et,QE.toDegrees=lt,QE.toRadians=Oe;var av=16,yb=1,jI=12,Sb=16,ey=.25,$b=null,df=null,mm="",gm="",ri,_m,ff,bb=null,$h=null,YI=null,Ab={getBoundsInfo:function(){const t=tt(bb),o=X(bb);return{left:t.x,right:t.x+o.width,top:t.y,bottom:t.y+o.height,width:o.width,height:o.height}},getPositionMetrics:function(t,o,c,g){const $=Ab.getBoundsInfo(),M=X(ri);return o+M.height<$.bottom?Du(t,o,$,M):g-M.height>$.top?Fp(c,g,$,M):o+M.height<document.documentElement.clientHeight?Du(t,o,$,M):g-M.height>document.documentElement.clientTop?Fp(c,g,$,M):vd(t,$,M)}},Ps={ANIMATION_TIME:ey,ARROW_HORIZONTAL_PADDING:jI,ARROW_SIZE:av,BORDER_SIZE:yb,PADDING_Y:Sb,TEST_ONLY:Ab};Ps.clearContent=li,Ps.createDom=_n,Ps.getContentDiv=yn,Ps.getOwner=Qt,Ps.getPositionX=Bu,Ps.hide=Oc,Ps.hideIfOwner=Fu,Ps.hideWithoutAnimation=Uo,Ps.isVisible=Up,Ps.repositionForWindowResize=Hp,Ps.setBoundsElement=fn,Ps.setColour=ci,Ps.show=ga,Ps.showPositionedByBlock=br,Ps.showPositionedByField=us;var lv=class{constructor(t){this.workspace=t,this.cursorSvg_=this.cursor_=null,this.markers=new Map,this.markerSvg_=null}registerMarker(t,o){this.markers.has(t)&&this.unregisterMarker(t),o.setDrawer(this.workspace.getRenderer().makeMarkerDrawer(this.workspace,o)),this.setMarkerSvg(o.getDrawer().createDom()),this.markers.set(t,o)}unregisterMarker(t){const o=this.markers.get(t);if(o)o.dispose(),this.markers.delete(t);else throw Error("Marker with ID "+t+" does not exist. Can only unregister markers that exist.")}getCursor(){return this.cursor_}getMarker(t){return this.markers.get(t)||null}setCursor(t){this.cursor_&&this.cursor_.getDrawer()&&this.cursor_.getDrawer().dispose(),(this.cursor_=t)&&(t=this.workspace.getRenderer().makeMarkerDrawer(this.workspace,this.cursor_),this.cursor_.setDrawer(t),this.setCursorSvg(this.cursor_.getDrawer().createDom()))}setCursorSvg(t){t?(this.workspace.getBlockCanvas().appendChild(t),this.cursorSvg_=t):this.cursorSvg_=null}setMarkerSvg(t){t?this.workspace.getBlockCanvas()&&(this.cursorSvg_?this.workspace.getBlockCanvas().insertBefore(t,this.cursorSvg_):this.workspace.getBlockCanvas().appendChild(t)):this.markerSvg_=null}updateMarkers(){this.workspace.keyboardAccessibilityMode&&this.cursorSvg_&&this.workspace.getCursor().draw()}dispose(){const t=Object.keys(this.markers);for(let o=0,c;c=t[o];o++)this.unregisterMarker(c);this.markers.clear(),this.cursor_&&(this.cursor_.dispose(),this.cursor_=null)}};lv.LOCAL_MARKER="local_marker_1";var vm={};vm.commonWordPrefix=zl,vm.commonWordSuffix=Wl,vm.isNumber=n.isNumber$$module$build$src$core$utils$string,vm.shortestStringLength=Lc,vm.wrap=n.wrap$$module$build$src$core$utils$string;var ty=void 0,cv=!1,Tm=!1,KI=50,JI=0,pf=0,Cb=0,xb=0,Ra=null,uv=null,Rb=0,wb=10,ZI=10,qI=750,ny=5,Mr=null,qo={HOVER_MS:qI,LIMIT:KI,MARGINS:ny,OFFSET_X:Rb,OFFSET_Y:wb,RADIUS_OK:ZI};qo.bindMouseEvents=Ar,qo.block=Sd,qo.createDom=yd,qo.dispose=Vp,qo.getCustomTooltip=_a,qo.getDiv=jl,qo.getTooltipOfObject=kc,qo.hide=Ta,qo.isVisible=va,qo.setCustomTooltip=Xl,qo.unbindMouseEvents=es,qo.unblock=$d;var Mb=.45,Ib=.65,QI={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"},wa={};wa.blend=Go,wa.getHsvSaturation=Dc,wa.getHsvValue=Wp,wa.hexToRgb=Yl,wa.hsvToHex=hs,wa.hueToHex=Kl,wa.names=QI,wa.parse=To,wa.rgbToHex=Hu,wa.setHsvSaturation=bd,wa.setHsvValue=u_;var hv={};hv.checkMessageReferences=h_,hv.parseBlockColour=Jl,hv.replaceMessageReferences=yi,hv.tokenizeInterpolation=Ad;var bi=class{constructor(t,o,c){this.DEFAULT_VALUE=null,this.name=void 0,this.constants_=this.mouseDownWrapper_=this.textContent_=this.textElement_=this.borderRect_=this.fieldGroup_=this.markerSvg_=this.cursorSvg_=this.tooltip_=this.validator_=null,this.disposed=!1,this.maxDisplayLength=50,this.sourceBlock_=null,this.enabled_=this.visible_=this.isDirty_=!0,this.suffixField=this.prefixField=this.clickTarget_=null,this.EDITABLE=!0,this.SERIALIZABLE=!1,this.CURSOR="",this.value_="DEFAULT_VALUE"in new.target.prototype?new.target.prototype.DEFAULT_VALUE:this.DEFAULT_VALUE,this.size_=new Kn(0,0),t!==bi.SKIP_SETUP&&(c&&this.configure_(c),this.setValue(t),o&&this.setValidator(o))}configure_(t){t.tooltip&&this.setTooltip(yi(t.tooltip))}setSourceBlock(t){if(this.sourceBlock_)throw Error("Field already bound to a block");this.sourceBlock_=t}getConstants(){return!this.constants_&&this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&this.sourceBlock_.workspace.rendered&&(this.constants_=this.sourceBlock_.workspace.getRenderer().getConstants()),this.constants_}getSourceBlock(){return this.sourceBlock_}init(){this.fieldGroup_||(this.fieldGroup_=Ce(Ve.G,{}),this.isVisible()||(this.fieldGroup_.style.display="none"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.initView(),this.updateEditable(),this.setTooltip(this.tooltip_),this.bindEvents_(),this.initModel(),this.applyColour())}initView(){this.createBorderRect_(),this.createTextElement_()}initModel(){}isFullBlockField(){return!this.borderRect_}createBorderRect_(){this.borderRect_=Ce(Ve.RECT,{rx:this.getConstants().FIELD_BORDER_RECT_RADIUS,ry:this.getConstants().FIELD_BORDER_RECT_RADIUS,x:0,y:0,height:this.size_.height,width:this.size_.width,class:"blocklyFieldRect"},this.fieldGroup_)}createTextElement_(){this.textElement_=Ce(Ve.TEXT,{class:"blocklyText"},this.fieldGroup_),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.textElement_.setAttribute("dominant-baseline","central"),this.textContent_=document.createTextNode(""),this.textElement_.appendChild(this.textContent_)}bindEvents_(){const t=this.getClickTarget_();if(!t)throw Error("A click target has not been set.");Ar(t),this.mouseDownWrapper_=Ue(t,"pointerdown",this,this.onMouseDown_)}fromXml(t){this.setValue(t.textContent)}toXml(t){return t.textContent=this.getValue(),t}saveState(t){return t=this.saveLegacyState(bi),t!==null?t:this.getValue()}loadState(t){this.loadLegacyState(bi,t)||this.setValue(t)}saveLegacyState(t){return t.prototype.saveState===this.saveState&&t.prototype.toXml!==this.toXml?(t=n.createElement$$module$build$src$core$utils$xml("field"),t.setAttribute("name",this.name||""),an(this.toXml(t)).replace(' xmlns="https://developers.google.com/blockly/xml"',"")):null}loadLegacyState(t,o){return t.prototype.loadState===this.loadState&&t.prototype.fromXml!==this.fromXml?(this.fromXml(n.textToDom$$module$build$src$core$utils$xml(o)),!0):!1}dispose(){Fu(this),Eo(this);let t;(t=this.getSourceBlock())!=null&&t.isDeadOrDying()||W(this.fieldGroup_),this.disposed=!0}updateEditable(){const t=this.fieldGroup_,o=this.getSourceBlock();this.EDITABLE&&t&&o&&(this.enabled_&&o.isEditable()?(Me(t,"blocklyEditableText"),oe(t,"blocklyNonEditableText"),t.style.cursor=this.CURSOR):(Me(t,"blocklyNonEditableText"),oe(t,"blocklyEditableText"),t.style.cursor=""))}setEnabled(t){this.enabled_=t,this.updateEditable()}isEnabled(){return this.enabled_}isClickable(){return this.enabled_&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()&&this.showEditor_!==bi.prototype.showEditor_}isClickableInFlyout(t){return!t}isCurrentlyEditable(){return this.enabled_&&this.EDITABLE&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()}isSerializable(){let t=!1;return this.name&&(this.SERIALIZABLE?t=!0:this.EDITABLE&&(console.warn("Detected an editable field that was not serializable. Please define SERIALIZABLE property as true on all editable custom fields. Proceeding with serialization."),t=!0)),t}isVisible(){return this.visible_}setVisible(t){if(this.visible_!==t){this.visible_=t;var o=this.fieldGroup_;o&&(o.style.display=t?"block":"none")}}setValidator(t){this.validator_=t}getValidator(){return this.validator_}getSvgRoot(){return this.fieldGroup_}getBorderRect(){if(!this.borderRect_)throw Error(`The border rectangle is ${this.borderRect_}.`);return this.borderRect_}getTextElement(){if(!this.textElement_)throw Error(`The text element is ${this.textElement_}.`);return this.textElement_}getTextContent(){if(!this.textContent_)throw Error(`The text content is ${this.textContent_}.`);return this.textContent_}applyColour(){}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_()}showEditor(t){this.isClickable()&&this.showEditor_(t)}showEditor_(t){}repositionForWindowResize(){return!1}updateSize_(t){const o=this.getConstants();t=t!==void 0?t:this.isFullBlockField()?0:this.getConstants().FIELD_BORDER_RECT_X_PADDING;let c=2*t,g=o.FIELD_TEXT_HEIGHT,$=0;this.textElement_&&($=Ge(this.textElement_,o.FIELD_TEXT_FONTSIZE,o.FIELD_TEXT_FONTWEIGHT,o.FIELD_TEXT_FONTFAMILY),c+=$),this.isFullBlockField()||(g=Math.max(g,o.FIELD_BORDER_RECT_HEIGHT)),this.size_.height=g,this.size_.width=c,this.positionTextElement_(t,$),this.positionBorderRect_()}positionTextElement_(t,o){if(this.textElement_){var c=this.getConstants(),g=this.size_.height/2,$;this.textElement_.setAttribute("x",String(($=this.getSourceBlock())!=null&&$.RTL?this.size_.width-o-t:t)),this.textElement_.setAttribute("y",String(c.FIELD_TEXT_BASELINE_CENTER?g:g-c.FIELD_TEXT_HEIGHT/2+c.FIELD_TEXT_BASELINE))}}positionBorderRect_(){this.borderRect_&&(this.borderRect_.setAttribute("width",String(this.size_.width)),this.borderRect_.setAttribute("height",String(this.size_.height)),this.borderRect_.setAttribute("rx",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)),this.borderRect_.setAttribute("ry",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)))}getSize(){return this.isVisible()?(this.isDirty_?(this.render_(),this.isDirty_=!1):this.visible_&&this.size_.width===0&&(this.render_(),this.size_.width!==0&&console.warn("Deprecated use of setting size_.width to 0 to rerender a field. Set field.isDirty_ to true instead.")),this.size_):new Kn(0,0)}getScaledBBox(){let t;var o=this.getSourceBlock();if(!o)throw new hr;if(this.isFullBlockField()){var c=this.sourceBlock_.getHeightWidth();const g=o.workspace.scale;t=this.getAbsoluteXY_(),o=(c.width+1)*g,c=(c.height+1)*g,mI?(t.x+=1.5*g,t.y+=1.5*g):(t.x-=.5*g,t.y-=.5*g)}else c=this.borderRect_.getBoundingClientRect(),t=tt(this.borderRect_),o=c.width,c=c.height;return new $i(t.y,t.y+c,t.x,t.x+o)}onLocationChange(t){}getDisplayText_(){let t=this.getText();return t?(t.length>this.maxDisplayLength&&(t=t.substring(0,this.maxDisplayLength-2)+"…"),t=t.replace(/\s/g,bi.NBSP),this.sourceBlock_&&this.sourceBlock_.RTL&&(t+="‏"),t):bi.NBSP}getText(){const t=this.getText_();return String(t!==null?t:this.getValue())}getText_(){return null}markDirty(){this.isDirty_=!0,this.constants_=null}forceRerender(){this.isDirty_=!0,this.sourceBlock_&&this.sourceBlock_.rendered&&this.sourceBlock_.queueRender()}setValue(t,o=!0){if(t!==null){var c=this.doClassValidation_(t);if(t=this.processValidation_(t,c,o),!(t instanceof Error)){var g;c=(g=this.getValidator())==null?void 0:g.call(this,t),g=this.processValidation_(t,c,o),g instanceof Error||(t=this.sourceBlock_,t&&t.disposed||(c=this.getValue(),c===g?this.doValueUpdate_(g):(this.doValueUpdate_(g),o&&t&&R()&&b(new(k(n.CHANGE$$module$build$src$core$events$utils))(t,"field",this.name||null,c,g)),this.isDirty_&&this.forceRerender())))}}}processValidation_(t,o,c){return o===null?(this.doValueInvalid_(t,c),this.isDirty_&&this.forceRerender(),Error()):o===void 0?t:o}getValue(){return this.value_}doClassValidation_(t){return t??null}doValueUpdate_(t){this.value_=t,this.isDirty_=!0}doValueInvalid_(t,o){}onMouseDown_(t){this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&(t=this.sourceBlock_.workspace.getGesture(t))&&t.setStartField(this)}setTooltip(t){t||t===""||(t=this.sourceBlock_);const o=this.getClickTarget_();o?o.tooltip=t:this.tooltip_=t}getTooltip(){const t=this.getClickTarget_();return kc(t||{tooltip:this.tooltip_})}getClickTarget_(){return this.clickTarget_||this.getSvgRoot()}getAbsoluteXY_(){return tt(this.getClickTarget_())}referencesVariables(){return!1}refreshVariableName(){}getParentInput(){let t=null;const o=this.getSourceBlock();if(!o)throw new hr;const c=o.inputList;for(let g=0;g<o.inputList.length;g++){const $=c[g],M=$.fieldRow;for(let Q=0;Q<M.length;Q++)if(M[Q]===this){t=$;break}}return t}getFlipRtl(){return!1}isTabNavigable(){return!1}onShortcut(t){return!1}setCursorSvg(t){if(t){if(!this.fieldGroup_)throw Error(`The field group is ${this.fieldGroup_}.`);this.fieldGroup_.appendChild(t),this.cursorSvg_=t}else this.cursorSvg_=null}setMarkerSvg(t){if(t){if(!this.fieldGroup_)throw Error(`The field group is ${this.fieldGroup_}.`);this.fieldGroup_.appendChild(t),this.markerSvg_=t}else this.markerSvg_=null}updateMarkers_(){var t=this.getSourceBlock();if(!t)throw new hr;t=t.workspace,t.keyboardAccessibilityMode&&this.cursorSvg_&&t.getCursor().draw(),t.keyboardAccessibilityMode&&this.markerSvg_&&t.getMarker(lv.LOCAL_MARKER).draw()}static fromJson(t){throw Error("Attempted to instantiate a field from the registry that hasn't defined a 'fromJson' method.")}};bi.NBSP=" ",bi.SKIP_SETUP=Symbol("SKIP_SETUP");var hr=class extends Error{constructor(){super("The field has not yet been attached to its input. Call appendField to attach it.")}},Em=null,Ob=null,iy=null,ry="blocklyWidgetDiv",ym="",Sm="",ml,gl={};gl.createDom=xd,gl.getDiv=gi,gl.hide=Qa,gl.hideIfOwner=Eo,gl.hideIfOwnerIsInWorkspace=wi,gl.isVisible=Is,gl.positionWithAnchor=ar,gl.repositionForWindowResize=d_,gl.show=Vu,gl.testOnly_setDiv=Cd;var sy=null,e1={},oy=null,mf={};mf.callbackFactory=n.callbackFactory$$module$build$src$core$contextmenu,mf.dispose=Xu,mf.getCurrentBlock=Fr,mf.hide=ql,mf.setCurrentBlock=wd,mf.show=Bc;var wn=class{constructor(){this.registry_=new Map,this.reset()}reset(){this.registry_.clear()}register(t){if(this.registry_.has(t.id))throw Error('Menu item with ID "'+t.id+'" is already registered.');this.registry_.set(t.id,t)}unregister(t){if(!this.registry_.has(t))throw Error('Menu item with ID "'+t+'" not found.');this.registry_.delete(t)}getItem(t){let o;return(o=this.registry_.get(t))!=null?o:null}getContextMenuOptions(t,o){const c=[];for(const $ of this.registry_.values())if(t===$.scopeType){var g=$.preconditionFn(o);g!=="hidden"&&(g={text:typeof $.displayText=="function"?$.displayText(o):$.displayText,enabled:g==="enabled",callback:$.callback,scope:o,weight:$.weight},c.push(g))}return c.sort(function($,M){return $.weight-M.weight}),c}};(function(t){var o=t.ScopeType||(t.ScopeType={});o.BLOCK="block",o.WORKSPACE="workspace",o.COMMENT="comment",t.registry=new t})(wn||(wn={})),wn.ScopeType;var ay=class extends JE{constructor(t,o){super(t,o),this.dragStrategy=new PI(this),this.workspace=t,this.view=new kI(t),this.view.setSize(this.getSize()),this.view.setEditable(this.isEditable()),this.addModelUpdateBindings(),Ue(this.view.getSvgRoot(),"pointerdown",this,this.startGesture),Ue(this.view.getSvgRoot(),"wheel",this,c=>{c.stopPropagation()})}addModelUpdateBindings(){this.view.addTextChangeListener((t,o)=>void super.setText(o)),this.view.addSizeChangeListener((t,o)=>void super.setSize(o)),this.view.addOnCollapseListener(()=>void super.setCollapsed(this.view.isCollapsed())),this.view.addDisposeListener(()=>{this.isDeadOrDying()||this.dispose()})}setText(t){this.view.setText(t)}setSize(t){this.view.setSize(t)}setCollapsed(t){this.view.setCollapsed(t)}setEditable(t){super.setEditable(t),this.view.setEditable(this.isEditable())}getSvgRoot(){return this.view.getSvgRoot()}getSize(){return super.getSize()}getBoundingRectangle(){const t=this.getRelativeToSurfaceXY();var o,c;const g=(c=(o=this.view)==null?void 0:o.getSize())!=null?c:this.getSize();return this.workspace.RTL?(o=t.x-g.width,c=t.x):(o=t.x,c=t.x+g.width),new $i(t.y,t.y+g.height,o,c)}moveBy(t,o,c){const g=this.getRelativeToSurfaceXY();t=new At(g.x+t,g.y+o),this.moveTo(t,c)}moveTo(t,o){super.moveTo(t,o),this.view.moveTo(t)}moveDuringDrag(t){this.location=t,this.view.moveTo(t)}setDragging(t){t?Me(this.getSvgRoot(),"blocklyDragging"):oe(this.getSvgRoot(),"blocklyDragging")}dispose(){this.disposing=!0,this.view.isDeadOrDying()||this.view.dispose(),super.dispose()}startGesture(t){const o=this.workspace.getGesture(t);o&&(o.handleCommentStart(t,this),n.setSelected$$module$build$src$core$common(this))}setDeleteStyle(t){t?Me(this.getSvgRoot(),"blocklyDraggingDelete"):oe(this.getSvgRoot(),"blocklyDraggingDelete")}isMovable(){return this.dragStrategy.isMovable()}startDrag(){this.dragStrategy.startDrag()}drag(t){this.dragStrategy.drag(t)}endDrag(){this.dragStrategy.endDrag()}revertDrag(){this.dragStrategy.revertDrag()}select(){Me(this.getSvgRoot(),"blocklySelected")}unselect(){oe(this.getSvgRoot(),"blocklySelected")}toCopyData(){return{paster:qE.TYPE,commentState:dn(this,{addCoordinates:!0})}}showContextMenu(t){const o=wn.registry.getContextMenuOptions(wn.ScopeType.COMMENT,{comment:this});Bc(t,o,this.workspace.RTL,this.workspace)}snapToGrid(){if(!this.isDeadOrDying()){var t=this.workspace.getGrid();if(t!=null&&t.shouldSnap()){var o=this.getRelativeToSurfaceXY();t=t.alignXY(o),t!==o&&this.moveTo(t,["snap"])}}}},Ds={};Ds.appendDomToWorkspace=Ku,Ds.blockToDom=ya,Ds.blockToDomWithXY=Yu,Ds.clearWorkspaceAndLoadFromXml=Id,Ds.deleteNext=$_,Ds.domToBlock=n.domToBlock$$module$build$src$core$xml,Ds.domToBlockInternal=Ql,Ds.domToPrettyText=Md,Ds.domToText=Vo,Ds.domToVariables=Yp,Ds.domToWorkspace=n.domToWorkspace$$module$build$src$core$xml,Ds.loadWorkspaceComment=Od,Ds.saveWorkspaceComment=ju,Ds.variablesToDom=jp,Ds.workspaceToDom=f_;var Lb=class extends uf{constructor(t){super(t),this.type=n.CREATE$$module$build$src$core$events$utils,t&&(t.isShadow()&&(this.recordUndo=!1),this.xml=Yu(t),this.ids=O(t),this.json=Vi(t,{addCoordinates:!0}))}toJson(){const t=super.toJson();if(!this.xml)throw Error("The block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!this.json)throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson");return t.xml=Vo(this.xml),t.ids=this.ids,t.json=this.json,this.recordUndo||(t.recordUndo=this.recordUndo),t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new Lb),o.xml=n.textToDom$$module$build$src$core$utils$xml(t.xml),o.ids=t.ids,o.json=t.json,t.recordUndo!==void 0&&(o.recordUndo=t.recordUndo),o}run(t){const o=this.getEventWorkspace_();if(!this.json)throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!lG(o,this.ids))if(t)Ii(this.json,o);else for(t=0;t<this.ids.length;t++){const c=this.ids[t],g=o.getBlockById(c);g?g.dispose(!1):c===this.blockId&&console.warn("Can't uncreate non-existent block: "+c)}}},lG=function(t,o){return o.map(c=>t.getBlockById(c)).filter(c=>c&&c.isShadow()).length===o.length};r(yt.EVENT,n.CREATE$$module$build$src$core$events$utils,Lb);var Nb=class extends Rt{constructor(t,o){super(o),this.type=So,this.themeName=t}toJson(){const t=super.toJson();if(!this.themeName)throw Error("The theme name is undefined. Either pass a theme name to the constructor, or call fromJson");return t.themeName=this.themeName,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new Nb),o.themeName=t.themeName,o}};r(yt.EVENT,So,Nb);var kb=class extends Rt{constructor(t,o,c,g,$){super(g),this.type=Ko,this.viewTop=t,this.viewLeft=o,this.scale=c,this.oldScale=$}toJson(){const t=super.toJson();if(this.viewTop===void 0)throw Error("The view top is undefined. Either pass a value to the constructor, or call fromJson");if(this.viewLeft===void 0)throw Error("The view left is undefined. Either pass a value to the constructor, or call fromJson");if(this.scale===void 0)throw Error("The scale is undefined. Either pass a value to the constructor, or call fromJson");if(this.oldScale===void 0)throw Error("The old scale is undefined. Either pass a value to the constructor, or call fromJson");return t.viewTop=this.viewTop,t.viewLeft=this.viewLeft,t.scale=this.scale,t.oldScale=this.oldScale,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new kb),o.viewTop=t.viewTop,o.viewLeft=t.viewLeft,o.scale=t.scale,o.oldScale=t.oldScale,o}};r(yt.EVENT,Ko,kb);var Bt;(function(t){t[t.INPUT_VALUE=1]="INPUT_VALUE",t[t.OUTPUT_VALUE=2]="OUTPUT_VALUE",t[t.NEXT_STATEMENT=3]="NEXT_STATEMENT",t[t.PREVIOUS_STATEMENT=4]="PREVIOUS_STATEMENT"})(Bt||(Bt={}));var $m=class{constructor(t){this.connectionChecker=t,this.connections=[]}addConnection(t,o){o=this.calculateIndexForYPos(o),this.connections.splice(o,0,t)}findIndexOfConnection(t,o){if(!this.connections.length)return-1;const c=this.calculateIndexForYPos(o);if(c>=this.connections.length)return-1;o=t.y;let g=c;for(;0<=g&&this.connections[g].y===o;){if(this.connections[g]===t)return g;g--}for(g=c;g<this.connections.length&&this.connections[g].y===o;){if(this.connections[g]===t)return g;g++}return-1}calculateIndexForYPos(t){if(!this.connections.length)return 0;let o=0,c=this.connections.length;for(;o<c;){const g=Math.floor((o+c)/2);if(this.connections[g].y<t)o=g+1;else if(this.connections[g].y>t)c=g;else{o=g;break}}return o}removeConnection(t,o){if(t=this.findIndexOfConnection(t,o),t===-1)throw Error("Unable to find connection in connectionDB.");this.connections.splice(t,1)}getNeighbours(t,o){function c(Dt){const Ni=$-g[Dt].x,Mi=M-g[Dt].y;return Math.sqrt(Ni*Ni+Mi*Mi)<=o&&nt.push(g[Dt]),Mi<o}const g=this.connections,$=t.x,M=t.y;t=0;let Q=g.length-2,be=Q;for(;t<be;)g[be].y<M?t=be:Q=be,be=Math.floor((t+Q)/2);const nt=[];if(Q=t=be,g.length){for(;0<=t&&c(t);)t--;do Q++;while(Q<g.length&&c(Q))}return nt}isInYRange(t,o,c){return Math.abs(this.connections[t].y-o)<=c}searchForClosest(t,o,c){if(!this.connections.length)return{connection:null,radius:o};const g=t.y,$=t.x;t.x=$+c.x,t.y=g+c.y;var M=this.calculateIndexForYPos(t.y);c=null;let Q=o,be,nt=M-1;for(;0<=nt&&this.isInYRange(nt,t.y,o);)be=this.connections[nt],this.connectionChecker.canConnect(t,be,!0,Q)&&(c=be,Q=be.distanceFrom(t)),nt--;for(;M<this.connections.length&&this.isInYRange(M,t.y,o);)be=this.connections[M],this.connectionChecker.canConnect(t,be,!0,Q)&&(c=be,Q=be.distanceFrom(t)),M++;return t.x=$,t.y=g,{connection:c,radius:Q}}static init(t){const o=[];return o[Bt.INPUT_VALUE]=new $m(t),o[Bt.OUTPUT_VALUE]=new $m(t),o[Bt.NEXT_STATEMENT]=new $m(t),o[Bt.PREVIOUS_STATEMENT]=new $m(t),o}},ly=null,dv=null,fv={};fv.connectionUiEffect=qp,fv.disconnectUiEffect=b_,fv.disconnectUiStop=ec,fv.disposeUiEffect=Ld;var t1=class{constructor(t){this.workspace=t,this.horizontalScrollEnabled_=this.workspace.isMovableHorizontally(),this.verticalScrollEnabled_=this.workspace.isMovableVertically(),this.startScrollXY_=new At(t.scrollX,t.scrollY)}dispose(){this.workspace=null}startDrag(){de()&&de().unselect()}endDrag(t){this.drag(t)}drag(t){if(t=At.sum(this.startScrollXY_,t),this.horizontalScrollEnabled_&&this.verticalScrollEnabled_)this.workspace.scroll(t.x,t.y);else if(this.horizontalScrollEnabled_)this.workspace.scroll(t.x,this.workspace.scrollY);else if(this.verticalScrollEnabled_)this.workspace.scroll(this.workspace.scrollX,t.y);else throw new TypeError("Invalid state.")}},cG=5,uG=6,nu=class{constructor(t,o){this.creatorWorkspace=o,this.mouseDownXY=new At(0,0),this.startWorkspace_=this.targetBlock=this.startComment=this.startBlock=this.startIcon=this.startField=this.startBubble=null,this.hasExceededDragRadius=!1,this.boundEvents=[],this.workspaceDragger=this.dragger=null,this.dragging=!1,this.flyout=null,this.isMultiTouch_=this.isEnding_=this.gestureHasStarted=this.calledUpdateIsDragging=!1,this.cachedPoints=new Map,this.startDistance=this.previousScale=0,this.currentDropdownOwner=this.isPinchZoomEnabled=null,this.mostRecentEvent=t,this.currentDragDeltaXY=new At(0,0)}dispose(){_e(),$d(),this.creatorWorkspace.clearGesture();for(const t of this.boundEvents)re(t);this.boundEvents.length=0,this.workspaceDragger&&this.workspaceDragger.dispose()}updateFromEvent(t){const o=new At(t.clientX,t.clientY);this.updateDragDelta(o)&&(this.updateIsDragging(t),Te()),this.mostRecentEvent=t}updateDragDelta(t){return this.currentDragDeltaXY=At.difference(t,this.mouseDownXY),this.hasExceededDragRadius?!1:this.hasExceededDragRadius=At.magnitude(this.currentDragDeltaXY)>(this.flyout?n.config$$module$build$src$core$config.flyoutDragRadius:n.config$$module$build$src$core$config.dragRadius)}updateIsDraggingFromFlyout(){let t;if(!this.targetBlock||(t=this.flyout)==null||!t.isBlockCreatable(this.targetBlock))return!1;if(!this.flyout.targetWorkspace)throw Error(`Cannot update dragging from the flyout because the ' +
          'flyout's target workspace is undefined`);return!this.flyout.isScrollable()||this.flyout.isDragTowardWorkspace(this.currentDragDeltaXY)?(this.startWorkspace_=this.flyout.targetWorkspace,this.startWorkspace_.updateScreenCalculationsIfScrolled(),n.getGroup$$module$build$src$core$events$utils()||n.setGroup$$module$build$src$core$events$utils(!0),this.startBlock=null,this.targetBlock=this.flyout.createBlock(this.targetBlock),n.setSelected$$module$build$src$core$common(this.targetBlock),!0):!1}updateIsDraggingWorkspace(){if(!this.startWorkspace_)throw Error("Cannot update dragging the workspace because the start workspace is undefined");(this.flyout?this.flyout.isScrollable():this.startWorkspace_&&this.startWorkspace_.isDraggable())&&(this.dragging=!0,this.workspaceDragger=new t1(this.startWorkspace_),this.workspaceDragger.startDrag())}updateIsDragging(t){if(!this.startWorkspace_)throw Error("Cannot update dragging because the start workspace is undefined");if(this.calledUpdateIsDragging)throw Error("updateIsDragging_ should only be called once per gesture.");this.calledUpdateIsDragging=!0,this.flyout&&this.updateIsDraggingFromFlyout();const o=de();o&&el(o)&&o.isMovable()?(this.dragging=!0,this.dragger=this.createDragger(o,this.startWorkspace_),this.dragger.onDragStart(t),this.dragger.onDrag(t,this.currentDragDeltaXY)):this.updateIsDraggingWorkspace()}createDragger(t,o){return new(p(yt.BLOCK_DRAGGER,this.creatorWorkspace.options,!0))(t,o)}doStart(t){if(!this.startWorkspace_)throw Error("Cannot start the touch gesture becauase the start workspace is undefined");this.isPinchZoomEnabled=this.startWorkspace_.options.zoomOptions&&this.startWorkspace_.options.zoomOptions.pinch,Ye(t)?this.cancel():(this.gestureHasStarted=!0,ec(),this.startWorkspace_.updateScreenCalculationsIfScrolled(),this.startWorkspace_.isMutator&&this.startWorkspace_.resize(),this.currentDropdownOwner=Qt(),this.startWorkspace_.hideChaff(!!this.flyout),this.startWorkspace_.markFocused(),this.mostRecentEvent=t,Sd(),Fe(t)?this.handleRightClick(t):(t.type.toLowerCase()==="pointerdown"&&t.pointerType!=="mouse"&&ue(t,this),this.mouseDownXY=new At(t.clientX,t.clientY),this.bindMouseEvents(t),this.isEnding_||this.handleTouchStart(t)))}bindMouseEvents(t){this.boundEvents.push(Ue(document,"pointerdown",null,this.handleStart.bind(this),!0)),this.boundEvents.push(Ue(document,"pointermove",null,this.handleMove.bind(this),!0)),this.boundEvents.push(Ue(document,"pointerup",null,this.handleUp.bind(this),!0)),t.preventDefault(),t.stopPropagation()}handleStart(t){this.isDragging()||(this.handleTouchStart(t),this.isMultiTouch()&&Te())}handleMove(t){this.isDragging()&&Re(t)||!this.isMultiTouch()?(this.updateFromEvent(t),this.workspaceDragger?this.workspaceDragger.drag(this.currentDragDeltaXY):this.dragger&&this.dragger.onDrag(this.mostRecentEvent,this.currentDragDeltaXY),t.preventDefault(),t.stopPropagation()):this.isMultiTouch()&&(this.handleTouchMove(t),Te())}handleUp(t){if(this.isDragging()||this.handleTouchEnd(t),!this.isMultiTouch()||this.isDragging()){if(!Re(t))return;if(this.updateFromEvent(t),Te(),this.isEnding_){console.log("Trying to end a gesture recursively.");return}this.isEnding_=!0,this.dragger?this.dragger.onDragEnd(t,this.currentDragDeltaXY):this.workspaceDragger?this.workspaceDragger.endDrag(this.currentDragDeltaXY):this.isBubbleClick()||this.isCommentClick()||(this.isFieldClick()?this.doFieldClick():this.isIconClick()?this.doIconClick():this.isBlockClick()?this.doBlockClick():this.isWorkspaceClick()&&this.doWorkspaceClick(t))}t.preventDefault(),t.stopPropagation(),this.dispose()}handleTouchStart(t){var o=De(t);this.cachedPoints.set(o,this.getTouchPoint(t));var c=Array.from(this.cachedPoints.keys());c.length===2&&(o=this.cachedPoints.get(c[0]),c=this.cachedPoints.get(c[1]),this.startDistance=At.distance(o,c),this.isMultiTouch_=!0,t.preventDefault())}handleTouchMove(t){const o=De(t);this.cachedPoints.set(o,this.getTouchPoint(t)),this.isPinchZoomEnabled&&this.cachedPoints.size===2?this.handlePinch(t):this.handleMove(t)}handlePinch(t){var o=Array.from(this.cachedPoints.keys()),c=this.cachedPoints.get(o[0]);if(o=this.cachedPoints.get(o[1]),c=At.distance(c,o)/this.startDistance,0<this.previousScale&&1/0>this.previousScale){if(o=c-this.previousScale,o=0<o?o*cG:o*uG,!this.startWorkspace_)throw Error("Cannot handle a pinch because the start workspace is undefined");const g=this.startWorkspace_,$=Ze(t,g.getParentSvg(),g.getInverseScreenCTM());g.zoom($.x,$.y,o)}this.previousScale=c,t.preventDefault()}handleTouchEnd(t){t=De(t),this.cachedPoints.has(t)&&this.cachedPoints.delete(t),2>this.cachedPoints.size&&(this.cachedPoints.clear(),this.previousScale=0)}getTouchPoint(t){return this.startWorkspace_?new At(t.pageX,t.pageY):null}isMultiTouch(){return this.isMultiTouch_}cancel(){this.isEnding_||(Te(),this.dragger?this.dragger.onDragEnd(this.mostRecentEvent,this.currentDragDeltaXY):this.workspaceDragger&&this.workspaceDragger.endDrag(this.currentDragDeltaXY),this.dispose())}handleRightClick(t){this.targetBlock?(this.bringBlockToFront(),this.targetBlock.workspace.hideChaff(!!this.flyout),this.targetBlock.showContextMenu(t)):this.startBubble?this.startBubble.showContextMenu(t):this.startComment?(this.startComment.workspace.hideChaff(),this.startComment.showContextMenu(t)):this.startWorkspace_&&!this.flyout&&(this.startWorkspace_.hideChaff(),this.startWorkspace_.showContextMenu(t)),t.preventDefault(),t.stopPropagation(),this.dispose()}handleWsStart(t,o){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleWsStart, but the gesture had already been started.");this.setStartWorkspace(o),this.mostRecentEvent=t,this.startBlock||this.startBubble||this.startComment||n.setSelected$$module$build$src$core$common(null),this.doStart(t)}fireWorkspaceClick(t){b(new(k(cr))(null,t.id,"workspace"))}handleFlyoutStart(t,o){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleFlyoutStart, but the gesture had already been started.");this.setStartFlyout(o),this.handleWsStart(t,o.getWorkspace())}handleBlockStart(t,o){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBlockStart, but the gesture had already been started.");this.setStartBlock(o),this.mostRecentEvent=t}handleBubbleStart(t,o){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBubbleStart, but the gesture had already been started.");this.setStartBubble(o),this.mostRecentEvent=t}handleCommentStart(t,o){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleCommentStart, but the gesture had already been started.");this.setStartComment(o),this.mostRecentEvent=t}doFieldClick(){if(!this.startField)throw Error("Cannot do a field click because the start field is undefined");this.currentDropdownOwner!==this.startField&&this.startField.showEditor(this.mostRecentEvent),this.bringBlockToFront()}doIconClick(){if(!this.startIcon)throw Error("Cannot do an icon click because the start icon is undefined");this.bringBlockToFront(),this.startIcon.onClick()}doBlockClick(){if(this.flyout&&this.flyout.autoClose){if(!this.targetBlock)throw Error("Cannot do a block click because the target block is undefined");if(this.targetBlock.isEnabled()){n.getGroup$$module$build$src$core$events$utils()||n.setGroup$$module$build$src$core$events$utils(!0);var t=this.flyout.createBlock(this.targetBlock);t.snapToGrid(),t.bumpNeighbours()}}else{if(!this.startWorkspace_)throw Error("Cannot do a block click because the start workspace is undefined");t=new(k(cr))(this.startBlock,this.startWorkspace_.id,"block"),b(t)}this.bringBlockToFront(),n.setGroup$$module$build$src$core$events$utils(!1)}doWorkspaceClick(t){t=this.creatorWorkspace,de()&&de().unselect(),this.fireWorkspaceClick(this.startWorkspace_||t)}bringBlockToFront(){this.targetBlock&&!this.flyout&&this.targetBlock.bringToFront()}setStartField(t){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartField, but the gesture had already been started.");this.startField||(this.startField=t)}setStartIcon(t){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartIcon, but the gesture had already been started.");this.startIcon||(this.startIcon=t)}setStartBubble(t){this.startBubble||(this.startBubble=t)}setStartComment(t){this.startComment||(this.startComment=t)}setStartBlock(t){this.startBlock||this.startBubble||(this.startBlock=t,n.setSelected$$module$build$src$core$common(this.startBlock),t.isInFlyout&&t!==t.getRootBlock()?this.setTargetBlock(t.getRootBlock()):this.setTargetBlock(t))}setTargetBlock(t){t.isShadow()?this.setTargetBlock(t.getParent()):this.targetBlock=t}setStartWorkspace(t){this.startWorkspace_||(this.startWorkspace_=t)}setStartFlyout(t){this.flyout||(this.flyout=t)}isBubbleClick(){return!!this.startBubble&&!this.hasExceededDragRadius}isCommentClick(){return!!this.startComment&&!this.hasExceededDragRadius}isBlockClick(){return!!this.startBlock&&!this.hasExceededDragRadius&&!this.isFieldClick()&&!this.isIconClick()}isFieldClick(){return this.startField?this.startField.isClickable()&&!this.hasExceededDragRadius&&(!this.flyout||this.startField.isClickableInFlyout(this.flyout.autoClose)):!1}isIconClick(){if(!this.startIcon)return!1;const t=!this.flyout||!this.startIcon.isClickableInFlyout||this.startIcon.isClickableInFlyout(this.flyout.autoClose);return!this.hasExceededDragRadius&&t}isWorkspaceClick(){return!this.startBlock&&!this.startBubble&&!this.startField&&!this.hasExceededDragRadius}getCurrentDragger(){let t,o;return(o=(t=this.workspaceDragger)!=null?t:this.dragger)!=null?o:null}isDragging(){return this.dragging}hasStarted(){return this.gestureHasStarted}static inProgress(){const t=ce();for(let o=0,c;c=t[o];o++)if(c.currentGesture_)return!0;return!1}},Pb=class{constructor(t,o){this.pattern=t,this.scale=1;let c;this.spacing=(c=o.spacing)!=null?c:0;let g;this.length=(g=o.length)!=null?g:1,this.line2=(this.line1=t.firstChild)&&this.line1.nextSibling;let $;this.snapToGrid=($=o.snap)!=null?$:!1}setSpacing(t){this.spacing=t,this.update(this.scale)}getSpacing(){return this.spacing}setLength(t){this.length=t,this.update(this.scale)}getLength(){return this.length}setSnapToGrid(t){this.snapToGrid=t}shouldSnap(){return this.snapToGrid}getPatternId(){return this.pattern.id}update(t){this.scale=t;var o=this.spacing*t;this.pattern.setAttribute("width",`${o}`),this.pattern.setAttribute("height",`${o}`),o=Math.floor(this.spacing/2)+.5;let c=o-this.length/2,g=o+this.length/2;o*=t,c*=t,g*=t,this.setLineAttributes(this.line1,t,c,g,o,o),this.setLineAttributes(this.line2,t,o,o,c,g)}setLineAttributes(t,o,c,g,$,M){t&&(t.setAttribute("stroke-width",`${o}`),t.setAttribute("x1",`${c}`),t.setAttribute("y1",`${$}`),t.setAttribute("x2",`${g}`),t.setAttribute("y2",`${M}`))}moveTo(t,o){this.pattern.setAttribute("x",`${t}`),this.pattern.setAttribute("y",`${o}`)}alignXY(t){var o=this.getSpacing();const c=o/2,g=Math.round(Math.round((t.x-c)/o)*o+c);return o=Math.round(Math.round((t.y-c)/o)*o+c),g===t.x&&o===t.y?t:new At(g,o)}static createDom(t,o,c){t=Ce(Ve.PATTERN,{id:"blocklyGridPattern"+t,patternUnits:"userSpaceOnUse"},c);let g,$;if(0<((g=o.length)!=null?g:1)&&0<(($=o.spacing)!=null?$:0)){Ce(Ve.LINE,{stroke:o.colour},t);let M;(M=o.length)!=null&&M&&Ce(Ve.LINE,{stroke:o.colour},t)}else Ce(Ve.LINE,{},t);return t}},n1={};n1.deepMerge=tl;var gf=class{constructor(t,o,c,g){this.name=t,this.startHats=!1,this.blockStyles=o||Object.create(null),this.categoryStyles=c||Object.create(null),this.componentStyles=g||Object.create(null),this.fontStyle=Object.create(null),r(yt.THEME,t,this,!0)}getClassName(){return this.name+"-theme"}setBlockStyle(t,o){this.blockStyles[t]=o}setCategoryStyle(t,o){this.categoryStyles[t]=o}getComponentStyle(t){if(t=this.componentStyles[t],!t)return null;if(typeof t=="string"){const o=this.getComponentStyle(t);if(o)return o}return`${t}`}setComponentStyle(t,o){this.componentStyles[t]=o}setFontStyle(t){this.fontStyle=t}setStartHats(t){this.startHats=t}static defineTheme(t,o){t=t.toLowerCase();const c=new gf(t);let g=o.base;if(g){if(typeof g=="string"){let $;g=($=h(yt.THEME,g))!=null?$:void 0}g instanceof gf&&(tl(c,g),c.name=t)}return tl(c.blockStyles,o.blockStyles),tl(c.categoryStyles,o.categoryStyles),tl(c.componentStyles,o.componentStyles),tl(c.fontStyle,o.fontStyle),o.startHats!==null&&(c.startHats=o.startHats),c}},hG={colour_blocks:{colourPrimary:"20"},list_blocks:{colourPrimary:"260"},logic_blocks:{colourPrimary:"210"},loop_blocks:{colourPrimary:"120"},math_blocks:{colourPrimary:"230"},procedure_blocks:{colourPrimary:"290"},text_blocks:{colourPrimary:"160"},variable_blocks:{colourPrimary:"330"},variable_dynamic_blocks:{colourPrimary:"310"},hat_blocks:{colourPrimary:"330",hat:"cap"}},dG={colour_category:{colour:"20"},list_category:{colour:"260"},logic_category:{colour:"210"},loop_category:{colour:"120"},math_category:{colour:"230"},procedure_category:{colour:"290"},text_category:{colour:"160"},variable_category:{colour:"330"},variable_dynamic_category:{colour:"310"}},cy=new gf("classic",hG,dG),Ma=class{constructor(t){this.gridPattern=null,this.getMetrics=this.setMetrics=void 0;let o=null,c=!1;var g=!1,$=!1,M=!1,Q=!1,be=!1;const nt=!!t.readOnly;if(!nt){var Dt;o=pi((Dt=t.toolbox)!=null?Dt:null),c=vi(o),g=t.trashcan,g=g===void 0?c:g,$=t.collapse,$=$===void 0?c:$,M=t.comments,M=M===void 0?c:M,Q=t.disable,Q=Q===void 0?c:Q,be=t.sounds,be=be===void 0?!0:be}Dt=t.maxTrashcanContents,g?Dt===void 0&&(Dt=32):Dt=0;const Ni=!!t.rtl;let Mi=t.horizontalLayout;Mi===void 0&&(Mi=!1);var $o=t.toolboxPosition!=="end";$o=Mi?$o?Cn.TOP:Cn.BOTTOM:$o===Ni?Cn.RIGHT:Cn.LEFT;let Lm=t.css;Lm===void 0&&(Lm=!0);let Cv="https://blockly-demo.appspot.com/static/media/";t.media&&(Cv=t.media.endsWith("/")?t.media:t.media+"/");const aO=t.oneBasedIndex,WG=t.renderer||"geras",XG=t.plugins||{};let wA=t.modalInputs;wA===void 0&&(wA=!0),this.RTL=Ni,this.oneBasedIndex=aO===void 0?!0:aO,this.collapse=$,this.comments=M,this.disable=Q,this.readOnly=nt,this.maxBlocks=t.maxBlocks||1/0;let lO;this.maxInstances=(lO=t.maxInstances)!=null?lO:null,this.modalInputs=wA,this.pathToMedia=Cv,this.hasCategories=c,this.moveOptions=Ma.parseMoveOptions_(t,c),this.hasScrollbars=!!this.moveOptions.scrollbars,this.hasTrashcan=g,this.maxTrashcanContents=Dt,this.hasSounds=be,this.hasCss=Lm,this.horizontalLayout=Mi,this.languageTree=o,this.gridOptions=Ma.parseGridOptions_(t),this.zoomOptions=Ma.parseZoomOptions_(t),this.toolboxPosition=$o,this.theme=Ma.parseThemeOptions_(t),this.renderer=WG;let cO;this.rendererOverrides=(cO=t.rendererOverrides)!=null?cO:null;let uO;this.parentWorkspace=(uO=t.parentWorkspace)!=null?uO:null,this.plugins=XG}static parseMoveOptions_(t,o){const c=t.move||{},g={};return c.scrollbars===void 0&&t.scrollbars===void 0?g.scrollbars=o:typeof c.scrollbars=="object"?(g.scrollbars={horizontal:!!c.scrollbars.horizontal,vertical:!!c.scrollbars.vertical},g.scrollbars.horizontal&&g.scrollbars.vertical?g.scrollbars=!0:g.scrollbars.horizontal||g.scrollbars.vertical||(g.scrollbars=!1)):g.scrollbars=!!c.scrollbars||!!t.scrollbars,g.wheel=g.scrollbars&&c.wheel!==void 0?!!c.wheel:typeof g.scrollbars=="object",g.drag=g.scrollbars?c.drag===void 0?!0:!!c.drag:!1,g}static parseZoomOptions_(t){t=t.zoom||{};const o={};return o.controls=t.controls===void 0?!1:!!t.controls,o.wheel=t.wheel===void 0?!1:!!t.wheel,o.startScale=t.startScale===void 0?1:Number(t.startScale),o.maxScale=t.maxScale===void 0?3:Number(t.maxScale),o.minScale=t.minScale===void 0?.3:Number(t.minScale),o.scaleSpeed=t.scaleSpeed===void 0?1.2:Number(t.scaleSpeed),o.pinch=t.pinch===void 0?o.wheel||o.controls:!!t.pinch,o}static parseGridOptions_(t){t=t.grid||{};const o={};return o.spacing=Number(t.spacing)||0,o.colour=t.colour||"#888",o.length=t.length===void 0?1:Number(t.length),o.snap=0<o.spacing&&!!t.snap,o}static parseThemeOptions_(t){return t=t.theme||cy,typeof t=="string"?h(yt.THEME,t):t instanceof gf?t:gf.defineTheme(t.name||"builtin"+m(),t)}};n.Names$$module$build$src$core$names=class{constructor(t,o){this.db=new Map,this.dbReverse=new Set,this.variableMap=null,this.variablePrefix=o||"",this.reservedWords=new Set(t?t.split(","):[])}reset(){this.db.clear(),this.dbReverse.clear(),this.variableMap=null}setVariableMap(t){this.variableMap=t}getNameForUserVariable(t){return this.variableMap?(t=this.variableMap.getVariableById(t))?t.name:null:(console.warn(`Deprecated call to Names.prototype.getName without defining a variable map. To fix, add the following code in your generator's init() function:
Blockly.YourGeneratorName.nameDB_.setVariableMap(workspace.getVariableMap());`),null)}populateVariables(t){t=n.allUsedVarModels$$module$build$src$core$variables(t);for(let o=0;o<t.length;o++)this.getName(t[o].getId(),n.NameType$$module$build$src$core$names.VARIABLE)}populateProcedures(t){throw Error("The implementation of populateProcedures should be monkey-patched in by blockly.ts")}getName(t,o){let c=t;o===n.NameType$$module$build$src$core$names.VARIABLE&&(t=this.getNameForUserVariable(t))&&(c=t),t=c.toLowerCase();const g=o===n.NameType$$module$build$src$core$names.VARIABLE||o===n.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"";this.db.has(o)||this.db.set(o,new Map);const $=this.db.get(o);return $.has(t)?g+$.get(t):(o=this.getDistinctName(c,o),$.set(t,o.substr(g.length)),o)}getUserNames(t){let o;return(t=(o=this.db.get(t))==null?void 0:o.keys())?Array.from(t):[]}getDistinctName(t,o){t=this.safeName(t);let c=null,g,$;for(;this.dbReverse.has(t+((g=c)!=null?g:""))||this.reservedWords.has(t+(($=c)!=null?$:""));)c=c?c+1:2;let M;return t+=(M=c)!=null?M:"",this.dbReverse.add(t),(o===n.NameType$$module$build$src$core$names.VARIABLE||o===n.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"")+t}safeName(t){return t?(t=encodeURI(t.replace(/ /g,"_")).replace(/[^\w]/g,"_"),"0123456789".includes(t[0])&&(t="my_"+t)):t=n.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed",t}static equals(t,o){return t.toLowerCase()===o.toLowerCase()}},function(t){t=t.NameType||(t.NameType={}),t.DEVELOPER_VARIABLE="DEVELOPER_VARIABLE",t.VARIABLE="VARIABLE",t.PROCEDURE="PROCEDURE"}(n.Names$$module$build$src$core$names||(n.Names$$module$build$src$core$names={})),n.NameType$$module$build$src$core$names=n.Names$$module$build$src$core$names.NameType,n.Names$$module$build$src$core$names.DEVELOPER_VARIABLE_TYPE=n.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE,n.NameType$$module$build$src$core$names,n.Names$$module$build$src$core$names;var i1=class extends Map{constructor(){super()}set(t,o){return this.get(t)===o?this:(super.set(t,o),Nd(o)&&o.startPublishing(),this)}delete(t){const o=this.get(t);return t=super.delete(t),t&&(Nd(o)&&o.stopPublishing(),t)}clear(){if(this.size)for(const t of this.keys())this.delete(t)}add(t){return this.set(t.getId(),t)}getProcedures(){return[...this.values()]}},uy=class{constructor(t){this.sourceBlock=t,this.offsetInBlock=new At(0,0),this.workspaceLocation=new At(0,0),this.svgRoot=null,this.tooltip=t}getType(){throw Error("Icons must implement getType")}initView(t){if(!this.svgRoot){var o=this.sourceBlock;this.svgRoot=Ce(Ve.G,{class:"blocklyIconGroup"}),o.getSvgRoot().appendChild(this.svgRoot),this.updateSvgRootOffset(),Ue(this.svgRoot,"pointerdown",this,t),this.svgRoot.tooltip=this,Ar(this.svgRoot)}}dispose(){es(this.svgRoot),W(this.svgRoot)}getWeight(){return-1}getSize(){return new Kn(0,0)}setTooltip(t){this.tooltip=t??this.sourceBlock}getTooltip(){return this.tooltip}applyColour(){}updateEditable(){}updateCollapsed(){this.svgRoot&&(this.sourceBlock.isCollapsed()?this.svgRoot.style.display="none":this.svgRoot.style.display="block",Ee(this)&&this.setBubbleVisible(!1))}hideForInsertionMarker(){this.svgRoot&&(this.svgRoot.style.display="none")}isShownWhenCollapsed(){return!1}setOffsetInBlock(t){this.offsetInBlock=t,this.updateSvgRootOffset()}updateSvgRootOffset(){let t;(t=this.svgRoot)==null||t.setAttribute("transform",`translate(${this.offsetInBlock.x}, ${this.offsetInBlock.y})`)}onLocationChange(t){this.workspaceLocation=At.sum(t,this.offsetInBlock)}onClick(){}isClickableInFlyout(t){return!0}},r1={fromJsonInternal:x_},hy={TEST_ONLY:r1};hy.fromJson=n.fromJson$$module$build$src$core$field_registry,hy.register=zo,hy.unregister=C_;var uc=class extends bi{constructor(t,o,c){super(bi.SKIP_SETUP),this.svgArrow=this.arrow=this.imageElement=this.menu_=this.selectedMenuItem=null,this.SERIALIZABLE=!0,this.CURSOR="default",this.clickTarget_=this.suffixField=this.prefixField=this.generatedOptions=null,t!==bi.SKIP_SETUP&&(Array.isArray(t)?(Uc(t),t=Wo(t),this.menuGenerator_=t.options,this.prefixField=t.prefix||null,this.suffixField=t.suffix||null):this.menuGenerator_=t,this.selectedOption=this.getOptions(!1)[0],c&&this.configure_(c),this.setValue(this.selectedOption[1]),o&&this.setValidator(o))}fromXml(t){this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(t.textContent)}loadState(t){this.loadLegacyState(uc,t)||(this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(t))}initView(){this.shouldAddBorderRect_()?this.createBorderRect_():this.clickTarget_=this.sourceBlock_.getSvgRoot(),this.createTextElement_(),this.imageElement=Ce(Ve.IMAGE,{},this.fieldGroup_),this.getConstants().FIELD_DROPDOWN_SVG_ARROW?this.createSVGArrow_():this.createTextArrow_(),this.borderRect_&&Me(this.borderRect_,"blocklyDropdownRect")}shouldAddBorderRect_(){let t;return!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW&&!((t=this.getSourceBlock())!=null&&t.isShadow())}createTextArrow_(){this.arrow=Ce(Ve.TSPAN,{},this.textElement_);let t;this.arrow.appendChild(document.createTextNode((t=this.getSourceBlock())!=null&&t.RTL?uc.ARROW_CHAR+" ":" "+uc.ARROW_CHAR)),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.arrow.setAttribute("dominant-baseline","central");let o;(o=this.getSourceBlock())!=null&&o.RTL?this.getTextElement().insertBefore(this.arrow,this.textContent_):this.getTextElement().appendChild(this.arrow)}createSVGArrow_(){this.svgArrow=Ce(Ve.IMAGE,{height:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px",width:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px"},this.fieldGroup_),this.svgArrow.setAttributeNS(Zo,"xlink:href",this.getConstants().FIELD_DROPDOWN_SVG_ARROW_DATAURI)}showEditor_(t){var o=this.getSourceBlock();if(!o)throw new hr;this.dropdownCreate(),this.menu_.openingCoords=t&&typeof t.clientX=="number"?new At(t.clientX,t.clientY):null,li(),t=this.menu_.render(yn()),Me(t,"blocklyDropdownMenu"),this.getConstants().FIELD_DROPDOWN_COLOURED_DIV&&(o=o.getColour(),ci(o,this.sourceBlock_.style.colourTertiary)),us(this,this.dropdownDispose_.bind(this)),this.menu_.focus(),this.selectedMenuItem&&(this.menu_.setHighlighted(this.selectedMenuItem),Be(this.selectedMenuItem.getElement(),yn(),!0)),this.applyColour()}dropdownCreate(){const t=this.getSourceBlock();if(!t)throw new hr;const o=new Tb;o.setRole(pl.LISTBOX),this.menu_=o;const c=this.getOptions(!1);this.selectedMenuItem=null;for(let $=0;$<c.length;$++){const[M,Q]=c[$];if(typeof M=="object"){var g=new Image(M.width,M.height);g.src=M.src,g.alt=M.alt||""}else g=M;g=new Eb(g,Q),g.setRole(pl.OPTION),g.setRightToLeft(t.RTL),g.setCheckable(!0),o.addChild(g),g.setChecked(Q===this.value_),Q===this.value_&&(this.selectedMenuItem=g),g.onAction(this.handleMenuActionEvent,this)}}dropdownDispose_(){this.menu_&&this.menu_.dispose(),this.selectedMenuItem=this.menu_=null,this.applyColour()}handleMenuActionEvent(t){Fu(this,!0),this.onItemSelected_(this.menu_,t)}onItemSelected_(t,o){this.setValue(o.getValue())}isOptionListDynamic(){return typeof this.menuGenerator_=="function"}getOptions(t){if(!this.menuGenerator_)throw TypeError("A menu generator was never defined.");return Array.isArray(this.menuGenerator_)?this.menuGenerator_:t&&this.generatedOptions?this.generatedOptions:(this.generatedOptions=this.menuGenerator_(),Uc(this.generatedOptions),this.generatedOptions)}doClassValidation_(t){return this.getOptions(!0).some(o=>o[1]===t)?t:(this.sourceBlock_&&console.warn("Cannot set the dropdown's value to an unavailable option. Block type: "+this.sourceBlock_.type+", Field name: "+this.name+", Value: "+t),null)}doValueUpdate_(t){super.doValueUpdate_(t),t=this.getOptions(!0);for(let o=0,c;c=t[o];o++)c[1]===this.value_&&(this.selectedOption=c)}applyColour(){const t=this.sourceBlock_.style;this.borderRect_&&(this.borderRect_.setAttribute("stroke",t.colourTertiary),this.menu_?this.borderRect_.setAttribute("fill",t.colourTertiary):this.borderRect_.setAttribute("fill","transparent")),this.sourceBlock_&&this.arrow&&(this.sourceBlock_.isShadow()?this.arrow.style.fill=t.colourSecondary:this.arrow.style.fill=t.colourPrimary)}render_(){this.getTextContent().nodeValue="",this.imageElement.style.display="none";const t=this.selectedOption&&this.selectedOption[0];t&&typeof t=="object"?this.renderSelectedImage(t):this.renderSelectedText(),this.positionBorderRect_()}renderSelectedImage(t){const o=this.getSourceBlock();if(!o)throw new hr;this.imageElement.style.display="",this.imageElement.setAttributeNS(Zo,"xlink:href",t.src),this.imageElement.setAttribute("height",String(t.height)),this.imageElement.setAttribute("width",String(t.width));const c=Number(t.height);t=Number(t.width);var g=!!this.borderRect_;const $=Math.max(g?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,c+pG);g=g?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;let M;M=this.svgArrow?this.positionSVGArrow(t+g,$/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2):Ge(this.arrow,this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY),this.size_.width=t+M+2*g,this.size_.height=$;let Q=0;o.RTL?this.imageElement.setAttribute("x",`${g+M}`):(Q=t+M,this.getTextElement().setAttribute("text-anchor","end"),this.imageElement.setAttribute("x",`${g}`)),this.imageElement.setAttribute("y",String($/2-c/2)),this.positionTextElement_(Q+g,t+M)}renderSelectedText(){this.getTextContent().nodeValue=this.getDisplayText_();var t=this.getTextElement();Me(t,"blocklyDropdownText"),t.setAttribute("text-anchor","start");var o=!!this.borderRect_;t=Math.max(o?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,this.getConstants().FIELD_TEXT_HEIGHT);const c=Ge(this.getTextElement(),this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY);o=o?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;let g=0;this.svgArrow&&(g=this.positionSVGArrow(c+o,t/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2)),this.size_.width=c+g+2*o,this.size_.height=t,this.positionTextElement_(o,c)}positionSVGArrow(t,o){if(!this.svgArrow)return 0;const c=this.getSourceBlock();if(!c)throw new hr;const g=this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,$=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_PADDING,M=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE;return this.svgArrow.setAttribute("transform","translate("+(c.RTL?g:t+$)+","+o+")"),M+$}getText_(){if(!this.selectedOption)return null;const t=this.selectedOption[0];return typeof t=="object"?t.alt:t}static fromJson(t){if(!t.options)throw Error("options are required for the dropdown field. The options property must be assigned an array of [humanReadableValue, languageNeutralValue] tuples.");return new this(t.options,void 0,t)}};uc.CHECKMARK_OVERHANG=25,uc.MAX_MENU_HEIGHT_VH=.45,uc.ARROW_CHAR="▾";var fG=5,pG=2*fG;zo("field_dropdown",uc);var s1=class{constructor(t,o){this.bubble=t,this.workspace=o,this.startLoc=null}isMovable(){return!0}startDrag(){n.getGroup$$module$build$src$core$events$utils()||n.setGroup$$module$build$src$core$events$utils(!0),this.startLoc=this.bubble.getRelativeToSurfaceXY(),this.workspace.setResizesEnabled(!1);let t;(t=this.workspace.getLayerManager())==null||t.moveToDragLayer(this.bubble),this.bubble.setDragging&&this.bubble.setDragging(!0)}drag(t){this.bubble.moveDuringDrag(t)}endDrag(){this.workspace.setResizesEnabled(!0),n.setGroup$$module$build$src$core$events$utils(!1);let t;(t=this.workspace.getLayerManager())==null||t.moveOffDragLayer(this.bubble,mb),this.bubble.setDragging(!1)}revertDrag(){this.startLoc&&this.bubble.moveDuringDrag(this.startLoc)}},Qo,di=class{constructor(t,o,c){this.workspace=t,this.anchor=o,this.ownerRect=c,this.size=new Kn(0,0),this.colour="#ffffff",this.disposed=!1,this.relativeLeft=this.relativeTop=0,this.dragStrategy=new s1(this,this.workspace),this.id=m(),this.svgRoot=Ce(Ve.G,{class:"blocklyBubble"},t.getBubbleCanvas()),t=Ce(Ve.G,{filter:`url(#${this.workspace.getRenderer().getConstants().embossFilterId})`},this.svgRoot),this.tail=Ce(Ve.PATH,{class:"blocklyBubbleTail"},t),this.background=Ce(Ve.RECT,{class:"blocklyDraggable",x:0,y:0,rx:Qo.BORDER_WIDTH,ry:Qo.BORDER_WIDTH},t),this.contentContainer=Ce(Ve.G,{},this.svgRoot),Ue(this.background,"pointerdown",this,this.onMouseDown)}dispose(){W(this.svgRoot),this.disposed=!0}setAnchorLocation(t,o=!1){this.anchor=t,o?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}setPositionRelativeToAnchor(t,o){this.relativeLeft=t,this.relativeTop=o,this.positionRelativeToAnchor(),this.renderTail()}getSize(){return this.size}setSize(t,o=!1){t.width=Math.max(t.width,Qo.MIN_SIZE),t.height=Math.max(t.height,Qo.MIN_SIZE),this.size=t,this.background.setAttribute("width",`${t.width}`),this.background.setAttribute("height",`${t.height}`),o?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}getColour(){return this.colour}setColour(t){this.colour=t,this.tail.setAttribute("fill",t),this.background.setAttribute("fill",t)}onMouseDown(t){let o;(o=this.workspace.getGesture(t))==null||o.handleBubbleStart(t,this),n.setSelected$$module$build$src$core$common(this)}positionRelativeToAnchor(){let t=this.anchor.x;t=this.workspace.RTL?t-(this.relativeLeft+this.size.width):t+this.relativeLeft,this.moveTo(t,this.relativeTop+this.anchor.y)}moveTo(t,o){this.svgRoot.setAttribute("transform",`translate(${t}, ${o})`)}positionByRect(t=new $i(0,0,0,0)){var o=this.workspace.getMetricsManager().getViewMetrics(!0),c=this.getOptimalRelativeLeft(o),g=this.getOptimalRelativeTop(o);const $={x:c,y:-this.size.height-this.workspace.getRenderer().getConstants().MIN_BLOCK_HEIGHT},M={x:-this.size.width-30,y:g};g={x:t.getWidth(),y:g};var Q={x:c,y:t.getHeight()};c=t.getWidth()<t.getHeight()?g:Q,t=t.getWidth()<t.getHeight()?Q:g,g=this.getOverlap($,o),Q=this.getOverlap(M,o);const be=this.getOverlap(c,o);o=this.getOverlap(t,o),o=Math.max(g,Q,be,o),g===o?(this.relativeLeft=$.x,this.relativeTop=$.y):Q===o?(this.relativeLeft=M.x,this.relativeTop=M.y):be===o?(this.relativeLeft=c.x,this.relativeTop=c.y):(this.relativeLeft=t.x,this.relativeTop=t.y),this.positionRelativeToAnchor()}getOverlap(t,o){var c=this.workspace.RTL?this.anchor.x-t.x-this.size.width:t.x+this.anchor.x;return t=t.y+this.anchor.y,Math.max(0,Math.min(1,(Math.min(c+this.size.width,o.left+o.width)-Math.max(c,o.left))*(Math.min(t+this.size.height,o.top+o.height)-Math.max(t,o.top))/(this.size.width*this.size.height)))}getOptimalRelativeLeft(t){let o=-this.size.width/4;if(this.size.width>t.width)return o;if(t=this.getWorkspaceViewRect(t),this.workspace.RTL){var c=this.anchor.x-o;c-this.size.width<t.left?o=-(t.left-this.anchor.x+this.size.width):c>t.right&&(o=-(t.right-this.anchor.x))}else{c=o+this.anchor.x;const g=c+this.size.width;c<t.left?o=t.left-this.anchor.x:g>t.right&&(o=t.right-this.anchor.x-this.size.width)}return o}getOptimalRelativeTop(t){let o=-this.size.height/4;if(this.size.height>t.height)return o;const c=this.anchor.y+o,g=c+this.size.height;return t=this.getWorkspaceViewRect(t),c<t.top?o=t.top-this.anchor.y:g>t.bottom&&(o=t.bottom-this.anchor.y-this.size.height),o}getWorkspaceViewRect(t){const o=t.top;let c=t.top+t.height,g=t.left;return t=t.left+t.width,c-=this.getScrollbarThickness(),this.workspace.RTL?g-=this.getScrollbarThickness():t-=this.getScrollbarThickness(),new $i(o,c,g,t)}getScrollbarThickness(){return ur.scrollbarThickness/this.workspace.scale}renderTail(){const t=[];var o=this.size.width/2,c=this.size.height/2,g=-this.relativeLeft,$=-this.relativeTop;if(o===g&&c===$)t.push("M "+o+","+c);else{$-=c,g-=o,this.workspace.RTL&&(g*=-1);var M=Math.sqrt($*$+g*g),Q=Math.acos(g/M);0>$&&(Q=2*Math.PI-Q);var be=Q+Math.PI/2;be>2*Math.PI&&(be-=2*Math.PI);var nt=Math.sin(be);const Ni=Math.cos(be);let Mi=(this.size.width+this.size.height)/Qo.TAIL_THICKNESS;Mi=Math.min(Mi,this.size.width,this.size.height)/4,be=1-Qo.ANCHOR_RADIUS/M,g=o+be*g,$=c+be*$,be=o+Mi*Ni;const $o=c+Mi*nt;o-=Mi*Ni,c-=Mi*nt,nt=Oe(this.workspace.RTL?-Qo.TAIL_ANGLE:Qo.TAIL_ANGLE),nt=Q+nt,nt>2*Math.PI&&(nt-=2*Math.PI),Q=Math.sin(nt)*M/Qo.TAIL_BEND,M=Math.cos(nt)*M/Qo.TAIL_BEND,t.push("M"+be+","+$o),t.push("C"+(be+M)+","+($o+Q)+" "+g+","+$+" "+g+","+$),t.push("C"+g+","+$+" "+(o+M)+","+(c+Q)+" "+o+","+c)}t.push("z");let Dt;(Dt=this.tail)==null||Dt.setAttribute("d",t.join(" "))}bringToFront(){let t;const o=(t=this.svgRoot)==null?void 0:t.parentNode;return this.svgRoot&&(o==null?void 0:o.lastChild)!==this.svgRoot?(o==null||o.appendChild(this.svgRoot),!0):!1}getRelativeToSurfaceXY(){return new At(this.workspace.RTL?-this.relativeLeft+this.anchor.x-this.size.width:this.anchor.x+this.relativeLeft,this.anchor.y+this.relativeTop)}getSvgRoot(){return this.svgRoot}moveDuringDrag(t){this.moveTo(t.x,t.y),this.relativeLeft=this.workspace.RTL?this.anchor.x-t.x-this.size.width:t.x-this.anchor.x,this.relativeTop=t.y-this.anchor.y,this.renderTail()}setDragging(t){}setDeleteStyle(t){}isDeletable(){return!1}showContextMenu(t){}isMovable(){return!0}startDrag(){this.dragStrategy.startDrag()}drag(t){this.dragStrategy.drag(t)}endDrag(){this.dragStrategy.endDrag()}revertDrag(){this.dragStrategy.revertDrag()}select(){}unselect(){}};Qo=di,di.BORDER_WIDTH=6,di.DOUBLE_BORDER=2*Qo.BORDER_WIDTH,di.MIN_SIZE=Qo.DOUBLE_BORDER,di.TAIL_THICKNESS=1,di.TAIL_ANGLE=20,di.TAIL_BEND=4,di.ANCHOR_RADIUS=8;var iu=class extends di{constructor(t,o,c,g){super(o,c,g),this.workspace=o,this.anchor=c,this.ownerRect=g,this.autoLayout=!0,o=new Ma(t),this.validateWorkspaceOptions(o),this.svgDialog=Ce(Ve.SVG,{x:di.BORDER_WIDTH,y:di.BORDER_WIDTH},this.contentContainer),t.parentWorkspace=this.workspace,this.miniWorkspace=this.newWorkspaceSvg(new Ma(t)),this.miniWorkspace.internalIsMutator=!0,t=this.miniWorkspace.createDom("blocklyMutatorBackground"),this.svgDialog.appendChild(t),o.languageTree&&(t.insertBefore(this.miniWorkspace.addFlyout(Ve.G),this.miniWorkspace.getCanvas()),t=this.miniWorkspace.getFlyout(),t==null||t.init(this.miniWorkspace),t==null||t.show(o.languageTree)),this.miniWorkspace.addChangeListener(this.onWorkspaceChange.bind(this));let $,M;($=this.miniWorkspace.getFlyout())==null||(M=$.getWorkspace())==null||M.addChangeListener(this.onWorkspaceChange.bind(this)),this.updateBubbleSize()}dispose(){this.miniWorkspace.dispose(),super.dispose()}getWorkspace(){return this.miniWorkspace}addWorkspaceChangeListener(t){this.miniWorkspace.addChangeListener(t)}validateWorkspaceOptions(t){if(t.hasCategories)throw Error("The miniworkspace bubble does not support toolboxes with categories");if(t.hasTrashcan)throw Error("The miniworkspace bubble does not support trashcans");if(t.zoomOptions.controls||t.zoomOptions.wheel||t.zoomOptions.pinch)throw Error("The miniworkspace bubble does not support zooming");if(t.moveOptions.scrollbars||t.moveOptions.wheel||t.moveOptions.drag)throw Error("The miniworkspace bubble does not scrolling/moving the workspace");if(t.horizontalLayout)throw Error("The miniworkspace bubble does not support horizontal layouts")}onWorkspaceChange(){this.bumpBlocksIntoBounds(),this.updateBubbleSize()}bumpBlocksIntoBounds(){if(!this.miniWorkspace.isDragging())for(const t of this.miniWorkspace.getTopBlocks(!1)){const o=t.getRelativeToSurfaceXY();if(20>o.y&&t.moveBy(0,20-o.y),t.RTL){let c=-20;const g=this.miniWorkspace.getFlyout();g&&(c-=g.getWidth()),o.x>c&&t.moveBy(c-o.x,0)}else 20>o.x&&t.moveBy(20-o.x,0)}}updateBubbleSize(){if(!this.miniWorkspace.isDragging()){var t=this.getSize(),o=this.calculateWorkspaceSize();Math.abs(t.width-o.width)<iu.MINIMUM_VIEW_CHANGE&&Math.abs(t.height-o.height)<iu.MINIMUM_VIEW_CHANGE||(this.svgDialog.setAttribute("width",`${o.width}px`),this.svgDialog.setAttribute("height",`${o.height}px`),this.miniWorkspace.setCachedParentSvgSize(o.width,o.height),this.miniWorkspace.RTL&&this.miniWorkspace.getCanvas().setAttribute("transform",`translate(${o.width}, 0)`),this.setSize(new Kn(o.width+di.DOUBLE_BORDER,o.height+di.DOUBLE_BORDER),this.autoLayout),this.miniWorkspace.resize(),this.miniWorkspace.recordDragTargets())}}calculateWorkspaceSize(){var t=this.miniWorkspace.getCanvas().getBBox();let o=t.width+iu.MARGIN;t=t.height+iu.MARGIN;const c=this.miniWorkspace.getFlyout();if(c){const g=c.getWorkspace().getMetricsManager().getScrollMetrics();t=Math.max(t,g.height+20),o+=c.getWidth()}return new Kn(o,t)}updateBlockStyles(){for(var t of this.miniWorkspace.getAllBlocks(!1))t.setStyle(t.getStyleName());let o;if(t=(o=this.miniWorkspace.getFlyout())==null?void 0:o.getWorkspace())for(const c of t.getAllBlocks(!1))c.setStyle(c.getStyleName())}moveDuringDrag(t){super.moveDuringDrag(t),this.autoLayout=!1}moveTo(t,o){super.moveTo(t,o),this.miniWorkspace.recordDragTargets()}newWorkspaceSvg(t){throw Error("The implementation of newWorkspaceSvg should be monkey-patched in by blockly.ts")}};iu.MINIMUM_VIEW_CHANGE=10,iu.MARGIN=3*di.DOUBLE_BORDER;var dy,fy;dy=17,fy=16,n.MutatorIcon$$module$build$src$core$icons$mutator_icon=class extends uy{constructor(t,o){super(o),this.flyoutBlockTypes=t,this.sourceBlock=o,this.saveConnectionsListener=this.updateWorkspacePid=this.rootBlock=this.miniWorkspaceBubble=null}getType(){return n.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE}initView(t){this.svgRoot||(super.initView(t),Ce(Ve.RECT,{class:"blocklyIconShape",rx:"4",ry:"4",height:"16",width:"16"},this.svgRoot),Ce(Ve.PATH,{class:"blocklyIconSymbol",d:"m4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 -0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z"},this.svgRoot),Ce(Ve.CIRCLE,{class:"blocklyIconShape",r:"2.7",cx:"8",cy:"8"},this.svgRoot),Me(this.svgRoot,"blockly-icon-mutator"))}dispose(){super.dispose();let t;(t=this.miniWorkspaceBubble)==null||t.dispose()}getWeight(){return n.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT}getSize(){return new Kn(dy,dy)}applyColour(){super.applyColour();let t;(t=this.miniWorkspaceBubble)==null||t.setColour(this.sourceBlock.style.colourPrimary);let o;(o=this.miniWorkspaceBubble)==null||o.updateBlockStyles()}updateCollapsed(){super.updateCollapsed(),this.sourceBlock.isCollapsed()&&this.setBubbleVisible(!1)}onLocationChange(t){super.onLocationChange(t);let o;(o=this.miniWorkspaceBubble)==null||o.setAnchorLocation(this.getAnchorLocation())}onClick(){super.onClick(),this.sourceBlock.isEditable()&&this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.miniWorkspaceBubble}setBubbleVisible(t){const o=this;return vt.asyncExecutePromiseGeneratorFunction(function*(){if(o.bubbleIsVisible()!==t){if(yield Kt(),t){o.miniWorkspaceBubble=new iu(o.getMiniWorkspaceConfig(),o.sourceBlock.workspace,o.getAnchorLocation(),o.getBubbleOwnerRect()),o.applyColour(),o.createRootBlock(),o.addSaveConnectionsListener();let c;(c=o.miniWorkspaceBubble)==null||c.addWorkspaceChangeListener(o.createMiniWorkspaceChangeListener())}else{let c;(c=o.miniWorkspaceBubble)==null||c.dispose(),o.miniWorkspaceBubble=null,o.saveConnectionsListener&&o.sourceBlock.workspace.removeChangeListener(o.saveConnectionsListener),o.saveConnectionsListener=null}b(new(k(Aa))(o.sourceBlock,t,"mutator"))}})}getMiniWorkspaceConfig(){let t;const o={disable:!1,media:this.sourceBlock.workspace.options.pathToMedia,rtl:this.sourceBlock.RTL,renderer:this.sourceBlock.workspace.options.renderer,rendererOverrides:(t=this.sourceBlock.workspace.options.rendererOverrides)!=null?t:void 0};return this.flyoutBlockTypes.length&&(o.toolbox={kind:"flyoutToolbox",contents:this.flyoutBlockTypes.map(c=>({kind:"block",type:c}))}),o}getAnchorLocation(){const t=dy/2;return At.sum(this.workspaceLocation,new At(t,t))}getBubbleOwnerRect(){const t=this.sourceBlock.getSvgRoot().getBBox();return new $i(t.y,t.y+t.height,t.x,t.x+t.width)}createRootBlock(){if(!this.sourceBlock.decompose)throw Error("Blocks with mutator icons must include a decompose method");this.rootBlock=this.sourceBlock.decompose(this.miniWorkspaceBubble.getWorkspace());for(var t of this.rootBlock.getDescendants(!1))t.queueRender();this.rootBlock.setMovable(!1),this.rootBlock.setDeletable(!1);let o,c,g,$;t=($=(o=this.miniWorkspaceBubble)==null||(c=o.getWorkspace())==null||(g=c.getFlyout())==null?void 0:g.getWidth())!=null?$:0,this.rootBlock.moveBy(this.rootBlock.RTL?-(t+fy):fy,fy)}addSaveConnectionsListener(){this.sourceBlock.saveConnections&&this.rootBlock&&(this.saveConnectionsListener=()=>{this.sourceBlock.saveConnections&&this.rootBlock&&this.sourceBlock.saveConnections(this.rootBlock)},this.saveConnectionsListener(),this.sourceBlock.workspace.addChangeListener(this.saveConnectionsListener))}createMiniWorkspaceChangeListener(){return t=>{n.MutatorIcon$$module$build$src$core$icons$mutator_icon.isIgnorableMutatorEvent(t)||this.updateWorkspacePid||(this.updateWorkspacePid=setTimeout(()=>{this.updateWorkspacePid=null,this.recomposeSourceBlock()},0))}}static isIgnorableMutatorEvent(t){return t.isUiEvent||t.type===n.CREATE$$module$build$src$core$events$utils||t.type===n.CHANGE$$module$build$src$core$events$utils&&t.element==="disabled"}recomposeSourceBlock(){if(this.rootBlock){if(!this.sourceBlock.compose)throw Error("Blocks with mutator icons must include a compose method");var t=n.getGroup$$module$build$src$core$events$utils();t||n.setGroup$$module$build$src$core$events$utils(!0);var o=hf.getExtraBlockState_(this.sourceBlock);this.sourceBlock.compose(this.rootBlock);var c=hf.getExtraBlockState_(this.sourceBlock);o!==c&&b(new(k(n.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock,"mutation",null,o,c)),n.setGroup$$module$build$src$core$events$utils(t)}}getWorkspace(){let t;return(t=this.miniWorkspaceBubble)==null?void 0:t.getWorkspace()}},n.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE=wr.MUTATOR,n.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT=1,n.MutatorIcon$$module$build$src$core$icons$mutator_icon;var bm=Object.create(null),mG={allExtensions:bm};n.register$$module$build$src$core$extensions("parent_tooltip_when_inline",N_);var _l={TEST_ONLY:mG};_l.apply=Gc,_l.buildTooltipForDropdown=n.buildTooltipForDropdown$$module$build$src$core$extensions,_l.buildTooltipWithFieldText=n.buildTooltipWithFieldText$$module$build$src$core$extensions,_l.isRegistered=qu,_l.register=n.register$$module$build$src$core$extensions,_l.registerMixin=n.registerMixin$$module$build$src$core$extensions,_l.registerMutator=n.registerMutator$$module$build$src$core$extensions,_l.runAfterPageLoad=O_,_l.unregister=Zu;var o1=new Set,a1={};a1.warn=il;var In;(function(t){t[t.WIN_KEY_FF_LINUX=0]="WIN_KEY_FF_LINUX",t[t.MAC_ENTER=3]="MAC_ENTER",t[t.BACKSPACE=8]="BACKSPACE",t[t.TAB=9]="TAB",t[t.NUM_CENTER=12]="NUM_CENTER",t[t.ENTER=13]="ENTER",t[t.SHIFT=16]="SHIFT",t[t.CTRL=17]="CTRL",t[t.ALT=18]="ALT",t[t.PAUSE=19]="PAUSE",t[t.CAPS_LOCK=20]="CAPS_LOCK",t[t.ESC=27]="ESC",t[t.SPACE=32]="SPACE",t[t.PAGE_UP=33]="PAGE_UP",t[t.PAGE_DOWN=34]="PAGE_DOWN",t[t.END=35]="END",t[t.HOME=36]="HOME",t[t.LEFT=37]="LEFT",t[t.UP=38]="UP",t[t.RIGHT=39]="RIGHT",t[t.DOWN=40]="DOWN",t[t.PLUS_SIGN=43]="PLUS_SIGN",t[t.PRINT_SCREEN=44]="PRINT_SCREEN",t[t.INSERT=45]="INSERT",t[t.DELETE=46]="DELETE",t[t.ZERO=48]="ZERO",t[t.ONE=49]="ONE",t[t.TWO=50]="TWO",t[t.THREE=51]="THREE",t[t.FOUR=52]="FOUR",t[t.FIVE=53]="FIVE",t[t.SIX=54]="SIX",t[t.SEVEN=55]="SEVEN",t[t.EIGHT=56]="EIGHT",t[t.NINE=57]="NINE",t[t.FF_SEMICOLON=59]="FF_SEMICOLON",t[t.FF_EQUALS=61]="FF_EQUALS",t[t.FF_DASH=173]="FF_DASH",t[t.FF_HASH=163]="FF_HASH",t[t.QUESTION_MARK=63]="QUESTION_MARK",t[t.AT_SIGN=64]="AT_SIGN",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.META=91]="META",t[t.WIN_KEY_RIGHT=92]="WIN_KEY_RIGHT",t[t.CONTEXT_MENU=93]="CONTEXT_MENU",t[t.NUM_ZERO=96]="NUM_ZERO",t[t.NUM_ONE=97]="NUM_ONE",t[t.NUM_TWO=98]="NUM_TWO",t[t.NUM_THREE=99]="NUM_THREE",t[t.NUM_FOUR=100]="NUM_FOUR",t[t.NUM_FIVE=101]="NUM_FIVE",t[t.NUM_SIX=102]="NUM_SIX",t[t.NUM_SEVEN=103]="NUM_SEVEN",t[t.NUM_EIGHT=104]="NUM_EIGHT",t[t.NUM_NINE=105]="NUM_NINE",t[t.NUM_MULTIPLY=106]="NUM_MULTIPLY",t[t.NUM_PLUS=107]="NUM_PLUS",t[t.NUM_MINUS=109]="NUM_MINUS",t[t.NUM_PERIOD=110]="NUM_PERIOD",t[t.NUM_DIVISION=111]="NUM_DIVISION",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.NUMLOCK=144]="NUMLOCK",t[t.SCROLL_LOCK=145]="SCROLL_LOCK",t[t.FIRST_MEDIA_KEY=166]="FIRST_MEDIA_KEY",t[t.LAST_MEDIA_KEY=183]="LAST_MEDIA_KEY",t[t.SEMICOLON=186]="SEMICOLON",t[t.DASH=189]="DASH",t[t.EQUALS=187]="EQUALS",t[t.COMMA=188]="COMMA",t[t.PERIOD=190]="PERIOD",t[t.SLASH=191]="SLASH",t[t.APOSTROPHE=192]="APOSTROPHE",t[t.TILDE=192]="TILDE",t[t.SINGLE_QUOTE=222]="SINGLE_QUOTE",t[t.OPEN_SQUARE_BRACKET=219]="OPEN_SQUARE_BRACKET",t[t.BACKSLASH=220]="BACKSLASH",t[t.CLOSE_SQUARE_BRACKET=221]="CLOSE_SQUARE_BRACKET",t[t.WIN_KEY=224]="WIN_KEY",t[t.MAC_FF_META=224]="MAC_FF_META",t[t.MAC_WK_CMD_LEFT=91]="MAC_WK_CMD_LEFT",t[t.MAC_WK_CMD_RIGHT=93]="MAC_WK_CMD_RIGHT",t[t.WIN_IME=229]="WIN_IME",t[t.VK_NONAME=252]="VK_NONAME",t[t.PHANTOM=255]="PHANTOM"})(In||(In={}));var ru={};ru.arc=Di,ru.curve=fs,ru.line=rl,ru.lineOnAxis=Nt,ru.lineTo=Xo,ru.moveBy=Si,ru.moveTo=Zi,ru.point=zt;var Xi={};Xi.Coordinate=At,Xi.KeyCodes=In,Xi.Rect=$i,Xi.Size=Kn,Xi.Svg=Ve,Xi.aria=rv,Xi.array=EI,Xi.browserEvents=qc,Xi.colour=wa,Xi.deprecation=a1,Xi.dom=ns,Xi.extensions=_l,Xi.idGenerator=J_,Xi.math=QE,Xi.object=n1,Xi.parsing=hv,Xi.string=vm,Xi.style=Eh,Xi.svgMath=of,Xi.svgPaths=ru,Xi.toolbox=yh,Xi.userAgent=tG,Xi.xml=um;var Db={};Db.register=kd,Db.unregister=k_;var Bb=class extends di{constructor(t,o,c,g){super(o,c,g),this.text=t,this.workspace=o,this.anchor=c,this.ownerRect=g,this.paragraph=this.stringToSvg(t,this.contentContainer),this.updateBubbleSize()}getText(){return this.text}setText(t){this.text=t,W(this.paragraph),this.paragraph=this.stringToSvg(t,this.contentContainer),this.updateBubbleSize()}stringToSvg(t,o){return o=this.createParagraph(o),t=this.createSpans(o,t),this.workspace.RTL&&this.rightAlignSpans(o.getBBox().width,t),o}createParagraph(t){return Ce(Ve.TEXT,{class:"blocklyText blocklyBubbleText blocklyNoPointerEvents",y:di.BORDER_WIDTH},t)}createSpans(t,o){return o.split(`
`).map(c=>{const g=Ce(Ve.TSPAN,{dy:"1em",x:di.BORDER_WIDTH},t);return c=document.createTextNode(c),g.appendChild(c),g})}rightAlignSpans(t,o){for(const c of o)c.setAttribute("text-anchor","end"),c.setAttribute("x",`${t+di.BORDER_WIDTH}`)}updateBubbleSize(){const t=this.paragraph.getBBox();this.setSize(new Kn(t.width+2*di.BORDER_WIDTH,t.height+2*di.BORDER_WIDTH),!0)}},l1=class extends di{constructor(t,o,c){super(t,o,c),this.workspace=t,this.anchor=o,this.ownerRect=c,this.resizePointerMoveListener=this.resizePointerUpListener=null,this.textChangeListeners=[],this.sizeChangeListeners=[],this.text="",this.DEFAULT_SIZE=new Kn(160+di.DOUBLE_BORDER,80+di.DOUBLE_BORDER),this.MIN_SIZE=new Kn(45+di.DOUBLE_BORDER,20+di.DOUBLE_BORDER),Me(this.svgRoot,"blocklyTextInputBubble"),{inputRoot:this.inputRoot,textArea:this.textArea}=this.createEditor(this.contentContainer),this.resizeGroup=this.createResizeHandle(this.svgRoot,t),this.setSize(this.DEFAULT_SIZE,!0)}getText(){return this.text}setText(t){this.text=t,this.textArea.value=t,this.onTextChange()}addTextChangeListener(t){this.textChangeListeners.push(t)}addSizeChangeListener(t){this.sizeChangeListeners.push(t)}createEditor(t){t=Ce(Ve.FOREIGNOBJECT,{x:di.BORDER_WIDTH,y:di.BORDER_WIDTH},t);const o=document.createElementNS(cc,"body");o.setAttribute("xmlns",cc),o.className="blocklyMinimalBody";const c=document.createElementNS(cc,"textarea");return c.className="blocklyTextarea blocklyText",c.setAttribute("dir",this.workspace.RTL?"RTL":"LTR"),o.appendChild(c),t.appendChild(o),this.bindTextAreaEvents(c),setTimeout(()=>{c.focus()},0),{inputRoot:t,textArea:c}}bindTextAreaEvents(t){Ue(t,"wheel",this,o=>{o.stopPropagation()}),Ue(t,"focus",this,this.onStartEdit,!0),Ue(t,"change",this,this.onTextChange)}createResizeHandle(t,o){return t=Ce(Ve.IMAGE,{class:"blocklyResizeHandle",href:`${o.options.pathToMedia}resize-handle.svg`},t),Ue(t,"pointerdown",this,this.onResizePointerDown),t}setSize(t,o=!1){t.width=Math.max(t.width,this.MIN_SIZE.width),t.height=Math.max(t.height,this.MIN_SIZE.height);const c=t.width-di.DOUBLE_BORDER,g=t.height-di.DOUBLE_BORDER;this.inputRoot.setAttribute("width",`${c}`),this.inputRoot.setAttribute("height",`${g}`),this.resizeGroup.setAttribute("y",`${g}`),this.workspace.RTL?this.resizeGroup.setAttribute("x",`${-di.DOUBLE_BORDER}`):this.resizeGroup.setAttribute("x",`${c}`),super.setSize(t,o),this.onSizeChange()}getSize(){return super.getSize()}onResizePointerDown(t){this.bringToFront(),Fe(t)||(this.workspace.startDrag(t,new At(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=Ue(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=Ue(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),t.stopPropagation()}onResizePointerUp(t){_e(),this.resizePointerUpListener&&(re(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(re(this.resizePointerMoveListener),this.resizePointerMoveListener=null)}onResizePointerMove(t){t=this.workspace.moveDrag(t),this.setSize(new Kn(this.workspace.RTL?-t.x:t.x,t.y),!1),this.onSizeChange()}onStartEdit(){this.bringToFront()&&this.textArea.focus()}onTextChange(){this.text=this.textArea.value;for(const t of this.textChangeListeners)t()}onSizeChange(){for(const t of this.sizeChangeListeners)t()}};je(`
.blocklyTextInputBubble .blocklyTextarea {
  background-color: var(--commentFillColour);
  border: 0;
  box-sizing: border-box;
  display: block;
  outline: 0;
  padding: 5px;
  resize: none;
  width: 100%;
  height: 100%;
}
`);var Fb=17,c1=160,u1=80,su=class extends uy{constructor(t){super(t),this.sourceBlock=t,this.textBubble=this.textInputBubble=null,this.text="",this.bubbleSize=new Kn(c1,u1),this.bubbleVisiblity=!1}getType(){return su.TYPE}initView(t){this.svgRoot||(super.initView(t),Ce(Ve.CIRCLE,{class:"blocklyIconShape",r:"8",cx:"8",cy:"8"},this.svgRoot),Ce(Ve.PATH,{class:"blocklyIconSymbol",d:"m6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.4050.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25-1.201,0.998 -1.201,1.528 -1.204,2.19z"},this.svgRoot),Ce(Ve.RECT,{class:"blocklyIconSymbol",x:"6.8",y:"10.78",height:"2",width:"2"},this.svgRoot),Me(this.svgRoot,"blockly-icon-comment"))}dispose(){super.dispose();let t;(t=this.textInputBubble)==null||t.dispose();let o;(o=this.textBubble)==null||o.dispose()}getWeight(){return su.WEIGHT}getSize(){return new Kn(Fb,Fb)}applyColour(){super.applyColour();const t=this.sourceBlock.style.colourPrimary;let o;(o=this.textInputBubble)==null||o.setColour(t);let c;(c=this.textBubble)==null||c.setColour(t)}updateEditable(){const t=this,o=()=>super.updateEditable;return vt.asyncExecutePromiseGeneratorFunction(function*(){o().call(t),t.bubbleIsVisible()&&(yield t.setBubbleVisible(!1),yield t.setBubbleVisible(!0))})}onLocationChange(t){super.onLocationChange(t),t=this.getAnchorLocation();let o;(o=this.textInputBubble)==null||o.setAnchorLocation(t);let c;(c=this.textBubble)==null||c.setAnchorLocation(t)}setText(t){const o=this.text;b(new(k(n.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock,"comment",null,o,t)),this.text=t;let c;(c=this.textInputBubble)==null||c.setText(this.text);let g;(g=this.textBubble)==null||g.setText(this.text)}getText(){return this.text}setBubbleSize(t){this.bubbleSize=t;let o;(o=this.textInputBubble)==null||o.setSize(this.bubbleSize,!0)}getBubbleSize(){return this.bubbleSize}saveState(){return this.text?{text:this.text,pinned:this.bubbleIsVisible(),height:this.bubbleSize.height,width:this.bubbleSize.width}:null}loadState(t){let o;this.text=(o=t.text)!=null?o:"";let c,g;this.bubbleSize=new Kn((c=t.width)!=null?c:c1,(g=t.height)!=null?g:u1);let $;this.bubbleVisiblity=($=t.pinned)!=null?$:!1,this.setBubbleVisible(this.bubbleVisiblity)}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}onTextChange(){if(this.textInputBubble){var t=this.textInputBubble.getText();this.text!==t&&(b(new(k(n.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock,"comment",null,this.text,t)),this.text=t)}}onSizeChange(){this.textInputBubble&&(this.bubbleSize=this.textInputBubble.getSize())}bubbleIsVisible(){return this.bubbleVisiblity}setBubbleVisible(t){const o=this;return vt.asyncExecutePromiseGeneratorFunction(function*(){o.bubbleVisiblity!==t&&(o.bubbleVisiblity=t,yield Kt(),!o.sourceBlock.rendered||o.sourceBlock.isInFlyout||o.sourceBlock.isInsertionMarker()||(t?(o.sourceBlock.isEditable()?o.showEditableBubble():o.showNonEditableBubble(),o.applyColour()):o.hideBubble(),b(new(k(Aa))(o.sourceBlock,t,"comment"))))})}showEditableBubble(){this.textInputBubble=new l1(this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect()),this.textInputBubble.setText(this.getText()),this.textInputBubble.setSize(this.bubbleSize,!0),this.textInputBubble.addTextChangeListener(()=>this.onTextChange()),this.textInputBubble.addSizeChangeListener(()=>this.onSizeChange())}showNonEditableBubble(){this.textBubble=new Bb(this.getText(),this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect())}hideBubble(){let t;(t=this.textInputBubble)==null||t.dispose(),this.textInputBubble=null;let o;(o=this.textBubble)==null||o.dispose(),this.textBubble=null}getAnchorLocation(){const t=Fb/2;return At.sum(this.workspaceLocation,new At(t,t))}getBubbleOwnerRect(){const t=this.sourceBlock.getSvgRoot().getBBox();return new $i(t.y,t.y+t.height,t.x,t.x+t.width)}};su.TYPE=wr.COMMENT,su.WEIGHT=3,kd(su.TYPE,su);var Ub=17,ou=class extends uy{constructor(t){super(t),this.sourceBlock=t,this.textMap=new Map,this.textBubble=null}getType(){return ou.TYPE}initView(t){this.svgRoot||(super.initView(t),Ce(Ve.PATH,{class:"blocklyIconShape",d:"M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z"},this.svgRoot),Ce(Ve.PATH,{class:"blocklyIconSymbol",d:"m7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z"},this.svgRoot),Ce(Ve.RECT,{class:"blocklyIconSymbol",x:"7",y:"11",height:"2",width:"2"},this.svgRoot),Me(this.svgRoot,"blockly-icon-warning"))}dispose(){super.dispose();let t;(t=this.textBubble)==null||t.dispose()}getWeight(){return ou.WEIGHT}getSize(){return new Kn(Ub,Ub)}applyColour(){super.applyColour();let t;(t=this.textBubble)==null||t.setColour(this.sourceBlock.style.colourPrimary)}updateCollapsed(){}isShownWhenCollapsed(){return!0}onLocationChange(t){super.onLocationChange(t);let o;(o=this.textBubble)==null||o.setAnchorLocation(this.getAnchorLocation())}addMessage(t,o){if(this.textMap.get(o)===t)return this;t?this.textMap.set(o,t):this.textMap.delete(o);let c;return(c=this.textBubble)==null||c.setText(this.getText()),this}getText(){return[...this.textMap.values()].join(`
`)}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.textBubble}setBubbleVisible(t){const o=this;return vt.asyncExecutePromiseGeneratorFunction(function*(){if(o.bubbleIsVisible()!==t){if(yield Kt(),t)o.textBubble=new Bb(o.getText(),o.sourceBlock.workspace,o.getAnchorLocation(),o.getBubbleOwnerRect()),o.applyColour();else{let c;(c=o.textBubble)==null||c.dispose(),o.textBubble=null}b(new(k(Aa))(o.sourceBlock,t,"warning"))}})}getAnchorLocation(){const t=Ub/2;return At.sum(this.workspaceLocation,new At(t,t))}getBubbleOwnerRect(){const t=this.sourceBlock.getSvgRoot().getBBox();return new $i(t.y,t.y+t.height,t.x,t.x+t.width)}};ou.TYPE=wr.WARNING,ou.WEIGHT=2;var h1=class extends Error{constructor(t){super(`Tried to append an icon of type ${t.getType()} when an icon of that type already exists on the block. Use getIcon to access the existing icon.`),this.icon=t}},d1={};d1.DuplicateIconType=h1;var bh={};bh.CommentIcon=su,bh.Icon=uy,bh.IconType=wr,bh.MutatorIcon=n.MutatorIcon$$module$build$src$core$icons$mutator_icon,bh.WarningIcon=ou,bh.exceptions=d1,bh.registry=Db;var py,io;py="PROCEDURE",n.DEFAULT_ARG$$module$build$src$core$procedures="x",io={CATEGORY_NAME:py,DEFAULT_ARG:n.DEFAULT_ARG$$module$build$src$core$procedures},io.ObservableProcedureMap=i1,io.allProcedures=Pd,io.findLegalName=n.findLegalName$$module$build$src$core$procedures,io.flyoutCategory=Bd,io.getCallers=th,io.getDefinition=n.getDefinition$$module$build$src$core$procedures,io.isNameUsed=Dd,io.isProcedureBlock=nl,io.mutateCallers=n.mutateCallers$$module$build$src$core$procedures,io.mutatorOpenListener=D_,io.rename=n.rename$$module$build$src$core$procedures;var gG=class{constructor(){this.NONE=0,this.FIELD=1,this.HAT=2,this.ICON=4,this.SPACER=8,this.BETWEEN_ROW_SPACER=16,this.IN_ROW_SPACER=32,this.EXTERNAL_VALUE_INPUT=64,this.INPUT=128,this.INLINE_INPUT=256,this.STATEMENT_INPUT=512,this.CONNECTION=1024,this.PREVIOUS_CONNECTION=2048,this.NEXT_CONNECTION=4096,this.OUTPUT_CONNECTION=8192,this.CORNER=16384,this.LEFT_SQUARE_CORNER=32768,this.LEFT_ROUND_CORNER=65536,this.RIGHT_SQUARE_CORNER=131072,this.RIGHT_ROUND_CORNER=262144,this.JAGGED_EDGE=524288,this.ROW=1048576,this.TOP_ROW=2097152,this.BOTTOM_ROW=4194304,this.INPUT_ROW=8388608,this.LEFT_CORNER=this.LEFT_SQUARE_CORNER|this.LEFT_ROUND_CORNER,this.RIGHT_CORNER=this.RIGHT_SQUARE_CORNER|this.RIGHT_ROUND_CORNER,this.nextTypeValue_=16777216}getType(t){return Object.prototype.hasOwnProperty.call(this,t)||(this[t]=this.nextTypeValue_,this.nextTypeValue_<<=1),this[t]}isField(t){return t.type&this.FIELD}isHat(t){return t.type&this.HAT}isIcon(t){return t.type&this.ICON}isSpacer(t){return t.type&this.SPACER}isInRowSpacer(t){return t.type&this.IN_ROW_SPACER}isInput(t){return t.type&this.INPUT}isExternalInput(t){return t.type&this.EXTERNAL_VALUE_INPUT}isInlineInput(t){return t.type&this.INLINE_INPUT}isStatementInput(t){return t.type&this.STATEMENT_INPUT}isPreviousConnection(t){return t.type&this.PREVIOUS_CONNECTION}isNextConnection(t){return t.type&this.NEXT_CONNECTION}isPreviousOrNextConnection(t){return t.type&(this.PREVIOUS_CONNECTION|this.NEXT_CONNECTION)}isLeftRoundedCorner(t){return t.type&this.LEFT_ROUND_CORNER}isRightRoundedCorner(t){return t.type&this.RIGHT_ROUND_CORNER}isLeftSquareCorner(t){return t.type&this.LEFT_SQUARE_CORNER}isRightSquareCorner(t){return t.type&this.RIGHT_SQUARE_CORNER}isCorner(t){return t.type&this.CORNER}isJaggedEdge(t){return t.type&this.JAGGED_EDGE}isRow(t){return t.type&this.ROW}isBetweenRowSpacer(t){return t.type&this.BETWEEN_ROW_SPACER}isTopRow(t){return t.type&this.TOP_ROW}isBottomRow(t){return t.type&this.BOTTOM_ROW}isTopOrBottomRow(t){return t.type&(this.TOP_ROW|this.BOTTOM_ROW)}isInputRow(t){return t.type&this.INPUT_ROW}},ke=new gG,hc=class{constructor(t){this.centerline=this.xPos=this.height=this.width=0,this.constants_=t,this.type=ke.NONE,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}},pv=class{constructor(t){this.elements=[],this.xPos=this.yPos=this.widthWithConnectedBlocks=this.minWidth=this.minHeight=this.width=this.height=0,this.hasStatement=this.hasExternalInput=!1,this.statementEdge=0,this.hasJaggedEdge=this.hasDummyInput=this.hasInlineInput=!1,this.align=null,this.constants_=t,this.type=ke.ROW,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}getLastInput(){for(let t=this.elements.length-1;0<=t;t--){const o=this.elements[t];if(ke.isInput(o))return o}return null}measure(){throw Error("Unexpected attempt to measure a base Row.")}startsWithElemSpacer(){return!0}endsWithElemSpacer(){return!0}getFirstSpacer(){for(let t=0;t<this.elements.length;t++){const o=this.elements[t];if(ke.isSpacer(o))return o}return null}getLastSpacer(){for(let t=this.elements.length-1;0<=t;t--){const o=this.elements[t];if(ke.isSpacer(o))return o}return null}},Gb=class extends pv{constructor(t){super(t),this.hasNextConnection=!1,this.connection=null,this.baseline=this.descenderHeight=0,this.type|=ke.BOTTOM_ROW}hasLeftSquareCorner(t){return!!t.outputConnection||!!t.getNextBlock()}hasRightSquareCorner(t){return!0}measure(){let t=0,o=0,c=0;for(let g=0;g<this.elements.length;g++){const $=this.elements[g];o+=$.width,ke.isSpacer($)||(ke.isNextConnection($)?c=Math.max(c,$.height):t=Math.max(t,$.height))}this.width=Math.max(this.minWidth,o),this.height=Math.max(this.minHeight,t)+c,this.descenderHeight=c,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},au=class extends hc{constructor(t,o){super(t),this.connectionModel=o,this.type|=ke.CONNECTION,this.shape=this.constants_.shapeFor(o),this.isDynamicShape="isDynamic"in this.shape&&this.shape.isDynamic,this.highlighted=o.isHighlighted()}},Ah=class extends au{constructor(t,o){super(t,o.connection),this.input=o,this.connectionOffsetY=this.connectionOffsetX=0,this.type|=ke.INPUT,this.align=o.align,(this.connectedBlock=o.connection&&o.connection.targetBlock()?o.connection.targetBlock():null)?(t=this.connectedBlock.getHeightWidth(),this.connectedBlockWidth=t.width,this.connectedBlockHeight=t.height):this.connectedBlockHeight=this.connectedBlockWidth=0}},my=class extends Ah{constructor(t,o){super(t,o),this.height=0,this.type|=ke.EXTERNAL_VALUE_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight-this.constants_.TAB_OFFSET_FROM_TOP-this.constants_.MEDIUM_PADDING:this.shape.height,this.width=this.shape.width+this.constants_.EXTERNAL_VALUE_INPUT_PADDING,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP,this.connectionHeight=this.shape.height,this.connectionWidth=this.shape.width}},Am=class extends hc{constructor(t,o,c){super(t),this.field=o,this.parentInput=c,this.isEditable=o.EDITABLE,this.flipRtl=o.getFlipRtl(),this.type|=ke.FIELD,t=this.field.getSize(),this.height=t.height,this.width=t.width}},Hb=class extends hc{constructor(t){super(t),this.type|=ke.HAT,this.height=this.constants_.START_HAT.height,this.width=this.constants_.START_HAT.width,this.ascenderHeight=this.height}},f1=class extends hc{constructor(t,o){super(t),this.icon=o,this.flipRtl=!1,this.type|=ke.ICON,t=o.getSize(),this.height=t.height,this.width=t.width}},ea=class extends hc{constructor(t,o){super(t),this.type=this.type|ke.SPACER|ke.IN_ROW_SPACER,this.width=o,this.height=this.constants_.SPACER_DEFAULT_HEIGHT}},Vb=class extends Ah{constructor(t,o){super(t,o),this.type|=ke.INLINE_INPUT,this.connectedBlock?(this.width=this.connectedBlockWidth,this.height=this.connectedBlockHeight):(this.height=this.constants_.EMPTY_INLINE_INPUT_HEIGHT,this.width=this.constants_.EMPTY_INLINE_INPUT_PADDING),this.connectionHeight=this.isDynamicShape?this.shape.height(this.height):this.shape.height,this.connectionWidth=this.isDynamicShape?this.shape.width(this.height):this.shape.width,this.connectedBlock||(this.width+=this.connectionWidth*(this.isDynamicShape?2:1)),this.connectionOffsetY="connectionOffsetY"in this.shape?this.shape.connectionOffsetY(this.connectionHeight):this.constants_.TAB_OFFSET_FROM_TOP,this.connectionOffsetX="connectionOffsetX"in this.shape?this.shape.connectionOffsetX(this.connectionWidth):0}},mv=class extends Ah{constructor(t,o){super(t,o),this.type|=ke.STATEMENT_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight+this.constants_.STATEMENT_BOTTOM_SPACER:this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT,this.width=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.shape.width}},zb=class extends pv{constructor(t){super(t),this.connectedBlockWidths=0,this.type|=ke.INPUT_ROW}measure(){this.width=this.minWidth,this.height=this.minHeight;let t=0;for(let o=0;o<this.elements.length;o++){const c=this.elements[o];this.width+=c.width,ke.isInput(c)&&c instanceof Ah&&(ke.isStatementInput(c)&&c instanceof mv?t+=c.connectedBlockWidth:ke.isExternalInput(c)&&c instanceof my&&c.connectedBlockWidth!==0&&(t+=c.connectedBlockWidth-c.connectionWidth)),ke.isSpacer(c)||(this.height=Math.max(this.height,c.height))}this.connectedBlockWidths=t,this.widthWithConnectedBlocks=this.width+t}endsWithElemSpacer(){return!this.hasExternalInput&&!this.hasStatement}},p1=class extends hc{constructor(t){super(t),this.type|=ke.JAGGED_EDGE,this.height=this.constants_.JAGGED_TEETH.height,this.width=this.constants_.JAGGED_TEETH.width}},m1=class extends au{constructor(t,o){super(t,o),this.type|=ke.NEXT_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},g1=class extends au{constructor(t,o){super(t,o),this.connectionOffsetX=0,this.type|=ke.OUTPUT_CONNECTION,this.height=this.isDynamicShape?0:this.shape.height,this.startX=this.width=this.isDynamicShape?0:this.shape.width,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP}},_1=class extends au{constructor(t,o){super(t,o),this.type|=ke.PREVIOUS_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},gv=class extends hc{constructor(t,o){super(t),this.type=(o&&o!=="left"?ke.RIGHT_ROUND_CORNER:ke.LEFT_ROUND_CORNER)|ke.CORNER,this.width=this.constants_.CORNER_RADIUS,this.height=this.constants_.CORNER_RADIUS/2}},Wb=class extends pv{constructor(t,o,c){super(t),this.height=o,this.width=c,this.precedesStatement=this.followsStatement=!1,this.widthWithConnectedBlocks=0,this.type=this.type|ke.SPACER|ke.BETWEEN_ROW_SPACER,this.elements=[new ea(this.constants_,c)]}measure(){}},_v=class extends hc{constructor(t,o){super(t),this.type=(o&&o!=="left"?ke.RIGHT_SQUARE_CORNER:ke.LEFT_SQUARE_CORNER)|ke.CORNER,this.width=this.height=this.constants_.NO_PADDING}},Xb=class extends pv{constructor(t){super(t),this.ascenderHeight=this.capline=0,this.hasPreviousConnection=!1,this.connection=null,this.type|=ke.TOP_ROW}hasLeftSquareCorner(t){const o=(t.hat?t.hat==="cap":this.constants_.ADD_START_HATS)&&!t.outputConnection&&!t.previousConnection,c=t.getPreviousBlock();return!!t.outputConnection||o||(c?c.getNextBlock()===t:!1)}hasRightSquareCorner(t){return!0}measure(){let t=0,o=0,c=0;for(let g=0;g<this.elements.length;g++){const $=this.elements[g];o+=$.width,ke.isSpacer($)||(ke.isHat($)&&$ instanceof Hb?c=Math.max(c,$.ascenderHeight):t=Math.max(t,$.height))}this.width=Math.max(this.minWidth,o),this.height=Math.max(this.minHeight,t)+c,this.capline=this.ascenderHeight=c,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},gy=class{constructor(){this.NO_PADDING=0,this.SMALL_PADDING=3,this.MEDIUM_PADDING=5,this.MEDIUM_LARGE_PADDING=8,this.LARGE_PADDING=10,this.TAB_HEIGHT=15,this.TAB_OFFSET_FROM_TOP=5,this.TAB_VERTICAL_OVERLAP=2.5,this.TAB_WIDTH=8,this.NOTCH_WIDTH=15,this.NOTCH_HEIGHT=4,this.MIN_BLOCK_WIDTH=12,this.EMPTY_BLOCK_SPACER_HEIGHT=16,this.CORNER_RADIUS=8,this.NOTCH_OFFSET_LEFT=15,this.STATEMENT_BOTTOM_SPACER=0,this.STATEMENT_INPUT_PADDING_LEFT=20,this.BETWEEN_STATEMENT_PADDING_Y=4,this.ADD_START_HATS=!1,this.START_HAT_HEIGHT=15,this.START_HAT_WIDTH=100,this.SPACER_DEFAULT_HEIGHT=15,this.MIN_BLOCK_HEIGHT=24,this.EMPTY_INLINE_INPUT_PADDING=14.5,this.EXTERNAL_VALUE_INPUT_PADDING=2,this.JAGGED_TEETH_HEIGHT=12,this.JAGGED_TEETH_WIDTH=6,this.FIELD_TEXT_FONTSIZE=11,this.FIELD_TEXT_FONTWEIGHT="normal",this.FIELD_TEXT_FONTFAMILY="sans-serif",this.FIELD_TEXT_BASELINE=this.FIELD_TEXT_HEIGHT=-1,this.FIELD_BORDER_RECT_RADIUS=4,this.FIELD_BORDER_RECT_HEIGHT=16,this.FIELD_BORDER_RECT_X_PADDING=5,this.FIELD_BORDER_RECT_Y_PADDING=3,this.FIELD_BORDER_RECT_COLOUR="#fff",this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!1,this.FIELD_DROPDOWN_SVG_ARROW_SIZE=12,this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=!1,this.FIELD_COLOUR_DEFAULT_WIDTH=26,this.defs=null,this.embossFilterId="",this.embossFilter=null,this.disabledPatternId="",this.disabledPattern=null,this.debugFilterId="",this.cssNode=this.debugFilter=null,this.CURSOR_COLOUR="#cc0a0a",this.MARKER_COLOUR="#4286f4",this.CURSOR_WS_WIDTH=100,this.WS_CURSOR_HEIGHT=5,this.CURSOR_STACK_PADDING=10,this.CURSOR_BLOCK_PADDING=2,this.CURSOR_STROKE_WIDTH=4,this.FULL_BLOCK_FIELDS=!1,this.INSERTION_MARKER_COLOUR="#000000",this.INSERTION_MARKER_OPACITY=.2,this.SHAPES={PUZZLE:1,NOTCH:2},this.TALL_INPUT_FIELD_OFFSET_Y=this.MEDIUM_PADDING,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=this.DUMMY_INPUT_MIN_HEIGHT=this.TAB_HEIGHT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT,this.TOP_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.EMPTY_INLINE_INPUT_HEIGHT=this.TAB_HEIGHT+11,this.EMPTY_STATEMENT_INPUT_HEIGHT=this.MIN_BLOCK_HEIGHT,this.START_POINT=Si(0,0),this.FIELD_TEXT_BASELINE_CENTER=!0,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_DROPDOWN_SVG_ARROW_DATAURI="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=",this.FIELD_COLOUR_DEFAULT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_CHECKBOX_X_OFFSET=this.FIELD_BORDER_RECT_X_PADDING-3,this.randomIdentifier=String(Math.random()).substring(2)}init(){this.JAGGED_TEETH=this.makeJaggedTeeth(),this.NOTCH=this.makeNotch(),this.START_HAT=this.makeStartHat(),this.PUZZLE_TAB=this.makePuzzleTab(),this.INSIDE_CORNERS=this.makeInsideCorners(),this.OUTSIDE_CORNERS=this.makeOutsideCorners()}setTheme(t){this.blockStyles=Object.create(null);const o=t.blockStyles;for(const c in o)this.blockStyles[c]=this.validatedBlockStyle_(o[c]);this.setDynamicProperties_(t)}setDynamicProperties_(t){this.setFontConstants_(t),this.setComponentConstants_(t),this.ADD_START_HATS=t.startHats!==void 0?t.startHats:this.ADD_START_HATS}setFontConstants_(t){t.fontStyle&&t.fontStyle.family&&(this.FIELD_TEXT_FONTFAMILY=t.fontStyle.family),t.fontStyle&&t.fontStyle.weight&&(this.FIELD_TEXT_FONTWEIGHT=t.fontStyle.weight),t.fontStyle&&t.fontStyle.size&&(this.FIELD_TEXT_FONTSIZE=t.fontStyle.size),t=L("Hg",this.FIELD_TEXT_FONTSIZE+"pt",this.FIELD_TEXT_FONTWEIGHT,this.FIELD_TEXT_FONTFAMILY),this.FIELD_TEXT_HEIGHT=t.height,this.FIELD_TEXT_BASELINE=t.baseline}setComponentConstants_(t){this.CURSOR_COLOUR=t.getComponentStyle("cursorColour")||this.CURSOR_COLOUR,this.MARKER_COLOUR=t.getComponentStyle("markerColour")||this.MARKER_COLOUR,this.INSERTION_MARKER_COLOUR=t.getComponentStyle("insertionMarkerColour")||this.INSERTION_MARKER_COLOUR,this.INSERTION_MARKER_OPACITY=Number(t.getComponentStyle("insertionMarkerOpacity"))||this.INSERTION_MARKER_OPACITY}getBlockStyleForColour(t){const o="auto_"+t;return this.blockStyles[o]||(this.blockStyles[o]=this.createBlockStyle_(t)),{style:this.blockStyles[o],name:o}}getBlockStyle(t){return this.blockStyles[t||""]||(t&&t.startsWith("auto_")?this.getBlockStyleForColour(t.substring(5)).style:this.createBlockStyle_("#000000"))}createBlockStyle_(t){return this.validatedBlockStyle_({colourPrimary:t})}validatedBlockStyle_(t){const o={};return t&&Object.assign(o,t),t=Jl(o.colourPrimary||"#000"),o.colourPrimary=t.hex,o.colourSecondary=o.colourSecondary?Jl(o.colourSecondary).hex:this.generateSecondaryColour_(o.colourPrimary),o.colourTertiary=o.colourTertiary?Jl(o.colourTertiary).hex:this.generateTertiaryColour_(o.colourPrimary),o.hat=o.hat||"",o}generateSecondaryColour_(t){return Go("#fff",t,.6)||t}generateTertiaryColour_(t){return Go("#fff",t,.3)||t}dispose(){this.embossFilter&&W(this.embossFilter),this.disabledPattern&&W(this.disabledPattern),this.debugFilter&&W(this.debugFilter),this.cssNode=null}makeJaggedTeeth(){const t=this.JAGGED_TEETH_HEIGHT,o=this.JAGGED_TEETH_WIDTH,c=rl([zt(o,t/4),zt(2*-o,t/2),zt(o,t/4)]);return{height:t,width:o,path:c}}makeStartHat(){const t=this.START_HAT_HEIGHT,o=this.START_HAT_WIDTH,c=fs("c",[zt(30,-t),zt(70,-t),zt(o,0)]);return{height:t,width:o,path:c}}makePuzzleTab(){function t(M){M=M?-1:1;const Q=-M;var be=c/2;const nt=be+2.5,Dt=be+.5,Ni=zt(-o,M*be);return be=zt(o,M*be),fs("c",[zt(0,M*nt),zt(-o,Q*Dt),Ni])+fs("s",[zt(o,2.5*Q),be])}const o=this.TAB_WIDTH,c=this.TAB_HEIGHT,g=t(!0),$=t(!1);return{type:this.SHAPES.PUZZLE,width:o,height:c,pathDown:$,pathUp:g}}makeNotch(){function t(Q){return rl([zt(Q*g,c),zt(3*Q,0),zt(Q*g,-c)])}const o=this.NOTCH_WIDTH,c=this.NOTCH_HEIGHT,g=(o-3)/2,$=t(1),M=t(-1);return{type:this.SHAPES.NOTCH,width:o,height:c,pathLeft:$,pathRight:M}}makeInsideCorners(){const t=this.CORNER_RADIUS,o=Di("a","0 0,0",t,zt(-t,t)),c=Di("a","0 0,0",t,zt(t,t));return{width:t,height:t,pathTop:o,pathBottom:c}}makeOutsideCorners(){const t=this.CORNER_RADIUS,o=Si(0,t)+Di("a","0 0,1",t,zt(t,-t)),c=Di("a","0 0,1",t,zt(t,t)),g=Di("a","0 0,1",t,zt(-t,-t)),$=Di("a","0 0,1",t,zt(-t,t));return{topLeft:o,topRight:c,bottomRight:$,bottomLeft:g,rightHeight:t}}shapeFor(t){switch(t.type){case Bt.INPUT_VALUE:case Bt.OUTPUT_VALUE:return this.PUZZLE_TAB;case Bt.PREVIOUS_STATEMENT:case Bt.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown connection type")}}createDom(t,o,c){this.injectCSS_(o,c),this.defs=Ce(Ve.DEFS,{},t),t=Ce(Ve.FILTER,{id:"blocklyEmbossFilter"+this.randomIdentifier},this.defs),Ce(Ve.FEGAUSSIANBLUR,{in:"SourceAlpha",stdDeviation:1,result:"blur"},t),o=Ce(Ve.FESPECULARLIGHTING,{in:"blur",surfaceScale:1,specularConstant:.5,specularExponent:10,"lighting-color":"white",result:"specOut"},t),Ce(Ve.FEPOINTLIGHT,{x:-5e3,y:-1e4,z:2e4},o),Ce(Ve.FECOMPOSITE,{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},t),Ce(Ve.FECOMPOSITE,{in:"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},t),this.embossFilterId=t.id,this.embossFilter=t,t=Ce(Ve.PATTERN,{id:"blocklyDisabledPattern"+this.randomIdentifier,patternUnits:"userSpaceOnUse",width:10,height:10},this.defs),Ce(Ve.RECT,{width:10,height:10,fill:"#aaa"},t),Ce(Ve.PATH,{d:"M 0 0 L 10 10 M 10 0 L 0 10",stroke:"#cc0"},t),this.disabledPatternId=t.id,this.disabledPattern=t,this.createDebugFilter()}createDebugFilter(){if(!this.debugFilter){const t=Ce(Ve.FILTER,{id:"blocklyDebugFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},this.defs),o=Ce(Ve.FECOMPONENTTRANSFER,{result:"outBlur"},t);Ce(Ve.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},o),Ce(Ve.FEFLOOD,{"flood-color":"#ff0000","flood-opacity":.5,result:"outColor"},t),Ce(Ve.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},t),this.debugFilterId=t.id,this.debugFilter=t}}injectCSS_(t,o){o=this.getCSS_(o),t="blockly-renderer-style-"+t,this.cssNode=document.getElementById(t);const c=o.join(`
`);this.cssNode?this.cssNode.firstChild.textContent=c:(o=document.createElement("style"),o.id=t,t=document.createTextNode(c),o.appendChild(t),document.head.insertBefore(o,document.head.firstChild),this.cssNode=o)}getCSS_(t){return[`${t} .blocklyText, `,`${t} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${t} .blocklyText {`,"fill: #fff;","}",`${t} .blocklyNonEditableText>rect,`,`${t} .blocklyEditableText>rect {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"fill-opacity: .6;","stroke: none;","}",`${t} .blocklyNonEditableText>text,`,`${t} .blocklyEditableText>text {`,"fill: #000;","}",`${t} .blocklyFlyoutLabelText {`,"fill: #000;","}",`${t} .blocklyText.blocklyBubbleText {`,"fill: #000;","}",`${t} .blocklyEditableText:not(.editing):hover>rect {`,"stroke: #fff;","stroke-width: 2;","}",`${t} .blocklyHtmlInput {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"}",`${t} .blocklySelected>.blocklyPath {`,"stroke: #fc3;","stroke-width: 3px;","}",`${t} .blocklyHighlightedConnectionPath {`,"stroke: #fc3;","}",`${t} .blocklyReplaceable .blocklyPath {`,"fill-opacity: .5;","}",`${t} .blocklyReplaceable .blocklyPathLight,`,`${t} .blocklyReplaceable .blocklyPathDark {`,"display: none;","}",`${t} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"]}},_y=class{constructor(t,o){this.inlinePath_=this.outlinePath_="",this.block_=t,this.info_=o,this.topLeft_=t.getRelativeToSurfaceXY(),this.constants_=o.getRenderer().getConstants()}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),this.block_.pathObject.setPath(this.outlinePath_+`
`+this.inlinePath_),this.info_.RTL&&this.block_.pathObject.flipRTL(),this.recordSizeOnBlock_()}recordSizeOnBlock_(){this.block_.height=this.info_.height,this.block_.width=this.info_.widthWithChildren}drawOutline_(){this.drawTop_();for(let t=1;t<this.info_.rows.length-1;t++){const o=this.info_.rows[t];o.hasJaggedEdge?this.drawJaggedEdge_(o):o.hasStatement?this.drawStatementInput_(o):o.hasExternalInput?this.drawValueInput_(o):this.drawRightSideRow_(o)}this.drawBottom_(),this.drawLeft_()}drawTop_(){const t=this.info_.topRow,o=t.elements;this.positionPreviousConnection_(),this.outlinePath_+=Si(t.xPos,this.info_.startY);for(let c=0,g;g=o[c];c++)ke.isLeftRoundedCorner(g)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topLeft:ke.isRightRoundedCorner(g)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topRight:ke.isPreviousConnection(g)&&g instanceof au?this.outlinePath_+=g.shape.pathLeft:ke.isHat(g)?this.outlinePath_+=this.constants_.START_HAT.path:ke.isSpacer(g)&&(this.outlinePath_+=Nt("h",g.width));this.outlinePath_+=Nt("v",t.height)}drawJaggedEdge_(t){this.outlinePath_+=this.constants_.JAGGED_TEETH.path+Nt("v",t.height-this.constants_.JAGGED_TEETH.height)}drawValueInput_(t){const o=t.getLastInput();this.positionExternalValueConnection_(t);const c=em(o.shape)?o.shape.pathDown(o.height):o.shape.pathDown;this.outlinePath_+=Nt("H",o.xPos+o.width)+c+Nt("v",t.height-o.connectionHeight)}drawStatementInput_(t){var o=t.getLastInput();if(o){var c=o.xPos+o.notchOffset+o.shape.width;o=o.shape.pathRight+Nt("h",-(o.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop;var g=t.height-2*this.constants_.INSIDE_CORNERS.height;this.outlinePath_+=Nt("H",c)+o+Nt("v",g)+this.constants_.INSIDE_CORNERS.pathBottom+Nt("H",t.xPos+t.width),this.positionStatementInputConnection_(t)}}drawRightSideRow_(t){this.outlinePath_+=Nt("V",t.yPos+t.height)}drawBottom_(){const t=this.info_.bottomRow,o=t.elements;this.positionNextConnection_();let c=0,g="";for(let $=o.length-1,M;M=o[$];$--)ke.isNextConnection(M)&&M instanceof au?g+=M.shape.pathRight:ke.isLeftSquareCorner(M)?g+=Nt("H",t.xPos):ke.isLeftRoundedCorner(M)?g+=this.constants_.OUTSIDE_CORNERS.bottomLeft:ke.isRightRoundedCorner(M)?(g+=this.constants_.OUTSIDE_CORNERS.bottomRight,c=this.constants_.OUTSIDE_CORNERS.rightHeight):ke.isSpacer(M)&&(g+=Nt("h",-1*M.width));this.outlinePath_+=Nt("V",t.baseline-c),this.outlinePath_+=g}drawLeft_(){var t=this.info_.outputConnection;if(this.positionOutputConnection_(),t){const o=t.connectionOffsetY+t.height;t=em(t.shape)?t.shape.pathUp(t.height):t.shape.pathUp,this.outlinePath_+=Nt("V",o)+t}this.outlinePath_+="z"}drawInternals_(){for(let t=0,o;o=this.info_.rows[t];t++)for(let c=0,g;g=o.elements[c];c++)ke.isInlineInput(g)?this.drawInlineInput_(g):(ke.isIcon(g)||ke.isField(g))&&this.layoutField_(g)}layoutField_(t){const o=t.centerline-t.height/2;let c=t.xPos;var g="";this.info_.RTL&&(c=-(c+t.width),t.flipRtl&&(c+=t.width,g="scale(-1 1)")),ke.isIcon(t)?(g=t.icon,g.setOffsetInBlock(new At(c,o)),this.info_.isInsertionMarker&&g.hideForInsertionMarker()):(t=t.field.getSvgRoot(),t.setAttribute("transform","translate("+c+","+o+")"+g),this.info_.isInsertionMarker&&t.setAttribute("display","none"))}drawInlineInput_(t){const o=t.width,c=t.height,g=t.connectionOffsetY,$=t.connectionHeight+g;this.inlinePath_+=Zi(t.xPos+t.connectionWidth,t.centerline-c/2)+Nt("v",g)+t.shape.pathDown+Nt("v",c-$)+Nt("h",o-t.connectionWidth)+Nt("v",-c)+"z",this.positionInlineInputConnection_(t)}positionInlineInputConnection_(t){const o=t.centerline-t.height/2;if(t.connectionModel){let c=t.xPos+t.connectionWidth+t.connectionOffsetX;this.info_.RTL&&(c*=-1),t.connectionModel.setOffsetInBlock(c,o+t.connectionOffsetY)}}positionStatementInputConnection_(t){const o=t.getLastInput();if(o!=null&&o.connectionModel){let c=t.xPos+t.statementEdge+o.notchOffset;this.info_.RTL&&(c*=-1),o.connectionModel.setOffsetInBlock(c,t.yPos)}}positionExternalValueConnection_(t){const o=t.getLastInput();if(o&&o.connectionModel){let c=t.xPos+t.width;this.info_.RTL&&(c*=-1),o.connectionModel.setOffsetInBlock(c,t.yPos)}}positionPreviousConnection_(){const t=this.info_.topRow;if(t.connection){const o=t.xPos+t.notchOffset;t.connection.connectionModel.setOffsetInBlock(this.info_.RTL?-o:o,0)}}positionNextConnection_(){const t=this.info_.bottomRow;if(t.connection){const o=t.connection,c=o.xPos;o.connectionModel.setOffsetInBlock(this.info_.RTL?-c:c,t.baseline)}}positionOutputConnection_(){if(this.info_.outputConnection){const t=this.info_.startX+this.info_.outputConnection.connectionOffsetX;this.block_.outputConnection.setOffsetInBlock(this.info_.RTL?-t:t,this.info_.outputConnection.connectionOffsetY)}}updateConnectionHighlights(){for(const t of this.info_.rows)for(const o of t.elements)if(o instanceof au)if(o.highlighted)this.drawConnectionHighlightPath(o);else{let c,g;(g=(c=this.block_.pathObject).removeConnectionHighlight)==null||g.call(c,o.connectionModel)}}drawConnectionHighlightPath(t){const o=t.connectionModel;t=o.type===Bt.INPUT_VALUE||o.type===Bt.OUTPUT_VALUE?this.getExpressionConnectionHighlightPath(t):this.getStatementConnectionHighlightPath(t);const c=o.getSourceBlock();let g,$;($=(g=c.pathObject).addConnectionHighlight)==null||$.call(g,o,t,o.getOffsetInBlock(),c.RTL)}getExpressionConnectionHighlightPath(t){let o="";return em(t.shape)?o=t.shape.pathDown(t.height):kt(t.shape)&&(o=t.shape.pathDown),t=this.constants_.TAB_OFFSET_FROM_TOP,Si(0,-t)+Nt("v",t)+o+Nt("v",t)}getStatementConnectionHighlightPath(t){if(!Fd(t.shape))throw Error("Statement connections should have notch shapes");const o=this.constants_.NOTCH_OFFSET_LEFT-this.constants_.CORNER_RADIUS;return Si(-o,0)+Nt("h",o)+t.shape.pathLeft+Nt("h",o)}};(function(t){t[t.LEFT=-1]="LEFT",t[t.CENTRE=0]="CENTRE",t[t.RIGHT=1]="RIGHT"})(n.Align$$module$build$src$core$inputs$align||(n.Align$$module$build$src$core$inputs$align={})),n.Align$$module$build$src$core$inputs$align;var _f=class extends bi{constructor(t,o,c){super(bi.SKIP_SETUP),this.class=null,this.EDITABLE=!1,this.maxDisplayLength=1/0,t!==bi.SKIP_SETUP&&(c?this.configure_(c):this.class=o||null,this.setValue(t))}configure_(t){super.configure_(t),t.class&&(this.class=t.class)}initView(){this.createTextElement_(),this.class&&Me(this.getTextElement(),this.class)}doClassValidation_(t){return t==null?null:`${t}`}setClass(t){this.textElement_&&(this.class&&oe(this.textElement_,this.class),t&&Me(this.textElement_,t)),this.class=t}static fromJson(t){return new this(yi(t.text),void 0,t)}};zo("field_label",_f),_f.prototype.DEFAULT_VALUE="";var Cm=class{constructor(t,o){this.name=t,this.sourceBlock=o,this.fieldRow=[],this.align=n.Align$$module$build$src$core$inputs$align.LEFT,this.visible=!0,this.type=n.inputTypes$$module$build$src$core$inputs$input_types.CUSTOM,this.connection=null}getSourceBlock(){return this.sourceBlock}appendField(t,o){return this.insertFieldAt(this.fieldRow.length,t,o),this}insertFieldAt(t,o,c){if(0>t||t>this.fieldRow.length)throw Error("index "+t+" out of bounds.");return(o||o===""&&c)&&(typeof o=="string"&&(o=n.fromJson$$module$build$src$core$field_registry({type:"field_label",text:o})),o.setSourceBlock(this.sourceBlock),this.sourceBlock.initialized&&this.initField(o),o.name=c,o.setVisible(this.isVisible()),o.prefixField&&(t=this.insertFieldAt(t,o.prefixField)),this.fieldRow.splice(t,0,o),t++,o.suffixField&&(t=this.insertFieldAt(t,o.suffixField)),this.sourceBlock.rendered&&this.sourceBlock.queueRender()),t}removeField(t,o){for(let c=0,g;g=this.fieldRow[c];c++)if(g.name===t)return g.dispose(),this.fieldRow.splice(c,1),this.sourceBlock.rendered&&this.sourceBlock.queueRender(),!0;if(o)return!1;throw Error('Field "'+t+'" not found.')}isVisible(){return this.visible}setVisible(t){let o=[];if(this.visible===t)return o;this.visible=t;for(let g=0,$;$=this.fieldRow[g];g++)$.setVisible(t);if(this.connection){var c=this.connection;t?o=c.startTrackingAll():c.stopTrackingAll(),(c=c.targetBlock())&&(c.getSvgRoot().style.display=t?"block":"none")}return o}markDirty(){for(let t=0,o;o=this.fieldRow[t];t++)o.markDirty()}setCheck(t){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setCheck(t),this}setAlign(t){return this.align=t,this.sourceBlock.rendered&&this.sourceBlock.queueRender(),this}setShadowDom(t){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setShadowDom(t),this}getShadowDom(){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.getShadowDom()}init(){for(const t of this.fieldRow)t.init()}initModel(){for(const t of this.fieldRow)t.initModel()}initField(t){this.sourceBlock.rendered?t.init():t.initModel()}dispose(){for(let t=0,o;o=this.fieldRow[t];t++)o.dispose();this.connection&&this.connection.dispose()}makeConnection(t){return this.sourceBlock.makeConnection_(t)}},dc=class extends Cm{constructor(t,o){super(t,o),this.name=t,this.type=n.inputTypes$$module$build$src$core$inputs$input_types.DUMMY}},lu=class extends Cm{constructor(t,o){super(t,o),this.name=t,this.type=n.inputTypes$$module$build$src$core$inputs$input_types.END_ROW}},ta=class extends Cm{constructor(t,o){if(!t)throw Error("Statement inputs must have a non-empty name");super(t,o),this.name=t,this.type=n.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT,this.connection=this.makeConnection(Bt.NEXT_STATEMENT)}},v1;n.ValueInput$$module$build$src$core$inputs$value_input=class extends Cm{constructor(t,o){if(!t)throw Error("Value inputs must have a non-empty name");super(t,o),this.name=t,this.type=n.inputTypes$$module$build$src$core$inputs$input_types.VALUE,this.connection=this.makeConnection(Bt.INPUT_VALUE)}},v1={},v1.ValueInput=n.ValueInput$$module$build$src$core$inputs$value_input;var vv=class{constructor(t,o){this.statementEdge=this.width=this.widthWithChildren=this.height=0,this.rows=[],this.inputRows=[],this.startY=this.startX=0,this.renderer_=t,this.block_=o,this.constants_=this.renderer_.getConstants(),this.outputConnection=o.outputConnection?new g1(this.constants_,o.outputConnection):null,this.isInline=o.getInputsInline()&&!o.isCollapsed(),this.isCollapsed=o.isCollapsed(),this.isInsertionMarker=o.isInsertionMarker(),this.RTL=o.RTL,this.topRow=new Xb(this.constants_),this.bottomRow=new Gb(this.constants_)}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}createRows_(){this.populateTopRow_(),this.rows.push(this.topRow);let t=new zb(this.constants_);this.inputRows.push(t);var o=this.block_.getIcons();for(let c=0,g;g=o[c];c++){const $=new f1(this.constants_,g);this.isCollapsed&&!g.isShownWhenCollapsed()||t.elements.push($)}o=void 0;for(let c=0,g;g=this.block_.inputList[c];c++)if(g.isVisible()){this.shouldStartNewRow_(g,o)&&(this.rows.push(t),t=new zb(this.constants_),this.inputRows.push(t));for(let $=0,M;M=g.fieldRow[$];$++)t.elements.push(new Am(this.constants_,M,g));this.addInput_(g,t),o=g}this.isCollapsed&&(t.hasJaggedEdge=!0,t.elements.push(new p1(this.constants_))),(t.elements.length||t.hasDummyInput)&&this.rows.push(t),this.populateBottomRow_(),this.rows.push(this.bottomRow)}populateTopRow_(){var t=!!this.block_.previousConnection;const o=(this.block_.hat?this.block_.hat==="cap":this.constants_.ADD_START_HATS)&&!this.outputConnection&&!t;let c=this.topRow.hasLeftSquareCorner(this.block_)?_v:gv;this.topRow.elements.push(new c(this.constants_)),o?(t=new Hb(this.constants_),this.topRow.elements.push(t),this.topRow.capline=t.ascenderHeight):t&&(this.topRow.hasPreviousConnection=!0,this.topRow.connection=new _1(this.constants_,this.block_.previousConnection),this.topRow.elements.push(this.topRow.connection)),this.block_.inputList.length&&this.block_.inputList[0]instanceof ta&&!this.block_.isCollapsed()?this.topRow.minHeight=this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT:this.topRow.minHeight=this.constants_.TOP_ROW_MIN_HEIGHT,c=this.topRow.hasRightSquareCorner(this.block_)?_v:gv,this.topRow.elements.push(new c(this.constants_,"right"))}populateBottomRow_(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection,this.bottomRow.minHeight=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof ta?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:this.constants_.BOTTOM_ROW_MIN_HEIGHT,this.bottomRow.hasLeftSquareCorner(this.block_)?this.bottomRow.elements.push(new _v(this.constants_)):this.bottomRow.elements.push(new gv(this.constants_)),this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new m1(this.constants_,this.block_.nextConnection),this.bottomRow.elements.push(this.bottomRow.connection)),this.bottomRow.hasRightSquareCorner(this.block_)?this.bottomRow.elements.push(new _v(this.constants_,"right")):this.bottomRow.elements.push(new gv(this.constants_,"right"))}addInput_(t,o){this.isInline&&t instanceof n.ValueInput$$module$build$src$core$inputs$value_input?(o.elements.push(new Vb(this.constants_,t)),o.hasInlineInput=!0):t instanceof ta?(o.elements.push(new mv(this.constants_,t)),o.hasStatement=!0):t instanceof n.ValueInput$$module$build$src$core$inputs$value_input?(o.elements.push(new my(this.constants_,t)),o.hasExternalInput=!0):(t instanceof dc||t instanceof lu)&&(o.minHeight=Math.max(o.minHeight,t.getSourceBlock()&&t.getSourceBlock().isShadow()?this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT:this.constants_.DUMMY_INPUT_MIN_HEIGHT),o.hasDummyInput=!0),o.align===null&&(o.align=t.align)}shouldStartNewRow_(t,o){return o?o instanceof lu||t instanceof ta||o instanceof ta?!0:t instanceof n.ValueInput$$module$build$src$core$inputs$value_input||t instanceof dc||o instanceof n.ValueInput$$module$build$src$core$inputs$value_input?!this.isInline:!1:!1}addElemSpacing_(){for(let t=0,o;o=this.rows[t];t++){const c=o.elements;if(o.elements=[],o.startsWithElemSpacer()&&o.elements.push(new ea(this.constants_,this.getInRowSpacing_(null,c[0]))),c.length){for(let g=0;g<c.length-1;g++){o.elements.push(c[g]);const $=this.getInRowSpacing_(c[g],c[g+1]);o.elements.push(new ea(this.constants_,$))}o.elements.push(c[c.length-1]),o.endsWithElemSpacer()&&o.elements.push(new ea(this.constants_,this.getInRowSpacing_(c[c.length-1],null)))}}}getInRowSpacing_(t,o){if(!t&&o&&ke.isStatementInput(o))return this.constants_.STATEMENT_INPUT_PADDING_LEFT;if(t&&ke.isInput(t)&&!o){if(ke.isExternalInput(t))return this.constants_.NO_PADDING;if(ke.isInlineInput(t))return this.constants_.LARGE_PADDING;if(ke.isStatementInput(t))return this.constants_.NO_PADDING}return t&&ke.isLeftSquareCorner(t)&&o&&(ke.isPreviousConnection(o)||ke.isNextConnection(o))?o.notchOffset:t&&ke.isLeftRoundedCorner(t)&&o&&(ke.isPreviousConnection(o)||ke.isNextConnection(o))?o.notchOffset-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING}computeBounds_(){let t=0,o=0,c=0;for(let $=0,M;M=this.rows[$];$++){if(M.measure(),o=Math.max(o,M.width),M.hasStatement){var g=M.getLastInput();let Q,be;g=M.width-((be=(Q=g)==null?void 0:Q.width)!=null?be:0),t=Math.max(t,g)}c=Math.max(c,M.widthWithConnectedBlocks)}this.statementEdge=t,this.width=o;for(let $=0,M;M=this.rows[$];$++)M.hasStatement&&(M.statementEdge=this.statementEdge);this.widthWithChildren=Math.max(o,c),this.outputConnection&&(this.startX=this.outputConnection.width,this.width+=this.outputConnection.width,this.widthWithChildren+=this.outputConnection.width)}alignRowElements_(){for(let o=0,c;c=this.rows[o];o++)if(c.hasStatement)this.alignStatementRow_(c);else{var t=c.width;t=this.getDesiredRowWidth_(c)-t,0<t&&this.addAlignmentPadding_(c,t),ke.isTopOrBottomRow(c)&&(c.widthWithConnectedBlocks=c.width)}}getDesiredRowWidth_(t){return this.width-this.startX}addAlignmentPadding_(t,o){const c=t.getFirstSpacer(),g=t.getLastSpacer();if((t.hasExternalInput||t.hasStatement)&&(t.widthWithConnectedBlocks+=o),t.align===n.Align$$module$build$src$core$inputs$align.LEFT&&g)g.width+=o;else if(t.align===n.Align$$module$build$src$core$inputs$align.CENTRE&&c&&g)c.width+=o/2,g.width+=o/2;else if(t.align===n.Align$$module$build$src$core$inputs$align.RIGHT&&c)c.width+=o;else if(g)g.width+=o;else return;t.width+=o}alignStatementRow_(t){const o=t.getLastInput();if(o){var c=t.width-o.width,g=this.statementEdge;c=g-c,0<c&&this.addAlignmentPadding_(t,c),c=t.width,g=this.getDesiredRowWidth_(t),o.width+=g-c,o.height=Math.max(o.height,t.height),t.width+=g-c,t.widthWithConnectedBlocks=Math.max(t.width,this.statementEdge+t.connectedBlockWidths)}}addRowSpacing_(){const t=this.rows;this.rows=[];for(let o=0;o<t.length;o++)this.rows.push(t[o]),o!==t.length-1&&this.rows.push(this.makeSpacerRow_(t[o],t[o+1]))}makeSpacerRow_(t,o){var c=this.getSpacerRowHeight_(t,o);const g=this.getSpacerRowWidth_(t,o);return c=new Wb(this.constants_,c,g),t.hasStatement&&(c.followsStatement=!0),o.hasStatement&&(c.precedesStatement=!0),c}getSpacerRowWidth_(t,o){return this.width-this.startX}getSpacerRowHeight_(t,o){return this.constants_.MEDIUM_PADDING}getElemCenterline_(t,o){return ke.isSpacer(o)?t.yPos+o.height/2:ke.isBottomRow(t)?(t=t.yPos+t.height-t.descenderHeight,ke.isNextConnection(o)?t+o.height/2:t-o.height/2):ke.isTopRow(t)?ke.isHat(o)?t.capline-o.height/2:t.capline+o.height/2:t.yPos+t.height/2}recordElemPositions_(t){let o=t.xPos;for(let c=0,g;g=t.elements[c];c++)ke.isSpacer(g)&&(g.height=t.height),g.xPos=o,g.centerline=this.getElemCenterline_(t,g),o+=g.width}finalize_(){let t=0,o=0;for(let c=0,g;g=this.rows[c];c++)g.yPos=o,g.xPos=this.startX,o+=g.height,t=Math.max(t,g.widthWithConnectedBlocks),this.recordElemPositions_(g);if(this.outputConnection&&this.block_.nextConnection){const c=this.block_.nextConnection.targetBlock();c&&(t=Math.max(t,c.getHeightWidth().width))}this.widthWithChildren=t+this.startX,this.height=o,this.startY=this.topRow.capline,this.bottomRow.baseline=o-this.bottomRow.descenderHeight}getMeasureableForConnection(t){let o;if(((o=this.outputConnection)==null?void 0:o.connectionModel)===t)return this.outputConnection;for(const c of this.rows)for(const g of c.elements)if(g instanceof au&&g.connectionModel===t)return g;return null}},jb=class extends uf{constructor(t){if(super(t),this.type=n.DELETE$$module$build$src$core$events$utils,t){if(t.getParent())throw Error("Connected blocks cannot be deleted.");t.isShadow()&&(this.recordUndo=!1),this.oldXml=Yu(t),this.ids=O(t),this.wasShadow=t.isShadow(),this.oldJson=Vi(t,{addCoordinates:!0})}}toJson(){const t=super.toJson();if(!this.oldXml)throw Error("The old block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(this.wasShadow===void 0)throw Error("Whether the block was a shadow is undefined. Either pass a block to the constructor, or call fromJson");if(!this.oldJson)throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson");return t.oldXml=Vo(this.oldXml),t.ids=this.ids,t.wasShadow=this.wasShadow,t.oldJson=this.oldJson,this.recordUndo||(t.recordUndo=this.recordUndo),t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new jb),o.oldXml=n.textToDom$$module$build$src$core$utils$xml(t.oldXml),o.ids=t.ids,o.wasShadow=t.wasShadow||o.oldXml.tagName.toLowerCase()==="shadow",o.oldJson=t.oldJson,t.recordUndo!==void 0&&(o.recordUndo=t.recordUndo),o}run(t){const o=this.getEventWorkspace_();if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!this.oldJson)throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(t)for(t=0;t<this.ids.length;t++){const c=this.ids[t],g=o.getBlockById(c);g?g.dispose(!1):c===this.blockId&&console.warn("Can't delete non-existent block: "+c)}else Ii(this.oldJson,o)}};r(yt.EVENT,n.DELETE$$module$build$src$core$events$utils,jb);var Jn=class{constructor(t,o){this.type=o,this.targetConnection=null,this.disposed=!1,this.shadowDom=this.check=null,this.y=this.x=0,this.shadowState=null,this.sourceBlock_=t}connect_(t){const o=Bt.INPUT_VALUE,c=this.getSourceBlock();var g=t.getSourceBlock();t.isConnected()&&t.disconnectInternal(!1);let $;if(this.isConnected()){const Q=this.stashShadowState(),be=this.targetBlock();be.isShadow()?be.dispose(!1):(this.disconnectInternal(),$=be),this.applyShadowState(Q)}let M;R()&&(M=new(k(n.MOVE$$module$build$src$core$events$utils))(g),M.setReason(["connect"])),tm(this,t),g.setParent(c),M&&(M.recordNew(),b(M)),$&&(t=this.type===o?$.outputConnection:$.previousConnection)&&((g=Jn.getConnectionForOrphanedConnection(g,t))?t.connect(g):t.onFailedConnect(this))}dispose(){if(this.isConnected()){this.isSuperior()&&this.setShadowStateInternal();const t=this.targetBlock();t&&!t.isDeadOrDying()&&t.unplug()}this.disposed=!0}getSourceBlock(){return this.sourceBlock_}isSuperior(){return this.type===Bt.INPUT_VALUE||this.type===Bt.NEXT_STATEMENT}isConnected(){return!!this.targetConnection}getConnectionChecker(){return this.sourceBlock_.workspace.connectionChecker}onFailedConnect(t){}connect(t){if(this.targetConnection===t)return!0;if(this.getConnectionChecker().canConnect(this,t,!1)){const o=n.getGroup$$module$build$src$core$events$utils();o||n.setGroup$$module$build$src$core$events$utils(!0),this.isSuperior()?this.connect_(t):t.connect_(this),n.setGroup$$module$build$src$core$events$utils(o)}return this.isConnected()}disconnect(){this.disconnectInternal()}disconnectInternal(t=!0){const{parentConnection:o,childConnection:c}=this.getParentAndChildConnections();if(!o||!c)throw Error("Source connection not connected.");const g=n.getGroup$$module$build$src$core$events$utils();g||n.setGroup$$module$build$src$core$events$utils(!0);let $;R()&&($=new(k(n.MOVE$$module$build$src$core$events$utils))(c.getSourceBlock()),$.setReason(["disconnect"]));const M=this.targetConnection;M&&(M.targetConnection=null),this.targetConnection=null,t&&c.getSourceBlock().setParent(null),$&&($.recordNew(),b($)),c.getSourceBlock().isShadow()||o.respawnShadow_(),n.setGroup$$module$build$src$core$events$utils(g)}getParentAndChildConnections(){return this.targetConnection?this.isSuperior()?{parentConnection:this,childConnection:this.targetConnection}:{parentConnection:this.targetConnection,childConnection:this}:{}}respawnShadow_(){this.createShadowBlock(!0)}reconnect(t,o){if(this.getSourceBlock().isDeadOrDying())return!1;var c;return o=(c=t.getInput(o))==null?void 0:c.connection,c=this.targetBlock(),c&&c!==t||!o||o.targetConnection===this?!1:(o.isConnected()&&o.disconnect(),o.connect(this),!0)}targetBlock(){if(this.isConnected()){let t,o;return(o=(t=this.targetConnection)==null?void 0:t.getSourceBlock())!=null?o:null}return null}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()}setCheck(t){return t?(Array.isArray(t)||(t=[t]),this.check=t,this.onCheckChanged_()):this.check=null,this}getCheck(){return this.check}setShadowDom(t){this.setShadowStateInternal({shadowDom:t})}getShadowDom(t){return t&&this.targetBlock().isShadow()?ya(this.targetBlock()):this.shadowDom}setShadowState(t){this.setShadowStateInternal({shadowState:t})}getShadowState(t){return t&&this.targetBlock()&&this.targetBlock().isShadow()?Vi(this.targetBlock()):this.shadowState}neighbours(t){return[]}getParentInput(){let t=null;const o=this.sourceBlock_.inputList;for(let c=0;c<o.length;c++)if(o[c].connection===this){t=o[c];break}return t}toString(){const t=this.sourceBlock_;if(!t)return"Orphan Connection";if(t.outputConnection===this)var o="Output Connection of ";else if(t.previousConnection===this)o="Previous Connection of ";else if(t.nextConnection===this)o="Next Connection of ";else{o=null;for(let c=0,g;g=t.inputList[c];c++)if(g.connection===this){o=g;break}if(o)o='Input "'+o.name+'" connection on ';else return console.warn("Connection not actually connected to sourceBlock_"),"Orphan Connection"}return o+t.toDevString()}stashShadowState(){const t=this.getShadowDom(!0),o=this.getShadowState(!0);return this.shadowState=this.shadowDom=null,{shadowDom:t,shadowState:o}}applyShadowState({shadowDom:t,shadowState:o}){this.shadowDom=t,this.shadowState=o}setShadowStateInternal({shadowDom:t=null,shadowState:o=null}={}){this.shadowDom=t,this.shadowState=o,this.getSourceBlock().isDeadOrDying()||((t=this.targetBlock())?t.isShadow()?(t.dispose(!1),this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock())):(t=this.createShadowBlock(!1),this.serializeShadow(t),t&&t.dispose(!1)):(this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock())))}createShadowBlock(t){var o=this.getSourceBlock();const c=this.getShadowState(),g=this.getShadowDom();if(o.isDeadOrDying()||!c&&!g)return null;if(c)return o=_o(c,o.workspace,{parentConnection:t?this:void 0,isShadow:!0,recordUndo:!1});if(g){if(o=Ql(g,o.workspace),t)if(this.type===Bt.INPUT_VALUE){if(!o.outputConnection)throw Error("Shadow block is missing an output connection");if(!this.connect(o.outputConnection))throw Error("Could not connect shadow block to connection")}else if(this.type===Bt.NEXT_STATEMENT){if(!o.previousConnection)throw Error("Shadow block is missing previous connection");if(!this.connect(o.previousConnection))throw Error("Could not connect shadow block to connection")}else throw Error("Cannot connect a shadow block to a previous/output connection");return o}return null}serializeShadow(t){t&&(this.shadowDom=ya(t),this.shadowState=Vi(t))}static getConnectionForOrphanedConnection(t,o){if(o.type===Bt.OUTPUT_VALUE)return GE(t,o.getSourceBlock());t=t.lastConnectionInStack(!0);const c=o.getConnectionChecker();return t&&c.canConnect(o,t,!1)?t:null}};Jn.CAN_CONNECT=0,Jn.REASON_SELF_CONNECTION=1,Jn.REASON_WRONG_TYPE=2,Jn.REASON_TARGET_NULL=3,Jn.REASON_CHECKS_FAILED=4,Jn.REASON_DIFFERENT_WORKSPACES=5,Jn.REASON_SHADOW_PARENT=6,Jn.REASON_DRAG_CHECKS_FAILED=7,Jn.REASON_PREVIOUS_AND_OUTPUT=8;var vf=class{constructor(t,o,c){if(this.data=null,this.disposed=!1,this.hue_=null,this.colour_="#000000",this.styleName_="",this.suppressPrefixSuffix=!1,this.previousConnection=this.nextConnection=this.outputConnection=null,this.inputList=[],this.icons=[],this.disabledReasons=new Set,this.tooltip="",this.contextMenu=!0,this.parentBlock_=null,this.childBlocks_=[],this.editable_=this.movable_=this.deletable_=!0,this.collapsed_=this.isShadow_=!1,this.outputShape_=null,this.rendered=this.isInsertionMarker_=this.initialized=this.disposing=!1,this.onchangeWrapper_=this.helpUrl=null,this.statementInputCount=0,this.workspace=t,this.id=c&&!t.getBlockById(c)?c:T(),t.setBlockById(this.id,this),this.xy_=new At(0,0),this.isInFlyout=t.isFlyout,this.isInMutator=t.isMutator,this.RTL=t.RTL,o){if(this.type=o,c=ks[o],!c||typeof c!="object")throw TypeError("Invalid block definition for type: "+o);Object.assign(this,c)}t.addTopBlock(this),t.addTypedBlock(this),new.target===vf&&this.doInit_()}doInit_(){const t=n.getGroup$$module$build$src$core$events$utils();t||n.setGroup$$module$build$src$core$events$utils(!0);const o=E();try{typeof this.init=="function"&&(n.setRecordUndo$$module$build$src$core$events$utils(!1),this.init(),n.setRecordUndo$$module$build$src$core$events$utils(o)),R()&&b(new(k(n.CREATE$$module$build$src$core$events$utils))(this))}finally{n.setGroup$$module$build$src$core$events$utils(t),n.setRecordUndo$$module$build$src$core$events$utils(o)}this.inputsInlineDefault=this.inputsInline,typeof this.onchange=="function"&&this.setOnChange(this.onchange)}dispose(t=!1){this.disposing=!0,this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.unplug(t),R()&&b(new(k(n.DELETE$$module$build$src$core$events$utils))(this)),this.workspace.removeTopBlock(this),this.disposeInternal()}disposeInternal(){this.disposing=!0,this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.workspace.removeTypedBlock(this),this.workspace.removeBlockById(this.id),typeof this.destroy=="function"&&this.destroy(),this.childBlocks_.forEach(t=>t.disposeInternal()),this.inputList.forEach(t=>t.dispose()),this.inputList.length=0,this.getConnections_(!0).forEach(t=>t.dispose()),this.disposed=!0}isDeadOrDying(){return this.disposing||this.disposed}initModel(){if(!this.initialized){for(const t of this.inputList)t.initModel();this.initialized=!0}}unplug(t){this.outputConnection&&this.unplugFromRow_(t),this.previousConnection&&this.unplugFromStack_(t)}unplugFromRow_(t){let o=null,c;(c=this.outputConnection)!=null&&c.isConnected()&&(o=this.outputConnection.targetConnection,this.outputConnection.disconnect()),o&&t&&(t=this.getOnlyValueConnection_())&&t.isConnected()&&!t.targetBlock().isShadow()&&(t=t.targetConnection,t==null||t.disconnect(),this.workspace.connectionChecker.canConnect(t,o,!1)?o.connect(t):t==null||t.onFailedConnect(o))}getOnlyValueConnection_(){let t=null;for(let o=0;o<this.inputList.length;o++){const c=this.inputList[o].connection;if(c&&c.type===Bt.INPUT_VALUE&&c.targetConnection){if(t)return null;t=c}}return t}unplugFromStack_(t){let o=null;var c;if((c=this.previousConnection)!=null&&c.isConnected()&&(o=this.previousConnection.targetConnection,this.previousConnection.disconnect()),c=this.getNextBlock(),t&&c&&!c.isShadow()){let g,$;t=($=(g=this.nextConnection)==null?void 0:g.targetConnection)!=null?$:null,t==null||t.disconnect(),o&&this.workspace.connectionChecker.canConnect(o,t,!1)&&o.connect(t)}}getConnections_(t){t=[],this.outputConnection&&t.push(this.outputConnection),this.previousConnection&&t.push(this.previousConnection),this.nextConnection&&t.push(this.nextConnection);for(let o=0,c;c=this.inputList[o];o++)c.connection&&t.push(c.connection);return t}lastConnectionInStack(t){let o=this.nextConnection;for(;o;){const c=o.targetBlock();if(!c||t&&c.isShadow())return o;o=c.nextConnection}return null}bumpNeighbours(){}getParent(){return this.parentBlock_}getInputWithBlock(t){for(let o=0,c;c=this.inputList[o];o++)if(c.connection&&c.connection.targetBlock()===t)return c;return null}getSurroundParent(){let t=this,o;do if(o=t,t=t.getParent(),!t)return null;while(t.getNextBlock()===o);return t}getNextBlock(){return this.nextConnection&&this.nextConnection.targetBlock()}getPreviousBlock(){return this.previousConnection&&this.previousConnection.targetBlock()}getRootBlock(){let t,o=this;do t=o,o=t.parentBlock_;while(o);return t}getTopStackBlock(){let t=this,o;do o=t.getPreviousBlock();while(o&&o.getNextBlock()===t&&(t=o));return t}getChildren(t){if(!t)return this.childBlocks_;t=[];for(let c=0,g;g=this.inputList[c];c++)if(g.connection){var o=g.connection.targetBlock();o&&t.push(o)}return(o=this.getNextBlock())&&t.push(o),t}setParent(t){if(t!==this.parentBlock_){var o=this.previousConnection&&this.previousConnection.targetBlock()||this.outputConnection&&this.outputConnection.targetBlock(),c=!!o;if(c&&t&&o!==t)throw Error("Block connected to superior one that is not new parent.");if(!c&&t)throw Error("Block not connected to new parent.");if(c&&!t)throw Error("Cannot set parent to null while block is still connected to superior block.");this.parentBlock_?dt(this.parentBlock_.childBlocks_,this):this.workspace.removeTopBlock(this),(this.parentBlock_=t)?t.childBlocks_.push(this):this.workspace.addTopBlock(this)}}getDescendants(t){const o=[this],c=this.getChildren(t);for(let g,$=0;g=c[$];$++)o.push(...g.getDescendants(t));return o}isDeletable(){return this.deletable_&&!this.isShadow_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnDeletable(){return this.deletable_}setDeletable(t){this.deletable_=t}isMovable(){return this.movable_&&!this.isShadow_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnMovable(){return this.movable_}setMovable(t){this.movable_=t}isDuplicatable(){return this.workspace.hasBlockLimits()?this.workspace.isCapacityAvailable(K(this,!0)):!0}isShadow(){return this.isShadow_}setShadow(t){this.isShadow_=t}isInsertionMarker(){return this.isInsertionMarker_}setInsertionMarker(t){this.isInsertionMarker_=t}isEditable(){return this.editable_&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnEditable(){return this.editable_}setEditable(t){this.editable_=t;for(let o=0,c;c=this.inputList[o];o++)for(let g=0,$;$=c.fieldRow[g];g++)$.updateEditable()}isDisposed(){return this.disposed}isSimpleReporter(){if(!this.outputConnection)return!1;for(const t of this.inputList)if(t.connection||1<t.fieldRow.length)return!1;return!0}getMatchingConnection(t,o){const c=this.getConnections_(!0);if(t=t.getConnections_(!0),c.length!==t.length)throw Error("Connection lists did not match in length.");for(let g=0;g<t.length;g++)if(t[g]===o)return c[g];return null}setHelpUrl(t){this.helpUrl=t}setTooltip(t){this.tooltip=t}getTooltip(){return kc(this)}getColour(){return this.colour_}getStyleName(){return this.styleName_}getHue(){return this.hue_}setColour(t){t=Jl(t),this.hue_=t.hue,this.colour_=t.hex}setStyle(t){this.styleName_=t}setOnChange(t){if(t&&typeof t!="function")throw Error("onchange must be a function.");this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.onchange=t,this.onchangeWrapper_=t.bind(this),this.workspace.addChangeListener(this.onchangeWrapper_)}getField(t){if(typeof t!="string")throw TypeError("Block.prototype.getField expects a string with the field name but received "+(t===void 0?"nothing":t+" of type "+typeof t)+" instead");for(let o=0,c;c=this.inputList[o];o++)for(let g=0,$;$=c.fieldRow[g];g++)if($.name===t)return $;return null}getVars(){const t=[];for(let o=0,c;c=this.inputList[o];o++)for(let g=0,$;$=c.fieldRow[g];g++)$.referencesVariables()&&t.push($.getValue());return t}getVarModels(){const t=[];for(let o=0,c;c=this.inputList[o];o++)for(let g=0,$;$=c.fieldRow[g];g++)if($.referencesVariables()){const M=this.workspace.getVariableById($.getValue());M&&t.push(M)}return t}updateVarName(t){for(let o=0,c;c=this.inputList[o];o++)for(let g=0,$;$=c.fieldRow[g];g++)$.referencesVariables()&&t.getId()===$.getValue()&&$.refreshVariableName()}renameVarById(t,o){for(let c=0,g;g=this.inputList[c];c++)for(let $=0,M;M=g.fieldRow[$];$++)M.referencesVariables()&&t===M.getValue()&&M.setValue(o)}getFieldValue(t){return(t=this.getField(t))?t.getValue():null}setFieldValue(t,o){const c=this.getField(o);if(!c)throw Error('Field "'+o+'" not found.');c.setValue(t)}setPreviousStatement(t,o){if(t)o===void 0&&(o=null),this.previousConnection||(this.previousConnection=this.makeConnection_(Bt.PREVIOUS_STATEMENT)),this.previousConnection.setCheck(o);else if(this.previousConnection){if(this.previousConnection.isConnected())throw Error("Must disconnect previous statement before removing connection.");this.previousConnection.dispose(),this.previousConnection=null}}setNextStatement(t,o){if(t)o===void 0&&(o=null),this.nextConnection||(this.nextConnection=this.makeConnection_(Bt.NEXT_STATEMENT)),this.nextConnection.setCheck(o);else if(this.nextConnection){if(this.nextConnection.isConnected())throw Error("Must disconnect next statement before removing connection.");this.nextConnection.dispose(),this.nextConnection=null}}setOutput(t,o){if(t)o===void 0&&(o=null),this.outputConnection||(this.outputConnection=this.makeConnection_(Bt.OUTPUT_VALUE)),this.outputConnection.setCheck(o);else if(this.outputConnection){if(this.outputConnection.isConnected())throw Error("Must disconnect output value before removing connection.");this.outputConnection.dispose(),this.outputConnection=null}}setInputsInline(t){this.inputsInline!==t&&(b(new(k(n.CHANGE$$module$build$src$core$events$utils))(this,"inline",null,this.inputsInline,t)),this.inputsInline=t)}getInputsInline(){if(this.inputsInline!==void 0)return this.inputsInline;for(var t=1;t<this.inputList.length;t++)if(this.inputList[t-1]instanceof dc&&this.inputList[t]instanceof dc)return!1;for(t=1;t<this.inputList.length;t++)if(this.inputList[t-1]instanceof n.ValueInput$$module$build$src$core$inputs$value_input&&this.inputList[t]instanceof dc)return!0;for(t=0;t<this.inputList.length;t++)if(this.inputList[t]instanceof lu)return!0;return!1}setOutputShape(t){this.outputShape_=t}getOutputShape(){return this.outputShape_}isEnabled(){return this.disabledReasons.size===0}get disabled(){return il("disabled","v11","v12","the isEnabled or hasDisabledReason methods of Block"),this.hasDisabledReason(xa)}set disabled(t){il("disabled","v11","v12","the setDisabledReason method of Block"),this.setDisabledReason(t,xa)}setEnabled(t){il("setEnabled","v11","v12","the setDisabledReason method of Block"),this.setDisabledReason(!t,xa)}setDisabledReason(t,o){this.disabledReasons.has(o)!==t&&(t?this.disabledReasons.add(o):this.disabledReasons.delete(o),t=new(k(n.CHANGE$$module$build$src$core$events$utils))(this,"disabled",null,!t,t),t.setDisabledReason(o),b(t))}getInheritedDisabled(){let t=this.getSurroundParent();for(;t;){if(!t.isEnabled())return!0;t=t.getSurroundParent()}return!1}hasDisabledReason(t){return this.disabledReasons.has(t)}getDisabledReasons(){return this.disabledReasons}isCollapsed(){return this.collapsed_}setCollapsed(t){this.collapsed_!==t&&(b(new(k(n.CHANGE$$module$build$src$core$events$utils))(this,"collapsed",null,this.collapsed_,t)),this.collapsed_=t)}toString(t,o){o=this.toTokens(o);for(let g=2;g<o.length;g++)o[g-2]==="("&&o[g]===")"&&(o[g-2]=o[g-1],o.splice(g-1,2));let c="";return o=o.reduce((g,$)=>(g=g+(c==="("||$===")"?"":" ")+$,c=$[$.length-1],g),""),o=o.trim()||"???",t&&o.length>t&&(o=o.substring(0,t-3)+"..."),o}toTokens(t="?"){const o=[];for(const g of this.inputList)if(g.name!=tv){for(const $ of g.fieldRow)o.push($.getText());if(g.connection){const $=g.connection.targetBlock();if($){var c=g.connection;let M=c.getCheck();!M&&c.targetConnection&&(M=c.targetConnection.getCheck()),(c=!!M&&(M.includes("Boolean")||M.includes("Number")))&&o.push("("),o.push(...$.toTokens(t)),c&&o.push(")")}else o.push(t)}}return o}appendValueInput(t){return this.appendInput(new n.ValueInput$$module$build$src$core$inputs$value_input(t,this))}appendStatementInput(t){return this.statementInputCount++,this.appendInput(new ta(t,this))}appendDummyInput(t=""){return this.appendInput(new dc(t,this))}appendEndRowInput(t=""){return this.appendInput(new lu(t,this))}appendInput(t){return this.inputList.push(t),t}appendInputFromRegistry(t,o){return(t=d(yt.INPUT,t,!1))?this.appendInput(new t(o,this)):null}jsonInit(t){var o=t.type?'Block "'+t.type+'": ':"";if(t.output&&t.previousStatement)throw Error(o+"Must not have both an output and a previousStatement.");for(var c=0;t["args"+c];){if(t["message"+c]===void 0)throw Error(o+`args${c} must have a corresponding message (message${c}).`);c++}if(t.style&&t.style.hat&&(this.hat=t.style.hat,t.style=null),t.style&&t.colour)throw Error(o+"Must not have both a colour and a style.");for(t.style?this.jsonInitStyle_(t,o):this.jsonInitColour_(t,o),c=0;t["message"+c]!==void 0;)this.interpolate_(t["message"+c],t["args"+c]||[],t["implicitAlign"+c]||t["lastDummyAlign"+c],o),c++;if(t.inputsInline!==void 0&&(n.disable$$module$build$src$core$events$utils(),this.setInputsInline(t.inputsInline),n.enable$$module$build$src$core$events$utils()),t.output!==void 0&&this.setOutput(!0,t.output),t.outputShape!==void 0&&this.setOutputShape(t.outputShape),t.previousStatement!==void 0&&this.setPreviousStatement(!0,t.previousStatement),t.nextStatement!==void 0&&this.setNextStatement(!0,t.nextStatement),t.tooltip!==void 0&&(c=yi(t.tooltip),this.setTooltip(c)),t.enableContextMenu!==void 0&&(this.contextMenu=!!t.enableContextMenu),t.suppressPrefixSuffix!==void 0&&(this.suppressPrefixSuffix=!!t.suppressPrefixSuffix),t.helpUrl!==void 0&&(c=yi(t.helpUrl),this.setHelpUrl(c)),typeof t.extensions=="string"&&(console.warn(o+"JSON attribute 'extensions' should be an array of strings. Found raw string in JSON for '"+t.type+"' block."),t.extensions=[t.extensions]),t.mutator!==void 0&&Gc(t.mutator,this,!0),t=t.extensions,Array.isArray(t))for(o=0;o<t.length;o++)Gc(t[o],this,!1)}jsonInitColour_(t,o){if("colour"in t)if(t.colour===void 0)console.warn(o+"Undefined colour value.");else{t=t.colour;try{this.setColour(t)}catch{console.warn(o+"Illegal colour value: ",t)}}}jsonInitStyle_(t,o){t=t.style;try{this.setStyle(t)}catch{console.warn(o+"Style does not exist: ",t)}}mixin(t,o){if(o!==void 0&&typeof o!="boolean")throw Error("opt_disableCheck must be a boolean if provided");if(!o){o=[];for(const c in t)this[c]!==void 0&&o.push(c);if(o.length)throw Error("Mixin will overwrite block members: "+JSON.stringify(o))}Object.assign(this,t)}interpolate_(t,o,c,g){t=Ad(t),this.validateTokens_(t,o.length),o=this.interpolateArguments_(t,o,c),c=[];for(let $=0,M;M=o[$];$++)if(this.isInputKeyword_(M.type)){if(t=this.inputFromJson_(M,g)){for(let Q=0,be;be=c[Q];Q++)t.appendField(be[0],be[1]);c.length=0}}else(t=this.fieldFromJson_(M))&&c.push([t,M.name])}validateTokens_(t,o){const c=[];let g=0;for(let $=0;$<t.length;$++){const M=t[$];if(typeof M=="number"){if(1>M||M>o)throw Error('Block "'+this.type+'": Message index %'+M+" out of range.");if(c[M])throw Error('Block "'+this.type+'": Message index %'+M+" duplicated.");c[M]=!0,g++}}if(g!==o)throw Error('Block "'+this.type+'": Message does not reference all '+o+" arg(s).")}interpolateArguments_(t,o,c){const g=[];for(let M=0;M<t.length;M++){var $=t[M];if(typeof $=="number"&&($=o[$-1]),typeof $=="string"){if($===`
`)$={type:"input_end_row"},c&&($.align=c);else if($=this.stringToFieldJson_($),!$)continue}g.push($)}return(t=g.length)&&!this.isInputKeyword_(g[t-1].type)&&(t={type:"input_dummy"},c&&(t.align=c),g.push(t)),g}fieldFromJson_(t){const o=n.fromJson$$module$build$src$core$field_registry(t);return!o&&t.alt?typeof t.alt=="string"?(t=this.stringToFieldJson_(t.alt))?this.fieldFromJson_(t):null:this.fieldFromJson_(t.alt):o}inputFromJson_(t,o){var c={LEFT:n.Align$$module$build$src$core$inputs$align.LEFT,RIGHT:n.Align$$module$build$src$core$inputs$align.RIGHT,CENTRE:n.Align$$module$build$src$core$inputs$align.CENTRE,CENTER:n.Align$$module$build$src$core$inputs$align.CENTRE};let g;switch(t.type){case"input_value":g=this.appendValueInput(t.name);break;case"input_statement":g=this.appendStatementInput(t.name);break;case"input_dummy":g=this.appendDummyInput(t.name);break;case"input_end_row":g=this.appendEndRowInput(t.name);break;default:g=this.appendInputFromRegistry(t.type,t.name)}return g?(t.check&&g.setCheck(t.check),t.align&&(c=c[t.align.toUpperCase()],c===void 0?console.warn(o+"Illegal align value: ",t.align):g.setAlign(c)),g):null}isInputKeyword_(t){return t==="input_value"||t==="input_statement"||t==="input_dummy"||t==="input_end_row"||u(yt.INPUT,t)}stringToFieldJson_(t){return(t=t.trim())?{type:"field_label",text:t}:null}moveInputBefore(t,o){if(t!==o){var c=-1,g=o?-1:this.inputList.length;for(let $=0,M;M=this.inputList[$];$++)if(M.name===t){if(c=$,g!==-1)break}else if(o&&M.name===o&&(g=$,c!==-1))break;if(c===-1)throw Error('Named input "'+t+'" not found.');if(g===-1)throw Error('Reference input "'+o+'" not found.');this.moveNumberedInputBefore(c,g)}}moveNumberedInputBefore(t,o){if(t===o)throw Error("Can't move input to itself.");if(t>=this.inputList.length)throw RangeError("Input index "+t+" out of bounds.");if(o>this.inputList.length)throw RangeError("Reference input "+o+" out of bounds.");const c=this.inputList[t];this.inputList.splice(t,1),t<o&&o--,this.inputList.splice(o,0,c)}removeInput(t,o){for(let c=0,g;g=this.inputList[c];c++)if(g.name===t)return g instanceof ta&&this.statementInputCount--,g.dispose(),this.inputList.splice(c,1),!0;if(o)return!1;throw Error("Input not found: "+t)}getInput(t){for(let o=0,c;c=this.inputList[o];o++)if(c.name===t)return c;return null}getInputTargetBlock(t){return(t=this.getInput(t))&&t.connection&&t.connection.targetBlock()}getCommentText(){let t,o;return(o=(t=this.getIcon(wr.COMMENT))==null?void 0:t.getText())!=null?o:null}setCommentText(t){var o;let c;const g=(c=(o=this.getIcon(wr.COMMENT))==null?void 0:o.getText())!=null?c:null;if(g!==t){if(t!==null){if(o=this.getIcon(wr.COMMENT),!o){if(o=d(yt.ICON,wr.COMMENT.toString(),!1),!o)throw Error("No comment icon class is registered, so a comment cannot be set");if(o=new o(this),!nh(o))throw Error("The class registered as a comment icon does not conform to the ICommentIcon interface");o=this.addIcon(o)}n.disable$$module$build$src$core$events$utils(),o.setText(t),n.enable$$module$build$src$core$events$utils()}else this.removeIcon(wr.COMMENT);b(new(k(n.CHANGE$$module$build$src$core$events$utils))(this,"comment",null,g,t))}}setWarningText(t,o){}setMutator(t){}addIcon(t){if(this.hasIcon(t.getType()))throw new h1(t);return this.icons.push(t),this.icons.sort((o,c)=>o.getWeight()-c.getWeight()),t}removeIcon(t){if(!this.hasIcon(t))return!1;let o;return(o=this.getIcon(t))==null||o.dispose(),this.icons=this.icons.filter(c=>!c.getType().equals(t)),!0}hasIcon(t){return this.icons.some(o=>o.getType().equals(t))}getIcon(t){return t instanceof wr?this.icons.find(o=>o.getType().equals(t)):this.icons.find(o=>o.getType().toString()===t)}getIcons(){return[...this.icons]}getRelativeToSurfaceXY(){return this.xy_}moveBy(t,o,c){if(this.parentBlock_)throw Error("Block has parent");const g=new(k(n.MOVE$$module$build$src$core$events$utils))(this);c&&g.setReason(c),this.xy_.translate(t,o),g.recordNew(),b(g)}makeConnection_(t){return new Jn(this,t)}allInputsFilled(t){if(t===void 0&&(t=!0),!t&&this.isShadow())return!1;for(let c=0,g;g=this.inputList[c];c++)if(g.connection){var o=g.connection.targetBlock();if(!o||!o.allInputsFilled(t))return!1}return(o=this.getNextBlock())?o.allInputsFilled(t):!0}toDevString(){let t=this.type?'"'+this.type+'" block':"Block";return this.id&&(t+=' (id="'+this.id+'")'),t}};vf.COLLAPSED_INPUT_NAME=tv,vf.COLLAPSED_FIELD_NAME=jE;var Ia=class{constructor(t,o,c,g){this.workspace=t,this.targetWorkspace=o,this.isFlyoutLabel=g,this.onMouseUpWrapper=null,this.height=this.width=0,this.cursorSvg=this.svgText=this.svgGroup=null,this.text=c.text,this.position=new At(0,0),this.callbackKey=c.callbackKey||c.callbackkey,this.cssClass=c["web-class"]||null,this.info=c}createDom(){var t=this.isFlyoutLabel?"blocklyFlyoutLabel":"blocklyFlyoutButton";this.cssClass&&(t+=" "+this.cssClass),this.svgGroup=Ce(Ve.G,{class:t},this.workspace.getCanvas());let o;this.isFlyoutLabel||(o=Ce(Ve.RECT,{class:"blocklyFlyoutButtonShadow",rx:Ia.BORDER_RADIUS,ry:Ia.BORDER_RADIUS,x:1,y:1},this.svgGroup)),t=Ce(Ve.RECT,{class:this.isFlyoutLabel?"blocklyFlyoutLabelBackground":"blocklyFlyoutButtonBackground",rx:Ia.BORDER_RADIUS,ry:Ia.BORDER_RADIUS},this.svgGroup);const c=Ce(Ve.TEXT,{class:this.isFlyoutLabel?"blocklyFlyoutLabelText":"blocklyText",x:0,y:0,"text-anchor":"middle"},this.svgGroup);var g=yi(this.text);this.workspace.RTL&&(g+="‏"),c.textContent=g,this.isFlyoutLabel&&(this.svgText=c,this.workspace.getThemeManager().subscribe(this.svgText,"flyoutForegroundColour","fill"));const $=Ae(c,"fontSize"),M=Ae(c,"fontWeight"),Q=Ae(c,"fontFamily");if(this.width=$t(c,$,M,Q),g=L(g,$,M,Q),this.height=g.height,!this.isFlyoutLabel){this.width+=2*Ia.TEXT_MARGIN_X,this.height+=2*Ia.TEXT_MARGIN_Y;let be;(be=o)==null||be.setAttribute("width",String(this.width));let nt;(nt=o)==null||nt.setAttribute("height",String(this.height))}return t.setAttribute("width",String(this.width)),t.setAttribute("height",String(this.height)),c.setAttribute("x",String(this.width/2)),c.setAttribute("y",String(this.height/2-g.height/2+g.baseline)),this.updateTransform(),this.onMouseUpWrapper=Ue(this.svgGroup,"pointerup",this,this.onMouseUp),this.svgGroup}show(){this.updateTransform(),this.svgGroup.setAttribute("display","block")}updateTransform(){this.svgGroup.setAttribute("transform","translate("+this.position.x+","+this.position.y+")")}moveTo(t,o){this.position.x=t,this.position.y=o,this.updateTransform()}isLabel(){return this.isFlyoutLabel}getPosition(){return this.position}getButtonText(){return this.text}getTargetWorkspace(){return this.targetWorkspace}getWorkspace(){return this.workspace}dispose(){this.onMouseUpWrapper&&re(this.onMouseUpWrapper),this.svgGroup&&W(this.svgGroup),this.svgText&&this.workspace.getThemeManager().unsubscribe(this.svgText)}setCursorSvg(t){t?this.svgGroup&&(this.svgGroup.appendChild(t),this.cursorSvg=t):this.cursorSvg=null}setMarkerSvg(){throw Error("Attempted to set a marker on a button.")}onMouseUp(t){(t=this.targetWorkspace.getGesture(t))&&t.cancel(),this.isFlyoutLabel&&this.callbackKey?console.warn("Labels should not have callbacks. Label text: "+this.text):this.isFlyoutLabel||this.callbackKey&&this.targetWorkspace.getButtonCallback(this.callbackKey)?this.isFlyoutLabel||(t=this.targetWorkspace.getButtonCallback(this.callbackKey))&&t(this):console.warn("Buttons should have callbacks. Button text: "+this.text)}};Ia.TEXT_MARGIN_X=5,Ia.TEXT_MARGIN_Y=2,Ia.BORDER_RADIUS=4,je(`
.blocklyFlyoutButton {
  fill: #888;
  cursor: default;
}

.blocklyFlyoutButtonShadow {
  fill: #666;
}

.blocklyFlyoutButton:hover {
  fill: #aaa;
}

.blocklyFlyoutLabel {
  cursor: default;
}

.blocklyFlyoutLabelBackground {
  opacity: 0;
}
`);var _t=class{constructor(t,o,c){if(this.wsCoordinate=null,!o)throw Error("Cannot create a node without a location.");this.type=t,this.isConnectionLocation=_t.isConnectionType(t),this.location=o,this.processParams(c||null)}processParams(t){t&&t.wsCoordinate&&(this.wsCoordinate=t.wsCoordinate)}getLocation(){return this.location}getType(){return this.type}getWsCoordinate(){return this.wsCoordinate}isConnection(){return this.isConnectionLocation}findNextForInput(){var t=this.location.getParentInput();const o=t.getSourceBlock();for(t=o.inputList.indexOf(t),t+=1;t<o.inputList.length;t++){const c=o.inputList[t],g=c.fieldRow;for(let $=0;$<g.length;$++){const M=g[$];if(M.isClickable()||_t.NAVIGATE_ALL_FIELDS)return _t.createFieldNode(M)}if(c.connection)return _t.createInputNode(c)}return null}findNextForField(){var t=this.location,o=t.getParentInput();const c=t.getSourceBlock();if(!c)throw Error("The current AST location is not associated with a block");var g=c.inputList.indexOf(o);for(t=o.fieldRow.indexOf(t)+1;g<c.inputList.length;g++){o=c.inputList[g];const $=o.fieldRow;for(;t<$.length;){if($[t].isClickable()||_t.NAVIGATE_ALL_FIELDS)return _t.createFieldNode($[t]);t++}if(t=0,o.connection)return _t.createInputNode(o)}return null}findPrevForInput(){const t=this.location.getParentInput(),o=t.getSourceBlock();for(var c=o.inputList.indexOf(t);0<=c;c--){var g=o.inputList[c];if(g.connection&&g!==t)return _t.createInputNode(g);g=g.fieldRow;for(let $=g.length-1;0<=$;$--){const M=g[$];if(M.isClickable()||_t.NAVIGATE_ALL_FIELDS)return _t.createFieldNode(M)}}return null}findPrevForField(){var t=this.location;const o=t.getParentInput(),c=t.getSourceBlock();if(!c)throw Error("The current AST location is not associated with a block");var g=c.inputList.indexOf(o);for(t=o.fieldRow.indexOf(t)-1;0<=g;g--){var $=c.inputList[g];if($.connection&&$!==o)return _t.createInputNode($);for($=$.fieldRow;-1<t;){if($[t].isClickable()||_t.NAVIGATE_ALL_FIELDS)return _t.createFieldNode($[t]);t--}0<=g-1&&(t=c.inputList[g-1].fieldRow.length-1)}return null}navigateBetweenStacks(t){var o=this.getLocation();if(o.getSourceBlock){var c=o.getSourceBlock();c&&(o=c)}if(!o||o.isDeadOrDying())return null;if(o.workspace.isFlyout)return this.navigateFlyoutContents(t);c=o.getRootBlock(),o=c.workspace.getTopBlocks(!0);for(let g=0;g<o.length;g++)if(c.id===o[g].id)return t=g+(t?1:-1),t===-1||t===o.length?null:_t.createStackNode(o[t]);throw Error("Couldn't find "+(t?"next":"previous")+" stack?!")}navigateFlyoutContents(t){let o;switch(this.getType()){case _t.types.STACK:o=this.getLocation();var c=o.workspace.targetWorkspace;break;case _t.types.BUTTON:o=this.getLocation(),c=o.getTargetWorkspace();break;default:return null}return c=c.getFlyout(),c&&(t=this.findNextLocationInFlyout(c.getContents(),o,t))?t.type==="button"&&t.button?_t.createButtonNode(t.button):t.type==="block"&&t.block?_t.createStackNode(t.block):null:null}findNextLocationInFlyout(t,o,c){const g=t.findIndex($=>o instanceof vf&&$.block===o||o instanceof Ia&&$.button===o);return 0>g?null:(c=c?g+1:g-1,c===-1||c===t.length?null:t[c])}findTopASTNodeForBlock(t){const o=Hc(t);return o?_t.createConnectionNode(o):_t.createBlockNode(t)}getOutAstNodeForBlock(t){if(!t)return null;t=t.getTopStackBlock();const o=Hc(t);return o&&o.targetConnection&&o.targetConnection.getParentInput()?_t.createInputNode(o.targetConnection.getParentInput()):_t.createStackNode(t)}findFirstFieldOrInput(t){t=t.inputList;for(let o=0;o<t.length;o++){const c=t[o],g=c.fieldRow;for(let $=0;$<g.length;$++){const M=g[$];if(M.isClickable()||_t.NAVIGATE_ALL_FIELDS)return _t.createFieldNode(M)}if(c.connection)return _t.createInputNode(c)}return null}getSourceBlock(){return this.getType()===_t.types.BLOCK?this.getLocation():this.getType()===_t.types.STACK?this.getLocation():this.getType()===_t.types.WORKSPACE||this.getType()===_t.types.BUTTON?null:this.getLocation().getSourceBlock()}next(){switch(this.type){case _t.types.STACK:return this.navigateBetweenStacks(!0);case _t.types.OUTPUT:return _t.createBlockNode(this.location.getSourceBlock());case _t.types.FIELD:return this.findNextForField();case _t.types.INPUT:return this.findNextForInput();case _t.types.BLOCK:const t=this.location.nextConnection;if(!t)break;return _t.createConnectionNode(t);case _t.types.PREVIOUS:return _t.createBlockNode(this.location.getSourceBlock());case _t.types.NEXT:return _t.createConnectionNode(this.location.targetConnection);case _t.types.BUTTON:return this.navigateFlyoutContents(!0)}return null}in(){switch(this.type){case _t.types.WORKSPACE:const t=this.location.getTopBlocks(!0);if(0<t.length)return _t.createStackNode(t[0]);break;case _t.types.STACK:return this.findTopASTNodeForBlock(this.location);case _t.types.BLOCK:return this.findFirstFieldOrInput(this.location);case _t.types.INPUT:return _t.createConnectionNode(this.location.targetConnection)}return null}prev(){switch(this.type){case _t.types.STACK:return this.navigateBetweenStacks(!1);case _t.types.FIELD:return this.findPrevForField();case _t.types.INPUT:return this.findPrevForInput();case _t.types.BLOCK:var t=Hc(this.location);if(!t)break;return _t.createConnectionNode(t);case _t.types.PREVIOUS:if((t=this.location.targetConnection)&&!t.getParentInput())return _t.createConnectionNode(t);break;case _t.types.NEXT:return _t.createBlockNode(this.location.getSourceBlock());case _t.types.BUTTON:return this.navigateFlyoutContents(!1)}return null}out(){switch(this.type){case _t.types.STACK:var t=this.location,o=t.getRelativeToSurfaceXY();return o=new At(o.x,o.y+_t.DEFAULT_OFFSET_Y),_t.createWorkspaceNode(t.workspace,o);case _t.types.OUTPUT:return t=this.location,(o=t.targetConnection)?_t.createConnectionNode(o):_t.createStackNode(t.getSourceBlock());case _t.types.FIELD:if(t=this.location.getSourceBlock(),!t)throw Error("The current AST location is not associated with a block");return _t.createBlockNode(t);case _t.types.INPUT:return _t.createBlockNode(this.location.getSourceBlock());case _t.types.BLOCK:return this.getOutAstNodeForBlock(this.location);case _t.types.PREVIOUS:return this.getOutAstNodeForBlock(this.location.getSourceBlock());case _t.types.NEXT:return this.getOutAstNodeForBlock(this.location.getSourceBlock())}return null}static isConnectionType(t){switch(t){case _t.types.PREVIOUS:case _t.types.NEXT:case _t.types.INPUT:case _t.types.OUTPUT:return!0}return!1}static createFieldNode(t){return t?new _t(_t.types.FIELD,t):null}static createConnectionNode(t){if(!t)return null;const o=t.type;return o===Bt.INPUT_VALUE||o===Bt.NEXT_STATEMENT&&t.getParentInput()?_t.createInputNode(t.getParentInput()):o===Bt.NEXT_STATEMENT?new _t(_t.types.NEXT,t):o===Bt.OUTPUT_VALUE?new _t(_t.types.OUTPUT,t):o===Bt.PREVIOUS_STATEMENT?new _t(_t.types.PREVIOUS,t):null}static createInputNode(t){return t&&t.connection?new _t(_t.types.INPUT,t.connection):null}static createBlockNode(t){return t?new _t(_t.types.BLOCK,t):null}static createStackNode(t){return t?new _t(_t.types.STACK,t):null}static createButtonNode(t){return t?new _t(_t.types.BUTTON,t):null}static createWorkspaceNode(t,o){return o&&t?new _t(_t.types.WORKSPACE,t,{wsCoordinate:o}):null}static createTopNode(t){const o=Hc(t);return o?_t.createConnectionNode(o):_t.createBlockNode(t)}};_t.NAVIGATE_ALL_FIELDS=!1,_t.DEFAULT_OFFSET_Y=-20,function(t){t=t.types||(t.types={}),t.FIELD="field",t.BLOCK="block",t.INPUT="input",t.OUTPUT="output",t.NEXT="next",t.PREVIOUS="previous",t.STACK="stack",t.WORKSPACE="workspace",t.BUTTON="button"}(_t||(_t={}));var Yb=class extends Rt{constructor(t,o,c,g){let $=t?t.workspace.id:void 0;g&&g.getType()===_t.types.WORKSPACE&&($=g.getLocation().id),super($),this.type=oc,this.blockId=t==null?void 0:t.id,this.oldNode=c||void 0,this.newNode=g,this.isCursor=o}toJson(){const t=super.toJson();if(this.isCursor===void 0)throw Error("Whether this is a cursor event or not is undefined. Either pass a value to the constructor, or call fromJson");if(!this.newNode)throw Error("The new node is undefined. Either pass a node to the constructor, or call fromJson");return t.isCursor=this.isCursor,t.blockId=this.blockId,t.oldNode=this.oldNode,t.newNode=this.newNode,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new Yb),o.isCursor=t.isCursor,o.blockId=t.blockId,o.oldNode=t.oldNode,o.newNode=t.newNode,o}};r(yt.EVENT,oc,Yb);var _G="blocklyCursor",vG="blocklyMarker",TG=.75,Kb=class{constructor(t,o,c){this.workspace=t,this.marker=c,this.markerSvgRect_=this.markerSvgLine_=this.markerInput_=this.markerBlock_=this.svgGroup_=this.markerSvg_=this.currentMarkerSvg=this.parent=null,this.constants_=o,t=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR,this.colour_=c.colour||t}getSvgRoot(){return this.svgGroup_}getMarker(){return this.marker}isCursor(){return this.marker.type==="cursor"}createDom(){const t=this.isCursor()?_G:vG;return this.svgGroup_=Ce(Ve.G,{class:t}),this.createDomInternal_(),this.svgGroup_}setParent_(t){this.isCursor()?(this.parent&&this.parent.setCursorSvg(null),t.setCursorSvg(this.getSvgRoot())):(this.parent&&this.parent.setMarkerSvg(null),t.setMarkerSvg(this.getSvgRoot())),this.parent=t}draw(t,o){if(o){this.constants_=this.workspace.getRenderer().getConstants();var c=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR;this.colour_=this.marker.colour||c,this.applyColour_(o),this.showAtLocation_(o),this.fireMarkerEvent(t,o),t=this.currentMarkerSvg.childNodes[0],t!==void 0&&t.beginElement&&t.beginElement()}else this.hide()}showAtLocation_(t){const o=t.getLocation().type;t.getType()===_t.types.BLOCK?this.showWithBlock_(t):t.getType()===_t.types.OUTPUT?this.showWithOutput_(t):o===Bt.INPUT_VALUE?this.showWithInput_(t):o===Bt.NEXT_STATEMENT?this.showWithNext_(t):t.getType()===_t.types.PREVIOUS?this.showWithPrevious_(t):t.getType()===_t.types.FIELD?this.showWithField_(t):t.getType()===_t.types.WORKSPACE?this.showWithCoordinates_(t):t.getType()===_t.types.STACK?this.showWithStack_(t):t.getType()===_t.types.BUTTON&&this.showWithButton_(t)}showWithBlockPrevOutput(t){t=t.getSourceBlock();const o=t.width;var c=t.height,g=c*TG;const $=this.constants_.CURSOR_BLOCK_PADDING;t.previousConnection?(c=this.constants_.shapeFor(t.previousConnection),this.positionPrevious_(o,$,g,c)):t.outputConnection?(g=this.constants_.shapeFor(t.outputConnection),this.positionOutput_(o,c,g)):this.positionBlock_(o,$,g),this.setParent_(t),this.showCurrent_()}showWithBlock_(t){this.showWithBlockPrevOutput(t)}showWithPrevious_(t){this.showWithBlockPrevOutput(t)}showWithOutput_(t){this.showWithBlockPrevOutput(t)}showWithCoordinates_(t){var o=t.getWsCoordinate();t=o.x,o=o.y,this.workspace.RTL&&(t-=this.constants_.CURSOR_WS_WIDTH),this.positionLine_(t,o,this.constants_.CURSOR_WS_WIDTH),this.setParent_(this.workspace),this.showCurrent_()}showWithField_(t){t=t.getLocation();const o=t.getSize().width,c=t.getSize().height;this.positionRect_(0,0,o,c),this.setParent_(t),this.showCurrent_()}showWithInput_(t){t=t.getLocation();const o=t.getSourceBlock();this.positionInput_(t),this.setParent_(o),this.showCurrent_()}showWithNext_(t){var o=t.getLocation();t=o.getSourceBlock();let c=0;o=o.getOffsetInBlock().y;const g=t.getHeightWidth().width;this.workspace.RTL&&(c=-g),this.positionLine_(c,o,g),this.setParent_(t),this.showCurrent_()}showWithStack_(t){t=t.getLocation();var o=t.getHeightWidth();const c=o.width+this.constants_.CURSOR_STACK_PADDING;o=o.height+this.constants_.CURSOR_STACK_PADDING;const g=-this.constants_.CURSOR_STACK_PADDING/2,$=-this.constants_.CURSOR_STACK_PADDING/2;let M=g;this.workspace.RTL&&(M=-(c+g)),this.positionRect_(M,$,c,o),this.setParent_(t),this.showCurrent_()}showWithButton_(t){t=t.getLocation();const o=t.width+this.constants_.CURSOR_STACK_PADDING,c=t.height+this.constants_.CURSOR_STACK_PADDING,g=-this.constants_.CURSOR_STACK_PADDING/2,$=-this.constants_.CURSOR_STACK_PADDING/2;let M=g;this.workspace.RTL&&(M=-(o+g)),this.positionRect_(M,$,o,c),this.setParent_(t),this.showCurrent_()}showCurrent_(){this.hide(),this.currentMarkerSvg&&(this.currentMarkerSvg.style.display="")}positionBlock_(t,o,c){if(t=Si(-o,c)+Nt("V",-o)+Nt("H",t+2*o)+Nt("V",c),!this.markerBlock_)throw Error("createDom should be called before positioning the marker");this.markerBlock_.setAttribute("d",t),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionInput_(t){const o=t.getOffsetInBlock().x,c=t.getOffsetInBlock().y;t=Zi(0,0)+this.constants_.shapeFor(t).pathDown,this.markerInput_.setAttribute("d",t),this.markerInput_.setAttribute("transform","translate("+o+","+c+")"+(this.workspace.RTL?" scale(-1 1)":"")),this.currentMarkerSvg=this.markerInput_}positionLine_(t,o,c){if(!this.markerSvgLine_)throw Error("createDom should be called before positioning the line");this.markerSvgLine_.setAttribute("x",`${t}`),this.markerSvgLine_.setAttribute("y",`${o}`),this.markerSvgLine_.setAttribute("width",`${c}`),this.currentMarkerSvg=this.markerSvgLine_}positionOutput_(t,o,c){if(!this.markerBlock_)throw Error("createDom should be called before positioning the output");t=Si(t,0)+Nt("h",-(t-c.width))+Nt("v",this.constants_.TAB_OFFSET_FROM_TOP)+c.pathDown+Nt("V",o)+Nt("H",t),this.markerBlock_.setAttribute("d",t),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionPrevious_(t,o,c,g){if(!this.markerBlock_)throw Error("createDom should be called before positioning the previous connection marker");t=Si(-o,c)+Nt("V",-o)+Nt("H",this.constants_.NOTCH_OFFSET_LEFT)+g.pathLeft+Nt("H",t+2*o)+Nt("V",c),this.markerBlock_.setAttribute("d",t),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionRect_(t,o,c,g){if(!this.markerSvgRect_)throw Error("createDom should be called before positioning the rect");this.markerSvgRect_.setAttribute("x",`${t}`),this.markerSvgRect_.setAttribute("y",`${o}`),this.markerSvgRect_.setAttribute("width",`${c}`),this.markerSvgRect_.setAttribute("height",`${g}`),this.currentMarkerSvg=this.markerSvgRect_}flipRtl(t){t.setAttribute("transform","scale(-1 1)")}hide(){if(!(this.markerSvgLine_&&this.markerSvgRect_&&this.markerInput_&&this.markerBlock_))throw Error("createDom should be called before hiding the marker");this.markerSvgLine_.style.display="none",this.markerSvgRect_.style.display="none",this.markerInput_.style.display="none",this.markerBlock_.style.display="none"}fireMarkerEvent(t,o){const c=o.getSourceBlock();t=new(k(oc))(c,this.isCursor(),t,o),b(t)}getBlinkProperties_(){return{attributeType:"XML",attributeName:"fill",dur:"1s",values:this.colour_+";transparent;transparent;",repeatCount:"indefinite"}}createDomInternal_(){if(this.markerSvg_=Ce(Ve.G,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.svgGroup_),this.markerSvgLine_=Ce(Ve.RECT,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.markerSvg_),this.markerSvgRect_=Ce(Ve.RECT,{class:"blocklyVerticalMarker",rx:10,ry:10},this.markerSvg_),this.markerInput_=Ce(Ve.PATH,{transform:""},this.markerSvg_),this.markerBlock_=Ce(Ve.PATH,{transform:"",fill:"none","stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.hide(),this.isCursor()){const t=this.getBlinkProperties_();Ce(Ve.ANIMATE,t,this.markerSvgLine_),Ce(Ve.ANIMATE,t,this.markerInput_),Ce(Ve.ANIMATE,Object.assign({},t,{attributeName:"stroke"}),this.markerBlock_)}return this.markerSvg_}applyColour_(t){if(!(this.markerSvgLine_&&this.markerSvgRect_&&this.markerInput_&&this.markerBlock_))throw Error("createDom should be called before applying color to the markerj");this.markerSvgLine_.setAttribute("fill",this.colour_),this.markerSvgRect_.setAttribute("stroke",this.colour_),this.markerInput_.setAttribute("fill",this.colour_),this.markerBlock_.setAttribute("stroke",this.colour_),this.isCursor()&&(t=this.colour_+";transparent;transparent;",this.markerSvgLine_.firstElementChild.setAttribute("values",t),this.markerInput_.firstElementChild.setAttribute("values",t),this.markerBlock_.firstElementChild.setAttribute("values",t))}dispose(){this.svgGroup_&&W(this.svgGroup_)}},vy=class{constructor(t,o,c){this.markerSvg=this.cursorSvg=null,this.connectionHighlights=new WeakMap,this.highlightOffsets=new WeakMap,this.constants=c,this.style=o,this.svgRoot=t,this.svgPath=Ce(Ve.PATH,{class:"blocklyPath"},this.svgRoot)}setPath(t){this.svgPath.setAttribute("d",t)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)")}setCursorSvg(t){t?(this.svgRoot.appendChild(t),this.cursorSvg=t):this.cursorSvg=null}setMarkerSvg(t){t?(this.cursorSvg?this.svgRoot.insertBefore(t,this.cursorSvg):this.svgRoot.appendChild(t),this.markerSvg=t):this.markerSvg=null}applyColour(t){this.svgPath.setAttribute("stroke",this.style.colourTertiary),this.svgPath.setAttribute("fill",this.style.colourPrimary),this.updateShadow_(t.isShadow()),this.updateDisabled_(!t.isEnabled()||t.getInheritedDisabled())}setStyle(t){this.style=t}setClass_(t,o){t&&(o?Me(this.svgRoot,t):oe(this.svgRoot,t))}updateHighlighted(t){t?this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"):this.svgPath.setAttribute("filter","none")}updateShadow_(t){t&&(this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary))}updateDisabled_(t){this.setClass_("blocklyDisabled",t),t&&this.svgPath.setAttribute("fill","url(#"+this.constants.disabledPatternId+")")}updateSelected(t){this.setClass_("blocklySelected",t)}updateDraggingDelete(t){this.setClass_("blocklyDraggingDelete",t)}updateInsertionMarker(t){this.setClass_("blocklyInsertionMarker",t)}updateMovable(t){this.setClass_("blocklyDraggable",t)}updateReplacementFade(t){this.setClass_("blocklyReplaceable",t)}updateShapeForInputHighlight(t,o){}addConnectionHighlight(t,o,c,g){if(this.connectionHighlights.has(t)){if(this.currentHighlightMatchesNew(t,o,c))return;this.removeConnectionHighlight(t)}o=Ce(Ve.PATH,{class:"blocklyHighlightedConnectionPath",d:o,transform:`translate(${c.x}, ${c.y})`+(g?" scale(-1 1)":"")},this.svgRoot),this.connectionHighlights.set(t,o)}currentHighlightMatchesNew(t,o,c){let g;const $=(g=this.connectionHighlights.get(t))==null?void 0:g.getAttribute("d");return t=this.highlightOffsets.get(t),$===o&&At.equals(t,c)}removeConnectionHighlight(t){const o=this.connectionHighlights.get(t);o&&(W(o),this.connectionHighlights.delete(t))}},Oa=class{constructor(t){this.activeCandidate=this.lastMarker=this.lastOnStack=null,this.wouldDeleteBlock=!1,this.fadedBlock=this.highlightedBlock=this.markerConnection=null,n.setSelected$$module$build$src$core$common(t),this.topBlock=t,this.workspace=t.workspace,this.firstMarker=this.createMarkerBlock(this.topBlock),this.availableConnections=this.initAvailableConnections(),this.lastOnStack&&(this.lastMarker=this.createMarkerBlock(this.lastOnStack.getSourceBlock()))}dispose(){this.availableConnections.length=0,this.disposeInsertionMarker(this.firstMarker),this.disposeInsertionMarker(this.lastMarker)}updateAvailableConnections(){this.availableConnections=this.initAvailableConnections()}wouldConnectBlock(){return!!this.activeCandidate}applyConnections(){if(this.activeCandidate){n.disable$$module$build$src$core$events$utils(),this.hidePreview(),n.enable$$module$build$src$core$events$utils();var{local:t,closest:o}=this.activeCandidate;t.connect(o);var c=t.isSuperior()?o:t,g=this.topBlock.getRootBlock();Kt().then(()=>{qp(c.getSourceBlock()),setTimeout(()=>{g.bringToFront()},0)})}}update(t,o){const c=this.getCandidate(t);((this.wouldDeleteBlock=this.shouldDelete(!!c,o))||this.shouldUpdatePreviews(c,t))&&(n.disable$$module$build$src$core$events$utils(),this.maybeHidePreview(c),this.maybeShowPreview(c),n.enable$$module$build$src$core$events$utils())}createMarkerBlock(t){n.disable$$module$build$src$core$events$utils();let o;try{const c=Vi(t,{addCoordinates:!1,addInputBlocks:!1,addNextBlocks:!1,doFullSerialization:!1});if(!c)throw Error(`Failed to serialize source block. ${t.toDevString()}`);o=Ii(c,this.workspace);for(const g of o.getDescendants(!1))g.setInsertionMarker(!0);o.initSvg(),o.getSvgRoot().setAttribute("visibility","hidden")}finally{n.enable$$module$build$src$core$events$utils()}return o}initAvailableConnections(){const t=this.topBlock.getConnections_(!1),o=this.topBlock.lastConnectionInStack(!0);return o&&o!==this.topBlock.nextConnection&&(t.push(o),this.lastOnStack=o),t}shouldUpdatePreviews(t,o){if(!t)return!!this.activeCandidate;if(!this.activeCandidate)return!0;const{local:c,closest:g}=this.activeCandidate;if(g===t.closest&&c===t.local)return!1;const $=c.x+o.x-g.x;return o=c.y+o.y-g.y,t.radius<Math.sqrt($*$+o*o)-n.config$$module$build$src$core$config.currentConnectionPreference}getCandidate(t){this.markerConnection&&this.markerConnection.isConnected()||this.updateAvailableConnections();let o=this.getStartRadius(),c=null;for(let g=0;g<this.availableConnections.length;g++){const $=this.availableConnections[g],M=$.closest(o,t);M.connection&&(c={closest:M.connection,local:$,radius:M.radius},o=M.radius)}return c}getStartRadius(){return this.activeCandidate?n.config$$module$build$src$core$config.connectingSnapRadius:n.config$$module$build$src$core$config.snapRadius}shouldDelete(t,o){return o&&this.workspace.getComponentManager().hasCapability(o.id,Vr.Capability.DELETE_AREA)?o.wouldDelete(this.topBlock):!1}maybeShowPreview(t){if(!this.wouldDeleteBlock&&t){var o=t.closest,c;o===((c=this.activeCandidate)==null?void 0:c.closest)||o.getSourceBlock().isInsertionMarker()?console.log("Trying to connect to an insertion marker"):(this.activeCandidate=t,this.showPreview(this.activeCandidate))}}showPreview(t){const o=this.workspace.getRenderer();switch(o.getConnectionPreviewMethod(t.closest,t.local,this.topBlock)){case Oa.PREVIEW_TYPE.INPUT_OUTLINE:this.showInsertionInputOutline(t);break;case Oa.PREVIEW_TYPE.INSERTION_MARKER:this.showInsertionMarker(t);break;case Oa.PREVIEW_TYPE.REPLACEMENT_FADE:this.showReplacementFade(t)}o.shouldHighlightConnection(t.closest)&&t.closest.highlight()}maybeHidePreview(t){if(!t)this.hidePreview();else if(this.activeCandidate){const o=this.activeCandidate.local!==t.local;(this.activeCandidate.closest!==t.closest||o||this.wouldDeleteBlock)&&this.hidePreview()}this.activeCandidate=this.markerConnection=null}hidePreview(){let t;const o=(t=this.activeCandidate)==null?void 0:t.closest;o&&o.targetBlock()&&this.workspace.getRenderer().shouldHighlightConnection(o)&&o.unhighlight(),this.hideReplacementFade(),this.hideInsertionInputOutline(),this.hideInsertionMarker()}showInsertionMarker(t){const{local:o,closest:c}=t;let g=(t=this.lastOnStack&&o===this.lastOnStack)?this.lastMarker:this.firstMarker;if(!g)throw Error("Cannot show the insertion marker because there is no insertion marker block");let $;try{$=g.getMatchingConnection(o.getSourceBlock(),o)}catch{if(t&&this.lastOnStack?(this.disposeInsertionMarker(this.lastMarker),g=this.lastMarker=this.createMarkerBlock(this.lastOnStack.getSourceBlock())):(this.disposeInsertionMarker(this.firstMarker),g=this.firstMarker=this.createMarkerBlock(this.topBlock)),!g)throw Error("Cannot show the insertion marker because there is no insertion marker block");$=g.getMatchingConnection(o.getSourceBlock(),o)}if(!$)throw Error("Cannot show the insertion marker because there is no associated connection");if($===this.markerConnection)throw Error("Made it to showInsertionMarker_ even though the marker isn't changing");g.queueRender(),An(),$.connect(c);const M={x:c.x-$.x,y:c.y-$.y},Q=$.getOffsetInBlock().clone(),be=$;Kt().then(()=>{let nt;(nt=g)==null||nt.positionNearConnection(be,M,Q);let Dt;(Dt=g)==null||Dt.getSvgRoot().setAttribute("visibility","visible")}),this.markerConnection=$}hideInsertionMarker(){if(this.markerConnection){var t=this.markerConnection,o=t.getSourceBlock(),c=o.outputConnection,g;if((g=o.previousConnection)!=null&&g.targetConnection||c!=null&&c.targetConnection)o.unplug(!0);else{let $;($=t.targetBlock())==null||$.unplug(!1)}if(t.targetConnection)throw Error("markerConnection still connected at the end of disconnectInsertionMarker");this.markerConnection=null,(t=o.getSvgRoot())&&t.setAttribute("visibility","hidden")}}showInsertionInputOutline(t){t=t.closest,this.highlightedBlock=t.getSourceBlock(),this.highlightedBlock.highlightShapeForInput(t,!0)}hideInsertionInputOutline(){if(this.highlightedBlock){if(!this.activeCandidate)throw Error("Cannot hide the insertion marker outline because there is no active candidate");this.highlightedBlock.highlightShapeForInput(this.activeCandidate.closest,!1),this.highlightedBlock=null}}showReplacementFade(t){if(this.fadedBlock=t.closest.targetBlock(),!this.fadedBlock)throw Error("Cannot show the replacement fade because the closest connection does not have a target block");this.fadedBlock.fadeForReplacement(!0)}hideReplacementFade(){this.fadedBlock&&(this.fadedBlock.fadeForReplacement(!1),this.fadedBlock=null)}getInsertionMarkers(){const t=[];return this.firstMarker&&t.push(this.firstMarker),this.lastMarker&&t.push(this.lastMarker),t}disposeInsertionMarker(t){if(t){n.disable$$module$build$src$core$events$utils();try{t.dispose()}finally{n.enable$$module$build$src$core$events$utils()}}}};(function(t){t=t.PREVIEW_TYPE||(t.PREVIEW_TYPE={}),t[t.INSERTION_MARKER=0]="INSERTION_MARKER",t[t.INPUT_OUTLINE=1]="INPUT_OUTLINE",t[t.REPLACEMENT_FADE=2]="REPLACEMENT_FADE"})(Oa||(Oa={})),Oa.PREVIEW_TYPE;var Ty=class{constructor(t){this.overrides=null,this.name=t}getClassName(){return this.name+"-renderer"}init(t,o){this.constants_=this.makeConstants_(),o&&(this.overrides=o,Object.assign(this.constants_,o)),this.constants_.setTheme(t),this.constants_.init()}createDom(t,o){this.constants_.createDom(t,this.name+"-"+o.name,"."+this.getClassName()+"."+o.getClassName())}refreshDom(t,o){const c=this.getConstants();c.dispose(),this.constants_=this.makeConstants_(),this.overrides&&Object.assign(this.constants_,this.overrides),this.constants_.randomIdentifier=c.randomIdentifier,this.constants_.setTheme(o),this.constants_.init(),this.createDom(t,o)}dispose(){this.constants_&&this.constants_.dispose()}makeConstants_(){return new gy}makeRenderInfo_(t){return new vv(this,t)}makeDrawer_(t,o){return new _y(t,o)}makeMarkerDrawer(t,o){return new Kb(t,this.getConstants(),o)}makePathObject(t,o){return new vy(t,o,this.constants_)}getConstants(){return this.constants_}shouldHighlightConnection(t){return!0}orphanCanConnectAtEnd(t,o,c){return!!Jn.getConnectionForOrphanedConnection(t,c===Bt.OUTPUT_VALUE?o.outputConnection:o.previousConnection)}getConnectionPreviewMethod(t,o,c){return il("getConnectionPreviewMethod","v10","v12","an IConnectionPreviewer, if it fulfills your use case."),o.type===Bt.OUTPUT_VALUE||o.type===Bt.PREVIOUS_STATEMENT?!t.isConnected()||this.orphanCanConnectAtEnd(c,t.targetBlock(),o.type)?Oa.PREVIEW_TYPE.INSERTION_MARKER:Oa.PREVIEW_TYPE.REPLACEMENT_FADE:Oa.PREVIEW_TYPE.INSERTION_MARKER}render(t){const o=this.makeRenderInfo_(t);o.measure(),this.makeDrawer_(t,o).draw()}},ui={};ui.BottomRow=Gb,ui.Connection=au,ui.ConstantProvider=gy,ui.Drawer=_y,ui.ExternalValueInput=my,ui.Field=Am,ui.Hat=Hb,ui.Icon=f1,ui.InRowSpacer=ea,ui.InlineInput=Vb,ui.InputConnection=Ah,ui.InputRow=zb,ui.JaggedEdge=p1,ui.MarkerSvg=Kb,ui.Measurable=hc,ui.NextConnection=m1,ui.OutputConnection=g1,ui.PathObject=vy,ui.PreviousConnection=_1,ui.RenderInfo=vv,ui.Renderer=Ty,ui.RoundCorner=gv,ui.Row=pv,ui.SpacerRow=Wb,ui.SquareCorner=_v,ui.StatementInput=mv,ui.TopRow=Xb,ui.Types=ke,ui.init=nm,ui.register=ih,ui.unregister=F_;var T1=class{constructor(t,o){this.workspace=t,this.theme=o,this.subscribedWorkspaces_=[],this.componentDB=new Map}getTheme(){return this.theme}setTheme(t){var o=this.theme;this.theme=t,(t=this.workspace.getInjectionDiv())&&(o&&(o=o.getClassName())&&oe(t,o),(o=this.theme.getClassName())&&Me(t,o));for(let c=0,g;g=this.subscribedWorkspaces_[c];c++)g.refreshTheme();for(const[c,g]of this.componentDB)for(const $ of g){t=$.element,o=$.propertyName;const M=this.theme&&this.theme.getComponentStyle(c);t.style.setProperty(o,M||"")}for(const c of this.subscribedWorkspaces_)c.hideChaff()}subscribeWorkspace(t){this.subscribedWorkspaces_.push(t)}unsubscribeWorkspace(t){if(!dt(this.subscribedWorkspaces_,t))throw Error("Cannot unsubscribe a workspace that hasn't been subscribed.")}subscribe(t,o,c){this.componentDB.has(o)||this.componentDB.set(o,[]),this.componentDB.get(o).push({element:t,propertyName:c}),o=this.theme&&this.theme.getComponentStyle(o),t.style.setProperty(c,o||"")}unsubscribe(t){if(t)for(const[o,c]of this.componentDB){for(let g=c.length-1;0<=g;g--)c[g].element===t&&c.splice(g,1);c.length||this.componentDB.delete(o)}}dispose(){this.subscribedWorkspaces_.length=0,this.componentDB.clear()}},Jb="VARIABLE_DYNAMIC",Tf={CATEGORY_NAME:Jb};Tf.flyoutCategory=rh,Tf.flyoutCategoryBlocks=Ud,Tf.onCreateVariableButtonClick_Colour=sm,Tf.onCreateVariableButtonClick_Number=rm,Tf.onCreateVariableButtonClick_String=im;var E1=30,Ef=[];Ef[Bt.INPUT_VALUE]=Bt.OUTPUT_VALUE,Ef[Bt.OUTPUT_VALUE]=Bt.INPUT_VALUE,Ef[Bt.NEXT_STATEMENT]=Bt.PREVIOUS_STATEMENT,Ef[Bt.PREVIOUS_STATEMENT]=Bt.NEXT_STATEMENT;var Zb="RENAME_VARIABLE_ID",qb="DELETE_VARIABLE_ID",y1=class{canConnect(t,o,c,g){return this.canConnectWithReason(t,o,c,g)===Jn.CAN_CONNECT}canConnectWithReason(t,o,c,g){const $=this.doSafetyChecks(t,o);return $!==Jn.CAN_CONNECT?$:this.doTypeChecks(t,o)?c&&!this.doDragChecks(t,o,g||0)?Jn.REASON_DRAG_CHECKS_FAILED:Jn.CAN_CONNECT:Jn.REASON_CHECKS_FAILED}getErrorMessage(t,o,c){switch(t){case Jn.REASON_SELF_CONNECTION:return"Attempted to connect a block to itself.";case Jn.REASON_DIFFERENT_WORKSPACES:return"Blocks not on same workspace.";case Jn.REASON_WRONG_TYPE:return"Attempt to connect incompatible types.";case Jn.REASON_TARGET_NULL:return"Target connection is null.";case Jn.REASON_CHECKS_FAILED:return"Connection checks failed. "+(o+" expected "+o.getCheck()+", found "+c.getCheck());case Jn.REASON_SHADOW_PARENT:return"Connecting non-shadow to shadow block.";case Jn.REASON_DRAG_CHECKS_FAILED:return"Drag checks failed.";case Jn.REASON_PREVIOUS_AND_OUTPUT:return"Block would have an output and a previous connection.";default:return"Unknown connection failure: this should never happen!"}}doSafetyChecks(t,o){if(!t||!o)return Jn.REASON_TARGET_NULL;let c,g,$;return t.isSuperior()?(c=t.getSourceBlock(),g=o.getSourceBlock(),$=o):(g=t.getSourceBlock(),c=o.getSourceBlock(),$=t,t=o),c===g?Jn.REASON_SELF_CONNECTION:$.type!==Ef[t.type]?Jn.REASON_WRONG_TYPE:c.workspace!==g.workspace?Jn.REASON_DIFFERENT_WORKSPACES:c.isShadow()&&!g.isShadow()?Jn.REASON_SHADOW_PARENT:$.type===Bt.OUTPUT_VALUE&&g.previousConnection&&g.previousConnection.isConnected()||$.type===Bt.PREVIOUS_STATEMENT&&g.outputConnection&&g.outputConnection.isConnected()?Jn.REASON_PREVIOUS_AND_OUTPUT:Jn.CAN_CONNECT}doTypeChecks(t,o){if(t=t.getCheck(),o=o.getCheck(),!t||!o)return!0;for(let c=0;c<t.length;c++)if(o.includes(t[c]))return!0;return!1}doDragChecks(t,o,c){if(t.distanceFrom(o)>c||o.getSourceBlock().isInsertionMarker())return!1;switch(o.type){case Bt.PREVIOUS_STATEMENT:return this.canConnectToPrevious_(t,o);case Bt.OUTPUT_VALUE:if(o.isConnected()&&!o.targetBlock().isInsertionMarker()||t.isConnected())return!1;break;case Bt.INPUT_VALUE:if(o.isConnected()&&!o.targetBlock().isMovable()&&!o.targetBlock().isShadow())return!1;break;case Bt.NEXT_STATEMENT:if(o.isConnected()&&!t.getSourceBlock().nextConnection&&!o.targetBlock().isShadow()&&o.targetBlock().nextConnection||o.targetBlock()&&!o.targetBlock().isMovable()&&!o.targetBlock().isShadow())return!1;break;default:return!1}return!V.includes(o)}canConnectToPrevious_(t,o){return t.targetConnection||V.includes(o)?!1:o.targetConnection?(t=o.targetBlock(),t.isInsertionMarker()?!t.getPreviousBlock():!1):!0}};r(yt.CONNECTION_CHECKER,yo,y1);var Qb=class extends nv{constructor(t){super(t),this.type=Jc,t&&(this.varType=t.type,this.varName=t.name)}toJson(){const t=super.toJson();if(this.varType===void 0)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");return t.varType=this.varType,t.varName=this.varName,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new Qb),o.varType=t.varType,o.varName=t.varName,o}run(t){const o=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");t?o.deleteVariableById(this.varId):o.createVariable(this.varName,this.varType,this.varId)}};r(yt.EVENT,Jc,Qb);var eA=class extends nv{constructor(t,o){super(t),this.type=mh,t&&(this.oldName=t.name,this.newName=typeof o>"u"?"":o)}toJson(){const t=super.toJson();if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.newName)throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson");return t.oldName=this.oldName,t.newName=this.newName,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new eA),o.oldName=t.oldName,o.newName=t.newName,o}run(t){const o=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.newName)throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson");t?o.renameVariableById(this.varId,this.newName):o.renameVariableById(this.varId,this.oldName)}};r(yt.EVENT,mh,eA);var tA=class{constructor(t){this.workspace=t,this.variableMap=new Map}clear(){for(const t of this.variableMap.values())for(;0<t.length;)this.deleteVariable(t[0]);if(this.variableMap.size!==0)throw Error("Non-empty variable map")}renameVariable(t,o){if(t.name!==o){var c=this.getVariable(o,t.type),g=this.workspace.getAllBlocks(!1),$=n.getGroup$$module$build$src$core$events$utils();$||n.setGroup$$module$build$src$core$events$utils(!0);try{c&&c.getId()!==t.getId()?this.renameVariableWithConflict_(t,o,c,g):this.renameVariableAndUses_(t,o,g)}finally{n.setGroup$$module$build$src$core$events$utils($)}}}renameVariableById(t,o){const c=this.getVariableById(t);if(!c)throw Error("Tried to rename a variable that didn't exist. ID: "+t);this.renameVariable(c,o)}renameVariableAndUses_(t,o,c){for(b(new(k(mh))(t,o)),t.name=o,o=0;o<c.length;o++)c[o].updateVarName(t)}renameVariableWithConflict_(t,o,c,g){const $=t.type;for(o!==c.name&&this.renameVariableAndUses_(c,o,g),o=0;o<g.length;o++)g[o].renameVarById(t.getId(),c.getId());b(new(k(Jc))(t)),dt(this.variableMap.get($),t)}createVariable(t,o,c){var g=this.getVariable(t,o);if(g){if(c&&g.getId()!==c)throw Error('Variable "'+t+'" is already in use and its id is "'+g.getId()+'" which conflicts with the passed in id, "'+c+'".');return g}if(c&&this.getVariableById(c))throw Error('Variable id, "'+c+'", is already in use.');return g=c||T(),o=o||"",g=new iv(this.workspace,t,o,g),t=this.variableMap.get(o)||[],t.push(g),this.variableMap.delete(o),this.variableMap.set(o,t),b(new(k(ba))(g)),g}deleteVariable(t){const o=t.getId(),c=this.variableMap.get(t.type);if(c){for(let g=0;g<c.length;g++)if(c[g].getId()===o){c.splice(g,1),b(new(k(Jc))(t)),c.length===0&&this.variableMap.delete(t.type);break}}}deleteVariableById(t){const o=this.getVariableById(t);if(o){var c=o.name;const g=this.getVariableUsesById(t);for(let $=0,M;M=g[$];$++)if(M.type==="procedures_defnoreturn"||M.type==="procedures_defreturn"){t=String(M.getFieldValue("NAME")),c=n.Msg$$module$build$src$core$msg.CANNOT_DELETE_VARIABLE_PROCEDURE.replace("%1",c).replace("%2",t),Se(c);return}1<g.length?(c=n.Msg$$module$build$src$core$msg.DELETE_VARIABLE_CONFIRMATION.replace("%1",String(g.length)).replace("%2",c),Je(c,$=>{$&&o&&this.deleteVariableInternal(o,g)})):this.deleteVariableInternal(o,g)}else console.warn("Can't delete non-existent variable: "+t)}deleteVariableInternal(t,o){const c=n.getGroup$$module$build$src$core$events$utils();c||n.setGroup$$module$build$src$core$events$utils(!0);try{for(let g=0;g<o.length;g++)o[g].dispose(!0);this.deleteVariable(t)}finally{n.setGroup$$module$build$src$core$events$utils(c)}}getVariable(t,o){if(o=this.variableMap.get(o||"")){for(let c=0,g;g=o[c];c++)if(n.Names$$module$build$src$core$names.equals(g.name,t))return g}return null}getVariableById(t){for(const o of this.variableMap.values())for(const c of o)if(c.getId()===t)return c;return null}getVariablesOfType(t){return(t=this.variableMap.get(t||""))?t.slice():[]}getVariableTypes(t){const o=new Set(this.variableMap.keys());if(t&&t.getPotentialVariableMap())for(const c of t.getPotentialVariableMap().variableMap.keys())o.add(c);return o.has("")||o.add(""),Array.from(o.values())}getAllVariables(){let t=[];for(const o of this.variableMap.values())t=t.concat(o);return t}getAllVariableNames(){return Array.from(this.variableMap.values()).flat().map(t=>t.name)}getVariableUsesById(t){const o=[],c=this.workspace.getAllBlocks(!1);for(let g=0;g<c.length;g++){const $=c[g].getVarModels();if($)for(let M=0;M<$.length;M++)$[M].getId()===t&&o.push(c[g])}return o}},xm=class{get isFlyout(){return this.internalIsFlyout}get isMutator(){return this.internalIsMutator}constructor(t){this.isClearing=this.internalIsMutator=this.internalIsFlyout=this.rendered=!1,this.MAX_UNDO=1024,this.connectionDBList=[],this.topBlocks=[],this.topComments=[],this.commentDB=new Map,this.listeners=[],this.undoStack_=[],this.redoStack_=[],this.blockDB=new Map,this.typedBlocksDB=new Map,this.procedureMap=new i1,this.potentialVariableMap=null,this.id=T(),ie(this),this.options=t||new Ma({}),this.RTL=!!this.options.RTL,this.horizontalLayout=!!this.options.horizontalLayout,this.toolboxPosition=this.options.toolboxPosition,this.connectionChecker=new(p(yt.CONNECTION_CHECKER,this.options,!0))(this),this.variableMap=new tA(this)}dispose(){this.listeners.length=0,this.clear(),ae(this)}sortObjects_(t,o){const c=Math.sin(Oe(xm.SCAN_ANGLE))*(this.RTL?-1:1);return t=t.getRelativeToSurfaceXY(),o=o.getRelativeToSurfaceXY(),t.y+c*t.x-(o.y+c*o.x)}addTopBlock(t){this.topBlocks.push(t)}removeTopBlock(t){if(!dt(this.topBlocks,t))throw Error("Block not present in workspace's list of top-most blocks.")}getTopBlocks(t=!1){const o=[].concat(this.topBlocks);return t&&1<o.length&&o.sort(this.sortObjects_.bind(this)),o}addTypedBlock(t){this.typedBlocksDB.has(t.type)||this.typedBlocksDB.set(t.type,[]),this.typedBlocksDB.get(t.type).push(t)}removeTypedBlock(t){dt(this.typedBlocksDB.get(t.type),t),this.typedBlocksDB.get(t.type).length||this.typedBlocksDB.delete(t.type)}getBlocksByType(t,o=!1){return this.typedBlocksDB.has(t)?(t=this.typedBlocksDB.get(t).slice(0),o&&t&&1<t.length&&t.sort(this.sortObjects_.bind(this)),t.filter(function(c){return!c.isInsertionMarker()})):[]}addTopComment(t){this.topComments.push(t),this.commentDB.has(t.id)&&console.warn('Overriding an existing comment on this workspace, with id "'+t.id+'"'),this.commentDB.set(t.id,t)}removeTopComment(t){if(!dt(this.topComments,t))throw Error("Comment not present in workspace's list of top-most comments.");this.commentDB.delete(t.id)}getTopComments(t=!1){const o=[].concat(this.topComments);return t&&1<o.length&&o.sort(this.sortObjects_.bind(this)),o}getAllBlocks(t=!1){if(t){var o=this.getTopBlocks(!0);t=[];for(let c=0;c<o.length;c++)t.push(...o[c].getDescendants(!0))}else for(t=this.getTopBlocks(!1),o=0;o<t.length;o++)t.push(...t[o].getChildren(!1));return t.filter(function(c){return!c.isInsertionMarker()})}clear(){this.isClearing=!0;try{const t=n.getGroup$$module$build$src$core$events$utils();for(t||n.setGroup$$module$build$src$core$events$utils(!0);this.topBlocks.length;)this.topBlocks[0].dispose(!1);for(;this.topComments.length;)this.topComments[this.topComments.length-1].dispose();n.setGroup$$module$build$src$core$events$utils(t),this.variableMap.clear(),this.potentialVariableMap&&this.potentialVariableMap.clear()}finally{this.isClearing=!1}}renameVariableById(t,o){this.variableMap.renameVariableById(t,o)}createVariable(t,o,c){return this.variableMap.createVariable(t,o,c)}getVariableUsesById(t){return this.variableMap.getVariableUsesById(t)}deleteVariableById(t){this.variableMap.deleteVariableById(t)}getVariable(t,o){return this.variableMap.getVariable(t,o)}getVariableById(t){return this.variableMap.getVariableById(t)}getVariablesOfType(t){return this.variableMap.getVariablesOfType(t)}getVariableTypes(){return this.variableMap.getVariableTypes(this)}getAllVariables(){return this.variableMap.getAllVariables()}getAllVariableNames(){return this.variableMap.getAllVariableNames()}getWidth(){return 0}newBlock(t,o){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}newComment(t){throw Error("The implementation of newComment should be monkey-patched in by blockly.ts")}remainingCapacity(){return isNaN(this.options.maxBlocks)?1/0:this.options.maxBlocks-this.getAllBlocks(!1).length}remainingCapacityOfType(t){return this.options.maxInstances?(this.options.maxInstances[t]!==void 0?this.options.maxInstances[t]:1/0)-this.getBlocksByType(t,!1).length:1/0}isCapacityAvailable(t){if(!this.hasBlockLimits())return!0;let o=0;for(const c in t){if(t[c]>this.remainingCapacityOfType(c))return!1;o+=t[c]}return!(o>this.remainingCapacity())}hasBlockLimits(){return this.options.maxBlocks!==1/0||!!this.options.maxInstances}getUndoStack(){return this.undoStack_}getRedoStack(){return this.redoStack_}undo(t){var o=t?this.redoStack_:this.undoStack_,c=t?this.undoStack_:this.redoStack_;const g=o.pop();if(g){for(var $=[g];o.length&&g.group&&g.group===o[o.length-1].group;){const M=o.pop();M&&$.push(M)}for(o=0;o<$.length;o++)c.push($[o]);$=A($,t),n.setRecordUndo$$module$build$src$core$events$utils(!1);try{for(c=0;c<$.length;c++)$[c].run(t)}finally{n.setRecordUndo$$module$build$src$core$events$utils(!0)}}}clearUndo(){this.undoStack_.length=0,this.redoStack_.length=0,C()}addChangeListener(t){return this.listeners.push(t),t}removeChangeListener(t){dt(this.listeners,t)}fireChangeListener(t){if(t.recordUndo)for(this.undoStack_.push(t),this.redoStack_.length=0;this.undoStack_.length>this.MAX_UNDO&&0<=this.MAX_UNDO;)this.undoStack_.shift();for(let o=0;o<this.listeners.length;o++)(0,this.listeners[o])(t)}getBlockById(t){return this.blockDB.get(t)||null}setBlockById(t,o){this.blockDB.set(t,o)}removeBlockById(t){this.blockDB.delete(t)}getCommentById(t){let o;return(o=this.commentDB.get(t))!=null?o:null}allInputsFilled(t){const o=this.getTopBlocks(!1);for(let c=0;c<o.length;c++)if(!o[c].allInputsFilled(t))return!1;return!0}getPotentialVariableMap(){return this.potentialVariableMap}createPotentialVariableMap(){this.potentialVariableMap=new tA(this)}getVariableMap(){return this.variableMap}setVariableMap(t){this.variableMap=t}getProcedureMap(){return this.procedureMap}getRootWorkspace(){let t=null;const o=this.options.parentWorkspace;return this.isFlyout?o&&o.options&&(t=o.options.parentWorkspace):o&&(t=o),t}static getById(t){return U(t)}static getAll(){return ce()}};xm.SCAN_ANGLE=3;var EG=100,S1=class{constructor(t){this.parentWorkspace=t,this.sounds=new Map,this.lastSound_=null,this.muted=!1}dispose(){this.sounds.clear()}load(t,o){if(t.length){try{var c=new globalThis.Audio}catch{return}for(let $=0;$<t.length;$++){const M=t[$],Q=M.match(/\.(\w+)$/);if(Q&&c.canPlayType("audio/"+Q[1])){var g=new globalThis.Audio(M);break}}g&&this.sounds.set(o,g)}}preload(){for(const t of this.sounds.values()){t.volume=.01;const o=t.play();if(o!==void 0?o.then(t.pause).catch(function(){}):t.pause(),Z_||gI)break}}play(t,o){if(!this.muted){var c=this.sounds.get(t);c?(t=new Date,this.lastSound_!==null&&t.getTime()-this.lastSound_.getTime()<EG||(this.lastSound_=t,c=Z_||eb?c:c.cloneNode(),c.volume=o===void 0?1:o,c.play())):this.parentWorkspace&&this.parentWorkspace.getAudioManager().play(t,o)}}setMuted(t){this.muted=t}getMuted(){return this.muted}},yG=class{constructor(t){this.workspace=t,this.layers=new Map,(t=t.getInjectionDiv())&&(this.dragLayer=this.createDragLayer(t),this.animationLayer=this.createAnimationLayer(t)),t=this.createLayer(fm),Me(t,"blocklyBlockCanvas"),t=this.createLayer(mb),Me(t,"blocklyBubbleCanvas")}createDragLayer(t){const o=Ce(Ve.SVG,{class:"blocklyBlockDragSurface",xmlns:q_,"xmlns:html":cc,"xmlns:xlink":Zo,version:"1.1"});return t.append(o),Ce(Ve.G,{},o)}createAnimationLayer(t){const o=Ce(Ve.SVG,{class:"blocklyAnimationLayer",xmlns:q_,"xmlns:html":cc,"xmlns:xlink":Zo,version:"1.1"});return t.append(o),Ce(Ve.G,{},o)}appendToAnimationLayer(t){let o;const c=(o=this.dragLayer)==null?void 0:o.getAttribute("transform");if(c){let $;($=this.animationLayer)==null||$.setAttribute("transform",c)}let g;(g=this.animationLayer)==null||g.appendChild(t.getSvgRoot())}translateLayers(t,o){t=`translate(${t.x}, ${t.y}) scale(${o})`;let c;(c=this.dragLayer)==null||c.setAttribute("transform",t);for(const[,g]of this.layers)g.setAttribute("transform",t)}moveToDragLayer(t){let o;(o=this.dragLayer)==null||o.appendChild(t.getSvgRoot())}moveOffDragLayer(t,o){this.append(t,o)}append(t,o){this.layers.has(o)||this.createLayer(o);let c;(c=this.layers.get(o))==null||c.appendChild(t.getSvgRoot())}createLayer(t){const o=this.workspace.getSvgGroup(),c=Ce(Ve.G,{});let g=!1;const $=[...this.layers].sort((M,Q)=>M[0]-Q[0]);for(const[M,Q]of $)if(t<M){o.insertBefore(c,Q),g=!0;break}return g||o.appendChild(c),this.layers.set(t,c),c}hasLayer(t){return t===this.dragLayer||new Set(this.layers.values()).has(t)}getBlockLayer(){return this.layers.get(fm)}getBubbleLayer(){return this.layers.get(mb)}},SG=20,La=class extends xm{constructor(t){super(t),this.resizeHandlerWrapper=null,this.resizesEnabled=this.isVisible_=this.rendered=!0,this.startScrollY=this.startScrollX=this.scrollY=this.scrollX=0,this.dragDeltaXY=null,this.oldScale=this.scale=1,this.oldLeft=this.oldTop=0,this.inverseScreenCTM=this.targetWorkspace=this.dummyWheelListener=this.configureContextMenu=this.lastRecordedPageScroll=this.injectionDiv=this.currentGesture_=this.toolbox_=this.flyout=this.scrollbar=this.trashcan=null,this.inverseScreenCTMDirty=!0,this.highlightedBlocks=[],this.toolboxCategoryCallbacks=new Map,this.flyoutButtonCallbacks=new Map,this.cachedParentSvg=null,this.keyboardAccessibilityMode=!1,this.topBoundedElements=[],this.dragTargetAreas=[],this.zoomControls_=this.layerManager=null,this.metricsManager=new(p(yt.METRICS_MANAGER,t,!0))(this),this.getMetrics=t.getMetrics||this.metricsManager.getMetrics.bind(this.metricsManager),this.setMetrics=t.setMetrics||La.setTopLevelWorkspaceMetrics_,this.componentManager=new Vr,this.connectionDBList=$m.init(this.connectionChecker),this.audioManager=new S1(t.parentWorkspace),this.grid=this.options.gridPattern?new Pb(this.options.gridPattern,t.gridOptions):null,this.markerManager=new lv(this),gs&&Ht&&this.registerToolboxCategoryCallback(ub,Ht),Tf&&rh&&this.registerToolboxCategoryCallback(Jb,rh),io&&Bd&&(this.registerToolboxCategoryCallback(py,Bd),this.addChangeListener(D_)),this.themeManager_=this.options.parentWorkspace?this.options.parentWorkspace.getThemeManager():new T1(this,this.options.theme||cy),this.themeManager_.subscribeWorkspace(this);let o;this.renderer=nm(this.options.renderer||"geras",this.getTheme(),(o=this.options.rendererOverrides)!=null?o:void 0),this.cachedParentSvgSize=new Kn(0,0)}getMarkerManager(){return this.markerManager}getMetricsManager(){return this.metricsManager}setMetricsManager(t){this.metricsManager=t,this.getMetrics=this.metricsManager.getMetrics.bind(this.metricsManager)}getComponentManager(){return this.componentManager}setCursorSvg(t){this.markerManager.setCursorSvg(t)}setMarkerSvg(t){this.markerManager.setMarkerSvg(t)}getMarker(t){return this.markerManager?this.markerManager.getMarker(t):null}getCursor(){return this.markerManager?this.markerManager.getCursor():null}getRenderer(){return this.renderer}getThemeManager(){return this.themeManager_}getTheme(){return this.themeManager_.getTheme()}setTheme(t){t||(t=cy),this.themeManager_.setTheme(t)}refreshTheme(){this.svgGroup_&&this.renderer.refreshDom(this.svgGroup_,this.getTheme()),this.updateBlockStyles_(this.getAllBlocks(!1).filter(function(o){return!!o.getStyleName()})),this.refreshToolboxSelection(),this.toolbox_&&this.toolbox_.refreshTheme(),this.isVisible()&&this.setVisible(!0);const t=new(k(So))(this.getTheme().name,this.id);b(t)}updateBlockStyles_(t){for(let o=0,c;c=t[o];o++){const g=c.getStyleName();g&&c.setStyle(g)}}getInverseScreenCTM(){if(this.inverseScreenCTMDirty){const t=this.getParentSvg().getScreenCTM();t&&(this.inverseScreenCTM=t.inverse(),this.inverseScreenCTMDirty=!1)}return this.inverseScreenCTM}updateInverseScreenCTM(){this.inverseScreenCTMDirty=!0}isVisible(){return this.isVisible_}getSvgXY(t){let o=0,c=0,g=1;(this.getCanvas().contains(t)||this.getBubbleCanvas().contains(t))&&(g=this.scale);do{const $=j(t);(t===this.getCanvas()||t===this.getBubbleCanvas())&&(g=1),o+=$.x*g,c+=$.y*g,t=t.parentNode}while(t&&t!==this.getParentSvg()&&t!==this.getInjectionDiv());return new At(o,c)}getCachedParentSvgSize(){const t=this.cachedParentSvgSize;return new Kn(t.width,t.height)}getOriginOffsetInPixels(){return ge(this.getCanvas())}getInjectionDiv(){if(!this.injectionDiv){let t=this.svgGroup_;for(;t;){if((" "+(t.getAttribute("class")||"")+" ").includes(" injectionDiv ")){this.injectionDiv=t;break}t=t.parentNode}}return this.injectionDiv}getSvgGroup(){return this.svgGroup_}getBlockCanvas(){return this.getCanvas()}setResizeHandlerWrapper(t){this.resizeHandlerWrapper=t}createDom(t,o){return this.injectionDiv||(this.injectionDiv=o??null),this.svgGroup_=Ce(Ve.G,{class:"blocklyWorkspace"}),t&&(this.svgBackground_=Ce(Ve.RECT,{height:"100%",width:"100%",class:t},this.svgGroup_),t==="blocklyMainBackground"&&this.grid?this.svgBackground_.style.fill="url(#"+this.grid.getPatternId()+")":this.themeManager_.subscribe(this.svgBackground_,"workspaceBackgroundColour","fill")),this.layerManager=new yG(this),this.svgBlockCanvas_=this.layerManager.getBlockLayer(),this.svgBubbleCanvas_=this.layerManager.getBubbleLayer(),this.isFlyout||(Ue(this.svgGroup_,"pointerdown",this,this.onMouseDown_,!1),this.dummyWheelListener=()=>{},document.body.addEventListener("wheel",this.dummyWheelListener),Ue(this.svgGroup_,"wheel",this,this.onMouseWheel_)),this.options.hasCategories&&(this.toolbox_=new(p(yt.TOOLBOX,this.options,!0))(this)),this.grid&&this.grid.update(this.scale),this.recordDragTargets(),(t=p(yt.CURSOR,this.options))&&this.markerManager.setCursor(new t),this.renderer.createDom(this.svgGroup_,this.getTheme()),this.svgGroup_}dispose(){if(this.rendered=!1,this.currentGesture_&&this.currentGesture_.cancel(),this.svgGroup_&&W(this.svgGroup_),this.toolbox_&&(this.toolbox_.dispose(),this.toolbox_=null),this.flyout&&(this.flyout.dispose(),this.flyout=null),this.trashcan&&(this.trashcan.dispose(),this.trashcan=null),this.scrollbar&&(this.scrollbar.dispose(),this.scrollbar=null),this.zoomControls_&&this.zoomControls_.dispose(),this.audioManager&&this.audioManager.dispose(),this.grid&&(this.grid=null),this.renderer.dispose(),this.markerManager&&this.markerManager.dispose(),super.dispose(),this.themeManager_&&(this.themeManager_.unsubscribeWorkspace(this),this.themeManager_.unsubscribe(this.svgBackground_),this.options.parentWorkspace||this.themeManager_.dispose()),this.connectionDBList.length=0,this.toolboxCategoryCallbacks.clear(),this.flyoutButtonCallbacks.clear(),!this.options.parentWorkspace){const t=this.getParentSvg();t&&t.parentNode&&W(t.parentNode)}this.resizeHandlerWrapper&&(re(this.resizeHandlerWrapper),this.resizeHandlerWrapper=null),this.dummyWheelListener&&(document.body.removeEventListener("wheel",this.dummyWheelListener),this.dummyWheelListener=null)}addTrashcan(){this.trashcan=La.newTrashcan(this);const t=this.trashcan.createDom();this.svgGroup_.insertBefore(t,this.getCanvas())}static newTrashcan(t){throw Error("The implementation of newTrashcan should be monkey-patched in by blockly.ts")}addZoomControls(){this.zoomControls_=new xI(this);const t=this.zoomControls_.createDom();this.svgGroup_.appendChild(t)}addFlyout(t){const o=new Ma({parentWorkspace:this,rtl:this.RTL,oneBasedIndex:this.options.oneBasedIndex,horizontalLayout:this.horizontalLayout,renderer:this.options.renderer,rendererOverrides:this.options.rendererOverrides,move:{scrollbars:!0}});return o.toolboxPosition=this.options.toolboxPosition,this.flyout=this.horizontalLayout?new(p(yt.FLYOUTS_HORIZONTAL_TOOLBOX,this.options,!0))(o):new(p(yt.FLYOUTS_VERTICAL_TOOLBOX,this.options,!0))(o),this.flyout.autoClose=!1,this.flyout.getWorkspace().setVisible(!0),this.flyout.createDom(t)}getFlyout(t){return this.flyout||t?this.flyout:this.toolbox_?this.toolbox_.getFlyout():null}getToolbox(){return this.toolbox_}updateScreenCalculations_(){this.updateInverseScreenCTM(),this.recordDragTargets()}resizeContents(){this.resizesEnabled&&this.rendered&&(this.scrollbar&&this.scrollbar.resize(),this.updateInverseScreenCTM())}resize(){this.toolbox_&&this.toolbox_.position(),this.flyout&&this.flyout.position();const t=this.componentManager.getComponents(Vr.Capability.POSITIONABLE,!0),o=this.getMetricsManager().getUiMetrics(),c=[];for(let g=0,$;$=t[g];g++){$.position(o,c);const M=$.getBoundingRectangle();M&&c.push(M)}this.scrollbar&&this.scrollbar.resize(),this.updateScreenCalculations_()}updateScreenCalculationsIfScrolled(){const t=We();At.equals(this.lastRecordedPageScroll,t)||(this.lastRecordedPageScroll=t,this.updateScreenCalculations_())}getLayerManager(){return this.layerManager}getCanvas(){return this.layerManager.getBlockLayer()}setCachedParentSvgSize(t,o){const c=this.getParentSvg();t!=null&&(this.cachedParentSvgSize.width=t,c.setAttribute("data-cached-width",`${t}`)),o!=null&&(this.cachedParentSvgSize.height=o,c.setAttribute("data-cached-height",`${o}`))}getBubbleCanvas(){return this.layerManager.getBubbleLayer()}getParentSvg(){if(!this.cachedParentSvg){let t=this.svgGroup_;for(;t;){if(t.tagName==="svg"){this.cachedParentSvg=t;break}t=t.parentNode}}return this.cachedParentSvg}maybeFireViewportChangeEvent(){if(R()){var t=this.scale,o=-this.scrollY,c=-this.scrollX;if(!(t===this.oldScale&&1>Math.abs(o-this.oldTop)&&1>Math.abs(c-this.oldLeft))){var g=new(k(Ko))(o,c,t,this.id,this.oldScale);this.oldScale=t,this.oldTop=o,this.oldLeft=c,b(g)}}}translate(t,o){let c;(c=this.layerManager)==null||c.translateLayers(new At(t,o),this.scale);let g;(g=this.grid)==null||g.moveTo(t,o),this.maybeFireViewportChangeEvent()}getWidth(){const t=this.getMetrics();return t?t.viewWidth/this.scale:0}setVisible(t){this.isVisible_=t,this.svgGroup_&&(this.scrollbar&&this.scrollbar.setContainerVisible(t),this.getFlyout()&&this.getFlyout().setContainerVisible(t),this.getParentSvg().style.display=t?"block":"none",this.toolbox_&&this.toolbox_.setVisible(t),t||this.hideChaff(!0))}render(){const t=this.getAllBlocks(!1);for(let o=t.length-1;0<=o;o--)t[o].queueRender();this.getTopBlocks().flatMap(o=>o.getDescendants(!1)).filter(o=>o.isInsertionMarker()).forEach(o=>o.queueRender()),Kt().then(()=>void this.markerManager.updateMarkers())}highlightBlock(t,o){if(o===void 0){for(let c=0,g;g=this.highlightedBlocks[c];c++)g.setHighlighted(!1);this.highlightedBlocks.length=0}(t=t?this.getBlockById(t):null)&&((o=o===void 0||o)?this.highlightedBlocks.includes(t)||this.highlightedBlocks.push(t):dt(this.highlightedBlocks,t),t.setHighlighted(o))}refreshToolboxSelection(){const t=this.isFlyout?this.targetWorkspace:this;t&&!t.currentGesture_&&t.toolbox_&&t.toolbox_.getFlyout()&&t.toolbox_.refreshSelection()}renameVariableById(t,o){super.renameVariableById(t,o),this.refreshToolboxSelection()}deleteVariableById(t){super.deleteVariableById(t),this.refreshToolboxSelection()}createVariable(t,o,c){return t=super.createVariable(t,o,c),this.refreshToolboxSelection(),t}recordDragTargets(){const t=this.componentManager.getComponents(Vr.Capability.DRAG_TARGET,!0);this.dragTargetAreas=[];for(let o=0,c;c=t[o];o++){const g=c.getClientRect();g&&this.dragTargetAreas.push({component:c,clientRect:g})}}newBlock(t,o){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}newComment(t){throw Error("The implementation of newComment should be monkey-patched in by blockly.ts")}getDragTarget(t){for(let o=0,c;c=this.dragTargetAreas[o];o++)if(c.clientRect.contains(t.clientX,t.clientY))return c.component;return null}onMouseDown_(t){const o=this.getGesture(t);o&&o.handleWsStart(t,this)}startDrag(t,o){t=Ze(t,this.getParentSvg(),this.getInverseScreenCTM()),t.x/=this.scale,t.y/=this.scale,this.dragDeltaXY=At.difference(o,t)}moveDrag(t){return t=Ze(t,this.getParentSvg(),this.getInverseScreenCTM()),t.x/=this.scale,t.y/=this.scale,At.sum(this.dragDeltaXY,t)}isDragging(){return this.currentGesture_!==null&&this.currentGesture_.isDragging()}isDraggable(){return this.options.moveOptions&&this.options.moveOptions.drag}isMovable(){return this.options.moveOptions&&!!this.options.moveOptions.scrollbars||this.options.moveOptions&&this.options.moveOptions.wheel||this.options.moveOptions&&this.options.moveOptions.drag||this.options.zoomOptions&&this.options.zoomOptions.wheel||this.options.zoomOptions&&this.options.zoomOptions.pinch}isMovableHorizontally(){const t=!!this.scrollbar;return this.isMovable()&&(!t||t&&this.scrollbar.canScrollHorizontally())}isMovableVertically(){const t=!!this.scrollbar;return this.isMovable()&&(!t||t&&this.scrollbar.canScrollVertically())}onMouseWheel_(t){if(nu.inProgress())t.preventDefault(),t.stopPropagation();else{var o=this.options.zoomOptions&&this.options.zoomOptions.wheel,c=this.options.moveOptions&&this.options.moveOptions.wheel;if(o||c){var g=Xe(t);if(tb)var $=t.metaKey;o&&(t.ctrlKey||$||!c)?(g=-g.y/50,o=Ze(t,this.getParentSvg(),this.getInverseScreenCTM()),this.zoom(o.x,o.y,g)):(o=this.scrollX-g.x,c=this.scrollY-g.y,t.shiftKey&&!g.x&&(o=this.scrollX-g.y,c=this.scrollY),this.scroll(o,c)),t.preventDefault()}}}getBlocksBoundingBox(){const t=this.getTopBoundedElements();if(!t.length)return new $i(0,0,0,0);const o=t[0].getBoundingRectangle();for(let g=1;g<t.length;g++){var c=t[g];c.isInsertionMarker&&c.isInsertionMarker()||(c=c.getBoundingRectangle(),c.top<o.top&&(o.top=c.top),c.bottom>o.bottom&&(o.bottom=c.bottom),c.left<o.left&&(o.left=c.left),c.right>o.right&&(o.right=c.right))}return o}cleanUp(){this.setResizesEnabled(!1),n.setGroup$$module$build$src$core$events$utils(!0);const t=this.getTopBlocks(!0);let o=0;for(let c=0,g;g=t[c];c++){if(!g.isMovable())continue;const $=g.getRelativeToSurfaceXY();g.moveBy(-$.x,o-$.y,["cleanup"]),g.snapToGrid(),o=g.getRelativeToSurfaceXY().y+g.getHeightWidth().height+this.renderer.getConstants().MIN_BLOCK_HEIGHT}n.setGroup$$module$build$src$core$events$utils(!1),this.setResizesEnabled(!0)}showContextMenu(t){if(!this.options.readOnly&&!this.isFlyout){var o=wn.registry.getContextMenuOptions(wn.ScopeType.WORKSPACE,{workspace:this});this.configureContextMenu&&this.configureContextMenu(o,t),Bc(t,o,this.RTL,this)}}updateToolbox(t){if(t=pi(t)){if(!this.options.languageTree)throw Error("Existing toolbox is null.  Can't create new toolbox.");if(vi(t)){if(!this.toolbox_)throw Error("Existing toolbox has no categories.  Can't change mode.");this.options.languageTree=t,this.toolbox_.render(t)}else{if(!this.flyout)throw Error("Existing toolbox has categories.  Can't change mode.");this.options.languageTree=t,this.flyout.show(t)}}else if(this.options.languageTree)throw Error("Can't nullify an existing toolbox.")}markFocused(){this.options.parentWorkspace?this.options.parentWorkspace.markFocused():(pe(this),this.getParentSvg().focus({preventScroll:!0}))}zoom(t,o,c){c=Math.pow(this.options.zoomOptions.scaleSpeed,c);const g=this.scale*c;if(this.scale!==g){g>this.options.zoomOptions.maxScale?c=this.options.zoomOptions.maxScale/this.scale:g<this.options.zoomOptions.minScale&&(c=this.options.zoomOptions.minScale/this.scale);var $=this.getCanvas().getCTM(),M=this.getParentSvg().createSVGPoint();M.x=t,M.y=o,M=M.matrixTransform($.inverse()),t=M.x,o=M.y,$=$.translate(t*(1-c),o*(1-c)).scale(c),this.scrollX=$.e,this.scrollY=$.f,this.setScale(g)}}zoomCenter(t){var o=this.getMetrics();let c;this.flyout?(c=o.svgWidth?o.svgWidth/2:0,o=o.svgHeight?o.svgHeight/2:0):(c=o.viewWidth/2+o.absoluteLeft,o=o.viewHeight/2+o.absoluteTop),this.zoom(c,o,t)}zoomToFit(){if(this.isMovable()){var t=this.getMetrics(),o=t.viewWidth;t=t.viewHeight;var c=this.getBlocksBoundingBox(),g=2*SG,$=c.right-c.left+g;if(c=c.bottom-c.top+g,$){this.flyout&&(this.horizontalLayout?(t+=this.flyout.getHeight(),c+=this.flyout.getHeight()/this.scale):(o+=this.flyout.getWidth(),$+=this.flyout.getWidth()/this.scale)),o/=$,t/=c,n.disable$$module$build$src$core$events$utils();try{this.setScale(Math.min(o,t)),this.scrollCenter()}finally{n.enable$$module$build$src$core$events$utils()}this.maybeFireViewportChangeEvent()}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}beginCanvasTransition(){Me(this.getCanvas(),"blocklyCanvasTransitioning"),Me(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}endCanvasTransition(){oe(this.getCanvas(),"blocklyCanvasTransitioning"),oe(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}scrollCenter(){if(this.isMovable()){var t=this.getMetrics(),o=(t.scrollWidth-t.viewWidth)/2,c=(t.scrollHeight-t.viewHeight)/2;o=-o-t.scrollLeft,c=-c-t.scrollTop,this.scroll(o,c)}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}centerOnBlock(t,o){if(this.isMovable()){var c=t?this.getBlockById(t):null;if(c){t=c.getRelativeToSurfaceXY(),c=o?{height:c.height,width:c.width}:c.getHeightWidth();var g=this.scale;o=(t.x+(this.RTL?-1:1)*c.width/2)*g,t=(t.y+c.height/2)*g,c=this.getMetrics(),this.scroll(-(o-c.viewWidth/2),-(t-c.viewHeight/2))}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}setScale(t){this.options.zoomOptions.maxScale&&t>this.options.zoomOptions.maxScale?t=this.options.zoomOptions.maxScale:this.options.zoomOptions.minScale&&t<this.options.zoomOptions.minScale&&(t=this.options.zoomOptions.minScale),this.scale=t,this.hideChaff(!1),(t=this.getFlyout(!1))&&t.isVisible()&&(t.reflow(),this.recordDragTargets()),this.grid&&this.grid.update(this.scale),t=this.getMetrics(),this.scrollX-=t.absoluteLeft,this.scrollY-=t.absoluteTop,t.viewLeft+=t.absoluteLeft,t.viewTop+=t.absoluteTop,this.scroll(this.scrollX,this.scrollY),this.scrollbar&&(this.flyout?this.scrollbar.resizeView(t):this.scrollbar.resizeContent(t))}getScale(){return this.options.parentWorkspace?this.options.parentWorkspace.getScale():this.scale}scroll(t,o){this.hideChaff(!0);const c=this.getMetrics();t=Math.min(t,-c.scrollLeft),o=Math.min(o,-c.scrollTop);const g=c.scrollTop+Math.max(0,c.scrollHeight-c.viewHeight);t=Math.max(t,-(c.scrollLeft+Math.max(0,c.scrollWidth-c.viewWidth))),o=Math.max(o,-g),this.scrollX=t,this.scrollY=o,this.scrollbar&&this.scrollbar.set(-(t+c.scrollLeft),-(o+c.scrollTop),!1),t+=c.absoluteLeft,o+=c.absoluteTop,this.translate(t,o)}getBlockById(t){return super.getBlockById(t)}getAllBlocks(t=!1){return super.getAllBlocks(t)}getTopBlocks(t=!1){return super.getTopBlocks(t)}addTopBlock(t){this.addTopBoundedElement(t),super.addTopBlock(t)}removeTopBlock(t){this.removeTopBoundedElement(t),super.removeTopBlock(t)}addTopComment(t){this.addTopBoundedElement(t),super.addTopComment(t)}removeTopComment(t){this.removeTopBoundedElement(t),super.removeTopComment(t)}getRootWorkspace(){return super.getRootWorkspace()}addTopBoundedElement(t){this.topBoundedElements.push(t)}removeTopBoundedElement(t){dt(this.topBoundedElements,t)}getTopBoundedElements(){return[].concat(this.topBoundedElements)}setResizesEnabled(t){const o=!this.resizesEnabled&&t;this.resizesEnabled=t,o&&this.resizeContents()}clear(){this.setResizesEnabled(!1),super.clear(),this.topBoundedElements=[],this.setResizesEnabled(!0)}registerButtonCallback(t,o){if(typeof o!="function")throw TypeError("Button callbacks must be functions.");this.flyoutButtonCallbacks.set(t,o)}getButtonCallback(t){let o;return(o=this.flyoutButtonCallbacks.get(t))!=null?o:null}removeButtonCallback(t){this.flyoutButtonCallbacks.delete(t)}registerToolboxCategoryCallback(t,o){if(typeof o!="function")throw TypeError("Toolbox category callbacks must be functions.");this.toolboxCategoryCallbacks.set(t,o)}getToolboxCategoryCallback(t){return this.toolboxCategoryCallbacks.get(t)||null}removeToolboxCategoryCallback(t){this.toolboxCategoryCallbacks.delete(t)}getGesture(t){const o=t.type==="pointerdown",c=this.currentGesture_;return c?o&&c.hasStarted()?(console.warn("Tried to start the same gesture twice."),c.cancel(),null):c:o?this.currentGesture_=new nu(t,this):null}clearGesture(){this.currentGesture_=null}cancelCurrentGesture(){this.currentGesture_&&this.currentGesture_.cancel()}getAudioManager(){return this.audioManager}getGrid(){return this.grid}hideChaff(t=!1){Ta(),wi(this),Uo(),this.hideComponents(t)}hideComponents(t=!1){this.getComponentManager().getComponents(Vr.Capability.AUTOHIDEABLE,!0).forEach(o=>o.autoHide(t))}static setTopLevelWorkspaceMetrics_(t){const o=this.getMetrics();typeof t.x=="number"&&(this.scrollX=-(o.scrollLeft+(o.scrollWidth-o.viewWidth)*t.x)),typeof t.y=="number"&&(this.scrollY=-(o.scrollTop+(o.scrollHeight-o.viewHeight)*t.y)),this.translate(this.scrollX+o.absoluteLeft,this.scrollY+o.absoluteTop)}},nA=class extends Rt{constructor(t,o){super(o),this.type=to,this.isOpen=t}toJson(){const t=super.toJson();if(this.isOpen===void 0)throw Error("Whether this is already open or not is undefined. Either pass a value to the constructor, or call fromJson");return t.isOpen=this.isOpen,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new nA),o.isOpen=t.isOpen,o}};r(yt.EVENT,to,nA);var iA=class extends Rt{constructor(t,o,c){super(c),this.type=gh,this.oldElementId=t??void 0,this.newElementId=o??void 0}toJson(){const t=super.toJson();return t.oldElementId=this.oldElementId,t.newElementId=this.newElementId,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new iA),o.oldElementId=t.oldElementId,o.newElementId=t.newElementId,o}};r(yt.EVENT,gh,iA);var $1=class{constructor(){this.drawer=this.curNode=this.colour=null,this.type="marker"}setDrawer(t){this.drawer=t}getDrawer(){return this.drawer}getCurNode(){return this.curNode}setCurNode(t){const o=this.curNode;this.curNode=t,this.drawer&&this.drawer.draw(o,this.curNode)}draw(){this.drawer&&this.drawer.draw(this.curNode,this.curNode)}hide(){this.drawer&&this.drawer.hide()}dispose(){this.getDrawer()&&this.getDrawer().dispose()}},rA=class extends $1{constructor(){super(),this.type="cursor"}next(){var t=this.getCurNode();if(!t)return null;for(t=t.next();t&&t.next()&&(t.getType()===_t.types.NEXT||t.getType()===_t.types.BLOCK);)t=t.next();return t&&this.setCurNode(t),t}in(){var t=this.getCurNode();if(!t)return null;(t.getType()===_t.types.PREVIOUS||t.getType()===_t.types.OUTPUT)&&(t=t.next());let o,c;return(t=(c=(o=t)==null?void 0:o.in())!=null?c:null)&&this.setCurNode(t),t}prev(){var t=this.getCurNode();if(!t)return null;for(t=t.prev();t&&t.prev()&&(t.getType()===_t.types.NEXT||t.getType()===_t.types.BLOCK);)t=t.prev();return t&&this.setCurNode(t),t}out(){var t=this.getCurNode();return t?((t=t.out())&&t.getType()===_t.types.BLOCK&&(t=t.prev()||t),t&&this.setCurNode(t),t):null}};r(yt.CURSOR,yo,rA);var Tv=class extends rA{constructor(){super()}next(){var t=this.getCurNode();return t?((t=this.getNextNode_(t,this.validNode_))&&this.setCurNode(t),t):null}in(){return this.next()}prev(){var t=this.getCurNode();return t?((t=this.getPreviousNode_(t,this.validNode_))&&this.setCurNode(t),t):null}out(){return this.prev()}getNextNode_(t,o){if(!t)return null;const c=t.in()||t.next();return o(c)?c:c?this.getNextNode_(c,o):(t=this.findSiblingOrParent(t.out()),o(t)?t:t?this.getNextNode_(t,o):null)}getPreviousNode_(t,o){if(!t)return null;let c=t.prev();return c=c?this.getRightMostChild(c):t.out(),o(c)?c:c?this.getPreviousNode_(c,o):null}validNode_(t){let o=!1;return t=t&&t.getType(),(t===_t.types.OUTPUT||t===_t.types.INPUT||t===_t.types.FIELD||t===_t.types.NEXT||t===_t.types.PREVIOUS||t===_t.types.WORKSPACE)&&(o=!0),o}findSiblingOrParent(t){if(!t)return null;const o=t.next();return o||this.findSiblingOrParent(t.out())}getRightMostChild(t){if(!t.in())return t;for(t=t.in();t&&t.next();)t=t.next();return this.getRightMostChild(t)}};Tv.registrationName="basicCursor",r(yt.CURSOR,Tv.registrationName,Tv);var b1=class extends Tv{validNode_(t){let o=!1;const c=t&&t.getType();return t&&(t=t.getLocation(),c===_t.types.FIELD&&t&&t.isTabNavigable()&&t.isClickable()&&(o=!0)),o}},sA=10,ro=class extends Jn{constructor(t,o){super(t,o),this.highlighted=!1,this.targetConnection=null,this.db=t.workspace.connectionDBList[o],this.dbOpposite=t.workspace.connectionDBList[Ef[o]],this.offsetInBlock=new At(0,0),this.trackedState=ro.TrackedState.WILL_TRACK}dispose(){super.dispose(),this.trackedState===ro.TrackedState.TRACKED&&this.db.removeConnection(this,this.y);let t,o;(o=(t=this.sourceBlock_.pathObject).removeConnectionHighlight)==null||o.call(t,this)}getSourceBlock(){return super.getSourceBlock()}targetBlock(){return super.targetBlock()}distanceFrom(t){const o=this.x-t.x;return t=this.y-t.y,Math.sqrt(o*o+t*t)}bumpAwayFrom(t){if(!this.sourceBlock_.workspace.isDragging()){var o=this.sourceBlock_.getRootBlock();if(!o.isInFlyout){var c=!1;if(!o.isMovable()){if(o=t.getSourceBlock().getRootBlock(),!o.isMovable())return;t=this,c=!0}var g=de()==o;g||o.addSelect();var $=t.x+n.config$$module$build$src$core$config.snapRadius+Math.floor(Math.random()*sA)-this.x,M=t.y+n.config$$module$build$src$core$config.snapRadius+Math.floor(Math.random()*sA)-this.y;c&&(M=-M),o.RTL&&($=t.x-n.config$$module$build$src$core$config.snapRadius-Math.floor(Math.random()*sA)-this.x),o.moveBy($,M,["bump"]),g||o.removeSelect()}}}moveTo(t,o){let c=!1;return this.trackedState===ro.TrackedState.WILL_TRACK?(this.db.addConnection(this,o),this.trackedState=ro.TrackedState.TRACKED,c=!0):this.trackedState===ro.TrackedState.TRACKED&&(this.db.removeConnection(this,this.y),this.db.addConnection(this,o),c=!0),this.x=t,this.y=o,c}moveBy(t,o){return this.moveTo(this.x+t,this.y+o)}moveToOffset(t){return this.moveTo(t.x+this.offsetInBlock.x,t.y+this.offsetInBlock.y)}setOffsetInBlock(t,o){this.offsetInBlock.x=t,this.offsetInBlock.y=o}getOffsetInBlock(){return this.offsetInBlock}tightenEfficiently(){var t=this.targetConnection;const o=this.targetBlock();t&&o&&(t=At.difference(this.offsetInBlock,t.offsetInBlock),o.translate(t.x,t.y))}closest(t,o){return this.dbOpposite.searchForClosest(this,t,o)}highlight(){this.highlighted=!0,this.getSourceBlock().queueRender()}unhighlight(){this.highlighted=!1,this.getSourceBlock().queueRender()}isHighlighted(){return this.highlighted}setTracking(t){t&&this.trackedState===ro.TrackedState.TRACKED||!t&&this.trackedState===ro.TrackedState.UNTRACKED||this.sourceBlock_.isInFlyout||(t?(this.db.addConnection(this,this.y),this.trackedState=ro.TrackedState.TRACKED):(this.trackedState===ro.TrackedState.TRACKED&&this.db.removeConnection(this,this.y),this.trackedState=ro.TrackedState.UNTRACKED))}stopTrackingAll(){if(this.setTracking(!1),this.targetConnection){const t=this.targetBlock().getDescendants(!1);for(let o=0;o<t.length;o++){const c=t[o],g=c.getConnections_(!0);for(let $=0;$<g.length;$++)g[$].setTracking(!1);for(const $ of c.getIcons())Ee($)&&$.setBubbleVisible(!1)}}}startTrackingAll(){this.setTracking(!0);let t=[];if(this.type!==Bt.INPUT_VALUE&&this.type!==Bt.NEXT_STATEMENT)return t;const o=this.targetBlock();if(o){let c;o.isCollapsed()?(c=[],o.outputConnection&&c.push(o.outputConnection),o.nextConnection&&c.push(o.nextConnection),o.previousConnection&&c.push(o.previousConnection)):c=o.getConnections_(!0);for(let g=0;g<c.length;g++)t.push(...c[g].startTrackingAll());t.length||(t=[o])}return t}onFailedConnect(t){const o=this.getSourceBlock();if(E()){const c=n.getGroup$$module$build$src$core$events$utils();setTimeout((function(){o.isDisposed()||o.getParent()||(n.setGroup$$module$build$src$core$events$utils(c),this.bumpAwayFrom(t),n.setGroup$$module$build$src$core$events$utils(!1))}).bind(this),n.config$$module$build$src$core$config.bumpDelay)}}disconnectInternal(t=!0){const{parentConnection:o,childConnection:c}=this.getParentAndChildConnections();if(o&&c){var g=n.getGroup$$module$build$src$core$events$utils();g||n.setGroup$$module$build$src$core$events$utils(!0);var $=o.getSourceBlock(),M=c.getSourceBlock();super.disconnectInternal(t),$.queueRender(),M.updateDisabled(),M.queueRender(),M.getSvgRoot().style.display="block",n.setGroup$$module$build$src$core$events$utils(g)}}respawnShadow_(){super.respawnShadow_();const t=this.targetBlock();t&&(t.initSvg(),t.queueRender())}neighbours(t){return this.dbOpposite.getNeighbours(this,t)}connect_(t){super.connect_(t);var o=this.getSourceBlock();t=t.getSourceBlock(),o.updateDisabled(),t.updateDisabled(),t.queueRender(),(o=o.getInputWithBlock(t))&&(o=o.isVisible(),t.getSvgRoot().style.display=o?"block":"none")}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()}setCheck(t){return super.setCheck(t),this.sourceBlock_.queueRender(),this}};(function(t){t=t.TrackedState||(t.TrackedState={}),t[t.WILL_TRACK=-1]="WILL_TRACK",t[t.UNTRACKED=0]="UNTRACKED",t[t.TRACKED=1]="TRACKED"})(ro||(ro={})),ro.TrackedState;var Ev=class{paste(t,o,c){if(!o.isCapacityAvailable(t.typeCounts))return null;c&&(t.blockState.x=c.x,t.blockState.y=c.y),c=c||new At(t.blockState.x||0,t.blockState.y||0),n.disable$$module$build$src$core$events$utils();let g;try{g=Ii(t.blockState,o),U_(g,c)}finally{n.enable$$module$build$src$core$events$utils()}return g&&(R()&&!g.isShadow()&&b(new(k(n.CREATE$$module$build$src$core$events$utils))(g)),n.setSelected$$module$build$src$core$common(g),g)}};Ev.TYPE="block",jn(Ev.TYPE,new Ev);var Ey={};Ey.bumpIntoBounds=sh,Ey.bumpIntoBoundsHandler=G_,Ey.bumpTopObjectsIntoBounds=Hd;var A1=class{constructor(t){this.block=t,this.connectionPreviewer=this.connectionCandidate=this.startLoc=this.startChildConn=this.startParentConn=null,this.dragging=!1,this.dragOffset=new At(0,0),this.workspace=t.workspace}isMovable(){if(this.block.isShadow()){let t,o;return(o=(t=this.block.getParent())==null?void 0:t.isMovable())!=null?o:!1}return this.block.isOwnMovable()&&!this.block.isDeadOrDying()&&!this.workspace.options.readOnly&&!this.block.isInFlyout}startDrag(t){if(this.block.isShadow())this.startDraggingShadow(t);else{this.dragging=!0,n.getGroup$$module$build$src$core$events$utils()||n.setGroup$$module$build$src$core$events$utils(!0),this.fireDragStartEvent(),this.startLoc=this.block.getRelativeToSurfaceXY(),this.connectionCandidate=null,this.connectionPreviewer=new(p(yt.CONNECTION_PREVIEWER,this.workspace.options))(this.block),qe(),this.workspace.setResizesEnabled(!1),ec(),t=!!t&&(t.altKey||t.ctrlKey||t.metaKey),this.shouldDisconnect(t)&&this.disconnectBlock(t),this.block.setDragging(!0);var o;(o=this.workspace.getLayerManager())==null||o.moveToDragLayer(this.block)}}startDraggingShadow(t){const o=this.block.getParent();if(!o)throw Error("Tried to drag a shadow block with no parent. Shadow blocks should always have parents.");this.dragOffset=At.difference(o.getRelativeToSurfaceXY(),this.block.getRelativeToSurfaceXY()),o.startDrag(t)}shouldDisconnect(t){return!!(this.block.getParent()||t&&this.block.nextConnection&&this.block.nextConnection.targetBlock())}disconnectBlock(t){let o,c,g;if(this.startParentConn=(g=(o=this.block.outputConnection)==null?void 0:o.targetConnection)!=null?g:(c=this.block.previousConnection)==null?void 0:c.targetConnection,t){let $;this.startChildConn=($=this.block.nextConnection)==null?void 0:$.targetConnection}this.block.unplug(t),b_(this.block)}fireDragStartEvent(){const t=new(k(sc))(this.block,!0,this.block.getDescendants(!1));b(t)}fireDragEndEvent(){const t=new(k(sc))(this.block,!1,this.block.getDescendants(!1));b(t)}fireMoveEvent(){if(!this.block.isDeadOrDying()){var t=new(k(n.MOVE$$module$build$src$core$events$utils))(this.block);t.setReason(["drag"]),t.oldCoordinate=this.startLoc,t.recordNew(),b(t)}}drag(t){if(this.block.isShadow()){let o;(o=this.block.getParent())==null||o.drag(At.sum(t,this.dragOffset))}else this.block.moveDuringDrag(t),this.updateConnectionPreview(this.block,At.difference(t,this.startLoc))}updateConnectionPreview(t,o){var c=this.connectionCandidate;const g=this.getConnectionCandidate(t,o);if(g){this.connectionCandidate=o=c&&this.currCandidateIsBetter(c,o,g)?c:g;var{local:$,neighbour:M}=o;o=$.type===Bt.OUTPUT_VALUE||$.type===Bt.PREVIOUS_STATEMENT,c=M.isConnected()&&!M.targetBlock().isInsertionMarker(),o&&c&&!this.orphanCanConnectAtEnd(t,M.targetBlock(),$.type)?this.connectionPreviewer.previewReplacement($,M,M.targetBlock()):this.connectionPreviewer.previewConnection($,M)}else this.connectionPreviewer.hidePreview(),this.connectionCandidate=null}orphanCanConnectAtEnd(t,o,c){return!!Jn.getConnectionForOrphanedConnection(t,c===Bt.OUTPUT_VALUE?o.outputConnection:o.previousConnection)}currCandidateIsBetter(t,o,c){const{local:g,neighbour:$}=t;t=new At(g.x,g.y);const M=new At($.x,$.y);return o=At.distance(At.sum(t,o),M),c.distance>o-n.config$$module$build$src$core$config.currentConnectionPreference}getConnectionCandidate(t,o){t=this.getLocalConnections(t);let c=this.connectionCandidate?n.config$$module$build$src$core$config.connectingSnapRadius:n.config$$module$build$src$core$config.snapRadius,g=null;for(const $ of t){const{connection:M,radius:Q}=$.closest(c,o);M&&(g={local:$,neighbour:M,distance:Q},c=Q)}return g}getLocalConnections(t){const o=t.getConnections_(!1),c=t.lastConnectionInStack(!0);return c&&c!==t.nextConnection&&o.push(c),o}endDrag(t){if(this.block.isShadow()){let o;(o=this.block.getParent())==null||o.endDrag(t)}else{if(this.fireDragEndEvent(),this.fireMoveEvent(),ut(),ec(),this.connectionPreviewer.hidePreview(),!this.block.isDeadOrDying()&&this.dragging){let o;(o=this.workspace.getLayerManager())==null||o.moveOffDragLayer(this.block,fm),this.block.setDragging(!1)}this.connectionCandidate?this.applyConnections(this.connectionCandidate):this.block.queueRender(),this.block.snapToGrid(),this.connectionPreviewer.dispose(),this.workspace.setResizesEnabled(!0),n.setGroup$$module$build$src$core$events$utils(!1)}}applyConnections(t){const{local:o,neighbour:c}=t;o.connect(c);const g=o.isSuperior()?c:o,$=this.block.getRootBlock();Kt().then(()=>{qp(g.getSourceBlock()),setTimeout(()=>{$.bringToFront()},0)})}revertDrag(){if(this.block.isShadow()){let o;(o=this.block.getParent())==null||o.revertDrag()}else{var t;if((t=this.startChildConn)==null||t.connect(this.block.nextConnection),this.startParentConn)switch(this.startParentConn.type){case Bt.INPUT_VALUE:this.startParentConn.connect(this.block.outputConnection);break;case Bt.NEXT_STATEMENT:this.startParentConn.connect(this.block.previousConnection)}else{this.block.moveTo(this.startLoc,["drag"]);let o;(o=this.workspace.getLayerManager())==null||o.moveOffDragLayer(this.block,fm),sh(this.workspace,this.workspace.getMetricsManager().getScrollMetrics(!0),this.block)}this.startParentConn=this.startChildConn=null,this.connectionPreviewer.hidePreview(),this.connectionCandidate=null,this.block.setDragging(!1),this.dragging=!1}}},Na=class extends vf{constructor(t,o,c){if(super(t,o,c),this.width=this.height=0,this.warningTextDb=new Map,this.mutator=null,this.rendered=!0,this.eventsInit_=this.renderIsInProgress_=this.visuallyDisabled=!1,this.translation="",this.dragging=!1,this.relativeCoords=new At(0,0),this.dragStrategy=new A1(this),!t.rendered)throw TypeError("Cannot create a rendered block in a headless workspace");this.workspace=t,this.svgGroup_=Ce(Ve.G,{}),this.style=t.getRenderer().getConstants().getBlockStyle(null),this.pathObject=t.getRenderer().makePathObject(this.svgGroup_,this.style),t=this.pathObject.svgPath,t.tooltip=this,Ar(t),this.svgGroup_.setAttribute("data-id",this.id),this.doInit_()}initSvg(){if(!this.initialized){for(var t of this.inputList)t.init();for(const o of this.getIcons())o.initView(this.createIconPointerDownListener(o)),o.updateEditable();this.applyColour(),this.pathObject.updateMovable(this.isMovable()||this.isInFlyout),t=this.getSvgRoot(),!this.workspace.options.readOnly&&t&&Ue(t,"pointerdown",this,this.onMouseDown_),t.parentNode||this.workspace.getCanvas().appendChild(t),this.initialized=!0}}getColourSecondary(){return this.style.colourSecondary}getColourTertiary(){return this.style.colourTertiary}select(){if(this.isShadow()){let t;(t=this.getParent())==null||t.select()}else this.addSelect()}unselect(){if(this.isShadow()){let t;(t=this.getParent())==null||t.unselect()}else this.removeSelect()}setParent(t){const o=this.parentBlock_;if(t!==o){qe(),super.setParent(t),ut();var c=this.getSvgRoot();if(!this.workspace.isClearing&&c){var g=this.getRelativeToSurfaceXY();t?t.getSvgRoot().appendChild(c):o&&((t=this.workspace.getCanvas().querySelector(".blocklyDragging"))?this.workspace.getCanvas().insertBefore(c,t):this.workspace.getCanvas().appendChild(c),this.translate(g.x,g.y)),this.applyColour()}}}getRelativeToSurfaceXY(){const t=this.workspace.getLayerManager();if(!t)throw Error("Cannot calculate position because the workspace has not been appended");let o=0,c=0,g=this.getSvgRoot();if(g)do{const $=j(g);o+=$.x,c+=$.y,g=g.parentNode}while(g&&!t.hasLayer(g));return new At(o,c)}moveBy(t,o,c){if(this.parentBlock_)throw Error("Block has parent");const g=R();let $=null;g&&($=new(k(n.MOVE$$module$build$src$core$events$utils))(this),c&&$.setReason(c)),t=new At(t,o),o=this.getRelativeToSurfaceXY(),t=At.sum(o,t),this.translate(t.x,t.y),this.updateComponentLocations(t),g&&$&&($.recordNew(),b($)),this.workspace.resizeContents()}translate(t,o){this.translation=`translate(${t}, ${o})`,this.relativeCoords=new At(t,o),this.getSvgRoot().setAttribute("transform",this.getTranslation())}getTranslation(){return this.translation}moveTo(t,o){const c=this.getRelativeToSurfaceXY();this.moveBy(t.x-c.x,t.y-c.y,o)}moveDuringDrag(t){this.translate(t.x,t.y),this.getSvgRoot().setAttribute("transform",this.getTranslation()),this.updateComponentLocations(t)}snapToGrid(){if(!this.isDeadOrDying()&&!this.getParent()&&!this.isInFlyout){var t=this.workspace.getGrid();if(t!=null&&t.shouldSnap()){var o=this.getRelativeToSurfaceXY();t=t.alignXY(o),t!==o&&this.moveTo(t,["snap"])}}}getBoundingRectangle(){const t=this.getRelativeToSurfaceXY(),o=this.getHeightWidth();let c,g;return this.RTL?(c=t.x-o.width,g=t.x):(c=t.x,g=t.x+o.width),new $i(t.y,t.y+o.height,c,g)}markDirty(){this.pathObject.constants=this.workspace.getRenderer().getConstants();for(let t=0,o;o=this.inputList[t];t++)o.markDirty()}setCollapsed(t){this.collapsed_!==t&&(super.setCollapsed(t),this.updateCollapsed_())}updateCollapsed_(){var t=this.isCollapsed();const o=tv,c=jE;for(let $=0,M;M=this.inputList[$];$++)M.name!==o&&M.setVisible(!t);for(var g of this.getIcons())g.updateCollapsed();t?(t=this.toString(E1),(g=this.getField(c))?g.setValue(t):(this.getInput(o)||this.appendDummyInput(o)).appendField(new _f(t),c)):(this.updateDisabled(),this.removeInput(o))}tab(t,o){const c=new b1;c.setCurNode(_t.createFieldNode(t)),t=c.getCurNode(),o?c.next():c.prev(),(o=c.getCurNode())&&o!==t&&(o.getLocation().showEditor(),this.workspace.keyboardAccessibilityMode&&this.workspace.getCursor().setCurNode(o))}onMouseDown_(t){const o=this.workspace.getGesture(t);o&&o.handleBlockStart(t,this)}showHelp(){const t=typeof this.helpUrl=="function"?this.helpUrl():this.helpUrl;t&&window.open(t)}generateContextMenu(){if(this.workspace.options.readOnly||!this.contextMenu)return null;const t=wn.registry.getContextMenuOptions(wn.ScopeType.BLOCK,{block:this});return this.customContextMenu&&this.customContextMenu(t),t}showContextMenu(t){const o=this.generateContextMenu();o&&o.length&&(Bc(t,o,this.RTL,this.workspace),wd(this))}updateComponentLocations(t){this.dragging||this.updateConnectionLocations(t),this.updateIconLocations(t),this.updateFieldLocations(t);for(const o of this.getChildren(!1))o.updateComponentLocations(At.sum(t,o.relativeCoords))}updateConnectionLocations(t){for(const o of this.getConnections_(!1))o.moveToOffset(t)}updateIconLocations(t){for(const o of this.getIcons())o.onLocationChange(t)}updateFieldLocations(t){for(const o of this.inputList)for(const c of o.fieldRow)c.onLocationChange(t)}setDragging(t){(this.dragging=t)?(this.translation="",V.push(...this.getConnections_(!0)),Me(this.svgGroup_,"blocklyDragging")):(V.length=0,oe(this.svgGroup_,"blocklyDragging"));for(let o=0;o<this.childBlocks_.length;o++)this.childBlocks_[o].setDragging(t)}setMovable(t){super.setMovable(t),this.pathObject.updateMovable(t)}setEditable(t){super.setEditable(t),t=this.getIcons();for(let o=0;o<t.length;o++)t[o].updateEditable()}setShadow(t){super.setShadow(t),this.applyColour()}setInsertionMarker(t){this.isInsertionMarker_!==t&&(this.isInsertionMarker_=t)&&(this.setColour(this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR),this.pathObject.updateInsertionMarker(!0))}getSvgRoot(){return this.svgGroup_}dispose(t,o){this.disposing=!0,Vp(),ql(),o&&(this.unplug(t),Ld(this)),super.dispose(!!t),W(this.svgGroup_)}disposeInternal(){this.disposing=!0,super.disposeInternal(),de()===this&&(this.unselect(),this.workspace.cancelCurrentGesture()),[...this.warningTextDb.values()].forEach(t=>clearTimeout(t)),this.warningTextDb.clear(),this.getIcons().forEach(t=>t.dispose())}checkAndDelete(){this.workspace.isFlyout||(n.setGroup$$module$build$src$core$events$utils(!0),this.workspace.hideChaff(),this.outputConnection?this.dispose(!1,!0):this.dispose(!0,!0),n.setGroup$$module$build$src$core$events$utils(!1))}toCopyData(){return this.isInsertionMarker_?null:{paster:Ev.TYPE,blockState:Vi(this,{addCoordinates:!0,addNextBlocks:!1}),typeCounts:K(this,!0)}}applyColour(){this.pathObject.applyColour(this);const t=this.getIcons();for(let o=0;o<t.length;o++)t[o].applyColour();for(let o=0,c;c=this.inputList[o];o++)for(let g=0,$;$=c.fieldRow[g];g++)$.applyColour()}updateDisabled(){const t=!this.isEnabled()||this.getInheritedDisabled();if(this.visuallyDisabled===t){let o;(o=this.getNextBlock())==null||o.updateDisabled()}else{this.applyColour(),this.visuallyDisabled=t;for(const o of this.getChildren(!1))o.updateDisabled()}}setWarningText(t,o=""){if(o)this.warningTextDb.has(o)&&(clearTimeout(this.warningTextDb.get(o)),this.warningTextDb.delete(o));else{for(var c of this.warningTextDb.values())clearTimeout(c);this.warningTextDb.clear()}if(this.workspace.isDragging())this.warningTextDb.set(o,setTimeout(()=>{this.isDeadOrDying()||(this.warningTextDb.delete(o),this.setWarningText(t,o))},100));else if(this.isInFlyout&&(t=null),c=this.getIcon(ou.TYPE),t){let g=this.getSurroundParent(),$=null;for(;g;)g.isCollapsed()&&($=g),g=g.getSurroundParent();$&&$.setWarningText(n.Msg$$module$build$src$core$msg.COLLAPSED_WARNINGS_WARNING,Na.COLLAPSED_WARNING_ID),c?c.addMessage(t,o):this.addIcon(new ou(this).addMessage(t,o))}else c&&(o?(c.addMessage("",o),c.getText()||this.removeIcon(ou.TYPE)):this.removeIcon(ou.TYPE))}setMutator(t){this.removeIcon(n.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE),t&&this.addIcon(t)}addIcon(t){return super.addIcon(t),t instanceof n.MutatorIcon$$module$build$src$core$icons$mutator_icon&&(this.mutator=t),t.initView(this.createIconPointerDownListener(t)),t.applyColour(),t.updateEditable(),this.queueRender(),t}createIconPointerDownListener(t){return o=>{this.isDeadOrDying()||(o=this.workspace.getGesture(o))&&o.setStartIcon(t)}}removeIcon(t){const o=super.removeIcon(t);return t.equals(n.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE)&&(this.mutator=null),this.queueRender(),o}setEnabled(t){il("setEnabled","v11","v12","the setDisabledReason method of BlockSvg");const o=this.isEnabled();super.setEnabled(t),this.isEnabled()===o||this.getInheritedDisabled()||this.updateDisabled()}setDisabledReason(t,o){const c=this.isEnabled();super.setDisabledReason(t,o),this.isEnabled()===c||this.getInheritedDisabled()||this.updateDisabled()}setHighlighted(t){this.pathObject.updateHighlighted(t)}addSelect(){this.pathObject.updateSelected(!0)}removeSelect(){this.pathObject.updateSelected(!1)}setDeleteStyle(t){this.pathObject.updateDraggingDelete(t)}getColour(){return this.style.colourPrimary}setColour(t){super.setColour(t),t=this.workspace.getRenderer().getConstants().getBlockStyleForColour(this.colour_),this.pathObject.setStyle(t.style),this.style=t.style,this.styleName_=t.name,this.applyColour()}setStyle(t){const o=this.workspace.getRenderer().getConstants().getBlockStyle(t);if(this.styleName_=t,o)this.hat=o.hat,this.pathObject.setStyle(o),this.colour_=o.colourPrimary,this.style=o,this.applyColour();else throw Error("Invalid style name: "+t)}bringToFront(t=!1){let o=this;if(!o.isDeadOrDying())do{const c=o.getSvgRoot(),g=c.parentNode,$=g.childNodes;if($[$.length-1]!==c&&g.appendChild(c),t)break;o=o.getParent()}while(o)}setPreviousStatement(t,o){super.setPreviousStatement(t,o),this.queueRender()}setNextStatement(t,o){super.setNextStatement(t,o),this.queueRender()}setOutput(t,o){super.setOutput(t,o),this.queueRender()}setInputsInline(t){super.setInputsInline(t),this.queueRender()}removeInput(t,o){return t=super.removeInput(t,o),this.queueRender(),t}moveNumberedInputBefore(t,o){super.moveNumberedInputBefore(t,o),this.queueRender()}appendInput(t){return super.appendInput(t),this.queueRender(),t}setConnectionTracking(t){if(this.previousConnection&&this.previousConnection.setTracking(t),this.outputConnection&&this.outputConnection.setTracking(t),this.nextConnection){this.nextConnection.setTracking(t);var o=this.nextConnection.targetBlock();o&&o.setConnectionTracking(t)}if(!this.collapsed_)for(o=0;o<this.inputList.length;o++){var c=this.inputList[o].connection;c&&(c.setTracking(t),(c=c.targetBlock())&&c.setConnectionTracking(t))}}getConnections_(t){const o=[];if(this.outputConnection&&o.push(this.outputConnection),this.previousConnection&&o.push(this.previousConnection),this.nextConnection&&o.push(this.nextConnection),t||!this.collapsed_)for(let c=0,g;g=this.inputList[c];c++)g.connection&&o.push(g.connection);return o}lastConnectionInStack(t){return super.lastConnectionInStack(t)}getMatchingConnection(t,o){return super.getMatchingConnection(t,o)}makeConnection_(t){return new ro(this,t)}getNextBlock(){return super.getNextBlock()}getPreviousBlock(){return super.getPreviousBlock()}bumpNeighbours(){const t=this.getRootBlock();if(!(this.isDeadOrDying()||this.workspace.isDragging()||t.isInFlyout))for(const o of this.getConnections_(!1)){if(o.isSuperior()){let c;(c=o.targetBlock())==null||c.bumpNeighbours()}for(const c of o.neighbours(n.config$$module$build$src$core$config.snapRadius))c.getSourceBlock().getRootBlock()!==t&&(o.isConnected()&&c.isConnected()||(o.isSuperior()?c.bumpAwayFrom(o):o.bumpAwayFrom(c)))}}scheduleSnapAndBump(){this.snapToGrid(),this.bumpNeighbours()}positionNearConnection(t,o,c){if(t.type===Bt.NEXT_STATEMENT||t.type===Bt.INPUT_VALUE){let g=o.x;o=o.y,g+=c.x-t.getOffsetInBlock().x,o+=c.y-t.getOffsetInBlock().y,this.moveBy(g,o)}}getChildren(t){return super.getChildren(t)}queueRender(){return Mn(this)}render(){this.queueRender(),An()}renderEfficiently(){qe(),this.isCollapsed()&&this.updateCollapsed_(),this.isEnabled()||this.updateDisabled(),this.workspace.getRenderer().render(this),this.tightenChildrenEfficiently(),ut(),this.updateMarkers_()}tightenChildrenEfficiently(){for(const t of this.inputList){const o=t.connection;o&&o.tightenEfficiently()}this.nextConnection&&this.nextConnection.tightenEfficiently()}updateMarkers_(){this.workspace.keyboardAccessibilityMode&&this.pathObject.cursorSvg&&this.workspace.getCursor().draw(),this.workspace.keyboardAccessibilityMode&&this.pathObject.markerSvg&&this.workspace.getMarker(lv.LOCAL_MARKER).draw();for(const t of this.inputList)for(const o of t.fieldRow)o.updateMarkers_()}setCursorSvg(t){this.pathObject.setCursorSvg(t)}setMarkerSvg(t){this.pathObject.setMarkerSvg(t)}getHeightWidth(){let t=this.height,o=this.width;var c=this.getNextBlock();if(c){c=c.getHeightWidth();const g=this.workspace.getRenderer().getConstants().NOTCH_HEIGHT;t+=c.height-g,o=Math.max(o,c.width)}return{height:t,width:o}}fadeForReplacement(t){this.pathObject.updateReplacementFade(t)}highlightShapeForInput(t,o){this.pathObject.updateShapeForInputHighlight(t,o)}setDragStrategy(t){this.dragStrategy=t}isMovable(){return this.dragStrategy.isMovable()}startDrag(t){this.dragStrategy.startDrag(t)}drag(t,o){this.dragStrategy.drag(t,o)}endDrag(t){this.dragStrategy.endDrag(t)}revertDrag(){this.dragStrategy.revertDrag()}toFlyoutInfo(){const t=Object.assign({},{kind:"BLOCK"},Vi(this)),o=new Set(["id","height","width","pinned","enabled"]),c=function(g){for(const $ in g)o.has($)?delete g[$]:typeof g[$]=="object"&&c(g[$])};return c(t),[t]}};Na.INLINE=-1,Na.COLLAPSED_WARNING_ID="TEMP_COLLAPSED_WARNING_";var C1=class{constructor(){}onDragEnter(t){}onDragOver(t){}onDragExit(t){}onDrop(t){}getClientRect(){return null}shouldPreventMove(t){return!1}},yy=class extends C1{constructor(){super(),this.wouldDelete_=!1}wouldDelete(t){return t instanceof Na?(t=!t.getParent()&&t.isDeletable(),this.updateWouldDelete_(t)):this.updateWouldDelete_(eo(t)&&t.isDeletable()),this.wouldDelete_}updateWouldDelete_(t){this.wouldDelete_=t}},x1=class extends yy{constructor(t){super(),this.workspace=t,this.id="trashcan",this.contents=[],this.flyout=null,this.isLidOpen=!1,this.minOpenness=0,this.lidTask=this.svgLid=this.svgGroup=null,this.top=this.left=this.lidOpen=0,this.initialized=!1,0>=this.workspace.options.maxTrashcanContents||(t=new Ma({scrollbars:!0,parentWorkspace:this.workspace,rtl:this.workspace.RTL,oneBasedIndex:this.workspace.options.oneBasedIndex,renderer:this.workspace.options.renderer,rendererOverrides:this.workspace.options.rendererOverrides,move:{scrollbars:!0}}),this.workspace.horizontalLayout?(t.toolboxPosition=this.workspace.toolboxPosition===Cn.TOP?Cn.BOTTOM:Cn.TOP,this.flyout=new(p(yt.FLYOUTS_HORIZONTAL_TOOLBOX,this.workspace.options,!0))(t)):(t.toolboxPosition=this.workspace.toolboxPosition===Cn.RIGHT?Cn.LEFT:Cn.RIGHT,this.flyout=new(p(yt.FLYOUTS_VERTICAL_TOOLBOX,this.workspace.options,!0))(t)),this.workspace.addChangeListener(this.onDelete.bind(this)))}createDom(){this.svgGroup=Ce(Ve.G,{class:"blocklyTrash"});let t;const o=String(Math.random()).substring(2);t=Ce(Ve.CLIPPATH,{id:"blocklyTrashBodyClipPath"+o},this.svgGroup),Ce(Ve.RECT,{width:Rm,height:Sy,y:wm},t);const c=Ce(Ve.IMAGE,{width:no.width,x:-oA,height:no.height,y:-aA,"clip-path":"url(#blocklyTrashBodyClipPath"+o+")"},this.svgGroup);return c.setAttributeNS(Zo,"xlink:href",this.workspace.options.pathToMedia+no.url),t=Ce(Ve.CLIPPATH,{id:"blocklyTrashLidClipPath"+o},this.svgGroup),Ce(Ve.RECT,{width:Rm,height:wm},t),this.svgLid=Ce(Ve.IMAGE,{width:no.width,x:-oA,height:no.height,y:-aA,"clip-path":"url(#blocklyTrashLidClipPath"+o+")"},this.svgGroup),this.svgLid.setAttributeNS(Zo,"xlink:href",this.workspace.options.pathToMedia+no.url),Le(this.svgGroup,"pointerdown",this,this.blockMouseDownWhenOpenable),Le(this.svgGroup,"pointerup",this,this.click),Le(c,"pointerover",this,this.mouseOver),Le(c,"pointerout",this,this.mouseOut),this.animateLid(),this.svgGroup}init(){0<this.workspace.options.maxTrashcanContents&&(ot(this.flyout.createDom(Ve.SVG),this.workspace.getParentSvg()),this.flyout.init(this.workspace)),this.workspace.getComponentManager().addComponent({component:this,weight:1,capabilities:[Vr.Capability.AUTOHIDEABLE,Vr.Capability.DELETE_AREA,Vr.Capability.DRAG_TARGET,Vr.Capability.POSITIONABLE]}),this.initialized=!0,this.setLidOpen(!1)}dispose(){this.workspace.getComponentManager().removeComponent("trashcan"),this.svgGroup&&W(this.svgGroup),this.lidTask&&clearTimeout(this.lidTask)}hasContents(){return!!this.contents.length}contentsIsOpen(){return!!this.flyout&&this.flyout.isVisible()}openFlyout(){if(!this.contentsIsOpen()){var t=this.contents.map(function(c){return JSON.parse(c)}),o=this.workspace.getParentSvg().style;o.cursor="wait",setTimeout(()=>{let c;(c=this.flyout)==null||c.show(t),o.cursor="";let g;(g=this.workspace.scrollbar)==null||g.setVisible(!1)},10),this.fireUiEvent(!0)}}closeFlyout(){if(this.contentsIsOpen()){var t;(t=this.flyout)==null||t.hide();var o;(o=this.workspace.scrollbar)==null||o.setVisible(!0),this.fireUiEvent(!1),this.workspace.recordDragTargets()}}autoHide(t){!t&&this.flyout&&this.closeFlyout()}emptyContents(){this.hasContents()&&(this.contents.length=0,this.setMinOpenness(0),this.closeFlyout())}position(t,o){if(this.initialized){var c=ve(this.workspace,t);t=le(c,new Kn(Rm,Sy+wm),$G,R1,t,this.workspace),o=me(t,R1,c.vertical===tu.TOP?Sh.DOWN:Sh.UP,o),this.top=o.top,this.left=o.left;var g;(g=this.svgGroup)==null||g.setAttribute("transform","translate("+this.left+","+this.top+")")}}getBoundingRectangle(){return new $i(this.top,this.top+Sy+wm,this.left,this.left+Rm)}getClientRect(){if(!this.svgGroup)return null;var t=this.svgGroup.getBoundingClientRect();const o=t.top+aA-$y;return t=t.left+oA-$y,new $i(o,o+wm+Sy+2*$y,t,t+Rm+2*$y)}onDragOver(t){this.setLidOpen(this.wouldDelete_)}onDragExit(t){this.setLidOpen(!1)}onDrop(t){setTimeout(this.setLidOpen.bind(this,!1),100)}setLidOpen(t){this.isLidOpen!==t&&(this.lidTask&&clearTimeout(this.lidTask),this.isLidOpen=t,this.animateLid())}animateLid(){const t=CG;var o=1/(t+1);this.lidOpen+=this.isLidOpen?o:-o,this.lidOpen=Math.min(Math.max(this.lidOpen,this.minOpenness),1),this.setLidAngle(this.lidOpen*M1),o=w1+this.lidOpen*(xG-w1),this.svgGroup&&(this.svgGroup.style.opacity=`${o}`),this.lidOpen>this.minOpenness&&1>this.lidOpen&&(this.lidTask=setTimeout(this.animateLid.bind(this),AG/t))}setLidAngle(t){const o=this.workspace.toolboxPosition===Cn.RIGHT||this.workspace.horizontalLayout&&this.workspace.RTL;let c;(c=this.svgLid)==null||c.setAttribute("transform","rotate("+(o?-t:t)+","+(o?4:Rm-4)+","+(wm-2)+")")}setMinOpenness(t){this.minOpenness=t,this.isLidOpen||this.setLidAngle(t*M1)}closeLid(){this.setLidOpen(!1)}click(){this.hasContents()&&!this.workspace.isDragging()&&this.openFlyout()}fireUiEvent(t){t=new(k(to))(t,this.workspace.id),b(t)}blockMouseDownWhenOpenable(t){!this.contentsIsOpen()&&this.hasContents()&&t.stopPropagation()}mouseOver(){this.hasContents()&&this.setLidOpen(!0)}mouseOut(){this.setLidOpen(!1)}onDelete(t){if(!(0>=this.workspace.options.maxTrashcanContents||t.type!==n.DELETE$$module$build$src$core$events$utils||t.type!==n.DELETE$$module$build$src$core$events$utils||t.wasShadow)){if(!t.oldJson)throw Error("Encountered a delete event without proper oldJson");if(t=JSON.stringify(this.cleanBlockJson(t.oldJson)),!this.contents.includes(t)){for(this.contents.unshift(t);this.contents.length>this.workspace.options.maxTrashcanContents;)this.contents.pop();this.setMinOpenness(bG)}}}cleanBlockJson(t){function o(c){if(c){if(delete c.id,delete c.x,delete c.y,delete c.enabled,delete c.disabledReasons,c.icons&&c.icons.comment){var g=c.icons.comment;delete g.height,delete g.width,delete g.pinned}g=c.inputs;for(var $ in g){var M=g[$];const Q=M.block;M=M.shadow,Q&&o(Q),M&&o(M)}c.next&&($=c.next,c=$.block,$=$.shadow,c&&o(c),$&&o($))}}return t=JSON.parse(JSON.stringify(t)),o(t),Object.assign({},{kind:"BLOCK"},t)}},Rm=47,Sy=44,wm=16,R1=20,$G=20,$y=10,oA=0,aA=32,bG=.1,AG=80,CG=4,w1=.4,xG=.8,M1=45,si=class{constructor(){this.shortcuts=new Map,this.keyMap=new Map,this.reset()}reset(){this.shortcuts.clear(),this.keyMap.clear()}register(t,o){if(this.shortcuts.get(t.name)&&!o)throw Error(`Shortcut named "${t.name}" already exists.`);if(this.shortcuts.set(t.name,t),(o=t.keyCodes)&&0<o.length)for(let c=0;c<o.length;c++)this.addKeyMapping(o[c],t.name,!!t.allowCollision)}unregister(t){return this.shortcuts.get(t)?(this.removeAllKeyMappings(t),this.shortcuts.delete(t),!0):(console.warn(`Keyboard shortcut named "${t}" not found.`),!1)}addKeyMapping(t,o,c){t=`${t}`;const g=this.keyMap.get(t);if(g&&!c)throw Error(`Shortcut named "${o}" collides with shortcuts "${g}"`);g&&c?g.unshift(o):this.keyMap.set(t,[o])}removeKeyMapping(t,o,c){const g=this.keyMap.get(t);if(!g)return c||console.warn(`No keyboard shortcut named "${o}" registered with key code "${t}"`),!1;const $=g.indexOf(o);return-1<$?(g.splice($,1),g.length===0&&this.keyMap.delete(t),!0):(c||console.warn(`No keyboard shortcut named "${o}" registered with key code "${t}"`),!1)}removeAllKeyMappings(t){for(const o of this.keyMap.keys())this.removeKeyMapping(o,t,!0)}setKeyMap(t){this.keyMap.clear();for(const o in t)this.keyMap.set(o,t[o])}getKeyMap(){const t=Object.create(null);for(const[o,c]of this.keyMap)t[o]=c;return t}getRegistry(){const t=Object.create(null);for(const[o,c]of this.shortcuts)t[o]=c;return tl(Object.create(null),t)}onKeyDown(t,o){var c=this.serializeKeyEvent_(o);if(c=this.getShortcutNamesByKeyCode(c),!c)return!1;for(let g=0,$;$=c[g];g++){const M=this.shortcuts.get($);let Q,be;if((Q=M)==null||!Q.preconditionFn||(be=M)!=null&&be.preconditionFn(t)){let nt,Dt;if((nt=M)!=null&&nt.callback&&((Dt=M)!=null&&Dt.callback(t,o,M)))return!0}}return!1}getShortcutNamesByKeyCode(t){return this.keyMap.get(t)||[]}getKeyCodesByShortcutName(t){const o=[];for(const[c,g]of this.keyMap)-1<g.indexOf(t)&&o.push(c);return o}serializeKeyEvent_(t){let o="";for(const c in si.modifierKeys)t.getModifierState(c)&&(o!==""&&(o+="+"),o+=c);return o!==""&&t.keyCode?o+="+"+t.keyCode:t.keyCode&&(o=String(t.keyCode)),o}checkModifiers_(t){for(let o=0,c;c=t[o];o++)if(!(c in si.modifierKeys))throw Error(c+" is not a valid modifier key.")}createSerializedKey(t,o){let c="";if(o){this.checkModifiers_(o);for(const g in si.modifierKeys)o.includes(si.modifierKeys[g])&&(c!==""&&(c+="+"),c+=g)}return c!==""&&t?c+="+"+t:t&&(c=`${t}`),c}};si.registry=new si,function(t){t=t.modifierKeys||(t.modifierKeys={}),t[t.Shift=16]="Shift",t[t.Control=17]="Control",t[t.Alt=18]="Alt",t[t.Meta=91]="Meta"}(si||(si={}));var lA=null,cA=null,RG={duplicateInternal:Vd,copyInternal:V_},yv={};yv.BlockPaster=Ev,yv.TEST_ONLY=RG,yv.paste=Yo,yv.registry=_b;var fc;(function(t){t.ESCAPE="escape",t.DELETE="delete",t.COPY="copy",t.CUT="cut",t.PASTE="paste",t.UNDO="undo",t.REDO="redo"})(fc||(fc={}));var Ch=null,xh=null,Mm=null;z_();var pc={};pc.names=fc,pc.registerCopy=zd,pc.registerCut=Wd,pc.registerDefaultShortcuts=z_,pc.registerDelete=Vc,pc.registerEscape=ah,pc.registerPaste=Xd,pc.registerRedo=jd,pc.registerUndo=am;var wG=class{constructor(t,o){this.procedureModelClass=t,this.parameterModelClass=o,this.priority=BI}save(t){return t=t.getProcedureMap().getProcedures().map(o=>lh(o)),t.length?t:null}load(t,o){const c=o.getProcedureMap();for(const g of t)c.add(Yd(this.procedureModelClass,this.parameterModelClass,g,o))}clear(t){t.getProcedureMap().clear()}},by={};by.ProcedureSerializer=wG,by.loadProcedure=Yd,by.saveProcedure=lh;var I1=class{constructor(){this.priority=DI}save(t){const o=[];for(const c of t.getAllVariables())t={name:c.name,id:c.getId()},c.type&&(t.type=c.type),o.push(t);return o.length?o:null}load(t,o){for(const c of t)o.createVariable(c.name,c.type,c.id)}clear(t){t.getVariableMap().clear()}};hi("variables",new I1);var O1={};O1.VariableSerializer=I1;var uA={};uA.load=Rn,uA.save=zi;var MG={blocks:ov,exceptions:cf,priorities:sG,procedures:by,registry:gb,variables:O1,workspaceComments:ZE,workspaces:uA},hA=class{constructor(t,o,c,g,$){this.workspace=t,this.oldHostMetrics_=this.corner_=this.vScroll=this.hScroll=null,o=o===void 0?!0:o,c=c===void 0?!0:c;const M=o&&c;o&&(this.hScroll=new ur(t,!0,M,g,$)),c&&(this.vScroll=new ur(t,!1,M,g,$)),M&&(this.corner_=Ce(Ve.RECT,{height:ur.scrollbarThickness,width:ur.scrollbarThickness,class:"blocklyScrollbarBackground"}),ot(this.corner_,t.getBubbleCanvas()))}dispose(){W(this.corner_),this.oldHostMetrics_=this.corner_=null,this.hScroll&&(this.hScroll.dispose(),this.hScroll=null),this.vScroll&&(this.vScroll.dispose(),this.vScroll=null)}resize(){const t=this.workspace.getMetrics();if(t){var o=!1,c=!1;if(this.oldHostMetrics_&&this.oldHostMetrics_.viewWidth===t.viewWidth&&this.oldHostMetrics_.viewHeight===t.viewHeight&&this.oldHostMetrics_.absoluteTop===t.absoluteTop&&this.oldHostMetrics_.absoluteLeft===t.absoluteLeft?(this.oldHostMetrics_&&this.oldHostMetrics_.scrollWidth===t.scrollWidth&&this.oldHostMetrics_.viewLeft===t.viewLeft&&this.oldHostMetrics_.scrollLeft===t.scrollLeft||(o=!0),this.oldHostMetrics_&&this.oldHostMetrics_.scrollHeight===t.scrollHeight&&this.oldHostMetrics_.viewTop===t.viewTop&&this.oldHostMetrics_.scrollTop===t.scrollTop||(c=!0)):c=o=!0,o||c){try{n.disable$$module$build$src$core$events$utils(),this.hScroll&&o&&this.hScroll.resize(t),this.vScroll&&c&&this.vScroll.resize(t)}finally{n.enable$$module$build$src$core$events$utils()}this.workspace.maybeFireViewportChangeEvent()}if(this.hScroll&&this.vScroll){if(!this.oldHostMetrics_||this.oldHostMetrics_.viewWidth!==t.viewWidth||this.oldHostMetrics_.absoluteLeft!==t.absoluteLeft){let g;(g=this.corner_)==null||g.setAttribute("x",String(this.vScroll.position.x))}if(!this.oldHostMetrics_||this.oldHostMetrics_.viewHeight!==t.viewHeight||this.oldHostMetrics_.absoluteTop!==t.absoluteTop){let g;(g=this.corner_)==null||g.setAttribute("y",String(this.hScroll.position.y))}}this.oldHostMetrics_=t}}canScrollHorizontally(){return!!this.hScroll}canScrollVertically(){return!!this.vScroll}setOrigin(t,o){this.hScroll&&this.hScroll.setOrigin(t,o),this.vScroll&&this.vScroll.setOrigin(t,o)}set(t,o,c){this.hScroll&&this.hScroll.set(t,!1),this.vScroll&&this.vScroll.set(o,!1),(c||c===void 0)&&(t={},this.hScroll&&(t.x=this.hScroll.getRatio_()),this.vScroll&&(t.y=this.vScroll.getRatio_()),this.workspace.setMetrics(t))}setX(t){this.hScroll&&this.hScroll.set(t,!0)}setY(t){this.vScroll&&this.vScroll.set(t,!0)}setContainerVisible(t){this.hScroll&&this.hScroll.setContainerVisible(t),this.vScroll&&this.vScroll.setContainerVisible(t)}isVisible(){let t=!1;return this.hScroll&&(t=this.hScroll.isVisible()),this.vScroll&&(t=t||this.vScroll.isVisible()),t}setVisible(t){this.hScroll&&this.hScroll.setVisibleInternal(t),this.vScroll&&this.vScroll.setVisibleInternal(t)}resizeContent(t){this.hScroll&&this.hScroll.resizeContentHorizontal(t),this.vScroll&&this.vScroll.resizeContentVertical(t)}resizeView(t){this.hScroll&&this.hScroll.resizeViewHorizontal(t),this.vScroll&&this.vScroll.resizeViewVertical(t)}},dA=class{constructor(t){this.workspace_=t}getDimensionsPx_(t){let o=0,c=0;return t&&(o=t.getWidth(),c=t.getHeight()),new Kn(o,c)}getFlyoutMetrics(t){return t=this.getDimensionsPx_(this.workspace_.getFlyout(t)),{width:t.width,height:t.height,position:this.workspace_.toolboxPosition}}getToolboxMetrics(){const t=this.getDimensionsPx_(this.workspace_.getToolbox());return{width:t.width,height:t.height,position:this.workspace_.toolboxPosition}}getSvgMetrics(){return this.workspace_.getCachedParentSvgSize()}getAbsoluteMetrics(){let t=0,o=0;const c=this.getToolboxMetrics(),g=this.getFlyoutMetrics(),$=!!this.workspace_.getToolbox();var M;const Q=!((M=this.workspace_.getFlyout())!=null&&M.autoClose);M=$?c.position:g.position;const be=M===Cn.TOP;return M===Cn.LEFT&&($&&(t+=c.width),Q&&(t+=g.width)),be&&($&&(o+=c.height),Q&&(o+=g.height)),{top:o,left:t}}getViewMetrics(t){t=t?this.workspace_.scale:1;const o=this.getSvgMetrics(),c=this.getToolboxMetrics(),g=this.getFlyoutMetrics(),$=!!this.workspace_.getToolbox();var M;const Q=!((M=this.workspace_.getFlyout())!=null&&M.autoClose);M=$?c.position:g.position;const be=M===Cn.LEFT||M===Cn.RIGHT;return(M===Cn.TOP||M===Cn.BOTTOM)&&($&&(o.height-=c.height),Q&&(o.height-=g.height)),be&&($&&(o.width-=c.width),Q&&(o.width-=g.width)),{height:o.height/t,width:o.width/t,top:-this.workspace_.scrollY/t,left:-this.workspace_.scrollX/t}}getContentMetrics(t){t=t?1:this.workspace_.scale;const o=this.workspace_.getBlocksBoundingBox();return{height:(o.bottom-o.top)*t,width:(o.right-o.left)*t,top:o.top*t,left:o.left*t}}hasFixedEdges(){return!this.workspace_.isMovableHorizontally()||!this.workspace_.isMovableVertically()}getComputedFixedEdges_(t){if(!this.hasFixedEdges())return{};const o=this.workspace_.isMovableHorizontally(),c=this.workspace_.isMovableVertically();t=t||this.getViewMetrics(!1);const g={};return c||(g.top=t.top,g.bottom=t.top+t.height),o||(g.left=t.left,g.right=t.left+t.width),g}getPaddedContent_(t,o){const c=o.top+o.height,g=o.left+o.width,$=t.width;t=t.height;const M=$/2,Q=t/2;return{top:Math.min(o.top-Q,c-t),bottom:Math.max(c+Q,o.top+t),left:Math.min(o.left-M,g-$),right:Math.max(g+M,o.left+$)}}getScrollMetrics(t,o,c){t=t?this.workspace_.scale:1,o=o||this.getViewMetrics(!1);var g=c||this.getContentMetrics();c=this.getComputedFixedEdges_(o),o=this.getPaddedContent_(o,g),g=c.top!==void 0?c.top:o.top;const $=c.left!==void 0?c.left:o.left;return{top:g/t,left:$/t,width:((c.right!==void 0?c.right:o.right)-$)/t,height:((c.bottom!==void 0?c.bottom:o.bottom)-g)/t}}getUiMetrics(){return{viewMetrics:this.getViewMetrics(),absoluteMetrics:this.getAbsoluteMetrics(),toolboxMetrics:this.getToolboxMetrics()}}getMetrics(){const t=this.getToolboxMetrics(),o=this.getFlyoutMetrics(!0),c=this.getSvgMetrics(),g=this.getAbsoluteMetrics(),$=this.getViewMetrics(),M=this.getContentMetrics(),Q=this.getScrollMetrics(!1,$,M);return{contentHeight:M.height,contentWidth:M.width,contentTop:M.top,contentLeft:M.left,scrollHeight:Q.height,scrollWidth:Q.width,scrollTop:Q.top,scrollLeft:Q.left,viewHeight:$.height,viewWidth:$.width,viewTop:$.top,viewLeft:$.left,absoluteTop:g.top,absoluteLeft:g.left,svgHeight:c.height,svgWidth:c.width,toolboxWidth:t.width,toolboxHeight:t.height,toolboxPosition:t.position,flyoutWidth:o.width,flyoutHeight:o.height}}};r(yt.METRICS_MANAGER,yo,dA),"Blockly"in globalThis||(globalThis.Blockly={Msg:OI});var L1=class extends gy{constructor(){super(),this.GRID_UNIT=4,this.CURSOR_COLOUR="#ffa200",this.CURSOR_RADIUS=5,this.JAGGED_TEETH_WIDTH=this.JAGGED_TEETH_HEIGHT=0,this.START_HAT_HEIGHT=22,this.START_HAT_WIDTH=96,this.SHAPES={HEXAGONAL:1,ROUND:2,SQUARE:3,PUZZLE:4,NOTCH:5},this.SHAPE_IN_SHAPE_PADDING={1:{0:5*this.GRID_UNIT,1:2*this.GRID_UNIT,2:5*this.GRID_UNIT,3:5*this.GRID_UNIT},2:{0:3*this.GRID_UNIT,1:3*this.GRID_UNIT,2:1*this.GRID_UNIT,3:2*this.GRID_UNIT},3:{0:2*this.GRID_UNIT,1:2*this.GRID_UNIT,2:2*this.GRID_UNIT,3:2*this.GRID_UNIT}},this.FULL_BLOCK_FIELDS=!0,this.FIELD_TEXT_FONTWEIGHT="bold",this.FIELD_TEXT_FONTFAMILY='"Helvetica Neue", "Segoe UI", Helvetica, sans-serif',this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!0,this.SELECTED_GLOW_COLOUR="#fff200",this.SELECTED_GLOW_SIZE=.5,this.REPLACEMENT_GLOW_COLOUR="#fff200",this.REPLACEMENT_GLOW_SIZE=2,this.selectedGlowFilterId="",this.selectedGlowFilter=null,this.replacementGlowFilterId="",this.SQUARED=this.ROUNDED=this.HEXAGONAL=this.replacementGlowFilter=null,this.SMALL_PADDING=this.GRID_UNIT,this.MEDIUM_PADDING=2*this.GRID_UNIT,this.MEDIUM_LARGE_PADDING=3*this.GRID_UNIT,this.LARGE_PADDING=4*this.GRID_UNIT,this.CORNER_RADIUS=1*this.GRID_UNIT,this.NOTCH_WIDTH=9*this.GRID_UNIT,this.NOTCH_HEIGHT=2*this.GRID_UNIT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT=3*this.GRID_UNIT,this.MIN_BLOCK_WIDTH=2*this.GRID_UNIT,this.MIN_BLOCK_HEIGHT=12*this.GRID_UNIT,this.EMPTY_STATEMENT_INPUT_HEIGHT=6*this.GRID_UNIT,this.TOP_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=6*this.GRID_UNIT,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT,this.STATEMENT_INPUT_SPACER_MIN_WIDTH=40*this.GRID_UNIT,this.STATEMENT_INPUT_PADDING_LEFT=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_PADDING=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_MIN_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=6*this.GRID_UNIT,this.CURSOR_WS_WIDTH=20*this.GRID_UNIT,this.FIELD_TEXT_FONTSIZE=3*this.GRID_UNIT,this.FIELD_BORDER_RECT_RADIUS=this.CORNER_RADIUS,this.FIELD_BORDER_RECT_X_PADDING=2*this.GRID_UNIT,this.FIELD_BORDER_RECT_Y_PADDING=1.625*this.GRID_UNIT,this.FIELD_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_COLOUR_DEFAULT_WIDTH=6*this.GRID_UNIT,this.FIELD_COLOUR_DEFAULT_HEIGHT=8*this.GRID_UNIT,this.FIELD_CHECKBOX_X_OFFSET=1*this.GRID_UNIT,this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH=12*this.GRID_UNIT}setFontConstants_(t){super.setFontConstants_(t),this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT=this.FIELD_TEXT_HEIGHT+2*this.FIELD_BORDER_RECT_Y_PADDING}init(){super.init(),this.HEXAGONAL=this.makeHexagonal(),this.ROUNDED=this.makeRounded(),this.SQUARED=this.makeSquared(),this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT+this.INSIDE_CORNERS.rightWidth}setDynamicProperties_(t){super.setDynamicProperties_(t),this.SELECTED_GLOW_COLOUR=t.getComponentStyle("selectedGlowColour")||this.SELECTED_GLOW_COLOUR;const o=Number(t.getComponentStyle("selectedGlowSize"));this.SELECTED_GLOW_SIZE=o&&!isNaN(o)?o:this.SELECTED_GLOW_SIZE,this.REPLACEMENT_GLOW_COLOUR=t.getComponentStyle("replacementGlowColour")||this.REPLACEMENT_GLOW_COLOUR,this.REPLACEMENT_GLOW_SIZE=(t=Number(t.getComponentStyle("replacementGlowSize")))&&!isNaN(t)?t:this.REPLACEMENT_GLOW_SIZE}dispose(){super.dispose(),this.selectedGlowFilter&&W(this.selectedGlowFilter),this.replacementGlowFilter&&W(this.replacementGlowFilter)}makeStartHat(){const t=this.START_HAT_HEIGHT,o=this.START_HAT_WIDTH,c=fs("c",[zt(25,-t),zt(71,-t),zt(o,0)]);return{height:t,width:o,path:c}}makeHexagonal(){function t(c,g,$){var M=c/2;return M=M>o?o:M,$=$?-1:1,c=(g?-1:1)*c/2,Xo(-$*M,c)+Xo($*M,c)}const o=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;return{type:this.SHAPES.HEXAGONAL,isDynamic:!0,width(c){return c/=2,c>o?o:c},height(c){return c},connectionOffsetY(c){return c/2},connectionOffsetX(c){return-c},pathDown(c){return t(c,!1,!1)},pathUp(c){return t(c,!0,!1)},pathRightDown(c){return t(c,!1,!0)},pathRightUp(c){return t(c,!1,!0)}}}makeRounded(){function t(g,$,M){const Q=g>c?g-c:0;g=(g>c?c:g)/2;const be=M===$?"0":"1";return Di("a","0 0,"+be,g,zt((M?1:-1)*g,($?-1:1)*g))+Nt("v",($?-1:1)*Q)+Di("a","0 0,"+be,g,zt((M?-1:1)*g,($?-1:1)*g))}const o=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,c=2*o;return{type:this.SHAPES.ROUND,isDynamic:!0,width(g){return g/=2,g>o?o:g},height(g){return g},connectionOffsetY(g){return g/2},connectionOffsetX(g){return-g},pathDown(g){return t(g,!1,!1)},pathUp(g){return t(g,!0,!1)},pathRightDown(g){return t(g,!1,!0)},pathRightUp(g){return t(g,!1,!0)}}}makeSquared(){function t(c,g,$){c-=2*o;const M=$===g?"0":"1";return Di("a","0 0,"+M,o,zt(($?1:-1)*o,(g?-1:1)*o))+Nt("v",(g?-1:1)*c)+Di("a","0 0,"+M,o,zt(($?-1:1)*o,(g?-1:1)*o))}const o=this.CORNER_RADIUS;return{type:this.SHAPES.SQUARE,isDynamic:!0,width(c){return o},height(c){return c},connectionOffsetY(c){return c/2},connectionOffsetX(c){return-c},pathDown(c){return t(c,!1,!1)},pathUp(c){return t(c,!0,!1)},pathRightDown(c){return t(c,!1,!0)},pathRightUp(c){return t(c,!1,!0)}}}shapeFor(t){let o=t.getCheck();switch(!o&&t.targetConnection&&(o=t.targetConnection.getCheck()),t.type){case Bt.INPUT_VALUE:case Bt.OUTPUT_VALUE:if(t=t.getSourceBlock().getOutputShape(),t!==null)switch(t){case this.SHAPES.HEXAGONAL:return this.HEXAGONAL;case this.SHAPES.ROUND:return this.ROUNDED;case this.SHAPES.SQUARE:return this.SQUARED}return o&&o.includes("Boolean")?this.HEXAGONAL:o&&o.includes("Number")?this.ROUNDED:(o&&o.includes("String"),this.ROUNDED);case Bt.PREVIOUS_STATEMENT:case Bt.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown type")}}makeNotch(){function t(Dt){return fs("c",[zt(Dt*$/2,0),zt(Dt*$*3/4,Q/2),zt(Dt*$,Q)])+rl([zt(Dt*$,M)])+fs("c",[zt(Dt*$/4,Q/2),zt(Dt*$/2,Q),zt(Dt*$,Q)])+Nt("h",Dt*g)+fs("c",[zt(Dt*$/2,0),zt(Dt*$*3/4,-(Q/2)),zt(Dt*$,-Q)])+rl([zt(Dt*$,-M)])+fs("c",[zt(Dt*$/4,-(Q/2)),zt(Dt*$/2,-Q),zt(Dt*$,-Q)])}const o=this.NOTCH_WIDTH,c=this.NOTCH_HEIGHT,g=o/3,$=g/3,M=c/2,Q=M/2,be=t(1),nt=t(-1);return{type:this.SHAPES.NOTCH,width:o,height:c,pathLeft:be,pathRight:nt}}makeInsideCorners(){const t=this.CORNER_RADIUS,o=Di("a","0 0,0",t,zt(-t,t)),c=Di("a","0 0,1",t,zt(-t,t)),g=Di("a","0 0,0",t,zt(t,t)),$=Di("a","0 0,1",t,zt(t,t));return{width:t,height:t,pathTop:o,pathBottom:g,rightWidth:t,rightHeight:t,pathTopRight:c,pathBottomRight:$}}generateSecondaryColour_(t){return Go("#000",t,.15)||t}generateTertiaryColour_(t){return Go("#000",t,.25)||t}createDom(t,o,c){super.createDom(t,o,c),t=Ce(Ve.DEFS,{},t),o=Ce(Ve.FILTER,{id:"blocklySelectedGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},t),Ce(Ve.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.SELECTED_GLOW_SIZE},o),c=Ce(Ve.FECOMPONENTTRANSFER,{result:"outBlur"},o),Ce(Ve.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},c),Ce(Ve.FEFLOOD,{"flood-color":this.SELECTED_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},o),Ce(Ve.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},o),this.selectedGlowFilterId=o.id,this.selectedGlowFilter=o,t=Ce(Ve.FILTER,{id:"blocklyReplacementGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},t),Ce(Ve.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.REPLACEMENT_GLOW_SIZE},t),o=Ce(Ve.FECOMPONENTTRANSFER,{result:"outBlur"},t),Ce(Ve.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},o),Ce(Ve.FEFLOOD,{"flood-color":this.REPLACEMENT_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},t),Ce(Ve.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},t),Ce(Ve.FECOMPOSITE,{in:"SourceGraphic",in2:"outGlow",operator:"over"},t),this.replacementGlowFilterId=t.id,this.replacementGlowFilter=t}getCSS_(t){return[`${t} .blocklyText,`,`${t} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${t} .blocklyTextInputBubble textarea {`,"font-weight: normal;","}",`${t} .blocklyText {`,"fill: #fff;","}",`${t} .blocklyNonEditableText>rect:not(.blocklyDropdownRect),`,`${t} .blocklyEditableText>rect:not(.blocklyDropdownRect) {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"}",`${t} .blocklyNonEditableText>text,`,`${t} .blocklyEditableText>text,`,`${t} .blocklyNonEditableText>g>text,`,`${t} .blocklyEditableText>g>text {`,"fill: #575E75;","}",`${t} .blocklyFlyoutLabelText {`,"fill: #575E75;","}",`${t} .blocklyText.blocklyBubbleText {`,"fill: #575E75;","}",`${t} .blocklyDraggable:not(.blocklyDisabled)`," .blocklyEditableText:not(.editing):hover>rect,",`${t} .blocklyDraggable:not(.blocklyDisabled)`," .blocklyEditableText:not(.editing):hover>.blocklyPath {","stroke: #fff;","stroke-width: 2;","}",`${t} .blocklyHtmlInput {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"color: #575E75;","}",`${t} .blocklyDropdownText {`,"fill: #fff !important;","}",`${t}.blocklyWidgetDiv .goog-menuitem,`,`${t}.blocklyDropDownDiv .goog-menuitem {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${t}.blocklyDropDownDiv .goog-menuitem-content {`,"color: #fff;","}",`${t} .blocklyHighlightedConnectionPath {`,`stroke: ${this.SELECTED_GLOW_COLOUR};`,"}",`${t} .blocklyDisabled > .blocklyOutlinePath {`,`fill: url(#blocklyDisabledPattern${this.randomIdentifier})`,"}",`${t} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"]}},N1=class extends _y{constructor(t,o){super(t,o)}draw(){const t=this.block_.pathObject;t.beginDrawing(),this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),t.setPath(this.outlinePath_+`
`+this.inlinePath_),this.info_.RTL&&t.flipRTL(),this.recordSizeOnBlock_(),this.info_.outputConnection&&(t.outputShapeType=this.info_.outputConnection.shape.type),t.endDrawing()}drawOutline_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape&&!this.info_.hasStatementInput&&!this.info_.bottomRow.hasNextConnection?(this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_()):super.drawOutline_()}drawLeft_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape?this.drawLeftDynamicConnection_():super.drawLeft_()}drawRightSideRow_(t){if(!(0>=t.height)){if(ke.isSpacer(t)){const g=t.precedesStatement;var o=t.followsStatement;if(g||o){const $=this.constants_.INSIDE_CORNERS;var c=$.rightHeight;c=t.height-(g?c:0),o=o?$.pathBottomRight:"",t=0<c?Nt("V",t.yPos+c):"",this.outlinePath_+=o+t+(g?$.pathTopRight:"");return}}this.outlinePath_+=Nt("V",t.yPos+t.height)}}drawRightDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.outlinePath_+=this.info_.outputConnection.shape.pathRightDown(this.info_.outputConnection.height)}drawLeftDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.positionOutputConnection_(),this.outlinePath_+=this.info_.outputConnection.shape.pathUp(this.info_.outputConnection.height),this.outlinePath_+="z"}drawFlatTop_(){const t=this.info_.topRow;this.positionPreviousConnection_(),this.outlinePath_+=Si(t.xPos,this.info_.startY),this.outlinePath_+=Nt("h",t.width)}drawFlatBottom_(){const t=this.info_.bottomRow;this.positionNextConnection_(),this.outlinePath_+=Nt("V",t.baseline),this.outlinePath_+=Nt("h",-t.width)}drawInlineInput_(t){this.positionInlineInputConnection_(t);const o=t.input.name;t.connectedBlock||this.info_.isInsertionMarker||(t=Zi(t.xPos+t.connectionWidth,t.centerline-t.height/2)+this.getInlineInputPath(t),this.block_.pathObject.setOutlinePath(o,t))}getInlineInputPath(t){const o=t.width-2*t.connectionWidth,c=t.height;return Nt("h",o)+t.shape.pathRightDown(c)+Nt("h",-o)+t.shape.pathUp(c)+"z"}drawStatementInput_(t){var o=t.getLastInput();const c=o.xPos+o.notchOffset+o.shape.width,g=this.constants_.INSIDE_CORNERS,$=o.shape.pathRight+Nt("h",-(o.notchOffset-g.width))+g.pathTop,M=t.height-2*g.height;o=g.pathBottom+Nt("h",o.notchOffset-g.width)+(o.connectedBottomNextConnection?"":o.shape.pathLeft),this.outlinePath_+=Nt("H",c)+$+Nt("v",M)+o+Nt("H",t.xPos+t.width),this.positionStatementInputConnection_(t)}drawConnectionHighlightPath(t){const o=t.connectionModel;if(o.type===Bt.NEXT_STATEMENT||o.type===Bt.PREVIOUS_STATEMENT||o.type===Bt.OUTPUT_VALUE&&!t.isDynamicShape)super.drawConnectionHighlightPath(t);else{t=o.type===Bt.INPUT_VALUE?Zi(t.connectionWidth,-t.height/2)+this.getInlineInputPath(t):Zi(t.width,-t.height/2)+t.shape.pathDown(t.height);var c=o.getSourceBlock(),g,$;($=(g=c.pathObject).addConnectionHighlight)==null||$.call(g,o,t,o.getOffsetInBlock(),c.RTL)}}},yf=class extends bi{constructor(t,o,c,g,$,M,Q){if(super(bi.SKIP_SETUP),this.imageElement=this.clickHandler=null,this.flipRtl=this.isDirty_=this.EDITABLE=!1,this.altText="",c=Number(yi(c)),o=Number(yi(o)),isNaN(c)||isNaN(o))throw Error("Height and width values of an image field must cast to numbers.");if(0>=c||0>=o)throw Error("Height and width values of an image field must be greater than 0.");this.size_=new Kn(o,c+yf.Y_PADDING),this.imageHeight=c,typeof $=="function"&&(this.clickHandler=$),t!==bi.SKIP_SETUP&&(Q?this.configure_(Q):(this.flipRtl=!!M,this.altText=yi(g)||""),this.setValue(yi(t)))}configure_(t){super.configure_(t),t.flipRtl&&(this.flipRtl=t.flipRtl),t.alt&&(this.altText=yi(t.alt))}initView(){this.imageElement=Ce(Ve.IMAGE,{height:this.imageHeight+"px",width:this.size_.width+"px",alt:this.altText},this.fieldGroup_),this.imageElement.setAttributeNS(Zo,"xlink:href",this.value_),this.clickHandler&&(this.imageElement.style.cursor="pointer")}updateSize_(){}doClassValidation_(t){return typeof t!="string"?null:t}doValueUpdate_(t){this.value_=t,this.imageElement&&this.imageElement.setAttributeNS(Zo,"xlink:href",this.value_)}getFlipRtl(){return this.flipRtl}setAlt(t){t!==this.altText&&(this.altText=t||"",this.imageElement&&this.imageElement.setAttribute("alt",this.altText))}showEditor_(){this.clickHandler&&this.clickHandler(this)}setOnClickHandler(t){this.clickHandler=t}getText_(){return this.altText}static fromJson(t){if(!t.src||!t.width||!t.height)throw Error("src, width, and height values for an image field arerequired. The width and height must be non-zero.");return new this(t.src,t.width,t.height,void 0,void 0,void 0,t)}};yf.Y_PADDING=1,zo("field_image",yf),yf.prototype.DEFAULT_VALUE="";var Ay=class extends bi{constructor(t,o,c){super(bi.SKIP_SETUP),this.spellcheck_=!0,this.htmlInput_=null,this.isTextValid_=this.isBeingEdited_=!1,this.onKeyInputWrapper_=this.onKeyDownWrapper_=this.valueWhenEditorWasOpened_=null,this.fullBlockClickTarget_=!1,this.workspace_=null,this.SERIALIZABLE=!0,this.CURSOR="text",t!==bi.SKIP_SETUP&&(c&&this.configure_(c),this.setValue(t),o&&this.setValidator(o))}configure_(t){super.configure_(t),t.spellcheck!==void 0&&(this.spellcheck_=t.spellcheck)}initView(){if(!this.getSourceBlock())throw new hr;super.initView(),this.isFullBlockField()&&(this.clickTarget_=this.sourceBlock_.getSvgRoot())}isFullBlockField(){const t=this.getSourceBlock();if(!t)throw new hr;let o;return this.fullBlockClickTarget_=!((o=this.getConstants())==null||!o.FULL_BLOCK_FIELDS)&&t.isSimpleReporter()}doValueInvalid_(t,o=!0){this.isBeingEdited_&&(this.isDirty_=!0,this.isTextValid_=!1,t=this.value_,this.value_=this.valueWhenEditorWasOpened_,this.sourceBlock_&&R()&&this.value_!==t&&o&&b(new(k(n.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock_,"field",this.name||null,t,this.value_)))}doValueUpdate_(t){this.isTextValid_=this.isDirty_=!0,this.value_=t}applyColour(){const t=this.getSourceBlock();if(!t)throw new hr;this.getConstants().FULL_BLOCK_FIELDS&&this.fieldGroup_&&(!this.isFullBlockField()&&this.borderRect_?(this.borderRect_.style.display="block",this.borderRect_.setAttribute("stroke",t.style.colourTertiary)):(this.borderRect_.style.display="none",t.pathObject.svgPath.setAttribute("fill",this.getConstants().FIELD_BORDER_RECT_COLOUR)))}getSize(){let t;return(t=this.getConstants())!=null&&t.FULL_BLOCK_FIELDS&&(this.render_(),this.isDirty_=!1),super.getSize()}onLocationChange(){this.isBeingEdited_&&this.resizeEditor_()}render_(){if(super.render_(),this.isBeingEdited_){var t=this.htmlInput_;this.isTextValid_?(oe(t,"blocklyInvalidInput"),Ei(t,zr.INVALID,!1)):(Me(t,"blocklyInvalidInput"),Ei(t,zr.INVALID,!0))}if(t=this.getSourceBlock(),!t)throw new hr;this.getConstants().FULL_BLOCK_FIELDS&&t.applyColour()}setSpellcheck(t){t!==this.spellcheck_&&(this.spellcheck_=t,this.htmlInput_&&this.htmlInput_.setAttribute("spellcheck",this.spellcheck_))}showEditor_(t,o=!1){this.workspace_=this.sourceBlock_.workspace,!o&&this.workspace_.options.modalInputs&&(_I||eb||Z_)?this.showPromptEditor_():this.showInlineEditor_(o)}showPromptEditor_(){pt(n.Msg$$module$build$src$core$msg.CHANGE_VALUE_TITLE,this.getText(),t=>{t!==null&&this.setValue(this.getValueFromEditorText_(t)),this.onFinishEditing_(this.value_)})}showInlineEditor_(t){const o=this.getSourceBlock();if(!o)throw new hr;Vu(this,o.RTL,this.widgetDispose_.bind(this),this.workspace_),this.htmlInput_=this.widgetCreate_(),this.isBeingEdited_=!0,this.valueWhenEditorWasOpened_=this.value_,t||(this.htmlInput_.focus({preventScroll:!0}),this.htmlInput_.select())}widgetCreate_(){var t=this.getSourceBlock();if(!t)throw new hr;n.setGroup$$module$build$src$core$events$utils(!0);const o=gi();var c=this.getClickTarget_();if(!c)throw Error("A click target has not been set.");Me(c,"editing"),c=document.createElement("input"),c.className="blocklyHtmlInput",c.setAttribute("spellcheck",this.spellcheck_);const g=this.workspace_.getScale();var $=this.getConstants().FIELD_TEXT_FONTSIZE*g+"pt";return o.style.fontSize=$,c.style.fontSize=$,$=Ay.BORDERRADIUS*g+"px",this.isFullBlockField()&&($=this.getScaledBBox(),$=($.bottom-$.top)/2+"px",t=t.getParent()?t.getParent().style.colourTertiary:this.sourceBlock_.style.colourTertiary,c.style.border=1*g+"px solid "+t,o.style.borderRadius=$,o.style.transition="box-shadow 0.25s ease 0s",this.getConstants().FIELD_TEXTINPUT_BOX_SHADOW&&(o.style.boxShadow="rgba(255, 255, 255, 0.3) 0 0 0 "+4*g+"px")),c.style.borderRadius=$,o.appendChild(c),c.value=c.defaultValue=this.getEditorText_(this.value_),c.setAttribute("data-untyped-default-value",String(this.value_)),this.resizeEditor_(),this.bindInputEvents_(c),c}widgetDispose_(){this.isBeingEdited_=!1,this.isTextValid_=!0,this.forceRerender(),this.onFinishEditing_(this.value_),this.sourceBlock_&&R()&&this.valueWhenEditorWasOpened_!==null&&this.valueWhenEditorWasOpened_!==this.value_&&(b(new(k(n.CHANGE$$module$build$src$core$events$utils))(this.sourceBlock_,"field",this.name||null,this.valueWhenEditorWasOpened_,this.value_)),this.valueWhenEditorWasOpened_=null),n.setGroup$$module$build$src$core$events$utils(!1),this.unbindInputEvents_();var t=gi().style;if(t.width="auto",t.height="auto",t.fontSize="",t.transition="",t.boxShadow="",this.htmlInput_=null,t=this.getClickTarget_(),!t)throw Error("A click target has not been set.");oe(t,"editing")}onFinishEditing_(t){}bindInputEvents_(t){this.onKeyDownWrapper_=Ue(t,"keydown",this,this.onHtmlInputKeyDown_),this.onKeyInputWrapper_=Ue(t,"input",this,this.onHtmlInputChange_)}unbindInputEvents_(){this.onKeyDownWrapper_&&(re(this.onKeyDownWrapper_),this.onKeyDownWrapper_=null),this.onKeyInputWrapper_&&(re(this.onKeyInputWrapper_),this.onKeyInputWrapper_=null)}onHtmlInputKeyDown_(t){t.key==="Enter"?(Eo(this),Uo()):t.key==="Escape"?(this.setValue(this.htmlInput_.getAttribute("data-untyped-default-value"),!1),Eo(this),Uo()):t.key==="Tab"&&(Eo(this),Uo(),this.sourceBlock_.tab(this,!t.shiftKey),t.preventDefault())}onHtmlInputChange_(t){t=this.value_,this.setValue(this.getValueFromEditorText_(this.htmlInput_.value),!1),this.sourceBlock_&&R()&&this.value_!==t&&b(new(k(Kc))(this.sourceBlock_,this.name||null,t,this.value_))}setEditorValue_(t,o=!0){this.isDirty_=!0,this.isBeingEdited_&&(this.htmlInput_.value=this.getEditorText_(t)),this.setValue(t,o)}resizeEditor_(){var t=this.getSourceBlock();if(!t)throw new hr;const o=gi(),c=this.getScaledBBox();o.style.width=c.right-c.left+"px",o.style.height=c.bottom-c.top+"px",t=new At(t.RTL?c.right-o.offsetWidth:c.left,c.top),o.style.left=t.x+"px",o.style.top=t.y+"px"}repositionForWindowResize(){const t=this.getSourceBlock();return t instanceof Na?(sh(this.workspace_,this.workspace_.getMetricsManager().getViewMetrics(!0),t)||this.resizeEditor_(),!0):!1}isTabNavigable(){return!0}getText_(){return this.isBeingEdited_&&this.htmlInput_?this.htmlInput_.value:null}getEditorText_(t){return`${t}`}getValueFromEditorText_(t){return t}};Ay.BORDERRADIUS=4;var Cy=class extends Ay{constructor(t,o,c){super(t,o,c)}doClassValidation_(t){return t===void 0?null:`${t}`}static fromJson(t){return new this(yi(t.text),void 0,t)}};zo("field_input",Cy),Cy.prototype.DEFAULT_VALUE="";var k1=class extends Gb{constructor(t){super(t)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(t){return!!t.outputConnection}hasRightSquareCorner(t){return!!t.outputConnection&&!t.statementInputCount&&!t.nextConnection}},xy=class extends mv{constructor(t,o){if(super(t,o),this.connectedBottomNextConnection=!1,this.connectedBlock){for(t=this.connectedBlock;o=t.getNextBlock();)t=o;t.nextConnection||(this.height=this.connectedBlockHeight,this.connectedBottomNextConnection=!0)}}},P1=class extends hc{constructor(t){super(t),this.width=this.height=0,this.type|=ke.getType("RIGHT_CONNECTION")}},D1=class extends Xb{constructor(t){super(t)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(t){const o=(t.hat?t.hat==="cap":this.constants_.ADD_START_HATS)&&!t.outputConnection&&!t.previousConnection;return!!t.outputConnection||o}hasRightSquareCorner(t){return!!t.outputConnection&&!t.statementInputCount&&!t.nextConnection}},B1=class extends vv{constructor(t,o){super(t,o),this.isInline=!0,this.renderer_=t,this.constants_=this.renderer_.getConstants(),this.topRow=new D1(this.constants_),this.bottomRow=new k1(this.constants_),this.isMultiRow=!o.getInputsInline()||o.isCollapsed(),this.hasStatementInput=0<o.statementInputCount,this.rightSide=this.outputConnection?new P1(this.constants_):null,this.rightAlignedDummyInputs=new WeakMap}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.adjustXPosition_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}shouldStartNewRow_(t,o){return o?o instanceof lu||t instanceof ta||o instanceof ta?!0:t instanceof n.ValueInput$$module$build$src$core$inputs$value_input||t instanceof dc||t instanceof lu?!this.isInline||this.isMultiRow:!1:!1}getDesiredRowWidth_(t){return t.hasStatement?this.width-this.startX-(this.constants_.INSIDE_CORNERS.rightWidth||0):super.getDesiredRowWidth_(t)}getInRowSpacing_(t,o){return t&&o||!this.outputConnection||!this.outputConnection.isDynamicShape||this.hasStatementInput||this.bottomRow.hasNextConnection?!t&&o&&ke.isStatementInput(o)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:t&&ke.isLeftRoundedCorner(t)&&o&&(ke.isPreviousConnection(o)||ke.isNextConnection(o))?o.notchOffset-this.constants_.CORNER_RADIUS:t&&ke.isLeftSquareCorner(t)&&o&&ke.isHat(o)?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:this.constants_.NO_PADDING}getSpacerRowHeight_(t,o){if(ke.isTopRow(t)&&ke.isBottomRow(o))return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;const c=ke.isInputRow(t)&&t.hasStatement,g=ke.isInputRow(o)&&o.hasStatement;return g||c?(t=Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.INSIDE_CORNERS.rightHeight||0),g&&c?Math.max(t,this.constants_.DUMMY_INPUT_MIN_HEIGHT):t):ke.isTopRow(t)?t.hasPreviousConnection||this.outputConnection&&!this.hasStatementInput?this.constants_.NO_PADDING:Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):ke.isBottomRow(o)?this.outputConnection?!o.hasNextConnection&&this.hasStatementInput?Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):this.constants_.NO_PADDING:Math.max(this.topRow.minHeight,Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.CORNER_RADIUS))-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING}getSpacerRowWidth_(t,o){const c=this.width-this.startX;return ke.isInputRow(t)&&t.hasStatement||ke.isInputRow(o)&&o.hasStatement?Math.max(c,this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH):c}getElemCenterline_(t,o){if(t.hasStatement&&!ke.isSpacer(o)&&!ke.isStatementInput(o))return t.yPos+this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT/2;if(ke.isInlineInput(o)&&o instanceof Ah){const c=o.connectedBlock;if(c&&c.outputConnection&&c.nextConnection)return t.yPos+c.height/2}return super.getElemCenterline_(t,o)}addInput_(t,o){if((t instanceof dc||t instanceof lu)&&o.hasDummyInput&&o.align===n.Align$$module$build$src$core$inputs$align.LEFT&&t.align===n.Align$$module$build$src$core$inputs$align.RIGHT)this.rightAlignedDummyInputs.set(o,t);else if(t instanceof ta){o.elements.push(new xy(this.constants_,t)),o.hasStatement=!0,o.align===null&&(o.align=t.align);return}super.addInput_(t,o)}addAlignmentPadding_(t,o){if(this.rightAlignedDummyInputs.get(t)){let c;for(let g=0;g<t.elements.length;g++){const $=t.elements[g];if(ke.isSpacer($)&&(c=$),ke.isField($)&&$ instanceof Am&&$.parentInput===this.rightAlignedDummyInputs.get(t))break}if(c){c.width+=o,t.width+=o;return}}super.addAlignmentPadding_(t,o)}adjustXPosition_(){const t=this.constants_.NOTCH_OFFSET_LEFT+this.constants_.NOTCH_WIDTH;let o=t;for(let $=2;$<this.rows.length-1;$+=2){var c=this.rows[$-1];const M=this.rows[$];var g=this.rows[$+1];if(c=$===2?!!this.topRow.hasPreviousConnection:!!c.followsStatement,g=$+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!g.precedesStatement,ke.isInputRow(M)&&M.hasStatement){M.measure();let Q,be;o=M.width-((be=(Q=M.getLastInput())==null?void 0:Q.width)!=null?be:0)+t}else if(c&&($===2||g)&&ke.isInputRow(M)&&!M.hasStatement){g=M.xPos,c=null;for(let Q=0;Q<M.elements.length;Q++){const be=M.elements[Q];ke.isSpacer(be)&&(c=be),c&&(ke.isField(be)||ke.isInput(be))&&g<o&&!(ke.isField(be)&&be instanceof Am&&(be.field instanceof _f||be.field instanceof yf))&&(c.width+=o-g),g+=be.width}}}}finalizeOutputConnection_(){if(this.outputConnection&&this.outputConnection.isDynamicShape){var t=this.outputConnection.shape;if("isDynamic"in t&&t.isDynamic){for(var o=0,c=0;c<this.rows.length;c++){const g=this.rows[c];g.yPos=o,o+=g.height}this.height=o,c=this.bottomRow.hasNextConnection?this.height-this.bottomRow.descenderHeight:this.height,o=t.height(c),c=t.width(c),this.outputConnection.height=o,this.outputConnection.width=c,this.outputConnection.startX=c,this.outputConnection.connectionOffsetY=t.connectionOffsetY(o),this.outputConnection.connectionOffsetX=t.connectionOffsetX(c),t=0,this.hasStatementInput||this.bottomRow.hasNextConnection||(t=c,this.rightSide.height=o,this.rightSide.width=t,this.rightSide.centerline=o/2,this.rightSide.xPos=this.width+t),this.startX=c,this.width+=c+t,this.widthWithChildren+=c+t}}}finalizeHorizontalAlignment_(){if(this.outputConnection&&!this.hasStatementInput&&!this.bottomRow.hasNextConnection){for(var t=0,o=0;o<this.rows.length;o++){var c=this.rows[o];if(!ke.isInputRow(c))continue;t=c.elements[c.elements.length-2];let g=this.getNegativeSpacing_(c.elements[1]),$=this.getNegativeSpacing_(t);t=g+$;const M=this.constants_.MIN_BLOCK_WIDTH+2*this.outputConnection.width;this.width-t<M&&(t=this.width-M,g=t/2,$=t/2),c.elements.unshift(new ea(this.constants_,-g)),c.elements.push(new ea(this.constants_,-$))}if(t)for(this.width-=t,this.widthWithChildren-=t,this.rightSide.xPos-=t,o=0;o<this.rows.length;o++)c=this.rows[o],ke.isTopOrBottomRow(c)&&(c.elements[1].width-=t),c.width-=t,c.widthWithConnectedBlocks-=t}}getNegativeSpacing_(t){if(!t||!this.outputConnection)return 0;const o=this.outputConnection.width;var c=this.outputConnection.shape.type;const g=this.constants_;if(1<this.inputRows.length)switch(c){case g.SHAPES.ROUND:return c=this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,c=this.height/2>c?c:this.height/2,o-c*(1-Math.sin(Math.acos((c-this.constants_.SMALL_PADDING)/c)));default:return 0}if(ke.isInlineInput(t)&&t instanceof Ah){const $=t.connectedBlock;return t=$?$.pathObject.outputShapeType:t.shape.type,t==null||$&&$.outputConnection&&($.statementInputCount||$.nextConnection)||c===g.SHAPES.HEXAGONAL&&c!==t?0:o-this.constants_.SHAPE_IN_SHAPE_PADDING[c][t]}return ke.isField(t)&&t instanceof Am?c===g.SHAPES.ROUND&&t.field instanceof Cy?o-2.75*g.GRID_UNIT:o-this.constants_.SHAPE_IN_SHAPE_PADDING[c][0]:ke.isIcon(t)?this.constants_.SMALL_PADDING:0}finalizeVerticalAlignment_(){if(!this.outputConnection)for(let g=2;g<this.rows.length-1;g+=2){const $=this.rows[g-1],M=this.rows[g],Q=this.rows[g+1];var t=g===2,o=g+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!Q.precedesStatement;if(t?this.topRow.hasPreviousConnection:$.followsStatement){var c=M.elements[1];if(c=M.elements.length===3&&c instanceof Am&&(c.field instanceof _f||c.field instanceof yf),!t&&c)$.height-=this.constants_.SMALL_PADDING,Q.height-=this.constants_.SMALL_PADDING,M.height-=this.constants_.MEDIUM_PADDING;else if(!t&&!o)$.height+=this.constants_.SMALL_PADDING;else if(o){for(t=!1,o=0;o<M.elements.length;o++)if(c=M.elements[o],c instanceof Ah&&ke.isInlineInput(c)&&c.connectedBlock&&!c.connectedBlock.isShadow()&&40<=c.connectedBlock.getHeightWidth().height){t=!0;break}t&&($.height-=this.constants_.SMALL_PADDING,Q.height-=this.constants_.SMALL_PADDING)}}}}finalize_(){this.finalizeOutputConnection_(),this.finalizeHorizontalAlignment_(),this.finalizeVerticalAlignment_(),super.finalize_(),this.rightSide&&(this.widthWithChildren+=this.rightSide.width)}},F1=class extends Kb{constructor(t,o,c){super(t,o,c),this.markerCircle=null}showWithInputOutput(t){const o=t.getSourceBlock();t=t.getLocation().getOffsetInBlock(),this.positionCircle(t.x,t.y),this.setParent_(o),this.showCurrent_()}showWithOutput_(t){this.showWithInputOutput(t)}showWithInput_(t){this.showWithInputOutput(t)}showWithBlock_(t){t=t.getLocation();const o=t.getHeightWidth();this.positionRect_(0,0,o.width,o.height),this.setParent_(t),this.showCurrent_()}positionCircle(t,o){let c;(c=this.markerCircle)==null||c.setAttribute("cx",`${t}`);let g;(g=this.markerCircle)==null||g.setAttribute("cy",`${o}`),this.currentMarkerSvg=this.markerCircle}hide(){super.hide(),this.markerCircle&&(this.markerCircle.style.display="none")}createDomInternal_(){if(super.createDomInternal_(),this.markerCircle=Ce(Ve.CIRCLE,{r:this.constants_.CURSOR_RADIUS,"stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.hide(),this.isCursor()){const t=this.getBlinkProperties_();Ce(Ve.ANIMATE,t,this.markerCircle)}return this.markerSvg_}applyColour_(t){super.applyColour_(t);let o;(o=this.markerCircle)==null||o.setAttribute("fill",this.colour_);let c;if((c=this.markerCircle)==null||c.setAttribute("stroke",this.colour_),this.isCursor()){t=this.colour_+";transparent;transparent;";let g;(g=this.markerCircle)==null||g.firstElementChild.setAttribute("values",t)}}},U1=class extends vy{constructor(t,o,c){super(t,o,c),this.svgPathSelected=null,this.outlines=new Map,this.remainingOutlines=new Set,this.outputShapeType=null,this.constants=c}setPath(t){super.setPath(t),this.svgPathSelected&&this.svgPathSelected.setAttribute("d",t)}applyColour(t){super.applyColour(t);const o=t.getParent();t.isShadow()&&o&&this.svgPath.setAttribute("stroke",o.style.colourTertiary);for(const c of this.outlines.values())c.setAttribute("fill",this.style.colourTertiary)}flipRTL(){super.flipRTL();for(const t of this.outlines.values())t.setAttribute("transform","scale(-1 1)")}updateSelected(t){this.setClass_("blocklySelected",t),t?this.svgPathSelected||(this.svgPathSelected=this.svgPath.cloneNode(!0),this.svgPathSelected.setAttribute("fill","none"),this.svgPathSelected.setAttribute("filter","url(#"+this.constants.selectedGlowFilterId+")"),this.svgRoot.appendChild(this.svgPathSelected)):this.svgPathSelected&&(this.svgRoot.removeChild(this.svgPathSelected),this.svgPathSelected=null)}updateReplacementFade(t){this.setClass_("blocklyReplaceable",t),t?this.svgPath.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):this.svgPath.removeAttribute("filter")}updateShapeForInputHighlight(t,o){t=t.getParentInput().name,(t=this.getOutlinePath(t))&&(o?t.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):t.removeAttribute("filter"))}beginDrawing(){this.remainingOutlines.clear();for(const t of this.outlines.keys())this.remainingOutlines.add(t)}endDrawing(){if(this.remainingOutlines.size)for(const t of this.remainingOutlines)this.removeOutlinePath(t);this.remainingOutlines.clear()}setOutlinePath(t,o){t=this.getOutlinePath(t),t.setAttribute("d",o),t.setAttribute("fill",this.style.colourTertiary)}getOutlinePath(t){return this.outlines.has(t)||this.outlines.set(t,Ce(Ve.PATH,{class:"blocklyOutlinePath",d:""},this.svgRoot)),this.remainingOutlines.delete(t),this.outlines.get(t)}removeOutlinePath(t){let o,c;(o=this.outlines.get(t))==null||(c=o.parentNode)==null||c.removeChild(this.outlines.get(t)),this.outlines.delete(t)}},fA=class extends Ty{constructor(t){super(t)}makeConstants_(){return new L1}makeRenderInfo_(t){return new B1(this,t)}makeDrawer_(t,o){return new N1(t,o)}makeMarkerDrawer(t,o){return new F1(t,this.getConstants(),o)}makePathObject(t,o){return new U1(t,o,this.getConstants())}getConstants(){return this.constants_}getConnectionPreviewMethod(t,o,c){return il("getConnectionPreviewMethod","v10","v12","an IConnectionPreviewer, if it fulfills your use case."),o.type===Bt.OUTPUT_VALUE?t.isConnected()?Oa.PREVIEW_TYPE.REPLACEMENT_FADE:Oa.PREVIEW_TYPE.INPUT_OUTLINE:super.getConnectionPreviewMethod(t,o,c)}};ih("zelos",fA);var G1=class{constructor(t){this.staticConn=this.draggedConn=this.markerConn=this.fadedBlock=null,this.workspace=t.workspace}previewReplacement(t,o,c){n.disable$$module$build$src$core$events$utils();try{this.hidePreview(),this.fadedBlock=c,c.fadeForReplacement(!0),this.workspace.getRenderer().shouldHighlightConnection(o)&&(o.highlight(),this.staticConn=o)}finally{n.enable$$module$build$src$core$events$utils()}}previewConnection(t,o){if(t!==this.draggedConn||o!==this.staticConn){n.disable$$module$build$src$core$events$utils();try{this.hidePreview(),this.shouldUseMarkerPreview(t,o)&&(this.markerConn=this.previewMarker(t,o)),this.workspace.getRenderer().shouldHighlightConnection(o)&&o.highlight(),this.draggedConn=t,this.staticConn=o}finally{n.enable$$module$build$src$core$events$utils()}}}shouldUseMarkerPreview(t,o){return o.type===Bt.PREVIOUS_STATEMENT||o.type===Bt.NEXT_STATEMENT||!(this.workspace.getRenderer()instanceof fA)}previewMarker(t,o){const c=t.getSourceBlock(),g=this.createInsertionMarker(c),$=this.getMatchingConnection(c,g,t);if(!$)return null;g.queueRender(),An(),$.connect(o);const M={x:o.x-$.x,y:o.y-$.y},Q=$.getOffsetInBlock().clone();return Kt().then(()=>{if(!g.isDeadOrDying()){n.disable$$module$build$src$core$events$utils();try{g==null||g.positionNearConnection($,M,Q),g==null||g.getSvgRoot().setAttribute("visibility","visible")}finally{n.enable$$module$build$src$core$events$utils()}}}),$}createInsertionMarker(t){const o=Vi(t,{addCoordinates:!1,addInputBlocks:!1,addNextBlocks:!1,doFullSerialization:!1});if(!o)throw Error(`Failed to serialize source block. ${t.toDevString()}`);t=Ii(o,this.workspace);for(const c of t.getDescendants(!1))c.setInsertionMarker(!0);return t.initSvg(),t.getSvgRoot().setAttribute("visibility","hidden"),t}getMatchingConnection(t,o,c){if(t=t.getConnections_(!0),o=o.getConnections_(!0),t.length!==o.length)return null;for(let g=0;g<t.length;g++)if(t[g]===c)return o[g];return null}hidePreview(){n.disable$$module$build$src$core$events$utils();try{this.staticConn&&(this.staticConn.unhighlight(),this.staticConn=null),this.fadedBlock&&(this.fadedBlock.fadeForReplacement(!1),this.fadedBlock=null),this.markerConn&&(this.hideInsertionMarker(this.markerConn),this.draggedConn=this.markerConn=null)}finally{n.enable$$module$build$src$core$events$utils()}}hideInsertionMarker(t){const o=t.getSourceBlock(),c=o.outputConnection;let g;if((g=o.previousConnection)!=null&&g.targetConnection||c!=null&&c.targetConnection)o.unplug(!0);else{let $;($=t.targetBlock())==null||$.unplug(!1)}o.dispose()}dispose(){this.hidePreview()}};r(yt.CONNECTION_PREVIEWER,yo,G1);var Rh={};Rh.Align=n.Align$$module$build$src$core$inputs$align,Rh.DummyInput=dc,Rh.EndRowInput=lu,Rh.Input=Cm,Rh.StatementInput=ta,Rh.ValueInput=n.ValueInput$$module$build$src$core$inputs$value_input,Rh.inputTypes=n.inputTypes$$module$build$src$core$inputs$input_types;var H1=!1,V1;n.CodeGenerator$$module$build$src$core$generator=class{constructor(t){this.forBlock=Object.create(null),this.FUNCTION_NAME_PLACEHOLDER_="{leCUI8hutHZI4480Dc}",this.STATEMENT_SUFFIX=this.STATEMENT_PREFIX=this.INFINITE_LOOP_TRAP=null,this.INDENT="  ",this.COMMENT_WRAP=60,this.ORDER_OVERRIDES=[],this.isInitialized=null,this.RESERVED_WORDS_="",this.definitions_=Object.create(null),this.functionNames_=Object.create(null),this.nameDB_=void 0,this.name_=t,this.FUNCTION_NAME_PLACEHOLDER_REGEXP_=new RegExp(this.FUNCTION_NAME_PLACEHOLDER_,"g")}workspaceToCode(t){t||(console.warn("No workspace specified in workspaceToCode call.  Guessing."),t=ne());var o=[];this.init(t),t=t.getTopBlocks(!0);for(let c=0,g;g=t[c];c++){let $=this.blockToCode(g);Array.isArray($)&&($=$[0]),$&&(g.outputConnection&&($=this.scrubNakedValue($),this.STATEMENT_PREFIX&&!g.suppressPrefixSuffix&&($=this.injectId(this.STATEMENT_PREFIX,g)+$),this.STATEMENT_SUFFIX&&!g.suppressPrefixSuffix&&($+=this.injectId(this.STATEMENT_SUFFIX,g))),o.push($))}return o=o.join(`
`),o=this.finish(o),o=o.replace(/^\s+\n/,""),o=o.replace(/\n\s+$/,`
`),o=o.replace(/[ \t]+\n/g,`
`)}prefixLines(t,o){return o+t.replace(/(?!\n$)\n/g,`
`+o)}allNestedComments(t){const o=[];t=t.getDescendants(!0);for(let c=0;c<t.length;c++){const g=t[c].getCommentText();g&&o.push(g)}return o.length&&o.push(""),o.join(`
`)}blockToCode(t,o){if(this.isInitialized===!1&&console.warn("CodeGenerator init was not called before blockToCode was called."),!t)return"";if(!t.isEnabled())return o?"":this.blockToCode(t.getNextBlock());if(t.isInsertionMarker())return o?"":this.blockToCode(t.getChildren(!1)[0]);var c=this.forBlock[t.type];if(typeof c!="function")throw Error(`${this.name_} generator does not know how to generate code for block type "${t.type}".`);if(c=c.call(t,t,this),Array.isArray(c)){if(!t.outputConnection)throw TypeError("Expecting string from statement block: "+t.type);return[this.scrub_(t,c[0],o),c[1]]}if(typeof c=="string")return this.STATEMENT_PREFIX&&!t.suppressPrefixSuffix&&(c=this.injectId(this.STATEMENT_PREFIX,t)+c),this.STATEMENT_SUFFIX&&!t.suppressPrefixSuffix&&(c+=this.injectId(this.STATEMENT_SUFFIX,t)),this.scrub_(t,c,o);if(c===null)return"";throw SyntaxError("Invalid code generated: "+c)}valueToCode(t,o,c){if(isNaN(c))throw TypeError("Expecting valid order from block: "+t.type);var g=t.getInputTargetBlock(o);if(!g&&!t.getInput(o))throw ReferenceError(`Input "${o}" doesn't exist on "${t.type}"`);if(!g||(o=this.blockToCode(g),o===""))return"";if(!Array.isArray(o))throw TypeError(`Expecting tuple from value block: ${g.type} See developers.google.com/blockly/guides/create-custom-blocks/generating-code for more information`);if(t=o[0],o=o[1],isNaN(o))throw TypeError("Expecting valid order from value block: "+g.type);if(!t)return"";g=!1;var $=Math.floor(c);const M=Math.floor(o);if($<=M&&($!==M||$!==0&&$!==99)){for(g=!0,$=0;$<this.ORDER_OVERRIDES.length;$++)if(this.ORDER_OVERRIDES[$][0]===c&&this.ORDER_OVERRIDES[$][1]===o){g=!1;break}}return g&&(t="("+t+")"),t}statementToCode(t,o){const c=t.getInputTargetBlock(o);if(!c&&!t.getInput(o))throw ReferenceError(`Input "${o}" doesn't exist on "${t.type}"`);if(t=this.blockToCode(c),typeof t!="string")throw TypeError("Expecting code from statement block: "+(c&&c.type));return t&&(t=this.prefixLines(t,this.INDENT)),t}addLoopTrap(t,o){return this.INFINITE_LOOP_TRAP&&(t=this.prefixLines(this.injectId(this.INFINITE_LOOP_TRAP,o),this.INDENT)+t),this.STATEMENT_SUFFIX&&!o.suppressPrefixSuffix&&(t=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,o),this.INDENT)+t),this.STATEMENT_PREFIX&&!o.suppressPrefixSuffix&&(t+=this.prefixLines(this.injectId(this.STATEMENT_PREFIX,o),this.INDENT)),t}injectId(t,o){return o=o.id.replace(/\$/g,"$$$$"),t.replace(/%1/g,"'"+o+"'")}addReservedWords(t){this.RESERVED_WORDS_+=t+","}provideFunction_(t,o){if(!this.definitions_[t]){const c=this.nameDB_.getDistinctName(t,n.NameType$$module$build$src$core$names.PROCEDURE);this.functionNames_[t]=c,Array.isArray(o)&&(o=o.join(`
`)),o=o.trim().replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_,c);let g;for(;g!==o;)g=o,o=o.replace(/^(( {2})*) {2}/gm,"$1\0");o=o.replace(/\0/g,this.INDENT),this.definitions_[t]=o}return this.functionNames_[t]}getVariableName(t){return this.getName(t,n.NameType$$module$build$src$core$names.VARIABLE)}getProcedureName(t){return this.getName(t,n.NameType$$module$build$src$core$names.PROCEDURE)}getName(t,o){if(!this.nameDB_)throw Error("Name database is not defined. You must initialize `nameDB_` in your generator class and call `init` first.");return this.nameDB_.getName(t,o)}init(t){this.definitions_=Object.create(null),this.functionNames_=Object.create(null)}scrub_(t,o,c){return o}finish(t){return this.definitions_=Object.create(null),this.functionNames_=Object.create(null),t}scrubNakedValue(t){return t}},V1={},V1.CodeGenerator=n.CodeGenerator$$module$build$src$core$generator;var z1=class extends dA{constructor(t,o){super(t),this.flyout_=o}getBoundingBox_(){let t;try{t=this.workspace_.getCanvas().getBBox()}catch{t={height:0,y:0,width:0,x:0}}return t}getContentMetrics(t){const o=this.getBoundingBox_();return t=t?1:this.workspace_.scale,{height:o.height*t,width:o.width*t,top:o.y*t,left:o.x*t}}getScrollMetrics(t,o,c){return o=c||this.getContentMetrics(),c=this.flyout_.MARGIN*this.workspace_.scale,t=t?this.workspace_.scale:1,{height:(o.height+2*c)/t,width:(o.width+o.left+c)/t,top:0,left:0}}},Im;(function(t){t.BLOCK="block",t.BUTTON="button"})(Im||(Im={}));var IG="WORKSPACE_AT_BLOCK_CAPACITY",Ry=class extends yy{constructor(t){super(),this.horizontalLayout=!1,this.boundEvents=[],this.filterWrapper=this.reflowWrapper=null,this.mats=[],this.buttons_=[],this.contents=[],this.listeners=[],this.permanentlyDisabled=[],this.recycledBlocks=[],this.autoClose=!0,this.isVisible_=!1,this.containerVisible=!0,this.CORNER_RADIUS=8,this.SCROLLBAR_MARGIN=2.5,this.height_=this.width_=0,this.dragAngleRange_=70,this.svgGroup_=this.svgBackground_=null,t.setMetrics=this.setMetrics_.bind(this),this.workspace_=new La(t),this.workspace_.setMetricsManager(new z1(this.workspace_,this)),this.workspace_.internalIsFlyout=!0,this.workspace_.setVisible(this.isVisible_),this.id=T(),this.RTL=!!t.RTL,this.toolboxPosition_=t.toolboxPosition,this.tabWidth_=this.workspace_.getRenderer().getConstants().TAB_WIDTH,this.rectMap_=new WeakMap,this.MARGIN=this.CORNER_RADIUS,this.GAP_X=3*this.MARGIN,this.GAP_Y=3*this.MARGIN}createDom(t){return this.svgGroup_=Ce(t,{class:"blocklyFlyout"}),this.svgGroup_.style.display="none",this.svgBackground_=Ce(Ve.PATH,{class:"blocklyFlyoutBackground"},this.svgGroup_),this.svgGroup_.appendChild(this.workspace_.createDom()),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutBackgroundColour","fill"),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutOpacity","fill-opacity"),this.svgGroup_}init(t){this.targetWorkspace=t,this.workspace_.targetWorkspace=t,this.workspace_.scrollbar=new hA(this.workspace_,this.horizontalLayout,!this.horizontalLayout,"blocklyFlyoutScrollbar",this.SCROLLBAR_MARGIN),this.hide(),this.boundEvents.push(Ue(this.svgGroup_,"wheel",this,this.wheel_)),this.filterWrapper=this.filterForCapacity.bind(this),this.targetWorkspace.addChangeListener(this.filterWrapper),this.boundEvents.push(Ue(this.svgBackground_,"pointerdown",this,this.onMouseDown)),this.workspace_.getGesture=this.targetWorkspace.getGesture.bind(this.targetWorkspace),this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap()),this.workspace_.createPotentialVariableMap(),t.getComponentManager().addComponent({component:this,weight:1,capabilities:[Vr.Capability.AUTOHIDEABLE,Vr.Capability.DELETE_AREA,Vr.Capability.DRAG_TARGET]})}dispose(){this.hide(),this.targetWorkspace.getComponentManager().removeComponent(this.id);for(const t of this.boundEvents)re(t);this.boundEvents.length=0,this.filterWrapper&&this.targetWorkspace.removeChangeListener(this.filterWrapper),this.workspace_&&(this.workspace_.getThemeManager().unsubscribe(this.svgBackground_),this.workspace_.dispose()),this.svgGroup_&&W(this.svgGroup_)}getWidth(){return this.width_}getHeight(){return this.height_}getFlyoutScale(){return this.targetWorkspace.scale}getWorkspace(){return this.workspace_}setAutoClose(t){this.autoClose=t,this.targetWorkspace.recordDragTargets(),this.targetWorkspace.resizeContents()}autoHide(t){!t&&this.targetWorkspace.getFlyout(!0)===this&&this.autoClose&&this.hide()}getTargetWorkspace(){return this.targetWorkspace}isVisible(){return this.isVisible_}setVisible(t){const o=t!==this.isVisible();this.isVisible_=t,o&&(this.autoClose||this.targetWorkspace.recordDragTargets(),this.updateDisplay())}setContainerVisible(t){const o=t!==this.containerVisible;this.containerVisible=t,o&&this.updateDisplay()}getContents(){return this.contents}setContents(t){this.contents=t}updateDisplay(){let t;t=this.containerVisible?this.isVisible():!1,this.svgGroup_&&(this.svgGroup_.style.display=t?"block":"none");let o;(o=this.workspace_.scrollbar)==null||o.setContainerVisible(t)}positionAt_(t,o,c,g){let $;($=this.svgGroup_)==null||$.setAttribute("width",`${t}`);let M;(M=this.svgGroup_)==null||M.setAttribute("height",`${o}`),this.workspace_.setCachedParentSvgSize(t,o),this.svgGroup_&&ze(this.svgGroup_,"translate("+c+"px,"+g+"px)"),(t=this.workspace_.scrollbar)&&(t.setOrigin(c,g),t.resize(),t.hScroll&&t.hScroll.setPosition(t.hScroll.position.x,t.hScroll.position.y),t.vScroll&&t.vScroll.setPosition(t.vScroll.position.x,t.vScroll.position.y))}hide(){if(this.isVisible()){this.setVisible(!1);for(const t of this.listeners)re(t);this.listeners.length=0,this.reflowWrapper&&(this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowWrapper=null)}}show(t){this.workspace_.setResizesEnabled(!1),this.hide(),this.clearOldBlocks(),typeof t=="string"&&(t=this.getDynamicCategoryContents(t)),this.setVisible(!0),t=Ci(t),t=this.createFlyoutInfo(t),An(this.workspace_),this.setContents(t.contents),this.layout_(t.contents,t.gaps),this.horizontalLayout?this.height_=0:this.width_=0,this.workspace_.setResizesEnabled(!0),this.reflow(),this.filterForCapacity(),this.position(),this.reflowWrapper=this.reflow.bind(this),this.workspace_.addChangeListener(this.reflowWrapper),this.emptyRecycledBlocks()}createFlyoutInfo(t){const o=[],c=[];this.permanentlyDisabled.length=0;const g=this.horizontalLayout?this.GAP_X:this.GAP_Y;for(const $ of t){if("custom"in $){t=this.getDynamicCategoryContents($.custom),t=Ci(t);const{contents:M,gaps:Q}=this.createFlyoutInfo(t);o.push(...M),c.push(...Q)}switch($.kind.toUpperCase()){case"BLOCK":t=$;const M=this.createFlyoutBlock(t);o.push({type:Im.BLOCK,block:M}),this.addBlockGap(t,c,g);break;case"SEP":this.addSeparatorGap($,c,g);break;case"LABEL":t=this.createButton($,!0),o.push({type:Im.BUTTON,button:t}),c.push(g);break;case"BUTTON":t=this.createButton($,!1),o.push({type:Im.BUTTON,button:t}),c.push(g)}}return{contents:o,gaps:c}}getDynamicCategoryContents(t){if(t=this.workspace_.targetWorkspace.getToolboxCategoryCallback(t),typeof t!="function")throw TypeError("Couldn't find a callback function when opening a toolbox category.");return t(this.workspace_.targetWorkspace)}createButton(t,o){return new Ia(this.workspace_,this.targetWorkspace,t,o)}createFlyoutBlock(t){let o;return t.blockxml?(t=typeof t.blockxml=="string"?n.textToDom$$module$build$src$core$utils$xml(t.blockxml):t.blockxml,(o=this.getRecycledBlock(t.getAttribute("type")))||(o=Ql(t,this.workspace_))):(o=this.getRecycledBlock(t.type),o||(t.enabled===void 0&&(t.enabled=t.disabled!=="true"&&t.disabled!==!0),t.disabledReasons===void 0&&t.enabled===!1&&(t.disabledReasons=[xa]),o=_o(t,this.workspace_))),o.isEnabled()||this.permanentlyDisabled.push(o),o}getRecycledBlock(t){let o=-1;for(let c=0;c<this.recycledBlocks.length;c++)if(this.recycledBlocks[c].type===t){o=c;break}return o===-1?void 0:this.recycledBlocks.splice(o,1)[0]}addBlockGap(t,o,c){let g;t.gap?g=parseInt(String(t.gap)):t.blockxml&&(t=typeof t.blockxml=="string"?n.textToDom$$module$build$src$core$utils$xml(t.blockxml):t.blockxml,g=parseInt(t.getAttribute("gap"))),o.push(!g||isNaN(g)?c:g)}addSeparatorGap(t,o,c){t=parseInt(String(t.gap)),!isNaN(t)&&0<o.length?o[o.length-1]=t:o.push(c)}clearOldBlocks(){var t=this.workspace_.getTopBlocks(!1);for(let c=0,g;g=t[c];c++)this.blockIsRecyclable_(g)?this.recycleBlock(g):g.dispose(!1,!1);for(t=0;t<this.mats.length;t++){const c=this.mats[t];c&&(es(c),W(c))}this.mats.length=0;for(let c=0,g;g=this.buttons_[c];c++)g.dispose();this.buttons_.length=0;let o;(o=this.workspace_.getPotentialVariableMap())==null||o.clear()}emptyRecycledBlocks(){for(let t=0;t<this.recycledBlocks.length;t++)this.recycledBlocks[t].dispose();this.recycledBlocks=[]}blockIsRecyclable_(t){return!1}recycleBlock(t){const o=t.getRelativeToSurfaceXY();t.moveBy(-o.x,-o.y),this.recycledBlocks.push(t)}addBlockListeners_(t,o,c){this.listeners.push(Ue(t,"pointerdown",null,this.blockMouseDown(o))),this.listeners.push(Ue(c,"pointerdown",null,this.blockMouseDown(o))),this.listeners.push(Le(t,"pointerenter",o,()=>{this.targetWorkspace.isDragging()||o.addSelect()})),this.listeners.push(Le(t,"pointerleave",o,()=>{this.targetWorkspace.isDragging()||o.removeSelect()})),this.listeners.push(Le(c,"pointerenter",o,()=>{this.targetWorkspace.isDragging()||o.addSelect()})),this.listeners.push(Le(c,"pointerleave",o,()=>{this.targetWorkspace.isDragging()||o.removeSelect()}))}blockMouseDown(t){return o=>{const c=this.targetWorkspace.getGesture(o);c&&(c.setStartBlock(t),c.handleFlyoutStart(o,this))}}onMouseDown(t){const o=this.targetWorkspace.getGesture(t);o&&o.handleFlyoutStart(t,this)}isBlockCreatable(t){return t.isEnabled()}createBlock(t){let o=null;n.disable$$module$build$src$core$events$utils();var c=this.targetWorkspace.getAllVariables();this.targetWorkspace.setResizesEnabled(!1);try{o=this.placeNewBlock(t)}finally{n.enable$$module$build$src$core$events$utils()}if(this.targetWorkspace.hideChaff(),t=zn(this.targetWorkspace,c),R()){for(n.setGroup$$module$build$src$core$events$utils(!0),c=0;c<t.length;c++){const g=t[c];b(new(k(ba))(g))}b(new(k(n.CREATE$$module$build$src$core$events$utils))(o))}return this.autoClose?this.hide():this.filterForCapacity(),o}initFlyoutButton_(t,o,c){const g=t.createDom();t.moveTo(o,c),t.show(),this.listeners.push(Ue(g,"pointerdown",this,this.onMouseDown)),this.buttons_.push(t)}createRect_(t,o,c,g,$){return o=Ce(Ve.RECT,{"fill-opacity":0,x:o,y:c,height:g.height,width:g.width}),o.tooltip=t,Ar(o),this.workspace_.getCanvas().insertBefore(o,t.getSvgRoot()),this.rectMap_.set(t,o),this.mats[$]=o}moveRectToBlock_(t,o){const c=o.getHeightWidth();t.setAttribute("width",String(c.width)),t.setAttribute("height",String(c.height)),o=o.getRelativeToSurfaceXY(),t.setAttribute("y",String(o.y)),t.setAttribute("x",String(this.RTL?o.x-c.width:o.x))}filterForCapacity(){const t=this.workspace_.getTopBlocks(!1);for(let o=0,c;c=t[o];o++)if(!this.permanentlyDisabled.includes(c)){const g=this.targetWorkspace.isCapacityAvailable(K(c));for(;c;)c.setDisabledReason(!g,IG),c=c.getNextBlock()}}reflow(){this.reflowWrapper&&this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowInternal_(),this.reflowWrapper&&this.workspace_.addChangeListener(this.reflowWrapper)}isScrollable(){return this.workspace_.scrollbar?this.workspace_.scrollbar.isVisible():!1}placeNewBlock(t){var o=this.targetWorkspace;if(!t.getSvgRoot())throw Error("oldBlock is not rendered");const c=this.serializeBlock(t);return o.setResizesEnabled(!1),o=Ii(c,o),this.positionNewBlock(t,o),o}serializeBlock(t){return Vi(t)}positionNewBlock(t,o){const c=this.targetWorkspace;var g=c.getOriginOffsetInPixels(),$=this.workspace_.getOriginOffsetInPixels();t=t.getRelativeToSurfaceXY(),t.scale(this.workspace_.scale),$=At.sum($,t),g=At.difference($,g),g.scale(1/c.scale),o.moveTo(new At(g.x,g.y))}};Ry.FlyoutItemType=Im;var pA=class extends Ry{constructor(t){super(t)}setMetrics_(t){if(this.isVisible()){var o=this.workspace_.getMetricsManager(),c=o.getScrollMetrics(),g=o.getViewMetrics();o=o.getAbsoluteMetrics(),typeof t.y=="number"&&(this.workspace_.scrollY=-(c.top+(c.height-g.height)*t.y)),this.workspace_.translate(this.workspace_.scrollX+o.left,this.workspace_.scrollY+o.top)}}getX(){if(!this.isVisible())return 0;var t=this.targetWorkspace.getMetricsManager();const o=t.getAbsoluteMetrics(),c=t.getViewMetrics();return t=t.getToolboxMetrics(),this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?this.toolboxPosition_===Cn.LEFT?t.width:c.width-this.width_:this.toolboxPosition_===Cn.LEFT?0:c.width:this.toolboxPosition_===Cn.LEFT?0:c.width+o.left-this.width_}getY(){return 0}position(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var t=this.targetWorkspace.getMetricsManager().getViewMetrics();this.height_=t.height,this.setBackgroundPath(this.width_-this.CORNER_RADIUS,t.height-2*this.CORNER_RADIUS),t=this.getX();var o=this.getY();this.positionAt_(this.width_,this.height_,t,o)}}setBackgroundPath(t,o){const c=this.toolboxPosition_===Cn.RIGHT;var g=t+this.CORNER_RADIUS;g=["M "+(c?g:0)+",0"],g.push("h",c?-t:t),g.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,c?0:1,c?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS),g.push("v",Math.max(0,o)),g.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,c?0:1,c?this.CORNER_RADIUS:-this.CORNER_RADIUS,this.CORNER_RADIUS),g.push("h",c?t:-t),g.push("z"),this.svgBackground_.setAttribute("d",g.join(" "))}scrollToStart(){let t;(t=this.workspace_.scrollbar)==null||t.setY(0)}wheel_(t){var o=Xe(t);if(o.y){const c=this.workspace_.getMetricsManager(),g=c.getScrollMetrics();o=c.getViewMetrics().top-g.top+o.y;let $;($=this.workspace_.scrollbar)==null||$.setY(o),wi(this.workspace_),Uo()}t.preventDefault(),t.stopPropagation()}layout_(t,o){this.workspace_.scale=this.targetWorkspace.scale;var c=this.MARGIN;const g=this.RTL?c:c+this.tabWidth_;for(let be=0,nt;nt=t[be];be++)if(nt.type==="block"){var $=nt.block;if(!$)continue;var M=$.getDescendants(!1);for(let Ni=0,Mi;Mi=M[Ni];Ni++)Mi.isInFlyout=!0;M=$.getSvgRoot();const Dt=$.getHeightWidth();var Q=$.outputConnection?g-this.tabWidth_:g;$.moveBy(Q,c),Q=this.createRect_($,this.RTL?Q-Dt.width:Q,c,Dt,be),this.addBlockListeners_(M,$,Q),c+=Dt.height+o[be]}else nt.type==="button"&&($=nt.button,this.initFlyoutButton_($,g,c),c+=$.height+o[be])}isDragTowardWorkspace(t){t=Math.atan2(t.y,t.x)/Math.PI*180;const o=this.dragAngleRange_;return t<o&&t>-o||t<-180+o||t>180-o}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const t=this.svgGroup_.getBoundingClientRect(),o=t.left;return this.toolboxPosition_===Cn.LEFT?new $i(-1e9,1e9,-1e9,o+t.width):new $i(-1e9,1e9,o,1e9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let t=0;var o=this.workspace_.getTopBlocks(!1);for(let g=0,$;$=o[g];g++){var c=$.getHeightWidth().width;$.outputConnection&&(c-=this.tabWidth_),t=Math.max(t,c)}for(let g=0,$;$=this.buttons_[g];g++)t=Math.max(t,$.width);if(t+=1.5*this.MARGIN+this.tabWidth_,t*=this.workspace_.scale,t+=ur.scrollbarThickness,this.width_!==t){for(let g=0,$;$=o[g];g++){if(this.RTL){c=$.getRelativeToSurfaceXY().x;let M=t/this.workspace_.scale-this.MARGIN;$.outputConnection||(M-=this.tabWidth_),$.moveBy(M-c,0)}this.rectMap_.has($)&&this.moveRectToBlock_(this.rectMap_.get($),$)}if(this.RTL)for(let g=0,$;$=this.buttons_[g];g++)o=$.getPosition().y,$.moveTo(t/this.workspace_.scale-$.width-this.MARGIN-this.tabWidth_,o);this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==Cn.LEFT||this.targetWorkspace.translate(this.targetWorkspace.scrollX+t,this.targetWorkspace.scrollY),this.width_=t,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets()}}};pA.registryName="verticalFlyout",r(yt.FLYOUTS_VERTICAL_TOOLBOX,yo,pA);var W1=class extends Ry{constructor(t){super(t),this.horizontalLayout=!0}setMetrics_(t){if(this.isVisible()){var o=this.workspace_.getMetricsManager(),c=o.getScrollMetrics(),g=o.getViewMetrics();o=o.getAbsoluteMetrics(),typeof t.x=="number"&&(this.workspace_.scrollX=-(c.left+(c.width-g.width)*t.x)),this.workspace_.translate(this.workspace_.scrollX+o.left,this.workspace_.scrollY+o.top)}}getX(){return 0}getY(){if(!this.isVisible())return 0;var t=this.targetWorkspace.getMetricsManager();const o=t.getAbsoluteMetrics(),c=t.getViewMetrics();t=t.getToolboxMetrics();const g=this.toolboxPosition_===Cn.TOP;return this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?g?t.height:c.height-this.height_:g?0:c.height:g?0:c.height+o.top-this.height_}position(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var t=this.targetWorkspace.getMetricsManager().getViewMetrics();this.width_=t.width,this.setBackgroundPath(t.width-2*this.CORNER_RADIUS,this.height_-this.CORNER_RADIUS),t=this.getX();var o=this.getY();this.positionAt_(this.width_,this.height_,t,o)}}setBackgroundPath(t,o){const c=this.toolboxPosition_===Cn.TOP,g=["M 0,"+(c?0:this.CORNER_RADIUS)];c?(g.push("h",t+2*this.CORNER_RADIUS),g.push("v",o),g.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,this.CORNER_RADIUS),g.push("h",-t),g.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,-this.CORNER_RADIUS)):(g.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,-this.CORNER_RADIUS),g.push("h",t),g.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,this.CORNER_RADIUS),g.push("v",o),g.push("h",-t-2*this.CORNER_RADIUS)),g.push("z"),this.svgBackground_.setAttribute("d",g.join(" "))}scrollToStart(){let t;(t=this.workspace_.scrollbar)==null||t.setX(this.RTL?1/0:0)}wheel_(t){var o=Xe(t);if(o=o.x||o.y){const c=this.workspace_.getMetricsManager(),g=c.getScrollMetrics();o=c.getViewMetrics().left-g.left+o;let $;($=this.workspace_.scrollbar)==null||$.setX(o),wi(this.workspace_),Uo()}t.preventDefault(),t.stopPropagation()}layout_(t,o){this.workspace_.scale=this.targetWorkspace.scale;const c=this.MARGIN;let g=c+this.tabWidth_;this.RTL&&(t=t.reverse());for(let be=0,nt;nt=t[be];be++)if(nt.type==="block"){var $=nt.block;if($==null)continue;var M=$.getDescendants(!1);for(let Ni=0,Mi;Mi=M[Ni];Ni++)Mi.isInFlyout=!0;M=$.getSvgRoot();const Dt=$.getHeightWidth();var Q=$.outputConnection?this.tabWidth_:0;Q=this.RTL?g+Dt.width:g-Q,$.moveBy(Q,c),Q=this.createRect_($,Q,c,Dt,be),g+=Dt.width+o[be],this.addBlockListeners_(M,$,Q)}else nt.type==="button"&&($=nt.button,this.initFlyoutButton_($,g,c),g+=$.width+o[be])}isDragTowardWorkspace(t){t=Math.atan2(t.y,t.x)/Math.PI*180;const o=this.dragAngleRange_;return t<90+o&&t>90-o||t>-90-o&&t<-90+o}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const t=this.svgGroup_.getBoundingClientRect(),o=t.top;return this.toolboxPosition_===Cn.TOP?new $i(-1e9,o+t.height,-1e9,1e9):new $i(o,1e9,-1e9,1e9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let t=0;const o=this.workspace_.getTopBlocks(!1);for(let g=0,$;$=o[g];g++)t=Math.max(t,$.getHeightWidth().height);const c=this.buttons_;for(let g=0,$;$=c[g];g++)t=Math.max(t,$.height);if(t+=1.5*this.MARGIN,t*=this.workspace_.scale,t+=ur.scrollbarThickness,this.height_!==t){for(let g=0,$;$=o[g];g++)this.rectMap_.has($)&&this.moveRectToBlock_(this.rectMap_.get($),$);this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==Cn.TOP||this.targetWorkspace.translate(this.targetWorkspace.scrollX,this.targetWorkspace.scrollY+t),this.height_=t,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets()}}};r(yt.FLYOUTS_HORIZONTAL_TOOLBOX,yo,W1);var Sv=class extends uc{constructor(t,o,c,g,$){super(bi.SKIP_SETUP),this.defaultType="",this.variableTypes=[],this.variable=null,this.SERIALIZABLE=!0,this.menuGenerator_=Sv.dropdownCreate,this.defaultVariableName=typeof t=="string"?t:"",this.size_=new Kn(0,0),t!==bi.SKIP_SETUP&&($?this.configure_($):this.setTypes(c,g),o&&this.setValidator(o))}configure_(t){super.configure_(t),this.setTypes(t.variableTypes,t.defaultType)}initModel(){var t=this.getSourceBlock();if(!t)throw new hr;this.variable||(t=n.getOrCreateVariablePackage$$module$build$src$core$variables(t.workspace,null,this.defaultVariableName,this.defaultType),this.doValueUpdate_(t.getId()))}shouldAddBorderRect_(){const t=this.getSourceBlock();if(!t)throw new hr;return super.shouldAddBorderRect_()&&(!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||t.type!=="variables_get")}fromXml(t){var o=this.getSourceBlock();if(!o)throw new hr;const c=t.getAttribute("id"),g=t.textContent,$=t.getAttribute("variabletype")||t.getAttribute("variableType")||"";if(o=n.getOrCreateVariablePackage$$module$build$src$core$variables(o.workspace,c,g,$),$!==null&&$!==o.type)throw Error("Serialized variable type with id '"+o.getId()+"' had type "+o.type+", and does not match variable field that references it: "+Vo(t)+".");this.setValue(o.getId())}toXml(t){return this.initModel(),t.id=this.variable.getId(),t.textContent=this.variable.name,this.variable.type&&t.setAttribute("variabletype",this.variable.type),t}saveState(t){var o=this.saveLegacyState(Sv);return o!==null||(this.initModel(),o={id:this.variable.getId()},t&&(o.name=this.variable.name,o.type=this.variable.type)),o}loadState(t){const o=this.getSourceBlock();if(!o)throw new hr;this.loadLegacyState(Sv,t)||(t=n.getOrCreateVariablePackage$$module$build$src$core$variables(o.workspace,t.id||null,t.name,t.type||""),this.setValue(t.getId()))}setSourceBlock(t){if(t.isShadow())throw Error("Variable fields are not allowed to exist on shadow blocks.");super.setSourceBlock(t)}getValue(){return this.variable?this.variable.getId():null}getText(){return this.variable?this.variable.name:""}getVariable(){return this.variable}getValidator(){return this.variable?this.validator_:null}doClassValidation_(t){if(t===null)return null;var o=this.getSourceBlock();if(!o)throw new hr;return o=n.getVariable$$module$build$src$core$variables(o.workspace,t),o?(o=o.type,this.typeIsAllowed(o)?t:(console.warn("Variable type doesn't match this field!  Type was "+o),null)):(console.warn("Variable id doesn't point to a real variable! ID was "+t),null)}doValueUpdate_(t){const o=this.getSourceBlock();if(!o)throw new hr;this.variable=n.getVariable$$module$build$src$core$variables(o.workspace,t),super.doValueUpdate_(t)}typeIsAllowed(t){const o=this.getVariableTypes();if(!o)return!0;for(let c=0;c<o.length;c++)if(t===o[c])return!0;return!1}getVariableTypes(){var t=this.variableTypes;if(t===null&&this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying())return this.sourceBlock_.workspace.getVariableTypes();if(t=t||[""],t.length===0)throw t=this.getText(),Error("'variableTypes' of field variable "+t+" was an empty list");return t}setTypes(t=null,o=""){if(Array.isArray(t)){let c=!1;for(let g=0;g<t.length;g++)t[g]===o&&(c=!0);if(!c)throw Error("Invalid default type '"+o+"' in the definition of a FieldVariable")}else if(t!==null)throw Error("'variableTypes' was not an array in the definition of a FieldVariable");this.defaultType=o,this.variableTypes=t}refreshVariableName(){this.forceRerender()}onItemSelected_(t,o){if(t=o.getValue(),this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()){if(t===Zb){n.renameVariable$$module$build$src$core$variables(this.sourceBlock_.workspace,this.variable);return}if(t===qb){this.sourceBlock_.workspace.deleteVariableById(this.variable.getId());return}}this.setValue(t)}referencesVariables(){return!0}static fromJson(t){return new this(yi(t.variable),void 0,void 0,void 0,t)}static dropdownCreate(){if(!this.variable)throw Error("Tried to call dropdownCreate on a variable field with no variable selected.");const t=this.getText();let o=[];if(this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying())for(var c=this.getVariableTypes(),g=0;g<c.length;g++){const $=this.sourceBlock_.workspace.getVariablesOfType(c[g]);o=o.concat($)}for(o.sort(iv.compareByName),c=[],g=0;g<o.length;g++)c[g]=[o[g].name,o[g].getId()];return c.push([n.Msg$$module$build$src$core$msg.RENAME_VARIABLE,Zb]),n.Msg$$module$build$src$core$msg.DELETE_VARIABLE&&c.push([n.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",t),qb]),c}};zo("field_variable",Sv);var mA=class extends Ay{constructor(t,o,c,g,$,M){super(bi.SKIP_SETUP),this.min_=-1/0,this.max_=1/0,this.precision_=0,this.decimalPlaces=null,this.spellcheck_=!1,t!==bi.SKIP_SETUP&&(M?this.configure_(M):this.setConstraints(o,c,g),this.setValue(t),$&&this.setValidator($))}configure_(t){super.configure_(t),this.setMinInternal(t.min),this.setMaxInternal(t.max),this.setPrecisionInternal(t.precision)}setConstraints(t,o,c){this.setMinInternal(t),this.setMaxInternal(o),this.setPrecisionInternal(c),this.setValue(this.getValue())}setMin(t){this.setMinInternal(t),this.setValue(this.getValue())}setMinInternal(t){t==null?this.min_=-1/0:(t=Number(t),isNaN(t)||(this.min_=t))}getMin(){return this.min_}setMax(t){this.setMaxInternal(t),this.setValue(this.getValue())}setMaxInternal(t){t==null?this.max_=1/0:(t=Number(t),isNaN(t)||(this.max_=t))}getMax(){return this.max_}setPrecision(t){this.setPrecisionInternal(t),this.setValue(this.getValue())}setPrecisionInternal(t){this.precision_=Number(t)||0;let o=String(this.precision_);o.includes("e")&&(o=this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}));const c=o.indexOf(".");this.decimalPlaces=c===-1?t?0:null:o.length-c-1}getPrecision(){return this.precision_}doClassValidation_(t){return t===null||(t=`${t}`.replace(/O/gi,"0"),t=t.replace(/,/g,""),t=t.replace(/infinity/i,"Infinity"),t=Number(t||0),isNaN(t))?null:(t=Math.min(Math.max(t,this.min_),this.max_),this.precision_&&isFinite(t)&&(t=Math.round(t/this.precision_)*this.precision_),this.decimalPlaces!==null&&(t=Number(t.toFixed(this.decimalPlaces))),t)}widgetCreate_(){const t=super.widgetCreate_();return-1/0<this.min_&&(t.min=`${this.min_}`,Ei(t,zr.VALUEMIN,this.min_)),1/0>this.max_&&(t.max=`${this.max_}`,Ei(t,zr.VALUEMAX,this.max_)),t}static fromJson(t){return new this(t.value,void 0,void 0,void 0,void 0,t)}};zo("field_number",mA),mA.prototype.DEFAULT_VALUE=0;var X1=class extends _f{constructor(t,o,c){super(String(t??""),o,c),this.EDITABLE=!1,this.SERIALIZABLE=!0}static fromJson(t){return new this(yi(t.text),void 0,t)}};zo("field_label_serializable",X1);var Sf=class extends bi{constructor(t,o,c){super(bi.SKIP_SETUP),this.SERIALIZABLE=!0,this.CURSOR="default",this.value_=this.value_,this.checkChar=Sf.CHECK_CHAR,t!==bi.SKIP_SETUP&&(c&&this.configure_(c),this.setValue(t),o&&this.setValidator(o))}configure_(t){super.configure_(t),t.checkCharacter&&(this.checkChar=t.checkCharacter)}saveState(){const t=this.saveLegacyState(Sf);return t!==null?t:this.getValueBoolean()}initView(){super.initView();const t=this.getTextElement();Me(t,"blocklyCheckbox"),t.style.display=this.value_?"block":"none"}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_(this.getConstants().FIELD_CHECKBOX_X_OFFSET)}getDisplayText_(){return this.checkChar}setCheckCharacter(t){this.checkChar=t||Sf.CHECK_CHAR,this.forceRerender()}showEditor_(){this.setValue(!this.value_)}doClassValidation_(t){return t===!0||t==="TRUE"?"TRUE":t===!1||t==="FALSE"?"FALSE":null}doValueUpdate_(t){this.value_=this.convertValueToBool_(t),this.textElement_&&(this.textElement_.style.display=this.value_?"block":"none")}getValue(){return this.value_?"TRUE":"FALSE"}getValueBoolean(){return this.value_}getText(){return String(this.convertValueToBool_(this.value_))}convertValueToBool_(t){return typeof t=="string"?t==="TRUE":!!t}static fromJson(t){return new this(t.checked,void 0,t)}};Sf.CHECK_CHAR="✓",zo("field_checkbox",Sf),Sf.prototype.DEFAULT_VALUE=!1;var j1=class{constructor(t,o){this.draggable=t,this.workspace=o,this.dragTarget=null,this.startLoc=t.getRelativeToSurfaceXY()}onDragStart(t){this.draggable.startDrag(t)}onDrag(t,o){this.moveDraggable(t,o),o=this.getRoot(this.draggable),eo(o)&&o.setDeleteStyle(this.wouldDeleteDraggable(t,o)),this.updateDragTarget(t)}updateDragTarget(t){t=this.workspace.getDragTarget(t);const o=this.getRoot(this.draggable);if(this.dragTarget!==t){let c;(c=this.dragTarget)==null||c.onDragExit(o),t==null||t.onDragEnter(o)}t==null||t.onDragOver(o),this.dragTarget=t}moveDraggable(t,o){o=this.pixelsToWorkspaceUnits(o),o=At.sum(this.startLoc,o),this.draggable.drag(o,t)}wouldDeleteDraggable(t,o){return(t=this.workspace.getDragTarget(t))&&this.workspace.getComponentManager().hasCapability(t.id,Vr.Capability.DELETE_AREA)?t.wouldDelete(o):!1}onDragEnd(t){const o=n.getGroup$$module$build$src$core$events$utils();var c=this.workspace.getDragTarget(t);const g=this.getRoot(this.draggable);if(c){let $;($=this.dragTarget)==null||$.onDrop(g)}this.shouldReturnToStart(t,g)&&this.draggable.revertDrag(),(c=eo(g)&&this.wouldDeleteDraggable(t,g))&&this.draggable instanceof Na&&Ld(this.draggable.getRootBlock()),this.draggable.endDrag(t),c&&eo(g)&&(t=n.getGroup$$module$build$src$core$events$utils(),n.setGroup$$module$build$src$core$events$utils(o),g.dispose(),n.setGroup$$module$build$src$core$events$utils(t))}getRoot(t){return t instanceof Na?t.getRootBlock():t}shouldReturnToStart(t,o){return(t=this.workspace.getDragTarget(t))?t.shouldPreventMove(o):!1}pixelsToWorkspaceUnits(t){return t=new At(t.x/this.workspace.scale,t.y/this.workspace.scale),this.workspace.isMutator&&t.scale(1/this.workspace.options.parentWorkspace.scale),t}};r(yt.BLOCK_DRAGGER,yo,j1);var $v={};$v.BlockDragStrategy=A1,$v.BubbleDragStrategy=s1,$v.CommentDragStrategy=PI,$v.Dragger=j1;var gA=class extends Rt{constructor(t,o,c){super(t?t.workspace.id:void 0),this.type=sc,t&&(this.blockId=t.id,this.isStart=o,this.blocks=c)}toJson(){const t=super.toJson();if(this.isStart===void 0)throw Error("Whether this event is the start of a drag is undefined. Either pass the value to the constructor, or call fromJson");if(this.blockId===void 0)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");return t.isStart=this.isStart,t.blockId=this.blockId,t.blocks=this.blocks,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new gA),o.isStart=t.isStart,o.blockId=t.blockId,o.blocks=t.blocks,o}};r(yt.EVENT,sc,gA);var _A=class extends uf{constructor(t,o,c,g){super(t),this.type=Kc,this.recordUndo=!1,t&&(this.name=o,this.oldValue=c,this.newValue=g)}toJson(){const t=super.toJson();if(!this.name)throw Error("The changed field name is undefined. Either pass a name to the constructor, or call fromJson.");return t.name=this.name,t.oldValue=this.oldValue,t.newValue=this.newValue,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new _A),o.name=t.name,o.oldValue=t.oldValue,o.newValue=t.newValue,o}isNull(){return this.oldValue===this.newValue}run(t){var o=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(o=o.getBlockById(this.blockId),!o)throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");t=t?this.newValue:this.oldValue,(o=o.getField(this.name))?o.setValue(t):console.warn("Can't set non-existent field: "+this.name)}};r(yt.EVENT,Kc,_A);var vA=class extends uf{constructor(t){super(t),this.type=n.MOVE$$module$build$src$core$events$utils,t&&(t.isShadow()&&(this.recordUndo=!1),t=this.currentLocation_(),this.oldParentId=t.parentId,this.oldInputName=t.inputName,this.oldCoordinate=t.coordinate)}toJson(){const t=super.toJson();return t.oldParentId=this.oldParentId,t.oldInputName=this.oldInputName,this.oldCoordinate&&(t.oldCoordinate=`${Math.round(this.oldCoordinate.x)}, ${Math.round(this.oldCoordinate.y)}`),t.newParentId=this.newParentId,t.newInputName=this.newInputName,this.newCoordinate&&(t.newCoordinate=`${Math.round(this.newCoordinate.x)}, ${Math.round(this.newCoordinate.y)}`),this.reason&&(t.reason=this.reason),this.recordUndo||(t.recordUndo=this.recordUndo),t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new vA),o.oldParentId=t.oldParentId,o.oldInputName=t.oldInputName,t.oldCoordinate&&(c=t.oldCoordinate.split(","),o.oldCoordinate=new At(Number(c[0]),Number(c[1]))),o.newParentId=t.newParentId,o.newInputName=t.newInputName,t.newCoordinate&&(c=t.newCoordinate.split(","),o.newCoordinate=new At(Number(c[0]),Number(c[1]))),t.reason!==void 0&&(o.reason=t.reason),t.recordUndo!==void 0&&(o.recordUndo=t.recordUndo),o}recordNew(){const t=this.currentLocation_();this.newParentId=t.parentId,this.newInputName=t.inputName,this.newCoordinate=t.coordinate}setReason(t){this.reason=t}currentLocation_(){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var o=t.getBlockById(this.blockId);if(!o)throw Error("The block associated with the block move event could not be found");t={};const c=o.getParent();return c?(t.parentId=c.id,(o=c.getInputWithBlock(o))&&(t.inputName=o.name)):t.coordinate=o.getRelativeToSurfaceXY(),t}isNull(){return this.oldParentId===this.newParentId&&this.oldInputName===this.newInputName&&At.equals(this.oldCoordinate,this.newCoordinate)}run(t){var o=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var c=o.getBlockById(this.blockId);if(c){var g=t?this.newParentId:this.oldParentId,$=t?this.newInputName:this.oldInputName;if(t=t?this.newCoordinate:this.oldCoordinate,g){var M=o.getBlockById(g);if(!M){console.warn("Can't connect to non-existent block: "+g);return}}if(c.getParent()&&c.unplug(),t)$=c.getRelativeToSurfaceXY(),c.moveBy(t.x-$.x,t.y-$.y,this.reason);else{o=c.outputConnection,(!o||c.previousConnection&&c.previousConnection.isConnected())&&(o=c.previousConnection);let Q,be;c=(be=o)==null?void 0:be.type,$?(c=M.getInput($))&&(Q=c.connection):c===Bt.PREVIOUS_STATEMENT&&(Q=M.nextConnection),Q&&o?o.connect(Q):console.warn("Can't connect to non-existent input: "+$)}}else console.warn("Can't move non-existent block: "+this.blockId)}};r(yt.EVENT,n.MOVE$$module$build$src$core$events$utils,vA);var TA=class extends Rt{constructor(t,o,c){super(t?t.workspace.id:void 0),this.type=Aa,t&&(this.blockId=t.id,this.isOpen=o,this.bubbleType=c)}toJson(){const t=super.toJson();if(this.isOpen===void 0)throw Error("Whether this event is for opening the bubble is undefined. Either pass the value to the constructor, or call fromJson");if(!this.bubbleType)throw Error("The type of bubble is undefined. Either pass the value to the constructor, or call fromJson");return t.isOpen=this.isOpen,t.bubbleType=this.bubbleType,t.blockId=this.blockId||"",t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new TA),o.isOpen=t.isOpen,o.bubbleType=t.bubbleType,o.blockId=t.blockId,o}},EA;(function(t){t.MUTATOR="mutator",t.COMMENT="comment",t.WARNING="warning"})(EA||(EA={})),r(yt.EVENT,Aa,TA);var cu=class extends ht{constructor(t){super(),this.isBlank=!t,t&&(this.commentId=t.id,this.workspaceId=t.workspace.id,this.group=n.getGroup$$module$build$src$core$events$utils(),this.recordUndo=E())}toJson(){const t=super.toJson();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");return t.commentId=this.commentId,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new cu),o.commentId=t.commentId,o}static CommentCreateDeleteHelper(t,o){const c=t.getEventWorkspace_();if(o){if(!t.json)throw Error("Encountered a comment event without proper json");kr(t.json,c)}else{if(!t.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");(o=c.getCommentById(t.commentId))?o.dispose():console.warn("Can't delete non-existent comment: "+t.commentId)}}},yA=class extends cu{constructor(t,o,c){super(t),this.type=_h,t&&(this.oldContents_=typeof o>"u"?"":o,this.newContents_=typeof c>"u"?"":c)}toJson(){const t=super.toJson();if(!this.oldContents_)throw Error("The old contents is undefined. Either pass a value to the constructor, or call fromJson");if(!this.newContents_)throw Error("The new contents is undefined. Either pass a value to the constructor, or call fromJson");return t.oldContents=this.oldContents_,t.newContents=this.newContents_,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new yA),o.oldContents_=t.oldContents,o.newContents_=t.newContents,o}isNull(){return this.oldContents_===this.newContents_}run(t){var o=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(o=o.getCommentById(this.commentId)){var c=t?this.newContents_:this.oldContents_;if(c===void 0)throw Error(t?"The new contents is undefined. Either pass a value to the constructor, or call fromJson":"The old contents is undefined. Either pass a value to the constructor, or call fromJson");o.setText(c)}else console.warn("Can't change non-existent comment: "+this.commentId)}};r(yt.EVENT,_h,yA);var SA=class extends cu{constructor(t){super(t),this.type=Jo,t&&(this.xml=ju(t),this.json=dn(t,{addCoordinates:!0}))}toJson(){const t=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.json)throw Error("The comment JSON is undefined. Either pass a block to the constructor, or call fromJson");return t.xml=Vo(this.xml),t.json=this.json,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new SA),o.xml=n.textToDom$$module$build$src$core$utils$xml(t.xml),o.json=t.json,o}run(t){cu.CommentCreateDeleteHelper(this,t)}};r(yt.EVENT,Jo,SA);var $A=class extends cu{constructor(t){super(t),this.type=ac,t&&(this.xml=ju(t),this.json=dn(t,{addCoordinates:!0}))}run(t){cu.CommentCreateDeleteHelper(this,!t)}toJson(){const t=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.json)throw Error("The comment JSON is undefined. Either pass a block to the constructor, or call fromJson");return t.xml=Vo(this.xml),t.json=this.json,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new $A),o.xml=n.textToDom$$module$build$src$core$utils$xml(t.xml),o.json=t.json,o}};r(yt.EVENT,ac,$A);var bA=class extends cu{constructor(t){super(t),this.type=Ca,t&&(this.comment_=t,this.oldCoordinate_=t.getRelativeToSurfaceXY())}recordNew(){if(this.newCoordinate_)throw Error("Tried to record the new position of a comment on the same event twice.");if(!this.comment_)throw Error("The comment is undefined. Pass a comment to the constructor if you want to use the record functionality");this.newCoordinate_=this.comment_.getRelativeToSurfaceXY()}setReason(t){this.reason=t}setOldCoordinate(t){this.oldCoordinate_=t}toJson(){const t=super.toJson();if(!this.oldCoordinate_)throw Error("The old comment position is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.newCoordinate_)throw Error("The new comment position is undefined. Either call recordNew, or call fromJson");return t.oldCoordinate=`${Math.round(this.oldCoordinate_.x)}, ${Math.round(this.oldCoordinate_.y)}`,t.newCoordinate=Math.round(this.newCoordinate_.x)+","+Math.round(this.newCoordinate_.y),t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new bA),c=t.oldCoordinate.split(","),o.oldCoordinate_=new At(Number(c[0]),Number(c[1])),c=t.newCoordinate.split(","),o.newCoordinate_=new At(Number(c[0]),Number(c[1])),o}isNull(){return At.equals(this.oldCoordinate_,this.newCoordinate_)}run(t){var o=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(o=o.getCommentById(this.commentId)){if(t=t?this.newCoordinate_:this.oldCoordinate_,!t)throw Error("Either oldCoordinate_ or newCoordinate_ is undefined. Either pass a comment to the constructor and call recordNew, or call fromJson");o.moveTo(t)}else console.warn("Can't move non-existent comment: "+this.commentId)}};r(yt.EVENT,Ca,bA);var AA=class extends cu{constructor(t,o){super(t),this.newCollapsed=o,this.type=vh}toJson(){const t=super.toJson();if(this.newCollapsed===void 0)throw Error("The new collapse value undefined. Either call recordNew, or call fromJson");return t.newCollapsed=this.newCollapsed,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new AA),o.newCollapsed=t.newCollapsed,o}run(t){var o=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");(o=o.getCommentById(this.commentId))?o.setCollapsed(t?!!this.newCollapsed:!this.newCollapsed):console.warn("Can't collapse or uncollapse non-existent comment: "+this.commentId)}};r(yt.EVENT,vh,AA);var CA=class extends Rt{constructor(t,o,c){super(c),this.type=hl,this.oldItem=t??void 0,this.newItem=o??void 0}toJson(){const t=super.toJson();return t.oldItem=this.oldItem,t.newItem=this.newItem,t}static fromJson(t,o,c){return o=super.fromJson(t,o,c??new CA),o.oldItem=t.oldItem,o.newItem=t.newItem,o}};r(yt.EVENT,hl,CA);var Y1=class extends ht{constructor(t){super(),this.isBlank=!0,this.recordUndo=!1,this.type=lc,this.isBlank=!!t,t&&(this.workspaceId=t.id)}};r(yt.EVENT,lc,Y1),n.CHANGE$$module$build$src$core$events$utils,n.CREATE$$module$build$src$core$events$utils,n.DELETE$$module$build$src$core$events$utils,n.MOVE$$module$build$src$core$events$utils,n.CHANGE$$module$build$src$core$events$utils,n.CREATE$$module$build$src$core$events$utils,n.DELETE$$module$build$src$core$events$utils,n.MOVE$$module$build$src$core$events$utils,n.disable$$module$build$src$core$events$utils,n.enable$$module$build$src$core$events$utils,n.getGroup$$module$build$src$core$events$utils,n.setGroup$$module$build$src$core$events$utils,n.setRecordUndo$$module$build$src$core$events$utils;var Ut={};Ut.Abstract=ht,Ut.BLOCK_CHANGE=n.CHANGE$$module$build$src$core$events$utils,Ut.BLOCK_CREATE=n.CREATE$$module$build$src$core$events$utils,Ut.BLOCK_DELETE=n.DELETE$$module$build$src$core$events$utils,Ut.BLOCK_DRAG=sc,Ut.BLOCK_FIELD_INTERMEDIATE_CHANGE=Kc,Ut.BLOCK_MOVE=n.MOVE$$module$build$src$core$events$utils,Ut.BUBBLE_OPEN=Aa,Ut.BUMP_EVENTS=Th,Ut.BlockBase=uf,Ut.BlockChange=hf,Ut.BlockCreate=Lb,Ut.BlockDelete=jb,Ut.BlockDrag=gA,Ut.BlockFieldIntermediateChange=_A,Ut.BlockMove=vA,Ut.BubbleOpen=TA,Ut.BubbleType=EA,Ut.CHANGE=n.CHANGE$$module$build$src$core$events$utils,Ut.CLICK=cr,Ut.COMMENT_CHANGE=_h,Ut.COMMENT_CREATE=Jo,Ut.COMMENT_DELETE=ac,Ut.COMMENT_MOVE=Ca,Ut.CREATE=n.CREATE$$module$build$src$core$events$utils,Ut.Click=Gt,Ut.ClickTarget=En,Ut.CommentBase=cu,Ut.CommentChange=yA,Ut.CommentCollapse=AA,Ut.CommentCreate=SA,Ut.CommentDelete=$A,Ut.CommentMove=bA,Ut.DELETE=n.DELETE$$module$build$src$core$events$utils,Ut.FINISHED_LOADING=lc,Ut.FinishedLoading=Y1,Ut.MARKER_MOVE=oc,Ut.MOVE=n.MOVE$$module$build$src$core$events$utils,Ut.MarkerMove=Yb,Ut.SELECTED=gh,Ut.Selected=iA,Ut.THEME_CHANGE=So,Ut.TOOLBOX_ITEM_SELECT=hl,Ut.TRASHCAN_OPEN=to,Ut.ThemeChange=Nb,Ut.ToolboxItemSelect=CA,Ut.TrashcanOpen=nA,Ut.UI=rf,Ut.UiBase=Rt,Ut.VAR_CREATE=ba,Ut.VAR_DELETE=Jc,Ut.VAR_RENAME=mh,Ut.VIEWPORT_CHANGE=Ko,Ut.VarBase=nv,Ut.VarCreate=cb,Ut.VarDelete=Qb,Ut.VarRename=eA,Ut.ViewportChange=kb,Ut.clearPendingUndo=C,Ut.disable=n.disable$$module$build$src$core$events$utils,Ut.disableOrphans=D,Ut.enable=n.enable$$module$build$src$core$events$utils,Ut.filter=A,Ut.fire=b,Ut.fromJson=F,Ut.get=k,Ut.getDescendantIds=O,Ut.getGroup=n.getGroup$$module$build$src$core$events$utils,Ut.getRecordUndo=E,Ut.isEnabled=R,Ut.setGroup=n.setGroup$$module$build$src$core$events$utils,Ut.setRecordUndo=n.setRecordUndo$$module$build$src$core$events$utils;var vl={};vl.BottomRow=k1,vl.ConstantProvider=L1,vl.Drawer=N1,vl.MarkerSvg=F1,vl.PathObject=U1,vl.RenderInfo=B1,vl.Renderer=fA,vl.RightConnectionShape=P1,vl.StatementInput=xy,vl.TopRow=D1,tf();var Wr={};Wr.registerCleanup=Kd,Wr.registerCollapse=ts,Wr.registerCollapseExpandBlock=Xc,Wr.registerComment=Sa,Wr.registerCommentCreate=Ls,Wr.registerCommentDelete=Gr,Wr.registerCommentDuplicate=$a,Wr.registerCommentOptions=W_,Wr.registerDefaultOptions=tf,Wr.registerDelete=fh,Wr.registerDeleteAll=qd,Wr.registerDisable=Qd,Wr.registerDuplicate=hh,Wr.registerExpand=Jd,Wr.registerHelp=ph,Wr.registerInline=dh,Wr.registerRedo=uh,Wr.registerUndo=ic;var wy={};wy.CommentView=kI,wy.RenderedWorkspaceComment=ay,wy.WorkspaceComment=JE;var bv={};bv.Bubble=di,bv.MiniWorkspaceBubble=iu,bv.TextBubble=Bb,bv.TextInputBubble=l1;var K1=class extends gy{constructor(){super(),this.FIELD_TEXT_BASELINE_CENTER=!1,this.DARK_PATH_OFFSET=1,this.MAX_BOTTOM_WIDTH=30,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT/2}getCSS_(t){return super.getCSS_(t).concat([`${t} .blocklyInsertionMarker>.blocklyPathLight,`,`${t} .blocklyInsertionMarker>.blocklyPathDark {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"])}},J1=class{constructor(t){this.inlineSteps_=this.steps_="",this.info_=t,this.RTL_=this.info_.RTL,t=t.getRenderer(),this.constants_=t.getConstants(),this.highlightConstants_=t.getHighlightConstants(),this.highlightOffset=this.highlightConstants_.OFFSET,this.outsideCornerPaths_=this.highlightConstants_.OUTSIDE_CORNER,this.insideCornerPaths_=this.highlightConstants_.INSIDE_CORNER,this.puzzleTabPaths_=this.highlightConstants_.PUZZLE_TAB,this.notchPaths_=this.highlightConstants_.NOTCH,this.startPaths_=this.highlightConstants_.START_HAT,this.jaggedTeethPaths_=this.highlightConstants_.JAGGED_TEETH}getPath(){return this.steps_+`
`+this.inlineSteps_}drawTopCorner(t){this.steps_+=Si(t.xPos,this.info_.startY);for(let o=0,c;c=t.elements[o];o++)ke.isLeftSquareCorner(c)?this.steps_+=this.highlightConstants_.START_POINT:ke.isLeftRoundedCorner(c)?this.steps_+=this.outsideCornerPaths_.topLeft(this.RTL_):ke.isPreviousConnection(c)?this.steps_+=this.notchPaths_.pathLeft:ke.isHat(c)?this.steps_+=this.startPaths_.path(this.RTL_):ke.isSpacer(c)&&c.width!==0&&(this.steps_+=Nt("H",c.xPos+c.width-this.highlightOffset));this.steps_+=Nt("H",t.xPos+t.width-this.highlightOffset)}drawJaggedEdge_(t){this.info_.RTL&&(this.steps_+=this.jaggedTeethPaths_.pathLeft+Nt("v",t.height-this.jaggedTeethPaths_.height-this.highlightOffset))}drawValueInput(t){const o=t.getLastInput();if(this.RTL_){const c=t.height-o.connectionHeight;this.steps_+=Zi(o.xPos+o.width-this.highlightOffset,t.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)+Nt("v",c)}else this.steps_+=Zi(o.xPos+o.width,t.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)}drawStatementInput(t){const o=t.getLastInput();if(o)if(this.RTL_){const c=t.height-2*this.insideCornerPaths_.height;this.steps_+=Zi(o.xPos,t.yPos)+this.insideCornerPaths_.pathTop(this.RTL_)+Nt("v",c)+this.insideCornerPaths_.pathBottom(this.RTL_)+Xo(t.width-o.xPos-this.insideCornerPaths_.width,0)}else this.steps_+=Zi(o.xPos,t.yPos+t.height)+this.insideCornerPaths_.pathBottom(this.RTL_)+Xo(t.width-o.xPos-this.insideCornerPaths_.width,0)}drawRightSideRow(t){const o=t.xPos+t.width-this.highlightOffset;t instanceof Wb&&t.followsStatement&&(this.steps_+=Nt("H",o)),this.RTL_&&(this.steps_+=Nt("H",o),t.height>this.highlightOffset&&(this.steps_+=Nt("V",t.yPos+t.height-this.highlightOffset)))}drawBottomRow(t){if(this.RTL_)this.steps_+=Nt("V",t.baseline-this.highlightOffset);else{const o=this.info_.bottomRow.elements[0];ke.isLeftSquareCorner(o)?this.steps_+=Zi(t.xPos+this.highlightOffset,t.baseline-this.highlightOffset):ke.isLeftRoundedCorner(o)&&(this.steps_+=Zi(t.xPos,t.baseline),this.steps_+=this.outsideCornerPaths_.bottomLeft())}}drawLeft(){var t=this.info_.outputConnection;t&&(t=t.connectionOffsetY+t.height,this.RTL_?this.steps_+=Zi(this.info_.startX,t):(this.steps_+=Zi(this.info_.startX+this.highlightOffset,this.info_.bottomRow.baseline-this.highlightOffset),this.steps_+=Nt("V",t)),this.steps_+=this.puzzleTabPaths_.pathUp(this.RTL_)),this.RTL_||(t=this.info_.topRow,ke.isLeftRoundedCorner(t.elements[0])?this.steps_+=Nt("V",this.outsideCornerPaths_.height):this.steps_+=Nt("V",t.capline+this.highlightOffset))}drawInlineInput(t){const o=this.highlightOffset,c=t.xPos+t.connectionWidth;var g=t.centerline-t.height/2;const $=t.width-t.connectionWidth,M=g+o;this.RTL_?(g=t.connectionOffsetY-o,t=t.height-(t.connectionOffsetY+t.connectionHeight)+o,this.inlineSteps_+=Zi(c-o,M)+Nt("v",g)+this.puzzleTabPaths_.pathDown(this.RTL_)+Nt("v",t)+Nt("h",$)):this.inlineSteps_+=Zi(t.xPos+t.width+o,M)+Nt("v",t.height)+Nt("h",-$)+Zi(c,g+t.connectionOffsetY)+this.puzzleTabPaths_.pathDown(this.RTL_)}},Z1=class extends _y{constructor(t,o){super(t,o),this.highlighter_=new J1(o)}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights();const t=this.block_.pathObject;t.setPath(this.outlinePath_+`
`+this.inlinePath_),t.setHighlightPath(this.highlighter_.getPath()),this.info_.RTL&&t.flipRTL(),this.recordSizeOnBlock_()}drawTop_(){this.highlighter_.drawTopCorner(this.info_.topRow),this.highlighter_.drawRightSideRow(this.info_.topRow),super.drawTop_()}drawJaggedEdge_(t){this.highlighter_.drawJaggedEdge_(t),super.drawJaggedEdge_(t)}drawValueInput_(t){this.highlighter_.drawValueInput(t),super.drawValueInput_(t)}drawStatementInput_(t){this.highlighter_.drawStatementInput(t),super.drawStatementInput_(t)}drawRightSideRow_(t){this.highlighter_.drawRightSideRow(t),this.outlinePath_+=Nt("H",t.xPos+t.width)+Nt("V",t.yPos+t.height)}drawBottom_(){this.highlighter_.drawBottomRow(this.info_.bottomRow),super.drawBottom_()}drawLeft_(){this.highlighter_.drawLeft(),super.drawLeft_()}drawInlineInput_(t){this.highlighter_.drawInlineInput(t),super.drawInlineInput_(t)}positionInlineInputConnection_(t){const o=t.centerline-t.height/2;if(t.connectionModel){let c=t.xPos+t.connectionWidth+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(c*=-1),t.connectionModel.setOffsetInBlock(c,o+t.connectionOffsetY+this.constants_.DARK_PATH_OFFSET)}}positionStatementInputConnection_(t){const o=t.getLastInput();if(o!=null&&o.connectionModel){let c=t.xPos+t.statementEdge+o.notchOffset;c=this.info_.RTL?-1*c:c+this.constants_.DARK_PATH_OFFSET,o.connectionModel.setOffsetInBlock(c,t.yPos+this.constants_.DARK_PATH_OFFSET)}}positionExternalValueConnection_(t){const o=t.getLastInput();if(o&&o.connectionModel){let c=t.xPos+t.width+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(c*=-1),o.connectionModel.setOffsetInBlock(c,t.yPos)}}positionNextConnection_(){const t=this.info_.bottomRow;if(t.connection){const o=t.connection,c=o.xPos;o.connectionModel.setOffsetInBlock((this.info_.RTL?-c:c)+this.constants_.DARK_PATH_OFFSET/2,t.baseline+this.constants_.DARK_PATH_OFFSET)}}},q1=class{constructor(t){this.OFFSET=.5,this.constantProvider=t,this.START_POINT=Si(this.OFFSET,this.OFFSET)}init(){this.INSIDE_CORNER=this.makeInsideCorner(),this.OUTSIDE_CORNER=this.makeOutsideCorner(),this.PUZZLE_TAB=this.makePuzzleTab(),this.NOTCH=this.makeNotch(),this.JAGGED_TEETH=this.makeJaggedTeeth(),this.START_HAT=this.makeStartHat()}makeInsideCorner(){const t=this.constantProvider.CORNER_RADIUS,o=this.OFFSET,c=(1-Math.SQRT1_2)*(t+o)-o,g=Si(c,c)+Di("a","0 0,0",t,zt(-c-o,t-c)),$=Di("a","0 0,0",t+o,zt(t+o,t+o)),M=Si(c,-c)+Di("a","0 0,0",t+o,zt(t-c,c+o));return{width:t+o,height:t,pathTop(Q){return Q?g:""},pathBottom(Q){return Q?$:M}}}makeOutsideCorner(){const t=this.constantProvider.CORNER_RADIUS,o=this.OFFSET,c=(1-Math.SQRT1_2)*(t-o)+o,g=Si(c,c)+Di("a","0 0,1",t-o,zt(t-c,-c+o)),$=Si(o,t)+Di("a","0 0,1",t-o,zt(t,-t+o)),M=-c,Q=Si(c,M)+Di("a","0 0,1",t-o,zt(-c+o,-M-t));return{height:t,topLeft(be){return be?g:$},bottomLeft(){return Q}}}makePuzzleTab(){const t=this.constantProvider.TAB_WIDTH,o=this.constantProvider.TAB_HEIGHT,c=Si(-2,-o+3.4)+Xo(-.45*t,-2.1),g=Nt("v",2.5)+Si(.97*-t,2.5)+fs("q",[zt(.05*-t,10),zt(.3*t,9.5)])+Si(.67*t,-1.9)+Nt("v",2.5),$=Nt("v",-1.5)+Si(-.92*t,-.5)+fs("q",[zt(-.19*t,-5.5),zt(0,-11)])+Si(.92*t,1),M=Si(-5,o-.7)+Xo(.46*t,-2.1);return{width:t,height:o,pathUp(Q){return Q?c:$},pathDown(Q){return Q?g:M}}}makeNotch(){return{pathLeft:Nt("h",this.OFFSET)+this.constantProvider.NOTCH.pathLeft}}makeJaggedTeeth(){return{pathLeft:Xo(5.1,2.6)+Si(-10.2,6.8)+Xo(5.1,2.6),height:12,width:10.2}}makeStartHat(){const t=this.constantProvider.START_HAT.height,o=Si(25,-8.7)+fs("c",[zt(29.7,-6.2),zt(57.2,-.5),zt(75,8.7)]),c=fs("c",[zt(17.8,-9.2),zt(45.3,-14.9),zt(75,-8.7)])+Zi(100.5,t+.5);return{path(g){return g?o:c}}}},Q1=class extends Vb{constructor(t,o){super(t,o),this.constants_=t,this.connectedBlock&&(this.width+=this.constants_.DARK_PATH_OFFSET,this.height+=this.constants_.DARK_PATH_OFFSET)}},eO=class extends mv{constructor(t,o){super(t,o),this.constants_=t,this.connectedBlock&&(this.height+=this.constants_.DARK_PATH_OFFSET)}},tO=class extends vv{constructor(t,o){super(t,o),this.renderer_=t}getRenderer(){return this.renderer_}populateBottomRow_(){super.populateBottomRow_(),this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof ta||(this.bottomRow.minHeight=this.constants_.MEDIUM_PADDING-this.constants_.DARK_PATH_OFFSET)}addInput_(t,o){this.isInline&&t instanceof n.ValueInput$$module$build$src$core$inputs$value_input?(o.elements.push(new Q1(this.constants_,t)),o.hasInlineInput=!0):t instanceof ta?(o.elements.push(new eO(this.constants_,t)),o.hasStatement=!0):t instanceof n.ValueInput$$module$build$src$core$inputs$value_input?(o.elements.push(new my(this.constants_,t)),o.hasExternalInput=!0):(t instanceof dc||t instanceof lu)&&(o.minHeight=Math.max(o.minHeight,this.constants_.DUMMY_INPUT_MIN_HEIGHT),o.hasDummyInput=!0),this.isInline||o.align!==null||(o.align=t.align)}addElemSpacing_(){let t=!1;for(let c=0,g;g=this.rows[c];c++)g.hasExternalInput&&(t=!0);for(let c=0,g;g=this.rows[c];c++){var o=g.elements;if(g.elements=[],g.startsWithElemSpacer()&&g.elements.push(new ea(this.constants_,this.getInRowSpacing_(null,o[0]))),o.length){for(let $=0;$<o.length-1;$++){g.elements.push(o[$]);const M=this.getInRowSpacing_(o[$],o[$+1]);g.elements.push(new ea(this.constants_,M))}g.elements.push(o[o.length-1]),g.endsWithElemSpacer()&&(o=this.getInRowSpacing_(o[o.length-1],null),t&&g.hasDummyInput&&(o+=this.constants_.TAB_WIDTH),g.elements.push(new ea(this.constants_,o)))}}}getInRowSpacing_(t,o){if(!t)return o&&ke.isField(o)&&o.isEditable?this.constants_.MEDIUM_PADDING:o&&ke.isInlineInput(o)?this.constants_.MEDIUM_LARGE_PADDING:o&&ke.isStatementInput(o)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!ke.isInput(t)&&(!o||ke.isStatementInput(o)))return ke.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:ke.isIcon(t)?2*this.constants_.LARGE_PADDING+1:ke.isHat(t)?this.constants_.NO_PADDING:ke.isPreviousOrNextConnection(t)?this.constants_.LARGE_PADDING:ke.isLeftRoundedCorner(t)?this.constants_.MIN_BLOCK_WIDTH:ke.isJaggedEdge(t)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(ke.isInput(t)&&!o){if(ke.isExternalInput(t))return this.constants_.NO_PADDING;if(ke.isInlineInput(t))return this.constants_.LARGE_PADDING;if(ke.isStatementInput(t))return this.constants_.NO_PADDING}if(!ke.isInput(t)&&o&&ke.isInput(o)){if(ke.isField(t)&&t.isEditable){if(ke.isInlineInput(o)||ke.isExternalInput(o))return this.constants_.SMALL_PADDING}else{if(ke.isInlineInput(o)||ke.isExternalInput(o))return this.constants_.MEDIUM_LARGE_PADDING;if(ke.isStatementInput(o))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(ke.isIcon(t)&&o&&!ke.isInput(o))return this.constants_.LARGE_PADDING;if(ke.isInlineInput(t)&&o&&ke.isField(o))return o.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(ke.isLeftSquareCorner(t)&&o){if(ke.isHat(o))return this.constants_.NO_PADDING;if(ke.isPreviousConnection(o))return o.notchOffset;if(ke.isNextConnection(o))return o.notchOffset+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}if(ke.isLeftRoundedCorner(t)&&o){if(ke.isPreviousConnection(o))return o.notchOffset-this.constants_.CORNER_RADIUS;if(ke.isNextConnection(o))return o.notchOffset-this.constants_.CORNER_RADIUS+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}return ke.isField(t)&&o&&ke.isField(o)&&t.isEditable===o.isEditable||o&&ke.isJaggedEdge(o)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(t,o){return ke.isTopRow(t)&&ke.isBottomRow(o)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:ke.isTopRow(t)||ke.isBottomRow(o)?this.constants_.NO_PADDING:t.hasExternalInput&&o.hasExternalInput?this.constants_.LARGE_PADDING:!t.hasStatement&&o.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:t.hasStatement&&o.hasStatement||!t.hasStatement&&o.hasDummyInput||t.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(t,o){if(ke.isSpacer(o))return t.yPos+o.height/2;if(ke.isBottomRow(t))return t=t.yPos+t.height-t.descenderHeight,ke.isNextConnection(o)?t+o.height/2:t-o.height/2;if(ke.isTopRow(t))return ke.isHat(o)?t.capline-o.height/2:t.capline+o.height/2;let c=t.yPos;return ke.isField(o)||ke.isIcon(o)?(c+=o.height/2,(t.hasInlineInput||t.hasStatement)&&o.height+this.constants_.TALL_INPUT_FIELD_OFFSET_Y<=t.height&&(c+=this.constants_.TALL_INPUT_FIELD_OFFSET_Y)):c=ke.isInlineInput(o)?c+o.height/2:c+t.height/2,c}alignRowElements_(){if(this.isInline){var t=0,o=new WeakMap,c=null;for(let g=this.rows.length-1,$;$=this.rows[g];g--)o.set($,t),ke.isInputRow($)&&($.hasStatement&&this.alignStatementRow_($),c&&c.hasStatement&&$.width<c.width?o.set($,c.width):t=$.hasStatement?$.width:Math.max(t,$.width),c=$);t=0;for(let g=0,$;$=this.rows[g];g++)$.hasStatement?t=this.getDesiredRowWidth_($):ke.isSpacer($)?$.width=Math.max(t,o.get($)):(c=$.width,t=Math.max(t,o.get($))-c,0<t&&this.addAlignmentPadding_($,t),t=$.width)}else super.alignRowElements_()}getDesiredRowWidth_(t){return this.isInline&&t.hasStatement?this.statementEdge+this.constants_.MAX_BOTTOM_WIDTH+this.startX:super.getDesiredRowWidth_(t)}finalize_(){let t=0,o=0;for(let g=0,$;$=this.rows[g];g++){$.yPos=o,$.xPos=this.startX,o+=$.height,t=Math.max(t,$.widthWithConnectedBlocks);var c=o-this.topRow.ascenderHeight;$===this.bottomRow&&c<this.constants_.MIN_BLOCK_HEIGHT&&(c=this.constants_.MIN_BLOCK_HEIGHT-c,this.bottomRow.height+=c,o+=c),this.recordElemPositions_($)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(c=this.block_.nextConnection.targetBlock())&&(t=Math.max(t,c.getHeightWidth().width-this.constants_.DARK_PATH_OFFSET)),this.bottomRow.baseline=o-this.bottomRow.descenderHeight,this.widthWithChildren=t+this.startX+this.constants_.DARK_PATH_OFFSET,this.width+=this.constants_.DARK_PATH_OFFSET,this.height=o+this.constants_.DARK_PATH_OFFSET,this.startY=this.topRow.capline}},nO=class extends vy{constructor(t,o,c){super(t,o,c),this.constants=c,this.colourDark="#000000",this.svgPathDark=Ce(Ve.PATH,{class:"blocklyPathDark",transform:"translate(1,1)"}),this.svgRoot.insertBefore(this.svgPathDark,this.svgPath),this.svgPathLight=Ce(Ve.PATH,{class:"blocklyPathLight"},this.svgRoot)}setPath(t){this.svgPath.setAttribute("d",t),this.svgPathDark.setAttribute("d",t)}setHighlightPath(t){this.svgPathLight.setAttribute("d",t)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)"),this.svgPathLight.setAttribute("transform","scale(-1 1)"),this.svgPathDark.setAttribute("transform","translate(1,1) scale(-1 1)")}applyColour(t){if(this.svgPathLight.style.display="",this.svgPathDark.style.display="",!this.style.colourTertiary)throw Error("The renderer did not properly initialize the tertiary colour of the block style");this.svgPathLight.setAttribute("stroke",this.style.colourTertiary),this.svgPathDark.setAttribute("fill",this.colourDark),super.applyColour(t),this.svgPath.setAttribute("stroke","none")}setStyle(t){this.style=t,this.colourDark=Go("#000",this.style.colourPrimary,.2)||this.colourDark}updateHighlighted(t){t?(this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"),this.svgPathLight.style.display="none"):(this.svgPath.setAttribute("filter","none"),this.svgPathLight.style.display="inline")}updateShadow_(t){if(t){if(this.svgPathLight.style.display="none",!this.style.colourSecondary)throw Error("The renderer did not properly initialize the secondary colour of the block style block style");this.svgPathDark.setAttribute("fill",this.style.colourSecondary),this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary)}}updateDisabled_(t){super.updateDisabled_(t),t&&this.svgPath.setAttribute("stroke","none")}},iO=class extends Ty{constructor(t){super(t),this.highlightConstants=null}init(t,o){super.init(t,o),this.highlightConstants=this.makeHighlightConstants_(),this.highlightConstants.init()}refreshDom(t,o){super.refreshDom(t,o),this.getHighlightConstants().init()}makeConstants_(){return new K1}makeRenderInfo_(t){return new tO(this,t)}makeDrawer_(t,o){return new Z1(t,o)}makePathObject(t,o){return new nO(t,o,this.getConstants())}makeHighlightConstants_(){return new q1(this.getConstants())}getHighlightConstants(){if(!this.highlightConstants)throw Error("Cannot access the highlight constants because init has not been called");return this.highlightConstants}};ih("geras",iO);var mc={};mc.ConstantProvider=K1,mc.Drawer=Z1,mc.HighlightConstantProvider=q1,mc.Highlighter=J1,mc.InlineInput=Q1,mc.PathObject=nO,mc.RenderInfo=tO,mc.Renderer=iO,mc.StatementInput=eO;var rO=class extends vv{constructor(t,o){super(t,o)}getRenderer(){return this.renderer_}addElemSpacing_(){let t=!1;for(var o=0;o<this.rows.length;o++)if(this.rows[o].hasExternalInput){t=!0;break}for(o=0;o<this.rows.length;o++){const g=this.rows[o];var c=g.elements;if(g.elements=[],g.startsWithElemSpacer()&&g.elements.push(new ea(this.constants_,this.getInRowSpacing_(null,c[0]))),c.length){for(let $=0;$<c.length-1;$++){g.elements.push(c[$]);const M=this.getInRowSpacing_(c[$],c[$+1]);g.elements.push(new ea(this.constants_,M))}g.elements.push(c[c.length-1]),g.endsWithElemSpacer()&&(c=this.getInRowSpacing_(c[c.length-1],null),t&&g.hasDummyInput&&(c+=this.constants_.TAB_WIDTH),g.elements.push(new ea(this.constants_,c)))}}}getInRowSpacing_(t,o){if(!t)return o&&ke.isField(o)&&o.isEditable?this.constants_.MEDIUM_PADDING:o&&ke.isInlineInput(o)?this.constants_.MEDIUM_LARGE_PADDING:o&&ke.isStatementInput(o)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!ke.isInput(t)&&!o)return ke.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:ke.isIcon(t)?2*this.constants_.LARGE_PADDING+1:ke.isHat(t)?this.constants_.NO_PADDING:ke.isPreviousOrNextConnection(t)?this.constants_.LARGE_PADDING:ke.isLeftRoundedCorner(t)?this.constants_.MIN_BLOCK_WIDTH:ke.isJaggedEdge(t)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(ke.isInput(t)&&!o){if(ke.isExternalInput(t))return this.constants_.NO_PADDING;if(ke.isInlineInput(t))return this.constants_.LARGE_PADDING;if(ke.isStatementInput(t))return this.constants_.NO_PADDING}if(!ke.isInput(t)&&o&&ke.isInput(o)){if(ke.isField(t)&&t.isEditable){if(ke.isInlineInput(o)||ke.isExternalInput(o))return this.constants_.SMALL_PADDING}else{if(ke.isInlineInput(o)||ke.isExternalInput(o))return this.constants_.MEDIUM_LARGE_PADDING;if(ke.isStatementInput(o))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(ke.isIcon(t)&&o&&!ke.isInput(o))return this.constants_.LARGE_PADDING;if(ke.isInlineInput(t)&&o&&ke.isField(o))return o.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(ke.isLeftSquareCorner(t)&&o){if(ke.isHat(o))return this.constants_.NO_PADDING;if(ke.isPreviousConnection(o)||ke.isNextConnection(o))return o.notchOffset}return ke.isLeftRoundedCorner(t)&&o?o.notchOffset-this.constants_.CORNER_RADIUS:ke.isField(t)&&o&&ke.isField(o)&&t.isEditable===o.isEditable||o&&ke.isJaggedEdge(o)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(t,o){return ke.isTopRow(t)&&ke.isBottomRow(o)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:ke.isTopRow(t)||ke.isBottomRow(o)?this.constants_.NO_PADDING:t.hasExternalInput&&o.hasExternalInput?this.constants_.LARGE_PADDING:!t.hasStatement&&o.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:t.hasStatement&&o.hasStatement||t.hasDummyInput||o.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(t,o){if(ke.isSpacer(o))return t.yPos+o.height/2;if(ke.isBottomRow(t))return t=t.yPos+t.height-t.descenderHeight,ke.isNextConnection(o)?t+o.height/2:t-o.height/2;if(ke.isTopRow(t))return ke.isHat(o)?t.capline-o.height/2:t.capline+o.height/2;let c=t.yPos;return c=ke.isField(o)&&t.hasStatement?c+(this.constants_.TALL_INPUT_FIELD_OFFSET_Y+o.height/2):c+t.height/2}finalize_(){let t=0,o=0;for(var c=0;c<this.rows.length;c++){const $=this.rows[c];$.yPos=o,$.xPos=this.startX,o+=$.height,t=Math.max(t,$.widthWithConnectedBlocks);var g=o-this.topRow.ascenderHeight;$===this.bottomRow&&g<this.constants_.MIN_BLOCK_HEIGHT&&(g=this.constants_.MIN_BLOCK_HEIGHT-g,this.bottomRow.height+=g,o+=g),this.recordElemPositions_($)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(c=this.block_.nextConnection.targetBlock())&&(t=Math.max(t,c.getHeightWidth().width)),this.bottomRow.baseline=o-this.bottomRow.descenderHeight,this.widthWithChildren=t+this.startX,this.height=o,this.startY=this.topRow.capline}},sO=class extends Ty{constructor(t){super(t)}makeRenderInfo_(t){return new rO(this,t)}};ih("thrasos",sO);var xA={};xA.RenderInfo=rO,xA.Renderer=sO;var OG={colour_blocks:{colourPrimary:"#CF63CF",colourSecondary:"#C94FC9",colourTertiary:"#BD42BD"},list_blocks:{colourPrimary:"#9966FF",colourSecondary:"#855CD6",colourTertiary:"#774DCB"},logic_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC"},loop_blocks:{colourPrimary:"#0fBD8C",colourSecondary:"#0DA57A",colourTertiary:"#0B8E69"},math_blocks:{colourPrimary:"#59C059",colourSecondary:"#46B946",colourTertiary:"#389438"},procedure_blocks:{colourPrimary:"#FF6680",colourSecondary:"#FF4D6A",colourTertiary:"#FF3355"},text_blocks:{colourPrimary:"#FFBF00",colourSecondary:"#E6AC00",colourTertiary:"#CC9900"},variable_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},variable_dynamic_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},hat_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC",hat:"cap"}},LG={colour_category:{colour:"#CF63CF"},list_category:{colour:"#9966FF"},logic_category:{colour:"#4C97FF"},loop_category:{colour:"#0fBD8C"},math_category:{colour:"#59C059"},procedure_category:{colour:"#FF6680"},text_category:{colour:"#FFBF00"},variable_category:{colour:"#FF8C1A"},variable_dynamic_category:{colour:"#FF8C1A"}},NG=new gf("zelos",OG,LG),kG={Classic:cy,Zelos:NG},RA=class{constructor(t,o,c){this.id_=t.toolboxitemid||m(),this.level_=(this.parent_=c||null)?this.parent_.getLevel()+1:0,this.toolboxItemDef_=t,this.parentToolbox_=o,this.workspace_=this.parentToolbox_.getWorkspace()}init(){}getDiv(){return null}getClickTarget(){return null}getId(){return this.id_}getParent(){return null}getLevel(){return this.level_}isSelectable(){return!1}isCollapsible(){return!1}dispose(){}setVisible_(t){}},Tl=class extends RA{constructor(t,o,c){super(t,o,c),this.colour_=this.name_="",this.labelDom_=this.iconDom_=this.rowContents_=this.rowDiv_=this.htmlDiv_=null,this.isDisabled_=this.isHidden_=!1,this.flyoutItems_=[],this.cssConfig_=this.makeDefaultCssConfig_()}init(){this.parseCategoryDef_(this.toolboxItemDef_),this.parseContents_(this.toolboxItemDef_),this.createDom_(),this.toolboxItemDef_.hidden==="true"&&this.hide()}makeDefaultCssConfig_(){return{container:"blocklyToolboxCategory",row:"blocklyTreeRow",rowcontentcontainer:"blocklyTreeRowContentContainer",icon:"blocklyTreeIcon",label:"blocklyTreeLabel",contents:"blocklyToolboxContents",selected:"blocklyTreeSelected",openicon:"blocklyTreeIconOpen",closedicon:"blocklyTreeIconClosed"}}parseContents_(t){if("custom"in t)this.flyoutItems_=t.custom;else if(t=t.contents)for(let o=0;o<t.length;o++){const c=t[o];Array.isArray(this.flyoutItems_)&&this.flyoutItems_.push(c)}}parseCategoryDef_(t){this.name_="name"in t?yi(t.name):"",this.colour_=this.getColour_(t),Object.assign(this.cssConfig_,t.cssconfig||t.cssConfig)}createDom_(){this.htmlDiv_=this.createContainer_(),sn(this.htmlDiv_,pl.TREEITEM),Ei(this.htmlDiv_,zr.SELECTED,!1),Ei(this.htmlDiv_,zr.LEVEL,this.level_+1),this.rowDiv_=this.createRowContainer_(),this.rowDiv_.style.pointerEvents="auto",this.htmlDiv_.appendChild(this.rowDiv_),this.rowContents_=this.createRowContentsContainer_(),this.rowContents_.style.pointerEvents="none",this.rowDiv_.appendChild(this.rowContents_),this.iconDom_=this.createIconDom_(),sn(this.iconDom_,pl.PRESENTATION),this.rowContents_.appendChild(this.iconDom_),this.labelDom_=this.createLabelDom_(this.name_),this.rowContents_.appendChild(this.labelDom_);const t=this.labelDom_.getAttribute("id");return t&&Ei(this.htmlDiv_,zr.LABELLEDBY,t),this.addColourBorder_(this.colour_),this.htmlDiv_}createContainer_(){const t=document.createElement("div"),o=this.cssConfig_.container;return o&&Me(t,o),t}createRowContainer_(){const t=document.createElement("div");var o=this.cssConfig_.row;return o&&Me(t,o),o=`${Tl.nestedPadding*this.getLevel()}px`,this.workspace_.RTL?t.style.paddingRight=o:t.style.paddingLeft=o,t}createRowContentsContainer_(){const t=document.createElement("div"),o=this.cssConfig_.rowcontentcontainer;return o&&Me(t,o),t}createIconDom_(){const t=document.createElement("span");if(!this.parentToolbox_.isHorizontal()){const o=this.cssConfig_.icon;o&&Me(t,o)}return t.style.display="inline-block",t}createLabelDom_(t){const o=document.createElement("span");return o.setAttribute("id",this.getId()+".label"),o.textContent=t,(t=this.cssConfig_.label)&&Me(o,t),o}refreshTheme(){this.colour_=this.getColour_(this.toolboxItemDef_),this.addColourBorder_(this.colour_)}addColourBorder_(t){t&&(t=Tl.borderWidth+"px solid "+(t||"#ddd"),this.workspace_.RTL?this.rowDiv_.style.borderRight=t:this.rowDiv_.style.borderLeft=t)}getColour_(t){const o=t.categorystyle||t.categoryStyle;if((t=t.colour)&&o)console.warn('Toolbox category "'+this.name_+'" must not have both a style and a colour');else{if(o)return this.getColourfromStyle_(o);if(t)return this.parseColour_(t)}return""}getColourfromStyle_(t){var o=this.workspace_.getTheme();if(t&&o){if((o=o.categoryStyles[t])&&o.colour)return this.parseColour_(o.colour);console.warn('Style "'+t+'" must exist and contain a colour value')}return""}getClickTarget(){return this.rowDiv_}parseColour_(t){if(t=yi(t),t==null||t==="")return"";var o=Number(t);return isNaN(o)?(o=To(t))?o:(console.warn('Toolbox category "'+this.name_+'" has unrecognized colour attribute: '+t),""):Kl(o)}openIcon_(t){if(t){var o=this.cssConfig_.closedicon;o&&St(t,o),(o=this.cssConfig_.openicon)&&Me(t,o)}}closeIcon_(t){if(t){var o=this.cssConfig_.openicon;o&&St(t,o),(o=this.cssConfig_.closedicon)&&Me(t,o)}}setVisible_(t){this.htmlDiv_.style.display=t?"block":"none",this.isHidden_=!t,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}hide(){this.setVisible_(!1)}show(){this.setVisible_(!0)}isVisible(){return!this.isHidden_&&this.allAncestorsExpanded_()}allAncestorsExpanded_(){let t=this;for(;t.getParent();)if(t=t.getParent(),!t.isExpanded())return!1;return!0}isSelectable(){return this.isVisible()&&!this.isDisabled_}onClick(t){}setSelected(t){if(this.rowDiv_){var o=this.cssConfig_.selected;if(t){const c=this.parseColour_(Tl.defaultBackgroundColour);this.rowDiv_.style.backgroundColor=this.colour_||c,o&&Me(this.rowDiv_,o)}else this.rowDiv_.style.backgroundColor="",o&&oe(this.rowDiv_,o);Ei(this.htmlDiv_,zr.SELECTED,t)}}setDisabled(t){this.isDisabled_=t,this.getDiv().setAttribute("disabled",`${t}`),t?this.getDiv().setAttribute("disabled","true"):this.getDiv().removeAttribute("disabled")}getName(){return this.name_}getParent(){return this.parent_}getDiv(){return this.htmlDiv_}getContents(){return this.flyoutItems_}updateFlyoutContents(t){this.flyoutItems_=[],this.toolboxItemDef_=typeof t=="string"?{kind:this.toolboxItemDef_.kind,custom:t,id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden}:{kind:this.toolboxItemDef_.kind,name:"name"in this.toolboxItemDef_?this.toolboxItemDef_.name:"",contents:Ci(t),id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden},this.parseContents_(this.toolboxItemDef_)}dispose(){W(this.htmlDiv_)}};Tl.registrationName="category",Tl.nestedPadding=19,Tl.borderWidth=8,Tl.defaultBackgroundColour="#57e",je(`
.blocklyTreeRow:not(.blocklyTreeSelected):hover {
  background-color: rgba(255, 255, 255, .2);
}

.blocklyToolboxDiv[layout="h"] .blocklyToolboxCategory {
  margin: 1px 5px 1px 0;
}

.blocklyToolboxDiv[dir="RTL"][layout="h"] .blocklyToolboxCategory {
  margin: 1px 0 1px 5px;
}

.blocklyTreeRow {
  height: 22px;
  line-height: 22px;
  margin-bottom: 3px;
  padding-right: 8px;
  white-space: nowrap;
}

.blocklyToolboxDiv[dir="RTL"] .blocklyTreeRow {
  margin-left: 8px;
  padding-right: 0;
}

.blocklyTreeIcon {
  background-image: url(<<<PATH>>>/sprites.png);
  height: 16px;
  vertical-align: middle;
  visibility: hidden;
  width: 16px;
}

.blocklyTreeIconClosed {
  background-position: -32px -1px;
}

.blocklyToolboxDiv[dir="RTL"] .blocklyTreeIconClosed {
  background-position: 0 -1px;
}

.blocklyTreeSelected>.blocklyTreeIconClosed {
  background-position: -32px -17px;
}

.blocklyToolboxDiv[dir="RTL"] .blocklyTreeSelected>.blocklyTreeIconClosed {
  background-position: 0 -17px;
}

.blocklyTreeIconOpen {
  background-position: -16px -1px;
}

.blocklyTreeSelected>.blocklyTreeIconOpen {
  background-position: -16px -17px;
}

.blocklyTreeLabel {
  cursor: default;
  font: 16px sans-serif;
  padding: 0 3px;
  vertical-align: middle;
}

.blocklyToolboxDelete .blocklyTreeLabel {
  cursor: url("<<<PATH>>>/handdelete.cur"), auto;
}

.blocklyTreeSelected .blocklyTreeLabel {
  color: #fff;
}
`),r(yt.TOOLBOX_ITEM,Tl.registrationName,Tl);var Av=class extends RA{constructor(t,o){super(t,o),this.cssConfig_={container:"blocklyTreeSeparator"},this.htmlDiv_=null,Object.assign(this.cssConfig_,t.cssconfig||t.cssConfig)}init(){this.createDom_()}createDom_(){const t=document.createElement("div"),o=this.cssConfig_.container;return o&&Me(t,o),this.htmlDiv_=t}getDiv(){return this.htmlDiv_}dispose(){W(this.htmlDiv_)}};Av.registrationName="sep",je(`
.blocklyTreeSeparator {
  border-bottom: solid #e5e5e5 1px;
  height: 0;
  margin: 5px 0;
}

.blocklyToolboxDiv[layout="h"] .blocklyTreeSeparator {
  border-right: solid #e5e5e5 1px;
  border-bottom: none;
  height: auto;
  margin: 0 5px 0 5px;
  padding: 5px 0;
  width: 0;
}
`),r(yt.TOOLBOX_ITEM,Av.registrationName,Av);var Om=class extends Tl{constructor(t,o,c){super(t,o,c),this.subcategoriesDiv_=null,this.expanded_=!1,this.toolboxItems_=[]}makeDefaultCssConfig_(){const t=super.makeDefaultCssConfig_();return t.contents="blocklyToolboxContents",t}parseContents_(t){if("custom"in t)this.flyoutItems_=t.custom;else{const o=t.contents;if(o){this.flyoutItems_=[],t=!0;for(let c=0;c<o.length;c++){const g=o[c];!u(yt.TOOLBOX_ITEM,g.kind)||g.kind.toLowerCase()===Av.registrationName&&t?(this.flyoutItems_.push(g),t=!0):(this.createToolboxItem_(g),t=!1)}}}}createToolboxItem_(t){let o=t.kind;o.toUpperCase()==="CATEGORY"&&nn(t)&&(o=Om.registrationName),t=new(d(yt.TOOLBOX_ITEM,o))(t,this.parentToolbox_,this),this.toolboxItems_.push(t)}init(){super.init(),this.setExpanded(this.toolboxItemDef_.expanded==="true"||this.toolboxItemDef_.expanded===!0)}createDom_(){super.createDom_();const t=this.getChildToolboxItems();return this.subcategoriesDiv_=this.createSubCategoriesDom_(t),sn(this.subcategoriesDiv_,pl.GROUP),this.htmlDiv_.appendChild(this.subcategoriesDiv_),this.closeIcon_(this.iconDom_),Ei(this.htmlDiv_,zr.EXPANDED,!1),this.htmlDiv_}createIconDom_(){const t=document.createElement("span");if(!this.parentToolbox_.isHorizontal()){const o=this.cssConfig_.icon;o&&Me(t,o),t.style.visibility="visible"}return t.style.display="inline-block",t}createSubCategoriesDom_(t){const o=document.createElement("div");o.style.display="none";var c=this.cssConfig_.contents;for(c&&Me(o,c),c=0;c<t.length;c++){const g=t[c];g.init();const $=g.getDiv();if(o.appendChild($),g.getClickTarget){let M;(M=g.getClickTarget())==null||M.setAttribute("id",g.getId())}}return o}setExpanded(t){if(this.expanded_!==t){if(this.expanded_=t)this.subcategoriesDiv_.style.display="block",this.openIcon_(this.iconDom_);else{let o;(o=this.parentToolbox_.getFlyout())==null||o.setVisible(!1),this.subcategoriesDiv_.style.display="none",this.closeIcon_(this.iconDom_)}Ei(this.htmlDiv_,zr.EXPANDED,t),this.parentToolbox_.handleToolboxItemResize()}}setVisible_(t){this.htmlDiv_.style.display=t?"block":"none";const o=this.getChildToolboxItems();for(let c=0;c<o.length;c++)o[c].setVisible_(t);this.isHidden_=!t,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}isExpanded(){return this.expanded_}isCollapsible(){return!0}onClick(t){this.toggleExpanded()}toggleExpanded(){this.setExpanded(!this.expanded_)}getDiv(){return this.htmlDiv_}getChildToolboxItems(){return this.toolboxItems_}};Om.registrationName="collapsibleCategory",r(yt.TOOLBOX_ITEM,Om.registrationName,Om);var oO=class extends yy{constructor(t){super(),this.id="toolbox",this.contentsDiv_=this.HtmlDiv=null,this.isVisible_=!1,this.contents_=[],this.height_=this.width_=0,this.previouslySelectedItem_=this.selectedItem_=this.flyout_=null,this.boundEvents_=[],this.workspace_=t,this.toolboxDef_=t.options.languageTree||{contents:[]},this.horizontalLayout_=t.options.horizontalLayout,this.RTL=t.options.RTL,this.contentMap_=Object.create(null),this.toolboxPosition=t.options.toolboxPosition}onShortcut(t){return!1}init(){var t=this.workspace_;const o=t.getParentSvg();this.flyout_=this.createFlyout_(),this.HtmlDiv=this.createDom_(this.workspace_),ot(this.flyout_.createDom("svg"),o),this.setVisible(!0),this.flyout_.init(t),this.render(this.toolboxDef_),t=t.getThemeManager(),t.subscribe(this.HtmlDiv,"toolboxBackgroundColour","background-color"),t.subscribe(this.HtmlDiv,"toolboxForegroundColour","color"),this.workspace_.getComponentManager().addComponent({component:this,weight:1,capabilities:[Vr.Capability.AUTOHIDEABLE,Vr.Capability.DELETE_AREA,Vr.Capability.DRAG_TARGET]})}createDom_(t){t=t.getParentSvg();const o=this.createContainer_();return this.contentsDiv_=this.createContentsContainer_(),this.contentsDiv_.tabIndex=0,sn(this.contentsDiv_,pl.TREE),o.appendChild(this.contentsDiv_),t.parentNode.insertBefore(o,t),this.attachEvents_(o,this.contentsDiv_),o}createContainer_(){const t=document.createElement("div");return t.setAttribute("layout",this.isHorizontal()?"h":"v"),Me(t,"blocklyToolboxDiv"),Me(t,"blocklyNonSelectable"),t.setAttribute("dir",this.RTL?"RTL":"LTR"),t}createContentsContainer_(){const t=document.createElement("div");return Me(t,"blocklyToolboxContents"),this.isHorizontal()&&(t.style.flexDirection="row"),t}attachEvents_(t,o){t=Ue(t,"pointerdown",this,this.onClick_,!1),this.boundEvents_.push(t),o=Ue(o,"keydown",this,this.onKeyDown_,!1),this.boundEvents_.push(o)}onClick_(t){if(Fe(t)||t.target===this.HtmlDiv)ne().hideChaff(!1);else{var o=t.target.getAttribute("id");o&&(o=this.getToolboxItemById(o),o.isSelectable()&&(this.setSelectedItem(o),o.onClick(t))),ne().hideChaff(!0)}_e()}onKeyDown_(t){let o=!1;switch(t.key){case"ArrowDown":o=this.selectNext_();break;case"ArrowUp":o=this.selectPrevious_();break;case"ArrowLeft":o=this.selectParent_();break;case"ArrowRight":o=this.selectChild_();break;case"Enter":case" ":this.selectedItem_&&this.selectedItem_.isCollapsible()&&(this.selectedItem_.toggleExpanded(),o=!0);break;default:o=!1}!o&&this.selectedItem_&&this.selectedItem_.onKeyDown&&(o=this.selectedItem_.onKeyDown(t)),o&&t.preventDefault()}createFlyout_(){const t=this.workspace_,o=new Ma({parentWorkspace:t,rtl:t.RTL,oneBasedIndex:t.options.oneBasedIndex,horizontalLayout:t.horizontalLayout,renderer:t.options.renderer,rendererOverrides:t.options.rendererOverrides,move:{scrollbars:!0}});return o.toolboxPosition=t.options.toolboxPosition,new(t.horizontalLayout?p(yt.FLYOUTS_HORIZONTAL_TOOLBOX,t.options,!0):p(yt.FLYOUTS_VERTICAL_TOOLBOX,t.options,!0))(o)}render(t){this.toolboxDef_=t;for(let o=0;o<this.contents_.length;o++){const c=this.contents_[o];c&&c.dispose()}this.contents_=[],this.contentMap_=Object.create(null),this.renderContents_(t.contents),this.position(),this.handleToolboxItemResize()}renderContents_(t){const o=document.createDocumentFragment();for(let c=0;c<t.length;c++)this.createToolboxItem_(t[c],o);this.contentsDiv_.appendChild(o)}createToolboxItem_(t,o){var c=t.kind;c.toUpperCase()==="CATEGORY"&&nn(t)&&(c=Om.registrationName),(c=d(yt.TOOLBOX_ITEM,c.toLowerCase()))&&(t=new c(t,this),t.init(),this.addToolboxItem_(t),(c=t.getDiv())&&o.appendChild(c),t.getClickTarget()&&t.getClickTarget().setAttribute("id",t.getId()))}addToolboxItem_(t){if(this.contents_.push(t),this.contentMap_[t.getId()]=t,t.isCollapsible()){t=t.getChildToolboxItems();for(let o=0;o<t.length;o++)this.addToolboxItem_(t[o])}}getToolboxItems(){return this.contents_}addStyle(t){t&&this.HtmlDiv&&Me(this.HtmlDiv,t)}removeStyle(t){t&&this.HtmlDiv&&oe(this.HtmlDiv,t)}getClientRect(){if(!this.HtmlDiv||!this.isVisible_)return null;var t=this.HtmlDiv.getBoundingClientRect();const o=t.top,c=o+t.height,g=t.left;return t=g+t.width,this.toolboxPosition===Cn.TOP?new $i(-1e7,c,-1e7,1e7):this.toolboxPosition===Cn.BOTTOM?new $i(o,1e7,-1e7,1e7):this.toolboxPosition===Cn.LEFT?new $i(-1e7,1e7,-1e7,t):new $i(-1e7,1e7,g,1e7)}wouldDelete(t){return t instanceof Na?this.updateWouldDelete_(!t.getParent()&&t.isDeletable()):this.updateWouldDelete_(eo(t)&&t.isDeletable()),this.wouldDelete_}onDragEnter(t){this.updateCursorDeleteStyle_(!0)}onDragExit(t){this.updateCursorDeleteStyle_(!1)}onDrop(t){this.updateCursorDeleteStyle_(!1)}updateWouldDelete_(t){t!==this.wouldDelete_&&(this.updateCursorDeleteStyle_(!1),this.wouldDelete_=t,this.updateCursorDeleteStyle_(!0))}updateCursorDeleteStyle_(t){const o=this.wouldDelete_?"blocklyToolboxDelete":"blocklyToolboxGrab";t?this.addStyle(o):this.removeStyle(o)}getToolboxItemById(t){return this.contentMap_[t]||null}getWidth(){return this.width_}getHeight(){return this.height_}getFlyout(){return this.flyout_}getWorkspace(){return this.workspace_}getSelectedItem(){return this.selectedItem_}getPreviouslySelectedItem(){return this.previouslySelectedItem_}isHorizontal(){return this.horizontalLayout_}position(){const t=this.workspace_.getMetrics(),o=this.HtmlDiv;o&&(this.horizontalLayout_?(o.style.left="0",o.style.height="auto",o.style.width="100%",this.height_=o.offsetHeight,this.width_=t.viewWidth,this.toolboxPosition===Cn.TOP?o.style.top="0":o.style.bottom="0"):(this.toolboxPosition===Cn.RIGHT?o.style.right="0":o.style.left="0",o.style.height="100%",this.width_=o.offsetWidth,this.height_=t.viewHeight),this.flyout_.position())}handleToolboxItemResize(){const t=this.workspace_,o=this.HtmlDiv.getBoundingClientRect();t.translate(this.toolboxPosition===Cn.LEFT?t.scrollX+o.width:t.scrollX,this.toolboxPosition===Cn.TOP?t.scrollY+o.height:t.scrollY),J(t)}clearSelection(){this.setSelectedItem(null)}refreshTheme(){for(let t=0;t<this.contents_.length;t++){const o=this.contents_[t];o.refreshTheme&&o.refreshTheme()}}refreshSelection(){this.selectedItem_&&this.selectedItem_.isSelectable()&&this.selectedItem_.getContents().length&&this.flyout_.show(this.selectedItem_.getContents())}setVisible(t){this.isVisible_!==t&&(this.HtmlDiv.style.display=t?"block":"none",this.isVisible_=t,this.workspace_.recordDragTargets())}autoHide(t){!t&&this.flyout_&&this.flyout_.autoClose&&this.clearSelection()}setSelectedItem(t){const o=this.selectedItem_;!t&&!o||t&&!X_(t)||(this.shouldDeselectItem_(o,t)&&o!==null&&this.deselectItem_(o),this.shouldSelectItem_(o,t)&&t!==null&&this.selectItem_(o,t),this.updateFlyout_(o,t),this.fireSelectEvent_(o,t))}shouldDeselectItem_(t,o){return t!==null&&(!t.isCollapsible()||t!==o)}shouldSelectItem_(t,o){return o!==null&&o!==t}deselectItem_(t){this.selectedItem_=null,this.previouslySelectedItem_=t,t.setSelected(!1),Ei(this.contentsDiv_,zr.ACTIVEDESCENDANT,"")}selectItem_(t,o){this.selectedItem_=o,this.previouslySelectedItem_=t,o.setSelected(!0),Ei(this.contentsDiv_,zr.ACTIVEDESCENDANT,o.getId())}selectItemByPosition(t){-1<t&&t<this.contents_.length&&(t=this.contents_[t],t.isSelectable()&&this.setSelectedItem(t))}updateFlyout_(t,o){o&&(t!==o||o.isCollapsible())&&o.getContents().length?(this.flyout_.show(o.getContents()),this.flyout_.scrollToStart()):this.flyout_.hide()}fireSelectEvent_(t,o){const c=t&&t.getName();let g=o&&o.getName();t===o&&(g=null),t=new(k(hl))(c,g,this.workspace_.id),b(t)}selectParent_(){return this.selectedItem_?this.selectedItem_.isCollapsible()&&this.selectedItem_.isExpanded()?(this.selectedItem_.toggleExpanded(),!0):this.selectedItem_.getParent()&&this.selectedItem_.getParent().isSelectable()?(this.setSelectedItem(this.selectedItem_.getParent()),!0):!1:!1}selectChild_(){if(!this.selectedItem_||!this.selectedItem_.isCollapsible())return!1;const t=this.selectedItem_;return t.isExpanded()?this.selectNext_():t.toggleExpanded(),!0}selectNext_(){if(!this.selectedItem_)return!1;let t=this.contents_.indexOf(this.selectedItem_)+1;if(-1<t&&t<this.contents_.length){let o=this.contents_[t];for(;o&&!o.isSelectable();)o=this.contents_[++t];if(o&&o.isSelectable())return this.setSelectedItem(o),!0}return!1}selectPrevious_(){if(!this.selectedItem_)return!1;let t=this.contents_.indexOf(this.selectedItem_)-1;if(-1<t&&t<this.contents_.length){let o=this.contents_[t];for(;o&&!o.isSelectable();)o=this.contents_[--t];if(o&&o.isSelectable())return this.setSelectedItem(o),!0}return!1}dispose(){this.workspace_.getComponentManager().removeComponent("toolbox"),this.flyout_.dispose();for(var t=0;t<this.contents_.length;t++)this.contents_[t].dispose();for(t=0;t<this.boundEvents_.length;t++)re(this.boundEvents_[t]);this.boundEvents_=[],this.contents_=[],this.HtmlDiv&&(this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv),W(this.HtmlDiv))}};je(`
.blocklyToolboxDelete {
  cursor: url("<<<PATH>>>/handdelete.cur"), auto;
}

.blocklyToolboxGrab {
  cursor: url("<<<PATH>>>/handclosed.cur"), auto;
  cursor: grabbing;
  cursor: -webkit-grabbing;
}

/* Category tree in Toolbox. */
.blocklyToolboxDiv {
  background-color: #ddd;
  overflow-x: visible;
  overflow-y: auto;
  padding: 4px 0 4px 0;
  position: absolute;
  z-index: 70;  /* so blocks go under toolbox when dragging */
  -webkit-tap-highlight-color: transparent;  /* issue #1345 */
}

.blocklyToolboxContents {
  display: flex;
  flex-wrap: wrap;
  flex-direction: column;
}

.blocklyToolboxContents:focus {
  outline: none;
}
`),r(yt.TOOLBOX,yo,oO);var PG="11.1.1",DG=Bt.INPUT_VALUE,BG=Bt.OUTPUT_VALUE,FG=Bt.NEXT_STATEMENT,UG=Bt.PREVIOUS_STATEMENT,GG=Cn.TOP,HG=Cn.BOTTOM,VG=Cn.LEFT,zG=Cn.RIGHT;xm.prototype.newBlock=function(t,o){return new vf(this,t,o)},La.prototype.newBlock=function(t,o){return new Na(this,t,o)},xm.prototype.newComment=function(t){return new JE(this,t)},La.prototype.newComment=function(t){return new ay(this,t)},La.newTrashcan=function(t){return new x1(t)},iu.prototype.newWorkspaceSvg=function(t){return new La(t)},n.Names$$module$build$src$core$names.prototype.populateProcedures=function(t){t=Pd(t),t=t[0].concat(t[1]);for(let o=0;o<t.length;o++)this.getName(t[o][0],n.Names$$module$build$src$core$names.NameType.PROCEDURE)};var st={};return st.ASTNode=_t,st.BasicCursor=Tv,st.Block=vf,st.BlockSvg=Na,st.Blocks=ks,st.COLLAPSED_FIELD_NAME=jE,st.COLLAPSED_INPUT_NAME=tv,st.COLLAPSE_CHARS=E1,st.CodeGenerator=n.CodeGenerator$$module$build$src$core$generator,st.CollapsibleToolboxCategory=Om,st.ComponentManager=Vr,st.Connection=Jn,st.ConnectionChecker=y1,st.ConnectionDB=$m,st.ConnectionType=Bt,st.ContextMenu=mf,st.ContextMenuItems=Wr,st.ContextMenuRegistry=wn,st.Css=rb,st.Cursor=rA,st.DELETE_VARIABLE_ID=qb,st.DeleteArea=yy,st.DragTarget=C1,st.DropDownDiv=Ps,st.Events=Ut,st.Extensions=_l,st.Field=bi,st.FieldCheckbox=Sf,st.FieldDropdown=uc,st.FieldImage=yf,st.FieldLabel=_f,st.FieldLabelSerializable=X1,st.FieldNumber=mA,st.FieldTextInput=Cy,st.FieldVariable=Sv,st.Flyout=Ry,st.FlyoutButton=Ia,st.FlyoutMetricsManager=z1,st.Generator=n.CodeGenerator$$module$build$src$core$generator,st.Gesture=nu,st.Grid=Pb,st.HorizontalFlyout=W1,st.INPUT_VALUE=DG,st.Input=Cm,st.InsertionMarkerManager=Oa,st.InsertionMarkerPreviewer=G1,st.Marker=$1,st.MarkerManager=lv,st.Menu=Tb,st.MenuItem=Eb,st.MetricsManager=dA,st.Msg=n.Msg$$module$build$src$core$msg,st.NEXT_STATEMENT=FG,st.Names=n.Names$$module$build$src$core$names,st.OPPOSITE_TYPE=Ef,st.OUTPUT_VALUE=BG,st.Options=Ma,st.PREVIOUS_STATEMENT=UG,st.PROCEDURE_CATEGORY_NAME=py,st.Procedures=io,st.RENAME_VARIABLE_ID=Zb,st.RenderedConnection=ro,st.Scrollbar=ur,st.ScrollbarPair=hA,st.ShortcutItems=pc,st.ShortcutRegistry=si,st.TOOLBOX_AT_BOTTOM=HG,st.TOOLBOX_AT_LEFT=VG,st.TOOLBOX_AT_RIGHT=zG,st.TOOLBOX_AT_TOP=GG,st.TabNavigateCursor=b1,st.Theme=gf,st.ThemeManager=T1,st.Themes=kG,st.Toolbox=oO,st.ToolboxCategory=Tl,st.ToolboxItem=RA,st.ToolboxSeparator=Av,st.Tooltip=qo,st.Touch=Qe,st.Trashcan=x1,st.UnattachedFieldError=hr,st.VARIABLE_CATEGORY_NAME=ub,st.VARIABLE_DYNAMIC_CATEGORY_NAME=Jb,st.VERSION=PG,st.VariableMap=tA,st.VariableModel=iv,st.Variables=gs,st.VariablesDynamic=Tf,st.VerticalFlyout=pA,st.WidgetDiv=gl,st.Workspace=xm,st.WorkspaceAudio=S1,st.WorkspaceDragger=t1,st.WorkspaceSvg=La,st.Xml=Ds,st.ZoomControls=xI,st.blockAnimations=fv,st.blockRendering=ui,st.browserEvents=qc,st.bubbles=bv,st.bumpObjects=Ey,st.clipboard=yv,st.comments=wy,st.common=Pe,st.config=n.config$$module$build$src$core$config,st.constants=rG,st.defineBlocksWithJsonArray=Y,st.dialog=lf,st.dragging=$v,st.fieldRegistry=hy,st.geras=mc,st.getMainWorkspace=ne,st.getSelected=de,st.hasBubble=Ee,st.hideChaff=j_,st.icons=bh,st.inject=qi,st.inputs=Rh,st.isCopyable=nc,st.isDeletable=eo,st.isDraggable=el,st.isIcon=sl,st.isObservable=Nd,st.isPaster=lm,st.isRenderedElement=HE,st.isSelectable=ll,st.isSerializable=cs,st.isVariableBackedParameterModel=It,st.procedures=io,st.registry=cl,st.renderManagement=KE,st.serialization=MG,st.setLocale=lb,st.setParentContainer=H,st.svgResize=J,st.thrasos=xA,st.uiPosition=af,st.utils=Xi,st.zelos=vl,st.__namespace__=n,st})}(ox)),ox.exports}(function(i,e){(function(n,r){i.exports=r(lI())})(qf,function(n){var r=n.__namespace__,s=function(N,j){return["[]",W.ATOMIC]},a=function(N,j){const ge=Array(N.itemCount_);for(let we=0;we<N.itemCount_;we++)ge[we]=j.valueToCode(N,"ADD"+we,W.NONE)||"null";return["["+ge.join(", ")+"]",W.ATOMIC]},l=function(N,j){const ge=j.provideFunction_("listsRepeat",`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(value, n) {
  var array = [];
  for (var i = 0; i < n; i++) {
    array[i] = value;
  }
  return array;
}
`),we=j.valueToCode(N,"ITEM",W.NONE)||"null";return N=j.valueToCode(N,"NUM",W.NONE)||"0",[ge+"("+we+", "+N+")",W.FUNCTION_CALL]},u=function(N,j){return[(j.valueToCode(N,"VALUE",W.MEMBER)||"[]")+".length",W.MEMBER]},d=function(N,j){return["!"+(j.valueToCode(N,"VALUE",W.MEMBER)||"[]")+".length",W.LOGICAL_NOT]},h=function(N,j){const ge=N.getFieldValue("END")==="FIRST"?"indexOf":"lastIndexOf",we=j.valueToCode(N,"FIND",W.NONE)||"''";return j=(j.valueToCode(N,"VALUE",W.MEMBER)||"[]")+"."+ge+"("+we+")",N.workspace.options.oneBasedIndex?[j+" + 1",W.ADDITION]:[j,W.FUNCTION_CALL]},f=function(N,j){const ge=N.getFieldValue("MODE")||"GET",we=N.getFieldValue("WHERE")||"FROM_START";var We=j.valueToCode(N,"VALUE",we==="RANDOM"?W.NONE:W.MEMBER)||"[]";switch(we){case"FIRST":if(ge==="GET")return[We+"[0]",W.MEMBER];if(ge==="GET_REMOVE")return[We+".shift()",W.MEMBER];if(ge==="REMOVE")return We+`.shift();
`;break;case"LAST":if(ge==="GET")return[We+".slice(-1)[0]",W.MEMBER];if(ge==="GET_REMOVE")return[We+".pop()",W.MEMBER];if(ge==="REMOVE")return We+`.pop();
`;break;case"FROM_START":if(N=j.getAdjusted(N,"AT"),ge==="GET")return[We+"["+N+"]",W.MEMBER];if(ge==="GET_REMOVE")return[We+".splice("+N+", 1)[0]",W.FUNCTION_CALL];if(ge==="REMOVE")return We+".splice("+N+`, 1);
`;break;case"FROM_END":if(N=j.getAdjusted(N,"AT",1,!0),ge==="GET")return[We+".slice("+N+")[0]",W.FUNCTION_CALL];if(ge==="GET_REMOVE")return[We+".splice("+N+", 1)[0]",W.FUNCTION_CALL];if(ge==="REMOVE")return We+".splice("+N+", 1);";break;case"RANDOM":if(We=j.provideFunction_("listsGetRandomItem",`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(list, remove) {
  var x = Math.floor(Math.random() * list.length);
  if (remove) {
    return list.splice(x, 1)[0];
  } else {
    return list[x];
  }
}
`)+"("+We+", "+(ge!=="GET")+")",ge==="GET"||ge==="GET_REMOVE")return[We,W.FUNCTION_CALL];if(ge==="REMOVE")return We+`;
`}throw Error("Unhandled combination (lists_getIndex).")},p=function(N,j){function ge(){if(we.match(/^\w+$/))return"";const un=j.nameDB_.getDistinctName("tmpList",r.NameType$$module$build$src$core$names.VARIABLE),an="var "+un+" = "+we+`;
`;return we=un,an}let we=j.valueToCode(N,"LIST",W.MEMBER)||"[]";const We=N.getFieldValue("MODE")||"GET";var gt=N.getFieldValue("WHERE")||"FROM_START";const bt=j.valueToCode(N,"TO",W.ASSIGNMENT)||"null";switch(gt){case"FIRST":if(We==="SET")return we+"[0] = "+bt+`;
`;if(We==="INSERT")return we+".unshift("+bt+`);
`;break;case"LAST":if(We==="SET")return ge()+(we+"["+we+".length - 1] = "+bt+`;
`);if(We==="INSERT")return we+".push("+bt+`);
`;break;case"FROM_START":if(N=j.getAdjusted(N,"AT"),We==="SET")return we+"["+N+"] = "+bt+`;
`;if(We==="INSERT")return we+".splice("+N+", 0, "+bt+`);
`;break;case"FROM_END":if(N=j.getAdjusted(N,"AT",1,!1,W.SUBTRACTION),gt=ge(),We==="SET")return gt+(we+"["+we+".length - "+N+"] = "+bt+`;
`);if(We==="INSERT")return gt+(we+".splice("+we+".length - "+N+", 0, "+bt+`);
`);break;case"RANDOM":if(N=ge(),gt=j.nameDB_.getDistinctName("tmpX",r.NameType$$module$build$src$core$names.VARIABLE),N+="var "+gt+" = Math.floor(Math.random() * "+we+`.length);
`,We==="SET")return N+(we+"["+gt+"] = "+bt+`;
`);if(We==="INSERT")return N+(we+".splice("+gt+", 0, "+bt+`);
`)}throw Error("Unhandled combination (lists_setIndex).")},m=function(N,j){var ge={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"},we=j.valueToCode(N,"LIST",W.MEMBER)||"[]";const We=N.getFieldValue("WHERE1"),gt=N.getFieldValue("WHERE2");if(We==="FIRST"&&gt==="LAST")we+=".slice(0)";else if(we.match(/^\w+$/)||We!=="FROM_END"&&gt==="FROM_START"){switch(We){case"FROM_START":ge=j.getAdjusted(N,"AT1");break;case"FROM_END":ge=j.getAdjusted(N,"AT1",1,!1,W.SUBTRACTION),ge=we+".length - "+ge;break;case"FIRST":ge="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(gt){case"FROM_START":j=j.getAdjusted(N,"AT2",1);break;case"FROM_END":j=j.getAdjusted(N,"AT2",0,!1,W.SUBTRACTION),j=we+".length - "+j;break;case"LAST":j=we+".length";break;default:throw Error("Unhandled option (lists_getSublist).")}we=we+".slice("+ge+", "+j+")"}else{const bt=j.getAdjusted(N,"AT1");N=j.getAdjusted(N,"AT2"),we=j.provideFunction_("subsequence"+ge[We]+ge[gt],`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(sequence${We==="FROM_END"||We==="FROM_START"?", at1":""}${gt==="FROM_END"||gt==="FROM_START"?", at2":""}) {
  var start = ${ze("sequence",We,"at1")};
  var end = ${ze("sequence",gt,"at2")} + 1;
  return sequence.slice(start, end);
}
`)+"("+we+(We==="FROM_END"||We==="FROM_START"?", "+bt:"")+(gt==="FROM_END"||gt==="FROM_START"?", "+N:"")+")"}return[we,W.FUNCTION_CALL]},T=function(N,j){const ge=j.valueToCode(N,"LIST",W.FUNCTION_CALL)||"[]",we=N.getFieldValue("DIRECTION")==="1"?1:-1;return N=N.getFieldValue("TYPE"),j=j.provideFunction_("listsGetSortCompare",`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(type, direction) {
  var compareFuncs = {
    'NUMERIC': function(a, b) {
        return Number(a) - Number(b); },
    'TEXT': function(a, b) {
        return String(a) > String(b) ? 1 : -1; },
    'IGNORE_CASE': function(a, b) {
        return String(a).toLowerCase() > String(b).toLowerCase() ? 1 : -1; },
  };
  var compare = compareFuncs[type];
  return function(a, b) { return compare(a, b) * direction; };
}
      `),[ge+".slice().sort("+j+'("'+N+'", '+we+"))",W.FUNCTION_CALL]},E=function(N,j){let ge=j.valueToCode(N,"INPUT",W.MEMBER);if(j=j.valueToCode(N,"DELIM",W.NONE)||"''",N=N.getFieldValue("MODE"),N==="SPLIT")ge||(ge="''"),N="split";else if(N==="JOIN")ge||(ge="[]"),N="join";else throw Error("Unknown mode: "+N);return[ge+"."+N+"("+j+")",W.FUNCTION_CALL]},b=function(N,j){return[(j.valueToCode(N,"LIST",W.FUNCTION_CALL)||"[]")+".slice().reverse()",W.FUNCTION_CALL]},y=function(N,j){var ge=0;let we="";j.STATEMENT_PREFIX&&(we+=j.injectId(j.STATEMENT_PREFIX,N));do{const We=j.valueToCode(N,"IF"+ge,W.NONE)||"false";let gt=j.statementToCode(N,"DO"+ge);j.STATEMENT_SUFFIX&&(gt=j.prefixLines(j.injectId(j.STATEMENT_SUFFIX,N),j.INDENT)+gt),we+=(0<ge?" else ":"")+"if ("+We+`) {
`+gt+"}",ge++}while(N.getInput("IF"+ge));return(N.getInput("ELSE")||j.STATEMENT_SUFFIX)&&(ge=j.statementToCode(N,"ELSE"),j.STATEMENT_SUFFIX&&(ge=j.prefixLines(j.injectId(j.STATEMENT_SUFFIX,N),j.INDENT)+ge),we+=` else {
`+ge+"}"),we+`
`},S=function(N,j){const ge={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[N.getFieldValue("OP")],we=ge==="=="||ge==="!="?W.EQUALITY:W.RELATIONAL,We=j.valueToCode(N,"A",we)||"0";return N=j.valueToCode(N,"B",we)||"0",[We+" "+ge+" "+N,we]},A=function(N,j){const ge=N.getFieldValue("OP")==="AND"?"&&":"||",we=ge==="&&"?W.LOGICAL_AND:W.LOGICAL_OR;let We=j.valueToCode(N,"A",we);return N=j.valueToCode(N,"B",we),We||N?(j=ge==="&&"?"true":"false",We||(We=j),N||(N=j)):N=We="false",[We+" "+ge+" "+N,we]},C=function(N,j){const ge=W.LOGICAL_NOT;return["!"+(j.valueToCode(N,"BOOL",ge)||"true"),ge]},R=function(N,j){return[N.getFieldValue("BOOL")==="TRUE"?"true":"false",W.ATOMIC]},I=function(N,j){return["null",W.ATOMIC]},O=function(N,j){const ge=j.valueToCode(N,"IF",W.CONDITIONAL)||"false",we=j.valueToCode(N,"THEN",W.CONDITIONAL)||"null";return N=j.valueToCode(N,"ELSE",W.CONDITIONAL)||"null",[ge+" ? "+we+" : "+N,W.CONDITIONAL]},F=function(N,j){let ge;ge=N.getField("TIMES")?String(Number(N.getFieldValue("TIMES"))):j.valueToCode(N,"TIMES",W.ASSIGNMENT)||"0";let we=j.statementToCode(N,"DO");we=j.addLoopTrap(we,N),N="";const We=j.nameDB_.getDistinctName("count",r.NameType$$module$build$src$core$names.VARIABLE);let gt=ge;return ge.match(/^\w+$/)||r.isNumber$$module$build$src$core$utils$string(ge)||(gt=j.nameDB_.getDistinctName("repeat_end",r.NameType$$module$build$src$core$names.VARIABLE),N+="var "+gt+" = "+ge+`;
`),N+("for (var "+We+" = 0; "+We+" < "+gt+"; "+We+`++) {
`+we+`}
`)},k=function(N,j){const ge=N.getFieldValue("MODE")==="UNTIL";let we=j.valueToCode(N,"BOOL",ge?W.LOGICAL_NOT:W.NONE)||"false",We=j.statementToCode(N,"DO");return We=j.addLoopTrap(We,N),ge&&(we="!"+we),"while ("+we+`) {
`+We+`}
`},D=function(N,j){var ge=j.getVariableName(N.getFieldValue("VAR")),we=j.valueToCode(N,"FROM",W.ASSIGNMENT)||"0",We=j.valueToCode(N,"TO",W.ASSIGNMENT)||"0";const gt=j.valueToCode(N,"BY",W.ASSIGNMENT)||"1";let bt=j.statementToCode(N,"DO");if(bt=j.addLoopTrap(bt,N),r.isNumber$$module$build$src$core$utils$string(we)&&r.isNumber$$module$build$src$core$utils$string(We)&&r.isNumber$$module$build$src$core$utils$string(gt))j=Number(we)<=Number(We),N="for ("+ge+" = "+we+"; "+ge+(j?" <= ":" >= ")+We+"; "+ge,ge=Math.abs(Number(gt)),N=ge===1?N+(j?"++":"--"):N+((j?" += ":" -= ")+ge),N+=`) {
`+bt+`}
`;else{N="";let un=we;we.match(/^\w+$/)||r.isNumber$$module$build$src$core$utils$string(we)||(un=j.nameDB_.getDistinctName(ge+"_start",r.NameType$$module$build$src$core$names.VARIABLE),N+="var "+un+" = "+we+`;
`),we=We,We.match(/^\w+$/)||r.isNumber$$module$build$src$core$utils$string(We)||(we=j.nameDB_.getDistinctName(ge+"_end",r.NameType$$module$build$src$core$names.VARIABLE),N+="var "+we+" = "+We+`;
`),We=j.nameDB_.getDistinctName(ge+"_inc",r.NameType$$module$build$src$core$names.VARIABLE),N+="var "+We+" = ",N=r.isNumber$$module$build$src$core$utils$string(gt)?N+(Math.abs(Number(gt))+`;
`):N+("Math.abs("+gt+`);
`),N+="if ("+un+" > "+we+`) {
`,N+=j.INDENT+We+" = -"+We+`;
`,N=N+`}
for (`+(ge+" = "+un+"; "+We+" >= 0 ? "+ge+" <= "+we+" : "+ge+" >= "+we+"; "+ge+" += "+We+`) {
`+bt+`}
`)}return N},U=function(N,j){const ge=j.getVariableName(N.getFieldValue("VAR"));var we=j.valueToCode(N,"LIST",W.ASSIGNMENT)||"[]";let We=j.statementToCode(N,"DO");We=j.addLoopTrap(We,N),N="";let gt=we;return we.match(/^\w+$/)||(gt=j.nameDB_.getDistinctName(ge+"_list",r.NameType$$module$build$src$core$names.VARIABLE),N+="var "+gt+" = "+we+`;
`),we=j.nameDB_.getDistinctName(ge+"_index",r.NameType$$module$build$src$core$names.VARIABLE),We=j.INDENT+ge+" = "+gt+"["+we+`];
`+We,N+("for (var "+we+" in "+gt+`) {
`+We+`}
`)},ce=function(N,j){let ge="";if(j.STATEMENT_PREFIX&&(ge+=j.injectId(j.STATEMENT_PREFIX,N)),j.STATEMENT_SUFFIX&&(ge+=j.injectId(j.STATEMENT_SUFFIX,N)),j.STATEMENT_PREFIX){const we=N.getSurroundLoop();we&&!we.suppressPrefixSuffix&&(ge+=j.injectId(j.STATEMENT_PREFIX,we))}switch(N.getFieldValue("FLOW")){case"BREAK":return ge+`break;
`;case"CONTINUE":return ge+`continue;
`}throw Error("Unknown flow statement.")},ie=function(N,j){return N=Number(N.getFieldValue("NUM")),[String(N),0<=N?W.ATOMIC:W.UNARY_NEGATION]},ae=function(N,j){var ge={ADD:[" + ",W.ADDITION],MINUS:[" - ",W.SUBTRACTION],MULTIPLY:[" * ",W.MULTIPLICATION],DIVIDE:[" / ",W.DIVISION],POWER:[null,W.NONE]}[N.getFieldValue("OP")];const we=ge[0];ge=ge[1];const We=j.valueToCode(N,"A",ge)||"0";return N=j.valueToCode(N,"B",ge)||"0",we?[We+we+N,ge]:["Math.pow("+We+", "+N+")",W.FUNCTION_CALL]},ne=function(N,j){const ge=N.getFieldValue("OP");let we;if(ge==="NEG")return N=j.valueToCode(N,"NUM",W.UNARY_NEGATION)||"0",N[0]==="-"&&(N=" "+N),["-"+N,W.UNARY_NEGATION];switch(N=ge==="SIN"||ge==="COS"||ge==="TAN"?j.valueToCode(N,"NUM",W.DIVISION)||"0":j.valueToCode(N,"NUM",W.NONE)||"0",ge){case"ABS":we="Math.abs("+N+")";break;case"ROOT":we="Math.sqrt("+N+")";break;case"LN":we="Math.log("+N+")";break;case"EXP":we="Math.exp("+N+")";break;case"POW10":we="Math.pow(10,"+N+")";break;case"ROUND":we="Math.round("+N+")";break;case"ROUNDUP":we="Math.ceil("+N+")";break;case"ROUNDDOWN":we="Math.floor("+N+")";break;case"SIN":we="Math.sin("+N+" / 180 * Math.PI)";break;case"COS":we="Math.cos("+N+" / 180 * Math.PI)";break;case"TAN":we="Math.tan("+N+" / 180 * Math.PI)"}if(we)return[we,W.FUNCTION_CALL];switch(ge){case"LOG10":we="Math.log("+N+") / Math.log(10)";break;case"ASIN":we="Math.asin("+N+") / Math.PI * 180";break;case"ACOS":we="Math.acos("+N+") / Math.PI * 180";break;case"ATAN":we="Math.atan("+N+") / Math.PI * 180";break;default:throw Error("Unknown math operator: "+ge)}return[we,W.DIVISION]},pe=function(N,j){return{PI:["Math.PI",W.MEMBER],E:["Math.E",W.MEMBER],GOLDEN_RATIO:["(1 + Math.sqrt(5)) / 2",W.DIVISION],SQRT2:["Math.SQRT2",W.MEMBER],SQRT1_2:["Math.SQRT1_2",W.MEMBER],INFINITY:["Infinity",W.ATOMIC]}[N.getFieldValue("CONSTANT")]},de=function(N,j){var ge={EVEN:[" % 2 === 0",W.MODULUS,W.EQUALITY],ODD:[" % 2 === 1",W.MODULUS,W.EQUALITY],WHOLE:[" % 1 === 0",W.MODULUS,W.EQUALITY],POSITIVE:[" > 0",W.RELATIONAL,W.RELATIONAL],NEGATIVE:[" < 0",W.RELATIONAL,W.RELATIONAL],DIVISIBLE_BY:[null,W.MODULUS,W.EQUALITY],PRIME:[null,W.NONE,W.FUNCTION_CALL]};const we=N.getFieldValue("PROPERTY"),[We,gt,bt]=ge[we];return ge=j.valueToCode(N,"NUMBER_TO_CHECK",gt)||"0",we==="PRIME"?N=j.provideFunction_("mathIsPrime",`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(n) {
  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods
  if (n == 2 || n == 3) {
    return true;
  }
  // False if n is NaN, negative, is 1, or not whole.
  // And false if n is divisible by 2 or 3.
  if (isNaN(n) || n <= 1 || n % 1 !== 0 || n % 2 === 0 || n % 3 === 0) {
    return false;
  }
  // Check all the numbers of form 6k +/- 1, up to sqrt(n).
  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {
    if (n % (x - 1) === 0 || n % (x + 1) === 0) {
      return false;
    }
  }
  return true;
}
`)+"("+ge+")":we==="DIVISIBLE_BY"?(N=j.valueToCode(N,"DIVISOR",W.MODULUS)||"0",N=ge+" % "+N+" === 0"):N=ge+We,[N,bt]},xe=function(N,j){const ge=j.valueToCode(N,"DELTA",W.ADDITION)||"0";return N=j.getVariableName(N.getFieldValue("VAR")),N+" = (typeof "+N+" === 'number' ? "+N+" : 0) + "+ge+`;
`},H=function(N,j){var ge=N.getFieldValue("OP");switch(ge){case"SUM":N=j.valueToCode(N,"LIST",W.MEMBER)||"[]",N+=".reduce(function(x, y) {return x + y;}, 0)";break;case"MIN":N=j.valueToCode(N,"LIST",W.NONE)||"[]",N="Math.min.apply(null, "+N+")";break;case"MAX":N=j.valueToCode(N,"LIST",W.NONE)||"[]",N="Math.max.apply(null, "+N+")";break;case"AVERAGE":ge=j.provideFunction_("mathMean",`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(myList) {
  return myList.reduce(function(x, y) {return x + y;}, 0) / myList.length;
}
`),N=j.valueToCode(N,"LIST",W.NONE)||"[]",N=ge+"("+N+")";break;case"MEDIAN":ge=j.provideFunction_("mathMedian",`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(myList) {
  var localList = myList.filter(function (x) {return typeof x === 'number';});
  if (!localList.length) return null;
  localList.sort(function(a, b) {return b - a;});
  if (localList.length % 2 === 0) {
    return (localList[localList.length / 2 - 1] + localList[localList.length / 2]) / 2;
  } else {
    return localList[(localList.length - 1) / 2];
  }
}
`),N=j.valueToCode(N,"LIST",W.NONE)||"[]",N=ge+"("+N+")";break;case"MODE":ge=j.provideFunction_("mathModes",`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(values) {
  var modes = [];
  var counts = [];
  var maxCount = 0;
  for (var i = 0; i < values.length; i++) {
    var value = values[i];
    var found = false;
    var thisCount;
    for (var j = 0; j < counts.length; j++) {
      if (counts[j][0] === value) {
        thisCount = ++counts[j][1];
        found = true;
        break;
      }
    }
    if (!found) {
      counts.push([value, 1]);
      thisCount = 1;
    }
    maxCount = Math.max(thisCount, maxCount);
  }
  for (var j = 0; j < counts.length; j++) {
    if (counts[j][1] === maxCount) {
      modes.push(counts[j][0]);
    }
  }
  return modes;
}
`),N=j.valueToCode(N,"LIST",W.NONE)||"[]",N=ge+"("+N+")";break;case"STD_DEV":ge=j.provideFunction_("mathStandardDeviation",`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(numbers) {
  var n = numbers.length;
  if (!n) return null;
  var mean = numbers.reduce(function(x, y) {return x + y;}) / n;
  var variance = 0;
  for (var j = 0; j < n; j++) {
    variance += Math.pow(numbers[j] - mean, 2);
  }
  variance /= n;
  return Math.sqrt(variance);
}
`),N=j.valueToCode(N,"LIST",W.NONE)||"[]",N=ge+"("+N+")";break;case"RANDOM":ge=j.provideFunction_("mathRandomList",`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(list) {
  var x = Math.floor(Math.random() * list.length);
  return list[x];
}
`),N=j.valueToCode(N,"LIST",W.NONE)||"[]",N=ge+"("+N+")";break;default:throw Error("Unknown operator: "+ge)}return[N,W.FUNCTION_CALL]},J=function(N,j){const ge=j.valueToCode(N,"DIVIDEND",W.MODULUS)||"0";return N=j.valueToCode(N,"DIVISOR",W.MODULUS)||"0",[ge+" % "+N,W.MODULUS]},K=function(N,j){const ge=j.valueToCode(N,"VALUE",W.NONE)||"0",we=j.valueToCode(N,"LOW",W.NONE)||"0";return N=j.valueToCode(N,"HIGH",W.NONE)||"Infinity",["Math.min(Math.max("+ge+", "+we+"), "+N+")",W.FUNCTION_CALL]},se=function(N,j){const ge=j.valueToCode(N,"FROM",W.NONE)||"0";return N=j.valueToCode(N,"TO",W.NONE)||"0",[j.provideFunction_("mathRandomInt",`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(a, b) {
  if (a > b) {
    // Swap a and b to ensure a is smaller.
    var c = a;
    a = b;
    b = c;
  }
  return Math.floor(Math.random() * (b - a + 1) + a);
}
`)+"("+ge+", "+N+")",W.FUNCTION_CALL]},Y=function(N,j){return["Math.random()",W.FUNCTION_CALL]},he=function(N,j){const ge=j.valueToCode(N,"X",W.NONE)||"0";return["Math.atan2("+(j.valueToCode(N,"Y",W.NONE)||"0")+", "+ge+") / Math.PI * 180",W.DIVISION]},ue=function(N,j){const ge=j.getProcedureName(N.getFieldValue("NAME"));var we="";j.STATEMENT_PREFIX&&(we+=j.injectId(j.STATEMENT_PREFIX,N)),j.STATEMENT_SUFFIX&&(we+=j.injectId(j.STATEMENT_SUFFIX,N)),we&&(we=j.prefixLines(we,j.INDENT));let We="";j.INFINITE_LOOP_TRAP&&(We=j.prefixLines(j.injectId(j.INFINITE_LOOP_TRAP,N),j.INDENT));let gt="";N.getInput("STACK")&&(gt=j.statementToCode(N,"STACK"));let bt="";N.getInput("RETURN")&&(bt=j.valueToCode(N,"RETURN",W.NONE)||"");let un="";gt&&bt&&(un=we),bt&&(bt=j.INDENT+"return "+bt+`;
`);const an=[],ei=N.getVars();for(let pi=0;pi<ei.length;pi++)an[pi]=j.getVariableName(ei[pi]);return we="function "+ge+"("+an.join(", ")+`) {
`+we+We+gt+un+bt+"}",we=j.scrub_(N,we),j.definitions_["%"+ge]=we,null},Te=function(N,j){const ge=j.getProcedureName(N.getFieldValue("NAME")),we=[],We=N.getVars();for(let gt=0;gt<We.length;gt++)we[gt]=j.valueToCode(N,"ARG"+gt,W.NONE)||"null";return[ge+"("+we.join(", ")+")",W.FUNCTION_CALL]},_e=function(N,j){return j.forBlock.procedures_callreturn(N,j)[0]+`;
`},Re=function(N,j){let ge="if ("+(j.valueToCode(N,"CONDITION",W.NONE)||"false")+`) {
`;return j.STATEMENT_SUFFIX&&(ge+=j.prefixLines(j.injectId(j.STATEMENT_SUFFIX,N),j.INDENT)),N.hasReturnValue_?(N=j.valueToCode(N,"VALUE",W.NONE)||"null",ge+=j.INDENT+"return "+N+`;
`):ge+=j.INDENT+`return;
`,ge+`}
`},De=function(N,j){return[j.quote_(N.getFieldValue("TEXT")),W.ATOMIC]},et=function(N,j){switch(N.itemCount_){case 0:return["''",W.ATOMIC];case 1:return N=j.valueToCode(N,"ADD0",W.NONE)||"''",X(N);case 2:var ge=j.valueToCode(N,"ADD0",W.NONE)||"''";return N=j.valueToCode(N,"ADD1",W.NONE)||"''",[X(ge)[0]+" + "+X(N)[0],W.ADDITION];default:ge=Array(N.itemCount_);for(let we=0;we<N.itemCount_;we++)ge[we]=j.valueToCode(N,"ADD"+we,W.NONE)||"''";return["["+ge.join(",")+"].join('')",W.FUNCTION_CALL]}},Ue=function(N,j){const ge=j.getVariableName(N.getFieldValue("VAR"));return N=j.valueToCode(N,"TEXT",W.NONE)||"''",ge+" += "+X(N)[0]+`;
`},Le=function(N,j){return[(j.valueToCode(N,"VALUE",W.MEMBER)||"''")+".length",W.MEMBER]},re=function(N,j){return["!"+(j.valueToCode(N,"VALUE",W.MEMBER)||"''")+".length",W.LOGICAL_NOT]},Ye=function(N,j){const ge=N.getFieldValue("END")==="FIRST"?"indexOf":"lastIndexOf",we=j.valueToCode(N,"FIND",W.NONE)||"''";return j=(j.valueToCode(N,"VALUE",W.MEMBER)||"''")+"."+ge+"("+we+")",N.workspace.options.oneBasedIndex?[j+" + 1",W.ADDITION]:[j,W.FUNCTION_CALL]},Fe=function(N,j){const ge=N.getFieldValue("WHERE")||"FROM_START",we=j.valueToCode(N,"VALUE",ge==="RANDOM"?W.NONE:W.MEMBER)||"''";switch(ge){case"FIRST":return[we+".charAt(0)",W.FUNCTION_CALL];case"LAST":return[we+".slice(-1)",W.FUNCTION_CALL];case"FROM_START":return N=j.getAdjusted(N,"AT"),[we+".charAt("+N+")",W.FUNCTION_CALL];case"FROM_END":return N=j.getAdjusted(N,"AT",1,!0),[we+".slice("+N+").charAt(0)",W.FUNCTION_CALL];case"RANDOM":return[j.provideFunction_("textRandomLetter",`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(text) {
  var x = Math.floor(Math.random() * text.length);
  return text[x];
}
`)+"("+we+")",W.FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},Ze=function(N,j){var ge={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"};const we=N.getFieldValue("WHERE1"),We=N.getFieldValue("WHERE2");var gt=we!=="FROM_END"&&we!=="LAST"&&We!=="FROM_END"&&We!=="LAST",bt=j.valueToCode(N,"STRING",gt?W.MEMBER:W.NONE)||"''";if(we==="FIRST"&&We==="LAST")return[bt,W.NONE];if(bt.match(/^'?\w+'?$/)||gt){switch(we){case"FROM_START":ge=j.getAdjusted(N,"AT1");break;case"FROM_END":ge=j.getAdjusted(N,"AT1",1,!1,W.SUBTRACTION),ge=bt+".length - "+ge;break;case"FIRST":ge="0";break;default:throw Error("Unhandled option (text_getSubstring).")}switch(We){case"FROM_START":j=j.getAdjusted(N,"AT2",1);break;case"FROM_END":j=j.getAdjusted(N,"AT2",0,!1,W.SUBTRACTION),j=bt+".length - "+j;break;case"LAST":j=bt+".length";break;default:throw Error("Unhandled option (text_getSubstring).")}bt=bt+".slice("+ge+", "+j+")"}else gt=j.getAdjusted(N,"AT1"),N=j.getAdjusted(N,"AT2"),bt=j.provideFunction_("subsequence"+ge[we]+ge[We],`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(sequence${we==="FROM_END"||we==="FROM_START"?", at1":""}${We==="FROM_END"||We==="FROM_START"?", at2":""}) {
  var start = ${fe("sequence",we,"at1")};
  var end = ${fe("sequence",We,"at2")} + 1;
  return sequence.slice(start, end);
}
`)+"("+bt+(we==="FROM_END"||we==="FROM_START"?", "+gt:"")+(We==="FROM_END"||We==="FROM_START"?", "+N:"")+")";return[bt,W.FUNCTION_CALL]},Xe=function(N,j){const ge={UPPERCASE:".toUpperCase()",LOWERCASE:".toLowerCase()",TITLECASE:null}[N.getFieldValue("CASE")];return N=j.valueToCode(N,"TEXT",ge?W.MEMBER:W.NONE)||"''",[ge?N+ge:j.provideFunction_("textToTitleCase",`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(str) {
  return str.replace(/\\S+/g,
      function(txt) {return txt[0].toUpperCase() + txt.substring(1).toLowerCase();});
}
`)+"("+N+")",W.FUNCTION_CALL]},dt=function(N,j){const ge={LEFT:".replace(/^[\\s\\xa0]+/, '')",RIGHT:".replace(/[\\s\\xa0]+$/, '')",BOTH:".trim()"}[N.getFieldValue("MODE")];return[(j.valueToCode(N,"TEXT",W.MEMBER)||"''")+ge,W.FUNCTION_CALL]},je=function(N,j){return"window.alert("+(j.valueToCode(N,"TEXT",W.NONE)||"''")+`);
`},it=function(N,j){return j="window.prompt("+(N.getField("TEXT")?j.quote_(N.getFieldValue("TEXT")):j.valueToCode(N,"TEXT",W.NONE)||"''")+")",N.getFieldValue("TYPE")==="NUMBER"&&(j="Number("+j+")"),[j,W.FUNCTION_CALL]},Ce=function(N,j){const ge=j.valueToCode(N,"TEXT",W.NONE)||"''";return N=j.valueToCode(N,"SUB",W.NONE)||"''",[j.provideFunction_("textCount",`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle) {
  if (needle.length === 0) {
    return haystack.length + 1;
  } else {
    return haystack.split(needle).length - 1;
  }
}
`)+"("+ge+", "+N+")",W.FUNCTION_CALL]},Me=function(N,j){const ge=j.valueToCode(N,"TEXT",W.NONE)||"''",we=j.valueToCode(N,"FROM",W.NONE)||"''";return N=j.valueToCode(N,"TO",W.NONE)||"''",[j.provideFunction_("textReplace",`
function ${j.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle, replacement) {
  needle = needle.replace(/([-()\\[\\]{}+?*.$\\^|,:#<!\\\\])/g, '\\\\$1')
                 .replace(/\\x08/g, '\\\\x08');
  return haystack.replace(new RegExp(needle, 'g'), replacement);
}
`)+"("+ge+", "+we+", "+N+")",W.FUNCTION_CALL]},St=function(N,j){return[(j.valueToCode(N,"TEXT",W.MEMBER)||"''")+".split('').reverse().join('')",W.FUNCTION_CALL]},oe=function(N,j){return[j.getVariableName(N.getFieldValue("VAR")),W.ATOMIC]},ee=function(N,j){const ge=j.valueToCode(N,"VALUE",W.ASSIGNMENT)||"0";return j.getVariableName(N.getFieldValue("VAR"))+" = "+ge+`;
`},W;(function(N){N[N.ATOMIC=0]="ATOMIC",N[N.NEW=1.1]="NEW",N[N.MEMBER=1.2]="MEMBER",N[N.FUNCTION_CALL=2]="FUNCTION_CALL",N[N.INCREMENT=3]="INCREMENT",N[N.DECREMENT=3]="DECREMENT",N[N.BITWISE_NOT=4.1]="BITWISE_NOT",N[N.UNARY_PLUS=4.2]="UNARY_PLUS",N[N.UNARY_NEGATION=4.3]="UNARY_NEGATION",N[N.LOGICAL_NOT=4.4]="LOGICAL_NOT",N[N.TYPEOF=4.5]="TYPEOF",N[N.VOID=4.6]="VOID",N[N.DELETE=4.7]="DELETE",N[N.AWAIT=4.8]="AWAIT",N[N.EXPONENTIATION=5]="EXPONENTIATION",N[N.MULTIPLICATION=5.1]="MULTIPLICATION",N[N.DIVISION=5.2]="DIVISION",N[N.MODULUS=5.3]="MODULUS",N[N.SUBTRACTION=6.1]="SUBTRACTION",N[N.ADDITION=6.2]="ADDITION",N[N.BITWISE_SHIFT=7]="BITWISE_SHIFT",N[N.RELATIONAL=8]="RELATIONAL",N[N.IN=8]="IN",N[N.INSTANCEOF=8]="INSTANCEOF",N[N.EQUALITY=9]="EQUALITY",N[N.BITWISE_AND=10]="BITWISE_AND",N[N.BITWISE_XOR=11]="BITWISE_XOR",N[N.BITWISE_OR=12]="BITWISE_OR",N[N.LOGICAL_AND=13]="LOGICAL_AND",N[N.LOGICAL_OR=14]="LOGICAL_OR",N[N.CONDITIONAL=15]="CONDITIONAL",N[N.ASSIGNMENT=16]="ASSIGNMENT",N[N.YIELD=17]="YIELD",N[N.COMMA=18]="COMMA",N[N.NONE=99]="NONE"})(W||(W={}));var ot=class extends r.CodeGenerator$$module$build$src$core$generator{constructor(N="JavaScript"){super(N),this.ORDER_OVERRIDES=[[W.FUNCTION_CALL,W.MEMBER],[W.FUNCTION_CALL,W.FUNCTION_CALL],[W.MEMBER,W.MEMBER],[W.MEMBER,W.FUNCTION_CALL],[W.LOGICAL_NOT,W.LOGICAL_NOT],[W.MULTIPLICATION,W.MULTIPLICATION],[W.ADDITION,W.ADDITION],[W.LOGICAL_AND,W.LOGICAL_AND],[W.LOGICAL_OR,W.LOGICAL_OR]],this.isInitialized=!1;for(const j in W)N=W[j],typeof N!="string"&&(this["ORDER_"+j]=N);this.addReservedWords("break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,new,return,super,switch,this,throw,try,typeof,var,void,while,with,yield,enum,implements,interface,let,package,private,protected,public,static,await,null,true,false,arguments,"+Object.getOwnPropertyNames(globalThis).join(","))}init(N){super.init(N),this.nameDB_?this.nameDB_.reset():this.nameDB_=new r.Names$$module$build$src$core$names(this.RESERVED_WORDS_),this.nameDB_.setVariableMap(N.getVariableMap()),this.nameDB_.populateVariables(N),this.nameDB_.populateProcedures(N);const j=[];var ge=r.allDeveloperVariables$$module$build$src$core$variables(N);for(let we=0;we<ge.length;we++)j.push(this.nameDB_.getName(ge[we],r.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE));for(N=r.allUsedVarModels$$module$build$src$core$variables(N),ge=0;ge<N.length;ge++)j.push(this.nameDB_.getName(N[ge].getId(),r.NameType$$module$build$src$core$names.VARIABLE));j.length&&(this.definitions_.variables="var "+j.join(", ")+";"),this.isInitialized=!0}finish(N){const j=Object.values(this.definitions_);return super.finish(N),this.isInitialized=!1,this.nameDB_.reset(),j.join(`

`)+`


`+N}scrubNakedValue(N){return N+`;
`}quote_(N){return N=N.replace(/\\/g,"\\\\").replace(/\n/g,`\\
`).replace(/'/g,"\\'"),"'"+N+"'"}multiline_quote_(N){return N.split(/\n/g).map(this.quote_).join(` + '\\n' +
`)}scrub_(N,j,ge=!1){let we="";if(!N.outputConnection||!N.outputConnection.targetConnection){var We=N.getCommentText();We&&(We=r.wrap$$module$build$src$core$utils$string(We,this.COMMENT_WRAP-3),we+=this.prefixLines(We+`
`,"// "));for(let gt=0;gt<N.inputList.length;gt++)N.inputList[gt].type===r.inputTypes$$module$build$src$core$inputs$input_types.VALUE&&(We=N.inputList[gt].connection.targetBlock())&&(We=this.allNestedComments(We))&&(we+=this.prefixLines(We,"// "))}return N=N.nextConnection&&N.nextConnection.targetBlock(),ge=ge?"":this.blockToCode(N),we+j+ge}getAdjusted(N,j,ge=0,we=!1,We=W.NONE){N.workspace.options.oneBasedIndex&&ge--;const gt=N.workspace.options.oneBasedIndex?"1":"0";let bt=We;return 0<ge?bt=W.ADDITION:0>ge?bt=W.SUBTRACTION:we&&(bt=W.UNARY_NEGATION),N=this.valueToCode(N,j,bt)||gt,ge===0&&!we?N:r.isNumber$$module$build$src$core$utils$string(N)?(N=String(Number(N)+ge),we&&(N=String(-Number(N))),N):(0<ge?N=`${N} + ${ge}`:0>ge&&(N=`${N} - ${-ge}`),we&&(N=ge?`-(${N})`:`-${N}`),Math.floor(We)>=Math.floor(bt)&&(N=`(${N})`),N)}},ze=function(N,j,ge){return j==="FIRST"?"0":j==="FROM_END"?N+".length - 1 - "+ge:j==="LAST"?N+".length - 1":ge},qe={};qe.lists_create_empty=s,qe.lists_create_with=a,qe.lists_getIndex=f,qe.lists_getSublist=m,qe.lists_indexOf=h,qe.lists_isEmpty=d,qe.lists_length=u,qe.lists_repeat=l,qe.lists_reverse=b,qe.lists_setIndex=p,qe.lists_sort=T,qe.lists_split=E;var ut={};ut.controls_if=y,ut.controls_ifelse=y,ut.logic_boolean=R,ut.logic_compare=S,ut.logic_negate=C,ut.logic_null=I,ut.logic_operation=A,ut.logic_ternary=O;var ft={};ft.controls_flow_statements=ce,ft.controls_for=D,ft.controls_forEach=U,ft.controls_repeat=F,ft.controls_repeat_ext=F,ft.controls_whileUntil=k;var Ge={};Ge.math_arithmetic=ae,Ge.math_atan2=he,Ge.math_change=xe,Ge.math_constant=pe,Ge.math_constrain=K,Ge.math_modulo=J,Ge.math_number=ie,Ge.math_number_property=de,Ge.math_on_list=H,Ge.math_random_float=Y,Ge.math_random_int=se,Ge.math_round=ne,Ge.math_single=ne,Ge.math_trig=ne;var $t={};$t.procedures_callnoreturn=_e,$t.procedures_callreturn=Te,$t.procedures_defnoreturn=ue,$t.procedures_defreturn=ue,$t.procedures_ifreturn=Re;var L=/^\s*'([^']|\\')*'\s*$/,X=function(N){return L.test(N)?[N,W.ATOMIC]:["String("+N+")",W.FUNCTION_CALL]},fe=function(N,j,ge){return j==="FIRST"?"0":j==="FROM_END"?N+".length - 1 - "+ge:j==="LAST"?N+".length - 1":ge},z={};z.text=De,z.text_append=Ue,z.text_changeCase=Xe,z.text_charAt=Fe,z.text_count=Ce,z.text_getSubstring=Ze,z.text_indexOf=Ye,z.text_isEmpty=re,z.text_join=et,z.text_length=Le,z.text_print=je,z.text_prompt=it,z.text_prompt_ext=it,z.text_replace=Me,z.text_reverse=St,z.text_trim=dt;var Ae={};Ae.variables_get=oe,Ae.variables_set=ee;var tt={};tt.variables_get_dynamic=oe,tt.variables_set_dynamic=ee;var ye=new ot,Ie=Object.assign({},qe,ut,ft,Ge,$t,z,Ae,tt);for(const N in Ie)ye.forBlock[N]=Ie[N];var Be={};return Be.JavascriptGenerator=ot,Be.Order=W,Be.javascriptGenerator=ye,Be.__namespace__=r,Be})})(b2);var sJ=b2.exports;const oJ=hd(sJ),{JavascriptGenerator:Wue,Order:Xue,javascriptGenerator:Dn}=oJ;var aJ=lI();const lJ=hd(aJ),{ASTNode:cJ,BasicCursor:uJ,Block:hJ,BlockSvg:dJ,Blocks:fJ,COLLAPSED_FIELD_NAME:pJ,COLLAPSED_INPUT_NAME:mJ,COLLAPSE_CHARS:gJ,CodeGenerator:_J,CollapsibleToolboxCategory:vJ,ComponentManager:TJ,Connection:EJ,ConnectionChecker:yJ,ConnectionDB:SJ,ConnectionType:$J,ContextMenu:bJ,ContextMenuItems:AJ,ContextMenuRegistry:CJ,Css:xJ,Cursor:RJ,DELETE_VARIABLE_ID:wJ,DeleteArea:MJ,DragTarget:IJ,DropDownDiv:OJ,Events:LJ,Extensions:NJ,Field:kJ,FieldCheckbox:PJ,FieldDropdown:DJ,FieldImage:BJ,FieldLabel:FJ,FieldLabelSerializable:UJ,FieldNumber:GJ,FieldTextInput:HJ,FieldVariable:VJ,Flyout:zJ,FlyoutButton:WJ,FlyoutMetricsManager:XJ,Generator:jJ,Gesture:YJ,Grid:KJ,HorizontalFlyout:JJ,INPUT_VALUE:ZJ,Input:qJ,InsertionMarkerManager:QJ,InsertionMarkerPreviewer:eZ,Marker:tZ,MarkerManager:nZ,Menu:iZ,MenuItem:rZ,MetricsManager:sZ,Msg:oZ,NEXT_STATEMENT:aZ,Names:lZ,OPPOSITE_TYPE:cZ,OUTPUT_VALUE:uZ,Options:hZ,PREVIOUS_STATEMENT:dZ,PROCEDURE_CATEGORY_NAME:fZ,Procedures:pZ,RENAME_VARIABLE_ID:mZ,RenderedConnection:gZ,Scrollbar:_Z,ScrollbarPair:vZ,ShortcutItems:TZ,ShortcutRegistry:EZ,TOOLBOX_AT_BOTTOM:yZ,TOOLBOX_AT_LEFT:SZ,TOOLBOX_AT_RIGHT:$Z,TOOLBOX_AT_TOP:bZ,TabNavigateCursor:AZ,Theme:A2,ThemeManager:CZ,Themes:C2,Toolbox:xZ,ToolboxCategory:RZ,ToolboxItem:wZ,ToolboxSeparator:MZ,Tooltip:IZ,Touch:OZ,Trashcan:LZ,UnattachedFieldError:NZ,VARIABLE_CATEGORY_NAME:kZ,VARIABLE_DYNAMIC_CATEGORY_NAME:PZ,VERSION:DZ,VariableMap:BZ,VariableModel:FZ,Variables:UZ,VariablesDynamic:GZ,VerticalFlyout:HZ,WidgetDiv:VZ,Workspace:zZ,WorkspaceAudio:WZ,WorkspaceDragger:XZ,WorkspaceSvg:jZ,Xml:YZ,ZoomControls:KZ,blockAnimations:JZ,blockRendering:ZZ,browserEvents:qZ,bubbles:QZ,bumpObjects:eq,clipboard:tq,comments:nq,common:iq,config:rq,constants:sq,defineBlocksWithJsonArray:oq,dialog:aq,dragging:lq,fieldRegistry:cq,geras:uq,getMainWorkspace:lg,getSelected:hq,hasBubble:dq,hideChaff:fq,icons:pq,inject:x2,inputs:mq,isCopyable:gq,isDeletable:_q,isDraggable:vq,isIcon:Tq,isObservable:Eq,isPaster:yq,isRenderedElement:Sq,isSelectable:$q,isSerializable:bq,isVariableBackedParameterModel:Aq,procedures:Cq,registry:xq,renderManagement:Rq,serialization:wq,setLocale:R2,setParentContainer:Mq,svgResize:Iq,thrasos:Oq,uiPosition:Lq,utils:Nq,zelos:kq}=lJ,Pq=Object.freeze(Object.defineProperty({__proto__:null,ASTNode:cJ,BasicCursor:uJ,Block:hJ,BlockSvg:dJ,Blocks:fJ,COLLAPSED_FIELD_NAME:pJ,COLLAPSED_INPUT_NAME:mJ,COLLAPSE_CHARS:gJ,CodeGenerator:_J,CollapsibleToolboxCategory:vJ,ComponentManager:TJ,Connection:EJ,ConnectionChecker:yJ,ConnectionDB:SJ,ConnectionType:$J,ContextMenu:bJ,ContextMenuItems:AJ,ContextMenuRegistry:CJ,Css:xJ,Cursor:RJ,DELETE_VARIABLE_ID:wJ,DeleteArea:MJ,DragTarget:IJ,DropDownDiv:OJ,Events:LJ,Extensions:NJ,Field:kJ,FieldCheckbox:PJ,FieldDropdown:DJ,FieldImage:BJ,FieldLabel:FJ,FieldLabelSerializable:UJ,FieldNumber:GJ,FieldTextInput:HJ,FieldVariable:VJ,Flyout:zJ,FlyoutButton:WJ,FlyoutMetricsManager:XJ,Generator:jJ,Gesture:YJ,Grid:KJ,HorizontalFlyout:JJ,INPUT_VALUE:ZJ,Input:qJ,InsertionMarkerManager:QJ,InsertionMarkerPreviewer:eZ,Marker:tZ,MarkerManager:nZ,Menu:iZ,MenuItem:rZ,MetricsManager:sZ,Msg:oZ,NEXT_STATEMENT:aZ,Names:lZ,OPPOSITE_TYPE:cZ,OUTPUT_VALUE:uZ,Options:hZ,PREVIOUS_STATEMENT:dZ,PROCEDURE_CATEGORY_NAME:fZ,Procedures:pZ,RENAME_VARIABLE_ID:mZ,RenderedConnection:gZ,Scrollbar:_Z,ScrollbarPair:vZ,ShortcutItems:TZ,ShortcutRegistry:EZ,TOOLBOX_AT_BOTTOM:yZ,TOOLBOX_AT_LEFT:SZ,TOOLBOX_AT_RIGHT:$Z,TOOLBOX_AT_TOP:bZ,TabNavigateCursor:AZ,Theme:A2,ThemeManager:CZ,Themes:C2,Toolbox:xZ,ToolboxCategory:RZ,ToolboxItem:wZ,ToolboxSeparator:MZ,Tooltip:IZ,Touch:OZ,Trashcan:LZ,UnattachedFieldError:NZ,VARIABLE_CATEGORY_NAME:kZ,VARIABLE_DYNAMIC_CATEGORY_NAME:PZ,VERSION:DZ,VariableMap:BZ,VariableModel:FZ,Variables:UZ,VariablesDynamic:GZ,VerticalFlyout:HZ,WidgetDiv:VZ,Workspace:zZ,WorkspaceAudio:WZ,WorkspaceDragger:XZ,WorkspaceSvg:jZ,Xml:YZ,ZoomControls:KZ,blockAnimations:JZ,blockRendering:ZZ,browserEvents:qZ,bubbles:QZ,bumpObjects:eq,clipboard:tq,comments:nq,common:iq,config:rq,constants:sq,defineBlocksWithJsonArray:oq,dialog:aq,dragging:lq,fieldRegistry:cq,geras:uq,getMainWorkspace:lg,getSelected:hq,hasBubble:dq,hideChaff:fq,icons:pq,inject:x2,inputs:mq,isCopyable:gq,isDeletable:_q,isDraggable:vq,isIcon:Tq,isObservable:Eq,isPaster:yq,isRenderedElement:Sq,isSelectable:$q,isSerializable:bq,isVariableBackedParameterModel:Aq,procedures:Cq,registry:xq,renderManagement:Rq,serialization:wq,setLocale:R2,setParentContainer:Mq,svgResize:Iq,thrasos:Oq,uiPosition:Lq,utils:Nq,zelos:kq},Symbol.toStringTag,{value:"Module"}));var w2={exports:{}};(function(i,e){(function(n,r){i.exports=r()})(qf,function(){var n=n||{Msg:Object.create(null)};return n.Msg.ADD_COMMENT="Add Comment",n.Msg.CANNOT_DELETE_VARIABLE_PROCEDURE="Can't delete the variable '%1' because it's part of the definition of the function '%2'",n.Msg.CHANGE_VALUE_TITLE="Change value:",n.Msg.CLEAN_UP="Clean up Blocks",n.Msg.COLLAPSED_WARNINGS_WARNING="Collapsed blocks contain warnings.",n.Msg.COLLAPSE_ALL="Collapse Blocks",n.Msg.COLLAPSE_BLOCK="Collapse Block",n.Msg.COLOUR_BLEND_COLOUR1="colour 1",n.Msg.COLOUR_BLEND_COLOUR2="colour 2",n.Msg.COLOUR_BLEND_HELPURL="https://meyerweb.com/eric/tools/color-blend/#:::rgbp",n.Msg.COLOUR_BLEND_RATIO="ratio",n.Msg.COLOUR_BLEND_TITLE="blend",n.Msg.COLOUR_BLEND_TOOLTIP="Blends two colours together with a given ratio (0.0 - 1.0).",n.Msg.COLOUR_PICKER_HELPURL="https://en.wikipedia.org/wiki/Color",n.Msg.COLOUR_PICKER_TOOLTIP="Choose a colour from the palette.",n.Msg.COLOUR_RANDOM_HELPURL="http://randomcolour.com",n.Msg.COLOUR_RANDOM_TITLE="random colour",n.Msg.COLOUR_RANDOM_TOOLTIP="Choose a colour at random.",n.Msg.COLOUR_RGB_BLUE="blue",n.Msg.COLOUR_RGB_GREEN="green",n.Msg.COLOUR_RGB_HELPURL="https://www.december.com/html/spec/colorpercompact.html",n.Msg.COLOUR_RGB_RED="red",n.Msg.COLOUR_RGB_TITLE="colour with",n.Msg.COLOUR_RGB_TOOLTIP="Create a colour with the specified amount of red, green, and blue. All values must be between 0 and 100.",n.Msg.CONTROLS_FLOW_STATEMENTS_HELPURL="https://github.com/google/blockly/wiki/Loops#loop-termination-blocks",n.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK="break out of loop",n.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE="continue with next iteration of loop",n.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK="Break out of the containing loop.",n.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE="Skip the rest of this loop, and continue with the next iteration.",n.Msg.CONTROLS_FLOW_STATEMENTS_WARNING="Warning: This block may only be used within a loop.",n.Msg.CONTROLS_FOREACH_HELPURL="https://github.com/google/blockly/wiki/Loops#for-each",n.Msg.CONTROLS_FOREACH_TITLE="for each item %1 in list %2",n.Msg.CONTROLS_FOREACH_TOOLTIP="For each item in a list, set the variable '%1' to the item, and then do some statements.",n.Msg.CONTROLS_FOR_HELPURL="https://github.com/google/blockly/wiki/Loops#count-with",n.Msg.CONTROLS_FOR_TITLE="count with %1 from %2 to %3 by %4",n.Msg.CONTROLS_FOR_TOOLTIP="Have the variable '%1' take on the values from the start number to the end number, counting by the specified interval, and do the specified blocks.",n.Msg.CONTROLS_IF_ELSEIF_TOOLTIP="Add a condition to the if block.",n.Msg.CONTROLS_IF_ELSE_TOOLTIP="Add a final, catch-all condition to the if block.",n.Msg.CONTROLS_IF_HELPURL="https://github.com/google/blockly/wiki/IfElse",n.Msg.CONTROLS_IF_IF_TOOLTIP="Add, remove, or reorder sections to reconfigure this if block.",n.Msg.CONTROLS_IF_MSG_ELSE="else",n.Msg.CONTROLS_IF_MSG_ELSEIF="else if",n.Msg.CONTROLS_IF_MSG_IF="if",n.Msg.CONTROLS_IF_TOOLTIP_1="If a value is true, then do some statements.",n.Msg.CONTROLS_IF_TOOLTIP_2="If a value is true, then do the first block of statements. Otherwise, do the second block of statements.",n.Msg.CONTROLS_IF_TOOLTIP_3="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements.",n.Msg.CONTROLS_IF_TOOLTIP_4="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.",n.Msg.CONTROLS_REPEAT_HELPURL="https://en.wikipedia.org/wiki/For_loop",n.Msg.CONTROLS_REPEAT_INPUT_DO="do",n.Msg.CONTROLS_REPEAT_TITLE="repeat %1 times",n.Msg.CONTROLS_REPEAT_TOOLTIP="Do some statements several times.",n.Msg.CONTROLS_WHILEUNTIL_HELPURL="https://github.com/google/blockly/wiki/Loops#repeat",n.Msg.CONTROLS_WHILEUNTIL_OPERATOR_UNTIL="repeat until",n.Msg.CONTROLS_WHILEUNTIL_OPERATOR_WHILE="repeat while",n.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL="While a value is false, then do some statements.",n.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_WHILE="While a value is true, then do some statements.",n.Msg.DELETE_ALL_BLOCKS="Delete all %1 blocks?",n.Msg.DELETE_BLOCK="Delete Block",n.Msg.DELETE_VARIABLE="Delete the '%1' variable",n.Msg.DELETE_VARIABLE_CONFIRMATION="Delete %1 uses of the '%2' variable?",n.Msg.DELETE_X_BLOCKS="Delete %1 Blocks",n.Msg.DIALOG_CANCEL="Cancel",n.Msg.DIALOG_OK="OK",n.Msg.DISABLE_BLOCK="Disable Block",n.Msg.DUPLICATE_BLOCK="Duplicate",n.Msg.DUPLICATE_COMMENT="Duplicate Comment",n.Msg.ENABLE_BLOCK="Enable Block",n.Msg.EXPAND_ALL="Expand Blocks",n.Msg.EXPAND_BLOCK="Expand Block",n.Msg.EXTERNAL_INPUTS="External Inputs",n.Msg.HELP="Help",n.Msg.INLINE_INPUTS="Inline Inputs",n.Msg.LISTS_CREATE_EMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#create-empty-list",n.Msg.LISTS_CREATE_EMPTY_TITLE="create empty list",n.Msg.LISTS_CREATE_EMPTY_TOOLTIP="Returns a list, of length 0, containing no data records",n.Msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD="list",n.Msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP="Add, remove, or reorder sections to reconfigure this list block.",n.Msg.LISTS_CREATE_WITH_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",n.Msg.LISTS_CREATE_WITH_INPUT_WITH="create list with",n.Msg.LISTS_CREATE_WITH_ITEM_TOOLTIP="Add an item to the list.",n.Msg.LISTS_CREATE_WITH_TOOLTIP="Create a list with any number of items.",n.Msg.LISTS_GET_INDEX_FIRST="first",n.Msg.LISTS_GET_INDEX_FROM_END="# from end",n.Msg.LISTS_GET_INDEX_FROM_START="#",n.Msg.LISTS_GET_INDEX_GET="get",n.Msg.LISTS_GET_INDEX_GET_REMOVE="get and remove",n.Msg.LISTS_GET_INDEX_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-items-from-a-list",n.Msg.LISTS_GET_INDEX_LAST="last",n.Msg.LISTS_GET_INDEX_RANDOM="random",n.Msg.LISTS_GET_INDEX_REMOVE="remove",n.Msg.LISTS_GET_INDEX_TAIL="",n.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST="Returns the first item in a list.",n.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM="Returns the item at the specified position in a list.",n.Msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST="Returns the last item in a list.",n.Msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM="Returns a random item in a list.",n.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST="Removes and returns the first item in a list.",n.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM="Removes and returns the item at the specified position in a list.",n.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST="Removes and returns the last item in a list.",n.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM="Removes and returns a random item in a list.",n.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST="Removes the first item in a list.",n.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM="Removes the item at the specified position in a list.",n.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST="Removes the last item in a list.",n.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM="Removes a random item in a list.",n.Msg.LISTS_GET_SUBLIST_END_FROM_END="to # from end",n.Msg.LISTS_GET_SUBLIST_END_FROM_START="to #",n.Msg.LISTS_GET_SUBLIST_END_LAST="to last",n.Msg.LISTS_GET_SUBLIST_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-a-sublist",n.Msg.LISTS_GET_SUBLIST_START_FIRST="get sub-list from first",n.Msg.LISTS_GET_SUBLIST_START_FROM_END="get sub-list from # from end",n.Msg.LISTS_GET_SUBLIST_START_FROM_START="get sub-list from #",n.Msg.LISTS_GET_SUBLIST_TAIL="",n.Msg.LISTS_GET_SUBLIST_TOOLTIP="Creates a copy of the specified portion of a list.",n.Msg.LISTS_INDEX_FROM_END_TOOLTIP="%1 is the last item.",n.Msg.LISTS_INDEX_FROM_START_TOOLTIP="%1 is the first item.",n.Msg.LISTS_INDEX_OF_FIRST="find first occurrence of item",n.Msg.LISTS_INDEX_OF_HELPURL="https://github.com/google/blockly/wiki/Lists#finding-items-in-a-list",n.Msg.LISTS_INDEX_OF_LAST="find last occurrence of item",n.Msg.LISTS_INDEX_OF_TOOLTIP="Returns the index of the first/last occurrence of the item in the list. Returns %1 if item is not found.",n.Msg.LISTS_INLIST="in list",n.Msg.LISTS_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#is-empty",n.Msg.LISTS_ISEMPTY_TITLE="%1 is empty",n.Msg.LISTS_ISEMPTY_TOOLTIP="Returns true if the list is empty.",n.Msg.LISTS_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Lists#length-of",n.Msg.LISTS_LENGTH_TITLE="length of %1",n.Msg.LISTS_LENGTH_TOOLTIP="Returns the length of a list.",n.Msg.LISTS_REPEAT_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",n.Msg.LISTS_REPEAT_TITLE="create list with item %1 repeated %2 times",n.Msg.LISTS_REPEAT_TOOLTIP="Creates a list consisting of the given value repeated the specified number of times.",n.Msg.LISTS_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Lists#reversing-a-list",n.Msg.LISTS_REVERSE_MESSAGE0="reverse %1",n.Msg.LISTS_REVERSE_TOOLTIP="Reverse a copy of a list.",n.Msg.LISTS_SET_INDEX_HELPURL="https://github.com/google/blockly/wiki/Lists#in-list--set",n.Msg.LISTS_SET_INDEX_INPUT_TO="as",n.Msg.LISTS_SET_INDEX_INSERT="insert at",n.Msg.LISTS_SET_INDEX_SET="set",n.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST="Inserts the item at the start of a list.",n.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM="Inserts the item at the specified position in a list.",n.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST="Append the item to the end of a list.",n.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM="Inserts the item randomly in a list.",n.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST="Sets the first item in a list.",n.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM="Sets the item at the specified position in a list.",n.Msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST="Sets the last item in a list.",n.Msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM="Sets a random item in a list.",n.Msg.LISTS_SORT_HELPURL="https://github.com/google/blockly/wiki/Lists#sorting-a-list",n.Msg.LISTS_SORT_ORDER_ASCENDING="ascending",n.Msg.LISTS_SORT_ORDER_DESCENDING="descending",n.Msg.LISTS_SORT_TITLE="sort %1 %2 %3",n.Msg.LISTS_SORT_TOOLTIP="Sort a copy of a list.",n.Msg.LISTS_SORT_TYPE_IGNORECASE="alphabetic, ignore case",n.Msg.LISTS_SORT_TYPE_NUMERIC="numeric",n.Msg.LISTS_SORT_TYPE_TEXT="alphabetic",n.Msg.LISTS_SPLIT_HELPURL="https://github.com/google/blockly/wiki/Lists#splitting-strings-and-joining-lists",n.Msg.LISTS_SPLIT_LIST_FROM_TEXT="make list from text",n.Msg.LISTS_SPLIT_TEXT_FROM_LIST="make text from list",n.Msg.LISTS_SPLIT_TOOLTIP_JOIN="Join a list of texts into one text, separated by a delimiter.",n.Msg.LISTS_SPLIT_TOOLTIP_SPLIT="Split text into a list of texts, breaking at each delimiter.",n.Msg.LISTS_SPLIT_WITH_DELIMITER="with delimiter",n.Msg.LOGIC_BOOLEAN_FALSE="false",n.Msg.LOGIC_BOOLEAN_HELPURL="https://github.com/google/blockly/wiki/Logic#values",n.Msg.LOGIC_BOOLEAN_TOOLTIP="Returns either true or false.",n.Msg.LOGIC_BOOLEAN_TRUE="true",n.Msg.LOGIC_COMPARE_HELPURL="https://en.wikipedia.org/wiki/Inequality_(mathematics)",n.Msg.LOGIC_COMPARE_TOOLTIP_EQ="Return true if both inputs equal each other.",n.Msg.LOGIC_COMPARE_TOOLTIP_GT="Return true if the first input is greater than the second input.",n.Msg.LOGIC_COMPARE_TOOLTIP_GTE="Return true if the first input is greater than or equal to the second input.",n.Msg.LOGIC_COMPARE_TOOLTIP_LT="Return true if the first input is smaller than the second input.",n.Msg.LOGIC_COMPARE_TOOLTIP_LTE="Return true if the first input is smaller than or equal to the second input.",n.Msg.LOGIC_COMPARE_TOOLTIP_NEQ="Return true if both inputs are not equal to each other.",n.Msg.LOGIC_NEGATE_HELPURL="https://github.com/google/blockly/wiki/Logic#not",n.Msg.LOGIC_NEGATE_TITLE="not %1",n.Msg.LOGIC_NEGATE_TOOLTIP="Returns true if the input is false. Returns false if the input is true.",n.Msg.LOGIC_NULL="null",n.Msg.LOGIC_NULL_HELPURL="https://en.wikipedia.org/wiki/Nullable_type",n.Msg.LOGIC_NULL_TOOLTIP="Returns null.",n.Msg.LOGIC_OPERATION_AND="and",n.Msg.LOGIC_OPERATION_HELPURL="https://github.com/google/blockly/wiki/Logic#logical-operations",n.Msg.LOGIC_OPERATION_OR="or",n.Msg.LOGIC_OPERATION_TOOLTIP_AND="Return true if both inputs are true.",n.Msg.LOGIC_OPERATION_TOOLTIP_OR="Return true if at least one of the inputs is true.",n.Msg.LOGIC_TERNARY_CONDITION="test",n.Msg.LOGIC_TERNARY_HELPURL="https://en.wikipedia.org/wiki/%3F:",n.Msg.LOGIC_TERNARY_IF_FALSE="if false",n.Msg.LOGIC_TERNARY_IF_TRUE="if true",n.Msg.LOGIC_TERNARY_TOOLTIP="Check the condition in 'test'. If the condition is true, returns the 'if true' value; otherwise returns the 'if false' value.",n.Msg.MATH_ADDITION_SYMBOL="+",n.Msg.MATH_ARITHMETIC_HELPURL="https://en.wikipedia.org/wiki/Arithmetic",n.Msg.MATH_ARITHMETIC_TOOLTIP_ADD="Return the sum of the two numbers.",n.Msg.MATH_ARITHMETIC_TOOLTIP_DIVIDE="Return the quotient of the two numbers.",n.Msg.MATH_ARITHMETIC_TOOLTIP_MINUS="Return the difference of the two numbers.",n.Msg.MATH_ARITHMETIC_TOOLTIP_MULTIPLY="Return the product of the two numbers.",n.Msg.MATH_ARITHMETIC_TOOLTIP_POWER="Return the first number raised to the power of the second number.",n.Msg.MATH_ATAN2_HELPURL="https://en.wikipedia.org/wiki/Atan2",n.Msg.MATH_ATAN2_TITLE="atan2 of X:%1 Y:%2",n.Msg.MATH_ATAN2_TOOLTIP="Return the arctangent of point (X, Y) in degrees from -180 to 180.",n.Msg.MATH_CHANGE_HELPURL="https://en.wikipedia.org/wiki/Programming_idiom#Incrementing_a_counter",n.Msg.MATH_CHANGE_TITLE="change %1 by %2",n.Msg.MATH_CHANGE_TOOLTIP="Add a number to variable '%1'.",n.Msg.MATH_CONSTANT_HELPURL="https://en.wikipedia.org/wiki/Mathematical_constant",n.Msg.MATH_CONSTANT_TOOLTIP="Return one of the common constants: π (3.141…), e (2.718…), φ (1.618…), sqrt(2) (1.414…), sqrt(½) (0.707…), or ∞ (infinity).",n.Msg.MATH_CONSTRAIN_HELPURL="https://en.wikipedia.org/wiki/Clamping_(graphics)",n.Msg.MATH_CONSTRAIN_TITLE="constrain %1 low %2 high %3",n.Msg.MATH_CONSTRAIN_TOOLTIP="Constrain a number to be between the specified limits (inclusive).",n.Msg.MATH_DIVISION_SYMBOL="÷",n.Msg.MATH_IS_DIVISIBLE_BY="is divisible by",n.Msg.MATH_IS_EVEN="is even",n.Msg.MATH_IS_NEGATIVE="is negative",n.Msg.MATH_IS_ODD="is odd",n.Msg.MATH_IS_POSITIVE="is positive",n.Msg.MATH_IS_PRIME="is prime",n.Msg.MATH_IS_TOOLTIP="Check if a number is an even, odd, prime, whole, positive, negative, or if it is divisible by certain number. Returns true or false.",n.Msg.MATH_IS_WHOLE="is whole",n.Msg.MATH_MODULO_HELPURL="https://en.wikipedia.org/wiki/Modulo_operation",n.Msg.MATH_MODULO_TITLE="remainder of %1 ÷ %2",n.Msg.MATH_MODULO_TOOLTIP="Return the remainder from dividing the two numbers.",n.Msg.MATH_MULTIPLICATION_SYMBOL="×",n.Msg.MATH_NUMBER_HELPURL="https://en.wikipedia.org/wiki/Number",n.Msg.MATH_NUMBER_TOOLTIP="A number.",n.Msg.MATH_ONLIST_HELPURL="",n.Msg.MATH_ONLIST_OPERATOR_AVERAGE="average of list",n.Msg.MATH_ONLIST_OPERATOR_MAX="max of list",n.Msg.MATH_ONLIST_OPERATOR_MEDIAN="median of list",n.Msg.MATH_ONLIST_OPERATOR_MIN="min of list",n.Msg.MATH_ONLIST_OPERATOR_MODE="modes of list",n.Msg.MATH_ONLIST_OPERATOR_RANDOM="random item of list",n.Msg.MATH_ONLIST_OPERATOR_STD_DEV="standard deviation of list",n.Msg.MATH_ONLIST_OPERATOR_SUM="sum of list",n.Msg.MATH_ONLIST_TOOLTIP_AVERAGE="Return the average (arithmetic mean) of the numeric values in the list.",n.Msg.MATH_ONLIST_TOOLTIP_MAX="Return the largest number in the list.",n.Msg.MATH_ONLIST_TOOLTIP_MEDIAN="Return the median number in the list.",n.Msg.MATH_ONLIST_TOOLTIP_MIN="Return the smallest number in the list.",n.Msg.MATH_ONLIST_TOOLTIP_MODE="Return a list of the most common item(s) in the list.",n.Msg.MATH_ONLIST_TOOLTIP_RANDOM="Return a random element from the list.",n.Msg.MATH_ONLIST_TOOLTIP_STD_DEV="Return the standard deviation of the list.",n.Msg.MATH_ONLIST_TOOLTIP_SUM="Return the sum of all the numbers in the list.",n.Msg.MATH_POWER_SYMBOL="^",n.Msg.MATH_RANDOM_FLOAT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",n.Msg.MATH_RANDOM_FLOAT_TITLE_RANDOM="random fraction",n.Msg.MATH_RANDOM_FLOAT_TOOLTIP="Return a random fraction between 0.0 (inclusive) and 1.0 (exclusive).",n.Msg.MATH_RANDOM_INT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",n.Msg.MATH_RANDOM_INT_TITLE="random integer from %1 to %2",n.Msg.MATH_RANDOM_INT_TOOLTIP="Return a random integer between the two specified limits, inclusive.",n.Msg.MATH_ROUND_HELPURL="https://en.wikipedia.org/wiki/Rounding",n.Msg.MATH_ROUND_OPERATOR_ROUND="round",n.Msg.MATH_ROUND_OPERATOR_ROUNDDOWN="round down",n.Msg.MATH_ROUND_OPERATOR_ROUNDUP="round up",n.Msg.MATH_ROUND_TOOLTIP="Round a number up or down.",n.Msg.MATH_SINGLE_HELPURL="https://en.wikipedia.org/wiki/Square_root",n.Msg.MATH_SINGLE_OP_ABSOLUTE="absolute",n.Msg.MATH_SINGLE_OP_ROOT="square root",n.Msg.MATH_SINGLE_TOOLTIP_ABS="Return the absolute value of a number.",n.Msg.MATH_SINGLE_TOOLTIP_EXP="Return e to the power of a number.",n.Msg.MATH_SINGLE_TOOLTIP_LN="Return the natural logarithm of a number.",n.Msg.MATH_SINGLE_TOOLTIP_LOG10="Return the base 10 logarithm of a number.",n.Msg.MATH_SINGLE_TOOLTIP_NEG="Return the negation of a number.",n.Msg.MATH_SINGLE_TOOLTIP_POW10="Return 10 to the power of a number.",n.Msg.MATH_SINGLE_TOOLTIP_ROOT="Return the square root of a number.",n.Msg.MATH_SUBTRACTION_SYMBOL="-",n.Msg.MATH_TRIG_ACOS="acos",n.Msg.MATH_TRIG_ASIN="asin",n.Msg.MATH_TRIG_ATAN="atan",n.Msg.MATH_TRIG_COS="cos",n.Msg.MATH_TRIG_HELPURL="https://en.wikipedia.org/wiki/Trigonometric_functions",n.Msg.MATH_TRIG_SIN="sin",n.Msg.MATH_TRIG_TAN="tan",n.Msg.MATH_TRIG_TOOLTIP_ACOS="Return the arccosine of a number.",n.Msg.MATH_TRIG_TOOLTIP_ASIN="Return the arcsine of a number.",n.Msg.MATH_TRIG_TOOLTIP_ATAN="Return the arctangent of a number.",n.Msg.MATH_TRIG_TOOLTIP_COS="Return the cosine of a degree (not radian).",n.Msg.MATH_TRIG_TOOLTIP_SIN="Return the sine of a degree (not radian).",n.Msg.MATH_TRIG_TOOLTIP_TAN="Return the tangent of a degree (not radian).",n.Msg.NEW_COLOUR_VARIABLE="Create colour variable...",n.Msg.NEW_NUMBER_VARIABLE="Create number variable...",n.Msg.NEW_STRING_VARIABLE="Create string variable...",n.Msg.NEW_VARIABLE="Create variable...",n.Msg.NEW_VARIABLE_TITLE="New variable name:",n.Msg.NEW_VARIABLE_TYPE_TITLE="New variable type:",n.Msg.ORDINAL_NUMBER_SUFFIX="",n.Msg.PROCEDURES_ALLOW_STATEMENTS="allow statements",n.Msg.PROCEDURES_BEFORE_PARAMS="with:",n.Msg.PROCEDURES_CALLNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",n.Msg.PROCEDURES_CALLNORETURN_TOOLTIP="Run the user-defined function '%1'.",n.Msg.PROCEDURES_CALLRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",n.Msg.PROCEDURES_CALLRETURN_TOOLTIP="Run the user-defined function '%1' and use its output.",n.Msg.PROCEDURES_CALL_BEFORE_PARAMS="with:",n.Msg.PROCEDURES_CALL_DISABLED_DEF_WARNING="Can't run the user-defined function '%1' because the definition block is disabled.",n.Msg.PROCEDURES_CREATE_DO="Create '%1'",n.Msg.PROCEDURES_DEFNORETURN_COMMENT="Describe this function...",n.Msg.PROCEDURES_DEFNORETURN_DO="",n.Msg.PROCEDURES_DEFNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",n.Msg.PROCEDURES_DEFNORETURN_PROCEDURE="do something",n.Msg.PROCEDURES_DEFNORETURN_TITLE="to",n.Msg.PROCEDURES_DEFNORETURN_TOOLTIP="Creates a function with no output.",n.Msg.PROCEDURES_DEFRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",n.Msg.PROCEDURES_DEFRETURN_RETURN="return",n.Msg.PROCEDURES_DEFRETURN_TOOLTIP="Creates a function with an output.",n.Msg.PROCEDURES_DEF_DUPLICATE_WARNING="Warning: This function has duplicate parameters.",n.Msg.PROCEDURES_HIGHLIGHT_DEF="Highlight function definition",n.Msg.PROCEDURES_IFRETURN_HELPURL="https://c2.com/cgi/wiki?GuardClause",n.Msg.PROCEDURES_IFRETURN_TOOLTIP="If a value is true, then return a second value.",n.Msg.PROCEDURES_IFRETURN_WARNING="Warning: This block may be used only within a function definition.",n.Msg.PROCEDURES_MUTATORARG_TITLE="input name:",n.Msg.PROCEDURES_MUTATORARG_TOOLTIP="Add an input to the function.",n.Msg.PROCEDURES_MUTATORCONTAINER_TITLE="inputs",n.Msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP="Add, remove, or reorder inputs to this function.",n.Msg.REDO="Redo",n.Msg.REMOVE_COMMENT="Remove Comment",n.Msg.RENAME_VARIABLE="Rename variable...",n.Msg.RENAME_VARIABLE_TITLE="Rename all '%1' variables to:",n.Msg.TEXT_APPEND_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",n.Msg.TEXT_APPEND_TITLE="to %1 append text %2",n.Msg.TEXT_APPEND_TOOLTIP="Append some text to variable '%1'.",n.Msg.TEXT_CHANGECASE_HELPURL="https://github.com/google/blockly/wiki/Text#adjusting-text-case",n.Msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE="to lower case",n.Msg.TEXT_CHANGECASE_OPERATOR_TITLECASE="to Title Case",n.Msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE="to UPPER CASE",n.Msg.TEXT_CHANGECASE_TOOLTIP="Return a copy of the text in a different case.",n.Msg.TEXT_CHARAT_FIRST="get first letter",n.Msg.TEXT_CHARAT_FROM_END="get letter # from end",n.Msg.TEXT_CHARAT_FROM_START="get letter #",n.Msg.TEXT_CHARAT_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-text",n.Msg.TEXT_CHARAT_LAST="get last letter",n.Msg.TEXT_CHARAT_RANDOM="get random letter",n.Msg.TEXT_CHARAT_TAIL="",n.Msg.TEXT_CHARAT_TITLE="in text %1 %2",n.Msg.TEXT_CHARAT_TOOLTIP="Returns the letter at the specified position.",n.Msg.TEXT_COUNT_HELPURL="https://github.com/google/blockly/wiki/Text#counting-substrings",n.Msg.TEXT_COUNT_MESSAGE0="count %1 in %2",n.Msg.TEXT_COUNT_TOOLTIP="Count how many times some text occurs within some other text.",n.Msg.TEXT_CREATE_JOIN_ITEM_TOOLTIP="Add an item to the text.",n.Msg.TEXT_CREATE_JOIN_TITLE_JOIN="join",n.Msg.TEXT_CREATE_JOIN_TOOLTIP="Add, remove, or reorder sections to reconfigure this text block.",n.Msg.TEXT_GET_SUBSTRING_END_FROM_END="to letter # from end",n.Msg.TEXT_GET_SUBSTRING_END_FROM_START="to letter #",n.Msg.TEXT_GET_SUBSTRING_END_LAST="to last letter",n.Msg.TEXT_GET_SUBSTRING_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-a-region-of-text",n.Msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT="in text",n.Msg.TEXT_GET_SUBSTRING_START_FIRST="get substring from first letter",n.Msg.TEXT_GET_SUBSTRING_START_FROM_END="get substring from letter # from end",n.Msg.TEXT_GET_SUBSTRING_START_FROM_START="get substring from letter #",n.Msg.TEXT_GET_SUBSTRING_TAIL="",n.Msg.TEXT_GET_SUBSTRING_TOOLTIP="Returns a specified portion of the text.",n.Msg.TEXT_INDEXOF_HELPURL="https://github.com/google/blockly/wiki/Text#finding-text",n.Msg.TEXT_INDEXOF_OPERATOR_FIRST="find first occurrence of text",n.Msg.TEXT_INDEXOF_OPERATOR_LAST="find last occurrence of text",n.Msg.TEXT_INDEXOF_TITLE="in text %1 %2 %3",n.Msg.TEXT_INDEXOF_TOOLTIP="Returns the index of the first/last occurrence of the first text in the second text. Returns %1 if text is not found.",n.Msg.TEXT_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Text#checking-for-empty-text",n.Msg.TEXT_ISEMPTY_TITLE="%1 is empty",n.Msg.TEXT_ISEMPTY_TOOLTIP="Returns true if the provided text is empty.",n.Msg.TEXT_JOIN_HELPURL="https://github.com/google/blockly/wiki/Text#text-creation",n.Msg.TEXT_JOIN_TITLE_CREATEWITH="create text with",n.Msg.TEXT_JOIN_TOOLTIP="Create a piece of text by joining together any number of items.",n.Msg.TEXT_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",n.Msg.TEXT_LENGTH_TITLE="length of %1",n.Msg.TEXT_LENGTH_TOOLTIP="Returns the number of letters (including spaces) in the provided text.",n.Msg.TEXT_PRINT_HELPURL="https://github.com/google/blockly/wiki/Text#printing-text",n.Msg.TEXT_PRINT_TITLE="print %1",n.Msg.TEXT_PRINT_TOOLTIP="Print the specified text, number or other value.",n.Msg.TEXT_PROMPT_HELPURL="https://github.com/google/blockly/wiki/Text#getting-input-from-the-user",n.Msg.TEXT_PROMPT_TOOLTIP_NUMBER="Prompt for user for a number.",n.Msg.TEXT_PROMPT_TOOLTIP_TEXT="Prompt for user for some text.",n.Msg.TEXT_PROMPT_TYPE_NUMBER="prompt for number with message",n.Msg.TEXT_PROMPT_TYPE_TEXT="prompt for text with message",n.Msg.TEXT_REPLACE_HELPURL="https://github.com/google/blockly/wiki/Text#replacing-substrings",n.Msg.TEXT_REPLACE_MESSAGE0="replace %1 with %2 in %3",n.Msg.TEXT_REPLACE_TOOLTIP="Replace all occurances of some text within some other text.",n.Msg.TEXT_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Text#reversing-text",n.Msg.TEXT_REVERSE_MESSAGE0="reverse %1",n.Msg.TEXT_REVERSE_TOOLTIP="Reverses the order of the characters in the text.",n.Msg.TEXT_TEXT_HELPURL="https://en.wikipedia.org/wiki/String_(computer_science)",n.Msg.TEXT_TEXT_TOOLTIP="A letter, word, or line of text.",n.Msg.TEXT_TRIM_HELPURL="https://github.com/google/blockly/wiki/Text#trimming-removing-spaces",n.Msg.TEXT_TRIM_OPERATOR_BOTH="trim spaces from both sides of",n.Msg.TEXT_TRIM_OPERATOR_LEFT="trim spaces from left side of",n.Msg.TEXT_TRIM_OPERATOR_RIGHT="trim spaces from right side of",n.Msg.TEXT_TRIM_TOOLTIP="Return a copy of the text with spaces removed from one or both ends.",n.Msg.TODAY="Today",n.Msg.UNDO="Undo",n.Msg.UNNAMED_KEY="unnamed",n.Msg.VARIABLES_DEFAULT_NAME="item",n.Msg.VARIABLES_GET_CREATE_SET="Create 'set %1'",n.Msg.VARIABLES_GET_HELPURL="https://github.com/google/blockly/wiki/Variables#get",n.Msg.VARIABLES_GET_TOOLTIP="Returns the value of this variable.",n.Msg.VARIABLES_SET="set %1 to %2",n.Msg.VARIABLES_SET_CREATE_GET="Create 'get %1'",n.Msg.VARIABLES_SET_HELPURL="https://github.com/google/blockly/wiki/Variables#set",n.Msg.VARIABLES_SET_TOOLTIP="Sets this variable to be equal to the input.",n.Msg.VARIABLE_ALREADY_EXISTS="A variable named '%1' already exists.",n.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE="A variable named '%1' already exists for another type: '%2'.",n.Msg.VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER="A variable named '%1' already exists as a parameter in the procedure '%2'.",n.Msg.WORKSPACE_ARIA_LABEL="Blockly Workspace",n.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT="Say something...",n.Msg.CONTROLS_FOREACH_INPUT_DO=n.Msg.CONTROLS_REPEAT_INPUT_DO,n.Msg.CONTROLS_FOR_INPUT_DO=n.Msg.CONTROLS_REPEAT_INPUT_DO,n.Msg.CONTROLS_IF_ELSEIF_TITLE_ELSEIF=n.Msg.CONTROLS_IF_MSG_ELSEIF,n.Msg.CONTROLS_IF_ELSE_TITLE_ELSE=n.Msg.CONTROLS_IF_MSG_ELSE,n.Msg.CONTROLS_IF_IF_TITLE_IF=n.Msg.CONTROLS_IF_MSG_IF,n.Msg.CONTROLS_IF_MSG_THEN=n.Msg.CONTROLS_REPEAT_INPUT_DO,n.Msg.CONTROLS_WHILEUNTIL_INPUT_DO=n.Msg.CONTROLS_REPEAT_INPUT_DO,n.Msg.LISTS_CREATE_WITH_ITEM_TITLE=n.Msg.VARIABLES_DEFAULT_NAME,n.Msg.LISTS_GET_INDEX_INPUT_IN_LIST=n.Msg.LISTS_INLIST,n.Msg.LISTS_GET_SUBLIST_INPUT_IN_LIST=n.Msg.LISTS_INLIST,n.Msg.LISTS_INDEX_OF_INPUT_IN_LIST=n.Msg.LISTS_INLIST,n.Msg.LISTS_SET_INDEX_INPUT_IN_LIST=n.Msg.LISTS_INLIST,n.Msg.MATH_CHANGE_TITLE_ITEM=n.Msg.VARIABLES_DEFAULT_NAME,n.Msg.PROCEDURES_DEFRETURN_COMMENT=n.Msg.PROCEDURES_DEFNORETURN_COMMENT,n.Msg.PROCEDURES_DEFRETURN_DO=n.Msg.PROCEDURES_DEFNORETURN_DO,n.Msg.PROCEDURES_DEFRETURN_PROCEDURE=n.Msg.PROCEDURES_DEFNORETURN_PROCEDURE,n.Msg.PROCEDURES_DEFRETURN_TITLE=n.Msg.PROCEDURES_DEFNORETURN_TITLE,n.Msg.TEXT_APPEND_VARIABLE=n.Msg.VARIABLES_DEFAULT_NAME,n.Msg.TEXT_CREATE_JOIN_ITEM_TITLE_ITEM=n.Msg.VARIABLES_DEFAULT_NAME,n.Msg.COLOUR_HUE="20",n.Msg.LISTS_HUE="260",n.Msg.LOGIC_HUE="210",n.Msg.LOOPS_HUE="120",n.Msg.MATH_HUE="230",n.Msg.PROCEDURES_HUE="290",n.Msg.TEXTS_HUE="160",n.Msg.VARIABLES_DYNAMIC_HUE="310",n.Msg.VARIABLES_HUE="330",n.Msg})})(w2);var Dq=w2.exports;const Bq=hd(Dq),{LOGIC_HUE:Fq,LOOPS_HUE:Uq,MATH_HUE:Gq,TEXTS_HUE:Hq,LISTS_HUE:Vq,COLOUR_HUE:zq,VARIABLES_HUE:Wq,VARIABLES_DYNAMIC_HUE:Xq,PROCEDURES_HUE:jq,VARIABLES_DEFAULT_NAME:Yq,UNNAMED_KEY:Kq,TODAY:Jq,DUPLICATE_BLOCK:Zq,ADD_COMMENT:qq,REMOVE_COMMENT:Qq,DUPLICATE_COMMENT:eQ,EXTERNAL_INPUTS:tQ,INLINE_INPUTS:nQ,DELETE_BLOCK:iQ,DELETE_X_BLOCKS:rQ,DELETE_ALL_BLOCKS:sQ,CLEAN_UP:oQ,COLLAPSE_BLOCK:aQ,COLLAPSE_ALL:lQ,EXPAND_BLOCK:cQ,EXPAND_ALL:uQ,DISABLE_BLOCK:hQ,ENABLE_BLOCK:dQ,HELP:fQ,UNDO:pQ,REDO:mQ,CHANGE_VALUE_TITLE:gQ,RENAME_VARIABLE:_Q,RENAME_VARIABLE_TITLE:vQ,NEW_VARIABLE:TQ,NEW_STRING_VARIABLE:EQ,NEW_NUMBER_VARIABLE:yQ,NEW_COLOUR_VARIABLE:SQ,NEW_VARIABLE_TYPE_TITLE:$Q,NEW_VARIABLE_TITLE:bQ,VARIABLE_ALREADY_EXISTS:AQ,VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE:CQ,VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER:xQ,DELETE_VARIABLE_CONFIRMATION:RQ,CANNOT_DELETE_VARIABLE_PROCEDURE:wQ,DELETE_VARIABLE:MQ,COLOUR_PICKER_HELPURL:IQ,COLOUR_PICKER_TOOLTIP:OQ,COLOUR_RANDOM_HELPURL:LQ,COLOUR_RANDOM_TITLE:NQ,COLOUR_RANDOM_TOOLTIP:kQ,COLOUR_RGB_HELPURL:PQ,COLOUR_RGB_TITLE:DQ,COLOUR_RGB_RED:BQ,COLOUR_RGB_GREEN:FQ,COLOUR_RGB_BLUE:UQ,COLOUR_RGB_TOOLTIP:GQ,COLOUR_BLEND_HELPURL:HQ,COLOUR_BLEND_TITLE:VQ,COLOUR_BLEND_COLOUR1:zQ,COLOUR_BLEND_COLOUR2:WQ,COLOUR_BLEND_RATIO:XQ,COLOUR_BLEND_TOOLTIP:jQ,CONTROLS_REPEAT_HELPURL:YQ,CONTROLS_REPEAT_TITLE:KQ,CONTROLS_REPEAT_INPUT_DO:JQ,CONTROLS_REPEAT_TOOLTIP:ZQ,CONTROLS_WHILEUNTIL_HELPURL:qQ,CONTROLS_WHILEUNTIL_INPUT_DO:QQ,CONTROLS_WHILEUNTIL_OPERATOR_WHILE:eee,CONTROLS_WHILEUNTIL_OPERATOR_UNTIL:tee,CONTROLS_WHILEUNTIL_TOOLTIP_WHILE:nee,CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL:iee,CONTROLS_FOR_HELPURL:ree,CONTROLS_FOR_TOOLTIP:see,CONTROLS_FOR_TITLE:oee,CONTROLS_FOR_INPUT_DO:aee,CONTROLS_FOREACH_HELPURL:lee,CONTROLS_FOREACH_TITLE:cee,CONTROLS_FOREACH_INPUT_DO:uee,CONTROLS_FOREACH_TOOLTIP:hee,CONTROLS_FLOW_STATEMENTS_HELPURL:dee,CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK:fee,CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE:pee,CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK:mee,CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE:gee,CONTROLS_FLOW_STATEMENTS_WARNING:_ee,CONTROLS_IF_HELPURL:vee,CONTROLS_IF_TOOLTIP_1:Tee,CONTROLS_IF_TOOLTIP_2:Eee,CONTROLS_IF_TOOLTIP_3:yee,CONTROLS_IF_TOOLTIP_4:See,CONTROLS_IF_MSG_IF:$ee,CONTROLS_IF_MSG_ELSEIF:bee,CONTROLS_IF_MSG_ELSE:Aee,CONTROLS_IF_MSG_THEN:Cee,CONTROLS_IF_IF_TITLE_IF:xee,CONTROLS_IF_IF_TOOLTIP:Ree,CONTROLS_IF_ELSEIF_TITLE_ELSEIF:wee,CONTROLS_IF_ELSEIF_TOOLTIP:Mee,CONTROLS_IF_ELSE_TITLE_ELSE:Iee,CONTROLS_IF_ELSE_TOOLTIP:Oee,LOGIC_COMPARE_HELPURL:Lee,LOGIC_COMPARE_TOOLTIP_EQ:Nee,LOGIC_COMPARE_TOOLTIP_NEQ:kee,LOGIC_COMPARE_TOOLTIP_LT:Pee,LOGIC_COMPARE_TOOLTIP_LTE:Dee,LOGIC_COMPARE_TOOLTIP_GT:Bee,LOGIC_COMPARE_TOOLTIP_GTE:Fee,LOGIC_OPERATION_HELPURL:Uee,LOGIC_OPERATION_TOOLTIP_AND:Gee,LOGIC_OPERATION_AND:Hee,LOGIC_OPERATION_TOOLTIP_OR:Vee,LOGIC_OPERATION_OR:zee,LOGIC_NEGATE_HELPURL:Wee,LOGIC_NEGATE_TITLE:Xee,LOGIC_NEGATE_TOOLTIP:jee,LOGIC_BOOLEAN_HELPURL:Yee,LOGIC_BOOLEAN_TRUE:Kee,LOGIC_BOOLEAN_FALSE:Jee,LOGIC_BOOLEAN_TOOLTIP:Zee,LOGIC_NULL_HELPURL:qee,LOGIC_NULL:Qee,LOGIC_NULL_TOOLTIP:ete,LOGIC_TERNARY_HELPURL:tte,LOGIC_TERNARY_CONDITION:nte,LOGIC_TERNARY_IF_TRUE:ite,LOGIC_TERNARY_IF_FALSE:rte,LOGIC_TERNARY_TOOLTIP:ste,MATH_NUMBER_HELPURL:ote,MATH_NUMBER_TOOLTIP:ate,MATH_ADDITION_SYMBOL:lte,MATH_SUBTRACTION_SYMBOL:cte,MATH_DIVISION_SYMBOL:ute,MATH_MULTIPLICATION_SYMBOL:hte,MATH_POWER_SYMBOL:dte,MATH_TRIG_SIN:fte,MATH_TRIG_COS:pte,MATH_TRIG_TAN:mte,MATH_TRIG_ASIN:gte,MATH_TRIG_ACOS:_te,MATH_TRIG_ATAN:vte,MATH_ARITHMETIC_HELPURL:Tte,MATH_ARITHMETIC_TOOLTIP_ADD:Ete,MATH_ARITHMETIC_TOOLTIP_MINUS:yte,MATH_ARITHMETIC_TOOLTIP_MULTIPLY:Ste,MATH_ARITHMETIC_TOOLTIP_DIVIDE:$te,MATH_ARITHMETIC_TOOLTIP_POWER:bte,MATH_SINGLE_HELPURL:Ate,MATH_SINGLE_OP_ROOT:Cte,MATH_SINGLE_TOOLTIP_ROOT:xte,MATH_SINGLE_OP_ABSOLUTE:Rte,MATH_SINGLE_TOOLTIP_ABS:wte,MATH_SINGLE_TOOLTIP_NEG:Mte,MATH_SINGLE_TOOLTIP_LN:Ite,MATH_SINGLE_TOOLTIP_LOG10:Ote,MATH_SINGLE_TOOLTIP_EXP:Lte,MATH_SINGLE_TOOLTIP_POW10:Nte,MATH_TRIG_HELPURL:kte,MATH_TRIG_TOOLTIP_SIN:Pte,MATH_TRIG_TOOLTIP_COS:Dte,MATH_TRIG_TOOLTIP_TAN:Bte,MATH_TRIG_TOOLTIP_ASIN:Fte,MATH_TRIG_TOOLTIP_ACOS:Ute,MATH_TRIG_TOOLTIP_ATAN:Gte,MATH_CONSTANT_HELPURL:Hte,MATH_CONSTANT_TOOLTIP:Vte,MATH_IS_EVEN:zte,MATH_IS_ODD:Wte,MATH_IS_PRIME:Xte,MATH_IS_WHOLE:jte,MATH_IS_POSITIVE:Yte,MATH_IS_NEGATIVE:Kte,MATH_IS_DIVISIBLE_BY:Jte,MATH_IS_TOOLTIP:Zte,MATH_CHANGE_HELPURL:qte,MATH_CHANGE_TITLE:Qte,MATH_CHANGE_TITLE_ITEM:ene,MATH_CHANGE_TOOLTIP:tne,MATH_ROUND_HELPURL:nne,MATH_ROUND_TOOLTIP:ine,MATH_ROUND_OPERATOR_ROUND:rne,MATH_ROUND_OPERATOR_ROUNDUP:sne,MATH_ROUND_OPERATOR_ROUNDDOWN:one,MATH_ONLIST_HELPURL:ane,MATH_ONLIST_OPERATOR_SUM:lne,MATH_ONLIST_TOOLTIP_SUM:cne,MATH_ONLIST_OPERATOR_MIN:une,MATH_ONLIST_TOOLTIP_MIN:hne,MATH_ONLIST_OPERATOR_MAX:dne,MATH_ONLIST_TOOLTIP_MAX:fne,MATH_ONLIST_OPERATOR_AVERAGE:pne,MATH_ONLIST_TOOLTIP_AVERAGE:mne,MATH_ONLIST_OPERATOR_MEDIAN:gne,MATH_ONLIST_TOOLTIP_MEDIAN:_ne,MATH_ONLIST_OPERATOR_MODE:vne,MATH_ONLIST_TOOLTIP_MODE:Tne,MATH_ONLIST_OPERATOR_STD_DEV:Ene,MATH_ONLIST_TOOLTIP_STD_DEV:yne,MATH_ONLIST_OPERATOR_RANDOM:Sne,MATH_ONLIST_TOOLTIP_RANDOM:$ne,MATH_MODULO_HELPURL:bne,MATH_MODULO_TITLE:Ane,MATH_MODULO_TOOLTIP:Cne,MATH_CONSTRAIN_HELPURL:xne,MATH_CONSTRAIN_TITLE:Rne,MATH_CONSTRAIN_TOOLTIP:wne,MATH_RANDOM_INT_HELPURL:Mne,MATH_RANDOM_INT_TITLE:Ine,MATH_RANDOM_INT_TOOLTIP:One,MATH_RANDOM_FLOAT_HELPURL:Lne,MATH_RANDOM_FLOAT_TITLE_RANDOM:Nne,MATH_RANDOM_FLOAT_TOOLTIP:kne,MATH_ATAN2_HELPURL:Pne,MATH_ATAN2_TITLE:Dne,MATH_ATAN2_TOOLTIP:Bne,TEXT_TEXT_HELPURL:Fne,TEXT_TEXT_TOOLTIP:Une,TEXT_JOIN_HELPURL:Gne,TEXT_JOIN_TITLE_CREATEWITH:Hne,TEXT_JOIN_TOOLTIP:Vne,TEXT_CREATE_JOIN_TITLE_JOIN:zne,TEXT_CREATE_JOIN_TOOLTIP:Wne,TEXT_CREATE_JOIN_ITEM_TITLE_ITEM:Xne,TEXT_CREATE_JOIN_ITEM_TOOLTIP:jne,TEXT_APPEND_HELPURL:Yne,TEXT_APPEND_TITLE:Kne,TEXT_APPEND_VARIABLE:Jne,TEXT_APPEND_TOOLTIP:Zne,TEXT_LENGTH_HELPURL:qne,TEXT_LENGTH_TITLE:Qne,TEXT_LENGTH_TOOLTIP:eie,TEXT_ISEMPTY_HELPURL:tie,TEXT_ISEMPTY_TITLE:nie,TEXT_ISEMPTY_TOOLTIP:iie,TEXT_INDEXOF_HELPURL:rie,TEXT_INDEXOF_TOOLTIP:sie,TEXT_INDEXOF_TITLE:oie,TEXT_INDEXOF_OPERATOR_FIRST:aie,TEXT_INDEXOF_OPERATOR_LAST:lie,TEXT_CHARAT_HELPURL:cie,TEXT_CHARAT_TITLE:uie,TEXT_CHARAT_FROM_START:hie,TEXT_CHARAT_FROM_END:die,TEXT_CHARAT_FIRST:fie,TEXT_CHARAT_LAST:pie,TEXT_CHARAT_RANDOM:mie,TEXT_CHARAT_TAIL:gie,TEXT_CHARAT_TOOLTIP:_ie,TEXT_GET_SUBSTRING_TOOLTIP:vie,TEXT_GET_SUBSTRING_HELPURL:Tie,TEXT_GET_SUBSTRING_INPUT_IN_TEXT:Eie,TEXT_GET_SUBSTRING_START_FROM_START:yie,TEXT_GET_SUBSTRING_START_FROM_END:Sie,TEXT_GET_SUBSTRING_START_FIRST:$ie,TEXT_GET_SUBSTRING_END_FROM_START:bie,TEXT_GET_SUBSTRING_END_FROM_END:Aie,TEXT_GET_SUBSTRING_END_LAST:Cie,TEXT_GET_SUBSTRING_TAIL:xie,TEXT_CHANGECASE_HELPURL:Rie,TEXT_CHANGECASE_TOOLTIP:wie,TEXT_CHANGECASE_OPERATOR_UPPERCASE:Mie,TEXT_CHANGECASE_OPERATOR_LOWERCASE:Iie,TEXT_CHANGECASE_OPERATOR_TITLECASE:Oie,TEXT_TRIM_HELPURL:Lie,TEXT_TRIM_TOOLTIP:Nie,TEXT_TRIM_OPERATOR_BOTH:kie,TEXT_TRIM_OPERATOR_LEFT:Pie,TEXT_TRIM_OPERATOR_RIGHT:Die,TEXT_PRINT_HELPURL:Bie,TEXT_PRINT_TITLE:Fie,TEXT_PRINT_TOOLTIP:Uie,TEXT_PROMPT_HELPURL:Gie,TEXT_PROMPT_TYPE_TEXT:Hie,TEXT_PROMPT_TYPE_NUMBER:Vie,TEXT_PROMPT_TOOLTIP_NUMBER:zie,TEXT_PROMPT_TOOLTIP_TEXT:Wie,TEXT_COUNT_MESSAGE0:Xie,TEXT_COUNT_HELPURL:jie,TEXT_COUNT_TOOLTIP:Yie,TEXT_REPLACE_MESSAGE0:Kie,TEXT_REPLACE_HELPURL:Jie,TEXT_REPLACE_TOOLTIP:Zie,TEXT_REVERSE_MESSAGE0:qie,TEXT_REVERSE_HELPURL:Qie,TEXT_REVERSE_TOOLTIP:ere,LISTS_CREATE_EMPTY_HELPURL:tre,LISTS_CREATE_EMPTY_TITLE:nre,LISTS_CREATE_EMPTY_TOOLTIP:ire,LISTS_CREATE_WITH_HELPURL:rre,LISTS_CREATE_WITH_TOOLTIP:sre,LISTS_CREATE_WITH_INPUT_WITH:ore,LISTS_CREATE_WITH_CONTAINER_TITLE_ADD:are,LISTS_CREATE_WITH_CONTAINER_TOOLTIP:lre,LISTS_CREATE_WITH_ITEM_TITLE:cre,LISTS_CREATE_WITH_ITEM_TOOLTIP:ure,LISTS_REPEAT_HELPURL:hre,LISTS_REPEAT_TOOLTIP:dre,LISTS_REPEAT_TITLE:fre,LISTS_LENGTH_HELPURL:pre,LISTS_LENGTH_TITLE:mre,LISTS_LENGTH_TOOLTIP:gre,LISTS_ISEMPTY_HELPURL:_re,LISTS_ISEMPTY_TITLE:vre,LISTS_ISEMPTY_TOOLTIP:Tre,LISTS_INLIST:Ere,LISTS_INDEX_OF_HELPURL:yre,LISTS_INDEX_OF_INPUT_IN_LIST:Sre,LISTS_INDEX_OF_FIRST:$re,LISTS_INDEX_OF_LAST:bre,LISTS_INDEX_OF_TOOLTIP:Are,LISTS_GET_INDEX_HELPURL:Cre,LISTS_GET_INDEX_GET:xre,LISTS_GET_INDEX_GET_REMOVE:Rre,LISTS_GET_INDEX_REMOVE:wre,LISTS_GET_INDEX_FROM_START:Mre,LISTS_GET_INDEX_FROM_END:Ire,LISTS_GET_INDEX_FIRST:Ore,LISTS_GET_INDEX_LAST:Lre,LISTS_GET_INDEX_RANDOM:Nre,LISTS_GET_INDEX_TAIL:kre,LISTS_GET_INDEX_INPUT_IN_LIST:Pre,LISTS_INDEX_FROM_START_TOOLTIP:Dre,LISTS_INDEX_FROM_END_TOOLTIP:Bre,LISTS_GET_INDEX_TOOLTIP_GET_FROM:Fre,LISTS_GET_INDEX_TOOLTIP_GET_FIRST:Ure,LISTS_GET_INDEX_TOOLTIP_GET_LAST:Gre,LISTS_GET_INDEX_TOOLTIP_GET_RANDOM:Hre,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM:Vre,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST:zre,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST:Wre,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM:Xre,LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM:jre,LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST:Yre,LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST:Kre,LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM:Jre,LISTS_SET_INDEX_HELPURL:Zre,LISTS_SET_INDEX_INPUT_IN_LIST:qre,LISTS_SET_INDEX_SET:Qre,LISTS_SET_INDEX_INSERT:ese,LISTS_SET_INDEX_INPUT_TO:tse,LISTS_SET_INDEX_TOOLTIP_SET_FROM:nse,LISTS_SET_INDEX_TOOLTIP_SET_FIRST:ise,LISTS_SET_INDEX_TOOLTIP_SET_LAST:rse,LISTS_SET_INDEX_TOOLTIP_SET_RANDOM:sse,LISTS_SET_INDEX_TOOLTIP_INSERT_FROM:ose,LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST:ase,LISTS_SET_INDEX_TOOLTIP_INSERT_LAST:lse,LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM:cse,LISTS_GET_SUBLIST_HELPURL:use,LISTS_GET_SUBLIST_INPUT_IN_LIST:hse,LISTS_GET_SUBLIST_START_FROM_START:dse,LISTS_GET_SUBLIST_START_FROM_END:fse,LISTS_GET_SUBLIST_START_FIRST:pse,LISTS_GET_SUBLIST_END_FROM_START:mse,LISTS_GET_SUBLIST_END_FROM_END:gse,LISTS_GET_SUBLIST_END_LAST:_se,LISTS_GET_SUBLIST_TAIL:vse,LISTS_GET_SUBLIST_TOOLTIP:Tse,LISTS_SORT_HELPURL:Ese,LISTS_SORT_TITLE:yse,LISTS_SORT_TOOLTIP:Sse,LISTS_SORT_ORDER_ASCENDING:$se,LISTS_SORT_ORDER_DESCENDING:bse,LISTS_SORT_TYPE_NUMERIC:Ase,LISTS_SORT_TYPE_TEXT:Cse,LISTS_SORT_TYPE_IGNORECASE:xse,LISTS_SPLIT_HELPURL:Rse,LISTS_SPLIT_LIST_FROM_TEXT:wse,LISTS_SPLIT_TEXT_FROM_LIST:Mse,LISTS_SPLIT_WITH_DELIMITER:Ise,LISTS_SPLIT_TOOLTIP_SPLIT:Ose,LISTS_SPLIT_TOOLTIP_JOIN:Lse,LISTS_REVERSE_HELPURL:Nse,LISTS_REVERSE_MESSAGE0:kse,LISTS_REVERSE_TOOLTIP:Pse,ORDINAL_NUMBER_SUFFIX:Dse,VARIABLES_GET_HELPURL:Bse,VARIABLES_GET_TOOLTIP:Fse,VARIABLES_GET_CREATE_SET:Use,VARIABLES_SET_HELPURL:Gse,VARIABLES_SET:Hse,VARIABLES_SET_TOOLTIP:Vse,VARIABLES_SET_CREATE_GET:zse,PROCEDURES_DEFNORETURN_HELPURL:Wse,PROCEDURES_DEFNORETURN_TITLE:Xse,PROCEDURES_DEFNORETURN_PROCEDURE:jse,PROCEDURES_BEFORE_PARAMS:Yse,PROCEDURES_CALL_BEFORE_PARAMS:Kse,PROCEDURES_CALL_DISABLED_DEF_WARNING:Jse,PROCEDURES_DEFNORETURN_DO:Zse,PROCEDURES_DEFNORETURN_TOOLTIP:qse,PROCEDURES_DEFNORETURN_COMMENT:Qse,PROCEDURES_DEFRETURN_HELPURL:eoe,PROCEDURES_DEFRETURN_TITLE:toe,PROCEDURES_DEFRETURN_PROCEDURE:noe,PROCEDURES_DEFRETURN_DO:ioe,PROCEDURES_DEFRETURN_COMMENT:roe,PROCEDURES_DEFRETURN_RETURN:soe,PROCEDURES_DEFRETURN_TOOLTIP:ooe,PROCEDURES_ALLOW_STATEMENTS:aoe,PROCEDURES_DEF_DUPLICATE_WARNING:loe,PROCEDURES_CALLNORETURN_HELPURL:coe,PROCEDURES_CALLNORETURN_TOOLTIP:uoe,PROCEDURES_CALLRETURN_HELPURL:hoe,PROCEDURES_CALLRETURN_TOOLTIP:doe,PROCEDURES_MUTATORCONTAINER_TITLE:foe,PROCEDURES_MUTATORCONTAINER_TOOLTIP:poe,PROCEDURES_MUTATORARG_TITLE:moe,PROCEDURES_MUTATORARG_TOOLTIP:goe,PROCEDURES_HIGHLIGHT_DEF:_oe,PROCEDURES_CREATE_DO:voe,PROCEDURES_IFRETURN_TOOLTIP:Toe,PROCEDURES_IFRETURN_HELPURL:Eoe,PROCEDURES_IFRETURN_WARNING:yoe,WORKSPACE_COMMENT_DEFAULT_TEXT:Soe,WORKSPACE_ARIA_LABEL:$oe,COLLAPSED_WARNINGS_WARNING:boe,DIALOG_OK:Aoe,DIALOG_CANCEL:Coe}=Bq,xoe=Object.freeze(Object.defineProperty({__proto__:null,ADD_COMMENT:qq,CANNOT_DELETE_VARIABLE_PROCEDURE:wQ,CHANGE_VALUE_TITLE:gQ,CLEAN_UP:oQ,COLLAPSED_WARNINGS_WARNING:boe,COLLAPSE_ALL:lQ,COLLAPSE_BLOCK:aQ,COLOUR_BLEND_COLOUR1:zQ,COLOUR_BLEND_COLOUR2:WQ,COLOUR_BLEND_HELPURL:HQ,COLOUR_BLEND_RATIO:XQ,COLOUR_BLEND_TITLE:VQ,COLOUR_BLEND_TOOLTIP:jQ,COLOUR_HUE:zq,COLOUR_PICKER_HELPURL:IQ,COLOUR_PICKER_TOOLTIP:OQ,COLOUR_RANDOM_HELPURL:LQ,COLOUR_RANDOM_TITLE:NQ,COLOUR_RANDOM_TOOLTIP:kQ,COLOUR_RGB_BLUE:UQ,COLOUR_RGB_GREEN:FQ,COLOUR_RGB_HELPURL:PQ,COLOUR_RGB_RED:BQ,COLOUR_RGB_TITLE:DQ,COLOUR_RGB_TOOLTIP:GQ,CONTROLS_FLOW_STATEMENTS_HELPURL:dee,CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK:fee,CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE:pee,CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK:mee,CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE:gee,CONTROLS_FLOW_STATEMENTS_WARNING:_ee,CONTROLS_FOREACH_HELPURL:lee,CONTROLS_FOREACH_INPUT_DO:uee,CONTROLS_FOREACH_TITLE:cee,CONTROLS_FOREACH_TOOLTIP:hee,CONTROLS_FOR_HELPURL:ree,CONTROLS_FOR_INPUT_DO:aee,CONTROLS_FOR_TITLE:oee,CONTROLS_FOR_TOOLTIP:see,CONTROLS_IF_ELSEIF_TITLE_ELSEIF:wee,CONTROLS_IF_ELSEIF_TOOLTIP:Mee,CONTROLS_IF_ELSE_TITLE_ELSE:Iee,CONTROLS_IF_ELSE_TOOLTIP:Oee,CONTROLS_IF_HELPURL:vee,CONTROLS_IF_IF_TITLE_IF:xee,CONTROLS_IF_IF_TOOLTIP:Ree,CONTROLS_IF_MSG_ELSE:Aee,CONTROLS_IF_MSG_ELSEIF:bee,CONTROLS_IF_MSG_IF:$ee,CONTROLS_IF_MSG_THEN:Cee,CONTROLS_IF_TOOLTIP_1:Tee,CONTROLS_IF_TOOLTIP_2:Eee,CONTROLS_IF_TOOLTIP_3:yee,CONTROLS_IF_TOOLTIP_4:See,CONTROLS_REPEAT_HELPURL:YQ,CONTROLS_REPEAT_INPUT_DO:JQ,CONTROLS_REPEAT_TITLE:KQ,CONTROLS_REPEAT_TOOLTIP:ZQ,CONTROLS_WHILEUNTIL_HELPURL:qQ,CONTROLS_WHILEUNTIL_INPUT_DO:QQ,CONTROLS_WHILEUNTIL_OPERATOR_UNTIL:tee,CONTROLS_WHILEUNTIL_OPERATOR_WHILE:eee,CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL:iee,CONTROLS_WHILEUNTIL_TOOLTIP_WHILE:nee,DELETE_ALL_BLOCKS:sQ,DELETE_BLOCK:iQ,DELETE_VARIABLE:MQ,DELETE_VARIABLE_CONFIRMATION:RQ,DELETE_X_BLOCKS:rQ,DIALOG_CANCEL:Coe,DIALOG_OK:Aoe,DISABLE_BLOCK:hQ,DUPLICATE_BLOCK:Zq,DUPLICATE_COMMENT:eQ,ENABLE_BLOCK:dQ,EXPAND_ALL:uQ,EXPAND_BLOCK:cQ,EXTERNAL_INPUTS:tQ,HELP:fQ,INLINE_INPUTS:nQ,LISTS_CREATE_EMPTY_HELPURL:tre,LISTS_CREATE_EMPTY_TITLE:nre,LISTS_CREATE_EMPTY_TOOLTIP:ire,LISTS_CREATE_WITH_CONTAINER_TITLE_ADD:are,LISTS_CREATE_WITH_CONTAINER_TOOLTIP:lre,LISTS_CREATE_WITH_HELPURL:rre,LISTS_CREATE_WITH_INPUT_WITH:ore,LISTS_CREATE_WITH_ITEM_TITLE:cre,LISTS_CREATE_WITH_ITEM_TOOLTIP:ure,LISTS_CREATE_WITH_TOOLTIP:sre,LISTS_GET_INDEX_FIRST:Ore,LISTS_GET_INDEX_FROM_END:Ire,LISTS_GET_INDEX_FROM_START:Mre,LISTS_GET_INDEX_GET:xre,LISTS_GET_INDEX_GET_REMOVE:Rre,LISTS_GET_INDEX_HELPURL:Cre,LISTS_GET_INDEX_INPUT_IN_LIST:Pre,LISTS_GET_INDEX_LAST:Lre,LISTS_GET_INDEX_RANDOM:Nre,LISTS_GET_INDEX_REMOVE:wre,LISTS_GET_INDEX_TAIL:kre,LISTS_GET_INDEX_TOOLTIP_GET_FIRST:Ure,LISTS_GET_INDEX_TOOLTIP_GET_FROM:Fre,LISTS_GET_INDEX_TOOLTIP_GET_LAST:Gre,LISTS_GET_INDEX_TOOLTIP_GET_RANDOM:Hre,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST:zre,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM:Vre,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST:Wre,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM:Xre,LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST:Yre,LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM:jre,LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST:Kre,LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM:Jre,LISTS_GET_SUBLIST_END_FROM_END:gse,LISTS_GET_SUBLIST_END_FROM_START:mse,LISTS_GET_SUBLIST_END_LAST:_se,LISTS_GET_SUBLIST_HELPURL:use,LISTS_GET_SUBLIST_INPUT_IN_LIST:hse,LISTS_GET_SUBLIST_START_FIRST:pse,LISTS_GET_SUBLIST_START_FROM_END:fse,LISTS_GET_SUBLIST_START_FROM_START:dse,LISTS_GET_SUBLIST_TAIL:vse,LISTS_GET_SUBLIST_TOOLTIP:Tse,LISTS_HUE:Vq,LISTS_INDEX_FROM_END_TOOLTIP:Bre,LISTS_INDEX_FROM_START_TOOLTIP:Dre,LISTS_INDEX_OF_FIRST:$re,LISTS_INDEX_OF_HELPURL:yre,LISTS_INDEX_OF_INPUT_IN_LIST:Sre,LISTS_INDEX_OF_LAST:bre,LISTS_INDEX_OF_TOOLTIP:Are,LISTS_INLIST:Ere,LISTS_ISEMPTY_HELPURL:_re,LISTS_ISEMPTY_TITLE:vre,LISTS_ISEMPTY_TOOLTIP:Tre,LISTS_LENGTH_HELPURL:pre,LISTS_LENGTH_TITLE:mre,LISTS_LENGTH_TOOLTIP:gre,LISTS_REPEAT_HELPURL:hre,LISTS_REPEAT_TITLE:fre,LISTS_REPEAT_TOOLTIP:dre,LISTS_REVERSE_HELPURL:Nse,LISTS_REVERSE_MESSAGE0:kse,LISTS_REVERSE_TOOLTIP:Pse,LISTS_SET_INDEX_HELPURL:Zre,LISTS_SET_INDEX_INPUT_IN_LIST:qre,LISTS_SET_INDEX_INPUT_TO:tse,LISTS_SET_INDEX_INSERT:ese,LISTS_SET_INDEX_SET:Qre,LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST:ase,LISTS_SET_INDEX_TOOLTIP_INSERT_FROM:ose,LISTS_SET_INDEX_TOOLTIP_INSERT_LAST:lse,LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM:cse,LISTS_SET_INDEX_TOOLTIP_SET_FIRST:ise,LISTS_SET_INDEX_TOOLTIP_SET_FROM:nse,LISTS_SET_INDEX_TOOLTIP_SET_LAST:rse,LISTS_SET_INDEX_TOOLTIP_SET_RANDOM:sse,LISTS_SORT_HELPURL:Ese,LISTS_SORT_ORDER_ASCENDING:$se,LISTS_SORT_ORDER_DESCENDING:bse,LISTS_SORT_TITLE:yse,LISTS_SORT_TOOLTIP:Sse,LISTS_SORT_TYPE_IGNORECASE:xse,LISTS_SORT_TYPE_NUMERIC:Ase,LISTS_SORT_TYPE_TEXT:Cse,LISTS_SPLIT_HELPURL:Rse,LISTS_SPLIT_LIST_FROM_TEXT:wse,LISTS_SPLIT_TEXT_FROM_LIST:Mse,LISTS_SPLIT_TOOLTIP_JOIN:Lse,LISTS_SPLIT_TOOLTIP_SPLIT:Ose,LISTS_SPLIT_WITH_DELIMITER:Ise,LOGIC_BOOLEAN_FALSE:Jee,LOGIC_BOOLEAN_HELPURL:Yee,LOGIC_BOOLEAN_TOOLTIP:Zee,LOGIC_BOOLEAN_TRUE:Kee,LOGIC_COMPARE_HELPURL:Lee,LOGIC_COMPARE_TOOLTIP_EQ:Nee,LOGIC_COMPARE_TOOLTIP_GT:Bee,LOGIC_COMPARE_TOOLTIP_GTE:Fee,LOGIC_COMPARE_TOOLTIP_LT:Pee,LOGIC_COMPARE_TOOLTIP_LTE:Dee,LOGIC_COMPARE_TOOLTIP_NEQ:kee,LOGIC_HUE:Fq,LOGIC_NEGATE_HELPURL:Wee,LOGIC_NEGATE_TITLE:Xee,LOGIC_NEGATE_TOOLTIP:jee,LOGIC_NULL:Qee,LOGIC_NULL_HELPURL:qee,LOGIC_NULL_TOOLTIP:ete,LOGIC_OPERATION_AND:Hee,LOGIC_OPERATION_HELPURL:Uee,LOGIC_OPERATION_OR:zee,LOGIC_OPERATION_TOOLTIP_AND:Gee,LOGIC_OPERATION_TOOLTIP_OR:Vee,LOGIC_TERNARY_CONDITION:nte,LOGIC_TERNARY_HELPURL:tte,LOGIC_TERNARY_IF_FALSE:rte,LOGIC_TERNARY_IF_TRUE:ite,LOGIC_TERNARY_TOOLTIP:ste,LOOPS_HUE:Uq,MATH_ADDITION_SYMBOL:lte,MATH_ARITHMETIC_HELPURL:Tte,MATH_ARITHMETIC_TOOLTIP_ADD:Ete,MATH_ARITHMETIC_TOOLTIP_DIVIDE:$te,MATH_ARITHMETIC_TOOLTIP_MINUS:yte,MATH_ARITHMETIC_TOOLTIP_MULTIPLY:Ste,MATH_ARITHMETIC_TOOLTIP_POWER:bte,MATH_ATAN2_HELPURL:Pne,MATH_ATAN2_TITLE:Dne,MATH_ATAN2_TOOLTIP:Bne,MATH_CHANGE_HELPURL:qte,MATH_CHANGE_TITLE:Qte,MATH_CHANGE_TITLE_ITEM:ene,MATH_CHANGE_TOOLTIP:tne,MATH_CONSTANT_HELPURL:Hte,MATH_CONSTANT_TOOLTIP:Vte,MATH_CONSTRAIN_HELPURL:xne,MATH_CONSTRAIN_TITLE:Rne,MATH_CONSTRAIN_TOOLTIP:wne,MATH_DIVISION_SYMBOL:ute,MATH_HUE:Gq,MATH_IS_DIVISIBLE_BY:Jte,MATH_IS_EVEN:zte,MATH_IS_NEGATIVE:Kte,MATH_IS_ODD:Wte,MATH_IS_POSITIVE:Yte,MATH_IS_PRIME:Xte,MATH_IS_TOOLTIP:Zte,MATH_IS_WHOLE:jte,MATH_MODULO_HELPURL:bne,MATH_MODULO_TITLE:Ane,MATH_MODULO_TOOLTIP:Cne,MATH_MULTIPLICATION_SYMBOL:hte,MATH_NUMBER_HELPURL:ote,MATH_NUMBER_TOOLTIP:ate,MATH_ONLIST_HELPURL:ane,MATH_ONLIST_OPERATOR_AVERAGE:pne,MATH_ONLIST_OPERATOR_MAX:dne,MATH_ONLIST_OPERATOR_MEDIAN:gne,MATH_ONLIST_OPERATOR_MIN:une,MATH_ONLIST_OPERATOR_MODE:vne,MATH_ONLIST_OPERATOR_RANDOM:Sne,MATH_ONLIST_OPERATOR_STD_DEV:Ene,MATH_ONLIST_OPERATOR_SUM:lne,MATH_ONLIST_TOOLTIP_AVERAGE:mne,MATH_ONLIST_TOOLTIP_MAX:fne,MATH_ONLIST_TOOLTIP_MEDIAN:_ne,MATH_ONLIST_TOOLTIP_MIN:hne,MATH_ONLIST_TOOLTIP_MODE:Tne,MATH_ONLIST_TOOLTIP_RANDOM:$ne,MATH_ONLIST_TOOLTIP_STD_DEV:yne,MATH_ONLIST_TOOLTIP_SUM:cne,MATH_POWER_SYMBOL:dte,MATH_RANDOM_FLOAT_HELPURL:Lne,MATH_RANDOM_FLOAT_TITLE_RANDOM:Nne,MATH_RANDOM_FLOAT_TOOLTIP:kne,MATH_RANDOM_INT_HELPURL:Mne,MATH_RANDOM_INT_TITLE:Ine,MATH_RANDOM_INT_TOOLTIP:One,MATH_ROUND_HELPURL:nne,MATH_ROUND_OPERATOR_ROUND:rne,MATH_ROUND_OPERATOR_ROUNDDOWN:one,MATH_ROUND_OPERATOR_ROUNDUP:sne,MATH_ROUND_TOOLTIP:ine,MATH_SINGLE_HELPURL:Ate,MATH_SINGLE_OP_ABSOLUTE:Rte,MATH_SINGLE_OP_ROOT:Cte,MATH_SINGLE_TOOLTIP_ABS:wte,MATH_SINGLE_TOOLTIP_EXP:Lte,MATH_SINGLE_TOOLTIP_LN:Ite,MATH_SINGLE_TOOLTIP_LOG10:Ote,MATH_SINGLE_TOOLTIP_NEG:Mte,MATH_SINGLE_TOOLTIP_POW10:Nte,MATH_SINGLE_TOOLTIP_ROOT:xte,MATH_SUBTRACTION_SYMBOL:cte,MATH_TRIG_ACOS:_te,MATH_TRIG_ASIN:gte,MATH_TRIG_ATAN:vte,MATH_TRIG_COS:pte,MATH_TRIG_HELPURL:kte,MATH_TRIG_SIN:fte,MATH_TRIG_TAN:mte,MATH_TRIG_TOOLTIP_ACOS:Ute,MATH_TRIG_TOOLTIP_ASIN:Fte,MATH_TRIG_TOOLTIP_ATAN:Gte,MATH_TRIG_TOOLTIP_COS:Dte,MATH_TRIG_TOOLTIP_SIN:Pte,MATH_TRIG_TOOLTIP_TAN:Bte,NEW_COLOUR_VARIABLE:SQ,NEW_NUMBER_VARIABLE:yQ,NEW_STRING_VARIABLE:EQ,NEW_VARIABLE:TQ,NEW_VARIABLE_TITLE:bQ,NEW_VARIABLE_TYPE_TITLE:$Q,ORDINAL_NUMBER_SUFFIX:Dse,PROCEDURES_ALLOW_STATEMENTS:aoe,PROCEDURES_BEFORE_PARAMS:Yse,PROCEDURES_CALLNORETURN_HELPURL:coe,PROCEDURES_CALLNORETURN_TOOLTIP:uoe,PROCEDURES_CALLRETURN_HELPURL:hoe,PROCEDURES_CALLRETURN_TOOLTIP:doe,PROCEDURES_CALL_BEFORE_PARAMS:Kse,PROCEDURES_CALL_DISABLED_DEF_WARNING:Jse,PROCEDURES_CREATE_DO:voe,PROCEDURES_DEFNORETURN_COMMENT:Qse,PROCEDURES_DEFNORETURN_DO:Zse,PROCEDURES_DEFNORETURN_HELPURL:Wse,PROCEDURES_DEFNORETURN_PROCEDURE:jse,PROCEDURES_DEFNORETURN_TITLE:Xse,PROCEDURES_DEFNORETURN_TOOLTIP:qse,PROCEDURES_DEFRETURN_COMMENT:roe,PROCEDURES_DEFRETURN_DO:ioe,PROCEDURES_DEFRETURN_HELPURL:eoe,PROCEDURES_DEFRETURN_PROCEDURE:noe,PROCEDURES_DEFRETURN_RETURN:soe,PROCEDURES_DEFRETURN_TITLE:toe,PROCEDURES_DEFRETURN_TOOLTIP:ooe,PROCEDURES_DEF_DUPLICATE_WARNING:loe,PROCEDURES_HIGHLIGHT_DEF:_oe,PROCEDURES_HUE:jq,PROCEDURES_IFRETURN_HELPURL:Eoe,PROCEDURES_IFRETURN_TOOLTIP:Toe,PROCEDURES_IFRETURN_WARNING:yoe,PROCEDURES_MUTATORARG_TITLE:moe,PROCEDURES_MUTATORARG_TOOLTIP:goe,PROCEDURES_MUTATORCONTAINER_TITLE:foe,PROCEDURES_MUTATORCONTAINER_TOOLTIP:poe,REDO:mQ,REMOVE_COMMENT:Qq,RENAME_VARIABLE:_Q,RENAME_VARIABLE_TITLE:vQ,TEXTS_HUE:Hq,TEXT_APPEND_HELPURL:Yne,TEXT_APPEND_TITLE:Kne,TEXT_APPEND_TOOLTIP:Zne,TEXT_APPEND_VARIABLE:Jne,TEXT_CHANGECASE_HELPURL:Rie,TEXT_CHANGECASE_OPERATOR_LOWERCASE:Iie,TEXT_CHANGECASE_OPERATOR_TITLECASE:Oie,TEXT_CHANGECASE_OPERATOR_UPPERCASE:Mie,TEXT_CHANGECASE_TOOLTIP:wie,TEXT_CHARAT_FIRST:fie,TEXT_CHARAT_FROM_END:die,TEXT_CHARAT_FROM_START:hie,TEXT_CHARAT_HELPURL:cie,TEXT_CHARAT_LAST:pie,TEXT_CHARAT_RANDOM:mie,TEXT_CHARAT_TAIL:gie,TEXT_CHARAT_TITLE:uie,TEXT_CHARAT_TOOLTIP:_ie,TEXT_COUNT_HELPURL:jie,TEXT_COUNT_MESSAGE0:Xie,TEXT_COUNT_TOOLTIP:Yie,TEXT_CREATE_JOIN_ITEM_TITLE_ITEM:Xne,TEXT_CREATE_JOIN_ITEM_TOOLTIP:jne,TEXT_CREATE_JOIN_TITLE_JOIN:zne,TEXT_CREATE_JOIN_TOOLTIP:Wne,TEXT_GET_SUBSTRING_END_FROM_END:Aie,TEXT_GET_SUBSTRING_END_FROM_START:bie,TEXT_GET_SUBSTRING_END_LAST:Cie,TEXT_GET_SUBSTRING_HELPURL:Tie,TEXT_GET_SUBSTRING_INPUT_IN_TEXT:Eie,TEXT_GET_SUBSTRING_START_FIRST:$ie,TEXT_GET_SUBSTRING_START_FROM_END:Sie,TEXT_GET_SUBSTRING_START_FROM_START:yie,TEXT_GET_SUBSTRING_TAIL:xie,TEXT_GET_SUBSTRING_TOOLTIP:vie,TEXT_INDEXOF_HELPURL:rie,TEXT_INDEXOF_OPERATOR_FIRST:aie,TEXT_INDEXOF_OPERATOR_LAST:lie,TEXT_INDEXOF_TITLE:oie,TEXT_INDEXOF_TOOLTIP:sie,TEXT_ISEMPTY_HELPURL:tie,TEXT_ISEMPTY_TITLE:nie,TEXT_ISEMPTY_TOOLTIP:iie,TEXT_JOIN_HELPURL:Gne,TEXT_JOIN_TITLE_CREATEWITH:Hne,TEXT_JOIN_TOOLTIP:Vne,TEXT_LENGTH_HELPURL:qne,TEXT_LENGTH_TITLE:Qne,TEXT_LENGTH_TOOLTIP:eie,TEXT_PRINT_HELPURL:Bie,TEXT_PRINT_TITLE:Fie,TEXT_PRINT_TOOLTIP:Uie,TEXT_PROMPT_HELPURL:Gie,TEXT_PROMPT_TOOLTIP_NUMBER:zie,TEXT_PROMPT_TOOLTIP_TEXT:Wie,TEXT_PROMPT_TYPE_NUMBER:Vie,TEXT_PROMPT_TYPE_TEXT:Hie,TEXT_REPLACE_HELPURL:Jie,TEXT_REPLACE_MESSAGE0:Kie,TEXT_REPLACE_TOOLTIP:Zie,TEXT_REVERSE_HELPURL:Qie,TEXT_REVERSE_MESSAGE0:qie,TEXT_REVERSE_TOOLTIP:ere,TEXT_TEXT_HELPURL:Fne,TEXT_TEXT_TOOLTIP:Une,TEXT_TRIM_HELPURL:Lie,TEXT_TRIM_OPERATOR_BOTH:kie,TEXT_TRIM_OPERATOR_LEFT:Pie,TEXT_TRIM_OPERATOR_RIGHT:Die,TEXT_TRIM_TOOLTIP:Nie,TODAY:Jq,UNDO:pQ,UNNAMED_KEY:Kq,VARIABLES_DEFAULT_NAME:Yq,VARIABLES_DYNAMIC_HUE:Xq,VARIABLES_GET_CREATE_SET:Use,VARIABLES_GET_HELPURL:Bse,VARIABLES_GET_TOOLTIP:Fse,VARIABLES_HUE:Wq,VARIABLES_SET:Hse,VARIABLES_SET_CREATE_GET:zse,VARIABLES_SET_HELPURL:Gse,VARIABLES_SET_TOOLTIP:Vse,VARIABLE_ALREADY_EXISTS:AQ,VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE:CQ,VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER:xQ,WORKSPACE_ARIA_LABEL:$oe,WORKSPACE_COMMENT_DEFAULT_TEXT:Soe},Symbol.toStringTag,{value:"Module"}));var Roe={exports:{}};(function(i,e){(function(n,r){i.exports=r(lI())})(qf,function(n){var r=n.__namespace__,s=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get_dynamic",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_dynamic_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableDynamicSetterGetter"]},{type:"variables_set_dynamic",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_dynamic_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableDynamicSetterGetter"]}]),a={customContextMenu:function(L){if(this.isInFlyout)(this.type==="variables_get_dynamic"||this.type==="variables_get_reporter_dynamic")&&(fe={text:r.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:l(this)},z=this.getField("VAR").getText(),z={text:r.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",z),enabled:!0,callback:u(this)},L.unshift(fe),L.unshift(z));else{if(this.type==="variables_get_dynamic")var X="variables_set_dynamic",fe=r.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET;else X="variables_get_dynamic",fe=r.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET;var z=this.getField("VAR");X={type:X,fields:{VAR:z.saveState(!0)}},L.push({enabled:0<this.workspace.remainingCapacity(),text:fe.replace("%1",z.getText()),callback:r.callbackFactory$$module$build$src$core$contextmenu(this,X)})}},onchange:function(L){L=this.getFieldValue("VAR"),L=r.getVariable$$module$build$src$core$variables(this.workspace,L),this.type==="variables_get_dynamic"?this.outputConnection.setCheck(L.type):this.getInput("VALUE").connection.setCheck(L.type)}},l=function(L){return function(){const X=L.workspace,fe=L.getField("VAR").getVariable();r.renameVariable$$module$build$src$core$variables(X,fe)}},u=function(L){return function(){const X=L.workspace,fe=L.getField("VAR").getVariable();X.deleteVariableById(fe.getId()),X.refreshToolboxSelection()}};r.registerMixin$$module$build$src$core$extensions("contextMenu_variableDynamicSetterGetter",a),r.defineBlocks$$module$build$src$core$common(s);var d={blocks:s},h=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableSetterGetter"]},{type:"variables_set",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableSetterGetter"]}]),f={customContextMenu:function(L){if(this.isInFlyout)(this.type==="variables_get"||this.type==="variables_get_reporter")&&(fe={text:r.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:p(this)},z=this.getField("VAR").getText(),z={text:r.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",z),enabled:!0,callback:m(this)},L.unshift(fe),L.unshift(z));else{if(this.type==="variables_get")var X="variables_set",fe=r.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET;else X="variables_get",fe=r.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET;var z=this.getField("VAR");X={type:X,fields:{VAR:z.saveState(!0)}},L.push({enabled:0<this.workspace.remainingCapacity(),text:fe.replace("%1",z.getText()),callback:r.callbackFactory$$module$build$src$core$contextmenu(this,X)})}}},p=function(L){return function(){const X=L.workspace,fe=L.getField("VAR").getVariable();r.renameVariable$$module$build$src$core$variables(X,fe)}},m=function(L){return function(){const X=L.workspace,fe=L.getField("VAR").getVariable();X.deleteVariableById(fe.getId()),X.refreshToolboxSelection()}};r.registerMixin$$module$build$src$core$extensions("contextMenu_variableSetterGetter",f),r.defineBlocks$$module$build$src$core$common(h);var T={blocks:h},E=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"text",message0:"%1",args0:[{type:"field_input",name:"TEXT",text:""}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["text_quotes","parent_tooltip_when_inline"]},{type:"text_join",message0:"",output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_JOIN_HELPURL}",tooltip:"%{BKY_TEXT_JOIN_TOOLTIP}",mutator:"text_join_mutator"},{type:"text_create_join_container",message0:"%{BKY_TEXT_CREATE_JOIN_TITLE_JOIN} %1 %2",args0:[{type:"input_dummy"},{type:"input_statement",name:"STACK"}],style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_TOOLTIP}",enableContextMenu:!1},{type:"text_create_join_item",message0:"%{BKY_TEXT_CREATE_JOIN_ITEM_TITLE_ITEM}",previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_ITEM_TOOLTIP}",enableContextMenu:!1},{type:"text_append",message0:"%{BKY_TEXT_APPEND_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_TEXT_APPEND_VARIABLE}"},{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",extensions:["text_append_tooltip"]},{type:"text_length",message0:"%{BKY_TEXT_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"text_blocks",tooltip:"%{BKY_TEXT_LENGTH_TOOLTIP}",helpUrl:"%{BKY_TEXT_LENGTH_HELPURL}"},{type:"text_isEmpty",message0:"%{BKY_TEXT_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"text_blocks",tooltip:"%{BKY_TEXT_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_TEXT_ISEMPTY_HELPURL}"},{type:"text_indexOf",message0:"%{BKY_TEXT_INDEXOF_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"END",options:[["%{BKY_TEXT_INDEXOF_OPERATOR_FIRST}","FIRST"],["%{BKY_TEXT_INDEXOF_OPERATOR_LAST}","LAST"]]},{type:"input_value",name:"FIND",check:"String"}],output:"Number",style:"text_blocks",helpUrl:"%{BKY_TEXT_INDEXOF_HELPURL}",inputsInline:!0,extensions:["text_indexOf_tooltip"]},{type:"text_charAt",message0:"%{BKY_TEXT_CHARAT_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"WHERE",options:[["%{BKY_TEXT_CHARAT_FROM_START}","FROM_START"],["%{BKY_TEXT_CHARAT_FROM_END}","FROM_END"],["%{BKY_TEXT_CHARAT_FIRST}","FIRST"],["%{BKY_TEXT_CHARAT_LAST}","LAST"],["%{BKY_TEXT_CHARAT_RANDOM}","RANDOM"]]}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_CHARAT_HELPURL}",inputsInline:!0,mutator:"text_charAt_mutator"}]),b={init:function(){this.WHERE_OPTIONS_1=[[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_LAST,"LAST"]],this.setHelpUrl(r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("STRING").setCheck("String").appendField(r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT),this.appendDummyInput("AT1"),this.appendDummyInput("AT2"),r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&this.appendDummyInput("TAIL").appendField(r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL),this.setInputsInline(!0),this.setOutput(!0,"String"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TOOLTIP)},mutationToDom:function(){const L=r.createElement$$module$build$src$core$utils$xml("mutation");var X=this.getInput("AT1")instanceof r.ValueInput$$module$build$src$core$inputs$value_input;return L.setAttribute("at1",`${X}`),X=this.getInput("AT2")instanceof r.ValueInput$$module$build$src$core$inputs$value_input,L.setAttribute("at2",`${X}`),L},domToMutation:function(L){const X=L.getAttribute("at1")==="true";L=L.getAttribute("at2")==="true",this.updateAt_(1,X),this.updateAt_(2,L)},updateAt_:function(L,X){this.removeInput("AT"+L),this.removeInput("ORDINAL"+L,!0),X?(this.appendValueInput("AT"+L).setCheck("Number"),r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+L).appendField(r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+L),L===2&&r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL));const fe=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+L]});fe.setValidator(function(z){const Ae=z==="FROM_START"||z==="FROM_END";if(Ae!==X){const tt=this.getSourceBlock();return tt.updateAt_(L,Ae),tt.setFieldValue(z,"WHERE"+L),null}}),this.getInput("AT"+L).appendField(fe,"WHERE"+L),L===1&&(this.moveInputBefore("AT1","AT2"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","AT2"))}};E.text_getSubstring=b,E.text_changeCase={init:function(){const L=[[r.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE,"UPPERCASE"],[r.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE,"LOWERCASE"],[r.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_TITLECASE,"TITLECASE"]];this.setHelpUrl(r.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:L}),"CASE"),this.setOutput(!0,"String"),this.setTooltip(r.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_TOOLTIP)}},E.text_trim={init:function(){const L=[[r.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_BOTH,"BOTH"],[r.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_LEFT,"LEFT"],[r.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_RIGHT,"RIGHT"]];this.setHelpUrl(r.Msg$$module$build$src$core$msg.TEXT_TRIM_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:L}),"MODE"),this.setOutput(!0,"String"),this.setTooltip(r.Msg$$module$build$src$core$msg.TEXT_TRIM_TOOLTIP)}},E.text_print={init:function(){this.jsonInit({message0:r.Msg$$module$build$src$core$msg.TEXT_PRINT_TITLE,args0:[{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:r.Msg$$module$build$src$core$msg.TEXT_PRINT_TOOLTIP,helpUrl:r.Msg$$module$build$src$core$msg.TEXT_PRINT_HELPURL})}};var y={updateType_:function(L){this.outputConnection.setCheck(L==="NUMBER"?"Number":"String")},mutationToDom:function(){const L=r.createElement$$module$build$src$core$utils$xml("mutation");return L.setAttribute("type",this.getFieldValue("TYPE")),L},domToMutation:function(L){this.updateType_(L.getAttribute("type"))}};E.text_prompt_ext=Object.assign({},y,{init:function(){var L=[[r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(r.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),L=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:L}),L.setValidator(X=>{this.updateType_(X)}),this.appendValueInput("TEXT").appendField(L,"TYPE"),this.setOutput(!0,"String"),this.setTooltip(()=>this.getFieldValue("TYPE")==="TEXT"?r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER)}});var S=Object.assign({},y,{init:function(){this.mixin(A);var L=[[r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(r.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),L=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:L}),L.setValidator(X=>{this.updateType_(X)}),this.appendDummyInput().appendField(L,"TYPE").appendField(this.newQuote_(!0)).appendField(r.fromJson$$module$build$src$core$field_registry({type:"field_input",text:""}),"TEXT").appendField(this.newQuote_(!1)),this.setOutput(!0,"String"),this.setTooltip(()=>this.getFieldValue("TYPE")==="TEXT"?r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER)}});E.text_prompt=S,E.text_count={init:function(){this.jsonInit({message0:r.Msg$$module$build$src$core$msg.TEXT_COUNT_MESSAGE0,args0:[{type:"input_value",name:"SUB",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"Number",inputsInline:!0,style:"text_blocks",tooltip:r.Msg$$module$build$src$core$msg.TEXT_COUNT_TOOLTIP,helpUrl:r.Msg$$module$build$src$core$msg.TEXT_COUNT_HELPURL})}},E.text_replace={init:function(){this.jsonInit({message0:r.Msg$$module$build$src$core$msg.TEXT_REPLACE_MESSAGE0,args0:[{type:"input_value",name:"FROM",check:"String"},{type:"input_value",name:"TO",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:r.Msg$$module$build$src$core$msg.TEXT_REPLACE_TOOLTIP,helpUrl:r.Msg$$module$build$src$core$msg.TEXT_REPLACE_HELPURL})}},E.text_reverse={init:function(){this.jsonInit({message0:r.Msg$$module$build$src$core$msg.TEXT_REVERSE_MESSAGE0,args0:[{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:r.Msg$$module$build$src$core$msg.TEXT_REVERSE_TOOLTIP,helpUrl:r.Msg$$module$build$src$core$msg.TEXT_REVERSE_HELPURL})}};var A={QUOTE_IMAGE_LEFT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAn0lEQVQI1z3OMa5BURSF4f/cQhAKjUQhuQmFNwGJEUi0RKN5rU7FHKhpjEH3TEMtkdBSCY1EIv8r7nFX9e29V7EBAOvu7RPjwmWGH/VuF8CyN9/OAdvqIXYLvtRaNjx9mMTDyo+NjAN1HNcl9ZQ5oQMM3dgDUqDo1l8DzvwmtZN7mnD+PkmLa+4mhrxVA9fRowBWmVBhFy5gYEjKMfz9AylsaRRgGzvZAAAAAElFTkSuQmCC",QUOTE_IMAGE_RIGHT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAqUlEQVQI1z3KvUpCcRiA8ef9E4JNHhI0aFEacm1o0BsI0Slx8wa8gLauoDnoBhq7DcfWhggONDmJJgqCPA7neJ7p934EOOKOnM8Q7PDElo/4x4lFb2DmuUjcUzS3URnGib9qaPNbuXvBO3sGPHJDRG6fGVdMSeWDP2q99FQdFrz26Gu5Tq7dFMzUvbXy8KXeAj57cOklgA+u1B5AoslLtGIHQMaCVnwDnADZIFIrXsoXrgAAAABJRU5ErkJggg==",QUOTE_IMAGE_WIDTH:12,QUOTE_IMAGE_HEIGHT:12,quoteField_:function(L){for(let X=0,fe;fe=this.inputList[X];X++)for(let z=0,Ae;Ae=fe.fieldRow[z];z++)if(L===Ae.name){fe.insertFieldAt(z,this.newQuote_(!0)),fe.insertFieldAt(z+2,this.newQuote_(!1));return}console.warn('field named "'+L+'" not found in '+this.toDevString())},newQuote_:function(L){return L=this.RTL?!L:L,r.fromJson$$module$build$src$core$field_registry({type:"field_image",src:L?this.QUOTE_IMAGE_LEFT_DATAURI:this.QUOTE_IMAGE_RIGHT_DATAURI,width:this.QUOTE_IMAGE_WIDTH,height:this.QUOTE_IMAGE_HEIGHT,alt:L?"“":"”"})}},C=function(){this.mixin(A),this.quoteField_("TEXT")},R={itemCount_:0,mutationToDom:function(){const L=r.createElement$$module$build$src$core$utils$xml("mutation");return L.setAttribute("items",`${this.itemCount_}`),L},domToMutation:function(L){this.itemCount_=parseInt(L.getAttribute("items"),10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(L){this.itemCount_=L.itemCount,this.updateShape_()},decompose:function(L){const X=L.newBlock("text_create_join_container");X.initSvg();let fe=X.getInput("STACK").connection;for(let z=0;z<this.itemCount_;z++){const Ae=L.newBlock("text_create_join_item");Ae.initSvg(),fe.connect(Ae.previousConnection),fe=Ae.nextConnection}return X},compose:function(L){var X=L.getInputTargetBlock("STACK");for(L=[];X;)X.isInsertionMarker()||L.push(X.valueConnection_),X=X.getNextBlock();for(X=0;X<this.itemCount_;X++){const fe=this.getInput("ADD"+X).connection.targetConnection;fe&&!L.includes(fe)&&fe.disconnect()}for(this.itemCount_=L.length,this.updateShape_(),X=0;X<this.itemCount_;X++){let fe;(fe=L[X])==null||fe.reconnect(this,"ADD"+X)}},saveConnections:function(L){L=L.getInputTargetBlock("STACK");let X=0;for(;L;){if(L.isInsertionMarker()){L=L.getNextBlock();continue}const fe=this.getInput("ADD"+X);L.valueConnection_=fe&&fe.connection.targetConnection,L=L.getNextBlock(),X++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(this.newQuote_(!0)).appendField(this.newQuote_(!1));for(var L=0;L<this.itemCount_;L++)if(!this.getInput("ADD"+L)){const X=this.appendValueInput("ADD"+L).setAlign(r.Align$$module$build$src$core$inputs$align.RIGHT);L===0&&X.appendField(r.Msg$$module$build$src$core$msg.TEXT_JOIN_TITLE_CREATEWITH)}for(L=this.itemCount_;this.getInput("ADD"+L);L++)this.removeInput("ADD"+L)}},I=function(){this.mixin(A),this.itemCount_=2,this.updateShape_(),this.setMutator(new r.MutatorIcon$$module$build$src$core$icons$mutator_icon(["text_create_join_item"],this))};r.register$$module$build$src$core$extensions("text_append_tooltip",r.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_TEXT_APPEND_TOOLTIP}","VAR"));var O=function(){this.setTooltip(()=>r.Msg$$module$build$src$core$msg.TEXT_INDEXOF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1"))},F={isAt_:!1,mutationToDom:function(){const L=r.createElement$$module$build$src$core$utils$xml("mutation");return L.setAttribute("at",`${this.isAt_}`),L},domToMutation:function(L){L=L.getAttribute("at")!=="false",this.updateAt_(L)},updateAt_:function(L){this.removeInput("AT",!0),this.removeInput("ORDINAL",!0),L&&(this.appendValueInput("AT").setCheck("Number"),r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)),r.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(r.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL)),this.isAt_=L}},k=function(){this.getField("WHERE").setValidator(function(L){L=L==="FROM_START"||L==="FROM_END";const X=this.getSourceBlock();L!==X.isAt_&&X.updateAt_(L)}),this.updateAt_(!0),this.setTooltip(()=>{var L=this.getFieldValue("WHERE");let X=r.Msg$$module$build$src$core$msg.TEXT_CHARAT_TOOLTIP;return(L==="FROM_START"||L==="FROM_END")&&(L=L==="FROM_START"?r.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:r.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP)&&(X+="  "+L.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),X})};r.register$$module$build$src$core$extensions("text_indexOf_tooltip",O),r.register$$module$build$src$core$extensions("text_quotes",C),r.registerMixin$$module$build$src$core$extensions("quote_image_mixin",A),r.registerMutator$$module$build$src$core$extensions("text_join_mutator",R,I),r.registerMutator$$module$build$src$core$extensions("text_charAt_mutator",F,k),r.defineBlocks$$module$build$src$core$common(E);var D={blocks:E},U={},ce={setStatements_:function(L){this.hasStatements_!==L&&(L?(this.appendStatementInput("STACK").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_DO),this.getInput("RETURN")&&this.moveInputBefore("STACK","RETURN")):this.removeInput("STACK",!0),this.hasStatements_=L)},updateParams_:function(){let L="";this.arguments_.length&&(L=r.Msg$$module$build$src$core$msg.PROCEDURES_BEFORE_PARAMS+" "+this.arguments_.join(", ")),r.disable$$module$build$src$core$events$utils();try{this.setFieldValue(L,"PARAMS")}finally{r.enable$$module$build$src$core$events$utils()}},mutationToDom:function(L){const X=r.createElement$$module$build$src$core$utils$xml("mutation");L&&X.setAttribute("name",this.getFieldValue("NAME"));for(let fe=0;fe<this.argumentVarModels_.length;fe++){const z=r.createElement$$module$build$src$core$utils$xml("arg"),Ae=this.argumentVarModels_[fe];z.setAttribute("name",Ae.name),z.setAttribute("varid",Ae.getId()),L&&this.paramIds_&&z.setAttribute("paramId",this.paramIds_[fe]),X.appendChild(z)}return this.hasStatements_||X.setAttribute("statements","false"),X},domToMutation:function(L){this.arguments_=[],this.argumentVarModels_=[];for(let fe=0,z;z=L.childNodes[fe];fe++)if(z.nodeName.toLowerCase()==="arg"){var X=z;const Ae=X.getAttribute("name");X=X.getAttribute("varid")||X.getAttribute("varId"),this.arguments_.push(Ae),X=r.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,X,Ae,""),X!==null?this.argumentVarModels_.push(X):console.log(`Failed to create a variable named "${Ae}", ignoring.`)}this.updateParams_(),r.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_(L.getAttribute("statements")!=="false")},saveExtraState:function(){if(!this.argumentVarModels_.length&&this.hasStatements_)return null;const L=Object.create(null);if(this.argumentVarModels_.length){L.params=[];for(let X=0;X<this.argumentVarModels_.length;X++)L.params.push({name:this.argumentVarModels_[X].name,id:this.argumentVarModels_[X].getId()})}return this.hasStatements_||(L.hasStatements=!1),L},loadExtraState:function(L){if(this.arguments_=[],this.argumentVarModels_=[],L.params)for(let fe=0;fe<L.params.length;fe++){var X=L.params[fe];X=r.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,X.id,X.name,""),this.arguments_.push(X.name),this.argumentVarModels_.push(X)}this.updateParams_(),r.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_(L.hasStatements!==!1)},decompose:function(L){const X=r.createElement$$module$build$src$core$utils$xml("block");X.setAttribute("type","procedures_mutatorcontainer");var fe=r.createElement$$module$build$src$core$utils$xml("statement");fe.setAttribute("name","STACK"),X.appendChild(fe);for(let Ae=0;Ae<this.arguments_.length;Ae++){const tt=r.createElement$$module$build$src$core$utils$xml("block");tt.setAttribute("type","procedures_mutatorarg");var z=r.createElement$$module$build$src$core$utils$xml("field");z.setAttribute("name","NAME");const ye=r.createTextNode$$module$build$src$core$utils$xml(this.arguments_[Ae]);z.appendChild(ye),tt.appendChild(z),z=r.createElement$$module$build$src$core$utils$xml("next"),tt.appendChild(z),fe.appendChild(tt),fe=z}return L=r.domToBlock$$module$build$src$core$xml(X,L),this.type==="procedures_defreturn"?L.setFieldValue(this.hasStatements_,"STATEMENTS"):L.removeInput("STATEMENT_INPUT"),r.mutateCallers$$module$build$src$core$procedures(this),L},compose:function(L){this.arguments_=[],this.paramIds_=[],this.argumentVarModels_=[];let X=L.getInputTargetBlock("STACK");for(;X&&!X.isInsertionMarker();){var fe=X.getFieldValue("NAME");this.arguments_.push(fe),fe=this.workspace.getVariable(fe,""),this.argumentVarModels_.push(fe),this.paramIds_.push(X.id),X=X.nextConnection&&X.nextConnection.targetBlock()}if(this.updateParams_(),r.mutateCallers$$module$build$src$core$procedures(this),L=L.getFieldValue("STATEMENTS"),L!==null&&(L=L==="TRUE",this.hasStatements_!==L))if(L){this.setStatements_(!0);var z;(z=this.statementConnection_)==null||z.reconnect(this,"STACK"),this.statementConnection_=null}else z=this.getInput("STACK").connection,(this.statementConnection_=z.targetConnection)&&(z=z.targetBlock(),z.unplug(),z.bumpNeighbours()),this.setStatements_(!1)},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},renameVarById:function(L,X){var fe=this.workspace.getVariableById(L);if(fe.type===""){fe=fe.name,X=this.workspace.getVariableById(X);var z=!1;for(let Ae=0;Ae<this.argumentVarModels_.length;Ae++)this.argumentVarModels_[Ae].getId()===L&&(this.arguments_[Ae]=X.name,this.argumentVarModels_[Ae]=X,z=!0);z&&(this.displayRenamedVar_(fe,X.name),r.mutateCallers$$module$build$src$core$procedures(this))}},updateVarName:function(L){const X=L.name;let fe=!1,z;for(let Ae=0;Ae<this.argumentVarModels_.length;Ae++)this.argumentVarModels_[Ae].getId()===L.getId()&&(z=this.arguments_[Ae],this.arguments_[Ae]=X,fe=!0);fe&&(this.displayRenamedVar_(z,X),r.mutateCallers$$module$build$src$core$procedures(this))},displayRenamedVar_:function(L,X){this.updateParams_();var fe=this.getIcon(r.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE);if(fe&&fe.bubbleIsVisible()){fe=fe.getWorkspace().getAllBlocks(!1);for(let z=0,Ae;Ae=fe[z];z++)Ae.type==="procedures_mutatorarg"&&r.Names$$module$build$src$core$names.equals(L,Ae.getFieldValue("NAME"))&&Ae.setFieldValue(X,"NAME")}},customContextMenu:function(L){if(!this.isInFlyout){var X=this.getFieldValue("NAME"),fe={type:this.callType_,extraState:{name:X,params:this.arguments_}};if(L.push({enabled:!0,text:r.Msg$$module$build$src$core$msg.PROCEDURES_CREATE_DO.replace("%1",X),callback:r.callbackFactory$$module$build$src$core$contextmenu(this,fe)}),!this.isCollapsed())for(X=0;X<this.argumentVarModels_.length;X++){fe=this.argumentVarModels_[X];const z={type:"variables_get",fields:{VAR:{name:fe.name,id:fe.getId(),type:fe.type}}};L.push({enabled:!0,text:r.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",fe.name),callback:r.callbackFactory$$module$build$src$core$contextmenu(this,z)})}}}};U.procedures_defnoreturn=Object.assign({},ce,{init:function(){var L=r.findLegalName$$module$build$src$core$procedures("",this);L=r.fromJson$$module$build$src$core$field_registry({type:"field_input",text:L}),L.setValidator(r.rename$$module$build$src$core$procedures),L.setSpellcheck(!1),this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TITLE).appendField(L,"NAME").appendField("","PARAMS"),this.setMutator(new r.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT&&this.setCommentText(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TOOLTIP),this.setHelpUrl(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!1]},callType_:"procedures_callnoreturn"}),U.procedures_defreturn=Object.assign({},ce,{init:function(){var L=r.findLegalName$$module$build$src$core$procedures("",this);L=r.fromJson$$module$build$src$core$field_registry({type:"field_input",text:L}),L.setValidator(r.rename$$module$build$src$core$procedures),L.setSpellcheck(!1),this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TITLE).appendField(L,"NAME").appendField("","PARAMS"),this.appendValueInput("RETURN").setAlign(r.Align$$module$build$src$core$inputs$align.RIGHT).appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setMutator(new r.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT&&this.setCommentText(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TOOLTIP),this.setHelpUrl(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!0]},callType_:"procedures_callreturn"});var ie={init:function(){this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TITLE),this.appendStatementInput("STACK"),this.appendDummyInput("STATEMENT_INPUT").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_ALLOW_STATEMENTS).appendField(r.fromJson$$module$build$src$core$field_registry({type:"field_checkbox",checked:!0}),"STATEMENTS"),this.setStyle("procedure_blocks"),this.setTooltip(r.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP),this.contextMenu=!1}};U.procedures_mutatorcontainer=ie;var ae={init:function(){const L=r.fromJson$$module$build$src$core$field_registry({type:"field_input",text:r.DEFAULT_ARG$$module$build$src$core$procedures});L.setValidator(this.validator_),L.oldShowEditorFn_=L.showEditor_,L.showEditor_=function(){this.createdVariables_=[],this.oldShowEditorFn_()},this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TITLE).appendField(L,"NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(r.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TOOLTIP),this.contextMenu=!1,L.onFinishEditing_=this.deleteIntermediateVars_,L.createdVariables_=[],L.onFinishEditing_("x")},validator_:function(L){var X=this.getSourceBlock();const fe=X.workspace.getRootWorkspace();if(L=L.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,""),!L)return null;const z=(X.workspace.targetWorkspace||X.workspace).getAllBlocks(!1),Ae=L.toLowerCase();for(let tt=0;tt<z.length;tt++){if(z[tt].id===this.getSourceBlock().id)continue;const ye=z[tt].getFieldValue("NAME");if(ye&&ye.toLowerCase()===Ae)return null}return X.isInFlyout||((X=fe.getVariable(L,""))&&X.name!==L&&fe.renameVariableById(X.getId(),L),X||(X=fe.createVariable(L,""))&&this.createdVariables_&&this.createdVariables_.push(X)),L},deleteIntermediateVars_:function(L){const X=this.getSourceBlock().workspace.getRootWorkspace();if(X)for(let fe=0;fe<this.createdVariables_.length;fe++){const z=this.createdVariables_[fe];z.name!==L&&X.deleteVariableById(z.getId())}}};U.procedures_mutatorarg=ae;var ne="DISABLED_PROCEDURE_DEFINITION",pe={getProcedureCall:function(){return this.getFieldValue("NAME")},renameProcedure:function(L,X){r.Names$$module$build$src$core$names.equals(L,this.getProcedureCall())&&(this.setFieldValue(X,"NAME"),this.setTooltip((this.outputConnection?r.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_TOOLTIP:r.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_TOOLTIP).replace("%1",X)))},setProcedureParameters_:function(L,X){var fe=r.getDefinition$$module$build$src$core$procedures(this.getProcedureCall(),this.workspace);if((fe=(fe=fe&&fe.getIcon(r.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE))&&fe.bubbleIsVisible())?this.setCollapsed(!1):(this.quarkConnections_={},this.quarkIds_=null),L.join(`
`)===this.arguments_.join(`
`))this.quarkIds_=X;else{if(X.length!==L.length)throw RangeError("paramNames and paramIds must be the same length.");this.quarkIds_||(this.quarkConnections_={},this.quarkIds_=[]);for(let Ae=0;Ae<this.arguments_.length;Ae++){var z=this.getInput("ARG"+Ae);z&&(z=z.connection.targetConnection,this.quarkConnections_[this.quarkIds_[Ae]]=z,fe&&z&&!X.includes(this.quarkIds_[Ae])&&(z.disconnect(),z.getSourceBlock().bumpNeighbours()))}for(this.arguments_=[].concat(L),this.argumentVarModels_=[],L=0;L<this.arguments_.length;L++)fe=r.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,null,this.arguments_[L],""),this.argumentVarModels_.push(fe);if(this.updateShape_(),this.quarkIds_=X){for(X=0;X<this.arguments_.length;X++)if(L=this.quarkIds_[X],L in this.quarkConnections_){let Ae;(Ae=this.quarkConnections_[L])!=null&&Ae.reconnect(this,"ARG"+X)||delete this.quarkConnections_[L]}}}},updateShape_:function(){for(var L=0;L<this.arguments_.length;L++){var X=this.getField("ARGNAME"+L);if(X){r.disable$$module$build$src$core$events$utils();try{X.setValue(this.arguments_[L])}finally{r.enable$$module$build$src$core$events$utils()}}else X=r.fromJson$$module$build$src$core$field_registry({type:"field_label",text:this.arguments_[L]}),this.appendValueInput("ARG"+L).setAlign(r.Align$$module$build$src$core$inputs$align.RIGHT).appendField(X,"ARGNAME"+L)}for(L=this.arguments_.length;this.getInput("ARG"+L);L++)this.removeInput("ARG"+L);(L=this.getInput("TOPROW"))&&(this.arguments_.length?this.getField("WITH")||L.appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_CALL_BEFORE_PARAMS,"WITH"):this.getField("WITH")&&L.removeField("WITH"))},mutationToDom:function(){const L=r.createElement$$module$build$src$core$utils$xml("mutation");L.setAttribute("name",this.getProcedureCall());for(let X=0;X<this.arguments_.length;X++){const fe=r.createElement$$module$build$src$core$utils$xml("arg");fe.setAttribute("name",this.arguments_[X]),L.appendChild(fe)}return L},domToMutation:function(L){var X=L.getAttribute("name");this.renameProcedure(this.getProcedureCall(),X),X=[];const fe=[];for(let z=0,Ae;Ae=L.childNodes[z];z++)Ae.nodeName.toLowerCase()==="arg"&&(X.push(Ae.getAttribute("name")),fe.push(Ae.getAttribute("paramId")));this.setProcedureParameters_(X,fe)},saveExtraState:function(){const L=Object.create(null);return L.name=this.getProcedureCall(),this.arguments_.length&&(L.params=this.arguments_),L},loadExtraState:function(L){if(this.renameProcedure(this.getProcedureCall(),L.name),L=L.params){const X=[];X.length=L.length,X.fill(null),this.setProcedureParameters_(L,X)}},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},onchange:function(L){if(this.workspace&&!this.workspace.isFlyout&&L.recordUndo)if(L.type===r.CREATE$$module$build$src$core$events$utils&&L.ids.includes(this.id)){var X=this.getProcedureCall();if(X=r.getDefinition$$module$build$src$core$procedures(X,this.workspace),!X||X.type===this.defType_&&JSON.stringify(X.getVars())===JSON.stringify(this.arguments_)||(X=null),!X){r.setGroup$$module$build$src$core$events$utils(L.group),L=r.createElement$$module$build$src$core$utils$xml("xml"),X=r.createElement$$module$build$src$core$utils$xml("block"),X.setAttribute("type",this.defType_);var fe=this.getRelativeToSurfaceXY(),z=fe.y+2*r.config$$module$build$src$core$config.snapRadius;X.setAttribute("x",`${fe.x+r.config$$module$build$src$core$config.snapRadius*(this.RTL?-1:1)}`),X.setAttribute("y",`${z}`),fe=this.mutationToDom(),X.appendChild(fe),fe=r.createElement$$module$build$src$core$utils$xml("field"),fe.setAttribute("name","NAME"),z=this.getProcedureCall();const Ae=r.findLegalName$$module$build$src$core$procedures(z,this);z!==Ae&&this.renameProcedure(z,Ae),fe.appendChild(r.createTextNode$$module$build$src$core$utils$xml(z)),X.appendChild(fe),L.appendChild(X),r.domToWorkspace$$module$build$src$core$xml(L,this.workspace),r.setGroup$$module$build$src$core$events$utils(!1)}}else L.type===r.DELETE$$module$build$src$core$events$utils?(X=this.getProcedureCall(),r.getDefinition$$module$build$src$core$procedures(X,this.workspace)||(r.setGroup$$module$build$src$core$events$utils(L.group),this.dispose(!0),r.setGroup$$module$build$src$core$events$utils(!1))):L.type===r.CHANGE$$module$build$src$core$events$utils&&L.element==="disabled"&&(X=this.getProcedureCall(),(z=r.getDefinition$$module$build$src$core$procedures(X,this.workspace))&&z.id===L.blockId&&((fe=r.getGroup$$module$build$src$core$events$utils())&&console.log("Saw an existing group while responding to a definition change"),r.setGroup$$module$build$src$core$events$utils(L.group),L=z.isEnabled(),this.setDisabledReason(!L,ne),this.setWarningText(L?null:r.Msg$$module$build$src$core$msg.PROCEDURES_CALL_DISABLED_DEF_WARNING.replace("%1",X)),r.setGroup$$module$build$src$core$events$utils(fe)))},customContextMenu:function(L){if(this.workspace.isMovable()){var X=this.getProcedureCall(),fe=this.workspace;L.push({enabled:!0,text:r.Msg$$module$build$src$core$msg.PROCEDURES_HIGHLIGHT_DEF,callback:function(){const z=r.getDefinition$$module$build$src$core$procedures(X,fe);z&&(fe.centerOnBlock(z.id),r.setSelected$$module$build$src$core$common(z))}})}}};U.procedures_callnoreturn=Object.assign({},pe,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(r.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null},defType_:"procedures_defnoreturn"}),U.procedures_callreturn=Object.assign({},pe,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setOutput(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(r.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null},defType_:"procedures_defreturn"});var de="UNPARENTED_IFRETURN",xe={init:function(){this.appendValueInput("CONDITION").setCheck("Boolean").appendField(r.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_IF),this.appendValueInput("VALUE").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(r.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_TOOLTIP),this.setHelpUrl(r.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_HELPURL),this.hasReturnValue_=!0},mutationToDom:function(){const L=r.createElement$$module$build$src$core$utils$xml("mutation");return L.setAttribute("value",String(Number(this.hasReturnValue_))),L},domToMutation:function(L){this.hasReturnValue_=L.getAttribute("value")==="1",this.hasReturnValue_||(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN))},onchange:function(L){if(!(this.workspace.isDragging&&this.workspace.isDragging()||L.type!==r.MOVE$$module$build$src$core$events$utils&&L.type!==r.CREATE$$module$build$src$core$events$utils)){L=!1;var X=this;do{if(this.FUNCTION_TYPES.includes(X.type)){L=!0;break}X=X.getSurroundParent()}while(X);if(L?(X.type==="procedures_defnoreturn"&&this.hasReturnValue_?(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!1):X.type!=="procedures_defreturn"||this.hasReturnValue_||(this.removeInput("VALUE"),this.appendValueInput("VALUE").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!0),this.setWarningText(null)):this.setWarningText(r.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_WARNING),!this.isInFlyout)try{r.setRecordUndo$$module$build$src$core$events$utils(!1),this.setDisabledReason(!L,de)}finally{r.setRecordUndo$$module$build$src$core$events$utils(!0)}}},FUNCTION_TYPES:["procedures_defnoreturn","procedures_defreturn"]};U.procedures_ifreturn=xe,r.defineBlocks$$module$build$src$core$common(U);var H={blocks:U},J=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"math_number",message0:"%1",args0:[{type:"field_number",name:"NUM",value:0}],output:"Number",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",style:"math_blocks",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_arithmetic",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Number"},{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ADDITION_SYMBOL}","ADD"],["%{BKY_MATH_SUBTRACTION_SYMBOL}","MINUS"],["%{BKY_MATH_MULTIPLICATION_SYMBOL}","MULTIPLY"],["%{BKY_MATH_DIVISION_SYMBOL}","DIVIDE"],["%{BKY_MATH_POWER_SYMBOL}","POWER"]]},{type:"input_value",name:"B",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ARITHMETIC_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_single",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_SINGLE_OP_ROOT}","ROOT"],["%{BKY_MATH_SINGLE_OP_ABSOLUTE}","ABS"],["-","NEG"],["ln","LN"],["log10","LOG10"],["e^","EXP"],["10^","POW10"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_SINGLE_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_trig",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_TRIG_SIN}","SIN"],["%{BKY_MATH_TRIG_COS}","COS"],["%{BKY_MATH_TRIG_TAN}","TAN"],["%{BKY_MATH_TRIG_ASIN}","ASIN"],["%{BKY_MATH_TRIG_ACOS}","ACOS"],["%{BKY_MATH_TRIG_ATAN}","ATAN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_TRIG_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_constant",message0:"%1",args0:[{type:"field_dropdown",name:"CONSTANT",options:[["π","PI"],["e","E"],["φ","GOLDEN_RATIO"],["sqrt(2)","SQRT2"],["sqrt(½)","SQRT1_2"],["∞","INFINITY"]]}],output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTANT_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTANT_HELPURL}"},{type:"math_number_property",message0:"%1 %2",args0:[{type:"input_value",name:"NUMBER_TO_CHECK",check:"Number"},{type:"field_dropdown",name:"PROPERTY",options:[["%{BKY_MATH_IS_EVEN}","EVEN"],["%{BKY_MATH_IS_ODD}","ODD"],["%{BKY_MATH_IS_PRIME}","PRIME"],["%{BKY_MATH_IS_WHOLE}","WHOLE"],["%{BKY_MATH_IS_POSITIVE}","POSITIVE"],["%{BKY_MATH_IS_NEGATIVE}","NEGATIVE"],["%{BKY_MATH_IS_DIVISIBLE_BY}","DIVISIBLE_BY"]]}],inputsInline:!0,output:"Boolean",style:"math_blocks",tooltip:"%{BKY_MATH_IS_TOOLTIP}",mutator:"math_is_divisibleby_mutator"},{type:"math_change",message0:"%{BKY_MATH_CHANGE_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_MATH_CHANGE_TITLE_ITEM}"},{type:"input_value",name:"DELTA",check:"Number"}],previousStatement:null,nextStatement:null,style:"variable_blocks",helpUrl:"%{BKY_MATH_CHANGE_HELPURL}",extensions:["math_change_tooltip"]},{type:"math_round",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ROUND_OPERATOR_ROUND}","ROUND"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDUP}","ROUNDUP"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDDOWN}","ROUNDDOWN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ROUND_HELPURL}",tooltip:"%{BKY_MATH_ROUND_TOOLTIP}"},{type:"math_on_list",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ONLIST_OPERATOR_SUM}","SUM"],["%{BKY_MATH_ONLIST_OPERATOR_MIN}","MIN"],["%{BKY_MATH_ONLIST_OPERATOR_MAX}","MAX"],["%{BKY_MATH_ONLIST_OPERATOR_AVERAGE}","AVERAGE"],["%{BKY_MATH_ONLIST_OPERATOR_MEDIAN}","MEDIAN"],["%{BKY_MATH_ONLIST_OPERATOR_MODE}","MODE"],["%{BKY_MATH_ONLIST_OPERATOR_STD_DEV}","STD_DEV"],["%{BKY_MATH_ONLIST_OPERATOR_RANDOM}","RANDOM"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ONLIST_HELPURL}",mutator:"math_modes_of_list_mutator",extensions:["math_op_tooltip"]},{type:"math_modulo",message0:"%{BKY_MATH_MODULO_TITLE}",args0:[{type:"input_value",name:"DIVIDEND",check:"Number"},{type:"input_value",name:"DIVISOR",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_MODULO_TOOLTIP}",helpUrl:"%{BKY_MATH_MODULO_HELPURL}"},{type:"math_constrain",message0:"%{BKY_MATH_CONSTRAIN_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"Number"},{type:"input_value",name:"LOW",check:"Number"},{type:"input_value",name:"HIGH",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTRAIN_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTRAIN_HELPURL}"},{type:"math_random_int",message0:"%{BKY_MATH_RANDOM_INT_TITLE}",args0:[{type:"input_value",name:"FROM",check:"Number"},{type:"input_value",name:"TO",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_INT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_INT_HELPURL}"},{type:"math_random_float",message0:"%{BKY_MATH_RANDOM_FLOAT_TITLE_RANDOM}",output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_FLOAT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_FLOAT_HELPURL}"},{type:"math_atan2",message0:"%{BKY_MATH_ATAN2_TITLE}",args0:[{type:"input_value",name:"X",check:"Number"},{type:"input_value",name:"Y",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_ATAN2_TOOLTIP}",helpUrl:"%{BKY_MATH_ATAN2_HELPURL}"}]),K={ADD:"%{BKY_MATH_ARITHMETIC_TOOLTIP_ADD}",MINUS:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MINUS}",MULTIPLY:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MULTIPLY}",DIVIDE:"%{BKY_MATH_ARITHMETIC_TOOLTIP_DIVIDE}",POWER:"%{BKY_MATH_ARITHMETIC_TOOLTIP_POWER}",ROOT:"%{BKY_MATH_SINGLE_TOOLTIP_ROOT}",ABS:"%{BKY_MATH_SINGLE_TOOLTIP_ABS}",NEG:"%{BKY_MATH_SINGLE_TOOLTIP_NEG}",LN:"%{BKY_MATH_SINGLE_TOOLTIP_LN}",LOG10:"%{BKY_MATH_SINGLE_TOOLTIP_LOG10}",EXP:"%{BKY_MATH_SINGLE_TOOLTIP_EXP}",POW10:"%{BKY_MATH_SINGLE_TOOLTIP_POW10}",SIN:"%{BKY_MATH_TRIG_TOOLTIP_SIN}",COS:"%{BKY_MATH_TRIG_TOOLTIP_COS}",TAN:"%{BKY_MATH_TRIG_TOOLTIP_TAN}",ASIN:"%{BKY_MATH_TRIG_TOOLTIP_ASIN}",ACOS:"%{BKY_MATH_TRIG_TOOLTIP_ACOS}",ATAN:"%{BKY_MATH_TRIG_TOOLTIP_ATAN}",SUM:"%{BKY_MATH_ONLIST_TOOLTIP_SUM}",MIN:"%{BKY_MATH_ONLIST_TOOLTIP_MIN}",MAX:"%{BKY_MATH_ONLIST_TOOLTIP_MAX}",AVERAGE:"%{BKY_MATH_ONLIST_TOOLTIP_AVERAGE}",MEDIAN:"%{BKY_MATH_ONLIST_TOOLTIP_MEDIAN}",MODE:"%{BKY_MATH_ONLIST_TOOLTIP_MODE}",STD_DEV:"%{BKY_MATH_ONLIST_TOOLTIP_STD_DEV}",RANDOM:"%{BKY_MATH_ONLIST_TOOLTIP_RANDOM}"};r.register$$module$build$src$core$extensions("math_op_tooltip",r.buildTooltipForDropdown$$module$build$src$core$extensions("OP",K));var se={mutationToDom:function(){const L=r.createElement$$module$build$src$core$utils$xml("mutation"),X=this.getFieldValue("PROPERTY")==="DIVISIBLE_BY";return L.setAttribute("divisor_input",String(X)),L},domToMutation:function(L){L=L.getAttribute("divisor_input")==="true",this.updateShape_(L)},updateShape_:function(L){const X=this.getInput("DIVISOR");L?X||this.appendValueInput("DIVISOR").setCheck("Number"):X&&this.removeInput("DIVISOR")}},Y=function(){this.getField("PROPERTY").setValidator(function(L){L=L==="DIVISIBLE_BY",this.getSourceBlock().updateShape_(L)})};r.registerMutator$$module$build$src$core$extensions("math_is_divisibleby_mutator",se,Y),r.register$$module$build$src$core$extensions("math_change_tooltip",r.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_MATH_CHANGE_TOOLTIP}","VAR"));var he={updateType_:function(L){L==="MODE"?this.outputConnection.setCheck("Array"):this.outputConnection.setCheck("Number")},mutationToDom:function(){const L=r.createElement$$module$build$src$core$utils$xml("mutation");return L.setAttribute("op",this.getFieldValue("OP")),L},domToMutation:function(L){if(L=L.getAttribute("op"),L===null)throw new TypeError("xmlElement had no op attribute");this.updateType_(L)}},ue=function(){this.getField("OP").setValidator((function(L){this.updateType_(L)}).bind(this))};r.registerMutator$$module$build$src$core$extensions("math_modes_of_list_mutator",he,ue),r.defineBlocks$$module$build$src$core$common(J);var Te={blocks:J},_e=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"controls_repeat_ext",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"input_value",name:"TIMES",check:"Number"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_repeat",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"field_number",name:"TIMES",value:10,min:0,precision:1}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_whileUntil",message0:"%1 %2",args0:[{type:"field_dropdown",name:"MODE",options:[["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_WHILE}","WHILE"],["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_UNTIL}","UNTIL"]]},{type:"input_value",name:"BOOL",check:"Boolean"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_WHILEUNTIL_HELPURL}",extensions:["controls_whileUntil_tooltip"]},{type:"controls_for",message0:"%{BKY_CONTROLS_FOR_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"FROM",check:"Number",align:"RIGHT"},{type:"input_value",name:"TO",check:"Number",align:"RIGHT"},{type:"input_value",name:"BY",check:"Number",align:"RIGHT"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],inputsInline:!0,previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOR_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_for_tooltip"]},{type:"controls_forEach",message0:"%{BKY_CONTROLS_FOREACH_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"LIST",check:"Array"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOREACH_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_forEach_tooltip"]},{type:"controls_flow_statements",message0:"%1",args0:[{type:"field_dropdown",name:"FLOW",options:[["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK}","BREAK"],["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE}","CONTINUE"]]}],previousStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FLOW_STATEMENTS_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_flow_tooltip","controls_flow_in_loop_check"]}]),Re={WHILE:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_WHILE}",UNTIL:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL}"};r.register$$module$build$src$core$extensions("controls_whileUntil_tooltip",r.buildTooltipForDropdown$$module$build$src$core$extensions("MODE",Re));var De={BREAK:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK}",CONTINUE:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE}"};r.register$$module$build$src$core$extensions("controls_flow_tooltip",r.buildTooltipForDropdown$$module$build$src$core$extensions("FLOW",De));var et={customContextMenu:function(L){if(!this.isInFlyout){var X=this.getField("VAR"),fe=X.getVariable().name;this.isCollapsed()||fe===null||(X={type:"variables_get",fields:{VAR:X.saveState(!0)}},L.push({enabled:!0,text:r.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",fe),callback:r.callbackFactory$$module$build$src$core$contextmenu(this,X)}))}}};r.registerMixin$$module$build$src$core$extensions("contextMenu_newGetVariableBlock",et),r.register$$module$build$src$core$extensions("controls_for_tooltip",r.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOR_TOOLTIP}","VAR")),r.register$$module$build$src$core$extensions("controls_forEach_tooltip",r.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOREACH_TOOLTIP}","VAR"));var Ue=new Set(["controls_repeat","controls_repeat_ext","controls_forEach","controls_for","controls_whileUntil"]),Le="CONTROL_FLOW_NOT_IN_LOOP",re={getSurroundLoop:function(){let L=this;do{if(Ue.has(L.type))return L;L=L.getSurroundParent()}while(L);return null},onchange:function(L){const X=this.workspace;if(X.isDragging&&!X.isDragging()&&(L.type===r.MOVE$$module$build$src$core$events$utils||L.type===r.CREATE$$module$build$src$core$events$utils)&&(L=!!this.getSurroundLoop(),this.setWarningText(L?null:r.Msg$$module$build$src$core$msg.CONTROLS_FLOW_STATEMENTS_WARNING),!this.isInFlyout))try{r.setRecordUndo$$module$build$src$core$events$utils(!1),this.setDisabledReason(!L,Le)}finally{r.setRecordUndo$$module$build$src$core$events$utils(!0)}}};r.registerMixin$$module$build$src$core$extensions("controls_flow_in_loop_check",re),r.defineBlocks$$module$build$src$core$common(_e);var Ye={blocks:_e,loopTypes:Ue},Fe=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"logic_boolean",message0:"%1",args0:[{type:"field_dropdown",name:"BOOL",options:[["%{BKY_LOGIC_BOOLEAN_TRUE}","TRUE"],["%{BKY_LOGIC_BOOLEAN_FALSE}","FALSE"]]}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_BOOLEAN_TOOLTIP}",helpUrl:"%{BKY_LOGIC_BOOLEAN_HELPURL}"},{type:"controls_if",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],previousStatement:null,nextStatement:null,style:"logic_blocks",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,mutator:"controls_if_mutator",extensions:["controls_if_tooltip"]},{type:"controls_ifelse",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],message2:"%{BKY_CONTROLS_IF_MSG_ELSE} %1",args2:[{type:"input_statement",name:"ELSE"}],previousStatement:null,nextStatement:null,style:"logic_blocks",tooltip:"%{BKYCONTROLS_IF_TOOLTIP_2}",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_if_tooltip"]},{type:"logic_compare",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A"},{type:"field_dropdown",name:"OP",options:[["=","EQ"],["≠","NEQ"],["‏<","LT"],["‏≤","LTE"],["‏>","GT"],["‏≥","GTE"]]},{type:"input_value",name:"B"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_COMPARE_HELPURL}",extensions:["logic_compare","logic_op_tooltip"]},{type:"logic_operation",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Boolean"},{type:"field_dropdown",name:"OP",options:[["%{BKY_LOGIC_OPERATION_AND}","AND"],["%{BKY_LOGIC_OPERATION_OR}","OR"]]},{type:"input_value",name:"B",check:"Boolean"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_OPERATION_HELPURL}",extensions:["logic_op_tooltip"]},{type:"logic_negate",message0:"%{BKY_LOGIC_NEGATE_TITLE}",args0:[{type:"input_value",name:"BOOL",check:"Boolean"}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_NEGATE_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NEGATE_HELPURL}"},{type:"logic_null",message0:"%{BKY_LOGIC_NULL}",output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_NULL_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NULL_HELPURL}"},{type:"logic_ternary",message0:"%{BKY_LOGIC_TERNARY_CONDITION} %1",args0:[{type:"input_value",name:"IF",check:"Boolean"}],message1:"%{BKY_LOGIC_TERNARY_IF_TRUE} %1",args1:[{type:"input_value",name:"THEN"}],message2:"%{BKY_LOGIC_TERNARY_IF_FALSE} %1",args2:[{type:"input_value",name:"ELSE"}],output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_TERNARY_TOOLTIP}",helpUrl:"%{BKY_LOGIC_TERNARY_HELPURL}",extensions:["logic_ternary"]},{type:"controls_if_if",message0:"%{BKY_CONTROLS_IF_IF_TITLE_IF}",nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_IF_TOOLTIP}"},{type:"controls_if_elseif",message0:"%{BKY_CONTROLS_IF_ELSEIF_TITLE_ELSEIF}",previousStatement:null,nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSEIF_TOOLTIP}"},{type:"controls_if_else",message0:"%{BKY_CONTROLS_IF_ELSE_TITLE_ELSE}",previousStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSE_TOOLTIP}"}]),Ze={EQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_EQ}",NEQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_NEQ}",LT:"%{BKY_LOGIC_COMPARE_TOOLTIP_LT}",LTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_LTE}",GT:"%{BKY_LOGIC_COMPARE_TOOLTIP_GT}",GTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_GTE}",AND:"%{BKY_LOGIC_OPERATION_TOOLTIP_AND}",OR:"%{BKY_LOGIC_OPERATION_TOOLTIP_OR}"};r.register$$module$build$src$core$extensions("logic_op_tooltip",r.buildTooltipForDropdown$$module$build$src$core$extensions("OP",Ze));var Xe={elseifCount_:0,elseCount_:0,mutationToDom:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const L=r.createElement$$module$build$src$core$utils$xml("mutation");return this.elseifCount_&&L.setAttribute("elseif",String(this.elseifCount_)),this.elseCount_&&L.setAttribute("else","1"),L},domToMutation:function(L){this.elseifCount_=parseInt(L.getAttribute("elseif"),10)||0,this.elseCount_=parseInt(L.getAttribute("else"),10)||0,this.rebuildShape_()},saveExtraState:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const L=Object.create(null);return this.elseifCount_&&(L.elseIfCount=this.elseifCount_),this.elseCount_&&(L.hasElse=!0),L},loadExtraState:function(L){this.elseifCount_=L.elseIfCount||0,this.elseCount_=L.hasElse?1:0,this.updateShape_()},decompose:function(L){const X=L.newBlock("controls_if_if");X.initSvg();let fe=X.nextConnection;for(let z=1;z<=this.elseifCount_;z++){const Ae=L.newBlock("controls_if_elseif");Ae.initSvg(),fe.connect(Ae.previousConnection),fe=Ae.nextConnection}return this.elseCount_&&(L=L.newBlock("controls_if_else"),L.initSvg(),fe.connect(L.previousConnection)),X},compose:function(L){L=L.nextConnection.targetBlock(),this.elseCount_=this.elseifCount_=0;const X=[null],fe=[null];let z=null;for(;L;){if(!L.isInsertionMarker())switch(L.type){case"controls_if_elseif":this.elseifCount_++,X.push(L.valueConnection_),fe.push(L.statementConnection_);break;case"controls_if_else":this.elseCount_++,z=L.statementConnection_;break;default:throw TypeError("Unknown block type: "+L.type)}L=L.getNextBlock()}this.updateShape_(),this.reconnectChildBlocks_(X,fe,z)},saveConnections:function(L){L=L.nextConnection.targetBlock();let X=1;for(;L;){if(!L.isInsertionMarker())switch(L.type){case"controls_if_elseif":var fe=this.getInput("IF"+X);const z=this.getInput("DO"+X);L.valueConnection_=fe&&fe.connection.targetConnection,L.statementConnection_=z&&z.connection.targetConnection,X++;break;case"controls_if_else":fe=this.getInput("ELSE"),L.statementConnection_=fe&&fe.connection.targetConnection;break;default:throw TypeError("Unknown block type: "+L.type)}L=L.getNextBlock()}},rebuildShape_:function(){const L=[null],X=[null];let fe=null;this.getInput("ELSE")&&(fe=this.getInput("ELSE").connection.targetConnection);for(let z=1;this.getInput("IF"+z);z++){const Ae=this.getInput("IF"+z),tt=this.getInput("DO"+z);L.push(Ae.connection.targetConnection),X.push(tt.connection.targetConnection)}this.updateShape_(),this.reconnectChildBlocks_(L,X,fe)},updateShape_:function(){this.getInput("ELSE")&&this.removeInput("ELSE");for(var L=1;this.getInput("IF"+L);L++)this.removeInput("IF"+L),this.removeInput("DO"+L);for(L=1;L<=this.elseifCount_;L++)this.appendValueInput("IF"+L).setCheck("Boolean").appendField(r.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSEIF),this.appendStatementInput("DO"+L).appendField(r.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_THEN);this.elseCount_&&this.appendStatementInput("ELSE").appendField(r.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSE)},reconnectChildBlocks_:function(L,X,fe){for(let z=1;z<=this.elseifCount_;z++){let Ae;(Ae=L[z])==null||Ae.reconnect(this,"IF"+z);let tt;(tt=X[z])==null||tt.reconnect(this,"DO"+z)}fe==null||fe.reconnect(this,"ELSE")}};r.registerMutator$$module$build$src$core$extensions("controls_if_mutator",Xe,null,["controls_if_elseif","controls_if_else"]);var dt=function(){this.setTooltip((function(){if(this.elseifCount_||this.elseCount_){if(!this.elseifCount_&&this.elseCount_)return r.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_2;if(this.elseifCount_&&!this.elseCount_)return r.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_3;if(this.elseifCount_&&this.elseCount_)return r.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_4}else return r.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_1;return""}).bind(this))};r.register$$module$build$src$core$extensions("controls_if_tooltip",dt);var je={onchange:function(L){this.prevBlocks_||(this.prevBlocks_=[null,null]);var X=this.getInputTargetBlock("A");const fe=this.getInputTargetBlock("B");X&&fe&&!this.workspace.connectionChecker.doTypeChecks(X.outputConnection,fe.outputConnection)&&(r.setGroup$$module$build$src$core$events$utils(L.group),L=this.prevBlocks_[0],L!==X&&(X.unplug(),!L||L.isDisposed()||L.isShadow()||this.getInput("A").connection.connect(L.outputConnection)),X=this.prevBlocks_[1],X!==fe&&(fe.unplug(),!X||X.isDisposed()||X.isShadow()||this.getInput("B").connection.connect(X.outputConnection)),this.bumpNeighbours(),r.setGroup$$module$build$src$core$events$utils(!1)),this.prevBlocks_[0]=this.getInputTargetBlock("A"),this.prevBlocks_[1]=this.getInputTargetBlock("B")}},it=function(){this.mixin(je)};r.register$$module$build$src$core$extensions("logic_compare",it);var Ce={prevParentConnection_:null,onchange:function(L){const X=this.getInputTargetBlock("THEN"),fe=this.getInputTargetBlock("ELSE"),z=this.outputConnection.targetConnection;if((X||fe)&&z)for(let Ae=0;2>Ae;Ae++){const tt=Ae===1?X:fe;tt&&!tt.workspace.connectionChecker.doTypeChecks(tt.outputConnection,z)&&(r.setGroup$$module$build$src$core$events$utils(L.group),z===this.prevParentConnection_?(this.unplug(),z.getSourceBlock().bumpNeighbours()):(tt.unplug(),tt.bumpNeighbours()),r.setGroup$$module$build$src$core$events$utils(!1))}this.prevParentConnection_=z}};r.registerMixin$$module$build$src$core$extensions("logic_ternary",Ce),r.defineBlocks$$module$build$src$core$common(Fe);var Me={blocks:Fe},St=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"lists_create_empty",message0:"%{BKY_LISTS_CREATE_EMPTY_TITLE}",output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_CREATE_EMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_CREATE_EMPTY_HELPURL}"},{type:"lists_repeat",message0:"%{BKY_LISTS_REPEAT_TITLE}",args0:[{type:"input_value",name:"ITEM"},{type:"input_value",name:"NUM",check:"Number"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_LISTS_REPEAT_HELPURL}"},{type:"lists_reverse",message0:"%{BKY_LISTS_REVERSE_MESSAGE0}",args0:[{type:"input_value",name:"LIST",check:"Array"}],output:"Array",inputsInline:!0,style:"list_blocks",tooltip:"%{BKY_LISTS_REVERSE_TOOLTIP}",helpUrl:"%{BKY_LISTS_REVERSE_HELPURL}"},{type:"lists_isEmpty",message0:"%{BKY_LISTS_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"list_blocks",tooltip:"%{BKY_LISTS_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_ISEMPTY_HELPURL}"},{type:"lists_length",message0:"%{BKY_LISTS_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"list_blocks",tooltip:"%{BKY_LISTS_LENGTH_TOOLTIP}",helpUrl:"%{BKY_LISTS_LENGTH_HELPURL}"}]),oe={init:function(){this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_HELPURL),this.setStyle("list_blocks"),this.itemCount_=3,this.updateShape_(),this.setOutput(!0,"Array"),this.setMutator(new r.MutatorIcon$$module$build$src$core$icons$mutator_icon(["lists_create_with_item"],this)),this.setTooltip(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_TOOLTIP)},mutationToDom:function(){const L=r.createElement$$module$build$src$core$utils$xml("mutation");return L.setAttribute("items",String(this.itemCount_)),L},domToMutation:function(L){if(L=L.getAttribute("items"),!L)throw new TypeError("element did not have items");this.itemCount_=parseInt(L,10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(L){this.itemCount_=L.itemCount,this.updateShape_()},decompose:function(L){const X=L.newBlock("lists_create_with_container");X.initSvg();let fe=X.getInput("STACK").connection;for(let z=0;z<this.itemCount_;z++){const Ae=L.newBlock("lists_create_with_item");if(Ae.initSvg(),!Ae.previousConnection)throw Error("itemBlock has no previousConnection");fe.connect(Ae.previousConnection),fe=Ae.nextConnection}return X},compose:function(L){var X=L.getInputTargetBlock("STACK");for(L=[];X;)X.isInsertionMarker()||L.push(X.valueConnection_),X=X.getNextBlock();for(X=0;X<this.itemCount_;X++){const fe=this.getInput("ADD"+X).connection.targetConnection;fe&&!L.includes(fe)&&fe.disconnect()}for(this.itemCount_=L.length,this.updateShape_(),X=0;X<this.itemCount_;X++){let fe;(fe=L[X])==null||fe.reconnect(this,"ADD"+X)}},saveConnections:function(L){L=L.getInputTargetBlock("STACK");let X=0;for(;L;){if(L.isInsertionMarker()){L=L.getNextBlock();continue}const fe=this.getInput("ADD"+X);let z;L.valueConnection_=(z=fe)==null?void 0:z.connection.targetConnection,L=L.getNextBlock(),X++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(r.Msg$$module$build$src$core$msg.LISTS_CREATE_EMPTY_TITLE);for(var L=0;L<this.itemCount_;L++)if(!this.getInput("ADD"+L)){const X=this.appendValueInput("ADD"+L).setAlign(r.Align$$module$build$src$core$inputs$align.RIGHT);L===0&&X.appendField(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_INPUT_WITH)}for(L=this.itemCount_;this.getInput("ADD"+L);L++)this.removeInput("ADD"+L)}};St.lists_create_with=oe;var ee={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD),this.appendStatementInput("STACK"),this.setTooltip(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP),this.contextMenu=!1}};St.lists_create_with_container=ee;var W={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TITLE),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TOOLTIP),this.contextMenu=!1}};St.lists_create_with_item=W;var ot={init:function(){var L=[[r.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_FIRST,"FIRST"],[r.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_LAST,"LAST"]];if(this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_HELPURL),this.setStyle("list_blocks"),this.setOutput(!0,"Number"),this.appendValueInput("VALUE").setCheck("Array").appendField(r.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_INPUT_IN_LIST),L=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:L}),!L)throw Error("field_dropdown not found");this.appendValueInput("FIND").appendField(L,"END"),this.setInputsInline(!0),this.setTooltip(()=>r.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1"))}};St.lists_indexOf=ot;var ze={init:function(){var L=[[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET,"GET"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET_REMOVE,"GET_REMOVE"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_REMOVE,"REMOVE"]];this.WHERE_OPTIONS=[[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_HELPURL),this.setStyle("list_blocks"),L=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:L}),L.setValidator(function(X){X=X==="REMOVE",this.getSourceBlock().updateStatement_(X)}),this.appendValueInput("VALUE").setCheck("Array").appendField(r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_INPUT_IN_LIST),this.appendDummyInput().appendField(L,"MODE").appendField("","SPACE"),this.appendDummyInput("AT"),r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.appendDummyInput("TAIL").appendField(r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL),this.setInputsInline(!0),this.setOutput(!0),this.updateAt_(!0),this.setTooltip(()=>{const X=this.getFieldValue("MODE"),fe=this.getFieldValue("WHERE");let z="";switch(X+" "+fe){case"GET FROM_START":case"GET FROM_END":z=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM;break;case"GET FIRST":z=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST;break;case"GET LAST":z=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST;break;case"GET RANDOM":z=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM;break;case"GET_REMOVE FROM_START":case"GET_REMOVE FROM_END":z=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM;break;case"GET_REMOVE FIRST":z=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST;break;case"GET_REMOVE LAST":z=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST;break;case"GET_REMOVE RANDOM":z=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM;break;case"REMOVE FROM_START":case"REMOVE FROM_END":z=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM;break;case"REMOVE FIRST":z=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST;break;case"REMOVE LAST":z=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST;break;case"REMOVE RANDOM":z=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM}return(fe==="FROM_START"||fe==="FROM_END")&&(z+="  "+(fe==="FROM_START"?r.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:r.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP).replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),z})},mutationToDom:function(){const L=r.createElement$$module$build$src$core$utils$xml("mutation");L.setAttribute("statement",String(!this.outputConnection));const X=this.getInput("AT")instanceof r.ValueInput$$module$build$src$core$inputs$value_input;return L.setAttribute("at",String(X)),L},domToMutation:function(L){const X=L.getAttribute("statement")==="true";this.updateStatement_(X),L=L.getAttribute("at")!=="false",this.updateAt_(L)},saveExtraState:function(){return this.outputConnection?null:{isStatement:!0}},loadExtraState:function(L){L.isStatement?this.updateStatement_(!0):typeof L=="string"&&this.domToMutation(r.textToDom$$module$build$src$core$utils$xml(L))},updateStatement_:function(L){L!==!this.outputConnection&&(this.unplug(!0,!0),L?(this.setOutput(!1),this.setPreviousStatement(!0),this.setNextStatement(!0)):(this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0)))},updateAt_:function(L){this.removeInput("AT"),this.removeInput("ORDINAL",!0),L?(this.appendValueInput("AT").setCheck("Number"),r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT");const X=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS});X.setValidator(function(fe){const z=fe==="FROM_START"||fe==="FROM_END";if(z!==L){const Ae=this.getSourceBlock();return Ae.updateAt_(z),Ae.setFieldValue(fe,"WHERE"),null}}),this.getInput("AT").appendField(X,"WHERE"),r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.moveInputBefore("TAIL",null)}};St.lists_getIndex=ze;var qe={init:function(){var L=[[r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_SET,"SET"],[r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INSERT,"INSERT"]];this.WHERE_OPTIONS=[[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_IN_LIST),L=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:L}),this.appendDummyInput().appendField(L,"MODE").appendField("","SPACE"),this.appendDummyInput("AT"),this.appendValueInput("TO").appendField(r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_TO),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP),this.updateAt_(!0),this.setTooltip(()=>{const X=this.getFieldValue("MODE"),fe=this.getFieldValue("WHERE");let z="";switch(X+" "+fe){case"SET FROM_START":case"SET FROM_END":z=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM;break;case"SET FIRST":z=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST;break;case"SET LAST":z=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST;break;case"SET RANDOM":z=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM;break;case"INSERT FROM_START":case"INSERT FROM_END":z=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM;break;case"INSERT FIRST":z=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST;break;case"INSERT LAST":z=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST;break;case"INSERT RANDOM":z=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM}return(fe==="FROM_START"||fe==="FROM_END")&&(z+="  "+r.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),z})},mutationToDom:function(){const L=r.createElement$$module$build$src$core$utils$xml("mutation"),X=this.getInput("AT")instanceof r.ValueInput$$module$build$src$core$inputs$value_input;return L.setAttribute("at",String(X)),L},domToMutation:function(L){L=L.getAttribute("at")!=="false",this.updateAt_(L)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(L){this.removeInput("AT"),this.removeInput("ORDINAL",!0),L?(this.appendValueInput("AT").setCheck("Number"),r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT");const X=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS});X.setValidator(function(fe){const z=fe==="FROM_START"||fe==="FROM_END";if(z!==L){const Ae=this.getSourceBlock();return Ae.updateAt_(z),Ae.setFieldValue(fe,"WHERE"),null}}),this.moveInputBefore("AT","TO"),this.getInput("ORDINAL")&&this.moveInputBefore("ORDINAL","TO"),this.getInput("AT").appendField(X,"WHERE")}};St.lists_setIndex=qe;var ut={init:function(){this.WHERE_OPTIONS_1=[[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_LAST,"LAST"]],this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_INPUT_IN_LIST),this.appendDummyInput("AT1"),this.appendDummyInput("AT2"),r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.appendDummyInput("TAIL").appendField(r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TOOLTIP)},mutationToDom:function(){const L=r.createElement$$module$build$src$core$utils$xml("mutation");var X=this.getInput("AT1")instanceof r.ValueInput$$module$build$src$core$inputs$value_input;return L.setAttribute("at1",String(X)),X=this.getInput("AT2")instanceof r.ValueInput$$module$build$src$core$inputs$value_input,L.setAttribute("at2",String(X)),L},domToMutation:function(L){const X=L.getAttribute("at1")==="true";L=L.getAttribute("at2")==="true",this.updateAt_(1,X),this.updateAt_(2,L)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(L,X){this.removeInput("AT"+L),this.removeInput("ORDINAL"+L,!0),X?(this.appendValueInput("AT"+L).setCheck("Number"),r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+L).appendField(r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+L);const fe=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+L]});fe.setValidator(function(z){const Ae=z==="FROM_START"||z==="FROM_END";if(Ae!==X){const tt=this.getSourceBlock();return tt.updateAt_(L,Ae),tt.setFieldValue(z,"WHERE"+L),null}}),this.getInput("AT"+L).appendField(fe,"WHERE"+L),L===1&&(this.moveInputBefore("AT1","AT2"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","AT2")),r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.moveInputBefore("TAIL",null)}};St.lists_getSublist=ut,St.lists_sort={init:function(){this.jsonInit({message0:"%{BKY_LISTS_SORT_TITLE}",args0:[{type:"field_dropdown",name:"TYPE",options:[["%{BKY_LISTS_SORT_TYPE_NUMERIC}","NUMERIC"],["%{BKY_LISTS_SORT_TYPE_TEXT}","TEXT"],["%{BKY_LISTS_SORT_TYPE_IGNORECASE}","IGNORE_CASE"]]},{type:"field_dropdown",name:"DIRECTION",options:[["%{BKY_LISTS_SORT_ORDER_ASCENDING}","1"],["%{BKY_LISTS_SORT_ORDER_DESCENDING}","-1"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_SORT_TOOLTIP}",helpUrl:"%{BKY_LISTS_SORT_HELPURL}"})}},St.lists_split={init:function(){const L=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:[[r.Msg$$module$build$src$core$msg.LISTS_SPLIT_LIST_FROM_TEXT,"SPLIT"],[r.Msg$$module$build$src$core$msg.LISTS_SPLIT_TEXT_FROM_LIST,"JOIN"]]});if(!L)throw Error("field_dropdown not found");L.setValidator(X=>{this.updateType_(X)}),this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_SPLIT_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("INPUT").setCheck("String").appendField(L,"MODE"),this.appendValueInput("DELIM").setCheck("String").appendField(r.Msg$$module$build$src$core$msg.LISTS_SPLIT_WITH_DELIMITER),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.setTooltip(()=>{const X=this.getFieldValue("MODE");if(X==="SPLIT")return r.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_SPLIT;if(X==="JOIN")return r.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_JOIN;throw Error("Unknown mode: "+X)})},updateType_:function(L){if(this.getFieldValue("MODE")!==L){const X=this.getInput("INPUT").connection;X.setShadowDom(null);const fe=X.targetBlock();fe&&(X.disconnect(),fe.isShadow()?fe.dispose(!1):this.bumpNeighbours())}L==="SPLIT"?(this.outputConnection.setCheck("Array"),this.getInput("INPUT").setCheck("String")):(this.outputConnection.setCheck("String"),this.getInput("INPUT").setCheck("Array"))},mutationToDom:function(){const L=r.createElement$$module$build$src$core$utils$xml("mutation");return L.setAttribute("mode",this.getFieldValue("MODE")),L},domToMutation:function(L){this.updateType_(L.getAttribute("mode"))},saveExtraState:function(){return null},loadExtraState:function(){}},r.defineBlocks$$module$build$src$core$common(St);var ft={blocks:St},Ge=Object.assign({},St,Fe,_e,J,U,E,h,s),$t={blocks:Ge,lists:ft,logic:Me,loops:Ye,math:Te,procedures:H,texts:D,variables:T,variablesDynamic:d};return $t.__namespace__=r,$t})})(Roe);const woe=()=>{Dn.forBlock.takeoff=function(){return"flyUp(5, 'CM');"},Dn.forBlock.takeoff_after_seconds=function(i){return`setWaitTime(${i.getFieldValue("SECONDS")}, true);`},Dn.forBlock.capture_image=function(){return"captureImage();"},Dn.forBlock.set_speed=function(i){return`setDroneSpeed(${i.getFieldValue("SPEED")});`},Dn.forBlock.wait=function(i){return`setWaitTime(${i.getFieldValue("SECONDS")}, false);`},Dn.forBlock.flying_forward_distance=function(i){const e=i.getFieldValue("DISTANCE"),n=i.getFieldValue("UNIT");return`flyForward(${e}, '${n}');`},Dn.forBlock.flying_forward_time=function(i){return`flyForward(${i.getFieldValue("SECONDS")}, 'SECONDS');`},Dn.forBlock.flying_backward_distance=function(i){const e=i.getFieldValue("DISTANCE"),n=i.getFieldValue("UNIT");return`flyBackward(${e},'${n}');`},Dn.forBlock.flying_backward_time=function(i){return`flyBackward(${i.getFieldValue("SECONDS")}, 'SECONDS');`},Dn.forBlock.flying_left_distance=function(i){const e=i.getFieldValue("DISTANCE"),n=i.getFieldValue("UNIT");return`flyLeft(${e}, '${n}');`},Dn.forBlock.flying_left_time=function(i){return`flyLeft(${i.getFieldValue("SECONDS")},'SECONDS');`},Dn.forBlock.flying_right_distance=function(i){const e=i.getFieldValue("DISTANCE"),n=i.getFieldValue("UNIT");return`flyRight(${e}, '${n}');`},Dn.forBlock.flying_right_time=function(i){return`flyRight(${i.getFieldValue("SECONDS")},'SECONDS');`},Dn.forBlock.flying_up_distance=function(i){const e=i.getFieldValue("DISTANCE"),n=i.getFieldValue("UNIT");return`flyUp(${e}, '${n}');`},Dn.forBlock.flying_up_time=function(i){return`flyUp(${i.getFieldValue("SECONDS")},'SECONDS');`},Dn.forBlock.flying_down_distance=function(i){const e=i.getFieldValue("DISTANCE"),n=i.getFieldValue("UNIT");return`flyDown(${e}, '${n}');`},Dn.forBlock.flying_down_time=function(i){return`flyDown(${i.getFieldValue("SECONDS")},'SECONDS');`},Dn.forBlock.set_speed=function(i){return`setSpeed(${i.getFieldValue("SPEED")});`},Dn.forBlock.fly=function(i){const e=i.getFieldValue("x"),n=i.getFieldValue("y"),r=i.getFieldValue("z"),s=i.getFieldValue("UNIT");return`moveTo(${e}, ${n}, ${r}, '${s}');`},Dn.forBlock.circle_left=function(i){const e=i.getFieldValue("DISTANCE"),n=i.getFieldValue("UNIT");return`rotateDrone('CIRCLE_LEFT', 360, ${e}, '${n}'); `},Dn.forBlock.circle_right=function(i){const e=i.getFieldValue("DISTANCE"),n=i.getFieldValue("UNIT");return`rotateDrone('CIRCLE_RIGHT', 360, ${e}, '${n}'); `},Dn.forBlock.yaw_left=function(i){return`rotateDrone('LEFT', ${i.getFieldValue("DEGREE")}, null, null); `},Dn.forBlock.yaw_right=function(i){return`rotateDrone('RIGHT', ${i.getFieldValue("DEGREE")}, null, null); `},Dn.forBlock.arc_left=function(i){const e=i.getFieldValue("DEGREE"),n=i.getFieldValue("DISTANCE"),r=i.getFieldValue("UNIT");return`rotateDrone('ARC_LEFT', ${e}, ${n}, '${r}'); `},Dn.forBlock.arc_right=function(i){const e=i.getFieldValue("DEGREE"),n=i.getFieldValue("DISTANCE"),r=i.getFieldValue("UNIT");return`rotateDrone('ARC_RIGHT', ${e}, ${n}, '${r}'); `},Dn.forBlock.land=function(){return"flyDown(-Infinity, 'CM');"},Dn.forBlock.land_for_seconds=function(i){return`flyDown(-Infinity, 'WAIT,${i.getFieldValue("SECONDS")}');`},Dn.forBlock.flip_left=function(){return"flip('LEFT');"},Dn.forBlock.flip_right=function(){return"flip('RIGHT');"},Dn.forBlock.flip_forward=function(){return"flip('FORWARD');"},Dn.forBlock.flip_backward=function(){return"flip('BACKWARD');"},Dn.forBlock.pickup_object=function(i){return`pickupObject('${i.getFieldValue("OBJECT_NAME")}');`},Dn.forBlock.drop_object=function(i){return`dropObject('${i.getFieldValue("OBJECT_NAME")}');`},Dn.forBlock.spray_object=function(i){return`sprayObject('${i.getFieldValue("OBJECT_NAME")}');`},Dn.forBlock.advertise_text=function(i){return`advertiseText('${i.getFieldValue("ADV_TEXT")}');`}},Vt={TAKEOFF:"#3a86ff",NAVIGATION:"#8338ec",LAND:"#fb5607",FLIP:"#3a86ff",LOGIC:"#4ecdc4",LOOPS:"#00bbf9",MATH:"#ffd166",TEXT:"#f15bb5",LISTS:"#9b5de5",VARIABLE:"#08979d",FUNCTIONS:"#0d3b66",ACTIONS:"#ef476f"};woe();const Moe={kind:"categoryToolbox",contents:[{kind:"category",name:"Takeoff",categorystyle:"takeoff_category",contents:[{kind:"block",type:"takeoff"},{kind:"block",type:"takeoff_after_seconds"}]},{kind:"category",name:"Camera",categorystyle:"camera_category",contents:[{kind:"block",type:"capture_image"}]},{kind:"category",name:"Navigation",categorystyle:"navigation_category",contents:[{kind:"block",type:"set_speed"},{kind:"block",type:"wait"},{kind:"block",type:"flying_forward_distance"},{kind:"block",type:"flying_backward_distance"},{kind:"block",type:"flying_left_distance"},{kind:"block",type:"flying_right_distance"},{kind:"block",type:"flying_up_distance"},{kind:"block",type:"flying_down_distance"},{kind:"block",type:"fly"},{kind:"block",type:"arc_left"},{kind:"block",type:"arc_right"},{kind:"block",type:"yaw_left"},{kind:"block",type:"yaw_right"}]},{kind:"category",name:"Flip",categorystyle:"flip_category",contents:[{kind:"block",type:"flip_forward"},{kind:"block",type:"flip_backward"},{kind:"block",type:"flip_left"},{kind:"block",type:"flip_right"}]},{kind:"category",name:"Land",categorystyle:"land_category",contents:[{kind:"block",type:"land"},{kind:"block",type:"land_for_seconds"}]},{kind:"sep"},{kind:"category",name:"Actions",categorystyle:"actions_category",contents:[{kind:"block",type:"pickup_object"},{kind:"block",type:"drop_object"},{kind:"block",type:"spray_object"},{kind:"block",type:"advertise_text"}]},{kind:"category",name:"Logic",categorystyle:"logic_category",contents:[{kind:"block",type:"controls_if"},{kind:"block",type:"logic_compare",fields:{OP:"EQ"}},{kind:"block",type:"logic_operation",fields:{OP:"AND"}},{kind:"block",type:"logic_negate"},{kind:"block",type:"logic_boolean",fields:{BOOL:"TRUE"}}]},{kind:"category",name:"Loops",categorystyle:"loop_category",contents:[{kind:"block",type:"controls_repeat_ext",inputs:{TIMES:{shadow:{kind:"block",type:"math_number",fields:{NUM:10}}}}},{kind:"block",type:"controls_whileUntil",fields:{MODE:"WHILE"}}]},{kind:"category",name:"Math",categorystyle:"math_category",contents:[{kind:"block",type:"math_number",fields:{NUM:123}},{kind:"block",type:"math_arithmetic",fields:{OP:"ADD"},inputs:{A:{shadow:{kind:"block",type:"math_number",fields:{NUM:1}}},B:{shadow:{kind:"block",type:"math_number",fields:{NUM:1}}}}},{kind:"block",type:"math_single",fields:{OP:"ROOT"},inputs:{NUM:{shadow:{kind:"block",type:"math_number",fields:{NUM:9}}}}},{kind:"block",type:"math_trig",fields:{OP:"SIN"},inputs:{NUM:{shadow:{kind:"block",type:"math_number",fields:{NUM:45}}}}},{kind:"block",type:"math_constant",fields:{CONSTANT:"PI"}},{kind:"block",type:"math_number_property",fields:{PROPERTY:"EVEN"},inputs:{NUMBER_TO_CHECK:{shadow:{kind:"block",type:"math_number",fields:{NUM:0}}}}},{kind:"block",type:"math_round",fields:{OP:"ROUND"},inputs:{NUM:{shadow:{kind:"block",type:"math_number",fields:{NUM:3.1}}}}},{kind:"block",type:"math_on_list",fields:{OP:"SUM"}},{kind:"block",type:"math_modulo",inputs:{DIVIDEND:{shadow:{kind:"block",type:"math_number",fields:{NUM:64}}},DIVISOR:{shadow:{kind:"block",type:"math_number",fields:{NUM:10}}}}},{kind:"block",type:"math_constrain",inputs:{VALUE:{shadow:{kind:"block",type:"math_number",fields:{NUM:50}}},LOW:{shadow:{kind:"block",type:"math_number",fields:{NUM:1}}},HIGH:{shadow:{kind:"block",type:"math_number",fields:{NUM:100}}}}},{kind:"block",type:"math_random_int",inputs:{FROM:{shadow:{kind:"block",type:"math_number",fields:{NUM:1}}},TO:{shadow:{kind:"block",type:"math_number",fields:{NUM:100}}}}},{kind:"block",type:"math_random_float"}]},{kind:"category",name:"Text",categorystyle:"text_category",contents:[{kind:"block",type:"text",fields:{TEXT:""}},{kind:"block",type:"text_length"},{kind:"block",type:"text_print"}]},{kind:"category",name:"Lists",categorystyle:"list_category",contents:[{kind:"block",type:"lists_create_with"},{kind:"block",type:"lists_create_with"},{kind:"block",type:"lists_repeat",inputs:{NUM:{shadow:{kind:"block",type:"math_number",fields:{NUM:5}}}}},{kind:"block",type:"lists_length"},{kind:"block",type:"lists_isEmpty"},{kind:"block",type:"lists_indexOf",fields:{END:"FIRST"},inputs:{VALUE:{block:{kind:"block",type:"variables_get",fields:{VAR:{name:"list"}}}}}},{type:"lists_split",kind:"block",fields:{MODE:"SPLIT"},inputs:{DELIM:{shadow:{type:"text",fields:{TEXT:","}}}}},{type:"lists_sort",kind:"block",fields:{TYPE:"NUMERIC",DIRECTION:"1"}}]},{kind:"sep"},{kind:"category",name:"Variables",custom:"VARIABLE",categorystyle:"variable_category"},{kind:"category",name:"Functions",custom:"PROCEDURE",categorystyle:"functions_category"}]},Ioe=i=>{i.Blocks.takeoff={init:function(){this.appendDummyInput().appendField("Take off"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.TAKEOFF),this.setTooltip("Command to take off"),this.setHelpUrl("")}},i.Blocks.takeoff_after_seconds={init:function(){this.appendDummyInput().appendField("take off after").appendField(new i.FieldNumber(0,0,60),"SECONDS").appendField("seconds"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.TAKEOFF),this.setTooltip("Command to take off after a specific number of seconds"),this.setHelpUrl("")}},i.Blocks.capture_image={init:function(){this.appendDummyInput().appendField("capture"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.TAKEOFF),this.setTooltip("Command to take image"),this.setHelpUrl("")}},i.Blocks.set_speed={init:function(){this.appendDummyInput().appendField("set speed").appendField(new i.FieldDropdown([["25","1"],["50","2"],["75","3"],["100","4"]]),"SPEED").appendField("cm/s"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to set drone speed"),this.setHelpUrl("")}},i.Blocks.wait={init:function(){this.appendDummyInput().appendField("wait").appendField(new i.FieldNumber(0,0,60),"SECONDS").appendField("seconds"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to set wait time for drone"),this.setHelpUrl("")}},i.Blocks.flying_forward_distance={init:function(){this.appendDummyInput().appendField("fly forward").appendField(new i.FieldNumber(0,0,null),"DISTANCE").appendField(new i.FieldDropdown([["inches","INCHES"],["cm","CM"]]),"UNIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to fly forward a certain distance in inches or cm"),this.setHelpUrl("")}},i.Blocks.flying_forward_time={init:function(){this.appendDummyInput().appendField("fly forward").appendField(new i.FieldNumber(0,0,60),"SECONDS").appendField("seconds"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to set wait time for drone"),this.setHelpUrl("")}},i.Blocks.flying_backward_distance={init:function(){this.appendDummyInput().appendField("fly backward").appendField(new i.FieldNumber(0,0,null),"DISTANCE").appendField(new i.FieldDropdown([["inches","INCHES"],["cm","CM"]]),"UNIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to fly backward a certain distance in inches or cm"),this.setHelpUrl("")}},i.Blocks.flying_backward_time={init:function(){this.appendDummyInput().appendField("fly backward").appendField(new i.FieldNumber(0,0,60),"SECONDS").appendField("seconds"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to set wait time for drone"),this.setHelpUrl("")}},i.Blocks.flying_left_distance={init:function(){this.appendDummyInput().appendField("fly left").appendField(new i.FieldNumber(0,0,null),"DISTANCE").appendField(new i.FieldDropdown([["inches","INCHES"],["cm","CM"]]),"UNIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to fly left a certain distance in inches or cm"),this.setHelpUrl("")}},i.Blocks.flying_left_time={init:function(){this.appendDummyInput().appendField("fly left").appendField(new i.FieldNumber(0,0,60),"SECONDS").appendField("seconds"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to set wait time for drone"),this.setHelpUrl("")}},i.Blocks.flying_right_distance={init:function(){this.appendDummyInput().appendField("fly right").appendField(new i.FieldNumber(0,0,null),"DISTANCE").appendField(new i.FieldDropdown([["inches","INCHES"],["cm","CM"]]),"UNIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to fly right a certain distance in inches or cm"),this.setHelpUrl("")}},i.Blocks.flying_right_time={init:function(){this.appendDummyInput().appendField("fly right").appendField(new i.FieldNumber(0,0,60),"SECONDS").appendField("seconds"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to set wait time for drone"),this.setHelpUrl("")}},i.Blocks.flying_up_distance={init:function(){this.appendDummyInput().appendField("fly up").appendField(new i.FieldNumber(0,0,null),"DISTANCE").appendField(new i.FieldDropdown([["inches","INCHES"],["cm","CM"]]),"UNIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to fly up a certain distance in inches or cm"),this.setHelpUrl("")}},i.Blocks.flying_up_time={init:function(){this.appendDummyInput().appendField("fly up").appendField(new i.FieldNumber(0,0,60),"SECONDS").appendField("seconds"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to set wait time for drone"),this.setHelpUrl("")}},i.Blocks.flying_down_distance={init:function(){this.appendDummyInput().appendField("fly down").appendField(new i.FieldNumber(0,0,null),"DISTANCE").appendField(new i.FieldDropdown([["inches","INCHES"],["cm","CM"]]),"UNIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to fly down a certain distance in inches or cm"),this.setHelpUrl("")}},i.Blocks.flying_down_time={init:function(){this.appendDummyInput().appendField("fly down").appendField(new i.FieldNumber(0,0,60),"SECONDS").appendField("seconds"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to set wait time for drone"),this.setHelpUrl("")}},i.Blocks.fly={init:function(){this.appendDummyInput().appendField("fly x").appendField(new i.FieldNumber(0,-1/0,null),"x").appendField("y").appendField(new i.FieldNumber(0,-1/0,null),"y").appendField("z").appendField(new i.FieldNumber(0,-1/0,null),"z").appendField(new i.FieldDropdown([["inches","INCHES"],["cm","CM"]]),"UNIT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to set wait time for drone"),this.setHelpUrl("")}},i.Blocks.arc_left={init:function(){this.appendDummyInput().appendField("arc left").appendField(new i.FieldNumber(0,0,null),"DEGREE").appendField(" degrees with ").appendField(new i.FieldNumber(0,0,null),"DISTANCE").appendField(new i.FieldDropdown([["inches","INCHES"],["cm","CM"]]),"UNIT").appendField(" radius"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to arc left a certain number of degrees and distance with radius in inches or cm"),this.setHelpUrl("")}},i.Blocks.arc_right={init:function(){this.appendDummyInput().appendField("arc right").appendField(new i.FieldNumber(0,0,null),"DEGREE").appendField(" degrees with ").appendField(new i.FieldNumber(0,0,null),"DISTANCE").appendField(new i.FieldDropdown([["inches","INCHES"],["cm","CM"]]),"UNIT").appendField(" radius"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to arc right a certain number of degrees and distance with radius in inches or cm"),this.setHelpUrl("")}},i.Blocks.circle_left={init:function(){this.appendDummyInput().appendField("circle left with ").appendField(new i.FieldNumber(0,0,null),"DISTANCE").appendField(new i.FieldDropdown([["inches","INCHES"],["cm","CM"]]),"UNIT").appendField(" radius"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to fly in a circle to the left with a given radius in inches or cm"),this.setHelpUrl("")}},i.Blocks.circle_right={init:function(){this.appendDummyInput().appendField("circle right with ").appendField(new i.FieldNumber(0,0,null),"DISTANCE").appendField(new i.FieldDropdown([["inches","INCHES"],["cm","CM"]]),"UNIT").appendField(" radius"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to fly in a circle to the right with a given radius in inches or cm"),this.setHelpUrl("")}},i.Blocks.yaw_left={init:function(){this.appendDummyInput().appendField("yaw left").appendField(new i.FieldNumber(0,0,null),"DEGREE").appendField(" degrees"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to yaw left by a certain number of degrees"),this.setHelpUrl("")}},i.Blocks.yaw_right={init:function(){this.appendDummyInput().appendField("yaw right").appendField(new i.FieldNumber(0,0,null),"DEGREE").appendField(" degrees"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.NAVIGATION),this.setTooltip("Command to yaw right by a certain number of degrees"),this.setHelpUrl("")}},i.Blocks.flip_left={init:function(){this.appendDummyInput().appendField("flip left"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.FLIP),this.setTooltip("Command to flip left"),this.setHelpUrl("")}},i.Blocks.flip_right={init:function(){this.appendDummyInput().appendField("flip right"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.FLIP),this.setTooltip("Command to flip right"),this.setHelpUrl("")}},i.Blocks.flip_forward={init:function(){this.appendDummyInput().appendField("flip forward"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.FLIP),this.setTooltip("Command to flip forward"),this.setHelpUrl("")}},i.Blocks.flip_backward={init:function(){this.appendDummyInput().appendField("flip backward"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.FLIP),this.setTooltip("Command to flip backward"),this.setHelpUrl("")}},i.Blocks.land={init:function(){this.appendDummyInput().appendField("land"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.LAND),this.setTooltip("Command to land"),this.setHelpUrl("")}},i.Blocks.land_for_seconds={init:function(){this.appendDummyInput().appendField("land for ").appendField(new i.FieldNumber(0,0,60),"SECONDS").appendField("seconds then takeoff"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.LAND),this.setTooltip("Command to take off after a specific number of seconds"),this.setHelpUrl("")}},i.Blocks.pickup_object={init:function(){this.appendDummyInput().appendField("pick up object").appendField(new i.FieldTextInput("book1"),"OBJECT_NAME"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.ACTIONS),this.setTooltip("Pick up an object by name"),this.setHelpUrl("")}},i.Blocks.drop_object={init:function(){this.appendDummyInput().appendField("drop object").appendField(new i.FieldTextInput("book1"),"OBJECT_NAME"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.ACTIONS),this.setTooltip("Drop an object by name"),this.setHelpUrl("")}},i.Blocks.spray_object={init:function(){this.appendDummyInput().appendField("spray").appendField(new i.FieldTextInput("watercan"),"OBJECT_NAME"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.ACTIONS),this.setTooltip("Spray water or pesticide from a can"),this.setHelpUrl("")}},i.Blocks.advertise_text={init:function(){this.appendDummyInput().appendField("advertise").appendField(new i.FieldTextInput("Sale"),"ADV_TEXT"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(Vt.ACTIONS),this.setTooltip("Text for drone flyer"),this.setHelpUrl("")}}},Ooe=A2.defineTheme("modern",{base:C2.Classic,blockStyles:{list_blocks:{colourPrimary:Vt.LISTS,colourSecondary:Vt.LISTS,colourTertiary:Vt.LISTS},logic_blocks:{colourPrimary:Vt.LOGIC,colourSecondary:Vt.LOGIC,colourTertiary:Vt.LOGIC},loop_blocks:{colourPrimary:Vt.LOOPS,colourSecondary:Vt.LOOPS,colourTertiary:Vt.LOOPS},math_blocks:{colourPrimary:Vt.MATH,colourSecondary:Vt.MATH,colourTertiary:Vt.MATH},procedure_blocks:{colourPrimary:Vt.FUNCTIONS,colourSecondary:Vt.FUNCTIONS,colourTertiary:Vt.FUNCTIONS},text_blocks:{colourPrimary:Vt.TEXT,colourSecondary:Vt.TEXT,colourTertiary:Vt.TEXT},variable_blocks:{colourPrimary:Vt.VARIABLE,colourSecondary:Vt.VARIABLE,colourTertiary:Vt.VARIABLE}},categoryStyles:{takeoff_category:{colour:Vt.TAKEOFF},camera_category:{colour:Vt.LAND},navigation_category:{colour:Vt.NAVIGATION},land_category:{colour:Vt.LAND},flip_category:{colour:Vt.FLIP},logic_category:{colour:Vt.LOGIC},loop_category:{colour:Vt.LOOPS},math_category:{colour:Vt.MATH},text_category:{colour:Vt.TEXT},list_category:{colour:Vt.LISTS},variable_category:{colour:Vt.VARIABLE},functions_category:{colour:Vt.FUNCTIONS},actions_category:{colour:Vt.ACTIONS}},componentStyles:{flyoutOpacity:.4},startHats:null});var M2={exports:{}};const Loe={},Noe=Object.freeze(Object.defineProperty({__proto__:null,default:Loe},Symbol.toStringTag,{value:"Module"})),koe=YG(Noe);(function(i,e){(function(r,s){i.exports=s()})(qf,()=>(()=>{var n={"./original-repo/interpreter.js":function(l,u,d){/**
 * @license
 * Copyright 2013 Neil Fraser
 * SPDX-License-Identifier: Apache-2.0
 */var h=function(f,p){typeof f=="string"&&(f=this.parse_(f,"code"));var m=f.constructor;this.newNode=function(){return new m({options:{}})};var T=this.newNode();for(var E in f)T[E]=E==="body"?f[E].slice():f[E];this.ast=T,this.tasks=[],this.initFunc_=p,this.paused_=!1,this.polyfills_=[],this.functionCounter_=0,this.stepFunctions_=Object.create(null);var b=/^step([A-Z]\w*)$/,y;for(var S in this)typeof this[S]=="function"&&(y=S.match(b))&&(this.stepFunctions_[y[1]]=this[S].bind(this));this.globalScope=this.createScope(this.ast,null),this.globalObject=this.globalScope.object,this.ast=this.parse_(this.polyfills_.join(`
`),"polyfills"),this.polyfills_=void 0,h.stripLocations_(this.ast,void 0,void 0);var A=new h.State(this.ast,this.globalScope);A.done=!1,this.stateStack=[A],this.run(),this.value=void 0,this.ast=T,A=new h.State(this.ast,this.globalScope),A.done=!1,this.stateStack.length=0,this.stateStack[0]=A};h.Completion={NORMAL:0,BREAK:1,CONTINUE:2,RETURN:3,THROW:4},h.Status={DONE:0,STEP:1,TASK:2,ASYNC:3},h.PARSE_OPTIONS={locations:!0,ecmaVersion:5},h.READONLY_DESCRIPTOR={configurable:!0,enumerable:!0,writable:!1},h.NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!0},h.READONLY_NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!1},h.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR={configurable:!1,enumerable:!1,writable:!1},h.VARIABLE_DESCRIPTOR={configurable:!1,enumerable:!0,writable:!0},h.STEP_ERROR={STEP_ERROR:!0},h.SCOPE_REFERENCE={SCOPE_REFERENCE:!0},h.VALUE_IN_DESCRIPTOR={VALUE_IN_DESCRIPTOR:!0},h.REGEXP_TIMEOUT={REGEXP_TIMEOUT:!0},h.toStringCycles_=[],h.vm=null,h.currentInterpreter_=null,h.nativeGlobal=typeof globalThis>"u"?this||window:globalThis,h.WORKER_CODE=["onmessage = function(e) {","var result;","var data = e.data;","switch (data[0]) {","case 'split':","result = data[1].split(data[2], data[3]);","break;","case 'match':","result = data[1].match(data[2]);","break;","case 'search':","result = data[1].search(data[2]);","break;","case 'replace':","result = data[1].replace(data[2], data[3]);","break;","case 'exec':","var regexp = data[1];","regexp.lastIndex = data[2];","result = [regexp.exec(data[3]), data[1].lastIndex];","break;","default:","throw Error('Unknown RegExp operation: ' + data[0]);","}","postMessage(result);","close();","};"],h.legalArrayLength=function(f){var p=f>>>0;return p===Number(f)?p:NaN},h.legalArrayIndex=function(f){var p=f>>>0;return String(p)===String(f)&&p!==4294967295?p:NaN},h.stripLocations_=function(f,p,m){p?f.start=p:delete f.start,m?f.end=m:delete f.end;for(var T in f)if(T!=="loc"&&f.hasOwnProperty(T)){var E=f[T];E&&typeof E=="object"&&h.stripLocations_(E,p,m)}},h.prototype.REGEXP_MODE=2,h.prototype.REGEXP_THREAD_TIMEOUT=1e3,h.prototype.POLYFILL_TIMEOUT=1e3,h.prototype.getterStep_=!1,h.prototype.setterStep_=!1,h.prototype.appendCodeNumber_=0,h.prototype.taskCodeNumber_=0,h.prototype.parse_=function(f,p){var m={};for(var T in h.PARSE_OPTIONS)m[T]=h.PARSE_OPTIONS[T];return m.sourceFile=p,h.nativeGlobal.acorn.parse(f,m)},h.prototype.appendCode=function(f){var p=this.stateStack[0];if(!p||p.node.type!=="Program")throw Error("Expecting original AST to start with a Program node");if(typeof f=="string"&&(f=this.parse_(f,"appendCode"+this.appendCodeNumber_++)),!f||f.type!=="Program")throw Error("Expecting new AST to start with a Program node");this.populateScope_(f,p.scope),Array.prototype.push.apply(p.node.body,f.body),p.node.body.variableCache_=null,p.done=!1},h.prototype.step=function(){var f=this.stateStack,p;do{var m=f[f.length-1];if(this.paused_)return!0;if(!m||m.node.type==="Program"&&m.done){if(!this.tasks.length)return!1;if(m=this.nextTask_(),!m)return!0}var T=m.node,E=h.currentInterpreter_;h.currentInterpreter_=this;try{var b=this.stepFunctions_[T.type](f,m,T)}catch(y){if(y!==h.STEP_ERROR)throw this.value!==y&&(this.value=void 0),y}finally{h.currentInterpreter_=E}if(b&&f.push(b),this.getterStep_)throw this.value=void 0,Error("Getter not supported in this context");if(this.setterStep_)throw this.value=void 0,Error("Setter not supported in this context");!p&&!T.end&&(p=Date.now()+this.POLYFILL_TIMEOUT)}while(!T.end&&p>Date.now());return!0},h.prototype.run=function(){for(;!this.paused_&&this.step(););return this.paused_},h.prototype.getStatus=function(){if(this.paused_)return h.Status.ASYNC;var f=this.stateStack,p=f[f.length-1];if(p&&(p.node.type!=="Program"||!p.done))return h.Status.STEP;var m=this.tasks[0];return m?m.time>Date.now()?h.Status.TASK:h.Status.STEP:h.Status.DONE},h.prototype.initGlobal=function(f){this.setProperty(f,"NaN",NaN,h.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(f,"Infinity",1/0,h.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(f,"undefined",void 0,h.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(f,"window",f,h.READONLY_DESCRIPTOR),this.setProperty(f,"this",f,h.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(f,"self",f),this.OBJECT_PROTO=new h.Object(null),this.FUNCTION_PROTO=new h.Object(this.OBJECT_PROTO),this.initFunction(f),this.initObject(f),f.proto=this.OBJECT_PROTO,this.setProperty(f,"constructor",this.OBJECT,h.NONENUMERABLE_DESCRIPTOR),this.initArray(f),this.initString(f),this.initBoolean(f),this.initNumber(f),this.initDate(f),this.initRegExp(f),this.initError(f),this.initMath(f),this.initJSON(f);var p=this,m,T=this.createNativeFunction(function(y){throw EvalError("Can't happen")},!1);T.eval=!0,this.setProperty(f,"eval",T,h.NONENUMERABLE_DESCRIPTOR),this.setProperty(f,"parseInt",this.createNativeFunction(parseInt,!1),h.NONENUMERABLE_DESCRIPTOR),this.setProperty(f,"parseFloat",this.createNativeFunction(parseFloat,!1),h.NONENUMERABLE_DESCRIPTOR),this.setProperty(f,"isNaN",this.createNativeFunction(isNaN,!1),h.NONENUMERABLE_DESCRIPTOR),this.setProperty(f,"isFinite",this.createNativeFunction(isFinite,!1),h.NONENUMERABLE_DESCRIPTOR);for(var E=[[escape,"escape"],[unescape,"unescape"],[decodeURI,"decodeURI"],[decodeURIComponent,"decodeURIComponent"],[encodeURI,"encodeURI"],[encodeURIComponent,"encodeURIComponent"]],b=0;b<E.length;b++)m=function(y){return function(S){try{return y(S)}catch(A){p.throwException(p.URI_ERROR,A.message)}}}(E[b][0]),this.setProperty(f,E[b][1],this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR);m=function(S){return p.createTask_(!1,arguments)},this.setProperty(f,"setTimeout",this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR),m=function(S){return p.createTask_(!0,arguments)},this.setProperty(f,"setInterval",this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR),m=function(S){p.deleteTask_(S)},this.setProperty(f,"clearTimeout",this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR),m=function(S){p.deleteTask_(S)},this.setProperty(f,"clearInterval",this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR),this.OBJECT=this.OBJECT,this.OBJECT_PROTO=this.OBJECT_PROTO,this.FUNCTION=this.FUNCTION,this.FUNCTION_PROTO=this.FUNCTION_PROTO,this.ARRAY=this.ARRAY,this.ARRAY_PROTO=this.ARRAY_PROTO,this.REGEXP=this.REGEXP,this.REGEXP_PROTO=this.REGEXP_PROTO,this.DATE=this.DATE,this.DATE_PROTO=this.DATE_PROTO,this.initFunc_&&this.initFunc_(this,f)},h.prototype.functionCodeNumber_=0,h.prototype.initFunction=function(f){var p=this,m,T=/^[A-Za-z_$][\w$]*$/;m=function(b){if(arguments.length)var y=String(arguments[arguments.length-1]);else var y="";var S=Array.prototype.slice.call(arguments,0,-1).join(",").trim();if(S){for(var A=S.split(/\s*,\s*/),C=0;C<A.length;C++){var R=A[C];T.test(R)||p.throwException(p.SYNTAX_ERROR,"Invalid function argument: "+R)}S=A.join(", ")}try{var I=p.parse_("(function("+S+") {"+y+"})","function"+p.functionCodeNumber_++)}catch(F){p.throwException(p.SYNTAX_ERROR,"Invalid code: "+F.message)}I.body.length!==1&&p.throwException(p.SYNTAX_ERROR,"Invalid code in function body");var O=I.body[0].expression;return p.createFunction(O,p.globalScope,"anonymous")},this.FUNCTION=this.createNativeFunction(m,!0),this.setProperty(f,"Function",this.FUNCTION,h.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.FUNCTION,"prototype",this.FUNCTION_PROTO,h.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.FUNCTION_PROTO,"constructor",this.FUNCTION,h.NONENUMERABLE_DESCRIPTOR),this.FUNCTION_PROTO.nativeFunc=function(){},this.FUNCTION_PROTO.nativeFunc.id=this.functionCounter_++,this.FUNCTION_PROTO.illegalConstructor=!0,this.setProperty(this.FUNCTION_PROTO,"length",0,h.READONLY_NONENUMERABLE_DESCRIPTOR),this.FUNCTION_PROTO.class="Function",m=function(b,y,S){var A=p.stateStack[p.stateStack.length-1];A.func_=b,A.funcThis_=y,A.arguments_=[],S!=null&&(S instanceof h.Object?A.arguments_=Array.from(S.properties):p.throwException(p.TYPE_ERROR,"CreateListFromArrayLike called on non-object")),A.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"apply",m),this.polyfills_.push("(function() {","var apply_ = Function.prototype.apply;","Function.prototype.apply = function apply(thisArg, args) {","var a2 = [];","for (var i = 0; i < args.length; i++) {","a2[i] = args[i];","}","return apply_(this, thisArg, a2);","};","})();"),m=function(b){var y=p.stateStack[p.stateStack.length-1];y.func_=this,y.funcThis_=b,y.arguments_=[];for(var S=1;S<arguments.length;S++)y.arguments_.push(arguments[S]);y.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"call",m),this.polyfills_.push("Object.defineProperty(Function.prototype, 'bind',","{configurable: true, writable: true, value:","function bind(oThis) {","if (typeof this !== 'function') {","throw TypeError('What is trying to be bound is not callable');","}","var aArgs   = Array.prototype.slice.call(arguments, 1),","fToBind = this,","fNOP    = function() {},","fBound  = function() {","return fToBind.apply(this instanceof fNOP","? this",": oThis,","aArgs.concat(Array.prototype.slice.call(arguments)));","};","if (this.prototype) {","fNOP.prototype = this.prototype;","}","fBound.prototype = new fNOP();","return fBound;","}","});",""),m=function(){return String(this)},this.setNativeFunctionPrototype(this.FUNCTION,"toString",m),this.setProperty(this.FUNCTION,"toString",this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR),m=function(){return this.valueOf()},this.setNativeFunctionPrototype(this.FUNCTION,"valueOf",m),this.setProperty(this.FUNCTION,"valueOf",this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR)},h.prototype.initObject=function(f){var p=this,m;m=function(b){if(b==null)return p.calledWithNew()?this:p.createObjectProto(p.OBJECT_PROTO);if(!(b instanceof h.Object)){var y=p.createObjectProto(p.getPrototype(b));return y.data=b,y}return b},this.OBJECT=this.createNativeFunction(m,!0),this.setProperty(this.OBJECT,"prototype",this.OBJECT_PROTO,h.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.OBJECT_PROTO,"constructor",this.OBJECT,h.NONENUMERABLE_DESCRIPTOR),this.setProperty(f,"Object",this.OBJECT,h.NONENUMERABLE_DESCRIPTOR);var T=function(E){E==null&&p.throwException(p.TYPE_ERROR,"Cannot convert '"+E+"' to object")};m=function(b){T(b);var y=b instanceof h.Object?b.properties:b;return p.nativeToPseudo(Object.getOwnPropertyNames(y))},this.setProperty(this.OBJECT,"getOwnPropertyNames",this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR),m=function(b){return T(b),b instanceof h.Object&&(b=b.properties),p.nativeToPseudo(Object.keys(b))},this.setProperty(this.OBJECT,"keys",this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR),m=function(b){return b===null?p.createObjectProto(null):(b instanceof h.Object||p.throwException(p.TYPE_ERROR,"Object prototype may only be an Object or null, not "+b),p.createObjectProto(b))},this.setProperty(this.OBJECT,"create",this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var create_ = Object.create;","Object.create = function create(proto, props) {","var obj = create_(proto);","props && Object.defineProperties(obj, props);","return obj;","};","})();",""),m=function(b,y,S){return y=String(y),b instanceof h.Object||p.throwException(p.TYPE_ERROR,"Object.defineProperty called on non-object: "+b),S instanceof h.Object||p.throwException(p.TYPE_ERROR,"Property description must be an object"),b.preventExtensions&&!(y in b.properties)&&p.throwException(p.TYPE_ERROR,"Can't define property '"+y+"', object is not extensible"),p.setProperty(b,y,h.VALUE_IN_DESCRIPTOR,S.properties),b},this.setProperty(this.OBJECT,"defineProperty",this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var defineProperty_ = Object.defineProperty;","Object.defineProperty = function defineProperty(obj, prop, d1) {","var d2 = {};","if ('configurable' in d1) d2.configurable = d1.configurable;","if ('enumerable' in d1) d2.enumerable = d1.enumerable;","if ('writable' in d1) d2.writable = d1.writable;","if ('value' in d1) d2.value = d1.value;","if ('get' in d1) d2.get = d1.get;","if ('set' in d1) d2.set = d1.set;","return defineProperty_(obj, prop, d2);","};","})();","Object.defineProperty(Object, 'defineProperties',","{configurable: true, writable: true, value:","function defineProperties(obj, props) {","var keys = Object.keys(props);","for (var i = 0; i < keys.length; i++) {","Object.defineProperty(obj, keys[i], props[keys[i]]);","}","return obj;","}","});",""),m=function(b,y){if(b instanceof h.Object||p.throwException(p.TYPE_ERROR,"Object.getOwnPropertyDescriptor called on non-object: "+b),y=String(y),y in b.properties){var S=Object.getOwnPropertyDescriptor(b.properties,y),A=b.getter[y],C=b.setter[y],R=p.createObjectProto(p.OBJECT_PROTO);return A||C?(p.setProperty(R,"get",A),p.setProperty(R,"set",C)):(p.setProperty(R,"value",S.value),p.setProperty(R,"writable",S.writable)),p.setProperty(R,"configurable",S.configurable),p.setProperty(R,"enumerable",S.enumerable),R}},this.setProperty(this.OBJECT,"getOwnPropertyDescriptor",this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR),m=function(b){return T(b),p.getPrototype(b)},this.setProperty(this.OBJECT,"getPrototypeOf",this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR),m=function(b){return!!b&&!b.preventExtensions},this.setProperty(this.OBJECT,"isExtensible",this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR),m=function(b){return b instanceof h.Object&&(b.preventExtensions=!0),b},this.setProperty(this.OBJECT,"preventExtensions",this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR),this.setNativeFunctionPrototype(this.OBJECT,"toString",h.Object.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"toLocaleString",h.Object.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"valueOf",h.Object.prototype.valueOf),m=function(b){return T(this),this instanceof h.Object?String(b)in this.properties:this.hasOwnProperty(b)},this.setNativeFunctionPrototype(this.OBJECT,"hasOwnProperty",m),m=function(b){return T(this),this instanceof h.Object?Object.prototype.propertyIsEnumerable.call(this.properties,b):this.propertyIsEnumerable(b)},this.setNativeFunctionPrototype(this.OBJECT,"propertyIsEnumerable",m),m=function(b){for(;;){if(b=p.getPrototype(b),!b)return!1;if(b===this)return!0}},this.setNativeFunctionPrototype(this.OBJECT,"isPrototypeOf",m)},h.prototype.initArray=function(f){var p=this,m;m=function(E){if(p.calledWithNew())var b=this;else var b=p.createArray();var y=arguments[0];if(arguments.length===1&&typeof y=="number")isNaN(h.legalArrayLength(y))&&p.throwException(p.RANGE_ERROR,"Invalid array length: "+y),b.properties.length=y;else{for(var S=0;S<arguments.length;S++)b.properties[S]=arguments[S];b.properties.length=S}return b},this.ARRAY=this.createNativeFunction(m,!0),this.ARRAY_PROTO=this.ARRAY.properties.prototype,this.setProperty(f,"Array",this.ARRAY,h.NONENUMERABLE_DESCRIPTOR),m=function(E){return E&&E.class==="Array"},this.setProperty(this.ARRAY,"isArray",this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ARRAY_PROTO,"length",0,{configurable:!1,enumerable:!1,writable:!0}),this.ARRAY_PROTO.class="Array",this.polyfills_.push("(function() {","function createArrayMethod_(name, func) {","Object.defineProperty(func, 'name', {value: name});","Object.defineProperty(Array.prototype, name,","{configurable: true, writable: true, value: func});","}","createArrayMethod_('pop',","function() {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","if (!len || len < 0) {","o.length = 0;","return undefined;","}","len--;","var x = o[len];","delete o[len];","o.length = len;","return x;","}",");","createArrayMethod_('push',","function(var_args) {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","for (var i = 0; i < arguments.length; i++) {","o[len] = arguments[i];","len++;","}","o.length = len;","return len;","}",");","createArrayMethod_('shift',","function() {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","if (!len || len < 0) {","o.length = 0;","return undefined;","}","var value = o[0];","for (var i = 0; i < len - 1; i++) {","if ((i + 1) in o) {","o[i] = o[i + 1];","} else {","delete o[i];","}","}","delete o[i];","o.length = len - 1;","return value;","}",");","createArrayMethod_('unshift',","function(var_args) {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","if (!len || len < 0) {","len = 0;","}","for (var i = len - 1; i >= 0; i--) {","if (i in o) {","o[i + arguments.length] = o[i];","} else {","delete o[i + arguments.length];","}","}","for (var i = 0; i < arguments.length; i++) {","o[i] = arguments[i];","}","return (o.length = len + arguments.length);","}",");","createArrayMethod_('reverse',","function() {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","if (!len || len < 2) {","return o;","}","for (var i = 0; i < len / 2 - 0.5; i++) {","var x = o[i];","var hasX = i in o;","if ((len - i - 1) in o) {","o[i] = o[len - i - 1];","} else {","delete o[i];","}","if (hasX) {","o[len - i - 1] = x;","} else {","delete o[len - i - 1];","}","}","return o;","}",");","createArrayMethod_('indexOf',","function(searchElement, fromIndex) {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","var n = fromIndex | 0;","if (!len || n >= len) {","return -1;","}","var i = Math.max(n >= 0 ? n : len - Math.abs(n), 0);","while (i < len) {","if (i in o && o[i] === searchElement) {","return i;","}","i++;","}","return -1;","}",");","createArrayMethod_('lastIndexOf',","function(searchElement, fromIndex) {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","if (!len) {","return -1;","}","var n = len - 1;","if (arguments.length > 1) {","n = fromIndex | 0;","if (n) {","n = (n > 0 || -1) * Math.floor(Math.abs(n));","}","}","var i = n >= 0 ? Math.min(n, len - 1) : len - Math.abs(n);","while (i >= 0) {","if (i in o && o[i] === searchElement) {","return i;","}","i--;","}","return -1;","}",");","createArrayMethod_('slice',","function(start, end) {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","start |= 0;","start = (start >= 0) ? start : Math.max(0, len + start);","if (typeof end !== 'undefined') {","if (end !== Infinity) {","end |= 0;","}","if (end < 0) {","end = len + end;","} else {","end = Math.min(end, len);","}","} else {","end = len;","}","var size = end - start;","var cloned = new Array(size);","for (var i = 0; i < size; i++) {","if ((start + i) in o) {","cloned[i] = o[start + i];","}","}","return cloned;","}",");","createArrayMethod_('splice',","function(start, deleteCount, var_args) {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","start |= 0;","if (start < 0) {","start = Math.max(len + start, 0);","} else {","start = Math.min(start, len);","}","if (arguments.length < 2) {","deleteCount = len - start;","} else {","deleteCount |= 0;","deleteCount = Math.max(0, Math.min(deleteCount, len - start));","}","var removed = [];","for (var i = start; i < start + deleteCount; i++) {","if (i in o) {","removed.push(o[i]);","} else {","removed.length++;","}","if ((i + deleteCount) in o) {","o[i] = o[i + deleteCount];","} else {","delete o[i];","}","}","for (var i = start + deleteCount; i < len - deleteCount; i++) {","if ((i + deleteCount) in o) {","o[i] = o[i + deleteCount];","} else {","delete o[i];","}","}","for (var i = len - deleteCount; i < len; i++) {","delete o[i];","}","len -= deleteCount;","if (arguments.length > 2) {","var arl = arguments.length - 2;","for (var i = len - 1; i >= start; i--) {","if (i in o) {","o[i + arl] = o[i];","} else {","delete o[i + arl];","}","}","len += arl;","for (var i = 2; i < arguments.length; i++) {","o[start + i - 2] = arguments[i];","}","}","o.length = len;","return removed;","}",");","createArrayMethod_('concat',","function(var_args) {","if (!this) throw TypeError();","var o = Object(this);","var cloned = [];","for (var i = -1; i < arguments.length; i++) {","var value = (i === -1) ? o : arguments[i];","if (Array.isArray(value)) {","for (var j = 0, l = value.length; j < l; j++) {","if (j in value) {","cloned.push(value[j]);","} else {","cloned.length++;","}","}","} else {","cloned.push(value);","}","}","return cloned;","}",");","createArrayMethod_('join',","function(opt_separator) {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","var sep = typeof opt_separator === 'undefined' ?","',' : ('' + opt_separator);","var str = '';","for (var i = 0; i < len; i++) {","if (i && sep) str += sep;","str += (o[i] === null || o[i] === undefined) ? '' : o[i];","}","return str;","}",");","createArrayMethod_('every',","function(callback, thisArg) {","if (!this || typeof callback !== 'function') throw TypeError();","var t, k = 0;","var o = Object(this), len = o.length >>> 0;","if (arguments.length > 1) t = thisArg;","while (k < len) {","if (k in o && !callback.call(t, o[k], k, o)) return false;","k++;","}","return true;","}",");","createArrayMethod_('filter',","function(callback, var_args) {","if (!this || typeof callback !== 'function') throw TypeError();","var o = Object(this), len = o.length >>> 0;","var res = [];","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in o) {","var val = o[i];","if (callback.call(thisArg, val, i, o)) res.push(val);","}","}","return res;","}",");","createArrayMethod_('forEach',","function(callback, thisArg) {","if (!this || typeof callback !== 'function') throw TypeError();","var t, k = 0;","var o = Object(this), len = o.length >>> 0;","if (arguments.length > 1) t = thisArg;","while (k < len) {","if (k in o) callback.call(t, o[k], k, o);","k++;","}","}",");","createArrayMethod_('map',","function(callback, thisArg) {","if (!this || typeof callback !== 'function') throw TypeError();","var t, k = 0;","var o = Object(this), len = o.length >>> 0;","if (arguments.length > 1) t = thisArg;","var a = new Array(len);","while (k < len) {","if (k in o) a[k] = callback.call(t, o[k], k, o);","k++;","}","return a;","}",");","createArrayMethod_('reduce',","function(callback /*, initialValue*/) {","if (!this || typeof callback !== 'function') throw TypeError();","var o = Object(this), len = o.length >>> 0;","var k = 0, value;","if (arguments.length === 2) {","value = arguments[1];","} else {","while (k < len && !(k in o)) k++;","if (k >= len) {","throw TypeError('Reduce of empty array with no initial value');","}","value = o[k++];","}","for (; k < len; k++) {","if (k in o) value = callback(value, o[k], k, o);","}","return value;","}",");","createArrayMethod_('reduceRight',","function(callback /*, initialValue*/) {","if (!this || typeof callback !== 'function') throw TypeError();","var o = Object(this), len = o.length >>> 0;","var k = len - 1, value;","if (arguments.length >= 2) {","value = arguments[1];","} else {","while (k >= 0 && !(k in o)) k--;","if (k < 0) {","throw TypeError('Reduce of empty array with no initial value');","}","value = o[k--];","}","for (; k >= 0; k--) {","if (k in o) value = callback(value, o[k], k, o);","}","return value;","}",");","createArrayMethod_('some',","function(callback /*, thisArg*/) {","if (!this || typeof callback !== 'function') throw TypeError();","var o = Object(this), len = o.length >>> 0;","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in o && callback.call(thisArg, o[i], i, o)) return true;","}","return false;","}",");","createArrayMethod_('sort',","function(opt_comp) {","if (!this) throw TypeError();","if (typeof opt_comp !== 'function') {","opt_comp = undefined;","}","for (var i = 0; i < this.length; i++) {","var changes = 0;","for (var j = 0; j < this.length - i - 1; j++) {","if (opt_comp ? (opt_comp(this[j], this[j + 1]) > 0) :","(String(this[j]) > String(this[j + 1]))) {","var swap = this[j];","var hasSwap = j in this;","if ((j + 1) in this) {","this[j] = this[j + 1];","} else {","delete this[j];","}","if (hasSwap) {","this[j + 1] = swap;","} else {","delete this[j + 1];","}","changes++;","}","}","if (!changes) break;","}","return this;","}",");","createArrayMethod_('toLocaleString',","function() {","if (!this) throw TypeError();","var o = Object(this), len = o.length >>> 0;","var out = [];","for (var i = 0; i < len; i++) {","out[i] = (o[i] === null || o[i] === undefined) ? '' : o[i].toLocaleString();","}","return out.join(',');","}",");","})();","")},h.prototype.initString=function(f){var p=this,m;m=function(y){return y=arguments.length?h.nativeGlobal.String(y):"",p.calledWithNew()?(this.data=y,this):y},this.STRING=this.createNativeFunction(m,!0),this.setProperty(f,"String",this.STRING,h.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.STRING,"fromCharCode",this.createNativeFunction(String.fromCharCode,!1),h.NONENUMERABLE_DESCRIPTOR);for(var T=["charAt","charCodeAt","concat","indexOf","lastIndexOf","slice","substr","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim"],E=0;E<T.length;E++)this.setNativeFunctionPrototype(this.STRING,T[E],String.prototype[T[E]]);m=function(y,S,A){S=p.pseudoToNative(S),A=p.pseudoToNative(A);try{return String(this).localeCompare(y,S,A)}catch(C){p.throwException(p.ERROR,"localeCompare: "+C.message)}},this.setNativeFunctionPrototype(this.STRING,"localeCompare",m),m=function(y,S,A){var C=String(this);if(S=S?Number(S):void 0,p.isa(y,p.REGEXP)&&(y=y.data,p.maybeThrowRegExp(y,A),p.REGEXP_MODE===2)){if(h.vm){var R={string:C,separator:y,limit:S},I="string.split(separator, limit)",k=p.vmCall(I,R,y,A);k!==h.REGEXP_TIMEOUT&&A(p.nativeToPseudo(k))}else{var O=p.createWorker(),F=p.regExpTimeout(y,O,A);O.onmessage=function(D){clearTimeout(F),A(p.nativeToPseudo(D.data))},O.postMessage(["split",C,y,S])}return}var k=C.split(y,S);A(p.nativeToPseudo(k))},this.setAsyncFunctionPrototype(this.STRING,"split",m),m=function(y,S){var A=String(this);if(y=p.isa(y,p.REGEXP)?y.data:new RegExp(y),p.maybeThrowRegExp(y,S),p.REGEXP_MODE===2){if(h.vm){var C={string:A,regexp:y},R="string.match(regexp)",F=p.vmCall(R,C,y,S);F!==h.REGEXP_TIMEOUT&&S(F&&p.matchToPseudo_(F))}else{var I=p.createWorker(),O=p.regExpTimeout(y,I,S);I.onmessage=function(k){clearTimeout(O),S(k.data&&p.matchToPseudo_(k.data))},I.postMessage(["match",A,y])}return}var F=A.match(y);S(F&&p.matchToPseudo_(F))},this.setAsyncFunctionPrototype(this.STRING,"match",m),m=function(y,S){var A=String(this);if(p.isa(y,p.REGEXP)?y=y.data:y=new RegExp(y),p.maybeThrowRegExp(y,S),p.REGEXP_MODE===2){if(h.vm){var C={string:A,regexp:y},R="string.search(regexp)",I=p.vmCall(R,C,y,S);I!==h.REGEXP_TIMEOUT&&S(I)}else{var O=p.createWorker(),F=p.regExpTimeout(y,O,S);O.onmessage=function(k){clearTimeout(F),S(k.data)},O.postMessage(["search",A,y])}return}S(A.search(y))},this.setAsyncFunctionPrototype(this.STRING,"search",m),m=function(y,S,A){var C=String(this);if(S=String(S),p.isa(y,p.REGEXP)&&(y=y.data,p.maybeThrowRegExp(y,A),p.REGEXP_MODE===2)){if(h.vm){var R={string:C,substr:y,newSubstr:S},I="string.replace(substr, newSubstr)",O=p.vmCall(I,R,y,A);O!==h.REGEXP_TIMEOUT&&A(O)}else{var F=p.createWorker(),k=p.regExpTimeout(y,F,A);F.onmessage=function(D){clearTimeout(k),A(D.data)},F.postMessage(["replace",C,y,S])}return}A(C.replace(y,S))},this.setAsyncFunctionPrototype(this.STRING,"replace",m),this.polyfills_.push("(function() {","var replace_ = String.prototype.replace;","String.prototype.replace = function replace(substr, newSubstr) {","if (typeof newSubstr !== 'function') {","return replace_.call(this, substr, newSubstr);","}","var str = this;","if (substr instanceof RegExp) {","var subs = [];","var m = substr.exec(str);","while (m) {","m.push(m.index, str);","var inject = newSubstr.apply(null, m);","subs.push([m.index, m[0].length, inject]);","m = substr.global ? substr.exec(str) : null;","}","for (var i = subs.length - 1; i >= 0; i--) {","str = str.substring(0, subs[i][0]) + subs[i][2] + ","str.substring(subs[i][0] + subs[i][1]);","}","} else {","var i = str.indexOf(substr);","if (i !== -1) {","var inject = newSubstr(str.substr(i, substr.length), i, str);","str = str.substring(0, i) + inject + ","str.substring(i + substr.length);","}","}","return str;","};","})();","")},h.prototype.initBoolean=function(f){var p=this,m;m=function(E){return E=h.nativeGlobal.Boolean(E),p.calledWithNew()?(this.data=E,this):E},this.BOOLEAN=this.createNativeFunction(m,!0),this.setProperty(f,"Boolean",this.BOOLEAN,h.NONENUMERABLE_DESCRIPTOR)},h.prototype.initNumber=function(f){var p=this,m;m=function(y){return y=arguments.length?h.nativeGlobal.Number(y):0,p.calledWithNew()?(this.data=y,this):y},this.NUMBER=this.createNativeFunction(m,!0),this.setProperty(f,"Number",this.NUMBER,h.NONENUMERABLE_DESCRIPTOR);for(var T=["MAX_VALUE","MIN_VALUE","NaN","NEGATIVE_INFINITY","POSITIVE_INFINITY"],E=0;E<T.length;E++)this.setProperty(this.NUMBER,T[E],Number[T[E]],h.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR);m=function(y){try{return Number(this).toExponential(y)}catch(S){p.throwException(p.ERROR,S.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toExponential",m),m=function(y){try{return Number(this).toFixed(y)}catch(S){p.throwException(p.ERROR,S.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toFixed",m),m=function(y){try{return Number(this).toPrecision(y)}catch(S){p.throwException(p.ERROR,S.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toPrecision",m),m=function(y){try{return Number(this).toString(y)}catch(S){p.throwException(p.ERROR,S.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toString",m),m=function(y,S){y=y?p.pseudoToNative(y):void 0,S=S?p.pseudoToNative(S):void 0;try{return Number(this).toLocaleString(y,S)}catch(A){p.throwException(p.ERROR,"toLocaleString: "+A.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toLocaleString",m)},h.prototype.initDate=function(f){var p=this,m;m=function(y,S){if(!p.calledWithNew())return h.nativeGlobal.Date();var A=[null].concat(Array.from(arguments));return this.data=new(Function.prototype.bind.apply(h.nativeGlobal.Date,A)),this},this.DATE=this.createNativeFunction(m,!0),this.DATE_PROTO=this.DATE.properties.prototype,this.setProperty(f,"Date",this.DATE,h.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"now",this.createNativeFunction(Date.now,!1),h.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"parse",this.createNativeFunction(Date.parse,!1),h.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"UTC",this.createNativeFunction(Date.UTC,!1),h.NONENUMERABLE_DESCRIPTOR);for(var T=["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","getYear","setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear","toDateString","toJSON","toGMTString","toLocaleDateString","toLocaleString","toLocaleTimeString","toTimeString","toUTCString"],E=0;E<T.length;E++)m=function(b){return function(y){var S=this.data;S instanceof Date||p.throwException(p.TYPE_ERROR,b+" not called on a Date");for(var A=[],C=0;C<arguments.length;C++)A[C]=p.pseudoToNative(arguments[C]);return S[b].apply(S,A)}}(T[E]),this.setNativeFunctionPrototype(this.DATE,T[E],m);m=function(){try{return this.data.toISOString()}catch(y){p.throwException(p.RANGE_ERROR,"toISOString: "+y.message)}},this.setNativeFunctionPrototype(this.DATE,"toISOString",m)},h.prototype.initRegExp=function(f){var p=this,m;m=function(E,b){if(p.calledWithNew())var y=this;else{if(b===void 0&&p.isa(E,p.REGEXP))return E;var y=p.createObjectProto(p.REGEXP_PROTO)}E=E===void 0?"":String(E),b=b?String(b):"",/^[gmi]*$/.test(b)||p.throwException(p.SYNTAX_ERROR,"Invalid regexp flag: "+b);try{var S=new h.nativeGlobal.RegExp(E,b)}catch(A){p.throwException(p.SYNTAX_ERROR,A.message)}return p.populateRegExp(y,S),y},this.REGEXP=this.createNativeFunction(m,!0),this.REGEXP_PROTO=this.REGEXP.properties.prototype,this.setProperty(f,"RegExp",this.REGEXP,h.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"global",void 0,h.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"ignoreCase",void 0,h.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"multiline",void 0,h.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"source","(?:)",h.READONLY_NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("Object.defineProperty(RegExp.prototype, 'test',","{configurable: true, writable: true, value:","function test(str) {","return !!this.exec(str);","}","});"),m=function(E,b){var y=this.data;if(E=String(E),y.lastIndex=Number(p.getProperty(this,"lastIndex")),p.maybeThrowRegExp(y,b),p.REGEXP_MODE===2){if(h.vm){var S={string:E,regexp:y},A="regexp.exec(string)",O=p.vmCall(A,S,y,b);O!==h.REGEXP_TIMEOUT&&(p.setProperty(this,"lastIndex",y.lastIndex),b(p.matchToPseudo_(O)))}else{var C=p.createWorker(),R=p.regExpTimeout(y,C,b),I=this;C.onmessage=function(F){clearTimeout(R),p.setProperty(I,"lastIndex",F.data[1]),b(p.matchToPseudo_(F.data[0]))},C.postMessage(["exec",y,y.lastIndex,E])}return}var O=y.exec(E);p.setProperty(this,"lastIndex",y.lastIndex),b(p.matchToPseudo_(O))},this.setAsyncFunctionPrototype(this.REGEXP,"exec",m)},h.prototype.matchToPseudo_=function(f){if(f){for(var p=Object.getOwnPropertyNames(f),m=0;m<p.length;m++){var T=p[m];isNaN(Number(T))&&T!=="length"&&T!=="input"&&T!=="index"&&delete f[T]}return this.nativeToPseudo(f)}return null},h.prototype.initError=function(f){var p=this;this.ERROR=this.createNativeFunction(function(E){if(p.calledWithNew())var b=this;else var b=p.createObject(p.ERROR);return p.populateError(b,E),b},!0),this.setProperty(f,"Error",this.ERROR,h.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ERROR.properties.prototype,"message","",h.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ERROR.properties.prototype,"name","Error",h.NONENUMERABLE_DESCRIPTOR);var m=function(T){var E=p.createNativeFunction(function(b){if(p.calledWithNew())var y=this;else var y=p.createObject(E);return p.populateError(y,b),y},!0);return p.setProperty(E,"prototype",p.createObject(p.ERROR),h.NONENUMERABLE_DESCRIPTOR),p.setProperty(E.properties.prototype,"name",T,h.NONENUMERABLE_DESCRIPTOR),p.setProperty(f,T,E,h.NONENUMERABLE_DESCRIPTOR),E};this.EVAL_ERROR=m("EvalError"),this.RANGE_ERROR=m("RangeError"),this.REFERENCE_ERROR=m("ReferenceError"),this.SYNTAX_ERROR=m("SyntaxError"),this.TYPE_ERROR=m("TypeError"),this.URI_ERROR=m("URIError")},h.prototype.initMath=function(f){var p=this.createObjectProto(this.OBJECT_PROTO);this.setProperty(f,"Math",p,h.NONENUMERABLE_DESCRIPTOR);for(var m=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2"],T=0;T<m.length;T++)this.setProperty(p,m[T],Math[m[T]],h.READONLY_NONENUMERABLE_DESCRIPTOR);for(var E=["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","random","round","sin","sqrt","tan"],T=0;T<E.length;T++)this.setProperty(p,E[T],this.createNativeFunction(Math[E[T]],!1),h.NONENUMERABLE_DESCRIPTOR)},h.prototype.initJSON=function(f){var p,m=this,T=m.createObjectProto(this.OBJECT_PROTO);this.setProperty(f,"JSON",T,h.NONENUMERABLE_DESCRIPTOR),p=function(b){try{var y=JSON.parse(String(b))}catch(S){m.throwException(m.SYNTAX_ERROR,S.message)}return m.nativeToPseudo(y)},this.setProperty(T,"parse",this.createNativeFunction(p,!1)),p=function(b,y,S){y&&y.class==="Function"?m.throwException(m.TYPE_ERROR,"Function replacer on JSON.stringify not supported"):y&&y.class==="Array"?(y=m.pseudoToNative(y),y=y.filter(function(R){return typeof R=="string"||typeof R=="number"})):y=null,typeof S!="string"&&typeof S!="number"&&(S=void 0);var A=m.pseudoToNative(b);try{var C=JSON.stringify(A,y,S)}catch(R){m.throwException(m.TYPE_ERROR,R.message)}return C},this.setProperty(T,"stringify",this.createNativeFunction(p,!1))},h.prototype.isa=function(f,p){if(f==null||!p)return!1;var m=p.properties.prototype;if(f===m)return!0;for(f=this.getPrototype(f);f;){if(f===m)return!0;f=f.proto}return!1},h.prototype.populateRegExp=function(f,p){f.data=new RegExp(p.source,p.flags),this.setProperty(f,"lastIndex",p.lastIndex,h.NONENUMERABLE_DESCRIPTOR),this.setProperty(f,"source",p.source,h.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(f,"global",p.global,h.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(f,"ignoreCase",p.ignoreCase,h.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(f,"multiline",p.multiline,h.READONLY_NONENUMERABLE_DESCRIPTOR)},h.prototype.populateError=function(f,p){p&&this.setProperty(f,"message",String(p),h.NONENUMERABLE_DESCRIPTOR);for(var m=[],T=this.stateStack.length-1;T>=0;T--){var E=this.stateStack[T],b=E.node;if(b.type==="CallExpression"){var y=E.func_;y&&m.length&&(m[m.length-1].datumName=this.getProperty(y,"name"))}b.loc&&(!m.length||b.type==="CallExpression")&&m.push({datumLoc:b.loc})}for(var S=String(this.getProperty(f,"name")),A=String(this.getProperty(f,"message")),C=S+": "+A+`
`,T=0;T<m.length;T++){var R=m[T].datumLoc,I=m[T].datumName,O=R.source+":"+R.start.line+":"+R.start.column;I?C+="  at "+I+" ("+O+`)
`:C+="  at "+O+`
`}this.setProperty(f,"stack",C.trim(),h.NONENUMERABLE_DESCRIPTOR)},h.prototype.createWorker=function(){var f=this.createWorker.blob_;return f||(f=new Blob([h.WORKER_CODE.join(`
`)],{type:"application/javascript"}),this.createWorker.blob_=f),new Worker(URL.createObjectURL(f))},h.prototype.vmCall=function(f,p,m,T){var E={timeout:this.REGEXP_THREAD_TIMEOUT};try{return h.vm.runInNewContext(f,p,E)}catch{T(null),this.throwException(this.ERROR,"RegExp Timeout: "+m)}return h.REGEXP_TIMEOUT},h.prototype.maybeThrowRegExp=function(f,p){var m;if(this.REGEXP_MODE===0)m=!1;else if(this.REGEXP_MODE===1)m=!0;else if(h.vm)m=!0;else if(typeof Worker=="function"&&typeof URL=="function")m=!0;else{try{h.vm=d("vm")}catch{}m=!!h.vm}m||(p(null),this.throwException(this.ERROR,"Regular expressions not supported: "+f))},h.prototype.regExpTimeout=function(f,p,m){var T=this;return setTimeout(function(){p.terminate(),m(null);try{T.throwException(T.ERROR,"RegExp Timeout: "+f)}catch{}},this.REGEXP_THREAD_TIMEOUT)},h.prototype.createObject=function(f){return this.createObjectProto(f&&f.properties.prototype)},h.prototype.createObjectProto=function(f){if(typeof f!="object")throw Error("Non object prototype");var p=new h.Object(f);return this.isa(p,this.ERROR)&&(p.class="Error"),p},h.prototype.createArray=function(){var f=this.createObjectProto(this.ARRAY_PROTO);return this.setProperty(f,"length",0,{configurable:!1,enumerable:!1,writable:!0}),f.class="Array",f},h.prototype.createFunctionBase_=function(f,p){var m=this.createObjectProto(this.FUNCTION_PROTO);if(p){var T=this.createObjectProto(this.OBJECT_PROTO);this.setProperty(m,"prototype",T,h.NONENUMERABLE_DESCRIPTOR),this.setProperty(T,"constructor",m,h.NONENUMERABLE_DESCRIPTOR)}else m.illegalConstructor=!0;return this.setProperty(m,"length",f,h.READONLY_NONENUMERABLE_DESCRIPTOR),m.class="Function",m},h.prototype.createFunction=function(f,p,m){var T=this.createFunctionBase_(f.params.length,!0);T.parentScope=p,T.node=f;var E=f.id?String(f.id.name):m||"";return this.setProperty(T,"name",E,h.READONLY_NONENUMERABLE_DESCRIPTOR),T},h.prototype.createNativeFunction=function(f,p){var m=this.createFunctionBase_(f.length,p);return m.nativeFunc=f,f.id=this.functionCounter_++,this.setProperty(m,"name",f.name,h.READONLY_NONENUMERABLE_DESCRIPTOR),m},h.prototype.createAsyncFunction=function(f){var p=this.createFunctionBase_(f.length,!0);return p.asyncFunc=f,f.id=this.functionCounter_++,this.setProperty(p,"name",f.name,h.READONLY_NONENUMERABLE_DESCRIPTOR),p},h.prototype.nativeToPseudo=function(f,p){if(f==null||f===!0||f===!1||typeof f=="string"||typeof f=="number")return f;if(f instanceof h.Object)throw Error("Object is already pseudo");var m=p||{pseudo:[],native:[]},T=m.native.indexOf(f);if(T!==-1)return m.pseudo[T];if(m.native.push(f),f instanceof RegExp){var E=this.createObjectProto(this.REGEXP_PROTO);return this.populateRegExp(E,f),m.pseudo.push(E),E}if(f instanceof Date){var b=this.createObjectProto(this.DATE_PROTO);return b.data=new Date(f.valueOf()),m.pseudo.push(b),b}if(typeof f=="function"){var y=this,S=function(){var O=Array.prototype.slice.call(arguments).map(function(k){return y.pseudoToNative(k)}),F=f.apply(y,O);return y.nativeToPseudo(F)},A=Object.getOwnPropertyDescriptor(f,"prototype"),C=this.createNativeFunction(S,!!A);return m.pseudo.push(C),C}var R;Array.isArray(f)?R=this.createArray():R=this.createObjectProto(this.OBJECT_PROTO),m.pseudo.push(R);for(var I in f)this.setProperty(R,I,this.nativeToPseudo(f[I],m));return R},h.prototype.pseudoToNative=function(f,p){if(f==null||f===!0||f===!1||typeof f=="string"||typeof f=="number")return f;if(!(f instanceof h.Object))throw Error("Object is not pseudo");var m=p||{pseudo:[],native:[]},T=m.pseudo.indexOf(f);if(T!==-1)return m.native[T];if(m.pseudo.push(f),this.isa(f,this.REGEXP)){var E=new RegExp(f.data.source,f.data.flags);return E.lastIndex=f.data.lastIndex,m.native.push(E),E}if(this.isa(f,this.DATE)){var b=new Date(f.data.valueOf());return m.native.push(b),b}var y=this.isa(f,this.ARRAY)?[]:{};m.native.push(y);var S;for(var A in f.properties)S=this.pseudoToNative(f.properties[A],m),Object.defineProperty(y,A,{value:S,writable:!0,enumerable:!0,configurable:!0});return y},h.prototype.getPrototype=function(f){switch(typeof f){case"number":return this.NUMBER.properties.prototype;case"boolean":return this.BOOLEAN.properties.prototype;case"string":return this.STRING.properties.prototype}return f?f.proto:null},h.prototype.getProperty=function(f,p){if(this.getterStep_)throw Error("Getter not supported in that context");if(p=String(p),f==null&&this.throwException(this.TYPE_ERROR,"Cannot read property '"+p+"' of "+f),typeof f=="object"&&!(f instanceof h.Object))throw TypeError("Expecting native value or pseudo object");if(p==="length"){if(this.isa(f,this.STRING))return String(f).length}else if(p.charCodeAt(0)<64&&this.isa(f,this.STRING)){var m=h.legalArrayIndex(p);if(!isNaN(m)&&m<String(f).length)return String(f)[m]}do if(f.properties&&p in f.properties){var T=f.getter[p];return T?(this.getterStep_=!0,T):f.properties[p]}while(f=this.getPrototype(f))},h.prototype.hasProperty=function(f,p){if(!(f instanceof h.Object))throw TypeError("Primitive data type has no properties");if(p=String(p),p==="length"&&this.isa(f,this.STRING))return!0;if(this.isa(f,this.STRING)){var m=h.legalArrayIndex(p);if(!isNaN(m)&&m<String(f).length)return!0}do if(f.properties&&p in f.properties)return!0;while(f=this.getPrototype(f));return!1},h.prototype.setProperty=function(f,p,m,T){if(this.setterStep_)throw Error("Setter not supported in that context");if(p=String(p),f==null&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+p+"' of "+f),typeof f=="object"&&!(f instanceof h.Object))throw TypeError("Expecting native value or pseudo object");T&&("get"in T||"set"in T)&&("value"in T||"writable"in T)&&this.throwException(this.TYPE_ERROR,"Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");var E=!this.stateStack||this.getScope().strict;if(!(f instanceof h.Object)){E&&this.throwException(this.TYPE_ERROR,"Can't create property '"+p+"' on '"+f+"'");return}if(this.isa(f,this.STRING)){var b=h.legalArrayIndex(p);if(p==="length"||!isNaN(b)&&b<String(f).length){E&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+p+"' of String '"+f.data+"'");return}}if(f.class==="Array"){var y=f.properties.length,S;if(p==="length"){if(T){if(!("value"in T))return;m=T.value}if(m=h.legalArrayLength(m),isNaN(m)&&this.throwException(this.RANGE_ERROR,"Invalid array length"),m<y)for(S in f.properties)S=h.legalArrayIndex(S),!isNaN(S)&&m<=S&&delete f.properties[S]}else isNaN(S=h.legalArrayIndex(p))||(f.properties.length=Math.max(y,S+1))}if(f.preventExtensions&&!(p in f.properties)){E&&this.throwException(this.TYPE_ERROR,"Can't add property '"+p+"', object is not extensible");return}if(T){var A={};"get"in T&&T.get&&(f.getter[p]=T.get,A.get=this.setProperty.placeholderGet_),"set"in T&&T.set&&(f.setter[p]=T.set,A.set=this.setProperty.placeholderSet_),"configurable"in T&&(A.configurable=T.configurable),"enumerable"in T&&(A.enumerable=T.enumerable),"writable"in T&&(A.writable=T.writable,delete f.getter[p],delete f.setter[p]),"value"in T?(A.value=T.value,delete f.getter[p],delete f.setter[p]):m!==h.VALUE_IN_DESCRIPTOR&&(A.value=m,delete f.getter[p],delete f.setter[p]);try{Object.defineProperty(f.properties,p,A)}catch{this.throwException(this.TYPE_ERROR,"Cannot redefine property: "+p)}"get"in T&&!T.get&&delete f.getter[p],"set"in T&&!T.set&&delete f.setter[p]}else{if(m===h.VALUE_IN_DESCRIPTOR)throw ReferenceError("Value not specified");for(var C=f;!(p in C.properties);)if(C=this.getPrototype(C),!C){C=f;break}if(C.setter&&C.setter[p])return this.setterStep_=!0,C.setter[p];if(C.getter&&C.getter[p])E&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+p+"' of object '"+f+"' which only has a getter");else try{f.properties[p]=m}catch{E&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+p+"' of object '"+f+"'")}}},h.prototype.setProperty.placeholderGet_=function(){throw Error("Placeholder getter")},h.prototype.setProperty.placeholderSet_=function(){throw Error("Placeholder setter")},h.prototype.setNativeFunctionPrototype=function(f,p,m){this.setProperty(f.properties.prototype,p,this.createNativeFunction(m,!1),h.NONENUMERABLE_DESCRIPTOR)},h.prototype.setAsyncFunctionPrototype=function(f,p,m){this.setProperty(f.properties.prototype,p,this.createAsyncFunction(m),h.NONENUMERABLE_DESCRIPTOR)},h.prototype.getScope=function(){var f=this.stateStack[this.stateStack.length-1].scope;if(!f)throw Error("No scope found");return f},h.prototype.createScope=function(f,p){var m=!1;if(p&&p.strict)m=!0;else{var T=f.body&&f.body[0];T&&T.expression&&T.expression.type==="Literal"&&T.expression.value==="use strict"&&(m=!0)}var E=this.createObjectProto(null),b=new h.Scope(p,m,E);return p||this.initGlobal(b.object),this.populateScope_(f,b),b},h.prototype.createSpecialScope=function(f,p){if(!f)throw Error("parentScope required");var m=p||this.createObjectProto(null);return new h.Scope(f,f.strict,m)},h.prototype.getValueFromScope=function(f){for(var p=this.getScope();p&&p!==this.globalScope;){if(f in p.object.properties)return p.object.properties[f];p=p.parentScope}if(p===this.globalScope&&this.hasProperty(p.object,f))return this.getProperty(p.object,f);var m=this.stateStack[this.stateStack.length-1].node;m.type==="UnaryExpression"&&m.operator==="typeof"||this.throwException(this.REFERENCE_ERROR,f+" is not defined")},h.prototype.setValueToScope=function(f,p){for(var m=this.getScope(),T=m.strict;m&&m!==this.globalScope;){if(f in m.object.properties){try{m.object.properties[f]=p}catch{T&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only variable '"+f+"'")}return}m=m.parentScope}if(m===this.globalScope&&(!T||this.hasProperty(m.object,f)))return this.setProperty(m.object,f,p);this.throwException(this.REFERENCE_ERROR,f+" is not defined")},h.prototype.populateScope_=function(f,p){var m;if(f.variableCache_)m=f.variableCache_;else{switch(m=Object.create(null),f.type){case"VariableDeclaration":for(var T=0;T<f.declarations.length;T++)m[f.declarations[T].id.name]=!0;break;case"FunctionDeclaration":m[f.id.name]=f;break;case"BlockStatement":case"CatchClause":case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"Program":case"SwitchCase":case"SwitchStatement":case"TryStatement":case"WithStatement":case"WhileStatement":var E=f.constructor;for(var b in f)if(b!=="loc"){var y=f[b];if(y&&typeof y=="object"){var S;if(Array.isArray(y)){for(var T=0;T<y.length;T++)if(y[T]&&y[T].constructor===E){S=this.populateScope_(y[T],p);for(var b in S)m[b]=S[b]}}else if(y.constructor===E){S=this.populateScope_(y,p);for(var b in S)m[b]=S[b]}}}}f.variableCache_=m}for(var b in m)m[b]===!0?this.setProperty(p.object,b,void 0,h.VARIABLE_DESCRIPTOR):this.setProperty(p.object,b,this.createFunction(m[b],p),h.VARIABLE_DESCRIPTOR);return m},h.prototype.calledWithNew=function(){return this.stateStack[this.stateStack.length-1].isConstructor},h.prototype.getValue=function(f){return f[0]===h.SCOPE_REFERENCE?this.getValueFromScope(f[1]):this.getProperty(f[0],f[1])},h.prototype.setValue=function(f,p){return f[0]===h.SCOPE_REFERENCE?this.setValueToScope(f[1],p):this.setProperty(f[0],f[1],p)},h.prototype.throwException=function(f,p){if(!this.globalScope)throw p===void 0?f:p;if(p===void 0||!(f instanceof h.Object))var m=f;else{var m=this.createObject(f);this.populateError(m,p)}throw this.unwind(h.Completion.THROW,m,void 0),h.STEP_ERROR},h.prototype.unwind=function(f,p,m){if(f===h.Completion.NORMAL)throw TypeError("Should not unwind for NORMAL completions");e:for(var T=this.stateStack;T.length>0;T.pop()){var E=T[T.length-1];switch(E.node.type){case"TryStatement":E.cv={type:f,value:p,label:m};return;case"CallExpression":case"NewExpression":if(f===h.Completion.RETURN){E.value=p;return}else if(f===h.Completion.BREAK||f===h.Completion.CONTINUE)throw Error("Unsyntactic break/continue not rejected by Acorn");break;case"Program":if(f===h.Completion.RETURN)return;E.done=!0;break e}if(f===h.Completion.BREAK){if(m?E.labels&&E.labels.indexOf(m)!==-1:E.isLoop||E.isSwitch){T.pop();return}}else if(f===h.Completion.CONTINUE&&(m?E.labels&&E.labels.indexOf(m)!==-1:E.isLoop))return}var b;if(this.isa(p,this.ERROR)){var y={EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError},S=String(this.getProperty(p,"name")),A=this.getProperty(p,"message").valueOf(),C=y[S]||Error;b=C(A),b.stack=String(this.getProperty(p,"stack"))}else b=String(p);throw this.value=b,b},h.prototype.nodeSummary=function(f){switch(f.type){case"ArrayExpression":return"[...]";case"BinaryExpression":case"LogicalExpression":return this.nodeSummary(f.left)+" "+f.operator+" "+this.nodeSummary(f.right);case"CallExpression":return this.nodeSummary(f.callee)+"(...)";case"ConditionalExpression":return this.nodeSummary(f.test)+" ? "+this.nodeSummary(f.consequent)+" : "+this.nodeSummary(f.alternate);case"Identifier":return f.name;case"Literal":return f.raw;case"MemberExpression":var p=this.nodeSummary(f.object),m=this.nodeSummary(f.property);return f.computed?p+"["+m+"]":p+"."+m;case"NewExpression":return"new "+this.nodeSummary(f.callee)+"(...)";case"ObjectExpression":return"{...}";case"ThisExpression":return"this";case"UnaryExpression":return f.operator+" "+this.nodeSummary(f.argument);case"UpdateExpression":var T=this.nodeSummary(f.argument);return f.prefix?f.operator+T:T+f.operator}return"???"},h.prototype.createTask_=function(f,p){var m=this.stateStack[this.stateStack.length-1],T=Array.from(p),E=T.shift(),b=Math.max(Number(T.shift()||0),0),y=this.newNode(),S,A,C;if(E instanceof h.Object&&E.class==="Function")A=E,y.type="CallExpression",S=m.scope;else{try{C=this.parse_(String(E),"taskCode"+this.taskCodeNumber_++)}catch(k){this.throwException(this.SYNTAX_ERROR,"Invalid code: "+k.message)}y.type="EvalProgram_",y.body=C.body;var R=m.node.arguments[0],I=R?R.start:void 0,O=R?R.end:void 0;h.stripLocations_(y,I,O),S=this.globalScope,T.length=0}var F=new h.Task(A,T,S,y,f?b:-1);return this.scheduleTask_(F,b),F.pid},h.prototype.scheduleTask_=function(f,p){f.time=Date.now()+p,this.tasks.push(f),this.tasks.sort(function(m,T){return m.time-T.time})},h.prototype.deleteTask_=function(f){for(var p=0;p<this.tasks.length;p++)if(this.tasks[p].pid==f){this.tasks.splice(p,1);break}},h.prototype.nextTask_=function(){var f=this.tasks[0];if(!f||f.time>Date.now())return null;this.tasks.shift(),f.interval>=0&&this.scheduleTask_(f,f.interval);var p=new h.State(f.node,f.scope);return f.functionRef&&(p.doneCallee_=2,p.funcThis_=this.globalObject,p.func_=f.functionRef,p.doneArgs_=!0,p.arguments_=f.argsArray),p},h.prototype.createGetter_=function(f,p){if(!this.getterStep_)throw Error("Unexpected call to createGetter");this.getterStep_=!1;var m=Array.isArray(p)?p[0]:p,T=this.newNode();T.type="CallExpression";var E=new h.State(T,this.stateStack[this.stateStack.length-1].scope);return E.doneCallee_=2,E.funcThis_=m,E.func_=f,E.doneArgs_=!0,E.arguments_=[],E},h.prototype.createSetter_=function(f,p,m){if(!this.setterStep_)throw Error("Unexpected call to createSetter");this.setterStep_=!1;var T=Array.isArray(p)?p[0]:this.globalObject,E=this.newNode();E.type="CallExpression";var b=new h.State(E,this.stateStack[this.stateStack.length-1].scope);return b.doneCallee_=2,b.funcThis_=T,b.func_=f,b.doneArgs_=!0,b.arguments_=[m],b},h.prototype.boxThis_=function(f){if(f==null)return this.globalObject;if(!(f instanceof h.Object)){var p=this.createObjectProto(this.getPrototype(f));return p.data=f,p}return f},h.prototype.getGlobalScope=function(){return this.globalScope},h.prototype.setGlobalScope=function(f){this.globalScope=f,this.stateStack[0].scope=f},h.prototype.getStateStack=function(){return this.stateStack},h.prototype.setStateStack=function(f){this.stateStack=f},h.Value,h.State=function(f,p){this.node=f,this.scope=p},h.Scope=function(f,p,m){this.parentScope=f,this.strict=p,this.object=m},h.Object=function(f){this.getter=Object.create(null),this.setter=Object.create(null),this.properties=Object.create(null),this.proto=f},h.Object.prototype.proto=null,h.Object.prototype.class="Object",h.Object.prototype.data=null,h.Object.prototype.toString=function(){if(!h.currentInterpreter_)return"[object Interpreter.Object]";if(!(this instanceof h.Object))return String(this);if(this.class==="Array"){var f=h.toStringCycles_;f.push(this);try{var p=[],m=this.properties.length,T=!1;m>1024&&(m=1e3,T=!0);for(var E=0;E<m;E++){var b=this.properties[E];p[E]=b instanceof h.Object&&f.indexOf(b)!==-1?"...":b}T&&p.push("...")}finally{f.pop()}return p.join(",")}if(this.class==="Error"){var f=h.toStringCycles_;if(f.indexOf(this)!==-1)return"[object Error]";var y,S,A=this;do if("name"in A.properties){y=A.properties.name;break}while(A=A.proto);A=this;do if("message"in A.properties){S=A.properties.message;break}while(A=A.proto);f.push(this);try{y=y&&String(y),S=S&&String(S)}finally{f.pop()}return S?y+": "+S:String(y)}return this.data!==null?String(this.data):"[object "+this.class+"]"},h.Object.prototype.valueOf=function(){return h.currentInterpreter_?this.data===void 0||this.data===null||this.data instanceof RegExp?this:this.data instanceof Date?this.data.valueOf():this.data:this},h.Task=function(f,p,m,T,E){this.functionRef=f,this.argsArray=p,this.scope=m,this.node=T,this.interval=E,this.pid=++h.Task.pid,this.time=0},h.Task.pid=0,h.prototype.stepArrayExpression=function(f,p,m){var T=m.elements,E=p.n_||0;for(p.array_?(this.setProperty(p.array_,E,p.value),E++):(p.array_=this.createArray(),p.array_.properties.length=T.length);E<T.length;){if(T[E])return p.n_=E,new h.State(T[E],p.scope);E++}f.pop(),f[f.length-1].value=p.array_},h.prototype.stepAssignmentExpression=function(f,p,m){if(!p.doneLeft_){p.doneLeft_=!0;var T=new h.State(m.left,p.scope);return T.components=!0,T}if(!p.doneRight_){if(p.leftReference_||(p.leftReference_=p.value),p.doneGetter_&&(p.leftValue_=p.value),!p.doneGetter_&&m.operator!=="="){var E=this.getValue(p.leftReference_);if(p.leftValue_=E,this.getterStep_){p.doneGetter_=!0;var b=E;return this.createGetter_(b,p.leftReference_)}}return p.doneRight_=!0,m.operator==="="&&m.left.type==="Identifier"&&(p.destinationName=m.left.name),new h.State(m.right,p.scope)}if(p.doneSetter_){f.pop(),f[f.length-1].value=p.setterValue_;return}var y=p.leftValue_,S=p.value;switch(m.operator){case"=":y=S;break;case"+=":y+=S;break;case"-=":y-=S;break;case"*=":y*=S;break;case"/=":y/=S;break;case"%=":y%=S;break;case"<<=":y<<=S;break;case">>=":y>>=S;break;case">>>=":y>>>=S;break;case"&=":y&=S;break;case"^=":y^=S;break;case"|=":y|=S;break;default:throw SyntaxError("Unknown assignment expression: "+m.operator)}var A=this.setValue(p.leftReference_,y);if(A)return p.doneSetter_=!0,p.setterValue_=y,this.createSetter_(A,p.leftReference_,y);f.pop(),f[f.length-1].value=y},h.prototype.stepBinaryExpression=function(f,p,m){if(!p.doneLeft_)return p.doneLeft_=!0,new h.State(m.left,p.scope);if(!p.doneRight_)return p.doneRight_=!0,p.leftValue_=p.value,new h.State(m.right,p.scope);f.pop();var T=p.leftValue_,E=p.value,b;switch(m.operator){case"==":b=T==E;break;case"!=":b=T!=E;break;case"===":b=T===E;break;case"!==":b=T!==E;break;case">":b=T>E;break;case">=":b=T>=E;break;case"<":b=T<E;break;case"<=":b=T<=E;break;case"+":b=T+E;break;case"-":b=T-E;break;case"*":b=T*E;break;case"/":b=T/E;break;case"%":b=T%E;break;case"&":b=T&E;break;case"|":b=T|E;break;case"^":b=T^E;break;case"<<":b=T<<E;break;case">>":b=T>>E;break;case">>>":b=T>>>E;break;case"in":E instanceof h.Object||this.throwException(this.TYPE_ERROR,"'in' expects an object, not '"+E+"'"),b=this.hasProperty(E,T);break;case"instanceof":this.isa(E,this.FUNCTION)||this.throwException(this.TYPE_ERROR,"'instanceof' expects an object, not '"+E+"'"),b=T instanceof h.Object?this.isa(T,E):!1;break;default:throw SyntaxError("Unknown binary operator: "+m.operator)}f[f.length-1].value=b},h.prototype.stepBlockStatement=function(f,p,m){var T=p.n_||0,E=m.body[T];if(E)return p.n_=T+1,new h.State(E,p.scope);f.pop()},h.prototype.stepBreakStatement=function(f,p,m){var T=m.label&&m.label.name;this.unwind(h.Completion.BREAK,void 0,T)},h.prototype.evalCodeNumber_=0,h.prototype.stepCallExpression=function(f,p,m){if(!p.doneCallee_){p.doneCallee_=1;var T=new h.State(m.callee,p.scope);return T.components=!0,T}if(p.doneCallee_===1){p.doneCallee_=2;var E=p.value;if(Array.isArray(E)){if(p.func_=this.getValue(E),E[0]===h.SCOPE_REFERENCE?p.directEval_=E[1]==="eval":p.funcThis_=E[0],E=p.func_,this.getterStep_)return p.doneCallee_=1,this.createGetter_(E,p.value)}else p.func_=E;p.arguments_=[],p.n_=0}var E=p.func_;if(!p.doneArgs_){if(p.n_!==0&&p.arguments_.push(p.value),m.arguments[p.n_])return new h.State(m.arguments[p.n_++],p.scope);if(m.type==="NewExpression"){if((!(E instanceof h.Object)||E.illegalConstructor)&&this.throwException(this.TYPE_ERROR,this.nodeSummary(m.callee)+" is not a constructor"),E===this.ARRAY)p.funcThis_=this.createArray();else{var b=E.properties.prototype;(typeof b!="object"||b===null)&&(b=this.OBJECT_PROTO),p.funcThis_=this.createObjectProto(b)}p.isConstructor=!0}p.doneArgs_=!0}if(p.doneExec_)f.pop(),p.isConstructor&&typeof p.value!="object"?f[f.length-1].value=p.funcThis_:f[f.length-1].value=p.value;else{p.doneExec_=!0,E instanceof h.Object||this.throwException(this.TYPE_ERROR,this.nodeSummary(m.callee)+" is not a function");var y=E.node;if(y){for(var S=this.createScope(y.body,E.parentScope),A=this.createArray(),C=0;C<p.arguments_.length;C++)this.setProperty(A,C,p.arguments_[C]);this.setProperty(S.object,"arguments",A);for(var C=0;C<y.params.length;C++){var R=y.params[C].name,I=p.arguments_.length>C?p.arguments_[C]:void 0;this.setProperty(S.object,R,I)}return S.strict||(p.funcThis_=this.boxThis_(p.funcThis_)),this.setProperty(S.object,"this",p.funcThis_,h.READONLY_DESCRIPTOR),p.value=void 0,new h.State(y.body,S)}else if(E.eval){var O=p.arguments_[0];if(typeof O!="string")p.value=O;else{try{var F=this.parse_(String(O),"eval"+this.evalCodeNumber_++)}catch(ne){this.throwException(this.SYNTAX_ERROR,"Invalid code: "+ne.message)}var k=this.newNode();k.type="EvalProgram_",k.body=F.body,h.stripLocations_(k,m.start,m.end);var S=p.directEval_?p.scope:this.globalScope;return S.strict?S=this.createScope(F,S):this.populateScope_(F,S),this.value=void 0,new h.State(k,S)}}else if(E.nativeFunc)p.scope.strict||(p.funcThis_=this.boxThis_(p.funcThis_)),p.value=E.nativeFunc.apply(p.funcThis_,p.arguments_);else if(E.asyncFunc){var D=this,U=function(ae){p.value=ae,D.paused_=!1},ce=E.asyncFunc.length-1,ie=p.arguments_.concat(new Array(ce)).slice(0,ce);ie.push(U),this.paused_=!0,p.scope.strict||(p.funcThis_=this.boxThis_(p.funcThis_)),E.asyncFunc.apply(p.funcThis_,ie);return}else this.throwException(this.TYPE_ERROR,this.nodeSummary(m.callee)+" is not callable")}},h.prototype.stepConditionalExpression=function(f,p,m){var T=p.mode_||0;if(T===0)return p.mode_=1,new h.State(m.test,p.scope);if(T===1){p.mode_=2;var E=!!p.value;if(E&&m.consequent)return new h.State(m.consequent,p.scope);if(!E&&m.alternate)return new h.State(m.alternate,p.scope);this.value=void 0}f.pop(),m.type==="ConditionalExpression"&&(f[f.length-1].value=p.value)},h.prototype.stepContinueStatement=function(f,p,m){var T=m.label&&m.label.name;this.unwind(h.Completion.CONTINUE,void 0,T)},h.prototype.stepDebuggerStatement=function(f,p,m){f.pop()},h.prototype.stepDoWhileStatement=function(f,p,m){if(m.type==="DoWhileStatement"&&p.test_===void 0&&(p.value=!0,p.test_=!0),!p.test_)return p.test_=!0,new h.State(m.test,p.scope);if(!p.value)f.pop();else if(m.body)return p.test_=!1,p.isLoop=!0,new h.State(m.body,p.scope)},h.prototype.stepEmptyStatement=function(f,p,m){f.pop()},h.prototype.stepEvalProgram_=function(f,p,m){var T=p.n_||0,E=m.body[T];if(E)return p.n_=T+1,new h.State(E,p.scope);f.pop(),f[f.length-1].value=this.value},h.prototype.stepExpressionStatement=function(f,p,m){if(!p.done_)return this.value=void 0,p.done_=!0,new h.State(m.expression,p.scope);f.pop(),this.value=p.value},h.prototype.stepForInStatement=function(f,p,m){if(!p.doneInit_&&(p.doneInit_=!0,m.left.declarations&&m.left.declarations[0].init))return p.scope.strict&&this.throwException(this.SYNTAX_ERROR,"for-in loop variable declaration may not have an initializer"),new h.State(m.left,p.scope);if(!p.doneObject_)return p.doneObject_=!0,p.variable_||(p.variable_=p.value),new h.State(m.right,p.scope);if(p.isLoop||(p.isLoop=!0,p.object_=p.value,p.visited_=Object.create(null)),p.name_===void 0)e:for(;;){if(p.object_ instanceof h.Object)for(p.props_||(p.props_=Object.getOwnPropertyNames(p.object_.properties));;){var T=p.props_.shift();if(T===void 0)break;if(Object.prototype.hasOwnProperty.call(p.object_.properties,T)&&!p.visited_[T]&&(p.visited_[T]=!0,!!Object.prototype.propertyIsEnumerable.call(p.object_.properties,T))){p.name_=T;break e}}else if(p.object_!==null&&p.object_!==void 0)for(p.props_||(p.props_=Object.getOwnPropertyNames(p.object_));;){var T=p.props_.shift();if(T===void 0)break;if(p.visited_[T]=!0,!!Object.prototype.propertyIsEnumerable.call(p.object_,T)){p.name_=T;break e}}if(p.object_=this.getPrototype(p.object_),p.props_=null,p.object_===null){f.pop();return}}if(!p.doneVariable_){p.doneVariable_=!0;var E=m.left;if(E.type==="VariableDeclaration")p.variable_=[h.SCOPE_REFERENCE,E.declarations[0].id.name];else{p.variable_=null;var b=new h.State(E,p.scope);return b.components=!0,b}}if(p.variable_||(p.variable_=p.value),!p.doneSetter_){p.doneSetter_=!0;var y=p.name_,S=this.setValue(p.variable_,y);if(S)return this.createSetter_(S,p.variable_,y)}if(p.name_=void 0,p.doneVariable_=!1,p.doneSetter_=!1,m.body)return new h.State(m.body,p.scope)},h.prototype.stepForStatement=function(f,p,m){switch(p.mode_){default:if(p.mode_=1,m.init)return new h.State(m.init,p.scope);break;case 1:if(p.mode_=2,m.test)return new h.State(m.test,p.scope);break;case 2:if(p.mode_=3,m.test&&!p.value)f.pop();else return p.isLoop=!0,new h.State(m.body,p.scope);break;case 3:if(p.mode_=1,m.update)return new h.State(m.update,p.scope);break}},h.prototype.stepFunctionDeclaration=function(f,p,m){f.pop()},h.prototype.stepFunctionExpression=function(f,p,m){f.pop(),p=f[f.length-1];var T=p.scope;m.id&&(T=this.createSpecialScope(T)),p.value=this.createFunction(m,T,p.destinationName),m.id&&this.setProperty(T.object,m.id.name,p.value,h.READONLY_DESCRIPTOR)},h.prototype.stepIdentifier=function(f,p,m){if(f.pop(),p.components){f[f.length-1].value=[h.SCOPE_REFERENCE,m.name];return}var T=this.getValueFromScope(m.name);if(this.getterStep_){var E=T;return this.createGetter_(E,this.globalObject)}f[f.length-1].value=T},h.prototype.stepIfStatement=h.prototype.stepConditionalExpression,h.prototype.stepLabeledStatement=function(f,p,m){f.pop();var T=p.labels||[];T.push(m.label.name);var E=new h.State(m.body,p.scope);return E.labels=T,E},h.prototype.stepLiteral=function(f,p,m){f.pop();var T=m.value;if(T instanceof RegExp){var E=this.createObjectProto(this.REGEXP_PROTO);this.populateRegExp(E,T),T=E}f[f.length-1].value=T},h.prototype.stepLogicalExpression=function(f,p,m){if(m.operator!=="&&"&&m.operator!=="||")throw SyntaxError("Unknown logical operator: "+m.operator);if(!p.doneLeft_)return p.doneLeft_=!0,new h.State(m.left,p.scope);if(p.doneRight_)f.pop(),f[f.length-1].value=p.value;else if(m.operator==="&&"&&!p.value||m.operator==="||"&&p.value)f.pop(),f[f.length-1].value=p.value;else return p.doneRight_=!0,new h.State(m.right,p.scope)},h.prototype.stepMemberExpression=function(f,p,m){if(!p.doneObject_)return p.doneObject_=!0,new h.State(m.object,p.scope);var T;if(!m.computed)p.object_=p.value,T=m.property.name;else if(p.doneProperty_)T=p.value;else return p.object_=p.value,p.doneProperty_=!0,new h.State(m.property,p.scope);if(f.pop(),p.components)f[f.length-1].value=[p.object_,T];else{var E=this.getProperty(p.object_,T);if(this.getterStep_){var b=E;return this.createGetter_(b,p.object_)}f[f.length-1].value=E}},h.prototype.stepNewExpression=h.prototype.stepCallExpression,h.prototype.stepObjectExpression=function(f,p,m){var T=p.n_||0,E=m.properties[T];if(!p.object_)p.object_=this.createObjectProto(this.OBJECT_PROTO),p.properties_=Object.create(null);else{var b=p.destinationName;p.properties_[b]||(p.properties_[b]={}),p.properties_[b][E.kind]=p.value,p.n_=++T,E=m.properties[T]}if(E){var y=E.key;if(y.type==="Identifier")var b=y.name;else if(y.type==="Literal")var b=y.value;else throw SyntaxError("Unknown object structure: "+y.type);return p.destinationName=b,new h.State(E.value,p.scope)}for(var y in p.properties_){var S=p.properties_[y];if("get"in S||"set"in S){var A={configurable:!0,enumerable:!0,get:S.get,set:S.set};this.setProperty(p.object_,y,h.VALUE_IN_DESCRIPTOR,A)}else this.setProperty(p.object_,y,S.init)}f.pop(),f[f.length-1].value=p.object_},h.prototype.stepProgram=function(f,p,m){var T=m.body.shift();if(T)return p.done=!1,new h.State(T,p.scope);p.done=!0},h.prototype.stepReturnStatement=function(f,p,m){if(m.argument&&!p.done_)return p.done_=!0,new h.State(m.argument,p.scope);this.unwind(h.Completion.RETURN,p.value,void 0)},h.prototype.stepSequenceExpression=function(f,p,m){var T=p.n_||0,E=m.expressions[T];if(E)return p.n_=T+1,new h.State(E,p.scope);f.pop(),f[f.length-1].value=p.value},h.prototype.stepSwitchStatement=function(f,p,m){if(!p.test_)return p.test_=1,new h.State(m.discriminant,p.scope);for(p.test_===1&&(p.test_=2,p.switchValue_=p.value,p.defaultCase_=-1);;){var T=p.index_||0,E=m.cases[T];if(!p.matched_&&E&&!E.test){p.defaultCase_=T,p.index_=T+1;continue}if(!E&&!p.matched_&&p.defaultCase_!==-1){p.matched_=!0,p.index_=p.defaultCase_;continue}if(E){if(!p.matched_&&!p.tested_&&E.test)return p.tested_=!0,new h.State(E.test,p.scope);if(p.matched_||p.value===p.switchValue_){p.matched_=!0;var b=p.n_||0;if(E.consequent[b])return p.isSwitch=!0,p.n_=b+1,new h.State(E.consequent[b],p.scope)}p.tested_=!1,p.n_=0,p.index_=T+1}else{f.pop();return}}},h.prototype.stepThisExpression=function(f,p,m){f.pop(),f[f.length-1].value=this.getValueFromScope("this")},h.prototype.stepThrowStatement=function(f,p,m){if(p.done_)this.throwException(p.value);else return p.done_=!0,new h.State(m.argument,p.scope)},h.prototype.stepTryStatement=function(f,p,m){if(!p.doneBlock_)return p.doneBlock_=!0,new h.State(m.block,p.scope);if(p.cv&&p.cv.type===h.Completion.THROW&&!p.doneHandler_&&m.handler){p.doneHandler_=!0;var T=this.createSpecialScope(p.scope);return this.setProperty(T.object,m.handler.param.name,p.cv.value),p.cv=void 0,new h.State(m.handler.body,T)}if(!p.doneFinalizer_&&m.finalizer)return p.doneFinalizer_=!0,new h.State(m.finalizer,p.scope);f.pop(),p.cv&&this.unwind(p.cv.type,p.cv.value,p.cv.label)},h.prototype.stepUnaryExpression=function(f,p,m){if(!p.done_){p.done_=!0;var T=new h.State(m.argument,p.scope);return T.components=m.operator==="delete",T}f.pop();var E=p.value;switch(m.operator){case"-":E=-E;break;case"+":E=+E;break;case"!":E=!E;break;case"~":E=~E;break;case"delete":var b=!0;if(Array.isArray(E)){var y=E[0];y===h.SCOPE_REFERENCE&&(y=p.scope);var S=String(E[1]);try{delete y.properties[S]}catch{p.scope.strict?this.throwException(this.TYPE_ERROR,"Cannot delete property '"+S+"' of '"+y+"'"):b=!1}}E=b;break;case"typeof":E=E&&E.class==="Function"?"function":typeof E;break;case"void":E=void 0;break;default:throw SyntaxError("Unknown unary operator: "+m.operator)}f[f.length-1].value=E},h.prototype.stepUpdateExpression=function(f,p,m){if(!p.doneLeft_){p.doneLeft_=!0;var T=new h.State(m.argument,p.scope);return T.components=!0,T}if(p.leftSide_||(p.leftSide_=p.value),p.doneGetter_&&(p.leftValue_=p.value),!p.doneGetter_){var b=this.getValue(p.leftSide_);if(p.leftValue_=b,this.getterStep_){p.doneGetter_=!0;var E=b;return this.createGetter_(E,p.leftSide_)}}if(p.doneSetter_){f.pop(),f[f.length-1].value=p.setterValue_;return}var b=Number(p.leftValue_),y;if(m.operator==="++")y=b+1;else if(m.operator==="--")y=b-1;else throw SyntaxError("Unknown update expression: "+m.operator);var S=m.prefix?y:b,A=this.setValue(p.leftSide_,y);if(A)return p.doneSetter_=!0,p.setterValue_=S,this.createSetter_(A,p.leftSide_,y);f.pop(),f[f.length-1].value=S},h.prototype.stepVariableDeclaration=function(f,p,m){var T=m.declarations,E=p.n_||0,b=T[E];for(p.init_&&b&&(this.setValueToScope(b.id.name,p.value),p.init_=!1,b=T[++E]);b;){if(b.init)return p.n_=E,p.init_=!0,p.destinationName=b.id.name,new h.State(b.init,p.scope);b=T[++E]}f.pop()},h.prototype.stepWithStatement=function(f,p,m){if(!p.doneObject_)return p.doneObject_=!0,new h.State(m.object,p.scope);f.pop();var T=this.createSpecialScope(p.scope,p.value);return new h.State(m.body,T)},h.prototype.stepWhileStatement=h.prototype.stepDoWhileStatement,h.nativeGlobal.Interpreter=h,h.prototype.step=h.prototype.step,h.prototype.run=h.prototype.run,h.prototype.appendCode=h.prototype.appendCode,h.prototype.createObject=h.prototype.createObject,h.prototype.createObjectProto=h.prototype.createObjectProto,h.prototype.createAsyncFunction=h.prototype.createAsyncFunction,h.prototype.createNativeFunction=h.prototype.createNativeFunction,h.prototype.getProperty=h.prototype.getProperty,h.prototype.setProperty=h.prototype.setProperty,h.prototype.getStatus=h.prototype.getStatus,h.prototype.nativeToPseudo=h.prototype.nativeToPseudo,h.prototype.pseudoToNative=h.prototype.pseudoToNative,h.prototype.getGlobalScope=h.prototype.getGlobalScope,h.prototype.setGlobalScope=h.prototype.setGlobalScope,h.prototype.getStateStack=h.prototype.getStateStack,h.prototype.setStateStack=h.prototype.setStateStack,h.VALUE_IN_DESCRIPTOR=h.VALUE_IN_DESCRIPTOR,h.Status=h.Status,l.exports={Interpreter:h}},"./original-repo/acorn.js":function(l,u){(function(d,h){return h(u)})(typeof globalThis>"u"?this||window:globalThis,function(d){d.version="0.5.0";var h,f="",p,m;d.parse=function(Ee,Oe){return f=String(Ee),p=f.length,E(Oe),pt(),cs(h.program)};var T={strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,allowReturnOutsideFunction:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null};function E(Ee){h=Ee||{};for(var Oe in T)Object.prototype.hasOwnProperty.call(h,Oe)||(h[Oe]=T[Oe]);m=h.sourceFile}var b=function(Ee,Oe){for(var lt=1,Et=0;;){Ke.lastIndex=Et;var _n=Ke.exec(Ee);if(_n&&_n.index<Oe)++lt,Et=_n.index+_n[0].length;else break}return{line:lt,column:Oe-Et}},y=0,S=0,A=0,C,R,I,O,F,k,D,U=0,ce=0,ie,ae,ne,pe;function de(Ee,Oe){var lt=b(f,Ee);Oe+=" ("+lt.line+":"+lt.column+")";var Et=new SyntaxError(Oe);throw Et.pos=Ee,Et.loc=lt,Et.raisedAt=y,Et}var xe=[],H={type:"num"},J={type:"regexp"},K={type:"string"},se={type:"name"},Y={type:"eof"},he={keyword:"break"},ue={keyword:"case",beforeExpr:!0},Te={keyword:"catch"},_e={keyword:"continue"},Re={keyword:"debugger"},De={keyword:"default"},et={keyword:"do",isLoop:!0},Ue={keyword:"else",beforeExpr:!0},Le={keyword:"finally"},re={keyword:"for",isLoop:!0},Ye={keyword:"function"},Fe={keyword:"if"},Ze={keyword:"return",beforeExpr:!0},Xe={keyword:"switch"},dt={keyword:"throw",beforeExpr:!0},je={keyword:"try"},it={keyword:"var"},Ce={keyword:"while",isLoop:!0},Me={keyword:"with"},St={keyword:"new",beforeExpr:!0},oe={keyword:"this"},ee={keyword:"null",atomValue:null},W={keyword:"true",atomValue:!0},ot={keyword:"false",atomValue:!1},ze={keyword:"in",binop:7,beforeExpr:!0},qe={break:he,case:ue,catch:Te,continue:_e,debugger:Re,default:De,do:et,else:Ue,finally:Le,for:re,function:Ye,if:Fe,return:Ze,switch:Xe,throw:dt,try:je,var:it,while:Ce,with:Me,null:ee,true:W,false:ot,new:St,in:ze,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:oe,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},ut={type:"[",beforeExpr:!0},ft={type:"]"},Ge={type:"{",beforeExpr:!0},$t={type:"}"},L={type:"(",beforeExpr:!0},X={type:")"},fe={type:",",beforeExpr:!0},z={type:";",beforeExpr:!0},Ae={type:":",beforeExpr:!0},tt={type:"."},ye={type:"?",beforeExpr:!0},Ie={binop:10,beforeExpr:!0},Be={isAssign:!0,beforeExpr:!0},N={isAssign:!0,beforeExpr:!0},j={postfix:!0,prefix:!0,isUpdate:!0},ge={prefix:!0,beforeExpr:!0},we={binop:1,beforeExpr:!0},We={binop:2,beforeExpr:!0},gt={binop:3,beforeExpr:!0},bt={binop:4,beforeExpr:!0},un={binop:5,beforeExpr:!0},an={binop:6,beforeExpr:!0},ei={binop:7,beforeExpr:!0},pi={binop:8,beforeExpr:!0},Ji={binop:9,prefix:!0,beforeExpr:!0},Ci={binop:10,beforeExpr:!0};function vi(Ee){for(var Oe=Ee.split(" "),lt=Object.create(null),Et=0;Et<Oe.length;Et++)lt[Oe[Et]]=!0;return function(_n){return lt[_n]||!1}}var Ti=vi("class enum extends super const export import"),nn=vi("implements interface let package private protected public static yield"),mi=vi("eval arguments"),yr=vi("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Z=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,B="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",le="̀-ͯ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿",ve=new RegExp("["+B+"]"),me=new RegExp("["+B+le+"]"),Se=/[\n\r\u2028\u2029]/,Ke=/\r\n|[\n\r\u2028\u2029]/g,Je=function(Ee){return Ee<65?Ee===36:Ee<91?!0:Ee<97?Ee===95:Ee<123?!0:Ee>=170&&ve.test(String.fromCharCode(Ee))},at=function(Ee){return Ee<48?Ee===36:Ee<58?!0:Ee<65?!1:Ee<91?!0:Ee<97?Ee===95:Ee<123?!0:Ee>=170&&me.test(String.fromCharCode(Ee))};function rt(){this.line=k,this.column=y-D}function pt(){k=1,y=D=0,F=!0,wt()}function Ne(Ee,Oe){A=y,h.locations&&(R=new rt),I=Ee,wt(),O=Oe,F=Ee.beforeExpr}function It(){var Ee=h.onComment&&h.locations&&new rt,Oe=y,lt=f.indexOf("*/",y+=2);if(lt===-1&&de(y-2,"Unterminated comment"),y=lt+2,h.locations){Ke.lastIndex=Oe;for(var Et;(Et=Ke.exec(f))&&Et.index<y;)++k,D=Et.index+Et[0].length}h.onComment&&h.onComment(!0,f.slice(Oe+2,lt),Oe,y,Ee,h.locations&&new rt)}function xt(){for(var Ee=y,Oe=h.onComment&&h.locations&&new rt,lt=f.charCodeAt(y+=2);y<p&&lt!==10&&lt!==13&&lt!==8232&&lt!==8233;)++y,lt=f.charCodeAt(y);h.onComment&&h.onComment(!1,f.slice(Ee+2,y),Ee,y,Oe,h.locations&&new rt)}function wt(){for(;y<p;){var Ee=f.charCodeAt(y);if(Ee===32)++y;else if(Ee===13){++y;var Oe=f.charCodeAt(y);Oe===10&&++y,h.locations&&(++k,D=y)}else if(Ee===10||Ee===8232||Ee===8233)++y,h.locations&&(++k,D=y);else if(Ee>8&&Ee<14)++y;else if(Ee===47){var Oe=f.charCodeAt(y+1);if(Oe===42)It();else if(Oe===47)xt();else break}else if(Ee===160)++y;else if(Ee>=5760&&Z.test(String.fromCharCode(Ee)))++y;else break}}function Ht(){var Ee=f.charCodeAt(y+1);Ee>=48&&Ee<=57?zn(!0):(++y,Ne(tt))}function Zt(){var Ee=f.charCodeAt(y+1);F?(++y,Fn()):Ee===61?tn(N,2):tn(Ie,1)}function jt(){var Ee=f.charCodeAt(y+1);Ee===61?tn(N,2):tn(Ci,1)}function Ot(Ee){var Oe=f.charCodeAt(y+1);Oe===Ee?tn(Ee===124?we:We,2):Oe===61?tn(N,2):tn(Ee===124?gt:un,1)}function qt(){var Ee=f.charCodeAt(y+1);Ee===61?tn(N,2):tn(bt,1)}function Ft(Ee){var Oe=f.charCodeAt(y+1);if(Oe===Ee){if(Oe===45&&f.charCodeAt(y+2)===62&&Se.test(f.slice(ce,y))){y+=3,xt(),wt(),bn();return}tn(j,2)}else Oe===61?tn(N,2):tn(Ji,1)}function ln(Ee){var Oe=f.charCodeAt(y+1),lt=1;if(Oe===Ee){lt=Ee===62&&f.charCodeAt(y+2)===62?3:2,f.charCodeAt(y+lt)===61?tn(N,lt+1):tn(pi,lt);return}if(Oe===33&&Ee===60&&f.charCodeAt(y+2)===45&&f.charCodeAt(y+3)===45){y+=4,xt(),wt(),bn();return}Oe===61&&(lt=f.charCodeAt(y+2)===61?3:2),tn(ei,lt)}function Bn(Ee){var Oe=f.charCodeAt(y+1);Oe===61?tn(an,f.charCodeAt(y+2)===61?3:2):tn(Ee===61?Be:ge,1)}function on(Ee){switch(Ee){case 46:return Ht();case 40:return++y,Ne(L);case 41:return++y,Ne(X);case 59:return++y,Ne(z);case 44:return++y,Ne(fe);case 91:return++y,Ne(ut);case 93:return++y,Ne(ft);case 123:return++y,Ne(Ge);case 125:return++y,Ne($t);case 58:return++y,Ne(Ae);case 63:return++y,Ne(ye);case 48:var Oe=f.charCodeAt(y+1);if(Oe===120||Oe===88)return hn();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return zn(!1);case 34:case 39:return Mn(Ee);case 47:return Zt();case 37:case 42:return jt();case 124:case 38:return Ot(Ee);case 94:return qt();case 43:case 45:return Ft(Ee);case 60:case 62:return ln(Ee);case 61:case 33:return Bn(Ee);case 126:return tn(ge,1)}return!1}function bn(Ee){if(Ee?y=S+1:S=y,h.locations&&(C=new rt),Ee)return Fn();if(y>=p)return Ne(Y);var Oe=f.charCodeAt(y);if(Je(Oe)||Oe===92)return xi();var lt=on(Oe);if(lt===!1){var Et=String.fromCharCode(Oe);if(Et==="\\"||ve.test(Et))return xi();de(y,"Unexpected character '"+Et+"'")}}function tn(Ee,Oe){var lt=f.slice(y,y+Oe);y+=Oe,Ne(Ee,lt)}function Fn(){for(var Ee,Oe,lt=y;;){y>=p&&de(lt,"Unterminated regexp");var Et=f.charAt(y);if(Se.test(Et)&&de(lt,"Unterminated regexp"),Ee)Ee=!1;else{if(Et==="[")Oe=!0;else if(Et==="]"&&Oe)Oe=!1;else if(Et==="/"&&!Oe)break;Ee=Et==="\\"}++y}var _n=f.slice(lt,y);++y;var fn=Sr();fn&&!/^[gmi]*$/.test(fn)&&de(lt,"Invalid regexp flag");try{var Qt=new RegExp(_n,fn)}catch(yn){throw yn instanceof SyntaxError&&de(lt,yn.message),yn}Ne(J,Qt)}function xn(Ee,Oe){for(var lt=y,Et=0,_n=Oe===void 0?1/0:Oe,fn=0;fn<_n;++fn){var Qt=f.charCodeAt(y),yn;if(Qt>=97?yn=Qt-97+10:Qt>=65?yn=Qt-65+10:Qt>=48&&Qt<=57?yn=Qt-48:yn=1/0,yn>=Ee)break;++y,Et=Et*Ee+yn}return y===lt||Oe!==void 0&&y-lt!==Oe?null:Et}function hn(){y+=2;var Ee=xn(16);Ee===null&&de(S+2,"Expected hexadecimal number"),Je(f.charCodeAt(y))&&de(y,"Identifier directly after number"),Ne(H,Ee)}function zn(Ee){var Oe=y,lt=!1,Et=f.charCodeAt(y)===48;!Ee&&xn(10)===null&&de(Oe,"Invalid number"),f.charCodeAt(y)===46&&(++y,xn(10),lt=!0);var _n=f.charCodeAt(y);(_n===69||_n===101)&&(_n=f.charCodeAt(++y),(_n===43||_n===45)&&++y,xn(10)===null&&de(Oe,"Invalid number"),lt=!0),Je(f.charCodeAt(y))&&de(y,"Identifier directly after number");var fn=f.slice(Oe,y),Qt;lt?Qt=parseFloat(fn):!Et||fn.length===1?Qt=parseInt(fn,10):/[89]/.test(fn)||pe?de(Oe,"Invalid number"):Qt=parseInt(fn,8),Ne(H,Qt)}function Mn(Ee){y++;for(var Oe="";;){y>=p&&de(S,"Unterminated string constant");var lt=f.charCodeAt(y);if(lt===Ee){++y,Ne(K,Oe);return}if(lt===92){lt=f.charCodeAt(++y);var Et=/^[0-7]+/.exec(f.slice(y,y+3));for(Et&&(Et=Et[0]);Et&&parseInt(Et,8)>255;)Et=Et.slice(0,-1);if(Et==="0"&&(Et=null),++y,Et)pe&&de(y-2,"Octal literal in strict mode"),Oe+=String.fromCharCode(parseInt(Et,8)),y+=Et.length-1;else switch(lt){case 110:Oe+=`
`;break;case 114:Oe+="\r";break;case 120:Oe+=String.fromCharCode(Kt(2));break;case 117:Oe+=String.fromCharCode(Kt(4));break;case 85:Oe+=String.fromCharCode(Kt(8));break;case 116:Oe+="	";break;case 98:Oe+="\b";break;case 118:Oe+="\v";break;case 102:Oe+="\f";break;case 48:Oe+="\0";break;case 13:f.charCodeAt(y)===10&&++y;case 10:h.locations&&(D=y,++k);break;default:Oe+=String.fromCharCode(lt);break}}else(lt===13||lt===10||lt===8232||lt===8233)&&de(S,"Unterminated string constant"),Oe+=String.fromCharCode(lt),++y}}function Kt(Ee){var Oe=xn(16,Ee);return Oe===null&&de(S,"Bad character escape sequence"),Oe}var An;function Sr(){An=!1;for(var Ee,Oe=!0,lt=y;;){var Et=f.charCodeAt(y);if(at(Et))An&&(Ee+=f.charAt(y)),++y;else if(Et===92){An||(Ee=f.slice(lt,y)),An=!0,f.charCodeAt(++y)!==117&&de(y,"Expecting Unicode escape sequence \\uXXXX"),++y;var _n=Kt(4),fn=String.fromCharCode(_n);fn||de(y-1,"Invalid Unicode escape"),(Oe?Je(_n):at(_n))||de(y-4,"Invalid Unicode escape"),Ee+=fn}else break;Oe=!1}return An?Ee:f.slice(lt,y)}function xi(){var Ee=Sr(),Oe=se;!An&&yr(Ee)&&(Oe=qe[Ee]),Ne(Oe,Ee)}function mn(){U=S,ce=A,ie=R,bn()}function ls(Ee){if(pe=Ee,y=S,h.locations)for(;y<D;)D=f.lastIndexOf(`
`,D-2)+1,--k;wt(),bn()}function Ys(){this.type=null,this.start=S,this.end=null}function xs(){this.start=C,this.end=null,m&&(this.source=m)}function hi(){var Ee=new Ys;return h.locations&&(Ee.loc=new xs),h.directSourceFile&&(Ee.sourceFile=h.directSourceFile),h.ranges&&(Ee.range=[S,0]),Ee}function Rs(Ee){var Oe=new Ys;return Oe.start=Ee.start,h.locations&&(Oe.loc=new xs,Oe.loc.start=Ee.loc.start),h.ranges&&(Oe.range=[Ee.range[0],0]),Oe}function dn(Ee,Oe){return Ee.type=Oe,Ee.end=ce,h.locations&&(Ee.loc.end=ie),h.ranges&&(Ee.range[1]=ce),Ee}function kr(Ee){return Ee.type==="ExpressionStatement"&&Ee.expression.type==="Literal"&&Ee.expression.value==="use strict"}function jn(Ee){return I===Ee?(mn(),!0):!1}function Qr(){return!h.strictSemicolons&&(I===Y||I===$t||Se.test(f.slice(ce,S)))}function Pr(){!jn(z)&&!Qr()&&sn()}function ti(Ee){I===Ee?mn():sn()}function sn(){de(S,"Unexpected token")}function Ei(Ee){Ee.type!=="Identifier"&&Ee.type!=="MemberExpression"&&de(Ee.start,"Assigning to rvalue"),pe&&Ee.type==="Identifier"&&mi(Ee.name)&&de(Ee.start,"Assigning to "+Ee.name+" in strict mode")}function cs(Ee){U=ce=y,h.locations&&(ie=new rt),ae=pe=!1,ne=[],bn();var Oe=Ee||hi(),lt=!0;for(Ee||(Oe.body=[]);I!==Y;){var Et=Dr();Oe.body.push(Et),lt&&kr(Et)&&ls(!0),lt=!1}return dn(Oe,"Program")}var Vi={kind:"loop"},Gl={kind:"switch"};function Dr(){(I===Ie||I===N&&O==="/=")&&bn(!0);var Ee=I,Oe=hi();switch(Ee){case he:case _e:mn();var lt=Ee===he;jn(z)||Qr()?Oe.label=null:I!==se?sn():(Oe.label=Oi(),Pr());for(var Et=0;Et<ne.length;++Et){var _n=ne[Et];if((Oe.label===null||_n.name===Oe.label.name)&&(_n.kind!==null&&(lt||_n.kind==="loop")||Oe.label&&lt))break}return Et===ne.length&&de(Oe.start,"Unsyntactic "+Ee.keyword),dn(Oe,lt?"BreakStatement":"ContinueStatement");case Re:return mn(),Pr(),dn(Oe,"DebuggerStatement");case et:return mn(),ne.push(Vi),Oe.body=Dr(),ne.pop(),ti(Ce),Oe.test=ai(),Pr(),dn(Oe,"DoWhileStatement");case re:if(mn(),ne.push(Vi),ti(L),I===z)return Za(Oe,null);if(I===it){var fn=hi();return mn(),qa(fn,!0),dn(fn,"VariableDeclaration"),fn.declarations.length===1&&jn(ze)?mr(Oe,fn):Za(Oe,fn)}var fn=Ri(!1,!0);return jn(ze)?(Ei(fn),mr(Oe,fn)):Za(Oe,fn);case Ye:return mn(),vo(Oe,!0);case Fe:return mn(),Oe.test=ai(),Oe.consequent=Dr(),Oe.alternate=jn(Ue)?Dr():null,dn(Oe,"IfStatement");case Ze:return!ae&&!h.allowReturnOutsideFunction&&de(S,"'return' outside of function"),mn(),jn(z)||Qr()?Oe.argument=null:(Oe.argument=Ri(),Pr()),dn(Oe,"ReturnStatement");case Xe:mn(),Oe.discriminant=ai(),Oe.cases=[],ti(Ge),ne.push(Gl);for(var Qt,yn;I!==$t;)if(I===ue||I===De){var li=I===ue;Qt&&dn(Qt,"SwitchCase"),Oe.cases.push(Qt=hi()),Qt.consequent=[],mn(),li?Qt.test=Ri():(yn&&de(U,"Multiple default clauses"),yn=!0,Qt.test=null),ti(Ae)}else Qt||sn(),Qt.consequent.push(Dr());return Qt&&dn(Qt,"SwitchCase"),mn(),ne.pop(),dn(Oe,"SwitchStatement");case dt:return mn(),Se.test(f.slice(ce,S))&&de(ce,"Illegal newline after throw"),Oe.argument=Ri(),Pr(),dn(Oe,"ThrowStatement");case je:if(mn(),Oe.block=ws(),Oe.handler=null,I===Te){var ci=hi();mn(),ti(L),ci.param=Oi(),pe&&mi(ci.param.name)&&de(ci.param.start,"Binding "+ci.param.name+" in strict mode"),ti(X),ci.body=ws(),Oe.handler=dn(ci,"CatchClause")}return Oe.finalizer=jn(Le)?ws():null,!Oe.handler&&!Oe.finalizer&&de(Oe.start,"Missing catch or finally clause"),dn(Oe,"TryStatement");case it:return mn(),qa(Oe),Pr(),dn(Oe,"VariableDeclaration");case Ce:return mn(),Oe.test=ai(),ne.push(Vi),Oe.body=Dr(),ne.pop(),dn(Oe,"WhileStatement");case Me:return pe&&de(S,"'with' in strict mode"),mn(),Oe.object=ai(),Oe.body=Dr(),dn(Oe,"WithStatement");case Ge:return ws();case z:return mn(),dn(Oe,"EmptyStatement");default:var br=O,us=Ri();if(Ee===se&&us.type==="Identifier"&&jn(Ae)){for(var Et=0;Et<ne.length;++Et)ne[Et].name===br&&de(us.start,"Label '"+br+"' is already declared");var Ic=I.isLoop?"loop":I===Xe?"switch":null;return ne.push({name:br,kind:Ic}),Oe.body=Dr(),ne.pop(),Oe.label=us,dn(Oe,"LabeledStatement")}else return Oe.expression=us,Pr(),dn(Oe,"ExpressionStatement")}}function ai(){ti(L);var Ee=Ri();return ti(X),Ee}function ws(Ee){var Oe=hi(),lt=!0,Et=!1,_n;for(Oe.body=[],ti(Ge);!jn($t);){var fn=Dr();Oe.body.push(fn),lt&&Ee&&kr(fn)&&(_n=Et,ls(Et=!0)),lt=!1}return Et&&!_n&&ls(!1),dn(Oe,"BlockStatement")}function Za(Ee,Oe){return Ee.init=Oe,ti(z),Ee.test=I===z?null:Ri(),ti(z),Ee.update=I===X?null:Ri(),ti(X),Ee.body=Dr(),ne.pop(),dn(Ee,"ForStatement")}function mr(Ee,Oe){return Ee.left=Oe,Ee.right=Ri(),ti(X),Ee.body=Dr(),ne.pop(),dn(Ee,"ForInStatement")}function qa(Ee,Oe){for(Ee.declarations=[],Ee.kind="var";;){var lt=hi();if(lt.id=Oi(),pe&&mi(lt.id.name)&&de(lt.id.start,"Binding "+lt.id.name+" in strict mode"),lt.init=jn(Be)?Ri(!0,Oe):null,Ee.declarations.push(dn(lt,"VariableDeclarator")),!jn(fe))break}}function Ri(Ee,Oe){var lt=Ii(Oe);if(!Ee&&I===fe){var Et=Rs(lt);for(Et.expressions=[lt];jn(fe);)Et.expressions.push(Ii(Oe));return dn(Et,"SequenceExpression")}return lt}function Ii(Ee){var Oe=_o(Ee);if(I.isAssign){var lt=Rs(Oe);return lt.operator=O,lt.left=Oe,mn(),lt.right=Ii(Ee),Ei(Oe),dn(lt,"AssignmentExpression")}return Oe}function _o(Ee){var Oe=Hl(Ee);if(jn(ye)){var lt=Rs(Oe);return lt.test=Oe,lt.consequent=Ri(!0),ti(Ae),lt.alternate=Ri(!0,Ee),dn(lt,"ConditionalExpression")}return Oe}function Hl(Ee){return $r(or(),-1,Ee)}function $r(Ee,Oe,lt){var Et=I.binop;if(Et!==null&&(!lt||I!==ze)&&Et>Oe){var _n=Rs(Ee);_n.left=Ee,_n.operator=O;var fn=I;mn(),_n.right=$r(or(),Et,lt);var Qt=dn(_n,fn===we||fn===We?"LogicalExpression":"BinaryExpression");return $r(Qt,Oe,lt)}return Ee}function or(){if(I.prefix){var Ee=hi(),Oe=I.isUpdate;return Ee.operator=O,Ee.prefix=!0,F=!0,mn(),Ee.argument=or(),Oe?Ei(Ee.argument):pe&&Ee.operator==="delete"&&Ee.argument.type==="Identifier"&&de(Ee.start,"Deleting local variable in strict mode"),dn(Ee,Oe?"UpdateExpression":"UnaryExpression")}for(var lt=Ks();I.postfix&&!Qr();){var Ee=Rs(lt);Ee.operator=O,Ee.prefix=!1,Ee.argument=lt,Ei(lt),mn(),lt=dn(Ee,"UpdateExpression")}return lt}function Ks(){return gr(ma())}function gr(Ee,Oe){var lt;return jn(tt)?(lt=Rs(Ee),lt.object=Ee,lt.property=Oi(!0),lt.computed=!1,gr(dn(lt,"MemberExpression"),Oe)):jn(ut)?(lt=Rs(Ee),lt.object=Ee,lt.property=Ri(),lt.computed=!0,ti(ft),gr(dn(lt,"MemberExpression"),Oe)):!Oe&&jn(L)?(lt=Rs(Ee),lt.callee=Ee,lt.arguments=Js(X,!1),gr(dn(lt,"CallExpression"),Oe)):Ee}function ma(){var Ee;switch(I){case oe:return Ee=hi(),mn(),dn(Ee,"ThisExpression");case se:return Oi();case H:case K:case J:return Ee=hi(),Ee.value=O,Ee.raw=f.slice(S,A),mn(),dn(Ee,"Literal");case ee:case W:case ot:return Ee=hi(),Ee.value=I.atomValue,Ee.raw=I.keyword,mn(),dn(Ee,"Literal");case L:var Oe=C,lt=S;mn();var Et=Ri();return Et.start=lt,Et.end=A,h.locations&&(Et.loc.start=Oe,Et.loc.end=R),h.ranges&&(Et.range=[lt,A]),ti(X),Et;case ut:return Ee=hi(),mn(),Ee.elements=Js(ft,!0,!0),dn(Ee,"ArrayExpression");case Ge:return Br();case Ye:return Ee=hi(),mn(),vo(Ee,!1);case St:return Vl()}sn()}function Vl(){var Ee=hi();return mn(),Ee.callee=gr(ma(),!0),Ee.arguments=jn(L)?Js(X,!1):xe,dn(Ee,"NewExpression")}function Br(){var Ee=hi(),Oe=!0,lt=!1;for(Ee.properties=[],mn();!jn($t);){if(Oe)Oe=!1;else if(ti(fe),h.allowTrailingCommas&&jn($t))break;var Et={key:Bo()},_n=!1,fn;if(jn(Ae)?(Et.value=Ri(!0),fn=Et.kind="init"):Et.key.type==="Identifier"&&(Et.key.name==="get"||Et.key.name==="set")?(_n=lt=!0,fn=Et.kind=Et.key.name,Et.key=Bo(),I!==L&&sn(),Et.value=vo(hi(),!1)):sn(),Et.key.type==="Identifier"&&(pe||lt))for(var Qt=0;Qt<Ee.properties.length;++Qt){var yn=Ee.properties[Qt];if(yn.key.name===Et.key.name){var li=fn===yn.kind||_n&&yn.kind==="init"||fn==="init"&&(yn.kind==="get"||yn.kind==="set");li&&!pe&&fn==="init"&&yn.kind==="init"&&(li=!1),li&&de(Et.key.start,"Redefinition of property")}}Ee.properties.push(Et)}return dn(Ee,"ObjectExpression")}function Bo(){return I===H||I===K?ma():Oi(!0)}function vo(Ee,Oe){I===se?Ee.id=Oi():Oe?sn():Ee.id=null,Ee.params=[];var lt=!0;for(ti(L);!jn(X);)lt?lt=!1:ti(fe),Ee.params.push(Oi());var Et=ae,_n=ne;if(ae=!0,ne=[],Ee.body=ws(!0),ae=Et,ne=_n,pe||Ee.body.body.length&&kr(Ee.body.body[0]))for(var fn=Ee.id?-1:0;fn<Ee.params.length;++fn){var Qt=fn<0?Ee.id:Ee.params[fn];if((nn(Qt.name)||mi(Qt.name))&&de(Qt.start,"Defining '"+Qt.name+"' in strict mode"),fn>=0)for(var yn=0;yn<fn;++yn)Qt.name===Ee.params[yn].name&&de(Qt.start,"Argument name clash in strict mode")}return dn(Ee,Oe?"FunctionDeclaration":"FunctionExpression")}function Js(Ee,Oe,lt){for(var Et=[],_n=!0;!jn(Ee);){if(_n)_n=!1;else if(ti(fe),Oe&&h.allowTrailingCommas&&jn(Ee))break;Et.push(lt&&I===fe?null:Ri(!0))}return Et}function Oi(Ee){var Oe=hi();return Ee&&h.forbidReserved==="everywhere"&&(Ee=!1),I===se?(!Ee&&(h.forbidReserved&&Ti(O)||pe&&nn(O))&&f.slice(S,A).indexOf("\\")===-1&&de(S,"The keyword '"+O+"' is reserved"),Oe.name=O):Ee&&I.keyword?Oe.name=I.keyword:sn(),F=!1,mn(),dn(Oe,"Identifier")}})},vm:l=>{l.exports=koe}},r={};function s(l){var u=r[l];if(u!==void 0)return u.exports;var d=r[l]={exports:{}};return n[l].call(d.exports,d,d.exports,s),d.exports}s.d=(l,u)=>{for(var d in u)s.o(u,d)&&!s.o(l,d)&&Object.defineProperty(l,d,{enumerable:!0,get:u[d]})},s.o=(l,u)=>Object.prototype.hasOwnProperty.call(l,u),s.r=l=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})};var a={};return(()=>{/*!*******************************!*\
  !*** ./src/js-interpreter.js ***!
  \*******************************/s.r(a),s.d(a,{default:()=>d});const l=s("./original-repo/acorn.js");globalThis.acorn=l;const{Interpreter:u}=s("./original-repo/interpreter.js"),d=u})(),a=a.default,a})())})(M2);var Poe=M2.exports;const J0=hd(Poe),Doe=i=>/if\s*\(.*\)/.test(i),Boe=i=>/for\s*\(.*\)/.test(i),Foe=i=>{const e=/for\s*\(\s*var\s+(\w+)\s*=\s*(\d+);\s*\1\s*<\s*(\d+);\s*\1\+\+\s*\)/,n=i.match(e);if(!n)throw new Error("Invalid for loop format");const r=parseInt(n[3],10),s=i.match(/\{([^}]*)\}/);let a="";return s?(a=s[1].trim(),console.log("Contents inside the loop: ",a)):console.log("No content found inside braces."),{count:r,content:a}};R2(xoe);const mo=()=>{const[i,e]=q.useState(!1),[n,r]=q.useState(!1),s=()=>{e(!i)},a=q.useRef();let l=q.useRef();const[u,d]=q.useState(!1),h=()=>{lg().clear()},f=()=>{Tt.emit("resetSimulationEnv")},p=()=>{d(H=>{const J=!H;return Tt.emit("mouseControlEnabled",J),r(J),J})},m=()=>{var H=Dn.workspaceToCode(lg().current);console.log(H);const J=new J0(H,S),K=()=>{J.step()?requestAnimationFrame(K):console.log("Simulation completed")};K()},T=()=>{const H=Dn.workspaceToCode(lg().current),J=Foe(H),K=ue=>new Promise(Te=>setTimeout(Te,ue)),se=async ue=>{for(const Te of ue){console.log(`Executing command: ${Te.trim()}`);const _e=new J0(Te,S),Re=()=>{_e.step()?requestAnimationFrame(Re):console.log("Command execution completed")};Re(),await K(1e4)}},Y=async(ue,Te)=>{for(let _e=0;_e<ue;_e++)console.log(`Iteration ${_e+1} of ${ue}`),await se(Te);console.log("Mission Completed")},he=J.content.split(";").map(ue=>ue.trim()).filter(ue=>ue);Y(J.count,he)},E=H=>{const J=H.split(";"),K=Y=>new Promise(he=>setTimeout(he,Y));(async Y=>{for(let he=0;he<Y;he++){const ue=J[he];console.log(ue);const Te=new J0(ue,S),_e=()=>{Te.step()?requestAnimationFrame(_e):console.log("Simulation completed")};_e(),await K(5e3)}console.log("Mission Completed")})(J.length)},b=()=>{var H=Dn.workspaceToCode(lg().current);if(H.includes("function")){console.log("Executing Function Simulator..."),console.log(H);const J=new J0(H,S),K=()=>{J.step()?setTimeout(K,500):console.log("Function Execution Completed")};K()}else console.log("No function found, skipping function simulator.")},y=()=>{var H=Dn.workspaceToCode(lg().current);H.includes("function")?b():Doe(H)?m():Boe(H)?T():E(H)},S=(H,J)=>{const K=Y=>(he,ue,Te,_e)=>Y(he,ue,Te,_e),se=Y=>{window.alert(Y?Y.toString():"")};H.setProperty(J,"alert",H.createNativeFunction(se)),H.setProperty(J,"flyForward",H.createNativeFunction(K(k))),H.setProperty(J,"flyBackward",H.createNativeFunction(K(ce))),H.setProperty(J,"flyDown",H.createNativeFunction(K(ne))),H.setProperty(J,"flyUp",H.createNativeFunction(K(F))),H.setProperty(J,"flyLeft",H.createNativeFunction(K(ie))),H.setProperty(J,"flyRight",H.createNativeFunction(K(ae))),H.setProperty(J,"setSpeed",H.createNativeFunction(K(U))),H.setProperty(J,"setWaitTime",H.createNativeFunction(K(D))),H.setProperty(J,"rotateDrone",H.createNativeFunction(K(de))),H.setProperty(J,"moveTo",H.createNativeFunction(K(pe))),H.setProperty(J,"captureImage",H.createNativeFunction(K(O))),H.setProperty(J,"flip",H.createNativeFunction(K(xe))),H.setProperty(J,"pickupObject",H.createNativeFunction(A)),H.setProperty(J,"dropObject",H.createNativeFunction(C)),H.setProperty(J,"sprayObject",H.createNativeFunction(R)),H.setProperty(J,"advertiseText",H.createNativeFunction(I))},A=H=>{Tt.emit("commandPickupObject",H)},C=H=>{Tt.emit("commandDropObject",H)},R=H=>{Tt.emit("commandSpray",H)},I=H=>{Tt.emit("commandAdvertiseText",H)},O=()=>{Tt.emit("commandTakeScreenShot")},F=(H,J)=>{Tt.emit("commandFlyUp",[H,J])},k=(H,J)=>{Tt.emit("commandFlyFoward",[H,J])},D=(H,J)=>{Tt.emit("commandSetWaitTime",[H,J])},U=H=>{Tt.emit("commandSetSpeed",[H])},ce=(H,J)=>{Tt.emit("commandFlyBackward",[H,J])},ie=(H,J)=>{Tt.emit("commandFlyLeft",[H,J])},ae=(H,J)=>{Tt.emit("commandFlyRight",[H,J])},ne=(H,J)=>{Tt.emit("commandFlyDown",[H,J])},pe=(H,J,K,se)=>{Tt.emit("commandFlyTo",[H,J,K,se])},de=(H,J,K,se)=>{Tt.emit("commandRotate",[H,J,K,se])},xe=H=>{Tt.emit("commandFlip",[H])};return q.useEffect(()=>{const H=Moe;Ioe(Pq),l.current=x2(a.current,{toolbox:H,theme:Ooe,zoom:{controls:!0,wheel:!0,startScale:.9},grid:{spacing:20,length:3,colour:"#ccc",snap:!0},trashcan:!0,move:!0})},[]),G.jsxs("div",{className:"blockpad-wrapper",children:[G.jsxs("div",{className:"button-bar",children:[G.jsx(yg,{onClick:h,title:"Clear Workspace",green:!0,medium:!0}),G.jsx(yg,{onClick:y,title:"Launch Simulation",medium:!0}),G.jsx(yg,{onClick:f,title:"Reset Simulation",medium:!0,children:"/"}),G.jsxs("label",{className:"toggle-switch",children:[G.jsx("input",{type:"checkbox",checked:u,onChange:p}),G.jsx("span",{className:"slider",children:" Mouse Control "})]})]}),G.jsx("div",{ref:a,className:"blockly-area"}),n&&G.jsxs("div",{className:"note-box",children:[G.jsxs("p",{children:["⚠️ ",G.jsx("strong",{children:"Note:"})," Enabling mouse control disables the default camera perspective of the drone."]}),G.jsx("button",{className:"close-btn",onClick:()=>r(!1),children:"✖"})]}),i&&G.jsx("div",{className:"blockly-modal",children:G.jsxs("div",{className:"blockly-modal-content",children:[G.jsx("div",{className:"blockly-modal-close",children:G.jsx(yg,{onClick:s,title:"Close",small:!0,children:"/"})}),G.jsx("h2",{children:"Select a Lesson"}),G.jsx("div",{className:"blockly-lesson-buttons"})]})})]})};mo.propTypes={};const Uoe=i=>-Math.ceil(i*(180/Math.PI))%360,go=({dronePosition:i,disableMeasurementView:e})=>{const[n,r]=q.useState(!1),s=()=>{r(a=>{const l=!a;return console.log("value changed to ",l),Tt.emit("measurementViewEnabled",l),l})};return G.jsx("div",{className:"toolbar",children:G.jsxs("div",{className:"row",children:[G.jsxs("div",{className:"column",children:[G.jsxs("span",{className:"coordinate",children:["X: ",Math.ceil(i.xPos)," cm "]}),G.jsxs("span",{className:"coordinate",children:["Z: ",Math.ceil(i.zPos)," cm "]})]}),G.jsxs("div",{className:"column",children:[G.jsxs("span",{className:"coordinate",children:["Altitude: ",Math.ceil(i.yPos)," cm "]}),G.jsxs("span",{className:"rotation",children:["Yaw: ",Uoe(i.yRot),"°"]})]}),G.jsx("div",{className:"column",children:!e&&G.jsxs("label",{className:"toggle-switch",children:[G.jsx("input",{type:"checkbox",checked:n,onChange:s}),G.jsx("span",{className:"slider",children:"Measurement View"})]})})]})})};go.propTypes={dronePosition:Xt.shape({xPos:Xt.number.isRequired,yPos:Xt.number.isRequired,zPos:Xt.number.isRequired,xRot:Xt.number.isRequired,yRot:Xt.number.isRequired,zRot:Xt.number.isRequired,disableMeasurementView:Xt.bool}).isRequired};const Goe=()=>{window.gtag("event","page_view",{page_path:window.location.pathname});const i=q.useRef(),[e,n]=q.useState(!1),[r,s]=q.useState(!1),[a,l]=q.useState({xPos:0,yPos:0,zPos:0,xRot:0,yRot:0,zRot:0});return q.useEffect(()=>{const u=p=>{n(p)},d=p=>{console.log(p),s(p)};Tt.on("measurementViewEnabled",u),Tt.on("mouseControlEnabled",d);const f=setInterval(()=>{i.current&&l({xPos:i.current.position.x,yPos:i.current.position.y,zPos:i.current.position.z,xRot:i.current.rotation.x,yRot:i.current.rotation.y,zRot:i.current.rotation.z})},100);return()=>clearInterval(f)},[]),G.jsx(fo,{children:G.jsxs("div",{className:"simulation-container",children:[G.jsx("div",{className:"blockpad-container",children:G.jsx(mo,{})}),G.jsxs("div",{className:"canvas-container",children:[G.jsx(go,{dronePosition:a}),G.jsx($2,{droneRef:i,measurementViewEnabled:e,mouseControlEnabled:r})]})]})})};function Hoe(i){const e=new Map,n=new Map,r=i.clone();return I2(i,r,function(s,a){e.set(a,s),n.set(s,a)}),r.traverse(function(s){if(!s.isSkinnedMesh)return;const a=s,l=e.get(s),u=l.skeleton.bones;a.skeleton=l.skeleton.clone(),a.bindMatrix.copy(l.bindMatrix),a.skeleton.bones=u.map(function(d){return n.get(d)}),a.bind(a.skeleton,a.bindMatrix)}),r}function I2(i,e,n){n(i,e);for(let r=0;r<i.children.length;r++)I2(i.children[r],e.children[r],n)}const Nn=q.forwardRef(({path:i,position:e,rotation:n=[0,0,0],scale:r=1,name:s,enableMeasurement:a},l)=>{const{scene:u}=Cs(i),d=q.useRef(),[h,f]=q.useState(!1),p=q.useMemo(()=>Hoe(u),[u]);return q.useImperativeHandle(l,()=>d.current),q.useEffect(()=>{d.current&&(d.current.name=s)},[s]),G.jsxs(G.Fragment,{children:[G.jsx("group",{position:e,rotation:n,scale:r,onPointerOver:()=>f(!0),onPointerOut:()=>f(!1),children:G.jsx("primitive",{object:p,ref:d})}),h&&G.jsx(ji,{position:[e[0]-6,e[1]+5,e[2]+3],fontSize:1,color:"black",anchorX:"center",anchorY:"center",rotation:a?[Math.PI/2,Math.PI,0]:[0,Math.PI,0],children:s})]})}),Voe=new Do;let JS,ZS,Zv=null,zoe="white",Woe="black",Xoe="yellow",joe="black";const Yoe=({measurementViewEnabled:i})=>{const{camera:e,gl:n,scene:r}=$n(),s=q.useRef();return q.useEffect(()=>{i?(e.position.set(0,450,-200),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI/2,s.current.minPolarAngle=Math.PI/2,s.current.enableRotate=!1)):(e.position.set(50,50,50),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI,s.current.minPolarAngle=0,s.current.enableRotate=!0)),JS=e,ZS=r},[i,e]),G.jsx(G.Fragment,{children:!i&&G.jsx(No,{ref:s,args:[e,n.domElement]})})},Koe=({position:i})=>G.jsxs("mesh",{position:i,children:[G.jsx("sphereGeometry",{args:[.5,16,16]}),G.jsx("meshStandardMaterial",{color:Woe})]}),Joe=(i,e,n,r)=>{if(n){const s=i.target.getBoundingClientRect(),a=(i.clientX-s.left)/s.width*2-1,l=-((i.clientY-s.top)/s.height)*2+1,u=new te(a,l,.5),d=new As;d.setFromCamera(u,JS);const h=d.intersectObject(ZS,!0);if(h.length>0){const f=h[0].point;e(y=>[...y,f]),Zv==null&&(Zv=r.current.position.clone()),Zv.distanceTo(f);const p=[Zv,f],m=new rn().setFromPoints(p),T=new fi({color:zoe}),E=new Ki(m,T);ZS.add(E),Zv.copy(f);const b=`X: ${f.x.toFixed(2)} cm, Y: ${f.y.toFixed(2)} cm, Z: ${f.z.toFixed(2)} cm`;Zoe(b,f)}}},Zoe=(i,e)=>{Voe.load("assets/helvetiker_regular.typeface.json",n=>{const r=new Po(i,{font:n,size:2,height:.09,curveSegments:1,bevelEnabled:!1,bevelThickness:0,bevelSize:.03,bevelSegments:2}),s=new ii({color:joe}),a=new Pn(r,s);a.position.set(e.x,e.y+.4,e.z),a.quaternion.copy(JS.quaternion),a.lookAt(JS.position),ZS.add(a)},void 0,n=>{console.error("An error occurred loading the font:",n)})},qoe=()=>{const{scene:i}=Cs("assets/models/architecture/museum.glb"),e=[50,-70,-130],n=[0,220,0];return i.rotation.set(n[0],n[1],n[2]),G.jsx("primitive",{object:i,position:e,scale:15})},Qoe=()=>{const{gl:i}=$n(),e=()=>{const n=i.domElement.toDataURL("image/png"),r=new Date().toISOString().replace(/[:.]/g,"-"),s=document.createElement("a");s.href=n,s.download=`transportation_${r}.png`,s.click()};return q.useEffect(()=>{const n=()=>{e()};return Tt.on("commandTakeScreenShot",n),()=>{Tt.off("commandTakeScreenShot",n)}},[]),null},O2=({droneRef:i,measurementViewEnabled:e,mouseControlEnabled:n})=>{const r=q.useRef(),[s,a]=q.useState([]),l=q.useRef(),u=q.useRef(),d=q.useRef(),h=q.useRef(),f=q.useRef();return G.jsxs(Lo,{shadows:!0,onClick:p=>Joe(p,a,e,i),children:[G.jsx("color",{attach:"background",args:["#87CEEB"]})," ",G.jsx("ambientLight",{intensity:.4,color:new Ct(16761248)})," ",G.jsx(ko,{preset:"sunset",intensity:.5})," ",G.jsx(qoe,{}),e?G.jsxs(G.Fragment,{children:[G.jsx(Al,{children:G.jsx(ji,{position:[60,-150,140],fontSize:7,color:"black",children:"The Serving Room"})}),G.jsx(Al,{children:G.jsx(ji,{position:[50,-40,140],fontSize:7,color:"black",children:"The Dining Room"})}),G.jsx(Al,{children:G.jsx(ji,{position:[20,20,140],fontSize:7,color:"black",children:"The Upper Vestibule"})}),G.jsx(Al,{children:G.jsx(ji,{position:[-10,-50,50],fontSize:5,color:"black",children:"The Lower Vestibule"})}),G.jsx(Al,{children:G.jsx(ji,{position:[30,130,160],fontSize:7,color:"black",children:"The Small Drawing Room"})}),G.jsx(Al,{children:G.jsx(ji,{position:[-60,20,160],fontSize:5,color:"black",children:"The Morning Room"})}),G.jsx(Al,{children:G.jsx(ji,{position:[-60,130,160],fontSize:7,color:"black",children:"The Great Drawing Room"})}),G.jsx(Al,{children:G.jsx(ji,{position:[-150,130,160],fontSize:5,color:"black",children:"The Smoking Room"})}),G.jsx(Al,{children:G.jsx(ji,{position:[-130,40,140],fontSize:7,color:"black",children:"The Armoury"})}),G.jsx(Al,{children:G.jsx(ji,{position:[-150,-60,140],fontSize:7,color:"black",children:"The Billiard Room"})}),G.jsx(Al,{children:G.jsx(ji,{position:[-150,-150,140],fontSize:7,color:"black",children:"The Porcelain Room"})})]}):G.jsxs(G.Fragment,{children:[G.jsx(ji,{position:[-80,30,-200],fontSize:5,color:"black",rotation:[0,Math.PI,0],children:"The Serving Room"}),G.jsx(ji,{position:[-80,30,-100],fontSize:5,color:"black",rotation:[0,Math.PI,0],children:"The Dining Room"}),G.jsx(ji,{position:[-10,30,50],fontSize:5,color:"black",rotation:[0,Math.PI,0],children:"The Upper Vestibule"}),G.jsx(ji,{position:[-10,-50,50],fontSize:5,color:"black",rotation:[0,Math.PI,0],children:"The Lower Vestibule"}),G.jsx(ji,{position:[-50,30,160],fontSize:5,color:"black",rotation:[0,Math.PI,0],children:"The Small Drawing Room"}),G.jsx(ji,{position:[80,30,40],fontSize:5,color:"black",rotation:[0,Math.PI,0],children:"The Morning Room"}),G.jsx(ji,{position:[80,30,140],fontSize:5,color:"black",rotation:[0,Math.PI,0],children:"The Great Drawing Room"}),G.jsx(ji,{position:[230,20,140],fontSize:5,color:"black",rotation:[0,Math.PI,0],children:"The Smoking Room"}),G.jsx(ji,{position:[200,20,40],fontSize:5,color:"black",rotation:[0,Math.PI,0],children:"The Armoury"}),G.jsx(ji,{position:[210,20,-100],fontSize:5,color:"black",rotation:[0,Math.PI,0],children:"The Billiard Room"}),G.jsx(ji,{position:[200,10,-200],fontSize:5,color:"black",rotation:[0,Math.PI,0],children:"The Porcelain Room"})]}),s.map((p,m)=>G.jsx(Koe,{position:p},m)),G.jsx(Yoe,{measurementViewEnabled:e}),G.jsx(Qoe,{}),G.jsx(po,{ref:i,controlsRef:r,measurementViewEnabled:e,mouseControlEnabled:n,droneScale:.6,cameraOffset:[0,10,-13],lineColor:Xoe,droneSpeed:.4}),G.jsx(Nn,{ref:l,path:"/drone-simulation-cte-alpha/assets/models/architecture/child.glb",position:[160,-5,-200],scale:20,enableMeasurement:e}),G.jsx(Nn,{ref:d,path:"/drone-simulation-cte-alpha/assets/models/architecture/first_aid.glb",position:[-35,10,-200],rotation:[0,Math.PI/2,0],scale:40,enableMeasurement:e}),G.jsx(Nn,{ref:u,path:"/drone-simulation-cte-alpha/assets/models/architecture/frame.glb",position:[0,-10,70],rotation:[-90,0,0],scale:2,enableMeasurement:e}),G.jsx(Nn,{ref:h,path:"/drone-simulation-cte-alpha/assets/models/hospitality/wallet.glb",position:[170,10,70],rotation:[0,0,0],scale:.4,enableMeasurement:e}),G.jsx(Nn,{ref:f,path:"/drone-simulation-cte-alpha/assets/models/manufacturing/fire.glb",position:[3,20,170],rotation:[0,140,0],scale:.03,enableMeasurement:e})]})};O2.propTypes={droneRef:Xt.object.isRequired,mouseControlEnabled:Xt.bool,measurementViewEnabled:Xt.bool};const eae=()=>{window.gtag("event","page_view",{page_path:window.location.pathname});const i=q.useRef(),[e,n]=q.useState(!1),[r,s]=q.useState(!1),[a,l]=q.useState({xPos:0,yPos:0,zPos:0,xRot:0,yRot:0,zRot:0});return q.useEffect(()=>{const u=p=>{n(p)},d=p=>{s(p)};Tt.on("measurementViewEnabled",u),Tt.on("mouseControlEnabled",d);const f=setInterval(()=>{i.current&&l({xPos:i.current.position.x,yPos:i.current.position.y,zPos:i.current.position.z,xRot:i.current.rotation.x,yRot:i.current.rotation.y,zRot:i.current.rotation.z})},100);return()=>clearInterval(f)},[]),G.jsx(fo,{children:G.jsxs("div",{className:"simulation-container",children:[G.jsx("div",{className:"blockpad-container",children:G.jsx(mo,{})}),G.jsxs("div",{className:"transportation-canvas-container",children:[G.jsx(go,{dronePosition:a}),G.jsx(O2,{droneRef:i,measurementViewEnabled:e,mouseControlEnabled:r})]})]})})},tae=new Do;let L2,qS,qv=null,nae="white",iae="black",rae="yellow",sae="yellow";const oae=({measurementViewEnabled:i})=>{const{camera:e,gl:n,scene:r}=$n(),s=q.useRef();return q.useEffect(()=>{i?(e.position.set(0,100,-3),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI/2,s.current.minPolarAngle=Math.PI/2,s.current.enableRotate=!1)):(e.position.set(50,50,50),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI,s.current.minPolarAngle=0,s.current.enableRotate=!0)),L2=e,qS=r},[i,e]),G.jsx(G.Fragment,{children:!i&&G.jsx(No,{ref:s,args:[e,n.domElement]})})},aae=({position:i})=>G.jsxs("mesh",{position:i,children:[G.jsx("sphereGeometry",{args:[.5,16,16]}),G.jsx("meshStandardMaterial",{color:iae})]}),lae=(i,e,n,r)=>{if(n){const s=i.target.getBoundingClientRect(),a=(i.clientX-s.left)/s.width*2-1,l=-((i.clientY-s.top)/s.height)*2+1,u=new te(a,l,.5),d=new As;d.setFromCamera(u,L2);const h=d.intersectObject(qS,!0);if(h.length>0){const f=h[0].point;e(y=>[...y,f]),qv==null&&(qv=r.current.position.clone()),qv.distanceTo(f);const p=[qv,f],m=new rn().setFromPoints(p),T=new fi({color:nae}),E=new Ki(m,T);qS.add(E),qv.copy(f);const b=`X: ${f.x.toFixed(2)} cm, Y: ${f.y.toFixed(2)} cm, Z: ${f.z.toFixed(2)} cm`;cae(b,f)}}},cae=(i,e)=>{tae.load("assets/helvetiker_regular.typeface.json",n=>{const r=new Po(i,{font:n,size:.9,height:.09,curveSegments:1,bevelEnabled:!1,bevelThickness:0,bevelSize:.03,bevelSegments:2}),s=new ii({color:sae}),a=new Pn(r,s);a.position.set(e.x,e.y+.4,e.z),a.rotation.x=-Math.PI/2,qS.add(a)},void 0,n=>{console.error("An error occurred loading the font:",n)})},uae=()=>{const{scene:i}=Cs("assets/models/transportation/future_city_compressed.glb"),e=[-200,-5,90],n=[0,0,0];return i.rotation.set(n[0],n[1],n[2]),G.jsx("primitive",{object:i,position:e,scale:1})},hae=()=>{const{gl:i}=$n(),e=()=>{const n=i.domElement.toDataURL("image/png"),r=new Date().toISOString().replace(/[:.]/g,"-"),s=document.createElement("a");s.href=n,s.download=`transportation_${r}.png`,s.click()};return q.useEffect(()=>{const n=()=>{e()};return Tt.on("commandTakeScreenShot",n),()=>{Tt.off("commandTakeScreenShot",n)}},[]),null},N2=({droneRef:i,measurementViewEnabled:e,mouseControlEnabled:n})=>{const r=q.useRef(),[s,a]=q.useState([]);return G.jsxs(Lo,{shadows:!0,onClick:l=>lae(l,a,e,i),children:[G.jsx("color",{attach:"background",args:["#fffffff"]})," ",G.jsx("ambientLight",{intensity:.4,color:new Ct(16761248)})," ",G.jsx(ko,{preset:"sunset",intensity:.5})," ",G.jsx(uae,{}),s.map((l,u)=>G.jsx(aae,{position:l},u)),G.jsx(oae,{measurementViewEnabled:e}),G.jsx(hae,{}),G.jsx(po,{ref:i,controlsRef:r,measurementViewEnabled:e,mouseControlEnabled:n,droneScale:.3,cameraOffset:[0,5,-20],lineColor:rae})]})};N2.propTypes={droneRef:Xt.object.isRequired,mouseControlEnabled:Xt.bool,measurementViewEnabled:Xt.bool};const Jk=()=>{window.gtag("event","page_view",{page_path:window.location.pathname});const i=q.useRef(),[e,n]=q.useState(!1),[r,s]=q.useState(!1),[a,l]=q.useState({xPos:0,yPos:0,zPos:0,xRot:0,yRot:0,zRot:0});return q.useEffect(()=>{const u=p=>{n(p)},d=p=>{s(p)};Tt.on("measurementViewEnabled",u),Tt.on("mouseControlEnabled",d);const f=setInterval(()=>{i.current&&l({xPos:i.current.position.x,yPos:i.current.position.y,zPos:i.current.position.z,xRot:i.current.rotation.x,yRot:i.current.rotation.y,zRot:i.current.rotation.z})},100);return()=>clearInterval(f)},[]),G.jsx(fo,{children:G.jsxs("div",{className:"simulation-container",children:[G.jsx("div",{className:"blockpad-container",children:G.jsx(mo,{})}),G.jsxs("div",{className:"transportation-canvas-container",children:[G.jsx(go,{dronePosition:a}),G.jsx(N2,{droneRef:i,measurementViewEnabled:e,mouseControlEnabled:r})]})]})})},dae=new Do;let k2,QS,Qv=null,fae="white",pae="black",mae="yellow",gae="black";const _ae=({measurementViewEnabled:i})=>{const{camera:e,gl:n,scene:r}=$n(),s=q.useRef();return q.useEffect(()=>{i?(e.position.set(5,100,-3),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI/2,s.current.minPolarAngle=Math.PI/2,s.current.enableRotate=!1)):(e.position.set(50,50,50),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI,s.current.minPolarAngle=0,s.current.enableRotate=!0)),k2=e,QS=r},[i,e]),G.jsx(G.Fragment,{children:!i&&G.jsx(No,{ref:s,args:[e,n.domElement]})})},vae=({position:i})=>G.jsxs("mesh",{position:i,children:[G.jsx("sphereGeometry",{args:[.5,16,16]}),G.jsx("meshStandardMaterial",{color:pae})]}),Tae=(i,e,n,r)=>{if(n){const s=i.target.getBoundingClientRect(),a=(i.clientX-s.left)/s.width*2-1,l=-((i.clientY-s.top)/s.height)*2+1,u=new te(a,l,.5),d=new As;d.setFromCamera(u,k2);const h=d.intersectObject(QS,!0);if(h.length>0){const f=h[0].point;e(y=>[...y,f]),Qv==null&&(Qv=r.current.position.clone());const p=Qv.distanceTo(f),m=[Qv,f],T=new rn().setFromPoints(m),E=new fi({color:fae}),b=new Ki(T,E);QS.add(b),Qv.copy(f),Eae(`${p.toFixed(2)} cm`,f)}}},Eae=(i,e)=>{dae.load("assets/helvetiker_regular.typeface.json",n=>{const r=new Po(i,{font:n,size:.9,height:.09,curveSegments:1,bevelEnabled:!1,bevelThickness:0,bevelSize:.03,bevelSegments:2}),s=new ii({color:gae}),a=new Pn(r,s);a.position.set(e.x,e.y+.4,e.z),a.rotation.x=-Math.PI/2,QS.add(a)},void 0,n=>{console.error("An error occurred loading the font:",n)})},yae=()=>{const{scene:i}=Cs("assets/models/business/environment.glb"),e=[10,-10,0],n=[0,240,0];return i.rotation.set(n[0],n[1],n[2]),G.jsx("primitive",{object:i,position:e,scale:50})},Sae=()=>{const{gl:i}=$n(),e=()=>{const n=i.domElement.toDataURL("image/png"),r=new Date().toISOString().replace(/[:.]/g,"-"),s=document.createElement("a");s.href=n,s.download=`transportation_${r}.png`,s.click()};return q.useEffect(()=>{const n=()=>{e()};return Tt.on("commandTakeScreenShot",n),()=>{Tt.off("commandTakeScreenShot",n)}},[]),null},P2=({droneRef:i,measurementViewEnabled:e,mouseControlEnabled:n})=>{const r=q.useRef(),[s,a]=q.useState([]);return G.jsxs(Lo,{shadows:!0,onClick:l=>Tae(l,a,e,i),children:[G.jsx("color",{attach:"background",args:["#87CEEB"]})," ",G.jsx("ambientLight",{intensity:.4,color:new Ct(16761248)})," ",G.jsx(ko,{preset:"sunset",intensity:.5})," ",G.jsx(yae,{}),s.map((l,u)=>G.jsx(vae,{position:l},u)),G.jsx(_ae,{measurementViewEnabled:e}),G.jsx(Sae,{}),G.jsx(po,{ref:i,controlsRef:r,measurementViewEnabled:e,mouseControlEnabled:n,droneScale:.3,cameraOffset:[0,20,-18],lineColor:mae})]})};P2.propTypes={droneRef:Xt.object.isRequired,mouseControlEnabled:Xt.bool,measurementViewEnabled:Xt.bool};const $ae=()=>{window.gtag("event","page_view",{page_path:window.location.pathname});const i=q.useRef(),[e,n]=q.useState(!1),[r,s]=q.useState(!1),[a,l]=q.useState({xPos:0,yPos:0,zPos:0,xRot:0,yRot:0,zRot:0});return q.useEffect(()=>{const u=p=>{n(p)},d=p=>{s(p)};Tt.on("measurementViewEnabled",u),Tt.on("mouseControlEnabled",d);const f=setInterval(()=>{i.current&&l({xPos:i.current.position.x,yPos:i.current.position.y,zPos:i.current.position.z,xRot:i.current.rotation.x,yRot:i.current.rotation.y,zRot:i.current.rotation.z})},100);return()=>clearInterval(f)},[]),G.jsx(fo,{children:G.jsxs("div",{className:"simulation-container",children:[G.jsx("div",{className:"blockpad-container",children:G.jsx(mo,{})}),G.jsxs("div",{className:"transportation-canvas-container",children:[G.jsx(go,{dronePosition:a}),G.jsx(P2,{droneRef:i,measurementViewEnabled:e,mouseControlEnabled:r})]})]})})},bae=new Do;let cI,hp,eT=null,Aae="white",Cae="black",xae="yellow",Rae="black";const wae=({measurementViewEnabled:i})=>{const{camera:e,gl:n,scene:r}=$n(),s=q.useRef();return q.useEffect(()=>{i?(e.position.set(5,18,-5),e.lookAt(new te(-2,-3,11)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI/2,s.current.minPolarAngle=Math.PI/2,s.current.enableRotate=!1)):(e.position.set(50,50,50),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI,s.current.minPolarAngle=0,s.current.enableRotate=!0)),cI=e,hp=r},[i,e]),G.jsx(G.Fragment,{children:!i&&G.jsx(No,{ref:s,args:[e,n.domElement]})})},Mae=({position:i})=>G.jsxs("mesh",{position:i,children:[G.jsx("sphereGeometry",{args:[.5,16,16]}),G.jsx("meshStandardMaterial",{color:Cae})]}),Iae=(i,e,n,r)=>{if(n){const s=i.target.getBoundingClientRect(),a=(i.clientX-s.left)/s.width*2-1,l=-((i.clientY-s.top)/s.height)*2+1,u=new te(a,l,.5),d=new As;d.setFromCamera(u,cI);const h=d.intersectObject(hp,!0);if(h.length>0){const f=h[0].point;e(y=>[...y,f]),eT==null&&(eT=r.current.position.clone()),eT.distanceTo(f);const p=[eT,f],m=new rn().setFromPoints(p),T=new fi({color:Aae}),E=new Ki(m,T);hp.add(E),eT.copy(f);const b=`X: ${f.x.toFixed(2)} cm, Y: ${f.y.toFixed(2)} cm, Z: ${f.z.toFixed(2)} cm`;Oae(b,f)}}},Oae=(i,e)=>{bae.load("assets/helvetiker_regular.typeface.json",n=>{const r=new Po(i,{font:n,size:.9,height:.09,curveSegments:1,bevelEnabled:!1,bevelThickness:0,bevelSize:.03,bevelSegments:2}),s=new ii({color:Rae}),a=new Pn(r,s);a.position.set(e.x,e.y+.4,e.z),a.lookAt(cI.position),hp.add(a)},void 0,n=>{console.error("An error occurred loading the font:",n)})},Lae=()=>{const{scene:i}=Cs("assets/models/education/classroom2.glb"),e=[35,-11,13],n=[0,240,0];return i.rotation.set(n[0],n[1],n[2]),G.jsx("primitive",{object:i,position:e,scale:9})},Nae=()=>{const{gl:i}=$n(),e=()=>{const n=i.domElement.toDataURL("image/png"),r=new Date().toISOString().replace(/[:.]/g,"-"),s=document.createElement("a");s.href=n,s.download=`transportation_${r}.png`,s.click()};return q.useEffect(()=>{const n=()=>{e()};return Tt.on("commandTakeScreenShot",n),()=>{Tt.off("commandTakeScreenShot",n)}},[]),null},D2=({droneRef:i,measurementViewEnabled:e,mouseControlEnabled:n})=>{const r=q.useRef(),[s,a]=q.useState([]),l=q.useRef(),u=q.useRef(),d=q.useRef(),h=q.useRef();return q.useEffect(()=>{const f=m=>{const T=i.current,E=hp.getObjectByName(m);if(!T||!E)return;const b=new te,y=new te;T.getWorldPosition(b),E.getWorldPosition(y),b.distanceTo(y)<15?(T.attach(E),E.position.set(0,2,0),console.log(`Picked up ${m}`)):console.log(`${m} too far to pick up.`)},p=m=>{const T=i.current,E=hp.getObjectByName(m);if(!T||!E)return;hp.attach(E);const b=new te;T.getWorldPosition(b),E.position.copy(b),console.log(`Dropped ${m}`)};return Tt.on("commandPickupObject",f),Tt.on("commandDropObject",p),()=>{Tt.off("commandPickupObject",f),Tt.off("commandDropObject",p)}},[]),G.jsxs(Lo,{shadows:!0,onClick:f=>Iae(f,a,e,i),children:[G.jsx("color",{attach:"background",args:["#87CEEB"]})," ",G.jsx("ambientLight",{intensity:.4,color:new Ct(16761248)})," ",G.jsx(ko,{preset:"sunset",intensity:.5})," ",G.jsx(Lae,{}),s.map((f,p)=>G.jsx(Mae,{position:f},p)),G.jsx(wae,{measurementViewEnabled:e}),G.jsx(Nae,{}),G.jsx(po,{ref:i,controlsRef:r,measurementViewEnabled:e,mouseControlEnabled:n,droneScale:.8,cameraOffset:[5,9,-12],lineColor:xae}),G.jsx(Nn,{ref:l,path:"/drone-simulation-cte-alpha/assets/models/education/book.glb",position:[7,-3,18],scale:1,name:"book1",enableMeasurement:e}),G.jsx(Nn,{ref:u,path:"/drone-simulation-cte-alpha/assets/models/education/book.glb",position:[12,-1.5,47],scale:1,name:"book2",enableMeasurement:e}),G.jsx(Nn,{ref:d,path:"/drone-simulation-cte-alpha/assets/models/education/books.glb",position:[3,-1.5,1],scale:.6,name:"book3",enableMeasurement:e}),G.jsx(Nn,{ref:h,path:"/drone-simulation-cte-alpha/assets/models/education/books.glb",position:[3,-1.5,-.5],scale:.6,name:"book4",enableMeasurement:e}),G.jsx(Nn,{path:"/drone-simulation-cte-alpha/assets/models/education/pen.glb",position:[-14,-8,20],scale:.3,name:"pen1",enableMeasurement:e}),G.jsx(Nn,{path:"/drone-simulation-cte-alpha/assets/models/infotech/trashcan.glb",position:[-9,-10,-2],scale:4,name:"trashcan",enableMeasurement:e}),G.jsx(Nn,{path:"/drone-simulation-cte-alpha/assets/models/infotech/paper.glb",position:[-7,-10,48],scale:1,name:"trash1",enableMeasurement:e}),G.jsx(Nn,{path:"/drone-simulation-cte-alpha/assets/models/infotech/paper.glb",position:[-27,-10,3],scale:1,name:"trash2",enableMeasurement:e})]})};D2.propTypes={droneRef:Xt.object.isRequired,mouseControlEnabled:Xt.bool,measurementViewEnabled:Xt.bool};const kae=()=>{window.gtag("event","page_view",{page_path:window.location.pathname});const i=q.useRef(),[e,n]=q.useState(!1),[r,s]=q.useState(!1),[a,l]=q.useState({xPos:0,yPos:0,zPos:0,xRot:0,yRot:0,zRot:0});return q.useEffect(()=>{const u=p=>{n(p)},d=p=>{s(p)};Tt.on("measurementViewEnabled",u),Tt.on("mouseControlEnabled",d);const f=setInterval(()=>{i.current&&l({xPos:i.current.position.x,yPos:i.current.position.y,zPos:i.current.position.z,xRot:i.current.rotation.x,yRot:i.current.rotation.y,zRot:i.current.rotation.z})},100);return()=>clearInterval(f)},[]),G.jsx(fo,{children:G.jsxs("div",{className:"simulation-container",children:[G.jsx("div",{className:"blockpad-container",children:G.jsx(mo,{})}),G.jsxs("div",{className:"transportation-canvas-container",children:[G.jsx(go,{dronePosition:a}),G.jsx(D2,{droneRef:i,measurementViewEnabled:e,mouseControlEnabled:r})]})]})})},Pae=new Do;let B2,e$,tT=null,Dae="white",Bae="black",Fae="yellow",Uae="black",F2="Sale";const Gae=({measurementViewEnabled:i})=>{const{camera:e,gl:n,scene:r}=$n(),s=q.useRef();return q.useEffect(()=>{i?(e.position.set(-350,100,300),e.lookAt(new te(400,50,-200)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI/2,s.current.minPolarAngle=Math.PI/2,s.current.enableRotate=!1)):(e.position.set(50,50,50),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI,s.current.minPolarAngle=0,s.current.enableRotate=!0)),B2=e,e$=r},[i,e]),G.jsx(G.Fragment,{children:!i&&G.jsx(No,{ref:s,args:[e,n.domElement]})})},Hae=({position:i})=>G.jsxs("mesh",{position:i,children:[G.jsx("sphereGeometry",{args:[.5,16,16]}),G.jsx("meshStandardMaterial",{color:Bae})]}),Vae=(i,e,n,r)=>{if(n){const s=i.target.getBoundingClientRect(),a=(i.clientX-s.left)/s.width*2-1,l=-((i.clientY-s.top)/s.height)*2+1,u=new te(a,l,.5),d=new As;d.setFromCamera(u,B2);const h=d.intersectObject(e$,!0);if(h.length>0){const f=h[0].point;e(y=>[...y,f]),tT==null&&(tT=r.current.position.clone());const p=tT.distanceTo(f),m=[tT,f],T=new rn().setFromPoints(m),E=new fi({color:Dae}),b=new Ki(T,E);e$.add(b),tT.copy(f),zae(`${p.toFixed(2)} cm`,f)}}},zae=(i,e)=>{Pae.load("assets/helvetiker_regular.typeface.json",n=>{const r=new Po(i,{font:n,size:.9,height:.09,curveSegments:1,bevelEnabled:!1,bevelThickness:0,bevelSize:.03,bevelSegments:2}),s=new ii({color:Uae}),a=new Pn(r,s);a.position.set(e.x,e.y+.4,e.z),a.rotation.x=-Math.PI/2,e$.add(a)},void 0,n=>{console.error("An error occurred loading the font:",n)})},Wae=()=>{const{scene:i}=Cs("assets/models/communication/farm_scene.glb"),e=[200,-20,-130],n=[0,400,0];return i.rotation.set(n[0],n[1],n[2]),G.jsx("primitive",{object:i,position:e,scale:50})},Xae=()=>{const{gl:i}=$n(),e=()=>{const n=i.domElement.toDataURL("image/png"),r=new Date().toISOString().replace(/[:.]/g,"-"),s=document.createElement("a");s.href=n,s.download=`transportation_${r}.png`,s.click()};return q.useEffect(()=>{const n=()=>{e()},r=s=>{F2=s};return Tt.on("commandAdvertiseText",r),Tt.on("commandTakeScreenShot",n),()=>{Tt.off("commandTakeScreenShot",n),Tt.off("commandAdvertiseText",r)}},[]),null},U2=({droneRef:i,measurementViewEnabled:e,mouseControlEnabled:n})=>{const r=q.useRef(),[s,a]=q.useState([]);return G.jsxs(Lo,{shadows:!0,onClick:l=>Vae(l,a,e,i),children:[G.jsx("color",{attach:"background",args:["#87CEEB"]})," ",G.jsx("ambientLight",{intensity:.4,color:new Ct(16761248)})," ",G.jsx(ko,{preset:"sunset",intensity:.5})," ",G.jsx(Wae,{}),s.map((l,u)=>G.jsx(Hae,{position:l},u)),G.jsx(Gae,{measurementViewEnabled:e}),G.jsx(Xae,{}),G.jsx(po,{flyerText:F2,ref:i,controlsRef:r,measurementViewEnabled:e,mouseControlEnabled:n,droneScale:5,cameraOffset:[0,50,-80],lineColor:Fae})]})};U2.propTypes={droneRef:Xt.object.isRequired,mouseControlEnabled:Xt.bool,measurementViewEnabled:Xt.bool};const jae=()=>{window.gtag("event","page_view",{page_path:window.location.pathname});const i=q.useRef(),[e,n]=q.useState(!1),[r,s]=q.useState(!1),[a,l]=q.useState({xPos:0,yPos:0,zPos:0,xRot:0,yRot:0,zRot:0});return q.useEffect(()=>{const u=p=>{n(p)},d=p=>{s(p)};Tt.on("measurementViewEnabled",u),Tt.on("mouseControlEnabled",d);const f=setInterval(()=>{i.current&&l({xPos:i.current.position.x,yPos:i.current.position.y,zPos:i.current.position.z,xRot:i.current.rotation.x,yRot:i.current.rotation.y,zRot:i.current.rotation.z})},100);return()=>clearInterval(f)},[]),G.jsx(fo,{children:G.jsxs("div",{className:"simulation-container",children:[G.jsx("div",{className:"blockpad-container",children:G.jsx(mo,{})}),G.jsxs("div",{className:"transportation-canvas-container",children:[G.jsx(go,{dronePosition:a}),G.jsx(U2,{droneRef:i,measurementViewEnabled:e,mouseControlEnabled:r})]})]})})},Yae=new Do;let G2,t$,nT=null,Kae="white",Jae="black",Zae="yellow",qae="black";const Qae=({measurementViewEnabled:i})=>{const{camera:e,gl:n,scene:r}=$n(),s=q.useRef();return q.useEffect(()=>{i?(e.position.set(5,100,-3),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI/2,s.current.minPolarAngle=Math.PI/2,s.current.enableRotate=!1)):(e.position.set(50,50,50),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI,s.current.minPolarAngle=0,s.current.enableRotate=!0)),G2=e,t$=r},[i,e]),G.jsx(G.Fragment,{children:!i&&G.jsx(No,{ref:s,args:[e,n.domElement]})})},ele=({position:i})=>G.jsxs("mesh",{position:i,children:[G.jsx("sphereGeometry",{args:[.5,16,16]}),G.jsx("meshStandardMaterial",{color:Jae})]}),tle=(i,e,n,r)=>{if(n){const s=i.target.getBoundingClientRect(),a=(i.clientX-s.left)/s.width*2-1,l=-((i.clientY-s.top)/s.height)*2+1,u=new te(a,l,.5),d=new As;d.setFromCamera(u,G2);const h=d.intersectObject(t$,!0);if(h.length>0){const f=h[0].point;e(y=>[...y,f]),nT==null&&(nT=r.current.position.clone());const p=nT.distanceTo(f),m=[nT,f],T=new rn().setFromPoints(m),E=new fi({color:Kae}),b=new Ki(T,E);t$.add(b),nT.copy(f),nle(`${p.toFixed(2)} cm`,f)}}},nle=(i,e)=>{Yae.load("assets/helvetiker_regular.typeface.json",n=>{const r=new Po(i,{font:n,size:.9,height:.09,curveSegments:1,bevelEnabled:!1,bevelThickness:0,bevelSize:.03,bevelSegments:2}),s=new ii({color:qae}),a=new Pn(r,s);a.position.set(e.x,e.y+.4,e.z),a.rotation.x=-Math.PI/2,t$.add(a)},void 0,n=>{console.error("An error occurred loading the font:",n)})},ile=()=>{const{gl:i}=$n(),e=()=>{const n=i.domElement.toDataURL("image/png"),r=new Date().toISOString().replace(/[:.]/g,"-"),s=document.createElement("a");s.href=n,s.download=`transportation_${r}.png`,s.click()};return q.useEffect(()=>{const n=()=>{e()};return Tt.on("commandTakeScreenShot",n),()=>{Tt.off("commandTakeScreenShot",n)}},[]),null},rle=({start:i,end:e,label:n})=>G.jsxs("group",{children:[G.jsx(n2,{points:[i,e],color:"black",lineWidth:1,dashed:!1}),G.jsxs("mesh",{position:e,children:[G.jsx("sphereGeometry",{args:[.3,16,16]}),G.jsx("meshStandardMaterial",{color:"red"})]}),G.jsx(gY,{position:[e[0]+.5,e[1]+.5,e[2]+0],style:{background:"white",padding:"5px 20px",borderRadius:"12px",fontSize:"40px",color:"black",fontWeight:"bold",boxShadow:"0px 0px 8px rgba(0,0,0,0.5)",whiteSpace:"nowrap",textAlign:"center",marginBottom:"20px"},center:!0,distanceFactor:10,children:n})]}),sle=[{start:[5,2.7,3],end:[5,6,3],label:"Propeller"},{start:[3.5,2.2,2.5],end:[10,0,0],label:"Brushless Motors"},{start:[3.5,1,2.5],end:[10,-5,0],label:"Landing Gear"},{start:[0,3,2],end:[0,0,5],label:"Front Camera"},{start:[0,1,1],end:[-5,0,5],label:"Stabilizer"},{start:[0,3,0],end:[0,8,0],label:"Battery Power and Cover"},{start:[0,1.2,0],end:[-6,0,0],label:"Micro SD"},{start:[0,.5,-1],end:[0,0,-6],label:"Battery Indicator"},{start:[0,2,0],end:[-6,3,0],label:"Infrared Sensor"}],H2=({droneRef:i,measurementViewEnabled:e,mouseControlEnabled:n})=>{var h,f,p;const r=q.useRef(),[s,a]=q.useState([]),l=((h=i.current)==null?void 0:h.position.x)||0,u=((f=i.current)==null?void 0:f.position.y)||0,d=((p=i.current)==null?void 0:p.position.z)||0;return G.jsxs(Lo,{shadows:!0,onClick:m=>tle(m,a,e,i),children:[G.jsx("color",{attach:"background",args:["#ffffff"]}),G.jsx("ambientLight",{intensity:.4,color:new Ct(16761248)}),G.jsx(ko,{preset:"sunset",intensity:.5}),s.map((m,T)=>G.jsx(ele,{position:m},T)),G.jsx(Qae,{measurementViewEnabled:e}),G.jsx(ile,{}),G.jsx(po,{ref:i,controlsRef:r,measurementViewEnabled:e,mouseControlEnabled:n,droneScale:2,cameraOffset:[0,20,-18],lineColor:Zae}),sle.map((m,T)=>G.jsx(rle,{start:[l+m.start[0],u+m.start[1],d+m.start[2]],end:[l+m.end[0],u+m.end[1],d+m.end[2]],label:m.label},T))]})};H2.propTypes={droneRef:Xt.object.isRequired,mouseControlEnabled:Xt.bool,measurementViewEnabled:Xt.bool};const ole=()=>{window.gtag("event","page_view",{page_path:window.location.pathname});const i=q.useRef(),[e,n]=q.useState(!1),[r,s]=q.useState(!1),[a,l]=q.useState({xPos:0,yPos:0,zPos:0,xRot:0,yRot:0,zRot:0});return q.useEffect(()=>{const u=p=>{n(p)},d=p=>{s(p)};Tt.on("measurementViewEnabled",u),Tt.on("mouseControlEnabled",d);const f=setInterval(()=>{i.current&&l({xPos:i.current.position.x,yPos:i.current.position.y,zPos:i.current.position.z,xRot:i.current.rotation.x,yRot:i.current.rotation.y,zRot:i.current.rotation.z})},100);return()=>clearInterval(f)},[]),G.jsx(fo,{children:G.jsxs("div",{className:"simulation-container",children:[G.jsx("div",{className:"blockpad-container",children:G.jsx(mo,{})}),G.jsxs("div",{className:"transportation-canvas-container",children:[G.jsx(go,{dronePosition:a,disableMeasurementView:!0}),G.jsx(H2,{droneRef:i,measurementViewEnabled:e,mouseControlEnabled:r})]})]})})},ale=new Do;let V2,n$,iT=null,lle="white",cle="black",ule="yellow",hle="black";const dle=({measurementViewEnabled:i})=>{const{camera:e,gl:n,scene:r}=$n(),s=q.useRef();return q.useEffect(()=>{i?(e.position.set(5,100,-3),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI/2,s.current.minPolarAngle=Math.PI/2,s.current.enableRotate=!1)):(e.position.set(50,50,50),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI,s.current.minPolarAngle=0,s.current.enableRotate=!0)),V2=e,n$=r},[i,e]),G.jsx(G.Fragment,{children:!i&&G.jsx(No,{ref:s,args:[e,n.domElement]})})},fle=({position:i})=>G.jsxs("mesh",{position:i,children:[G.jsx("sphereGeometry",{args:[.5,16,16]}),G.jsx("meshStandardMaterial",{color:cle})]}),ple=(i,e,n,r)=>{if(n){const s=i.target.getBoundingClientRect(),a=(i.clientX-s.left)/s.width*2-1,l=-((i.clientY-s.top)/s.height)*2+1,u=new te(a,l,.5),d=new As;d.setFromCamera(u,V2);const h=d.intersectObject(n$,!0);if(h.length>0){const f=h[0].point;e(y=>[...y,f]),iT==null&&(iT=r.current.position.clone());const p=iT.distanceTo(f),m=[iT,f],T=new rn().setFromPoints(m),E=new fi({color:lle}),b=new Ki(T,E);n$.add(b),iT.copy(f),mle(`${p.toFixed(2)} cm`,f)}}},mle=(i,e)=>{ale.load("assets/helvetiker_regular.typeface.json",n=>{const r=new Po(i,{font:n,size:.9,height:.09,curveSegments:1,bevelEnabled:!1,bevelThickness:0,bevelSize:.03,bevelSegments:2}),s=new ii({color:hle}),a=new Pn(r,s);a.position.set(e.x,e.y+.4,e.z),a.rotation.x=-Math.PI/2,n$.add(a)},void 0,n=>{console.error("An error occurred loading the font:",n)})},gle=()=>{const{scene:i}=Cs("assets/models/business/environment.glb"),e=[10,-10,0],n=[0,240,0];return i.rotation.set(n[0],n[1],n[2]),G.jsx("primitive",{object:i,position:e,scale:50})},_le=()=>{const{gl:i}=$n(),e=()=>{const n=i.domElement.toDataURL("image/png"),r=new Date().toISOString().replace(/[:.]/g,"-"),s=document.createElement("a");s.href=n,s.download=`transportation_${r}.png`,s.click()};return q.useEffect(()=>{const n=()=>{e()};return Tt.on("commandTakeScreenShot",n),()=>{Tt.off("commandTakeScreenShot",n)}},[]),null},z2=({droneRef:i,measurementViewEnabled:e,mouseControlEnabled:n})=>{const r=q.useRef(),[s,a]=q.useState([]);return G.jsxs(Lo,{shadows:!0,onClick:l=>ple(l,a,e,i),children:[G.jsx("color",{attach:"background",args:["#87CEEB"]})," ",G.jsx("ambientLight",{intensity:.4,color:new Ct(16761248)})," ",G.jsx(ko,{preset:"sunset",intensity:.5})," ",G.jsx(gle,{}),s.map((l,u)=>G.jsx(fle,{position:l},u)),G.jsx(dle,{measurementViewEnabled:e}),G.jsx(_le,{}),G.jsx(po,{ref:i,controlsRef:r,measurementViewEnabled:e,mouseControlEnabled:n,droneScale:.3,cameraOffset:[0,20,-18],lineColor:ule})]})};z2.propTypes={droneRef:Xt.object.isRequired,mouseControlEnabled:Xt.bool,measurementViewEnabled:Xt.bool};const vle=()=>{window.gtag("event","page_view",{page_path:window.location.pathname});const i=q.useRef(),[e,n]=q.useState(!1),[r,s]=q.useState(!1),[a,l]=q.useState({xPos:0,yPos:0,zPos:0,xRot:0,yRot:0,zRot:0});return q.useEffect(()=>{const u=p=>{n(p)},d=p=>{s(p)};Tt.on("measurementViewEnabled",u),Tt.on("mouseControlEnabled",d);const f=setInterval(()=>{i.current&&l({xPos:i.current.position.x,yPos:i.current.position.y,zPos:i.current.position.z,xRot:i.current.rotation.x,yRot:i.current.rotation.y,zRot:i.current.rotation.z})},100);return()=>clearInterval(f)},[]),G.jsx(fo,{children:G.jsxs("div",{className:"simulation-container",children:[G.jsx("div",{className:"blockpad-container",children:G.jsx(mo,{})}),G.jsxs("div",{className:"transportation-canvas-container",children:[G.jsx(go,{dronePosition:a}),G.jsx(z2,{droneRef:i,measurementViewEnabled:e,mouseControlEnabled:r})]})]})})},Tle=new Do;let W2,i$,rT=null,Ele="white",yle="black",Sle="yellow",$le="black";const ble=({measurementViewEnabled:i})=>{const{camera:e,gl:n,scene:r}=$n(),s=q.useRef();return q.useEffect(()=>{i?(e.position.set(5,100,-3),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI/2,s.current.minPolarAngle=Math.PI/2,s.current.enableRotate=!1)):(e.position.set(50,50,50),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI,s.current.minPolarAngle=0,s.current.enableRotate=!0)),W2=e,i$=r},[i,e]),G.jsx(G.Fragment,{children:!i&&G.jsx(No,{ref:s,args:[e,n.domElement]})})},Ale=({position:i})=>G.jsxs("mesh",{position:i,children:[G.jsx("sphereGeometry",{args:[.5,16,16]}),G.jsx("meshStandardMaterial",{color:yle})]}),Cle=(i,e,n,r)=>{if(n){const s=i.target.getBoundingClientRect(),a=(i.clientX-s.left)/s.width*2-1,l=-((i.clientY-s.top)/s.height)*2+1,u=new te(a,l,.5),d=new As;d.setFromCamera(u,W2);const h=d.intersectObject(i$,!0);if(h.length>0){const f=h[0].point;e(y=>[...y,f]),rT==null&&(rT=r.current.position.clone());const p=rT.distanceTo(f),m=[rT,f],T=new rn().setFromPoints(m),E=new fi({color:Ele}),b=new Ki(T,E);i$.add(b),rT.copy(f),xle(`${p.toFixed(2)} cm`,f)}}},xle=(i,e)=>{Tle.load("assets/helvetiker_regular.typeface.json",n=>{const r=new Po(i,{font:n,size:.9,height:.09,curveSegments:1,bevelEnabled:!1,bevelThickness:0,bevelSize:.03,bevelSegments:2}),s=new ii({color:$le}),a=new Pn(r,s);a.position.set(e.x,e.y+.4,e.z),a.rotation.x=-Math.PI/2,i$.add(a)},void 0,n=>{console.error("An error occurred loading the font:",n)})},Rle=()=>{const{scene:i}=Cs("assets/models/business/environment.glb"),e=[10,-10,0],n=[0,240,0];return i.rotation.set(n[0],n[1],n[2]),G.jsx("primitive",{object:i,position:e,scale:50})},wle=()=>{const{gl:i}=$n(),e=()=>{const n=i.domElement.toDataURL("image/png"),r=new Date().toISOString().replace(/[:.]/g,"-"),s=document.createElement("a");s.href=n,s.download=`transportation_${r}.png`,s.click()};return q.useEffect(()=>{const n=()=>{e()};return Tt.on("commandTakeScreenShot",n),()=>{Tt.off("commandTakeScreenShot",n)}},[]),null},X2=({droneRef:i,measurementViewEnabled:e,mouseControlEnabled:n})=>{const r=q.useRef(),[s,a]=q.useState([]);return G.jsxs(Lo,{shadows:!0,onClick:l=>Cle(l,a,e,i),children:[G.jsx("color",{attach:"background",args:["#87CEEB"]})," ",G.jsx("ambientLight",{intensity:.4,color:new Ct(16761248)})," ",G.jsx(ko,{preset:"sunset",intensity:.5})," ",G.jsx(Rle,{}),s.map((l,u)=>G.jsx(Ale,{position:l},u)),G.jsx(ble,{measurementViewEnabled:e}),G.jsx(wle,{}),G.jsx(po,{ref:i,controlsRef:r,measurementViewEnabled:e,mouseControlEnabled:n,droneScale:.3,cameraOffset:[0,20,-18],lineColor:Sle})]})};X2.propTypes={droneRef:Xt.object.isRequired,mouseControlEnabled:Xt.bool,measurementViewEnabled:Xt.bool};const Mle=()=>{window.gtag("event","page_view",{page_path:window.location.pathname});const i=q.useRef(),[e,n]=q.useState(!1),[r,s]=q.useState(!1),[a,l]=q.useState({xPos:0,yPos:0,zPos:0,xRot:0,yRot:0,zRot:0});return q.useEffect(()=>{const u=p=>{n(p)},d=p=>{s(p)};Tt.on("measurementViewEnabled",u),Tt.on("mouseControlEnabled",d);const f=setInterval(()=>{i.current&&l({xPos:i.current.position.x,yPos:i.current.position.y,zPos:i.current.position.z,xRot:i.current.rotation.x,yRot:i.current.rotation.y,zRot:i.current.rotation.z})},100);return()=>clearInterval(f)},[]),G.jsx(fo,{children:G.jsxs("div",{className:"simulation-container",children:[G.jsx("div",{className:"blockpad-container",children:G.jsx(mo,{})}),G.jsxs("div",{className:"transportation-canvas-container",children:[G.jsx(go,{dronePosition:a}),G.jsx(X2,{droneRef:i,measurementViewEnabled:e,mouseControlEnabled:r})]})]})})},Ile=new Do;let uI,dp,sT=null,Ole="white",Lle="black",Nle="yellow",kle="black";const Ple=({measurementViewEnabled:i})=>{const{camera:e,gl:n,scene:r}=$n(),s=q.useRef();return q.useEffect(()=>{i?(e.position.set(20,70,-40),e.lookAt(new te(20,20,10)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI/2,s.current.minPolarAngle=Math.PI/2,s.current.enableRotate=!1)):(e.position.set(50,50,50),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI,s.current.minPolarAngle=0,s.current.enableRotate=!0)),uI=e,dp=r},[i,e]),G.jsx(G.Fragment,{children:!i&&G.jsx(No,{ref:s,args:[e,n.domElement]})})},Dle=({position:i})=>G.jsxs("mesh",{position:i,children:[G.jsx("sphereGeometry",{args:[.5,16,16]}),G.jsx("meshStandardMaterial",{color:Lle})]}),Ble=(i,e,n,r)=>{if(n){const s=i.target.getBoundingClientRect(),a=(i.clientX-s.left)/s.width*2-1,l=-((i.clientY-s.top)/s.height)*2+1,u=new te(a,l,.5),d=new As;d.setFromCamera(u,uI);const h=d.intersectObject(dp,!0);if(h.length>0){const f=h[0].point;e(y=>[...y,f]),sT==null&&(sT=r.current.position.clone()),sT.distanceTo(f);const p=[sT,f],m=new rn().setFromPoints(p),T=new fi({color:Ole}),E=new Ki(m,T);dp.add(E),sT.copy(f);const b=`X: ${f.x.toFixed(2)} cm, Y: ${f.y.toFixed(2)} cm, Z: ${f.z.toFixed(2)} cm`;Fle(b,f)}}},Fle=(i,e)=>{Ile.load("assets/helvetiker_regular.typeface.json",n=>{const r=new Po(i,{font:n,size:.9,height:.09,curveSegments:1,bevelEnabled:!1,bevelThickness:0,bevelSize:.03,bevelSegments:2}),s=new ii({color:kle}),a=new Pn(r,s);a.position.set(e.x,e.y+.4,e.z),a.lookAt(uI.position),dp.add(a)},void 0,n=>{console.error("An error occurred loading the font:",n)})},Ule=()=>{const{scene:i}=Cs("assets/models/infotech/office1.glb"),e=[-105,-18,45],n=[0,90,0];return i.rotation.set(n[0],n[1],n[2]),G.jsx("primitive",{object:i,position:e,scale:20})},Gle=()=>{const{gl:i}=$n(),e=()=>{const n=i.domElement.toDataURL("image/png"),r=new Date().toISOString().replace(/[:.]/g,"-"),s=document.createElement("a");s.href=n,s.download=`transportation_${r}.png`,s.click()};return q.useEffect(()=>{const n=()=>{e()};return Tt.on("commandTakeScreenShot",n),()=>{Tt.off("commandTakeScreenShot",n)}},[]),null},j2=({droneRef:i,measurementViewEnabled:e,mouseControlEnabled:n})=>{const r=q.useRef(),[s,a]=q.useState([]),l=q.useRef(),u=q.useRef(),d=q.useRef(),h=q.useRef(),f=q.useRef(),p=q.useRef(),m=q.useRef(),T=q.useRef(),E=q.useRef();return q.useEffect(()=>{const b=S=>{const A=i.current,C=dp.getObjectByName(S);if(!A||!C)return;const R=new te,I=new te;A.getWorldPosition(R),C.getWorldPosition(I),R.distanceTo(I)<15?(A.attach(C),C.position.set(0,2,0),console.log(`Picked up ${S}`)):console.log(`${S} too far to pick up.`)},y=S=>{const A=i.current,C=dp.getObjectByName(S);if(!A||!C)return;dp.attach(C);const R=new te;A.getWorldPosition(R),C.position.copy(R),console.log(`Dropped ${S}`)};return Tt.on("commandPickupObject",b),Tt.on("commandDropObject",y),()=>{Tt.off("commandPickupObject",b),Tt.off("commandDropObject",y)}},[]),G.jsxs(Lo,{shadows:!0,onClick:b=>Ble(b,a,e,i),children:[G.jsx("color",{attach:"background",args:["#87CEEB"]})," ",G.jsx("ambientLight",{intensity:.4,color:new Ct(16761248)})," ",G.jsx(ko,{preset:"sunset",intensity:.5})," ",G.jsx(Ule,{}),s.map((b,y)=>G.jsx(Dle,{position:b},y)),G.jsx(Ple,{measurementViewEnabled:e}),G.jsx(Gle,{}),G.jsx(po,{ref:i,controlsRef:r,measurementViewEnabled:e,mouseControlEnabled:n,droneScale:.5,cameraOffset:[-5.5,5,-9],lineColor:Nle,droneSpeed:.1}),G.jsx(Nn,{ref:u,path:"/drone-simulation-cte-alpha/assets/models/infotech/desktop.glb",position:[32,-6,6],rotation:[0,Math.PI+45,0],scale:2,name:"desktop1",enableMeasurement:e}),G.jsx(Nn,{ref:l,path:"/drone-simulation-cte-alpha/assets/models/infotech/shelf.glb",position:[35,-17,4],rotation:[0,Math.PI/4,0],scale:15,enableMeasurement:e}),G.jsx(Nn,{ref:d,path:"/drone-simulation-cte-alpha/assets/models/infotech/desktop.glb",position:[32,1,6],rotation:[0,Math.PI+45,0],scale:2,name:"desktop2",enableMeasurement:e}),G.jsx(Nn,{ref:f,path:"/drone-simulation-cte-alpha/assets/models/infotech/trashcan.glb",position:[30,-18,10],rotation:[0,Math.PI/2,0],scale:9,enableMeasurement:e}),G.jsx(Nn,{ref:h,path:"/drone-simulation-cte-alpha/assets/models/infotech/desk.glb",position:[-3,-5,80],rotation:[0,Math.PI/5,0],scale:5,enableMeasurement:e}),G.jsx(Nn,{ref:p,path:"/drone-simulation-cte-alpha/assets/models/infotech/banana.glb",position:[15,-1,10],rotation:[0,Math.PI/2,0],scale:9,name:"peel",enableMeasurement:e}),G.jsx(Nn,{ref:m,path:"/drone-simulation-cte-alpha/assets/models/infotech/paper.glb",position:[20,-18,5],scale:2,name:"paper",enableMeasurement:e}),G.jsx(Nn,{ref:T,path:"/drone-simulation-cte-alpha/assets/models/infotech/alphabet1.glb",position:[-2.5,.5,96.5],scale:7,enableMeasurement:e}),G.jsx(Nn,{ref:E,path:"/drone-simulation-cte-alpha/assets/models/infotech/alphabet2.glb",position:[27,0,138.3],rotation:[0,110,0],scale:7,enableMeasurement:e})]})};j2.propTypes={droneRef:Xt.object.isRequired,mouseControlEnabled:Xt.bool,measurementViewEnabled:Xt.bool};const Hle=()=>{window.gtag("event","page_view",{page_path:window.location.pathname});const i=q.useRef(),[e,n]=q.useState(!1),[r,s]=q.useState(!1),[a,l]=q.useState({xPos:0,yPos:0,zPos:0,xRot:0,yRot:0,zRot:0});return q.useEffect(()=>{const u=p=>{n(p)},d=p=>{s(p)};Tt.on("measurementViewEnabled",u),Tt.on("mouseControlEnabled",d);const f=setInterval(()=>{i.current&&l({xPos:i.current.position.x,yPos:i.current.position.y,zPos:i.current.position.z,xRot:i.current.rotation.x,yRot:i.current.rotation.y,zRot:i.current.rotation.z})},100);return()=>clearInterval(f)},[]),G.jsx(fo,{children:G.jsxs("div",{className:"simulation-container",children:[G.jsx("div",{className:"blockpad-container",children:G.jsx(mo,{})}),G.jsxs("div",{className:"transportation-canvas-container",children:[G.jsx(go,{dronePosition:a}),G.jsx(j2,{droneRef:i,measurementViewEnabled:e,mouseControlEnabled:r})]})]})})};function Zk(i,e){if(e===pM)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),i;if(e===$p||e===TE){let n=i.getIndex();if(n===null){const l=[],u=i.getAttribute("position");if(u!==void 0){for(let d=0;d<u.count;d++)l.push(d);i.setIndex(l),n=i.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const r=n.count-2,s=[];if(e===$p)for(let l=1;l<=r;l++)s.push(n.getX(0)),s.push(n.getX(l)),s.push(n.getX(l+1));else for(let l=0;l<r;l++)l%2===0?(s.push(n.getX(l)),s.push(n.getX(l+1)),s.push(n.getX(l+2))):(s.push(n.getX(l+2)),s.push(n.getX(l+1)),s.push(n.getX(l)));s.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=i.clone();return a.setIndex(s),a.clearGroups(),a}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),i}class Vle extends as{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new Yle(n)}),this.register(function(n){return new nce(n)}),this.register(function(n){return new ice(n)}),this.register(function(n){return new rce(n)}),this.register(function(n){return new Jle(n)}),this.register(function(n){return new Zle(n)}),this.register(function(n){return new qle(n)}),this.register(function(n){return new Qle(n)}),this.register(function(n){return new jle(n)}),this.register(function(n){return new ece(n)}),this.register(function(n){return new Kle(n)}),this.register(function(n){return new tce(n)}),this.register(function(n){return new Wle(n)}),this.register(function(n){return new sce(n)}),this.register(function(n){return new oce(n)})}load(e,n,r,s){const a=this;let l;this.resourcePath!==""?l=this.resourcePath:this.path!==""?l=this.path:l=Nl.extractUrlBase(e),this.manager.itemStart(e);const u=function(h){s?s(h):console.error(h),a.manager.itemError(e),a.manager.itemEnd(e)},d=new Lr(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,function(h){try{a.parse(h,l,function(f){n(f),a.manager.itemEnd(e)},u)}catch(f){u(f)}},r,u)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,r,s){let a;const l={},u={},d=new TextDecoder;if(typeof e=="string")a=JSON.parse(e);else if(e instanceof ArrayBuffer)if(d.decode(new Uint8Array(e,0,4))===Y2){try{l[qn.KHR_BINARY_GLTF]=new ace(e)}catch(p){s&&s(p);return}a=JSON.parse(l[qn.KHR_BINARY_GLTF].content)}else a=JSON.parse(d.decode(e));else a=e;if(a.asset===void 0||a.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const h=new Ece(a,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let f=0;f<this.pluginCallbacks.length;f++){const p=this.pluginCallbacks[f](h);u[p.name]=p,l[p.name]=!0}if(a.extensionsUsed)for(let f=0;f<a.extensionsUsed.length;++f){const p=a.extensionsUsed[f],m=a.extensionsRequired||[];switch(p){case qn.KHR_MATERIALS_UNLIT:l[p]=new Xle;break;case qn.KHR_DRACO_MESH_COMPRESSION:l[p]=new lce(a,this.dracoLoader);break;case qn.KHR_TEXTURE_TRANSFORM:l[p]=new cce;break;case qn.KHR_MESH_QUANTIZATION:l[p]=new uce;break;default:m.indexOf(p)>=0&&u[p]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+p+'".')}}h.setExtensions(l),h.setPlugins(u),h.parse(r,s)}parseAsync(e,n){const r=this;return new Promise(function(s,a){r.parse(e,n,s,a)})}}function zle(){let i={};return{get:function(e){return i[e]},add:function(e,n){i[e]=n},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const qn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Wle{constructor(e){this.parser=e,this.name=qn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let r=0,s=n.length;r<s;r++){const a=n[r];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,a.extensions[this.name].light)}}_loadLight(e){const n=this.parser,r="light:"+e;let s=n.cache.get(r);if(s)return s;const a=n.json,d=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let h;const f=new Ct(16777215);d.color!==void 0&&f.fromArray(d.color);const p=d.range!==void 0?d.range:0;switch(d.type){case"directional":h=new j$(f),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new X$(f),h.distance=p;break;case"spot":h=new W$(f),h.distance=p,d.spot=d.spot||{},d.spot.innerConeAngle=d.spot.innerConeAngle!==void 0?d.spot.innerConeAngle:0,d.spot.outerConeAngle=d.spot.outerConeAngle!==void 0?d.spot.outerConeAngle:Math.PI/4,h.angle=d.spot.outerConeAngle,h.penumbra=1-d.spot.innerConeAngle/d.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+d.type)}return h.position.set(0,0,0),h.decay=2,Uh(h,d),d.intensity!==void 0&&(h.intensity=d.intensity),h.name=n.createUniqueName(d.name||"light_"+e),s=Promise.resolve(h),n.cache.add(r,s),s}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,r=this.parser,a=r.json.nodes[e],u=(a.extensions&&a.extensions[this.name]||{}).light;return u===void 0?null:this._loadLight(u).then(function(d){return r._getNodeRef(n.cache,u,d)})}}class Xle{constructor(){this.name=qn.KHR_MATERIALS_UNLIT}getMaterialType(){return ii}extendParams(e,n,r){const s=[];e.color=new Ct(1,1,1),e.opacity=1;const a=n.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const l=a.baseColorFactor;e.color.fromArray(l),e.opacity=l[3]}a.baseColorTexture!==void 0&&s.push(r.assignTexture(e,"map",a.baseColorTexture,Tn))}return Promise.all(s)}}class jle{constructor(e){this.parser=e,this.name=qn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name].emissiveStrength;return a!==void 0&&(n.emissiveIntensity=a),Promise.resolve()}}class Yle{constructor(e){this.parser=e,this.name=qn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],l=s.extensions[this.name];if(l.clearcoatFactor!==void 0&&(n.clearcoat=l.clearcoatFactor),l.clearcoatTexture!==void 0&&a.push(r.assignTexture(n,"clearcoatMap",l.clearcoatTexture)),l.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=l.clearcoatRoughnessFactor),l.clearcoatRoughnessTexture!==void 0&&a.push(r.assignTexture(n,"clearcoatRoughnessMap",l.clearcoatRoughnessTexture)),l.clearcoatNormalTexture!==void 0&&(a.push(r.assignTexture(n,"clearcoatNormalMap",l.clearcoatNormalTexture)),l.clearcoatNormalTexture.scale!==void 0)){const u=l.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new mt(u,u)}return Promise.all(a)}}class Kle{constructor(e){this.parser=e,this.name=qn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],l=s.extensions[this.name];return l.iridescenceFactor!==void 0&&(n.iridescence=l.iridescenceFactor),l.iridescenceTexture!==void 0&&a.push(r.assignTexture(n,"iridescenceMap",l.iridescenceTexture)),l.iridescenceIor!==void 0&&(n.iridescenceIOR=l.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),l.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=l.iridescenceThicknessMinimum),l.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=l.iridescenceThicknessMaximum),l.iridescenceThicknessTexture!==void 0&&a.push(r.assignTexture(n,"iridescenceThicknessMap",l.iridescenceThicknessTexture)),Promise.all(a)}}class Jle{constructor(e){this.parser=e,this.name=qn.KHR_MATERIALS_SHEEN}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[];n.sheenColor=new Ct(0,0,0),n.sheenRoughness=0,n.sheen=1;const l=s.extensions[this.name];return l.sheenColorFactor!==void 0&&n.sheenColor.fromArray(l.sheenColorFactor),l.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=l.sheenRoughnessFactor),l.sheenColorTexture!==void 0&&a.push(r.assignTexture(n,"sheenColorMap",l.sheenColorTexture,Tn)),l.sheenRoughnessTexture!==void 0&&a.push(r.assignTexture(n,"sheenRoughnessMap",l.sheenRoughnessTexture)),Promise.all(a)}}class Zle{constructor(e){this.parser=e,this.name=qn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],l=s.extensions[this.name];return l.transmissionFactor!==void 0&&(n.transmission=l.transmissionFactor),l.transmissionTexture!==void 0&&a.push(r.assignTexture(n,"transmissionMap",l.transmissionTexture)),Promise.all(a)}}class qle{constructor(e){this.parser=e,this.name=qn.KHR_MATERIALS_VOLUME}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],l=s.extensions[this.name];n.thickness=l.thicknessFactor!==void 0?l.thicknessFactor:0,l.thicknessTexture!==void 0&&a.push(r.assignTexture(n,"thicknessMap",l.thicknessTexture)),n.attenuationDistance=l.attenuationDistance||1/0;const u=l.attenuationColor||[1,1,1];return n.attenuationColor=new Ct(u[0],u[1],u[2]),Promise.all(a)}}class Qle{constructor(e){this.parser=e,this.name=qn.KHR_MATERIALS_IOR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return n.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}}class ece{constructor(e){this.parser=e,this.name=qn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],l=s.extensions[this.name];n.specularIntensity=l.specularFactor!==void 0?l.specularFactor:1,l.specularTexture!==void 0&&a.push(r.assignTexture(n,"specularIntensityMap",l.specularTexture));const u=l.specularColorFactor||[1,1,1];return n.specularColor=new Ct(u[0],u[1],u[2]),l.specularColorTexture!==void 0&&a.push(r.assignTexture(n,"specularColorMap",l.specularColorTexture,Tn)),Promise.all(a)}}class tce{constructor(e){this.parser=e,this.name=qn.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nr}extendMaterialParams(e,n){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],l=s.extensions[this.name];return l.anisotropyStrength!==void 0&&(n.anisotropy=l.anisotropyStrength),l.anisotropyRotation!==void 0&&(n.anisotropyRotation=l.anisotropyRotation),l.anisotropyTexture!==void 0&&a.push(r.assignTexture(n,"anisotropyMap",l.anisotropyTexture)),Promise.all(a)}}class nce{constructor(e){this.parser=e,this.name=qn.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const a=s.extensions[this.name],l=n.options.ktx2Loader;if(!l){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,a.source,l)}}class ice{constructor(e){this.parser=e,this.name=qn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,r=this.parser,s=r.json,a=s.textures[e];if(!a.extensions||!a.extensions[n])return null;const l=a.extensions[n],u=s.images[l.source];let d=r.textureLoader;if(u.uri){const h=r.options.manager.getHandler(u.uri);h!==null&&(d=h)}return this.detectSupport().then(function(h){if(h)return r.loadTextureImage(e,l.source,d);if(s.extensionsRequired&&s.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class rce{constructor(e){this.parser=e,this.name=qn.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const n=this.name,r=this.parser,s=r.json,a=s.textures[e];if(!a.extensions||!a.extensions[n])return null;const l=a.extensions[n],u=s.images[l.source];let d=r.textureLoader;if(u.uri){const h=r.options.manager.getHandler(u.uri);h!==null&&(d=h)}return this.detectSupport().then(function(h){if(h)return r.loadTextureImage(e,l.source,d);if(s.extensionsRequired&&s.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class sce{constructor(e){this.name=qn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,r=n.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const s=r.extensions[this.name],a=this.parser.getDependency("buffer",s.buffer),l=this.parser.options.meshoptDecoder;if(!l||!l.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return a.then(function(u){const d=s.byteOffset||0,h=s.byteLength||0,f=s.count,p=s.byteStride,m=new Uint8Array(u,d,h);return l.decodeGltfBufferAsync?l.decodeGltfBufferAsync(f,p,m,s.mode,s.filter).then(function(T){return T.buffer}):l.ready.then(function(){const T=new ArrayBuffer(f*p);return l.decodeGltfBuffer(new Uint8Array(T),f,p,m,s.mode,s.filter),T})})}else return null}}class oce{constructor(e){this.name=qn.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,r=n.nodes[e];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;const s=n.meshes[r.mesh];for(const h of s.primitives)if(h.mode!==Ba.TRIANGLES&&h.mode!==Ba.TRIANGLE_STRIP&&h.mode!==Ba.TRIANGLE_FAN&&h.mode!==void 0)return null;const l=r.extensions[this.name].attributes,u=[],d={};for(const h in l)u.push(this.parser.getDependency("accessor",l[h]).then(f=>(d[h]=f,d[h])));return u.length<1?null:(u.push(this.parser.createNodeMesh(e)),Promise.all(u).then(h=>{const f=h.pop(),p=f.isGroup?f.children:[f],m=h[0].count,T=[];for(const E of p){const b=new pn,y=new te,S=new Er,A=new te(1,1,1),C=new B$(E.geometry,E.material,m);for(let R=0;R<m;R++)d.TRANSLATION&&y.fromBufferAttribute(d.TRANSLATION,R),d.ROTATION&&S.fromBufferAttribute(d.ROTATION,R),d.SCALE&&A.fromBufferAttribute(d.SCALE,R),C.setMatrixAt(R,b.compose(y,S,A));for(const R in d)R!=="TRANSLATION"&&R!=="ROTATION"&&R!=="SCALE"&&E.geometry.setAttribute(R,d[R]);Xn.prototype.copy.call(C,E),this.parser.assignFinalMaterial(C),T.push(C)}return f.isGroup?(f.clear(),f.add(...T),f):T[0]}))}}const Y2="glTF",oT=12,qk={JSON:1313821514,BIN:5130562};class ace{constructor(e){this.name=qn.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,oT),r=new TextDecoder;if(this.header={magic:r.decode(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Y2)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-oT,a=new DataView(e,oT);let l=0;for(;l<s;){const u=a.getUint32(l,!0);l+=4;const d=a.getUint32(l,!0);if(l+=4,d===qk.JSON){const h=new Uint8Array(e,oT+l,u);this.content=r.decode(h)}else if(d===qk.BIN){const h=oT+l;this.body=e.slice(h,h+u)}l+=u}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class lce{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=qn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const r=this.json,s=this.dracoLoader,a=e.extensions[this.name].bufferView,l=e.extensions[this.name].attributes,u={},d={},h={};for(const f in l){const p=iw[f]||f.toLowerCase();u[p]=l[f]}for(const f in e.attributes){const p=iw[f]||f.toLowerCase();if(l[f]!==void 0){const m=r.accessors[e.attributes[f]],T=kg[m.componentType];h[p]=T.name,d[p]=m.normalized===!0}}return n.getDependency("bufferView",a).then(function(f){return new Promise(function(p){s.decodeDracoFile(f,function(m){for(const T in m.attributes){const E=m.attributes[T],b=d[T];b!==void 0&&(E.normalized=b)}p(m)},u,h)})})}}class cce{constructor(){this.name=qn.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord===void 0||n.texCoord===e.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class uce{constructor(){this.name=qn.KHR_MESH_QUANTIZATION}}class K2 extends Np{constructor(e,n,r,s){super(e,n,r,s)}copySampleValue_(e){const n=this.resultBuffer,r=this.sampleValues,s=this.valueSize,a=e*s*3+s;for(let l=0;l!==s;l++)n[l]=r[a+l];return n}interpolate_(e,n,r,s){const a=this.resultBuffer,l=this.sampleValues,u=this.valueSize,d=u*2,h=u*3,f=s-n,p=(r-n)/f,m=p*p,T=m*p,E=e*h,b=E-h,y=-2*T+3*m,S=T-m,A=1-y,C=S-m+p;for(let R=0;R!==u;R++){const I=l[b+R+u],O=l[b+R+d]*f,F=l[E+R+u],k=l[E+R]*f;a[R]=A*I+C*O+y*F+S*k}return a}}const hce=new Er;class dce extends K2{interpolate_(e,n,r,s){const a=super.interpolate_(e,n,r,s);return hce.fromArray(a).normalize().toArray(a),a}}const Ba={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},kg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Qk={9728:tr,9729:Gn,9984:zg,9985:vE,9986:ip,9987:Ka},eP={33071:Pi,33648:Ep,10497:Pl},ax={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},iw={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Dh={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},fce={CUBICSPLINE:void 0,LINEAR:Lu,STEP:Sp},lx={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function pce(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new Lp({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ya})),i.DefaultMaterial}function Nf(i,e,n){for(const r in n.extensions)i[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=n.extensions[r])}function Uh(i,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(i.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function mce(i,e,n){let r=!1,s=!1,a=!1;for(let h=0,f=e.length;h<f;h++){const p=e[h];if(p.POSITION!==void 0&&(r=!0),p.NORMAL!==void 0&&(s=!0),p.COLOR_0!==void 0&&(a=!0),r&&s&&a)break}if(!r&&!s&&!a)return Promise.resolve(i);const l=[],u=[],d=[];for(let h=0,f=e.length;h<f;h++){const p=e[h];if(r){const m=p.POSITION!==void 0?n.getDependency("accessor",p.POSITION):i.attributes.position;l.push(m)}if(s){const m=p.NORMAL!==void 0?n.getDependency("accessor",p.NORMAL):i.attributes.normal;u.push(m)}if(a){const m=p.COLOR_0!==void 0?n.getDependency("accessor",p.COLOR_0):i.attributes.color;d.push(m)}}return Promise.all([Promise.all(l),Promise.all(u),Promise.all(d)]).then(function(h){const f=h[0],p=h[1],m=h[2];return r&&(i.morphAttributes.position=f),s&&(i.morphAttributes.normal=p),a&&(i.morphAttributes.color=m),i.morphTargetsRelative=!0,i})}function gce(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let n=0,r=e.weights.length;n<r;n++)i.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(i.morphTargetInfluences.length===n.length){i.morphTargetDictionary={};for(let r=0,s=n.length;r<s;r++)i.morphTargetDictionary[n[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function _ce(i){let e;const n=i.extensions&&i.extensions[qn.KHR_DRACO_MESH_COMPRESSION];if(n?e="draco:"+n.bufferView+":"+n.indices+":"+cx(n.attributes):e=i.indices+":"+cx(i.attributes)+":"+i.mode,i.targets!==void 0)for(let r=0,s=i.targets.length;r<s;r++)e+=":"+cx(i.targets[r]);return e}function cx(i){let e="";const n=Object.keys(i).sort();for(let r=0,s=n.length;r<s;r++)e+=n[r]+":"+i[n[r]]+";";return e}function rw(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function vce(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Tce=new pn;class Ece{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new zle,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,s=!1,a=-1;typeof navigator<"u"&&(r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,a=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||r||s&&a<98?this.textureLoader=new BM(this.options.manager):this.textureLoader=new UM(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Lr(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const r=this,s=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(l){return l._markDefs&&l._markDefs()}),Promise.all(this._invokeAll(function(l){return l.beforeRoot&&l.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(l){const u={scene:l[0][s.scene||0],scenes:l[0],animations:l[1],cameras:l[2],asset:s.asset,parser:r,userData:{}};Nf(a,u,s),Uh(u,s),Promise.all(r._invokeAll(function(d){return d.afterRoot&&d.afterRoot(u)})).then(function(){e(u)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],r=this.json.meshes||[];for(let s=0,a=n.length;s<a;s++){const l=n[s].joints;for(let u=0,d=l.length;u<d;u++)e[l[u]].isBone=!0}for(let s=0,a=e.length;s<a;s++){const l=e[s];l.mesh!==void 0&&(this._addNodeRef(this.meshCache,l.mesh),l.skin!==void 0&&(r[l.mesh].isSkinnedMesh=!0)),l.camera!==void 0&&this._addNodeRef(this.cameraCache,l.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,r){if(e.refs[n]<=1)return r;const s=r.clone(),a=(l,u)=>{const d=this.associations.get(l);d!=null&&this.associations.set(u,d);for(const[h,f]of l.children.entries())a(f,u.children[h])};return a(r,s),s.name+="_instance_"+e.uses[n]++,s}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let r=0;r<n.length;r++){const s=e(n[r]);if(s)return s}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const r=[];for(let s=0;s<n.length;s++){const a=e(n[s]);a&&r.push(a)}return r}getDependency(e,n){const r=e+":"+n;let s=this.cache.get(r);if(!s){switch(e){case"scene":s=this.loadScene(n);break;case"node":s=this._invokeOne(function(a){return a.loadNode&&a.loadNode(n)});break;case"mesh":s=this._invokeOne(function(a){return a.loadMesh&&a.loadMesh(n)});break;case"accessor":s=this.loadAccessor(n);break;case"bufferView":s=this._invokeOne(function(a){return a.loadBufferView&&a.loadBufferView(n)});break;case"buffer":s=this.loadBuffer(n);break;case"material":s=this._invokeOne(function(a){return a.loadMaterial&&a.loadMaterial(n)});break;case"texture":s=this._invokeOne(function(a){return a.loadTexture&&a.loadTexture(n)});break;case"skin":s=this.loadSkin(n);break;case"animation":s=this._invokeOne(function(a){return a.loadAnimation&&a.loadAnimation(n)});break;case"camera":s=this.loadCamera(n);break;default:if(s=this._invokeOne(function(a){return a!=this&&a.getDependency&&a.getDependency(e,n)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(r,s)}return s}getDependencies(e){let n=this.cache.get(e);if(!n){const r=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(s.map(function(a,l){return r.getDependency(e,l)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],r=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[qn.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(a,l){r.load(Nl.resolveURL(n.uri,s.path),a,void 0,function(){l(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(r){const s=n.byteLength||0,a=n.byteOffset||0;return r.slice(a,a+s)})}loadAccessor(e){const n=this,r=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const l=ax[s.type],u=kg[s.componentType],d=s.normalized===!0,h=new u(s.count*l);return Promise.resolve(new Qn(h,l,d))}const a=[];return s.bufferView!==void 0?a.push(this.getDependency("bufferView",s.bufferView)):a.push(null),s.sparse!==void 0&&(a.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(a).then(function(l){const u=l[0],d=ax[s.type],h=kg[s.componentType],f=h.BYTES_PER_ELEMENT,p=f*d,m=s.byteOffset||0,T=s.bufferView!==void 0?r.bufferViews[s.bufferView].byteStride:void 0,E=s.normalized===!0;let b,y;if(T&&T!==p){const S=Math.floor(m/T),A="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+S+":"+s.count;let C=n.cache.get(A);C||(b=new h(u,S*T,s.count*T/f),C=new t_(b,T/f),n.cache.add(A,C)),y=new lo(C,d,m%T/f,E)}else u===null?b=new h(s.count*d):b=new h(u,m,s.count*d),y=new Qn(b,d,E);if(s.sparse!==void 0){const S=ax.SCALAR,A=kg[s.sparse.indices.componentType],C=s.sparse.indices.byteOffset||0,R=s.sparse.values.byteOffset||0,I=new A(l[1],C,s.sparse.count*S),O=new h(l[2],R,s.sparse.count*d);u!==null&&(y=new Qn(y.array.slice(),y.itemSize,y.normalized));for(let F=0,k=I.length;F<k;F++){const D=I[F];if(y.setX(D,O[F*d]),d>=2&&y.setY(D,O[F*d+1]),d>=3&&y.setZ(D,O[F*d+2]),d>=4&&y.setW(D,O[F*d+3]),d>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return y})}loadTexture(e){const n=this.json,r=this.options,a=n.textures[e].source,l=n.images[a];let u=this.textureLoader;if(l.uri){const d=r.manager.getHandler(l.uri);d!==null&&(u=d)}return this.loadTextureImage(e,a,u)}loadTextureImage(e,n,r){const s=this,a=this.json,l=a.textures[e],u=a.images[n],d=(u.uri||u.bufferView)+":"+l.sampler;if(this.textureCache[d])return this.textureCache[d];const h=this.loadImageSource(n,r).then(function(f){f.flipY=!1,f.name=l.name||u.name||"",f.name===""&&typeof u.uri=="string"&&u.uri.startsWith("data:image/")===!1&&(f.name=u.uri);const m=(a.samplers||{})[l.sampler]||{};return f.magFilter=Qk[m.magFilter]||Gn,f.minFilter=Qk[m.minFilter]||Ka,f.wrapS=eP[m.wrapS]||Pl,f.wrapT=eP[m.wrapT]||Pl,s.associations.set(f,{textures:e}),f}).catch(function(){return null});return this.textureCache[d]=h,h}loadImageSource(e,n){const r=this,s=this.json,a=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(p=>p.clone());const l=s.images[e],u=self.URL||self.webkitURL;let d=l.uri||"",h=!1;if(l.bufferView!==void 0)d=r.getDependency("bufferView",l.bufferView).then(function(p){h=!0;const m=new Blob([p],{type:l.mimeType});return d=u.createObjectURL(m),d});else if(l.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(d).then(function(p){return new Promise(function(m,T){let E=m;n.isImageBitmapLoader===!0&&(E=function(b){const y=new ni(b);y.needsUpdate=!0,m(y)}),n.load(Nl.resolveURL(p,a.path),E,void 0,T)})}).then(function(p){return h===!0&&u.revokeObjectURL(d),p.userData.mimeType=l.mimeType||vce(l.uri),p}).catch(function(p){throw console.error("THREE.GLTFLoader: Couldn't load texture",d),p});return this.sourceCache[e]=f,f}assignTexture(e,n,r,s){const a=this;return this.getDependency("texture",r.index).then(function(l){if(!l)return null;if(r.texCoord!==void 0&&r.texCoord>0&&(l=l.clone(),l.channel=r.texCoord),a.extensions[qn.KHR_TEXTURE_TRANSFORM]){const u=r.extensions!==void 0?r.extensions[qn.KHR_TEXTURE_TRANSFORM]:void 0;if(u){const d=a.associations.get(l);l=a.extensions[qn.KHR_TEXTURE_TRANSFORM].extendTexture(l,u),a.associations.set(l,d)}}return s!==void 0&&(l.colorSpace=s),e[n]=l,l})}assignFinalMaterial(e){const n=e.geometry;let r=e.material;const s=n.attributes.tangent===void 0,a=n.attributes.color!==void 0,l=n.attributes.normal===void 0;if(e.isPoints){const u="PointsMaterial:"+r.uuid;let d=this.cache.get(u);d||(d=new bE,rr.prototype.copy.call(d,r),d.color.copy(r.color),d.map=r.map,d.sizeAttenuation=!1,this.cache.add(u,d)),r=d}else if(e.isLine){const u="LineBasicMaterial:"+r.uuid;let d=this.cache.get(u);d||(d=new fi,rr.prototype.copy.call(d,r),d.color.copy(r.color),d.map=r.map,this.cache.add(u,d)),r=d}if(s||a||l){let u="ClonedMaterial:"+r.uuid+":";s&&(u+="derivative-tangents:"),a&&(u+="vertex-colors:"),l&&(u+="flat-shading:");let d=this.cache.get(u);d||(d=r.clone(),a&&(d.vertexColors=!0),l&&(d.flatShading=!0),s&&(d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(u,d),this.associations.set(d,this.associations.get(r))),r=d}e.material=r}getMaterialType(){return Lp}loadMaterial(e){const n=this,r=this.json,s=this.extensions,a=r.materials[e];let l;const u={},d=a.extensions||{},h=[];if(d[qn.KHR_MATERIALS_UNLIT]){const p=s[qn.KHR_MATERIALS_UNLIT];l=p.getMaterialType(),h.push(p.extendParams(u,a,n))}else{const p=a.pbrMetallicRoughness||{};if(u.color=new Ct(1,1,1),u.opacity=1,Array.isArray(p.baseColorFactor)){const m=p.baseColorFactor;u.color.fromArray(m),u.opacity=m[3]}p.baseColorTexture!==void 0&&h.push(n.assignTexture(u,"map",p.baseColorTexture,Tn)),u.metalness=p.metallicFactor!==void 0?p.metallicFactor:1,u.roughness=p.roughnessFactor!==void 0?p.roughnessFactor:1,p.metallicRoughnessTexture!==void 0&&(h.push(n.assignTexture(u,"metalnessMap",p.metallicRoughnessTexture)),h.push(n.assignTexture(u,"roughnessMap",p.metallicRoughnessTexture))),l=this._invokeOne(function(m){return m.getMaterialType&&m.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(m){return m.extendMaterialParams&&m.extendMaterialParams(e,u)})))}a.doubleSided===!0&&(u.side=Ss);const f=a.alphaMode||lx.OPAQUE;if(f===lx.BLEND?(u.transparent=!0,u.depthWrite=!1):(u.transparent=!1,f===lx.MASK&&(u.alphaTest=a.alphaCutoff!==void 0?a.alphaCutoff:.5)),a.normalTexture!==void 0&&l!==ii&&(h.push(n.assignTexture(u,"normalMap",a.normalTexture)),u.normalScale=new mt(1,1),a.normalTexture.scale!==void 0)){const p=a.normalTexture.scale;u.normalScale.set(p,p)}return a.occlusionTexture!==void 0&&l!==ii&&(h.push(n.assignTexture(u,"aoMap",a.occlusionTexture)),a.occlusionTexture.strength!==void 0&&(u.aoMapIntensity=a.occlusionTexture.strength)),a.emissiveFactor!==void 0&&l!==ii&&(u.emissive=new Ct().fromArray(a.emissiveFactor)),a.emissiveTexture!==void 0&&l!==ii&&h.push(n.assignTexture(u,"emissiveMap",a.emissiveTexture,Tn)),Promise.all(h).then(function(){const p=new l(u);return a.name&&(p.name=a.name),Uh(p,a),n.associations.set(p,{materials:e}),a.extensions&&Nf(s,p,a),p})}createUniqueName(e){const n=Zn.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,r=this.extensions,s=this.primitiveCache;function a(u){return r[qn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(u,n).then(function(d){return tP(d,u,n)})}const l=[];for(let u=0,d=e.length;u<d;u++){const h=e[u],f=_ce(h),p=s[f];if(p)l.push(p.promise);else{let m;h.extensions&&h.extensions[qn.KHR_DRACO_MESH_COMPRESSION]?m=a(h):m=tP(new rn,h,n),s[f]={primitive:h,promise:m},l.push(m)}}return Promise.all(l)}loadMesh(e){const n=this,r=this.json,s=this.extensions,a=r.meshes[e],l=a.primitives,u=[];for(let d=0,h=l.length;d<h;d++){const f=l[d].material===void 0?pce(this.cache):this.getDependency("material",l[d].material);u.push(f)}return u.push(n.loadGeometries(l)),Promise.all(u).then(function(d){const h=d.slice(0,d.length-1),f=d[d.length-1],p=[];for(let T=0,E=f.length;T<E;T++){const b=f[T],y=l[T];let S;const A=h[T];if(y.mode===Ba.TRIANGLES||y.mode===Ba.TRIANGLE_STRIP||y.mode===Ba.TRIANGLE_FAN||y.mode===void 0)S=a.isSkinnedMesh===!0?new D$(b,A):new Pn(b,A),S.isSkinnedMesh===!0&&S.normalizeSkinWeights(),y.mode===Ba.TRIANGLE_STRIP?S.geometry=Zk(S.geometry,TE):y.mode===Ba.TRIANGLE_FAN&&(S.geometry=Zk(S.geometry,$p));else if(y.mode===Ba.LINES)S=new Ja(b,A);else if(y.mode===Ba.LINE_STRIP)S=new Ki(b,A);else if(y.mode===Ba.LINE_LOOP)S=new F$(b,A);else if(y.mode===Ba.POINTS)S=new U$(b,A);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(S.geometry.morphAttributes).length>0&&gce(S,a),S.name=n.createUniqueName(a.name||"mesh_"+e),Uh(S,a),y.extensions&&Nf(s,S,y),n.assignFinalMaterial(S),p.push(S)}for(let T=0,E=p.length;T<E;T++)n.associations.set(p[T],{meshes:e,primitives:T});if(p.length===1)return a.extensions&&Nf(s,p[0],a),p[0];const m=new za;a.extensions&&Nf(s,m,a),n.associations.set(m,{meshes:e});for(let T=0,E=p.length;T<E;T++)m.add(p[T]);return m})}loadCamera(e){let n;const r=this.json.cameras[e],s=r[r.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?n=new Ui(sp.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):r.type==="orthographic"&&(n=new ua(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),r.name&&(n.name=this.createUniqueName(r.name)),Uh(n,r),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],r=[];for(let s=0,a=n.joints.length;s<a;s++)r.push(this._loadNodeShallow(n.joints[s]));return n.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",n.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(s){const a=s.pop(),l=s,u=[],d=[];for(let h=0,f=l.length;h<f;h++){const p=l[h];if(p){u.push(p);const m=new pn;a!==null&&m.fromArray(a.array,h*16),d.push(m)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[h])}return new n_(u,d)})}loadAnimation(e){const r=this.json.animations[e],s=r.name?r.name:"animation_"+e,a=[],l=[],u=[],d=[],h=[];for(let f=0,p=r.channels.length;f<p;f++){const m=r.channels[f],T=r.samplers[m.sampler],E=m.target,b=E.node,y=r.parameters!==void 0?r.parameters[T.input]:T.input,S=r.parameters!==void 0?r.parameters[T.output]:T.output;E.node!==void 0&&(a.push(this.getDependency("node",b)),l.push(this.getDependency("accessor",y)),u.push(this.getDependency("accessor",S)),d.push(T),h.push(E))}return Promise.all([Promise.all(a),Promise.all(l),Promise.all(u),Promise.all(d),Promise.all(h)]).then(function(f){const p=f[0],m=f[1],T=f[2],E=f[3],b=f[4],y=[];for(let S=0,A=p.length;S<A;S++){const C=p[S],R=m[S],I=T[S],O=E[S],F=b[S];if(C===void 0)continue;C.updateMatrix();let k;switch(Dh[F.path]){case Dh.weights:k=cd;break;case Dh.rotation:k=wc;break;case Dh.position:case Dh.scale:default:k=ud;break}const D=C.name?C.name:C.uuid,U=O.interpolation!==void 0?fce[O.interpolation]:Lu,ce=[];Dh[F.path]===Dh.weights?C.traverse(function(ae){ae.morphTargetInfluences&&ce.push(ae.name?ae.name:ae.uuid)}):ce.push(D);let ie=I.array;if(I.normalized){const ae=rw(ie.constructor),ne=new Float32Array(ie.length);for(let pe=0,de=ie.length;pe<de;pe++)ne[pe]=ie[pe]*ae;ie=ne}for(let ae=0,ne=ce.length;ae<ne;ae++){const pe=new k(ce[ae]+"."+Dh[F.path],R.array,ie,U);O.interpolation==="CUBICSPLINE"&&(pe.createInterpolant=function(xe){const H=this instanceof wc?dce:K2;return new H(this.times,this.values,this.getValueSize()/3,xe)},pe.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),y.push(pe)}}return new Ap(s,void 0,y)})}createNodeMesh(e){const n=this.json,r=this,s=n.nodes[e];return s.mesh===void 0?null:r.getDependency("mesh",s.mesh).then(function(a){const l=r._getNodeRef(r.meshCache,s.mesh,a);return s.weights!==void 0&&l.traverse(function(u){if(u.isMesh)for(let d=0,h=s.weights.length;d<h;d++)u.morphTargetInfluences[d]=s.weights[d]}),l})}loadNode(e){const n=this.json,r=this,s=n.nodes[e],a=r._loadNodeShallow(e),l=[],u=s.children||[];for(let h=0,f=u.length;h<f;h++)l.push(r.getDependency("node",u[h]));const d=s.skin===void 0?Promise.resolve(null):r.getDependency("skin",s.skin);return Promise.all([a,Promise.all(l),d]).then(function(h){const f=h[0],p=h[1],m=h[2];m!==null&&f.traverse(function(T){T.isSkinnedMesh&&T.bind(m,Tce)});for(let T=0,E=p.length;T<E;T++)f.add(p[T]);return f})}_loadNodeShallow(e){const n=this.json,r=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const a=n.nodes[e],l=a.name?s.createUniqueName(a.name):"",u=[],d=s._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return d&&u.push(d),a.camera!==void 0&&u.push(s.getDependency("camera",a.camera).then(function(h){return s._getNodeRef(s.cameraCache,a.camera,h)})),s._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){u.push(h)}),this.nodeCache[e]=Promise.all(u).then(function(h){let f;if(a.isBone===!0?f=new $E:h.length>1?f=new za:h.length===1?f=h[0]:f=new Xn,f!==h[0])for(let p=0,m=h.length;p<m;p++)f.add(h[p]);if(a.name&&(f.userData.name=a.name,f.name=l),Uh(f,a),a.extensions&&Nf(r,f,a),a.matrix!==void 0){const p=new pn;p.fromArray(a.matrix),f.applyMatrix4(p)}else a.translation!==void 0&&f.position.fromArray(a.translation),a.rotation!==void 0&&f.quaternion.fromArray(a.rotation),a.scale!==void 0&&f.scale.fromArray(a.scale);return s.associations.has(f)||s.associations.set(f,{}),s.associations.get(f).nodes=e,f}),this.nodeCache[e]}loadScene(e){const n=this.extensions,r=this.json.scenes[e],s=this,a=new za;r.name&&(a.name=s.createUniqueName(r.name)),Uh(a,r),r.extensions&&Nf(n,a,r);const l=r.nodes||[],u=[];for(let d=0,h=l.length;d<h;d++)u.push(s.getDependency("node",l[d]));return Promise.all(u).then(function(d){for(let f=0,p=d.length;f<p;f++)a.add(d[f]);const h=f=>{const p=new Map;for(const[m,T]of s.associations)(m instanceof rr||m instanceof ni)&&p.set(m,T);return f.traverse(m=>{const T=s.associations.get(m);T!=null&&p.set(m,T)}),p};return s.associations=h(a),a})}}function yce(i,e,n){const r=e.attributes,s=new Xs;if(r.POSITION!==void 0){const u=n.json.accessors[r.POSITION],d=u.min,h=u.max;if(d!==void 0&&h!==void 0){if(s.set(new te(d[0],d[1],d[2]),new te(h[0],h[1],h[2])),u.normalized){const f=rw(kg[u.componentType]);s.min.multiplyScalar(f),s.max.multiplyScalar(f)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const a=e.targets;if(a!==void 0){const u=new te,d=new te;for(let h=0,f=a.length;h<f;h++){const p=a[h];if(p.POSITION!==void 0){const m=n.json.accessors[p.POSITION],T=m.min,E=m.max;if(T!==void 0&&E!==void 0){if(d.setX(Math.max(Math.abs(T[0]),Math.abs(E[0]))),d.setY(Math.max(Math.abs(T[1]),Math.abs(E[1]))),d.setZ(Math.max(Math.abs(T[2]),Math.abs(E[2]))),m.normalized){const b=rw(kg[m.componentType]);d.multiplyScalar(b)}u.max(d)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(u)}i.boundingBox=s;const l=new js;s.getCenter(l.center),l.radius=s.min.distanceTo(s.max)/2,i.boundingSphere=l}function tP(i,e,n){const r=e.attributes,s=[];function a(l,u){return n.getDependency("accessor",l).then(function(d){i.setAttribute(u,d)})}for(const l in r){const u=iw[l]||l.toLowerCase();u in i.attributes||s.push(a(r[l],u))}if(e.indices!==void 0&&!i.index){const l=n.getDependency("accessor",e.indices).then(function(u){i.setIndex(u)});s.push(l)}return Uh(i,e),yce(i,e,n),Promise.all(s).then(function(){return e.targets!==void 0?mce(i,e.targets,n):i})}const Sce=new Do;let hI,$u,aT=null,$ce="white",bce="black",Ace="yellow",Cce="black";const xce=({measurementViewEnabled:i})=>{const{camera:e,gl:n,scene:r}=$n(),s=q.useRef();return q.useEffect(()=>{i?(e.position.set(5,100,-5),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI/2,s.current.minPolarAngle=Math.PI/2,s.current.enableRotate=!1)):(e.position.set(50,50,50),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI,s.current.minPolarAngle=0,s.current.enableRotate=!0)),hI=e,$u=r},[i,e]),G.jsx(G.Fragment,{children:!i&&G.jsx(No,{ref:s,args:[e,n.domElement]})})},Rce=({position:i})=>G.jsxs("mesh",{position:i,children:[G.jsx("sphereGeometry",{args:[.5,16,16]}),G.jsx("meshStandardMaterial",{color:bce})]}),wce=(i,e,n,r)=>{if(n){const s=i.target.getBoundingClientRect(),a=(i.clientX-s.left)/s.width*2-1,l=-((i.clientY-s.top)/s.height)*2+1,u=new te(a,l,.5),d=new As;d.setFromCamera(u,hI);const h=d.intersectObject($u,!0);if(h.length>0){const f=h[0].point;e(y=>[...y,f]),aT==null&&(aT=r.current.position.clone()),aT.distanceTo(f);const p=[aT,f],m=new rn().setFromPoints(p),T=new fi({color:$ce}),E=new Ki(m,T);$u.add(E),aT.copy(f);const b=`X: ${f.x.toFixed(2)} cm, Y: ${f.y.toFixed(2)} cm, Z: ${f.z.toFixed(2)} cm`;Mce(b,f)}}},Mce=(i,e)=>{Sce.load("assets/helvetiker_regular.typeface.json",n=>{const r=new Po(i,{font:n,size:2,height:.09,curveSegments:1,bevelEnabled:!1,bevelThickness:0,bevelSize:.03,bevelSegments:2}),s=new ii({color:Cce}),a=new Pn(r,s);a.position.set(e.x,e.y+.4,e.z),a.quaternion.copy(hI.quaternion),$u.add(a)},void 0,n=>{console.error("An error occurred loading the font:",n)})},Ice=()=>{const{scene:i}=Cs("assets/models/agriculture/sunflowers.glb"),e=[60,20,175],n=[0,29,0];return i.rotation.set(n[0],n[1],n[2]),G.jsx("primitive",{object:i,position:e,scale:20})},Oce=()=>{const{gl:i}=$n(),e=()=>{const n=i.domElement.toDataURL("image/png"),r=new Date().toISOString().replace(/[:.]/g,"-"),s=document.createElement("a");s.href=n,s.download=`transportation_${r}.png`,s.click()};return q.useEffect(()=>{const n=()=>{e()};return Tt.on("commandTakeScreenShot",n),()=>{Tt.off("commandTakeScreenShot",n)}},[]),null},J2=({droneRef:i,measurementViewEnabled:e,mouseControlEnabled:n})=>{const r=q.useRef(),[s,a]=q.useState([]),l=q.useRef(),u=q.useRef(),d=q.useRef(),h=q.useRef(),f=q.useRef(),p=q.useRef();return q.useEffect(()=>{const m=b=>{const y=i.current,S=$u.getObjectByName(b);if(!y||!S)return;const A=new te,C=new te;y.getWorldPosition(A),S.getWorldPosition(C),A.distanceTo(C)<15?(y.attach(S),S.position.set(0,2,0),console.log(`Picked up ${b}`)):console.log(`${b} too far to pick up.`)},T=b=>{const y=i.current,S=$u.getObjectByName(b);if(!y||!S)return;$u.attach(S);const A=new te;y.getWorldPosition(A),S.position.copy(A),console.log(`Dropped ${b}`)},E=()=>{const b=d.current;if(!b)return;new Vle().load("/drone-simulation-cte-alpha/assets/models/agriculture/water.glb",S=>{const A=S.scene,C=new te;b.getWorldPosition(C),A.position.set(C.x+3,C.y,C.z),A.scale.set(30,30,30),A.visible=!0,$u.add(A);const R=.09,I=setInterval(()=>{A.position.y-=R,console.log("Droplet falling at Y position: ",A.position.y),A.position.y<-4&&($u.remove(A),clearInterval(I))},16)},void 0,S=>{console.error("Failed to load water droplet model:",S)})};return Tt.on("commandPickupObject",m),Tt.on("commandDropObject",T),Tt.on("commandSpray",E),()=>{Tt.off("commandPickupObject",m),Tt.off("commandDropObject",T),Tt.off("commandSpray",E)}},[]),q.useEffect(()=>{let m=null,T=!1;const b=setInterval(()=>{const y=i.current,S=u.current;if(!y||!S||T)return;const A=new te,C=new te;if(y.getWorldPosition(A),S.getWorldPosition(C),A.distanceTo(C)<20&&!T){T=!0;let I=.15;m=setInterval(()=>{S.position.y+=I,S.position.x+=I*.5,S.position.y>40&&(clearInterval(m),m=null)},16)}},1e3);return()=>{clearInterval(b),m&&clearInterval(m)}},[i,u]),G.jsxs(Lo,{shadows:!0,onClick:m=>wce(m,a,e,i),children:[G.jsx("color",{attach:"background",args:["#87CEEB"]})," ",G.jsx("ambientLight",{intensity:.4,color:new Ct(16761248)})," ",G.jsx(ko,{preset:"sunset",intensity:.5})," ",G.jsx(Ice,{}),s.map((m,T)=>G.jsx(Rce,{position:m},T)),G.jsx(xce,{measurementViewEnabled:e}),G.jsx(Oce,{}),G.jsx(po,{ref:i,controlsRef:r,measurementViewEnabled:e,mouseControlEnabled:n,droneScale:.9,cameraOffset:[-4,8,-18],lineColor:Ace,droneSpeed:.6}),G.jsx(Nn,{ref:u,path:"/drone-simulation-cte-alpha/assets/models/agriculture/bird.glb",position:[15,18,55],scale:5,name:"bird1",enableMeasurement:e}),G.jsx(Nn,{ref:d,path:"/drone-simulation-cte-alpha/assets/models/agriculture/can.glb",position:[14,-1,1],rotation:[0,Math.PI/2,0],scale:5,name:"watercan",enableMeasurement:e}),G.jsx(Nn,{ref:l,path:"/drone-simulation-cte-alpha/assets/models/agriculture/barn.glb",position:[18,-2,4],scale:40,enableMeasurement:e}),G.jsx(Nn,{ref:h,path:"/drone-simulation-cte-alpha/assets/models/agriculture/pesticides.glb",position:[14,-1,6],rotation:[0,Math.PI/2,0],scale:3,name:"pesticide",enableMeasurement:e}),G.jsx(Nn,{ref:f,path:"/drone-simulation-cte-alpha/assets/models/agriculture/pollen.glb",position:[5.5,8.5,16],rotation:[0,Math.PI/2,Math.PI/2],scale:.1,name:"pollen1",enableMeasurement:e}),G.jsx(Nn,{ref:p,path:"/drone-simulation-cte-alpha/assets/models/agriculture/pollen.glb",position:[-9,11,24],rotation:[0,Math.PI/2,Math.PI/2],scale:.1,name:"pollen2",enableMeasurement:e})]})};J2.propTypes={droneRef:Xt.object.isRequired,mouseControlEnabled:Xt.bool,measurementViewEnabled:Xt.bool};const Lce=()=>{window.gtag("event","page_view",{page_path:window.location.pathname});const i=q.useRef(),[e,n]=q.useState(!1),[r,s]=q.useState(!1),[a,l]=q.useState({xPos:0,yPos:0,zPos:0,xRot:0,yRot:0,zRot:0});return q.useEffect(()=>{const u=p=>{n(p)},d=p=>{s(p)};Tt.on("measurementViewEnabled",u),Tt.on("mouseControlEnabled",d);const f=setInterval(()=>{i.current&&l({xPos:i.current.position.x,yPos:i.current.position.y,zPos:i.current.position.z,xRot:i.current.rotation.x,yRot:i.current.rotation.y,zRot:i.current.rotation.z})},100);return()=>clearInterval(f)},[]),G.jsx(fo,{children:G.jsxs("div",{className:"simulation-container",children:[G.jsx("div",{className:"blockpad-container",children:G.jsx(mo,{})}),G.jsxs("div",{className:"transportation-canvas-container",children:[G.jsx(go,{dronePosition:a}),G.jsx(J2,{droneRef:i,measurementViewEnabled:e,mouseControlEnabled:r})]})]})})},Nce=new Do;let dI,fp,lT=null,kce="white",Pce="black",Dce="yellow",Bce="black";const Fce=({measurementViewEnabled:i})=>{const{camera:e,gl:n,scene:r}=$n(),s=q.useRef();return q.useEffect(()=>{i?(e.position.set(10,100,-50),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI/2,s.current.minPolarAngle=Math.PI/2,s.current.enableRotate=!1)):(e.position.set(50,50,50),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI,s.current.minPolarAngle=0,s.current.enableRotate=!0)),dI=e,fp=r},[i,e]),G.jsx(G.Fragment,{children:!i&&G.jsx(No,{ref:s,args:[e,n.domElement]})})},Uce=({position:i})=>G.jsxs("mesh",{position:i,children:[G.jsx("sphereGeometry",{args:[.5,16,16]}),G.jsx("meshStandardMaterial",{color:Pce})]}),Gce=(i,e,n,r)=>{if(n){const s=i.target.getBoundingClientRect(),a=(i.clientX-s.left)/s.width*2-1,l=-((i.clientY-s.top)/s.height)*2+1,u=new te(a,l,.5),d=new As;d.setFromCamera(u,dI);const h=d.intersectObject(fp,!0);if(h.length>0){const f=h[0].point;e(y=>[...y,f]),lT==null&&(lT=r.current.position.clone()),lT.distanceTo(f);const p=[lT,f],m=new rn().setFromPoints(p),T=new fi({color:kce}),E=new Ki(m,T);fp.add(E),lT.copy(f);const b=`X: ${f.x.toFixed(2)} cm, Y: ${f.y.toFixed(2)} cm, Z: ${f.z.toFixed(2)} cm`;Hce(b,f)}}},Hce=(i,e)=>{Nce.load("assets/helvetiker_regular.typeface.json",n=>{const r=new Po(i,{font:n,size:.9,height:.09,curveSegments:1,bevelEnabled:!1,bevelThickness:0,bevelSize:.03,bevelSegments:2}),s=new ii({color:Bce}),a=new Pn(r,s);a.position.set(e.x,e.y+.4,e.z),a.lookAt(dI.position),fp.add(a)},void 0,n=>{console.error("An error occurred loading the font:",n)})},Vce=()=>{const{scene:i}=Cs("assets/models/manufacturing/workshop.glb"),e=[0,0,60],n=[0,188,0];return i.rotation.set(n[0],n[1],n[2]),G.jsx("primitive",{object:i,position:e,scale:20})},zce=()=>{const{gl:i}=$n(),e=()=>{const n=i.domElement.toDataURL("image/png"),r=new Date().toISOString().replace(/[:.]/g,"-"),s=document.createElement("a");s.href=n,s.download=`transportation_${r}.png`,s.click()};return q.useEffect(()=>{const n=()=>{e()};return Tt.on("commandTakeScreenShot",n),()=>{Tt.off("commandTakeScreenShot",n)}},[]),null},Z2=({droneRef:i,measurementViewEnabled:e,mouseControlEnabled:n})=>{const r=q.useRef(),[s,a]=q.useState([]),l=q.useRef(),u=q.useRef(),d=q.useRef(),h=q.useRef(),f=q.useRef(),p=q.useRef(),m=q.useRef();return q.useEffect(()=>{const T=b=>{const y=i.current,S=fp.getObjectByName(b);if(!y||!S)return;const A=new te,C=new te;y.getWorldPosition(A),S.getWorldPosition(C),A.distanceTo(C)<15?(y.attach(S),S.position.set(0,2,0),console.log(`Picked up ${b}`)):console.log(`${b} too far to pick up.`)},E=b=>{const y=i.current,S=fp.getObjectByName(b);if(!y||!S)return;fp.attach(S);const A=new te;y.getWorldPosition(A),S.position.copy(A),console.log(`Dropped ${b}`)};return Tt.on("commandPickupObject",T),Tt.on("commandDropObject",E),()=>{Tt.off("commandPickupObject",T),Tt.off("commandDropObject",E)}},[]),G.jsxs(Lo,{shadows:!0,onClick:T=>Gce(T,a,e,i),children:[G.jsx("color",{attach:"background",args:["#87CEEB"]})," ",G.jsx("ambientLight",{intensity:.4,color:new Ct(16761248)})," ",G.jsx(ko,{preset:"sunset",intensity:.5})," ",G.jsx(Vce,{}),s.map((T,E)=>G.jsx(Uce,{position:T},E)),G.jsx(Fce,{measurementViewEnabled:e}),G.jsx(zce,{}),G.jsx(po,{ref:i,controlsRef:r,measurementViewEnabled:e,mouseControlEnabled:n,droneScale:.9,cameraOffset:[25,25,-35],lineColor:Dce}),G.jsx(Nn,{ref:l,path:"/drone-simulation-cte-alpha/assets/models/manufacturing/car.glb",position:[-30,16,30],rotation:[0,Math.PI-10,0],scale:.09,enableMeasurement:e}),G.jsx(Nn,{ref:u,path:"/drone-simulation-cte-alpha/assets/models/manufacturing/fire.glb",position:[17,16,80],rotation:[0,Math.PI-10,0],scale:.02,enableMeasurement:e}),G.jsx(Nn,{ref:d,path:"/drone-simulation-cte-alpha/assets/models/manufacturing/mask.glb",position:[-80,30,20],rotation:[0,Math.PI,0],scale:30,enableMeasurement:e}),G.jsx(Nn,{ref:h,path:"/drone-simulation-cte-alpha/assets/models/infotech/trashcan.glb",position:[-68,0,0],rotation:[0,Math.PI/2,0],scale:12,enableMeasurement:e}),G.jsx(Nn,{ref:f,path:"/drone-simulation-cte-alpha/assets/models/infotech/banana.glb",position:[-30,0,-40],rotation:[0,Math.PI/2,0],scale:15,name:"peel",enableMeasurement:e}),G.jsx(Nn,{ref:p,path:"/drone-simulation-cte-alpha/assets/models/manufacturing/saw.glb",position:[-10,0,80],rotation:[0,Math.PI/2,0],scale:2,name:"saw",enableMeasurement:e}),G.jsx(Nn,{ref:m,path:"/drone-simulation-cte-alpha/assets/models/manufacturing/screwdriver.glb",position:[15,10,10],rotation:[0,Math.PI/8,0],scale:10,name:"screwdriver",enableMeasurement:e})]})};Z2.propTypes={droneRef:Xt.object.isRequired,mouseControlEnabled:Xt.bool,measurementViewEnabled:Xt.bool};const Wce=()=>{window.gtag("event","page_view",{page_path:window.location.pathname});const i=q.useRef(),[e,n]=q.useState(!1),[r,s]=q.useState(!1),[a,l]=q.useState({xPos:0,yPos:0,zPos:0,xRot:0,yRot:0,zRot:0});return q.useEffect(()=>{const u=p=>{n(p)},d=p=>{s(p)};Tt.on("measurementViewEnabled",u),Tt.on("mouseControlEnabled",d);const f=setInterval(()=>{i.current&&l({xPos:i.current.position.x,yPos:i.current.position.y,zPos:i.current.position.z,xRot:i.current.rotation.x,yRot:i.current.rotation.y,zRot:i.current.rotation.z})},100);return()=>clearInterval(f)},[]),G.jsx(fo,{children:G.jsxs("div",{className:"simulation-container",children:[G.jsx("div",{className:"blockpad-container",children:G.jsx(mo,{})}),G.jsxs("div",{className:"transportation-canvas-container",children:[G.jsx(go,{dronePosition:a}),G.jsx(Z2,{droneRef:i,measurementViewEnabled:e,mouseControlEnabled:r})]})]})})},Xce=new Do;let fI,pp,cT=null,jce="white",Yce="black",Kce="yellow",Jce="black";const Zce=({measurementViewEnabled:i})=>{const{camera:e,gl:n,scene:r}=$n(),s=q.useRef();return q.useEffect(()=>{i?(e.position.set(5,50,-3),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI/2,s.current.minPolarAngle=Math.PI/2,s.current.enableRotate=!1)):(e.position.set(5,5,20),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI,s.current.minPolarAngle=0,s.current.enableRotate=!0)),fI=e,pp=r},[i,e]),G.jsx(G.Fragment,{children:!i&&G.jsx(No,{ref:s,args:[e,n.domElement]})})},qce=({position:i})=>G.jsxs("mesh",{position:i,children:[G.jsx("sphereGeometry",{args:[.5,16,16]}),G.jsx("meshStandardMaterial",{color:Yce})]}),Qce=(i,e,n,r)=>{if(n){const s=i.target.getBoundingClientRect(),a=(i.clientX-s.left)/s.width*2-1,l=-((i.clientY-s.top)/s.height)*2+1,u=new te(a,l,.5),d=new As;d.setFromCamera(u,fI);const h=d.intersectObject(pp,!0);if(h.length>0){const f=h[0].point;e(y=>[...y,f]),cT==null&&(cT=r.current.position.clone()),cT.distanceTo(f);const p=[cT,f],m=new rn().setFromPoints(p),T=new fi({color:jce}),E=new Ki(m,T);pp.add(E),cT.copy(f);const b=`X: ${f.x.toFixed(2)} cm, Y: ${f.y.toFixed(2)} cm, Z: ${f.z.toFixed(2)} cm`;eue(b,f)}}},eue=(i,e)=>{Xce.load("assets/helvetiker_regular.typeface.json",n=>{const r=new Po(i,{font:n,size:1,height:.09,curveSegments:1,bevelEnabled:!1,bevelThickness:0,bevelSize:.03,bevelSegments:2}),s=new ii({color:Jce}),a=new Pn(r,s);a.position.set(e.x,e.y+.4,e.z),a.lookAt(fI.position),pp.add(a)},void 0,n=>{console.error("An error occurred loading the font:",n)})},tue=()=>{const{scene:i}=Cs("assets/models/hospitality/room1.glb");console.log("Loaded GLB scene:",i);const e=[0,-80,10],n=[0,180,0];return i.rotation.set(n[0],n[1],n[2]),G.jsx("primitive",{object:i,position:e,scale:50})},nue=()=>{const{gl:i}=$n(),e=()=>{const n=i.domElement.toDataURL("image/png"),r=new Date().toISOString().replace(/[:.]/g,"-"),s=document.createElement("a");s.href=n,s.download=`hospitality_${r}.png`,s.click()};return q.useEffect(()=>{const n=()=>{e()};return Tt.on("commandTakeScreenShot",n),()=>{Tt.off("commandTakeScreenShot",n)}},[]),null},q2=({droneRef:i,measurementViewEnabled:e,mouseControlEnabled:n})=>{const r=q.useRef(),[s,a]=q.useState([]),l=q.useRef(),u=q.useRef(),d=q.useRef(),h=q.useRef(),f=q.useRef(),p=q.useRef();return q.useEffect(()=>{const m=E=>{const b=i.current,y=pp.getObjectByName(E);if(!b||!y)return;const S=new te,A=new te;b.getWorldPosition(S),y.getWorldPosition(A),S.distanceTo(A)<15?(b.attach(y),y.position.set(0,2,0),console.log(`Picked up ${E}`)):console.log(`${E} too far to pick up.`)},T=E=>{const b=i.current,y=pp.getObjectByName(E);if(!b||!y)return;pp.attach(y);const S=new te;b.getWorldPosition(S),y.position.copy(S),console.log(`Dropped ${E}`)};return Tt.on("commandPickupObject",m),Tt.on("commandDropObject",T),()=>{Tt.off("commandPickupObject",m),Tt.off("commandDropObject",T)}},[]),G.jsxs(Lo,{shadows:!0,onClick:m=>Qce(m,a,e,i),children:[G.jsx("color",{attach:"background",args:["#87CEEB"]}),G.jsx("ambientLight",{intensity:.4,color:new Ct(16761248)}),G.jsx(ko,{preset:"sunset",intensity:.5}),G.jsx(tue,{}),s.map((m,T)=>G.jsx(qce,{position:m},T)),G.jsx(Zce,{measurementViewEnabled:e}),G.jsx(nue,{}),G.jsx(po,{ref:i,controlsRef:r,measurementViewEnabled:e,mouseControlEnabled:n,droneScale:2,cameraOffset:[10,20,-20],lineColor:Kce}),G.jsx(Nn,{ref:l,path:"/drone-simulation-cte-alpha/assets/models/hospitality/cushion.glb",position:[-20,-30,6],rotation:[0,Math.PI+45,0],scale:20,name:"cushion1",enableMeasurement:e}),G.jsx(Nn,{ref:d,path:"/drone-simulation-cte-alpha/assets/models/hospitality/wallet.glb",position:[20,-10,50],rotation:[0,Math.PI/4,0],scale:.5,name:"wallet",enableMeasurement:e}),G.jsx(Nn,{ref:u,path:"/drone-simulation-cte-alpha/assets/models/hospitality/cushion.glb",position:[-45,-30,6],rotation:[0,Math.PI+45,0],scale:20,name:"cushion2",enableMeasurement:e}),G.jsx(Nn,{ref:h,path:"/drone-simulation-cte-alpha/assets/models/infotech/trashcan.glb",position:[0,-35,50],rotation:[0,Math.PI/2,0],scale:20,enableMeasurement:e}),G.jsx(Nn,{ref:f,path:"/drone-simulation-cte-alpha/assets/models/infotech/banana.glb",position:[-30,-35,50],rotation:[0,Math.PI/2,0],scale:20,name:"peel",enableMeasurement:e}),G.jsx(Nn,{ref:p,path:"/drone-simulation-cte-alpha/assets/models/hospitality/lost.glb",position:[-20,-30,80],rotation:[0,Math.PI/2,0],scale:70,name:"LostandFound",enableMeasurement:e})]})};q2.propTypes={droneRef:Xt.object.isRequired,mouseControlEnabled:Xt.bool,measurementViewEnabled:Xt.bool};const iue=()=>{window.gtag("event","page_view",{page_path:window.location.pathname});const i=q.useRef(),[e,n]=q.useState(!1),[r,s]=q.useState(!1),[a,l]=q.useState({xPos:0,yPos:0,zPos:0,xRot:0,yRot:0,zRot:0});return q.useEffect(()=>{const u=p=>{n(p)},d=p=>{s(p)};Tt.on("measurementViewEnabled",u),Tt.on("mouseControlEnabled",d);const f=setInterval(()=>{i.current&&l({xPos:i.current.position.x,yPos:i.current.position.y,zPos:i.current.position.z,xRot:i.current.rotation.x,yRot:i.current.rotation.y,zRot:i.current.rotation.z})},100);return()=>clearInterval(f)},[]),G.jsx(fo,{children:G.jsxs("div",{className:"simulation-container",children:[G.jsx("div",{className:"blockpad-container",children:G.jsx(mo,{})}),G.jsxs("div",{className:"transportation-canvas-container",children:[G.jsx(go,{dronePosition:a}),G.jsx(q2,{droneRef:i,measurementViewEnabled:e,mouseControlEnabled:r})]})]})})},rue=new Do;let Q2,r$,uT=null,sue="white",oue="black",aue="yellow",lue="yellow";const cue=({measurementViewEnabled:i})=>{const{camera:e,gl:n,scene:r}=$n(),s=q.useRef();return q.useEffect(()=>{i?(e.position.set(0,100,-3),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI/2,s.current.minPolarAngle=Math.PI/2,s.current.enableRotate=!1)):(e.position.set(50,50,50),e.lookAt(new te(0,0,0)),e.updateProjectionMatrix(),s.current&&(s.current.maxPolarAngle=Math.PI,s.current.minPolarAngle=0,s.current.enableRotate=!0)),Q2=e,r$=r},[i,e]),G.jsx(G.Fragment,{children:!i&&G.jsx(No,{ref:s,args:[e,n.domElement]})})},uue=({position:i})=>G.jsxs("mesh",{position:i,children:[G.jsx("sphereGeometry",{args:[.5,16,16]}),G.jsx("meshStandardMaterial",{color:oue})]}),hue=(i,e,n,r)=>{if(n){const s=i.target.getBoundingClientRect(),a=(i.clientX-s.left)/s.width*2-1,l=-((i.clientY-s.top)/s.height)*2+1,u=new te(a,l,.5),d=new As;d.setFromCamera(u,Q2);const h=d.intersectObject(r$,!0);if(h.length>0){const f=h[0].point;e(y=>[...y,f]),uT==null&&(uT=r.current.position.clone()),uT.distanceTo(f);const p=[uT,f],m=new rn().setFromPoints(p),T=new fi({color:sue}),E=new Ki(m,T);r$.add(E),uT.copy(f);const b=`X: ${f.x.toFixed(2)} cm, Y: ${f.y.toFixed(2)} cm, Z: ${f.z.toFixed(2)} cm`;due(b,f)}}},due=(i,e)=>{rue.load("assets/helvetiker_regular.typeface.json",n=>{const r=new Po(i,{font:n,size:.9,height:.09,curveSegments:1,bevelEnabled:!1,bevelThickness:0,bevelSize:.03,bevelSegments:2}),s=new ii({color:lue}),a=new Pn(r,s);a.position.set(e.x,e.y+.4,e.z),a.rotation.x=-Math.PI/2,r$.add(a)},void 0,n=>{console.error("An error occurred loading the font:",n)})},fue=()=>{const{scene:i}=Cs("assets/models/transportation/future_city_compressed.glb"),e=[-200,-5,90],n=[0,0,0];return i.rotation.set(n[0],n[1],n[2]),G.jsx("primitive",{object:i,position:e,scale:1})},pue=()=>{const{gl:i}=$n(),e=()=>{const n=i.domElement.toDataURL("image/png"),r=new Date().toISOString().replace(/[:.]/g,"-"),s=document.createElement("a");s.href=n,s.download=`transportation_${r}.png`,s.click()};return q.useEffect(()=>{const n=()=>{e()};return Tt.on("commandTakeScreenShot",n),()=>{Tt.off("commandTakeScreenShot",n)}},[]),null},eG=({droneRef:i,measurementViewEnabled:e,mouseControlEnabled:n})=>{const r=q.useRef(),[s,a]=q.useState([]);return G.jsxs(Lo,{shadows:!0,onClick:l=>hue(l,a,e,i),children:[G.jsx("color",{attach:"background",args:["#fffffff"]})," ",G.jsx("ambientLight",{intensity:.4,color:new Ct(16761248)})," ",G.jsx(ko,{preset:"sunset",intensity:.5})," ",G.jsx(fue,{}),s.map((l,u)=>G.jsx(uue,{position:l},u)),G.jsx(cue,{measurementViewEnabled:e}),G.jsx(pue,{}),G.jsx(po,{ref:i,controlsRef:r,measurementViewEnabled:e,mouseControlEnabled:n,droneScale:.3,cameraOffset:[0,5,-20],lineColor:aue})]})};eG.propTypes={droneRef:Xt.object.isRequired,mouseControlEnabled:Xt.bool,measurementViewEnabled:Xt.bool};const mue=()=>{window.gtag("event","page_view",{page_path:window.location.pathname});const i=q.useRef(),[e,n]=q.useState(!1),[r,s]=q.useState(!1),[a,l]=q.useState({xPos:0,yPos:0,zPos:0,xRot:0,yRot:0,zRot:0});return q.useEffect(()=>{const u=p=>{n(p)},d=p=>{s(p)};Tt.on("measurementViewEnabled",u),Tt.on("mouseControlEnabled",d);const f=setInterval(()=>{i.current&&l({xPos:i.current.position.x,yPos:i.current.position.y,zPos:i.current.position.z,xRot:i.current.rotation.x,yRot:i.current.rotation.y,zRot:i.current.rotation.z})},100);return()=>clearInterval(f)},[]),G.jsx(fo,{children:G.jsxs("div",{className:"simulation-container",children:[G.jsx("div",{className:"blockpad-container",children:G.jsx(mo,{})}),G.jsxs("div",{className:"transportation-canvas-container",children:[G.jsx(go,{dronePosition:a}),G.jsx(eG,{droneRef:i,measurementViewEnabled:e,mouseControlEnabled:r})]})]})})};rR.createRoot(document.getElementById("root")).render(G.jsx(cw.StrictMode,{children:G.jsx(mz,{children:G.jsxs(dz,{children:[G.jsx(Hs,{path:"/",element:G.jsx(Jk,{})}),G.jsx(Hs,{path:"/transportation",element:G.jsx(Jk,{})}),G.jsx(Hs,{path:"/architecture",element:G.jsx(eae,{})}),G.jsx(Hs,{path:"/business",element:G.jsx($ae,{})}),G.jsx(Hs,{path:"/education",element:G.jsx(kae,{})}),G.jsx(Hs,{path:"/communication",element:G.jsx(jae,{})}),G.jsx(Hs,{path:"/engineering",element:G.jsx(ole,{})}),G.jsx(Hs,{path:"/healthscience",element:G.jsx(vle,{})}),G.jsx(Hs,{path:"/hospitality",element:G.jsx(iue,{})}),G.jsx(Hs,{path:"/human-services",element:G.jsx(Mle,{})}),G.jsx(Hs,{path:"/information-technology",element:G.jsx(Hle,{})}),G.jsx(Hs,{path:"/agriculture",element:G.jsx(Lce,{})}),G.jsx(Hs,{path:"/slate",element:G.jsx(Goe,{})}),G.jsx(Hs,{path:"/manufacturing",element:G.jsx(Wce,{})}),G.jsx(Hs,{path:"/law",element:G.jsx(mue,{})})]})})}));
